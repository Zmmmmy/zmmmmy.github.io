<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title></title>
    <link href="/2026/01/22/ReentrantLock%E5%8E%9F%E7%90%86/"/>
    <url>/2026/01/22/ReentrantLock%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2026/01/22/LLM%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/"/>
    <url>/2026/01/22/LLM%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2026/01/22/Python%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
    <url>/2026/01/22/Python%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2026/01/22/hello-world/"/>
    <url>/2026/01/22/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>MCPå·¥å…·åˆ—è¡¨è·å–æœºåˆ¶</title>
    <link href="/2026/01/22/MCP%E5%B7%A5%E5%85%B7%E5%88%97%E8%A1%A8%E8%8E%B7%E5%8F%96%E6%9C%BA%E5%88%B6/"/>
    <url>/2026/01/22/MCP%E5%B7%A5%E5%85%B7%E5%88%97%E8%A1%A8%E8%8E%B7%E5%8F%96%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="MCP-å·¥å…·åˆ—è¡¨è·å–æœºåˆ¶"><a href="#MCP-å·¥å…·åˆ—è¡¨è·å–æœºåˆ¶" class="headerlink" title="MCP å·¥å…·åˆ—è¡¨è·å–æœºåˆ¶"></a>MCP å·¥å…·åˆ—è¡¨è·å–æœºåˆ¶</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>MCPï¼ˆModel Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾åè®®ï¼Œæ ‡å‡†åŒ–äº†åº”ç”¨ç¨‹åºå¦‚ä½•å‘å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æä¾›ä¸Šä¸‹æ–‡ï¼Œä½¿ AI åº”ç”¨èƒ½å¤Ÿä»¥ä¸€è‡´çš„æ–¹å¼è¿æ¥å„ç§æ•°æ®æºå’Œå·¥å…·ã€‚</p><p>æœ¬æ–‡é‡ç‚¹è®²è§£ <strong>MCP å·¥å…·åˆ—è¡¨æ˜¯å¦‚ä½•è·å–çš„ï¼Œä»¥åŠè·å–çš„æ—¶æœº</strong>ã€‚</p><h2 id="MCP-åè®®ç”Ÿå‘½å‘¨æœŸ"><a href="#MCP-åè®®ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="MCP åè®®ç”Ÿå‘½å‘¨æœŸ"></a>MCP åè®®ç”Ÿå‘½å‘¨æœŸ</h2><p>MCP å®šä¹‰äº†å®¢æˆ·ç«¯-æœåŠ¡å™¨äº¤äº’çš„ <strong>ä¸‰é˜¶æ®µç”Ÿå‘½å‘¨æœŸ</strong>ï¼š</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs autoit">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ Initialization â”‚ â†’ â”‚  Operation  â”‚ â†’ â”‚  <span class="hljs-built_in">Shutdown</span>   â”‚<br>â”‚   åˆå§‹åŒ–é˜¶æ®µ    â”‚    â”‚   æ“ä½œé˜¶æ®µ   â”‚    â”‚   å…³é—­é˜¶æ®µ   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–é˜¶æ®µè¯¦è§£"><a href="#åˆå§‹åŒ–é˜¶æ®µè¯¦è§£" class="headerlink" title="åˆå§‹åŒ–é˜¶æ®µè¯¦è§£"></a>åˆå§‹åŒ–é˜¶æ®µè¯¦è§£</h2><h3 id="1-å»ºç«‹åº•å±‚è¿æ¥"><a href="#1-å»ºç«‹åº•å±‚è¿æ¥" class="headerlink" title="1. å»ºç«‹åº•å±‚è¿æ¥"></a>1. å»ºç«‹åº•å±‚è¿æ¥</h3><p>é¦–å…ˆå»ºç«‹ä¼ è¾“å±‚è¿æ¥ï¼ŒMCP æ”¯æŒä¸¤ç§ä¼ è¾“æ–¹å¼ï¼š</p><table><thead><tr><th>ä¼ è¾“ç±»å‹</th><th>é€‚ç”¨åœºæ™¯</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong>StdIO</strong></td><td>CLI å·¥å…·ã€æœ¬åœ°è¿›ç¨‹</td><td>é€šè¿‡æ ‡å‡†è¾“å…¥&#x2F;è¾“å‡ºé€šä¿¡</td></tr><tr><td><strong>HTTP</strong></td><td>è¿œç¨‹è®¿é—®ã€Web æœåŠ¡</td><td>æ”¯æŒç½‘ç»œè®¿é—®</td></tr></tbody></table><h3 id="2-åè®®ç‰ˆæœ¬åå•†"><a href="#2-åè®®ç‰ˆæœ¬åå•†" class="headerlink" title="2. åè®®ç‰ˆæœ¬åå•†"></a>2. åè®®ç‰ˆæœ¬åå•†</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// å®¢æˆ·ç«¯å‘é€ initialize è¯·æ±‚</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;initialize&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;params&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;protocolVersion&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2025-06-18&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;clientInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Claude Code&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;capabilities&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;sampling&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;roots&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;listChanged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p><strong>âš ï¸ é‡è¦: ç‰ˆæœ¬åå•†è§„åˆ™</strong></p><ul><li>å®¢æˆ·ç«¯å‘é€å®ƒæ”¯æŒçš„åè®®ç‰ˆæœ¬ï¼ˆé€šå¸¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼‰</li><li>å¦‚æœæœåŠ¡å™¨æ”¯æŒè¯¥ç‰ˆæœ¬ï¼Œåˆ™å“åº”ç›¸åŒç‰ˆæœ¬</li><li>åŒæ–¹å¿…é¡»å°±å•ä¸€ç‰ˆæœ¬è¾¾æˆä¸€è‡´æ‰èƒ½ç»§ç»­ä¼šè¯</li></ul></blockquote><h3 id="3-èƒ½åŠ›åå•†ï¼ˆCapability-Negotiationï¼‰"><a href="#3-èƒ½åŠ›åå•†ï¼ˆCapability-Negotiationï¼‰" class="headerlink" title="3. èƒ½åŠ›åå•†ï¼ˆCapability Negotiationï¼‰"></a>3. èƒ½åŠ›åå•†ï¼ˆCapability Negotiationï¼‰</h3><p>è¿™æ˜¯ MCP åè®®çš„<strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼Œå®ç°äº†åè®®çš„å‰å‘å…¼å®¹ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// æœåŠ¡å™¨å“åº”ï¼Œå£°æ˜è‡ªå·±çš„èƒ½åŠ›</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;result&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;protocolVersion&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2025-06-18&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;serverInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Azure MCP Server&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;capabilities&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;tools&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;listChanged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;resources&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;subscribe&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;listChanged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;prompts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;listChanged&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;logging&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><strong>èƒ½åŠ›ç±»å‹è¯´æ˜</strong>ï¼š</p><table><thead><tr><th>èƒ½åŠ›</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>tools</code></td><td>æœåŠ¡å™¨æä¾›å¯è°ƒç”¨çš„å·¥å…·</td></tr><tr><td><code>resources</code></td><td>æœåŠ¡å™¨æä¾›å¯è¯»å–çš„èµ„æº</td></tr><tr><td><code>prompts</code></td><td>æœåŠ¡å™¨æä¾›é¢„å®šä¹‰çš„æç¤ºæ¨¡æ¿</td></tr><tr><td><code>logging</code></td><td>æ”¯æŒæ—¥å¿—åŠŸèƒ½</td></tr><tr><td><code>listChanged</code></td><td>æ”¯æŒåˆ—è¡¨å˜æ›´é€šçŸ¥</td></tr></tbody></table><h3 id="4-å‘é€-initialized-é€šçŸ¥"><a href="#4-å‘é€-initialized-é€šçŸ¥" class="headerlink" title="4. å‘é€ initialized é€šçŸ¥"></a>4. å‘é€ initialized é€šçŸ¥</h3><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å“åº”åï¼Œå‘é€ <code>initialized</code> é€šçŸ¥ï¼Œ<strong>æ ‡å¿—åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;notifications/initialized&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="å·¥å…·åˆ—è¡¨è·å–æ—¶æœº"><a href="#å·¥å…·åˆ—è¡¨è·å–æ—¶æœº" class="headerlink" title="å·¥å…·åˆ—è¡¨è·å–æ—¶æœº"></a>å·¥å…·åˆ—è¡¨è·å–æ—¶æœº</h2><blockquote><p><strong>âš ï¸ è­¦å‘Š: å…³é”®ç‚¹</strong><br><strong>å·¥å…·åˆ—è¡¨åªèƒ½åœ¨åˆå§‹åŒ–å®Œæˆåè·å–ï¼</strong> åœ¨æ¡æ‰‹å®Œæˆä¹‹å‰ï¼Œä¸å…è®¸å‘é€ <code>tools/list</code> ç­‰åŠŸèƒ½æ€§è¯·æ±‚ã€‚</p></blockquote><h3 id="å®Œæ•´çš„æ—¶åºå›¾"><a href="#å®Œæ•´çš„æ—¶åºå›¾" class="headerlink" title="å®Œæ•´çš„æ—¶åºå›¾"></a>å®Œæ•´çš„æ—¶åºå›¾</h3><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs vbscript">Client                                <span class="hljs-built_in">Server</span><br>   â”‚                                     â”‚<br>   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€ å»ºç«‹è¿æ¥ â”€â”€â”€â”€â”€â”€â”€â”€&gt;        â”‚<br>   â”‚                                     â”‚<br>   â”‚  â”€â”€â”€â”€ initialize <span class="hljs-built_in">request</span> â”€â”€â”€â”€&gt;      â”‚  â‘  å‘é€åˆå§‹åŒ–è¯·æ±‚<br>   â”‚                                     â”‚     (åè®®ç‰ˆæœ¬ + å®¢æˆ·ç«¯èƒ½åŠ›)<br>   â”‚                                     â”‚<br>   â”‚  &lt;â”€â”€â”€ initialize <span class="hljs-built_in">response</span> â”€â”€â”€â”€      â”‚  â‘¡ è¿”å›æœåŠ¡å™¨èƒ½åŠ›<br>   â”‚                                     â”‚     (åŒ…å« tools èƒ½åŠ›å£°æ˜)<br>   â”‚                                     â”‚<br>   â”‚  â”€â”€â”€ initialized notification â”€&gt;    â”‚  â‘¢ ç¡®è®¤åˆå§‹åŒ–å®Œæˆ<br>   â”‚                                     â”‚<br>   â”‚  â•â•â•â•â•â•â•â• ä¼šè¯å°±ç»ª â•â•â•â•â•â•â•â•         â”‚<br>   â”‚                                     â”‚<br>   â”‚  â”€â”€â”€â”€ tools/list <span class="hljs-built_in">request</span> â”€â”€â”€â”€&gt;      â”‚  â‘£ è¯·æ±‚å·¥å…·åˆ—è¡¨<br>   â”‚                                     â”‚<br>   â”‚  &lt;â”€â”€â”€â”€ tools/list <span class="hljs-built_in">response</span> â”€â”€â”€â”€     â”‚  â‘¤ è¿”å›å·¥å…·å®šä¹‰<br>   â”‚                                     â”‚<br></code></pre></td></tr></table></figure><h3 id="tools-list-è¯·æ±‚ä¸å“åº”"><a href="#tools-list-è¯·æ±‚ä¸å“åº”" class="headerlink" title="tools&#x2F;list è¯·æ±‚ä¸å“åº”"></a>tools&#x2F;list è¯·æ±‚ä¸å“åº”</h3><p><strong>è¯·æ±‚</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tools/list&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><strong>å“åº”</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;result&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;tools&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;storage_blob_get&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è·å– Azure Blob å­˜å‚¨å†…å®¹&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;inputSchema&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;object&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;account&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;container&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;required&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;account&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;container&quot;</span><span class="hljs-punctuation">]</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="å·¥å…·åˆ—è¡¨åŠ¨æ€æ›´æ–°"><a href="#å·¥å…·åˆ—è¡¨åŠ¨æ€æ›´æ–°" class="headerlink" title="å·¥å…·åˆ—è¡¨åŠ¨æ€æ›´æ–°"></a>å·¥å…·åˆ—è¡¨åŠ¨æ€æ›´æ–°</h2><p>å¦‚æœæœåŠ¡å™¨å£°æ˜äº† <code>tools: { listChanged: true }</code>ï¼Œåˆ™æ”¯æŒ<strong>å·¥å…·åˆ—è¡¨å˜æ›´é€šçŸ¥</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// æœåŠ¡å™¨ä¸»åŠ¨æ¨é€é€šçŸ¥</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;jsonrpc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;notifications/tools/list_changed&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯æ”¶åˆ°æ­¤é€šçŸ¥åï¼Œåº”é‡æ–°è°ƒç”¨ <code>tools/list</code> è·å–æœ€æ–°çš„å·¥å…·åˆ—è¡¨ã€‚</p><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><h3 id="C-å®ç°ï¼ˆAzure-MCPï¼‰"><a href="#C-å®ç°ï¼ˆAzure-MCPï¼‰" class="headerlink" title="C# å®ç°ï¼ˆAzure MCPï¼‰"></a>C# å®ç°ï¼ˆAzure MCPï¼‰</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// MCP è¿è¡Œæ—¶æ¥å£å®šä¹‰</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IMcpRuntime</span> : <span class="hljs-title">IAsyncDisposable</span><br>&#123;<br>    <span class="hljs-comment">// åˆ—å‡ºæ‰€æœ‰å¯ç”¨å·¥å…·</span><br>    <span class="hljs-function">ValueTask&lt;ListToolsResult&gt; <span class="hljs-title">ListToolsHandler</span>(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-function">        RequestContext&lt;ListToolsRequestParams&gt; request,</span></span><br><span class="hljs-params"><span class="hljs-function">        CancellationToken cancellationToken</span></span><br><span class="hljs-params"><span class="hljs-function">    </span>)</span>;<br><br>    <span class="hljs-comment">// è°ƒç”¨æŒ‡å®šå·¥å…·</span><br>    <span class="hljs-function">ValueTask&lt;CallToolResult&gt; <span class="hljs-title">CallToolHandler</span>(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-function">        RequestContext&lt;CallToolRequestParams&gt; request,</span></span><br><span class="hljs-params"><span class="hljs-function">        CancellationToken cancellationToken</span></span><br><span class="hljs-params"><span class="hljs-function">    </span>)</span>;<br>&#125;<br><br><span class="hljs-comment">// è·å–å·¥å…·åˆ—è¡¨ç¤ºä¾‹</span><br><span class="hljs-keyword">var</span> listToolsResult = <span class="hljs-keyword">await</span> mcpRuntime.ListToolsHandler(request, cancellationToken);<br><span class="hljs-comment">// è¿”å›: å·¥å…·å®šä¹‰åˆ—è¡¨ï¼ŒåŒ…å«åç§°ã€æè¿°ã€å‚æ•°</span><br></code></pre></td></tr></table></figure><h3 id="æœåŠ¡å™¨å¯åŠ¨æ¨¡å¼"><a href="#æœåŠ¡å™¨å¯åŠ¨æ¨¡å¼" class="headerlink" title="æœåŠ¡å™¨å¯åŠ¨æ¨¡å¼"></a>æœåŠ¡å™¨å¯åŠ¨æ¨¡å¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å‘½åç©ºé—´ä»£ç†æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</span><br>azmcp server start --mode namespace --namespaces storage,keyvault<br><br><span class="hljs-comment"># æš´éœ²æ‰€æœ‰å·¥å…·</span><br>azmcp server start --mode all<br><br><span class="hljs-comment"># å•å·¥å…·ä»£ç†æ¨¡å¼</span><br>azmcp server start --mode single --namespace storage<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table><thead><tr><th>é˜¶æ®µ</th><th>æ“ä½œ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è¿æ¥å»ºç«‹</td><td>å»ºç«‹ä¼ è¾“å±‚</td><td>StdIO æˆ– HTTP</td></tr><tr><td>åˆå§‹åŒ–</td><td><code>initialize</code> è¯·æ±‚</td><td>ç‰ˆæœ¬åå•† + èƒ½åŠ›å£°æ˜</td></tr><tr><td>ç¡®è®¤</td><td><code>initialized</code> é€šçŸ¥</td><td>æ¡æ‰‹å®Œæˆ</td></tr><tr><td><strong>å·¥å…·å‘ç°</strong></td><td><code>tools/list</code> è¯·æ±‚</td><td><strong>æ­¤æ—¶æ‰èƒ½è·å–å·¥å…·åˆ—è¡¨</strong></td></tr><tr><td>è¿è¡Œæ—¶</td><td>å·¥å…·è°ƒç”¨ + å˜æ›´ç›‘å¬</td><td>æ”¯æŒåŠ¨æ€æ›´æ–°</td></tr></tbody></table><blockquote><p><strong>ğŸ’¡ æç¤º: è®°å¿†å£è¯€</strong><br><strong>å…ˆæ¡æ‰‹ï¼Œåå–å·¥å…·ï¼›èƒ½åŠ›å…ˆè°ˆï¼ŒåŠŸèƒ½åç”¨</strong></p></blockquote><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>Claude Code Skills è¯¦è§£</li></ul>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
      <category>ç¼–ç¨‹å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AIå·¥å…·</tag>
      
      <tag>MCP</tag>
      
      <tag>åè®®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºç¡€æ¦‚å¿µ</title>
    <link href="/2026/01/21/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    <url>/2026/01/21/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<h1 id="WebRTC-åŸºç¡€æ¦‚å¿µ"><a href="#WebRTC-åŸºç¡€æ¦‚å¿µ" class="headerlink" title="WebRTC åŸºç¡€æ¦‚å¿µ"></a>WebRTC åŸºç¡€æ¦‚å¿µ</h1><h2 id="ä»€ä¹ˆæ˜¯-WebRTCï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-WebRTCï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ WebRTCï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ WebRTCï¼Ÿ</h2><p><strong>WebRTCï¼ˆWeb Real-Time Communicationï¼‰</strong> æ˜¯ä¸€é¡¹å¼€æºæŠ€æœ¯ï¼Œå…è®¸ Web æµè§ˆå™¨å’Œç§»åŠ¨åº”ç”¨è¿›è¡Œ<strong>å®æ—¶é€šä¿¡</strong>ï¼Œæ— éœ€ä¸­ä»‹æœåŠ¡å™¨æˆ–æ’ä»¶ã€‚</p><h3 id="æ ¸å¿ƒå®šä¹‰"><a href="#æ ¸å¿ƒå®šä¹‰" class="headerlink" title="æ ¸å¿ƒå®šä¹‰"></a>æ ¸å¿ƒå®šä¹‰</h3><ul><li><strong>Web</strong> - åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼ŒåŸºäº JavaScript API</li><li><strong>Real-Time</strong> - ä½å»¶è¿Ÿé€šä¿¡ï¼ˆé€šå¸¸åœ¨æ¯«ç§’çº§ï¼‰</li><li><strong>Communication</strong> - æ”¯æŒéŸ³é¢‘ã€è§†é¢‘å’Œä»»æ„æ•°æ®ä¼ è¾“</li></ul><h2 id="ä¸ºä»€ä¹ˆéœ€è¦-WebRTCï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-WebRTCï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ WebRTCï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ WebRTCï¼Ÿ</h2><h3 id="ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜"><a href="#ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜" class="headerlink" title="ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜"></a>ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜</h3><table><thead><tr><th>é—®é¢˜</th><th>å½±å“</th></tr></thead><tbody><tr><td>æµè§ˆå™¨æ— æ³•ç›´æ¥è®¿é—®æ‘„åƒå¤´&#x2F;éº¦å…‹é£</td><td>éœ€è¦ç¬¬ä¸‰æ–¹æ’ä»¶ï¼ˆFlashã€ActiveXç­‰ï¼‰</td></tr><tr><td>è·¨åŸŸé€šä¿¡å›°éš¾</td><td>å¿…é¡»é€šè¿‡æœåŠ¡å™¨ä¸­è½¬</td></tr><tr><td>æœåŠ¡å™¨ä¸­è½¬</td><td>å¢åŠ å»¶è¿Ÿã€å¢åŠ æˆæœ¬ã€éš¾ä»¥æ‰©å±•</td></tr><tr><td>ä¿¡æ¯å®‰å…¨</td><td>æ‰€æœ‰æ•°æ®éƒ½ç»è¿‡æœåŠ¡å™¨</td></tr></tbody></table><h3 id="WebRTC-çš„ä¼˜åŠ¿"><a href="#WebRTC-çš„ä¼˜åŠ¿" class="headerlink" title="WebRTC çš„ä¼˜åŠ¿"></a>WebRTC çš„ä¼˜åŠ¿</h3><p>âœ… <strong>åŸç”Ÿæµè§ˆå™¨ API</strong> - æ— éœ€æ’ä»¶ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨æ”¯æŒ<br>âœ… <strong>ç‚¹å¯¹ç‚¹ç›´è¿</strong> - é™ä½å»¶è¿Ÿå’ŒæœåŠ¡å™¨æˆæœ¬<br>âœ… <strong>å†…ç½® NAT ç©¿é€</strong> - è‡ªåŠ¨å¤„ç†é˜²ç«å¢™å’Œå†…ç½‘é—®é¢˜<br>âœ… <strong>ç«¯åˆ°ç«¯åŠ å¯†</strong> - æ•°æ®å®‰å…¨æ€§é«˜<br>âœ… <strong>è·¨å¹³å°</strong> - Chromeã€Firefoxã€Safariã€Edge ç­‰</p><h2 id="WebRTC-æ¶æ„ä¸­çš„æœåŠ¡å™¨è§’è‰²"><a href="#WebRTC-æ¶æ„ä¸­çš„æœåŠ¡å™¨è§’è‰²" class="headerlink" title="WebRTC æ¶æ„ä¸­çš„æœåŠ¡å™¨è§’è‰²"></a>WebRTC æ¶æ„ä¸­çš„æœåŠ¡å™¨è§’è‰²</h2><blockquote><p><strong>âš ï¸ è­¦å‘Š: é‡è¦æ¾„æ¸…</strong><br>WebRTC <strong>ä¸éœ€è¦æœåŠ¡å™¨è½¬å‘åª’ä½“æ•°æ®</strong>ï¼Œä½†<strong>ä»ç„¶éœ€è¦æœåŠ¡å™¨å¤„ç†ä¿¡ä»¤å’Œæ§åˆ¶</strong></p></blockquote><h3 id="æ¶æ„å¯¹æ¯”"><a href="#æ¶æ„å¯¹æ¯”" class="headerlink" title="æ¶æ„å¯¹æ¯”"></a>æ¶æ„å¯¹æ¯”</h3><p><strong>ä¼ ç»Ÿé¡¹ç›®ï¼ˆå¦‚ Java åç«¯è§†é¢‘æœåŠ¡ï¼‰</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css">æµè§ˆå™¨<span class="hljs-selector-tag">A</span> â†’ æœåŠ¡å™¨ â† æµè§ˆå™¨<span class="hljs-selector-tag">B</span><br>          â†“<br>    æ‰€æœ‰æ•°æ®éƒ½è½¬å‘<br>  (éŸ³é¢‘ã€è§†é¢‘ã€æ§åˆ¶éƒ½ç»è¿‡æœåŠ¡å™¨)<br>   æˆæœ¬é«˜ï¼Œå»¶è¿Ÿå¤§ï¼Œæ‰©å±•æ€§å·®<br></code></pre></td></tr></table></figure><p><strong>WebRTC é¡¹ç›®</strong></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css">æµè§ˆå™¨<span class="hljs-selector-tag">A</span> â†â†’ ä¿¡ä»¤æœåŠ¡å™¨ â†â†’ æµè§ˆå™¨<span class="hljs-selector-tag">B</span><br>  â†“                          â†“<br>  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ç›´è¿é€šé“â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>       (ä»…åª’ä½“æ•°æ®ç‚¹å¯¹ç‚¹)<br>    æˆæœ¬ä½ï¼Œå»¶è¿Ÿå°ï¼Œæ‰©å±•æ€§å¥½<br></code></pre></td></tr></table></figure><h3 id="æœåŠ¡å™¨éœ€è¦å¤„ç†çš„å†…å®¹"><a href="#æœåŠ¡å™¨éœ€è¦å¤„ç†çš„å†…å®¹" class="headerlink" title="æœåŠ¡å™¨éœ€è¦å¤„ç†çš„å†…å®¹"></a>æœåŠ¡å™¨éœ€è¦å¤„ç†çš„å†…å®¹</h3><table><thead><tr><th>å†…å®¹</th><th>æ˜¯å¦éœ€è¦æœåŠ¡å™¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>éŸ³è§†é¢‘æ•°æ®</strong></td><td>âŒ ä¸éœ€è¦</td><td>ç›´æ¥ç‚¹å¯¹ç‚¹ä¼ è¾“</td></tr><tr><td><strong>Offer&#x2F;Answer</strong></td><td>âœ… éœ€è¦</td><td>è¿æ¥åå•†ä¿¡æ¯éœ€è¦ä¸­ä»‹è½¬å‘</td></tr><tr><td><strong>ICE å€™é€‰</strong></td><td>âœ… éœ€è¦</td><td>ç½‘ç»œåœ°å€ä¿¡æ¯éœ€è¦äº¤æ¢</td></tr><tr><td><strong>ç”¨æˆ·è®¤è¯</strong></td><td>âœ… éœ€è¦</td><td>éªŒè¯ç”¨æˆ·èº«ä»½</td></tr><tr><td><strong>åœ¨çº¿çŠ¶æ€</strong></td><td>âœ… éœ€è¦</td><td>ç»´æŠ¤ç”¨æˆ·åˆ—è¡¨ã€æˆ¿é—´çŠ¶æ€</td></tr><tr><td><strong>æƒé™æ§åˆ¶</strong></td><td>âœ… éœ€è¦</td><td>è°å¯ä»¥å’Œè°é€šè¯</td></tr><tr><td><strong>æ—¥å¿—è®°å½•</strong></td><td>âœ… éœ€è¦</td><td>é€šè¯è®°å½•ã€é—®é¢˜è¯Šæ–­</td></tr><tr><td><strong>å½•åˆ¶&#x2F;è½¬ç </strong></td><td>âš ï¸ å¯é€‰</td><td>éœ€è¦æ—¶æ‰æ¥æ”¶å¹¶å¤„ç†åª’ä½“</td></tr></tbody></table><h3 id="å®Œæ•´çš„-WebRTC-é¡¹ç›®æ¶æ„"><a href="#å®Œæ•´çš„-WebRTC-é¡¹ç›®æ¶æ„" class="headerlink" title="å®Œæ•´çš„ WebRTC é¡¹ç›®æ¶æ„"></a>å®Œæ•´çš„ WebRTC é¡¹ç›®æ¶æ„</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs awk">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ å‰ç«¯åº”ç”¨ï¼ˆæµè§ˆå™¨ï¼‰               â”‚<br>â”‚ - HTML<span class="hljs-regexp">/CSS/</span>JavaScript            â”‚<br>â”‚ - WebRTC API è°ƒç”¨                â”‚<br>â”‚ - ç”¨æˆ·ç•Œé¢                       â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>         â†• WebSocket/HTTP<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ åç«¯æœåŠ¡å™¨ï¼ˆJava<span class="hljs-regexp">/Node.js/</span>Go/Pythonç­‰ï¼‰               â”‚<br>â”‚                                                     â”‚<br>â”‚ æ ¸å¿ƒæ¨¡å—ï¼š                                          â”‚<br>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚<br>â”‚ â”‚ <span class="hljs-number">1</span>. ç”¨æˆ·ç®¡ç†                            â”‚         â”‚<br>â”‚ â”‚    - ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€è®¤è¯              â”‚         â”‚<br>â”‚ â”‚    - åœ¨çº¿çŠ¶æ€ç»´æŠ¤                      â”‚         â”‚<br>â”‚ â”‚    - å¥½å‹åˆ—è¡¨ç®¡ç†                      â”‚         â”‚<br>â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚<br>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚<br>â”‚ â”‚ <span class="hljs-number">2</span>. ä¿¡ä»¤æ§åˆ¶                            â”‚         â”‚<br>â”‚ â”‚    - Offer/Answer è½¬å‘                 â”‚         â”‚<br>â”‚ â”‚    - ICE å€™é€‰äº¤æ¢                      â”‚         â”‚<br>â”‚ â”‚    - è¿æ¥çŠ¶æ€ç®¡ç†                      â”‚         â”‚<br>â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚<br>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚<br>â”‚ â”‚ <span class="hljs-number">3</span>. æˆ¿é—´/ä¼šè®®ç®¡ç†                       â”‚         â”‚<br>â”‚ â”‚    - åˆ›å»º<span class="hljs-regexp">/åŠ å…¥/</span>ç¦»å¼€æˆ¿é—´                â”‚         â”‚<br>â”‚ â”‚    - å‚ä¸è€…ç®¡ç†                        â”‚         â”‚<br>â”‚ â”‚    - æƒé™æ§åˆ¶ï¼ˆè°èƒ½è¯´è¯ã€å…±äº«ç­‰ï¼‰      â”‚         â”‚<br>â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚<br>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚<br>â”‚ â”‚ <span class="hljs-number">4</span>. ä¸šåŠ¡é€»è¾‘                            â”‚         â”‚<br>â”‚ â”‚    - è®¡è´¹/ç»Ÿè®¡                         â”‚         â”‚<br>â”‚ â”‚    - å†…å®¹å®¡æ ¸                          â”‚         â”‚<br>â”‚ â”‚    - å¼‚å¸¸å¤„ç†ã€å¿ƒè·³æ£€æµ‹                â”‚         â”‚<br>â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚<br>â”‚                                                     â”‚<br>â”‚ å¯é€‰æ¨¡å—ï¼š                                          â”‚<br>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚<br>â”‚ â”‚ <span class="hljs-number">5</span>. åª’ä½“å¤„ç†                            â”‚         â”‚<br>â”‚ â”‚    - å½•åˆ¶åª’ä½“æµ                        â”‚         â”‚<br>â”‚ â”‚    - è½¬ç å¤„ç†                          â”‚         â”‚<br>â”‚ â”‚    - AI åˆ†æï¼ˆäººè„¸è¯†åˆ«ç­‰ï¼‰             â”‚         â”‚<br>â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚<br>â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚<br>â”‚ â”‚ <span class="hljs-number">6</span>. NAT ç©¿é€è¾…åŠ©                        â”‚         â”‚<br>â”‚ â”‚    - STUN æœåŠ¡å™¨                       â”‚         â”‚<br>â”‚ â”‚    - TURN ä¸­ç»§æœåŠ¡å™¨                   â”‚         â”‚<br>â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>         â†• ä»…åœ¨ NAT ç©¿é€å¤±è´¥æ—¶<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ TURN ä¸­ç»§æœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰          â”‚<br>â”‚ - å½“ç›´è¿å¤±è´¥æ—¶ä¸­ç»§åª’ä½“æ•°æ®       â”‚<br>â”‚ - å¸¦å®½æˆæœ¬è¾ƒé«˜                   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="å®é™…ä»£ç ç¤ºä¾‹"><a href="#å®é™…ä»£ç ç¤ºä¾‹" class="headerlink" title="å®é™…ä»£ç ç¤ºä¾‹"></a>å®é™…ä»£ç ç¤ºä¾‹</h3><p><strong>å‰ç«¯ï¼šå‘é€ Offerï¼ˆéœ€è¦ç»è¿‡æœåŠ¡å™¨ï¼‰</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ç”¨æˆ· A åˆ›å»º Offer</span><br><span class="hljs-keyword">const</span> offer = <span class="hljs-keyword">await</span> peerConnection.<span class="hljs-title function_">createOffer</span>();<br><span class="hljs-keyword">await</span> peerConnection.<span class="hljs-title function_">setLocalDescription</span>(offer);<br><br><span class="hljs-comment">// âŒ é”™è¯¯ï¼šä¸èƒ½ç›´æ¥å‘é€</span><br><span class="hljs-comment">// webSocket.send(offer);  // å¯¹ç«¯æ¥æ”¶ä¸åˆ°ï¼</span><br><br><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šé€šè¿‡æœåŠ¡å™¨è½¬å‘</span><br><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/signaling/send-offer&#x27;</span>, &#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>  <span class="hljs-attr">headers</span>: &#123; <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span> &#125;,<br>  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>    <span class="hljs-attr">targetUserId</span>: <span class="hljs-string">&#x27;user-b&#x27;</span>,<br>    <span class="hljs-attr">offer</span>: offer<br>  &#125;)<br>&#125;);<br></code></pre></td></tr></table></figure><p><strong>åç«¯ï¼šå¤„ç† Offerï¼ˆJava ç¤ºä¾‹ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/api/signaling/send-offer&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendOffer</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SignalingRequest req)</span> &#123;<br>    <span class="hljs-comment">// 1ï¸âƒ£ è®¤è¯ç”¨æˆ·</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">sender</span> <span class="hljs-operator">=</span> authService.getCurrentUser();<br>    <span class="hljs-keyword">if</span> (sender == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">&quot;æœªç™»å½•&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 2ï¸âƒ£ éªŒè¯ç›®æ ‡ç”¨æˆ·å­˜åœ¨ä¸”åœ¨çº¿</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">receiver</span> <span class="hljs-operator">=</span> userService.findById(req.getTargetUserId());<br>    <span class="hljs-keyword">if</span> (receiver == <span class="hljs-literal">null</span> || !receiver.isOnline()) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadRequestException</span>(<span class="hljs-string">&quot;ç”¨æˆ·ä¸å­˜åœ¨æˆ–ç¦»çº¿&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 3ï¸âƒ£ æ£€æŸ¥æƒé™ï¼ˆæ˜¯å¦è¢«å±è”½ç­‰ï¼‰</span><br>    <span class="hljs-keyword">if</span> (blockService.isBlocked(sender.getId(), receiver.getId())) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForbiddenException</span>(<span class="hljs-string">&quot;è¯¥ç”¨æˆ·å·²å°†ä½ å±è”½&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 4ï¸âƒ£ è½¬å‘ Offer ç»™å¯¹æ–¹ï¼ˆé€šè¿‡ WebSocketï¼‰</span><br>    <span class="hljs-type">WebSocketMessage</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketMessage</span>()<br>        .setType(<span class="hljs-string">&quot;offer-received&quot;</span>)<br>        .setFrom(sender.getId())<br>        .setData(req.getOffer());<br><br>    webSocketService.sendToUser(receiver.getId(), msg);<br><br>    <span class="hljs-comment">// 5ï¸âƒ£ è®°å½•æ—¥å¿—</span><br>    loggingService.log(<span class="hljs-string">&quot;User &quot;</span> + sender.getId()<br>        + <span class="hljs-string">&quot; sent offer to &quot;</span> + receiver.getId());<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åç«¯ï¼šæ¥æ”¶ Answer å¹¶è½¬å‘</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/api/signaling/send-answer&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendAnswer</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SignalingRequest req)</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">sender</span> <span class="hljs-operator">=</span> authService.getCurrentUser();<br><br>    <span class="hljs-comment">// è½¬å‘ Answer</span><br>    <span class="hljs-type">WebSocketMessage</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketMessage</span>()<br>        .setType(<span class="hljs-string">&quot;answer-received&quot;</span>)<br>        .setFrom(sender.getId())<br>        .setData(req.getAnswer());<br><br>    webSocketService.sendToUser(req.getTargetUserId(), msg);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å‰ç«¯ï¼šæ¥æ”¶ Answer å¹¶å»ºç«‹è¿æ¥</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ç›‘å¬æ¥è‡ªæœåŠ¡å™¨çš„ Answer</span><br>webSocket.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> msg = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);<br><br>    <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;answer-received&#x27;</span>) &#123;<br>        <span class="hljs-comment">// æ”¶åˆ°å¯¹æ–¹çš„ Answer</span><br>        <span class="hljs-keyword">const</span> remoteDescription = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RTCSessionDescription</span>(msg.<span class="hljs-property">data</span>);<br>        <span class="hljs-keyword">await</span> peerConnection.<span class="hljs-title function_">setRemoteDescription</span>(remoteDescription);<br><br>        <span class="hljs-comment">// æ­¤æ—¶åª’ä½“é€šé“å¼€å§‹å»ºç«‹</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Answer received, connection negotiating...&#x27;</span>);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="æˆæœ¬å¯¹æ¯”"><a href="#æˆæœ¬å¯¹æ¯”" class="headerlink" title="æˆæœ¬å¯¹æ¯”"></a>æˆæœ¬å¯¹æ¯”</h3><p><strong>ä¼ ç»Ÿæµåª’ä½“ï¼ˆæœåŠ¡å™¨è½¬å‘æ‰€æœ‰æ•°æ®ï¼‰</strong></p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs excel">å‚ä¸äººæ•°    æœåŠ¡å™¨å¸¦å®½æ¶ˆè€—<br><span class="hljs-number">1</span> å¯¹ <span class="hljs-number">1</span>     <span class="hljs-number">1</span>x åŸºå‡†<br><span class="hljs-number">1</span> å¯¹ <span class="hljs-built_in">N</span>     (<span class="hljs-built_in">N</span>-<span class="hljs-number">1</span>)x åŸºå‡† Ã— é€šè¯äººæ•°<br>           æˆæœ¬å‘ˆæŒ‡æ•°å¢é•¿<br></code></pre></td></tr></table></figure><p><strong>WebRTCï¼ˆåªè½¬å‘ä¿¡ä»¤ï¼‰</strong></p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gml">å‚ä¸äººæ•°    æœåŠ¡å™¨å¸¦å®½æ¶ˆè€—<br><span class="hljs-number">1</span> å¯¹ <span class="hljs-number">1</span>     <span class="hljs-number">0.1</span><span class="hljs-variable language_">x</span> åŸºå‡†ï¼ˆåªæœ‰ä¿¡ä»¤ï¼‰<br><span class="hljs-number">1</span> å¯¹ N     <span class="hljs-number">0.1</span><span class="hljs-variable language_">x</span> åŸºå‡†ï¼ˆå‡ ä¹ä¸å¢åŠ ï¼‰<br>           æˆæœ¬åŸºæœ¬ä¿æŒä¸å˜<br></code></pre></td></tr></table></figure><h3 id="å…³é”®ç»“è®º"><a href="#å…³é”®ç»“è®º" class="headerlink" title="å…³é”®ç»“è®º"></a>å…³é”®ç»“è®º</h3><p>âœ… WebRTC <strong>å¤§å¹…é™ä½</strong>äº†æœåŠ¡å™¨çš„<strong>æ•°æ®å¤„ç†è´Ÿæ‹…</strong><br>âŒ WebRTC <strong>ä¸èƒ½æ¶ˆé™¤</strong>å¯¹æœåŠ¡å™¨çš„<strong>éœ€æ±‚</strong><br>âš ï¸ æœåŠ¡å™¨è§’è‰²ä»â€<strong>åª’ä½“ä¸­è½¬è€…</strong>â€œå˜ä¸ºâ€<strong>æ§åˆ¶åè°ƒè€…</strong>â€œ</p><h2 id="ä¸»è¦åº”ç”¨åœºæ™¯"><a href="#ä¸»è¦åº”ç”¨åœºæ™¯" class="headerlink" title="ä¸»è¦åº”ç”¨åœºæ™¯"></a>ä¸»è¦åº”ç”¨åœºæ™¯</h2><table><thead><tr><th>åœºæ™¯</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>ğŸ“¹ <strong>è§†é¢‘ä¼šè®®</strong></td><td>Zoomã€Google Meetã€Teams</td></tr><tr><td>ğŸ’¬ <strong>å®æ—¶é€šè®¯</strong></td><td>è¯­éŸ³é€šè¯ã€æ–‡å­—èŠå¤©</td></tr><tr><td>ğŸ® <strong>å¤šäººæ¸¸æˆ</strong></td><td>ä½å»¶è¿Ÿçš„å®æ—¶äº¤äº’</td></tr><tr><td>ğŸ“º <strong>ç›´æ’­</strong></td><td>ä½å»¶è¿Ÿçš„åª’ä½“æµä¼ è¾“</td></tr><tr><td>ğŸ”„ <strong>æ–‡ä»¶å…±äº«</strong></td><td>ç‚¹å¯¹ç‚¹æ–‡ä»¶ä¼ è¾“</td></tr><tr><td>ğŸ“Š <strong>å±å¹•å…±äº«</strong></td><td>åä½œå·¥å…·ä¸­çš„å±å¹•æ¼”ç¤º</td></tr><tr><td>ğŸ¤– <strong>IoT é€šä¿¡</strong></td><td>è®¾å¤‡é—´çš„å®æ—¶æ•°æ®äº¤äº’</td></tr></tbody></table><h2 id="WebRTC-çš„ä¸‰å¤§æŠ€æœ¯æ”¯æŸ±"><a href="#WebRTC-çš„ä¸‰å¤§æŠ€æœ¯æ”¯æŸ±" class="headerlink" title="WebRTC çš„ä¸‰å¤§æŠ€æœ¯æ”¯æŸ±"></a>WebRTC çš„ä¸‰å¤§æŠ€æœ¯æ”¯æŸ±</h2><h3 id="1-MediaStream-è·å–åª’ä½“"><a href="#1-MediaStream-è·å–åª’ä½“" class="headerlink" title="1. MediaStream - è·å–åª’ä½“"></a>1. MediaStream - è·å–åª’ä½“</h3><blockquote><p><strong>â„¹ï¸ ä¿¡æ¯: ä½œç”¨</strong><br>è·å–æœ¬åœ°æ‘„åƒå¤´ã€éº¦å…‹é£ç­‰è®¾å¤‡çš„åª’ä½“æµ</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// è·å–æ‘„åƒå¤´å’Œéº¦å…‹é£</span><br><span class="hljs-keyword">const</span> stream = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">getUserMedia</span>(&#123;<br>  <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">video</span>: <span class="hljs-literal">true</span><br>&#125;);<br><br><span class="hljs-comment">// åœ¨è§†é¢‘å…ƒç´ ä¸­å±•ç¤º</span><br>videoElement.<span class="hljs-property">srcObject</span> = stream;<br></code></pre></td></tr></table></figure><h3 id="2-RTCPeerConnection-å»ºç«‹è¿æ¥"><a href="#2-RTCPeerConnection-å»ºç«‹è¿æ¥" class="headerlink" title="2. RTCPeerConnection - å»ºç«‹è¿æ¥"></a>2. RTCPeerConnection - å»ºç«‹è¿æ¥</h3><blockquote><p><strong>â„¹ï¸ ä¿¡æ¯: ä½œç”¨</strong><br>åœ¨ä¸¤ä¸ªæµè§ˆå™¨é—´å»ºç«‹ç‚¹å¯¹ç‚¹çš„åª’ä½“è¿æ¥</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// åˆ›å»ºå¯¹ç­‰è¿æ¥</span><br><span class="hljs-keyword">const</span> peerConnection = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RTCPeerConnection</span>(&#123;<br>  <span class="hljs-attr">iceServers</span>: [&#123; <span class="hljs-attr">urls</span>: [<span class="hljs-string">&#x27;stun:stun.l.google.com:19302&#x27;</span>] &#125;]<br>&#125;);<br><br><span class="hljs-comment">// æ·»åŠ åª’ä½“æµ</span><br>stream.<span class="hljs-title function_">getTracks</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">track</span> =&gt;</span> &#123;<br>  peerConnection.<span class="hljs-title function_">addTrack</span>(track, stream);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="3-RTCDataChannel-ä¼ è¾“æ•°æ®"><a href="#3-RTCDataChannel-ä¼ è¾“æ•°æ®" class="headerlink" title="3. RTCDataChannel - ä¼ è¾“æ•°æ®"></a>3. RTCDataChannel - ä¼ è¾“æ•°æ®</h3><blockquote><p><strong>â„¹ï¸ ä¿¡æ¯: ä½œç”¨</strong><br>å»ºç«‹æ•°æ®é€šé“ï¼Œä¼ è¾“ä»»æ„ç±»å‹æ•°æ®ï¼ˆä¸ä»…ä»…æ˜¯åª’ä½“ï¼‰</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// åˆ›å»ºæ•°æ®é€šé“</span><br><span class="hljs-keyword">const</span> dataChannel = peerConnection.<span class="hljs-title function_">createDataChannel</span>(<span class="hljs-string">&#x27;chat&#x27;</span>);<br><br><span class="hljs-comment">// å‘é€æ•°æ®</span><br>dataChannel.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Hello, WebRTC!&#x27;</span>);<br><br><span class="hljs-comment">// æ¥æ”¶æ•°æ®</span><br>dataChannel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Received:&#x27;</span>, event.<span class="hljs-property">data</span>);<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="WebRTC-çš„å·¥ä½œæµç¨‹"><a href="#WebRTC-çš„å·¥ä½œæµç¨‹" class="headerlink" title="WebRTC çš„å·¥ä½œæµç¨‹"></a>WebRTC çš„å·¥ä½œæµç¨‹</h2><h3 id="ç®€åŒ–æµç¨‹å›¾"><a href="#ç®€åŒ–æµç¨‹å›¾" class="headerlink" title="ç®€åŒ–æµç¨‹å›¾"></a>ç®€åŒ–æµç¨‹å›¾</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-number">1</span>. è·å–åª’ä½“æµ                                            â”‚<br>â”‚    â†“                                                    â”‚<br>â”‚    navigator<span class="hljs-selector-class">.mediaDevices</span><span class="hljs-selector-class">.getUserMedia</span>()               â”‚<br>â”‚    (è·å–æ‘„åƒå¤´/éº¦å…‹é£)                                   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                        â†“<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-number">2</span>. åˆ›å»ºå¯¹ç­‰è¿æ¥                                          â”‚<br>â”‚    â†“                                                    â”‚<br>â”‚    new <span class="hljs-built_in">RTCPeerConnection</span>()                             â”‚<br>â”‚    (å»ºç«‹è¿æ¥å¯¹è±¡ï¼Œé…ç½® ICE æœåŠ¡å™¨)                      â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                        â†“<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-number">3</span>. äº¤æ¢ä¼šè¯ä¿¡æ¯ï¼ˆé€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨ï¼‰                        â”‚<br>â”‚    â†“                                                    â”‚<br>â”‚    Offer (ä¸»åŠ¨æ–¹) â†” Answer (è¢«åŠ¨æ–¹)                     â”‚<br>â”‚    (SDP åè®®æè¿°åª’ä½“èƒ½åŠ›)                                â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                        â†“<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-number">4</span>. äº¤æ¢ ICE å€™é€‰                                        â”‚<br>â”‚    â†“                                                    â”‚<br>â”‚    peerConnection<span class="hljs-selector-class">.onicecandidate</span>                       â”‚<br>â”‚    (å‘ç°ç½‘ç»œåœ°å€ï¼Œå¯»æ‰¾å¯é€šè·¯å¾„)                          â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                        â†“<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-number">5</span>. å»ºç«‹ç›´è¿é€šé“                                          â”‚<br>â”‚    â†“                                                    â”‚<br>â”‚    è¿æ¥çŠ¶æ€: new â†’ checking â†’ connected â†’ completed    â”‚<br>â”‚    (ä½¿ç”¨ RTP/SRTP ä¼ è¾“åª’ä½“)                            â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                        â†“<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-number">6</span>. å®æ—¶æ•°æ®æµåŠ¨                                          â”‚<br>â”‚    â†“                                                    â”‚<br>â”‚    éŸ³é¢‘/è§†é¢‘/æ•°æ® â†’ å¯¹ç«¯æµè§ˆå™¨                          â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="è¯¦ç»†æ­¥éª¤è¯´æ˜"><a href="#è¯¦ç»†æ­¥éª¤è¯´æ˜" class="headerlink" title="è¯¦ç»†æ­¥éª¤è¯´æ˜"></a>è¯¦ç»†æ­¥éª¤è¯´æ˜</h3><ol><li><strong>åª’ä½“é‡‡é›†</strong> - è·å–æœ¬åœ°æ‘„åƒå¤´å’Œéº¦å…‹é£</li><li><strong>è¿æ¥åˆ›å»º</strong> - å®ä¾‹åŒ– RTCPeerConnection</li><li><strong>èƒ½åŠ›åå•†</strong> - ä¸»åŠ¨æ–¹ç”Ÿæˆ Offerï¼Œè¢«åŠ¨æ–¹ç”Ÿæˆ Answerï¼ˆæè¿°æ”¯æŒçš„ç¼–ç æ ¼å¼ç­‰ï¼‰</li><li><strong>åœ°å€å‘ç°</strong> - ICE æ”¶é›†æ‰€æœ‰å¯ç”¨çš„ç½‘ç»œåœ°å€ç»„åˆ</li><li><strong>è¿æ¥å»ºç«‹</strong> - åŒæ–¹å°è¯•å¯ç”¨åœ°å€ï¼Œå»ºç«‹æœ€ä¼˜è·¯å¾„</li><li><strong>æ•°æ®ä¼ è¾“</strong> - é€šè¿‡ç›´è¿é€šé“å®æ—¶ä¼ è¾“åª’ä½“</li></ol><h2 id="æ ¸å¿ƒæ¦‚å¿µè§£é‡Š"><a href="#æ ¸å¿ƒæ¦‚å¿µè§£é‡Š" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µè§£é‡Š"></a>æ ¸å¿ƒæ¦‚å¿µè§£é‡Š</h2><h3 id="SDPï¼ˆä¼šè¯æè¿°åè®®ï¼‰"><a href="#SDPï¼ˆä¼šè¯æè¿°åè®®ï¼‰" class="headerlink" title="SDPï¼ˆä¼šè¯æè¿°åè®®ï¼‰"></a>SDPï¼ˆä¼šè¯æè¿°åè®®ï¼‰</h3><blockquote><p><strong>ğŸ“ æ³¨æ„: å®šä¹‰</strong><br>SDP æ˜¯æè¿°å¤šåª’ä½“ä¼šè¯çš„åè®®ï¼Œç”¨äºåŒæ–¹äº¤æ¢åª’ä½“èƒ½åŠ›ä¿¡æ¯</p></blockquote><p><strong>åŒ…å«ä¿¡æ¯</strong>ï¼š</p><ul><li>æ”¯æŒçš„åª’ä½“ç±»å‹ï¼ˆéŸ³é¢‘ã€è§†é¢‘ï¼‰</li><li>æ”¯æŒçš„ç¼–ç æ ¼å¼ï¼ˆH.264ã€VP8 ç­‰ï¼‰</li><li>æ”¯æŒçš„ç ç‡ã€åˆ†è¾¨ç‡ç­‰å‚æ•°</li><li>ç½‘ç»œä¼ è¾“ä¿¡æ¯ï¼ˆç«¯å£ã€åè®®ç­‰ï¼‰</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">v</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">o</span>=alice <span class="hljs-number">2890844526</span> <span class="hljs-number">2890844527</span> IN IP4 host.atlanta.com<br><span class="hljs-attr">s</span>=Session SDP<br><span class="hljs-attr">c</span>=IN IP4 host.atlanta.com<br><span class="hljs-attr">t</span>=<span class="hljs-number">0</span> <span class="hljs-number">0</span><br><span class="hljs-attr">m</span>=audio <span class="hljs-number">49172</span> RTP/AVP <span class="hljs-number">0</span><br><span class="hljs-attr">a</span>=rtpmap:<span class="hljs-number">0</span> PCMU/<span class="hljs-number">8000</span><br><span class="hljs-attr">m</span>=video <span class="hljs-number">49170</span> RTP/AVP <span class="hljs-number">31</span><br><span class="hljs-attr">a</span>=rtpmap:<span class="hljs-number">31</span> H261/<span class="hljs-number">90000</span><br></code></pre></td></tr></table></figure><h3 id="ICEï¼ˆäº¤äº’å¼è¿æ¥å»ºç«‹ï¼‰"><a href="#ICEï¼ˆäº¤äº’å¼è¿æ¥å»ºç«‹ï¼‰" class="headerlink" title="ICEï¼ˆäº¤äº’å¼è¿æ¥å»ºç«‹ï¼‰"></a>ICEï¼ˆäº¤äº’å¼è¿æ¥å»ºç«‹ï¼‰</h3><blockquote><p><strong>ğŸ“ æ³¨æ„: å®šä¹‰</strong><br>ICE æ˜¯ä¸€ç§åè®®æŠ€æœ¯ï¼Œç”¨äºå‘ç°é€šä¿¡åŒæ–¹ä¹‹é—´å¯ç”¨çš„ç½‘ç»œè·¯å¾„</p></blockquote><p><strong>è§£å†³çš„é—®é¢˜</strong>ï¼š</p><ul><li>æµè§ˆå™¨ä½äº NAT&#x2F;é˜²ç«å¢™å</li><li>æ— æ³•ç›´æ¥è¢«å¤–ç½‘è®¿é—®</li><li>éœ€è¦æ‰¾åˆ°èƒ½äº’é€šçš„åœ°å€ç»„åˆ</li></ul><p><strong>å·¥ä½œæ–¹å¼</strong>ï¼š</p><ol><li>æ”¶é›†æ‰€æœ‰å¯èƒ½çš„å€™é€‰åœ°å€ï¼ˆæœ¬åœ° IPã€å…¬ç½‘ IP ç­‰ï¼‰</li><li>é€šè¿‡ STUN&#x2F;TURN æœåŠ¡å™¨è¾…åŠ©åœ°å€å‘ç°</li><li>åŒæ–¹äº¤æ¢å€™é€‰åœ°å€</li><li>å°è¯•å»ºç«‹è¿æ¥</li><li>ä½¿ç”¨ç¬¬ä¸€æ¡æˆåŠŸçš„è·¯å¾„</li></ol><h3 id="NAT-ç©¿é€"><a href="#NAT-ç©¿é€" class="headerlink" title="NAT ç©¿é€"></a>NAT ç©¿é€</h3><blockquote><p><strong>example: ç¤ºä¾‹åœºæ™¯</strong></p><p><strong>é—®é¢˜</strong>ï¼šå±€åŸŸç½‘å†…çš„è®¾å¤‡æƒ³ä¸äº’è”ç½‘ä¸Šçš„è®¾å¤‡é€šä¿¡</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">å†…ç½‘è®¾å¤‡ <span class="hljs-number">192.168.1.100</span> â†’ NAT è®¾å¤‡ â†’ äº’è”ç½‘<br>        â†‘<br>   æ— æ³•è¢«å¤–ç•Œç›´æ¥è®¿é—®<br></code></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><ul><li><strong>STUN</strong> - å¸®åŠ©è®¾å¤‡å‘ç°è‡ªå·±çš„å…¬ç½‘ IP</li><li><strong>TURN</strong> - å½“ç›´è¿å¤±è´¥æ—¶ï¼Œä½œä¸ºä¸­ç»§æœåŠ¡å™¨è½¬å‘æ•°æ®</li></ul></blockquote><h2 id="ä¼ è¾“åè®®æ ˆ"><a href="#ä¼ è¾“åè®®æ ˆ" class="headerlink" title="ä¼ è¾“åè®®æ ˆ"></a>ä¼ è¾“åè®®æ ˆ</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs isbl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ åº”ç”¨å±‚ - <span class="hljs-variable">JavaScript</span> <span class="hljs-variable">WebRTC</span> <span class="hljs-variable">API</span>          â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚ ç¼–ç å±‚ - <span class="hljs-variable">VP8</span>/<span class="hljs-variable">VP9</span>/<span class="hljs-function"><span class="hljs-title">H264</span>(è§†é¢‘)            â”‚</span><br><span class="hljs-function">â”‚        - <span class="hljs-variable">Opus</span>/<span class="hljs-title">PCM</span>(éŸ³é¢‘)               â”‚</span><br><span class="hljs-function">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="hljs-function">â”‚ ä¼ è¾“å±‚ - <span class="hljs-title">RTP</span>(åª’ä½“æ•°æ®)                  â”‚</span><br><span class="hljs-function">â”‚        - <span class="hljs-title">SRTP</span>(åŠ å¯†åª’ä½“)                â”‚</span><br><span class="hljs-function">â”‚        - <span class="hljs-title">SCTP</span>(æ•°æ®é€šé“)                â”‚</span><br><span class="hljs-function">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="hljs-function">â”‚ å®‰å…¨å±‚ - <span class="hljs-title">DTLS</span>(åŠ å¯†æ¡æ‰‹)                 â”‚</span><br><span class="hljs-function">â”‚        - <span class="hljs-title">SRTP</span>(åª’ä½“åŠ å¯†)                â”‚</span><br><span class="hljs-function">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="hljs-function">â”‚ ç½‘ç»œå±‚ - <span class="hljs-title">UDP</span>(ä¸å¯é ä½†ä½å»¶è¿Ÿ)            â”‚</span><br><span class="hljs-function">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="hljs-function">â”‚ ç‰©ç†å±‚ - ç½‘ç»œä¼ è¾“                       â”‚</span><br><span class="hljs-function">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‰¹ç‚¹</strong>ï¼š</p><ul><li>åŸºäº <strong>UDP</strong>ï¼Œè€Œé TCPï¼ˆä¼˜å…ˆé€Ÿåº¦è€Œéå¯é æ€§ï¼‰</li><li>ä½¿ç”¨ <strong>SRTP</strong> åŠ å¯†åª’ä½“æ•°æ®</li><li>ä½¿ç”¨ <strong>DTLS</strong> åŠ å¯†å¯†é’¥äº¤æ¢</li><li>æ”¯æŒè‡ªé€‚åº”æ¯”ç‰¹ç‡</li></ul><h2 id="å…³é”®ä¼˜åŠ¿æ€»ç»“"><a href="#å…³é”®ä¼˜åŠ¿æ€»ç»“" class="headerlink" title="å…³é”®ä¼˜åŠ¿æ€»ç»“"></a>å…³é”®ä¼˜åŠ¿æ€»ç»“</h2><table><thead><tr><th>æ–¹é¢</th><th>ä¼˜åŠ¿</th></tr></thead><tbody><tr><td><strong>å»¶è¿Ÿ</strong></td><td>æ¯«ç§’çº§ï¼Œè¿œä½äºæœåŠ¡å™¨ä¸­è½¬</td></tr><tr><td><strong>æˆæœ¬</strong></td><td>å‡å°‘æœåŠ¡å™¨å¸¦å®½å‹åŠ›</td></tr><tr><td><strong>å®‰å…¨</strong></td><td>ç«¯åˆ°ç«¯åŠ å¯†ï¼Œæ•°æ®ä¸è¿‡æœåŠ¡å™¨</td></tr><tr><td><strong>å¯ç”¨æ€§</strong></td><td>è‡ªåŠ¨ç©¿è¶Š NAT å’Œé˜²ç«å¢™</td></tr><tr><td><strong>æ ‡å‡†åŒ–</strong></td><td>å¼€æ”¾æ ‡å‡†ï¼Œæ‰€æœ‰æµè§ˆå™¨ç»Ÿä¸€å®ç°</td></tr><tr><td><strong>æ˜“ç”¨æ€§</strong></td><td>JavaScript API ç®€æ´æ˜“ç”¨</td></tr></tbody></table><h2 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h2><p>âš ï¸ <strong>ä¿¡ä»¤æœåŠ¡å™¨ä»éœ€è¦</strong> - è™½ç„¶åª’ä½“ç‚¹å¯¹ç‚¹ï¼Œä½†æ§åˆ¶ä¿¡æ¯ä»éœ€æœåŠ¡å™¨ä¸­è½¬ï¼ˆé€šå¸¸ç”¨ WebSocketï¼‰<br>âš ï¸ <strong>TURN æœåŠ¡å™¨æˆæœ¬</strong> - NAT ç©¿é€å¤±è´¥æ—¶éœ€è¦ TURN ä¸­ç»§ï¼Œäº§ç”Ÿé¢å¤–æˆæœ¬<br>âš ï¸ <strong>æµè§ˆå™¨å…¼å®¹æ€§</strong> - æŸäº›æ—§æµè§ˆå™¨ä¸æ”¯æŒ<br>âš ï¸ <strong>å­¦ä¹ æ›²çº¿</strong> - æ¦‚å¿µä¼—å¤šï¼ˆSDPã€ICEã€STUN&#x2F;TURNï¼‰ï¼Œåˆå­¦è€…éœ€è¦ç†è§£</p><h2 id="ä¸‹ä¸€æ­¥å­¦ä¹ "><a href="#ä¸‹ä¸€æ­¥å­¦ä¹ " class="headerlink" title="ä¸‹ä¸€æ­¥å­¦ä¹ "></a>ä¸‹ä¸€æ­¥å­¦ä¹ </h2><ul><li>MediaStream&#x2F;RTCPeerConnection&#x2F;RTCDataChannel API - æ·±å…¥ API ä½¿ç”¨</li><li>ä¿¡ä»¤æœåŠ¡å™¨å®ç° - å­¦ä¹ å¦‚ä½•äº¤æ¢è¿æ¥ä¿¡æ¯</li><li>ICE&#x2F;STUN&#x2F;TURN - ç†è§£ç½‘ç»œç©¿é€åŸç†</li><li>RTP&#x2F;SRTP&#x2F;åª’ä½“ç¼–ç  - äº†è§£åª’ä½“ä¼ è¾“ç»†èŠ‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
      <category>WebRTC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WebRTC</tag>
      
      <tag>å®æ—¶é€šä¿¡</tag>
      
      <tag>å‰ç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jacksonä¾èµ–è¯¦è§£</title>
    <link href="/2026/01/15/Jackson%E4%BE%9D%E8%B5%96%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/15/Jackson%E4%BE%9D%E8%B5%96%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Jackson-ä¾èµ–è¯¦è§£"><a href="#Jackson-ä¾èµ–è¯¦è§£" class="headerlink" title="Jackson ä¾èµ–è¯¦è§£"></a>Jackson ä¾èµ–è¯¦è§£</h1><p>Jackson æ˜¯ Java ç”Ÿæ€ä¸­æœ€æµè¡Œçš„ JSON å¤„ç†åº“ï¼Œç”±å¤šä¸ªæ¨¡å—ç»„æˆã€‚æœ¬æ–‡è¯¦ç»†ä»‹ç»å„ä¸ªä¾èµ–çš„ä½œç”¨ã€‚</p><h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><p>Jackson é‡‡ç”¨<strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼Œåˆ†ä¸ºä¸‰å±‚ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                   æ•°æ®æ ¼å¼æ¨¡å—                        â”‚<br>â”‚  (<span class="hljs-keyword">jackson-dataformat-xml, </span>yaml, csv, properties...) â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚                   æ•°æ®ç»‘å®šå±‚                          â”‚<br>â”‚              (<span class="hljs-keyword">jackson-databind) </span>                     â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚                    æ ¸å¿ƒå±‚                            â”‚<br>â”‚      (<span class="hljs-keyword">jackson-core </span>+ <span class="hljs-keyword">jackson-annotations) </span>          â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><hr><h2 id="æ ¸å¿ƒæ¨¡å—ï¼ˆå¿…éœ€ï¼‰"><a href="#æ ¸å¿ƒæ¨¡å—ï¼ˆå¿…éœ€ï¼‰" class="headerlink" title="æ ¸å¿ƒæ¨¡å—ï¼ˆå¿…éœ€ï¼‰"></a>æ ¸å¿ƒæ¨¡å—ï¼ˆå¿…éœ€ï¼‰</h2><h3 id="1-jackson-core"><a href="#1-jackson-core" class="headerlink" title="1. jackson-core"></a>1. jackson-core</h3><p><strong>ä½œç”¨</strong>ï¼šJackson çš„åŸºç¡€æ¨¡å—ï¼Œæä¾›åº•å±‚æµå¼ APIã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒç±»</strong>ï¼š</p><table><thead><tr><th>ç±»å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>JsonFactory</code></td><td>åˆ›å»ºè§£æå™¨å’Œç”Ÿæˆå™¨çš„å·¥å‚</td></tr><tr><td><code>JsonParser</code></td><td>æµå¼è¯»å– JSONï¼ˆæ‹‰æ¨¡å¼ï¼‰</td></tr><tr><td><code>JsonGenerator</code></td><td>æµå¼å†™å…¥ JSON</td></tr><tr><td><code>JsonToken</code></td><td>JSON ä»¤ç‰Œç±»å‹æšä¸¾</td></tr></tbody></table><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>éœ€è¦æè‡´æ€§èƒ½çš„åœºæ™¯</li><li>å¤„ç†è¶…å¤§ JSON æ–‡ä»¶ï¼ˆæµå¼å¤„ç†ï¼Œå†…å­˜å ç”¨ä½ï¼‰</li><li>è‡ªå®šä¹‰åº•å±‚è§£æé€»è¾‘</li></ul><hr><h3 id="2-jackson-annotations"><a href="#2-jackson-annotations" class="headerlink" title="2. jackson-annotations"></a>2. jackson-annotations</h3><p><strong>ä½œç”¨</strong>ï¼šæä¾›æ³¨è§£å®šä¹‰ï¼Œç”¨äºæ§åˆ¶åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–è¡Œä¸ºã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-annotations<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>å¸¸ç”¨æ³¨è§£</strong>ï¼š</p><table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>@JsonProperty</code></td><td>æŒ‡å®š JSON å­—æ®µå</td></tr><tr><td><code>@JsonIgnore</code></td><td>å¿½ç•¥å­—æ®µ</td></tr><tr><td><code>@JsonFormat</code></td><td>æ ¼å¼åŒ–æ—¥æœŸ&#x2F;æ•°å­—</td></tr><tr><td><code>@JsonInclude</code></td><td>æ§åˆ¶ç©ºå€¼æ˜¯å¦åºåˆ—åŒ–</td></tr><tr><td><code>@JsonCreator</code></td><td>æŒ‡å®šååºåˆ—åŒ–æ„é€ å™¨</td></tr><tr><td><code>@JsonValue</code></td><td>æŒ‡å®šåºåˆ—åŒ–æ—¶ä½¿ç”¨çš„å€¼</td></tr><tr><td><code>@JsonAlias</code></td><td>ååºåˆ—åŒ–æ—¶çš„åˆ«å</td></tr></tbody></table><blockquote><p><strong>ğŸ’¡ æç¤º: æç¤º</strong><br>æ­¤æ¨¡å—æ— ä»»ä½•ä¾èµ–ï¼Œå¯å•ç‹¬ä½¿ç”¨äº DTO å®šä¹‰</p></blockquote><hr><h3 id="3-jackson-databind"><a href="#3-jackson-databind" class="headerlink" title="3. jackson-databind"></a>3. jackson-databind</h3><p><strong>ä½œç”¨</strong>ï¼šæ•°æ®ç»‘å®šæ¨¡å—ï¼Œæä¾› <code>ObjectMapper</code>ï¼Œæ˜¯æœ€å¸¸ç”¨çš„æ¨¡å—ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ä¾èµ–å…³ç³»</strong>ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">jackson-databind</span><br><span class="hljs-keyword"></span>â”œâ”€â”€ <span class="hljs-keyword">jackson-core</span><br><span class="hljs-keyword"></span>â””â”€â”€ <span class="hljs-keyword">jackson-annotations</span><br></code></pre></td></tr></table></figure><blockquote><p><strong>ğŸ“ æ³¨æ„: è¯´æ˜</strong><br>å¼•å…¥ <code>jackson-databind</code> ä¼šè‡ªåŠ¨ä¼ é€’ä¾èµ– <code>jackson-core</code> å’Œ <code>jackson-annotations</code></p></blockquote><p><strong>æ ¸å¿ƒç±»</strong>ï¼š</p><table><thead><tr><th>ç±»å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>ObjectMapper</code></td><td>æ ¸å¿ƒç±»ï¼ŒJSON ä¸å¯¹è±¡äº’è½¬</td></tr><tr><td><code>JsonNode</code></td><td>æ ‘æ¨¡å‹ï¼ŒåŠ¨æ€è§£æ JSON</td></tr><tr><td><code>TypeReference</code></td><td>å¤„ç†æ³›å‹ç±»å‹</td></tr></tbody></table><hr><h2 id="æ•°æ®æ ¼å¼æ¨¡å—"><a href="#æ•°æ®æ ¼å¼æ¨¡å—" class="headerlink" title="æ•°æ®æ ¼å¼æ¨¡å—"></a>æ•°æ®æ ¼å¼æ¨¡å—</h2><p>ç”¨äºæ”¯æŒ JSON ä»¥å¤–çš„æ•°æ®æ ¼å¼ã€‚</p><h3 id="jackson-dataformat-xml"><a href="#jackson-dataformat-xml" class="headerlink" title="jackson-dataformat-xml"></a>jackson-dataformat-xml</h3><p><strong>ä½œç”¨</strong>ï¼šæ”¯æŒ XML æ ¼å¼çš„åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="jackson-dataformat-yaml"><a href="#jackson-dataformat-yaml" class="headerlink" title="jackson-dataformat-yaml"></a>jackson-dataformat-yaml</h3><p><strong>ä½œç”¨</strong>ï¼šæ”¯æŒ YAML æ ¼å¼ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-yaml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="jackson-dataformat-csv"><a href="#jackson-dataformat-csv" class="headerlink" title="jackson-dataformat-csv"></a>jackson-dataformat-csv</h3><p><strong>ä½œç”¨</strong>ï¼šæ”¯æŒ CSV æ ¼å¼ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-csv<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="jackson-dataformat-properties"><a href="#jackson-dataformat-properties" class="headerlink" title="jackson-dataformat-properties"></a>jackson-dataformat-properties</h3><p><strong>ä½œç”¨</strong>ï¼šæ”¯æŒ Java Properties æ ¼å¼ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-dataformat-properties<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h2 id="æ•°æ®ç±»å‹æ¨¡å—"><a href="#æ•°æ®ç±»å‹æ¨¡å—" class="headerlink" title="æ•°æ®ç±»å‹æ¨¡å—"></a>æ•°æ®ç±»å‹æ¨¡å—</h2><p>ç”¨äºæ”¯æŒç‰¹å®š Java ç±»å‹çš„åºåˆ—åŒ–ã€‚</p><h3 id="jackson-datatype-jsr310"><a href="#jackson-datatype-jsr310" class="headerlink" title="jackson-datatype-jsr310"></a>jackson-datatype-jsr310</h3><p><strong>ä½œç”¨</strong>ï¼šæ”¯æŒ Java 8 æ—¥æœŸæ—¶é—´ APIï¼ˆ<code>LocalDate</code>ã€<code>LocalDateTime</code> ç­‰ï¼‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-datatype-jsr310<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>mapper.registerModule(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaTimeModule</span>());<br></code></pre></td></tr></table></figure><blockquote><p><strong>âš ï¸ è­¦å‘Š: æ³¨æ„</strong><br>ä¸æ³¨å†Œæ­¤æ¨¡å—æ—¶ï¼ŒJava 8 æ—¥æœŸç±»å‹ä¼šåºåˆ—åŒ–ä¸ºå¤æ‚å¯¹è±¡è€Œéå­—ç¬¦ä¸²</p></blockquote><h3 id="jackson-datatype-jdk8"><a href="#jackson-datatype-jdk8" class="headerlink" title="jackson-datatype-jdk8"></a>jackson-datatype-jdk8</h3><p><strong>ä½œç”¨</strong>ï¼šæ”¯æŒ Java 8 æ–°ç±»å‹ï¼ˆ<code>Optional</code>ã€<code>Stream</code> ç­‰ï¼‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-datatype-jdk8<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="jackson-datatype-guava"><a href="#jackson-datatype-guava" class="headerlink" title="jackson-datatype-guava"></a>jackson-datatype-guava</h3><p><strong>ä½œç”¨</strong>ï¼šæ”¯æŒ Guava é›†åˆç±»å‹ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-datatype-guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h2 id="æ¡†æ¶é›†æˆæ¨¡å—"><a href="#æ¡†æ¶é›†æˆæ¨¡å—" class="headerlink" title="æ¡†æ¶é›†æˆæ¨¡å—"></a>æ¡†æ¶é›†æˆæ¨¡å—</h2><h3 id="jackson-module-kotlin"><a href="#jackson-module-kotlin" class="headerlink" title="jackson-module-kotlin"></a>jackson-module-kotlin</h3><p><strong>ä½œç”¨</strong>ï¼šKotlin æ”¯æŒï¼Œå¤„ç† data classã€é»˜è®¤å‚æ•°ç­‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.module<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-module-kotlin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="jackson-module-parameter-names"><a href="#jackson-module-parameter-names" class="headerlink" title="jackson-module-parameter-names"></a>jackson-module-parameter-names</h3><p><strong>ä½œç”¨</strong>ï¼šä½¿ç”¨ Java 8 å‚æ•°ååå°„ï¼Œæ— éœ€ <code>@JsonProperty</code>ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.module<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-module-parameter-names<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p><strong>ğŸ“ æ³¨æ„: å‰ææ¡ä»¶</strong><br>éœ€è¦ç¼–è¯‘æ—¶æ·»åŠ  <code>-parameters</code> å‚æ•°</p></blockquote><h3 id="jackson-jaxrs-json-provider"><a href="#jackson-jaxrs-json-provider" class="headerlink" title="jackson-jaxrs-json-provider"></a>jackson-jaxrs-json-provider</h3><p><strong>ä½œç”¨</strong>ï¼šJAX-RSï¼ˆJerseyã€RESTEasyï¼‰é›†æˆã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.jaxrs<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-jaxrs-json-provider<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h2 id="ä¾èµ–æ±‡æ€»è¡¨"><a href="#ä¾èµ–æ±‡æ€»è¡¨" class="headerlink" title="ä¾èµ–æ±‡æ€»è¡¨"></a>ä¾èµ–æ±‡æ€»è¡¨</h2><table><thead><tr><th>æ¨¡å—</th><th>ArtifactId</th><th>ç”¨é€”è¯´æ˜</th></tr></thead><tbody><tr><td>æ ¸å¿ƒ</td><td>jackson-core</td><td>åº•å±‚è§£æå™¨ï¼Œé€å­—ç¬¦è¯»å†™ JSONï¼ˆæ€§èƒ½æœ€ä¼˜ï¼‰</td></tr><tr><td>æ ¸å¿ƒ</td><td>jackson-annotations</td><td>æä¾› @JsonProperty ç­‰æ³¨è§£</td></tr><tr><td>æ ¸å¿ƒ</td><td>jackson-databind</td><td>æä¾› ObjectMapperï¼ŒJSON â†” å¯¹è±¡äº’è½¬</td></tr><tr><td>æ ¼å¼</td><td>jackson-dataformat-xml</td><td>æ”¯æŒ XML æ ¼å¼è¯»å†™</td></tr><tr><td>æ ¼å¼</td><td>jackson-dataformat-yaml</td><td>æ”¯æŒ YAML æ ¼å¼è¯»å†™</td></tr><tr><td>æ ¼å¼</td><td>jackson-dataformat-csv</td><td>æ”¯æŒ CSV æ ¼å¼è¯»å†™</td></tr><tr><td>ç±»å‹</td><td>jackson-datatype-jsr310</td><td>æ”¯æŒ LocalDate&#x2F;LocalDateTime ç­‰</td></tr><tr><td>ç±»å‹</td><td>jackson-datatype-jdk8</td><td>æ”¯æŒ Optional&#x2F;Stream ç­‰</td></tr><tr><td>é›†æˆ</td><td>jackson-module-kotlin</td><td>æ”¯æŒ Kotlin data class</td></tr></tbody></table><hr><h2 id="å¸¸è§ç»„åˆæ¨è"><a href="#å¸¸è§ç»„åˆæ¨è" class="headerlink" title="å¸¸è§ç»„åˆæ¨è"></a>å¸¸è§ç»„åˆæ¨è</h2><h3 id="Spring-Boot-é¡¹ç›®ï¼ˆæ¨èï¼‰"><a href="#Spring-Boot-é¡¹ç›®ï¼ˆæ¨èï¼‰" class="headerlink" title="Spring Boot é¡¹ç›®ï¼ˆæ¨èï¼‰"></a>Spring Boot é¡¹ç›®ï¼ˆæ¨èï¼‰</h3><p>Spring Boot å·²å†…ç½® Jacksonï¼Œé€šå¸¸åªéœ€æ·»åŠ ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- Java 8 æ—¥æœŸæ”¯æŒï¼ˆSpring Boot å·²è‡ªåŠ¨é…ç½®ï¼‰ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-datatype-jsr310<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="æ™®é€š-Java-é¡¹ç›®"><a href="#æ™®é€š-Java-é¡¹ç›®" class="headerlink" title="æ™®é€š Java é¡¹ç›®"></a>æ™®é€š Java é¡¹ç›®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- åŸºç¡€ï¼šæ•°æ®ç»‘å®šï¼ˆè‡ªåŠ¨åŒ…å« core å’Œ annotationsï¼‰ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- Java 8 æ—¥æœŸæ”¯æŒ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-datatype-jsr310<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="Kotlin-é¡¹ç›®"><a href="#Kotlin-é¡¹ç›®" class="headerlink" title="Kotlin é¡¹ç›®"></a>Kotlin é¡¹ç›®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.module<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-module-kotlin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><h3 id="ä½¿ç”¨-BOM-ç»Ÿä¸€ç‰ˆæœ¬"><a href="#ä½¿ç”¨-BOM-ç»Ÿä¸€ç‰ˆæœ¬" class="headerlink" title="ä½¿ç”¨ BOM ç»Ÿä¸€ç‰ˆæœ¬"></a>ä½¿ç”¨ BOM ç»Ÿä¸€ç‰ˆæœ¬</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p><strong>âš ï¸ è­¦å‘Š: ç‰ˆæœ¬ä¸€è‡´æ€§</strong><br>æ‰€æœ‰ Jackson æ¨¡å—å¿…é¡»ä½¿ç”¨ç›¸åŒç‰ˆæœ¬ï¼Œå¦åˆ™å¯èƒ½å‡ºç°å…¼å®¹æ€§é—®é¢˜</p></blockquote><hr><h2 id="æ ¸å¿ƒ-API-è¯¦è§£"><a href="#æ ¸å¿ƒ-API-è¯¦è§£" class="headerlink" title="æ ¸å¿ƒ API è¯¦è§£"></a>æ ¸å¿ƒ API è¯¦è§£</h2><h3 id="ObjectMapper"><a href="#ObjectMapper" class="headerlink" title="ObjectMapper"></a>ObjectMapper</h3><p><code>ObjectMapper</code> æ˜¯ Jackson æœ€æ ¸å¿ƒçš„ç±»ï¼Œè´Ÿè´£ JSON ä¸ Java å¯¹è±¡çš„äº’è½¬ã€‚</p><h4 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br><br><span class="hljs-comment">// å¯¹è±¡ â†’ JSON å­—ç¬¦ä¸²</span><br><span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> mapper.writeValueAsString(user);<br><br><span class="hljs-comment">// JSON å­—ç¬¦ä¸² â†’ å¯¹è±¡</span><br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mapper.readValue(json, User.class);<br><br><span class="hljs-comment">// JSON å­—ç¬¦ä¸² â†’ List</span><br>List&lt;User&gt; users = mapper.readValue(json, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;List&lt;User&gt;&gt;() &#123;&#125;);<br><br><span class="hljs-comment">// JSON å­—ç¬¦ä¸² â†’ Map</span><br>Map&lt;String, Object&gt; map = mapper.readValue(json, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;&gt;() &#123;&#125;);<br></code></pre></td></tr></table></figure><h4 id="æ–‡ä»¶è¯»å†™"><a href="#æ–‡ä»¶è¯»å†™" class="headerlink" title="æ–‡ä»¶è¯»å†™"></a>æ–‡ä»¶è¯»å†™</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å†™å…¥æ–‡ä»¶</span><br>mapper.writeValue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;user.json&quot;</span>), user);<br><br><span class="hljs-comment">// ä»æ–‡ä»¶è¯»å–</span><br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mapper.readValue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;user.json&quot;</span>), User.class);<br><br><span class="hljs-comment">// ä» InputStream è¯»å–</span><br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mapper.readValue(inputStream, User.class);<br><br><span class="hljs-comment">// ä» URL è¯»å–</span><br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> mapper.readValue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://api.example.com/user&quot;</span>), User.class);<br></code></pre></td></tr></table></figure><h4 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br><br><span class="hljs-comment">// æ ¼å¼åŒ–è¾“å‡ºï¼ˆç¾åŒ– JSONï¼‰</span><br>mapper.enable(SerializationFeature.INDENT_OUTPUT);<br><br><span class="hljs-comment">// å¿½ç•¥æœªçŸ¥å­—æ®µï¼ˆååºåˆ—åŒ–æ—¶ï¼‰</span><br>mapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);<br><br><span class="hljs-comment">// ç©ºå¯¹è±¡ä¸æŠ¥é”™</span><br>mapper.disable(SerializationFeature.FAIL_ON_EMPTY_BEANS);<br><br><span class="hljs-comment">// null å€¼ä¸åºåˆ—åŒ–</span><br>mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);<br><br><span class="hljs-comment">// æ—¥æœŸæ ¼å¼åŒ–</span><br>mapper.setDateFormat(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));<br></code></pre></td></tr></table></figure><hr><h3 id="JsonNode-æ ‘æ¨¡å‹"><a href="#JsonNode-æ ‘æ¨¡å‹" class="headerlink" title="JsonNode æ ‘æ¨¡å‹"></a>JsonNode æ ‘æ¨¡å‹</h3><p>å½“ JSON ç»“æ„ä¸å›ºå®šæˆ–åªéœ€è¦éƒ¨åˆ†å­—æ®µæ—¶ï¼Œä½¿ç”¨æ ‘æ¨¡å‹æ›´çµæ´»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è§£æä¸ºæ ‘</span><br><span class="hljs-type">JsonNode</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> mapper.readTree(json);<br><br><span class="hljs-comment">// è·å–å­—æ®µå€¼</span><br><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> root.get(<span class="hljs-string">&quot;name&quot;</span>).asText();<br><span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> root.get(<span class="hljs-string">&quot;age&quot;</span>).asInt();<br><span class="hljs-type">boolean</span> <span class="hljs-variable">active</span> <span class="hljs-operator">=</span> root.get(<span class="hljs-string">&quot;active&quot;</span>).asBoolean();<br><br><span class="hljs-comment">// åµŒå¥—è®¿é—®</span><br><span class="hljs-type">String</span> <span class="hljs-variable">city</span> <span class="hljs-operator">=</span> root.get(<span class="hljs-string">&quot;address&quot;</span>).get(<span class="hljs-string">&quot;city&quot;</span>).asText();<br><br><span class="hljs-comment">// å®‰å…¨è®¿é—®ï¼ˆé¿å… NPEï¼‰</span><br><span class="hljs-type">String</span> <span class="hljs-variable">city</span> <span class="hljs-operator">=</span> root.path(<span class="hljs-string">&quot;address&quot;</span>).path(<span class="hljs-string">&quot;city&quot;</span>).asText(<span class="hljs-string">&quot;é»˜è®¤å€¼&quot;</span>);<br><br><span class="hljs-comment">// éå†æ•°ç»„</span><br><span class="hljs-keyword">for</span> (JsonNode item : root.get(<span class="hljs-string">&quot;items&quot;</span>)) &#123;<br>    System.out.println(item.get(<span class="hljs-string">&quot;id&quot;</span>).asInt());<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><strong>ğŸ’¡ æç¤º: get vs path</strong></p><ul><li><code>get()</code> å­—æ®µä¸å­˜åœ¨æ—¶è¿”å› <code>null</code></li><li><code>path()</code> å­—æ®µä¸å­˜åœ¨æ—¶è¿”å› <code>MissingNode</code>ï¼Œå¯é“¾å¼è°ƒç”¨ä¸ä¼š NPE</li></ul></blockquote><hr><h3 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h3><h4 id="å­—æ®µæ˜ å°„"><a href="#å­—æ®µæ˜ å°„" class="headerlink" title="å­—æ®µæ˜ å°„"></a>å­—æ®µæ˜ å°„</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-meta">@JsonProperty(&quot;user_name&quot;)</span>  <span class="hljs-comment">// JSON å­—æ®µåæ˜ å°„</span><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-meta">@JsonIgnore</span>  <span class="hljs-comment">// å¿½ç•¥æ­¤å­—æ®µ</span><br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-meta">@JsonAlias(&#123;&quot;phone&quot;, &quot;mobile&quot;&#125;)</span>  <span class="hljs-comment">// ååºåˆ—åŒ–æ—¶æ¥å—å¤šä¸ªåç§°</span><br>    <span class="hljs-keyword">private</span> String telephone;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ ¼å¼åŒ–"><a href="#æ ¼å¼åŒ–" class="headerlink" title="æ ¼å¼åŒ–"></a>æ ¼å¼åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> &#123;<br>    <span class="hljs-meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br>    <span class="hljs-meta">@JsonFormat(shape = JsonFormat.Shape.STRING)</span>  <span class="hljs-comment">// æ•°å­—è½¬å­—ç¬¦ä¸²</span><br>    <span class="hljs-keyword">private</span> Long orderId;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç©ºå€¼å¤„ç†"><a href="#ç©ºå€¼å¤„ç†" class="headerlink" title="ç©ºå€¼å¤„ç†"></a>ç©ºå€¼å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span>  <span class="hljs-comment">// ç±»çº§åˆ«ï¼šnull ä¸åºåˆ—åŒ–</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Response</span> &#123;<br><br>    <span class="hljs-meta">@JsonInclude(JsonInclude.Include.NON_EMPTY)</span>  <span class="hljs-comment">// å­—æ®µçº§åˆ«ï¼šç©ºé›†åˆä¸åºåˆ—åŒ–</span><br>    <span class="hljs-keyword">private</span> List&lt;String&gt; tags;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ„é€ å™¨ä¸å·¥å‚æ–¹æ³•"><a href="#æ„é€ å™¨ä¸å·¥å‚æ–¹æ³•" class="headerlink" title="æ„é€ å™¨ä¸å·¥å‚æ–¹æ³•"></a>æ„é€ å™¨ä¸å·¥å‚æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-meta">@JsonCreator</span>  <span class="hljs-comment">// æŒ‡å®šååºåˆ—åŒ–ä½¿ç”¨çš„æ„é€ å™¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(</span><br><span class="hljs-params">        <span class="hljs-meta">@JsonProperty(&quot;name&quot;)</span> String name,</span><br><span class="hljs-params">        <span class="hljs-meta">@JsonProperty(&quot;age&quot;)</span> <span class="hljs-type">int</span> age</span><br><span class="hljs-params">    )</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ³¨è§£æ±‡æ€»"><a href="#æ³¨è§£æ±‡æ€»" class="headerlink" title="æ³¨è§£æ±‡æ€»"></a>æ³¨è§£æ±‡æ€»</h4><table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>@JsonProperty</code></td><td>å­—æ®µåæ˜ å°„</td><td><code>@JsonProperty(&quot;user_name&quot;)</code></td></tr><tr><td><code>@JsonIgnore</code></td><td>å¿½ç•¥å­—æ®µ</td><td>å¯†ç ç­‰æ•æ„Ÿå­—æ®µ</td></tr><tr><td><code>@JsonFormat</code></td><td>æ ¼å¼åŒ–</td><td>æ—¥æœŸã€æ•°å­—æ ¼å¼</td></tr><tr><td><code>@JsonInclude</code></td><td>ç©ºå€¼ç­–ç•¥</td><td>NON_NULLã€NON_EMPTY</td></tr><tr><td><code>@JsonCreator</code></td><td>æ„é€ å™¨</td><td>ä¸å¯å˜å¯¹è±¡</td></tr><tr><td><code>@JsonAlias</code></td><td>åˆ«å</td><td>å…¼å®¹å¤šç§å­—æ®µå</td></tr><tr><td><code>@JsonValue</code></td><td>åºåˆ—åŒ–å€¼</td><td>æšä¸¾è‡ªå®šä¹‰è¾“å‡º</td></tr></tbody></table><hr><h3 id="TypeReference-æ³›å‹å¤„ç†"><a href="#TypeReference-æ³›å‹å¤„ç†" class="headerlink" title="TypeReference æ³›å‹å¤„ç†"></a>TypeReference æ³›å‹å¤„ç†</h3><p>Java æ³›å‹åœ¨è¿è¡Œæ—¶ä¼šè¢«æ“¦é™¤ï¼Œéœ€è¦ <code>TypeReference</code> ä¿ç•™ç±»å‹ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é”™è¯¯ï¼šæ³›å‹è¢«æ“¦é™¤ï¼Œæ— æ³•æ­£ç¡®ååºåˆ—åŒ–</span><br>List&lt;User&gt; users = mapper.readValue(json, List.class);  <span class="hljs-comment">// å¾—åˆ° List&lt;LinkedHashMap&gt;</span><br><br><span class="hljs-comment">// æ­£ç¡®ï¼šä½¿ç”¨ TypeReference</span><br>List&lt;User&gt; users = mapper.readValue(json, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;List&lt;User&gt;&gt;() &#123;&#125;);<br><br><span class="hljs-comment">// åµŒå¥—æ³›å‹</span><br>Map&lt;String, List&lt;User&gt;&gt; data = mapper.readValue(<br>    json,<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeReference</span>&lt;Map&lt;String, List&lt;User&gt;&gt;&gt;() &#123;&#125;<br>);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Jackson</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jackson</tag>
      
      <tag>JSON</tag>
      
      <tag>åºåˆ—åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Claude-Code-Skillsè¯¦è§£</title>
    <link href="/2026/01/14/Claude-Code-Skills%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/14/Claude-Code-Skills%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Claude-Code-Skills-è¯¦è§£"><a href="#Claude-Code-Skills-è¯¦è§£" class="headerlink" title="Claude Code Skills è¯¦è§£"></a>Claude Code Skills è¯¦è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Skills æ˜¯ Claude Code ä¸­çš„<strong>æ¨¡å—åŒ–ã€å¯å‘ç°çš„çŸ¥è¯†å•å…ƒ</strong>ï¼Œç”¨äºæ•™å¯¼ Claude å¦‚ä½•ä»¥å¯é‡å¤çš„æ–¹å¼å®Œæˆç‰¹å®šä»»åŠ¡ã€‚å®ƒä»¬æ˜¯ç‹¬ç«‹çš„è½¯ä»¶åŒ…ï¼ŒåŒ…å«æŒ‡ä»¤ã€å…ƒæ•°æ®å’Œå¯é€‰çš„èµ„æºæ–‡ä»¶ã€‚</p><h3 id="æ ¸å¿ƒç‰¹æ€§"><a href="#æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="æ ¸å¿ƒç‰¹æ€§"></a>æ ¸å¿ƒç‰¹æ€§</h3><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ¨¡å—åŒ–å’Œå¯é‡ç”¨æ€§</td><td>ç‹¬ç«‹çš„è½¯ä»¶åŒ…ï¼Œå¯è·¨é¡¹ç›®é‡å¤ä½¿ç”¨</td></tr><tr><td>è‡ªåŠ¨è°ƒç”¨æœºåˆ¶</td><td>Claude æ ¹æ®ç”¨æˆ·è¯·æ±‚è‡ªåŠ¨åˆ¤æ–­ä½•æ—¶è§¦å‘</td></tr><tr><td>æ¸è¿›å¼æŠ«éœ²</td><td>ä»…é¢„åŠ è½½å…ƒæ•°æ®ï¼ŒæŒ‰éœ€åŠ è½½å®Œæ•´å†…å®¹</td></tr><tr><td>è·¨å¹³å°å…¼å®¹</td><td>æ”¯æŒ Claude.aiã€Claude Code å’Œ API</td></tr><tr><td>å¯æ‰§è¡Œä»£ç æ”¯æŒ</td><td>å¯åŒ…å« Pythonã€Shell ç­‰è„šæœ¬</td></tr></tbody></table><h2 id="Skills-vs-Slash-Commands"><a href="#Skills-vs-Slash-Commands" class="headerlink" title="Skills vs Slash Commands"></a>Skills vs Slash Commands</h2><p>ğŸ‘‰Skillsä¸MCPã€Toolsçš„åŒºåˆ«è¯¦è§£ ^skills-vs-others</p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>Skills</th><th>Slash Commands</th></tr></thead><tbody><tr><td>è§¦å‘æ–¹å¼</td><td><strong>è‡ªåŠ¨è§¦å‘</strong>ï¼ˆåŸºäºè¯­ä¹‰åŒ¹é…ï¼‰</td><td><strong>æ‰‹åŠ¨è§¦å‘</strong>ï¼ˆè¾“å…¥ <code>/command</code>ï¼‰</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å¤æ‚å¤šæ–‡ä»¶å·¥ä½œæµã€ä¸“ä¸šé¢†åŸŸçŸ¥è¯†</td><td>ç®€å•é‡å¤ä»»åŠ¡ã€ç”¨æˆ·è§¦å‘çš„å¿«æ·æ“ä½œ</td></tr><tr><td>é…ç½®æ–‡ä»¶</td><td><code>SKILL.md</code></td><td><code>.claude/commands/*.md</code></td></tr><tr><td>å¤æ‚åº¦</td><td>é«˜ï¼ˆå¯å«è„šæœ¬ã€æ¨¡æ¿ã€èµ„æºï¼‰</td><td>ä½ï¼ˆå•ä¸ª Markdown æ–‡ä»¶ï¼‰</td></tr></tbody></table><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><h3 id="æŠ€èƒ½å­˜å‚¨ä½ç½®"><a href="#æŠ€èƒ½å­˜å‚¨ä½ç½®" class="headerlink" title="æŠ€èƒ½å­˜å‚¨ä½ç½®"></a>æŠ€èƒ½å­˜å‚¨ä½ç½®</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-comment"># ä¸ªäººæŠ€èƒ½ï¼ˆæ‰€æœ‰é¡¹ç›®é€šç”¨ï¼‰</span><br>~<span class="hljs-regexp">/.claude/skills</span><span class="hljs-regexp">/</span><br><span class="hljs-regexp">    â””â”€â”€ my-skill/</span><br>        â””â”€â”€ SKILL.md<br><br><span class="hljs-comment"># é¡¹ç›®æŠ€èƒ½ï¼ˆå›¢é˜Ÿå…±äº«ï¼‰</span><br>&lt;é¡¹ç›®æ ¹ç›®å½•&gt;<span class="hljs-regexp">/.claude/skills</span><span class="hljs-regexp">/</span><br><span class="hljs-regexp">    â””â”€â”€ team-skill/</span><br>        â””â”€â”€ SKILL.md<br></code></pre></td></tr></table></figure><h3 id="æŠ€èƒ½ç›®å½•ç»“æ„"><a href="#æŠ€èƒ½ç›®å½•ç»“æ„" class="headerlink" title="æŠ€èƒ½ç›®å½•ç»“æ„"></a>æŠ€èƒ½ç›®å½•ç»“æ„</h3><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nix">my-skill<span class="hljs-symbol">/</span><br>â”œâ”€â”€ SKILL.md          <span class="hljs-comment"># æ ¸å¿ƒæ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰</span><br>â”œâ”€â”€ reference.md      <span class="hljs-comment"># å‚è€ƒæ–‡æ¡£ï¼ˆå¯é€‰ï¼‰</span><br>â”œâ”€â”€ examples.md       <span class="hljs-comment"># ç¤ºä¾‹é›†åˆï¼ˆå¯é€‰ï¼‰</span><br>â”œâ”€â”€ scripts<span class="hljs-symbol">/</span>          <span class="hljs-comment"># å¯æ‰§è¡Œè„šæœ¬ï¼ˆå¯é€‰ï¼‰</span><br>â”‚   â””â”€â”€ helper.py<br>â””â”€â”€ templates<span class="hljs-symbol">/</span>        <span class="hljs-comment"># æ–‡ä»¶æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰</span><br>    â””â”€â”€ template.txt<br></code></pre></td></tr></table></figure><h2 id="SKILL-md-é…ç½®æ ¼å¼"><a href="#SKILL-md-é…ç½®æ ¼å¼" class="headerlink" title="SKILL.md é…ç½®æ ¼å¼"></a>SKILL.md é…ç½®æ ¼å¼</h2><h3 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">skill-name</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">æŠ€èƒ½æè¿°ï¼ŒClaude</span> <span class="hljs-string">ä¾é æ­¤æè¿°åˆ¤æ–­ä½•æ—¶è§¦å‘</span><br><span class="hljs-attr">allowed-tools:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">Tool1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">Tool2</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># ä»¥ä¸‹æ˜¯ Markdown æ ¼å¼çš„æŒ‡ä»¤å†…å®¹</span><br></code></pre></td></tr></table></figure><h3 id="å¿…éœ€å­—æ®µ"><a href="#å¿…éœ€å­—æ®µ" class="headerlink" title="å¿…éœ€å­—æ®µ"></a>å¿…éœ€å­—æ®µ</h3><table><thead><tr><th>å­—æ®µ</th><th>è¦æ±‚</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>name</code></td><td>æœ€å¤š 64 å­—ç¬¦</td><td>åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦</td></tr><tr><td><code>description</code></td><td>æœ€å¤š 1024 å­—ç¬¦</td><td><strong>æœ€å…³é”®å­—æ®µ</strong>ï¼Œå†³å®šè§¦å‘æ—¶æœº</td></tr></tbody></table><h3 id="Description-ç¼–å†™è¦ç‚¹"><a href="#Description-ç¼–å†™è¦ç‚¹" class="headerlink" title="Description ç¼–å†™è¦ç‚¹"></a>Description ç¼–å†™è¦ç‚¹</h3><p>Description æ˜¯ Claude åˆ¤æ–­æ˜¯å¦è§¦å‘æŠ€èƒ½çš„æ ¸å¿ƒä¾æ®ï¼Œåº”åŒ…å«ï¼š</p><ol><li><strong>åŠŸèƒ½å®šä¹‰</strong> - æŠ€èƒ½åšä»€ä¹ˆ</li><li><strong>é€‚ç”¨åœºæ™¯</strong> - ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨</li><li><strong>è§¦å‘å…³é”®è¯</strong> - ç”¨æˆ·å¯èƒ½ä½¿ç”¨çš„è¯æ±‡</li></ol><blockquote><p><strong>ğŸ’¡ æç¤º: æœ€ä½³å®è·µ</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">å…¬ä¼—å·æ–‡ç« å†™ä½œåŠ©æ‰‹ã€‚æ ¹æ®ç”¨æˆ·æä¾›çš„ä¸»é¢˜ã€å¤§çº²æˆ–å‚è€ƒå†…å®¹ï¼Œ</span><br>  <span class="hljs-string">è‡ªåŠ¨ç”Ÿæˆç¬¦åˆå…¬ä¼—å·é£æ ¼çš„åŸåˆ›æ–‡ç« ã€‚å½“ç”¨æˆ·æåˆ°&quot;å†™å…¬ä¼—å·&quot;&quot;ç”Ÿæˆæ–‡ç« &quot;ç­‰å…³é”®è¯æ—¶è§¦å‘ã€‚</span><br></code></pre></td></tr></table></figure></blockquote><blockquote><p><strong>âš ï¸ è­¦å‘Š: åé¢ç¤ºä¾‹</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">å†™ä½œåŠ©æ‰‹Skill.</span><br></code></pre></td></tr></table></figure><p>è¿‡äºå®½æ³›ï¼ŒClaude éš¾ä»¥åˆ¤æ–­ä½•æ—¶è§¦å‘ã€‚</p></blockquote><h3 id="å¯é€‰å­—æ®µ"><a href="#å¯é€‰å­—æ®µ" class="headerlink" title="å¯é€‰å­—æ®µ"></a>å¯é€‰å­—æ®µ</h3><table><thead><tr><th>å­—æ®µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>allowed-tools</code></td><td>é™åˆ¶å¯ä½¿ç”¨çš„å·¥å…·ï¼ˆå¦‚ <code>Bash</code>ã€<code>Read</code>ã€<code>Grep</code>ï¼‰</td></tr><tr><td><code>user-invocable</code></td><td>æ˜¯å¦æ˜¾ç¤ºåœ¨æ–œæ å‘½ä»¤èœå•ï¼Œé»˜è®¤ <code>true</code></td></tr><tr><td><code>model</code></td><td>æŒ‡å®šä½¿ç”¨çš„ Claude æ¨¡å‹</td></tr><tr><td><code>context</code></td><td>è®¾ä¸º <code>fork</code> æ—¶åœ¨éš”ç¦»å­ä»£ç†ä¸­è¿è¡Œ</td></tr><tr><td><code>agent</code></td><td>ä¸ <code>context: fork</code> é…åˆï¼ŒæŒ‡å®šä»£ç†ç±»å‹</td></tr><tr><td><code>hooks</code></td><td>å®šä¹‰ç”Ÿå‘½å‘¨æœŸé’©å­</td></tr><tr><td><code>dependencies</code></td><td>å£°æ˜ä¾èµ–åŒ…</td></tr></tbody></table><h3 id="å¯é€‰å­—æ®µè¯¦è§£"><a href="#å¯é€‰å­—æ®µè¯¦è§£" class="headerlink" title="å¯é€‰å­—æ®µè¯¦è§£"></a>å¯é€‰å­—æ®µè¯¦è§£</h3><h4 id="allowed-tools-å·¥å…·æƒé™æ§åˆ¶"><a href="#allowed-tools-å·¥å…·æƒé™æ§åˆ¶" class="headerlink" title="allowed-tools - å·¥å…·æƒé™æ§åˆ¶"></a>allowed-tools - å·¥å…·æƒé™æ§åˆ¶</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># æ–¹å¼ä¸€ï¼šé€—å·åˆ†éš”</span><br><span class="hljs-attr">allowed-tools:</span> <span class="hljs-string">Read,</span> <span class="hljs-string">Write,</span> <span class="hljs-string">Bash</span><br><br><span class="hljs-comment"># æ–¹å¼äºŒï¼šYAML åˆ—è¡¨</span><br><span class="hljs-attr">allowed-tools:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">Read</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">Write</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">Bash(python:*)</span>  <span class="hljs-comment"># æ”¯æŒ glob æ¨¡å¼</span><br></code></pre></td></tr></table></figure><h4 id="model-æŒ‡å®šæ¨¡å‹"><a href="#model-æŒ‡å®šæ¨¡å‹" class="headerlink" title="model - æŒ‡å®šæ¨¡å‹"></a>model - æŒ‡å®šæ¨¡å‹</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">model:</span> <span class="hljs-string">claude-sonnet-4-20250514</span><br></code></pre></td></tr></table></figure><p>æœªæŒ‡å®šæ—¶ä½¿ç”¨å½“å‰å¯¹è¯çš„æ´»åŠ¨æ¨¡å‹ã€‚</p><h4 id="context-agent-å­ä»£ç†æ¨¡å¼"><a href="#context-agent-å­ä»£ç†æ¨¡å¼" class="headerlink" title="context + agent - å­ä»£ç†æ¨¡å¼"></a>context + agent - å­ä»£ç†æ¨¡å¼</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">context:</span> <span class="hljs-string">fork</span><br><span class="hljs-attr">agent:</span> <span class="hljs-string">Explore</span>  <span class="hljs-comment"># å¯é€‰: Explore, Plan, general-purpose æˆ–è‡ªå®šä¹‰ä»£ç†</span><br></code></pre></td></tr></table></figure><p>åœ¨éš”ç¦»ç¯å¢ƒä¸­æ‰§è¡Œï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„å¯¹è¯å†å²ã€‚é€‚ç”¨äºéœ€è¦ç‹¬ç«‹ä¸Šä¸‹æ–‡çš„å¤æ‚ä»»åŠ¡ã€‚</p><h4 id="hooks-ç”Ÿå‘½å‘¨æœŸé’©å­"><a href="#hooks-ç”Ÿå‘½å‘¨æœŸé’©å­" class="headerlink" title="hooks - ç”Ÿå‘½å‘¨æœŸé’©å­"></a>hooks - ç”Ÿå‘½å‘¨æœŸé’©å­</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">hooks:</span><br>  <span class="hljs-attr">PreToolUse:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span> <span class="hljs-string">&quot;echo &#x27;Before tool execution&#x27;&quot;</span><br>  <span class="hljs-attr">PostToolUse:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span> <span class="hljs-string">&quot;echo &#x27;After tool execution&#x27;&quot;</span><br>  <span class="hljs-attr">Stop:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">command:</span> <span class="hljs-string">&quot;echo &#x27;Skill completed&#x27;&quot;</span><br></code></pre></td></tr></table></figure><p>æ”¯æŒçš„é’©å­äº‹ä»¶ï¼š</p><ul><li><code>PreToolUse</code> - å·¥å…·æ‰§è¡Œå‰</li><li><code>PostToolUse</code> - å·¥å…·æ‰§è¡Œå</li><li><code>Stop</code> - æŠ€èƒ½å®Œæˆæ—¶</li></ul><h4 id="dependencies-ä¾èµ–å£°æ˜"><a href="#dependencies-ä¾èµ–å£°æ˜" class="headerlink" title="dependencies - ä¾èµ–å£°æ˜"></a>dependencies - ä¾èµ–å£°æ˜</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dependencies:</span> <span class="hljs-string">python&gt;=3.8,</span> <span class="hljs-string">pandas&gt;=1.5.0,</span> <span class="hljs-string">openpyxl</span><br></code></pre></td></tr></table></figure><p>å£°æ˜æŠ€èƒ½æ‰€éœ€çš„è½¯ä»¶åŒ…å’Œç‰ˆæœ¬è¦æ±‚ã€‚</p><h2 id="åˆ›å»ºè‡ªå®šä¹‰-Skill-æ­¥éª¤"><a href="#åˆ›å»ºè‡ªå®šä¹‰-Skill-æ­¥éª¤" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰ Skill æ­¥éª¤"></a>åˆ›å»ºè‡ªå®šä¹‰ Skill æ­¥éª¤</h2><h3 id="æ­¥éª¤-1ï¼šåˆ›å»ºæŠ€èƒ½ç›®å½•"><a href="#æ­¥éª¤-1ï¼šåˆ›å»ºæŠ€èƒ½ç›®å½•" class="headerlink" title="æ­¥éª¤ 1ï¼šåˆ›å»ºæŠ€èƒ½ç›®å½•"></a>æ­¥éª¤ 1ï¼šåˆ›å»ºæŠ€èƒ½ç›®å½•</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä¸ªäººæŠ€èƒ½</span><br><span class="hljs-built_in">mkdir</span> -p ~/.claude/skills/my-reporting-skill<br><br><span class="hljs-comment"># é¡¹ç›®æŠ€èƒ½</span><br><span class="hljs-built_in">mkdir</span> -p .claude/skills/team-reporting-skill<br></code></pre></td></tr></table></figure><h3 id="æ­¥éª¤-2ï¼šåˆ›å»º-SKILL-md"><a href="#æ­¥éª¤-2ï¼šåˆ›å»º-SKILL-md" class="headerlink" title="æ­¥éª¤ 2ï¼šåˆ›å»º SKILL.md"></a>æ­¥éª¤ 2ï¼šåˆ›å»º SKILL.md</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs markdown">---<br>name: quarterly-reporting-assistant<br>description: å­£åº¦æŠ¥å‘Šç”ŸæˆåŠ©æ‰‹ã€‚å½“ç”¨æˆ·è¦æ±‚ç”Ÿæˆå­£åº¦é”€å”®ã€è´¢åŠ¡æˆ–è¿è¥æŠ¥å‘Šæ—¶è§¦å‘ã€‚<br>  å¯æ ¹æ®æä¾›çš„æ•°æ®æˆ–æ¨¡æ¿ç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Šã€‚<br><span class="hljs-section">  è§¦å‘å…³é”®è¯ï¼šç”Ÿæˆå­£åº¦æŠ¥å‘Šã€åˆ›å»ºé”€å”®æŠ¥å‘Šã€è´¢åŠ¡æŠ¥å‘Šã€‚</span><br><span class="hljs-section">---</span><br><br><span class="hljs-section"># å­£åº¦æŠ¥å‘Šç”ŸæˆåŠ©æ‰‹</span><br><br><span class="hljs-section">## å·¥ä½œæµç¨‹</span><br><br><span class="hljs-bullet">1.</span> <span class="hljs-strong">**ç†è§£æŠ¥å‘Šç±»å‹**</span> - ç¡®å®šç”¨æˆ·éœ€è¦çš„æŠ¥å‘Šç±»å‹ï¼ˆé”€å”®ã€è´¢åŠ¡ã€è¿è¥ç­‰ï¼‰<br><span class="hljs-bullet">2.</span> <span class="hljs-strong">**è·å–å¿…è¦æ•°æ®**</span> - è¯»å–ç”¨æˆ·æä¾›çš„æ•°æ®æ–‡ä»¶æˆ–è¯¢é—®æ•°æ®æ¥æº<br><span class="hljs-bullet">3.</span> <span class="hljs-strong">**é€‰æ‹©æŠ¥å‘Šæ¨¡æ¿**</span> - ä» <span class="hljs-code">`templates/`</span> ç›®å½•é€‰æ‹©åˆé€‚æ¨¡æ¿<br><span class="hljs-bullet">4.</span> <span class="hljs-strong">**å¡«å……æŠ¥å‘Šå†…å®¹**</span> - å°†æ•°æ®å¡«å……åˆ°æ¨¡æ¿ä¸­<br><span class="hljs-bullet">5.</span> <span class="hljs-strong">**å®¡æŸ¥ä¸ä¼˜åŒ–**</span> - æ£€æŸ¥æŠ¥å‘Šé€»è¾‘å’Œæ ¼å¼<br><span class="hljs-bullet">6.</span> <span class="hljs-strong">**è¾“å‡ºæŠ¥å‘Š**</span> - ä»¥ Markdown æˆ–æŒ‡å®šæ ¼å¼è¾“å‡º<br><br><span class="hljs-section">## ç¤ºä¾‹å¯¹è¯</span><br><br>ç”¨æˆ·è¾“å…¥: &quot;è¯·å¸®æˆ‘ç”Ÿæˆä¸€ä»½å…³äºQ3é”€å”®æ•°æ®çš„å­£åº¦æŠ¥å‘Šã€‚&quot;<br><br>Claude åŠ¨ä½œ:<br><span class="hljs-bullet">1.</span> è¯†åˆ«åˆ°ç”¨æˆ·è¯·æ±‚&quot;å­£åº¦æŠ¥å‘Š&quot;å’Œ&quot;é”€å”®æ•°æ®&quot;<br><span class="hljs-bullet">2.</span> è¯¢é—®ç”¨æˆ·æä¾›Q3é”€å”®æ•°æ®<br><span class="hljs-bullet">3.</span> ä½¿ç”¨ <span class="hljs-code">`templates/sales-report.md`</span> æ¨¡æ¿<br><span class="hljs-bullet">4.</span> ç”Ÿæˆå¹¶å±•ç¤ºé”€å”®æŠ¥å‘Šè‰ç¨¿<br></code></pre></td></tr></table></figure><h3 id="æ­¥éª¤-3ï¼šæ·»åŠ èµ„æºæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰"><a href="#æ­¥éª¤-3ï¼šæ·»åŠ èµ„æºæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="æ­¥éª¤ 3ï¼šæ·»åŠ èµ„æºæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰"></a>æ­¥éª¤ 3ï¼šæ·»åŠ èµ„æºæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰</h3><p><strong>æ¨¡æ¿æ–‡ä»¶ <code>templates/sales-report.md</code></strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># &#123;&#123;Quarter&#125;&#125; é”€å”®æ•°æ®æŠ¥å‘Š</span><br><br><span class="hljs-section">## æ¦‚è¿°</span><br>æœ¬æŠ¥å‘Šæ€»ç»“äº† &#123;&#123;Quarter&#125;&#125; çš„é”€å”®è¡¨ç°ã€‚<br><br><span class="hljs-section">## å…³é”®æŒ‡æ ‡</span><br><span class="hljs-bullet">-</span> æ€»é”€å”®é¢: &#123;&#123;TotalSales&#125;&#125;<br><span class="hljs-bullet">-</span> è®¢å•æ•°é‡: &#123;&#123;OrderCount&#125;&#125;<br><span class="hljs-bullet">-</span> å¹³å‡è®¢å•ä»·å€¼: &#123;&#123;AOV&#125;&#125;<br><br><span class="hljs-section">## é”€å”®è¶‹åŠ¿</span><br>ï¼ˆæ’å…¥é”€å”®è¶‹åŠ¿å›¾æˆ–è¯¦ç»†æ•°æ®ï¼‰<br><br><span class="hljs-section">## æ€»ç»“ä¸å±•æœ›</span><br></code></pre></td></tr></table></figure><p><strong>å¤„ç†è„šæœ¬ <code>scripts/data_processor.py</code></strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_sales_data</span>(<span class="hljs-params">data</span>):<br>    total_sales = <span class="hljs-built_in">sum</span>(item[<span class="hljs-string">&#x27;amount&#x27;</span>] <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> data)<br>    order_count = <span class="hljs-built_in">len</span>(data)<br>    aov = total_sales / order_count <span class="hljs-keyword">if</span> order_count &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;TotalSales&quot;</span>: <span class="hljs-string">f&quot;$<span class="hljs-subst">&#123;total_sales:,<span class="hljs-number">.2</span>f&#125;</span>&quot;</span>,<br>        <span class="hljs-string">&quot;OrderCount&quot;</span>: order_count,<br>        <span class="hljs-string">&quot;AOV&quot;</span>: <span class="hljs-string">f&quot;$<span class="hljs-subst">&#123;aov:,<span class="hljs-number">.2</span>f&#125;</span>&quot;</span><br>    &#125;<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    sample_data = [<br>        &#123;<span class="hljs-string">&quot;item&quot;</span>: <span class="hljs-string">&quot;Product A&quot;</span>, <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-number">120.50</span>&#125;,<br>        &#123;<span class="hljs-string">&quot;item&quot;</span>: <span class="hljs-string">&quot;Product B&quot;</span>, <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-number">80.00</span>&#125;,<br>    ]<br>    <span class="hljs-built_in">print</span>(json.dumps(process_sales_data(sample_data)))<br></code></pre></td></tr></table></figure><h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><pre><code class=" mermaid">sequenceDiagram    participant User as ç”¨æˆ·    participant Claude as Claude    participant Manager as Skill Manager    participant Skill as SKILL.md    User-&gt;&gt;Claude: å‘é€è¯·æ±‚    Claude-&gt;&gt;Manager: æ£€æŸ¥æŠ€èƒ½å…ƒæ•°æ®    Manager--&gt;&gt;Claude: è¿”å›åŒ¹é…çš„æŠ€èƒ½æè¿°    Claude-&gt;&gt;Claude: åˆ¤æ–­æ˜¯å¦éœ€è¦æŠ€èƒ½    alt éœ€è¦æŠ€èƒ½        Claude-&gt;&gt;User: è¯·æ±‚ç¡®è®¤åŠ è½½æŠ€èƒ½        User--&gt;&gt;Claude: ç¡®è®¤        Claude-&gt;&gt;Skill: åŠ è½½å®Œæ•´ SKILL.md        Skill--&gt;&gt;Claude: è¿”å›æŒ‡ä»¤å†…å®¹        Claude-&gt;&gt;Claude: æŒ‰æŒ‡ä»¤æ‰§è¡Œä»»åŠ¡    else ä¸éœ€è¦æŠ€èƒ½        Claude-&gt;&gt;Claude: æ­£å¸¸å¤„ç†è¯·æ±‚    end    Claude-&gt;&gt;User: è¿”å›ç»“æœ</code></pre><h2 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h2><h3 id="ç¼–å†™é«˜è´¨é‡-Skill"><a href="#ç¼–å†™é«˜è´¨é‡-Skill" class="headerlink" title="ç¼–å†™é«˜è´¨é‡ Skill"></a>ç¼–å†™é«˜è´¨é‡ Skill</h3><ol><li><strong>Description è¶³å¤Ÿå…·ä½“</strong> - ç›´æ¥å½±å“ Claude èƒ½å¦å‡†ç¡®è§¦å‘</li><li><strong>æŒ‡ä»¤æ¸…æ™°åˆ†æ­¥</strong> - æä¾›æ˜ç¡®çš„æ“ä½œæŒ‡å¯¼</li><li><strong>å·¥ä½œæµæ˜ç¡®</strong> - å®šä¹‰æ¸…æ™°çš„æ‰§è¡Œæµç¨‹</li><li><strong>ä»å°ä»»åŠ¡å¼€å§‹</strong> - é€æ­¥æŒæ¡æŠ€èƒ½åˆ›å»º</li></ol><h3 id="å®‰å…¨æ³¨æ„äº‹é¡¹"><a href="#å®‰å…¨æ³¨æ„äº‹é¡¹" class="headerlink" title="å®‰å…¨æ³¨æ„äº‹é¡¹"></a>å®‰å…¨æ³¨æ„äº‹é¡¹</h3><blockquote><p><strong>âš ï¸ è­¦å‘Š: å®‰å…¨æé†’</strong><br>æŠ€èƒ½å¯ä»¥åŒ…å«å¯æ‰§è¡Œä»£ç ï¼ŒåŠ è½½ç¬¬ä¸‰æ–¹æŠ€èƒ½æ—¶åŠ¡å¿…è¯„ä¼°æ¥æºå¯é æ€§ã€‚</p></blockquote><h3 id="è°ƒè¯•æŠ€å·§"><a href="#è°ƒè¯•æŠ€å·§" class="headerlink" title="è°ƒè¯•æŠ€å·§"></a>è°ƒè¯•æŠ€å·§</h3><ol><li>ä½¿ç”¨ <code>/skills</code> å‘½ä»¤æŸ¥çœ‹å·²åŠ è½½çš„æŠ€èƒ½</li><li>æ£€æŸ¥ description æ˜¯å¦åŒ…å«è¶³å¤Ÿçš„è§¦å‘å…³é”®è¯</li><li>ç¡®ä¿ SKILL.md è¯­æ³•æ­£ç¡®ï¼ˆYAML frontmatter æ ¼å¼ï¼‰</li></ol><h2 id="API-é›†æˆ"><a href="#API-é›†æˆ" class="headerlink" title="API é›†æˆ"></a>API é›†æˆ</h2><p>é€šè¿‡ Messages API ä½¿ç”¨ Skillsï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;container&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;skill_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;my-skill-id&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;skill&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>éœ€è¦å¯ç”¨çš„ Beta å¤´ï¼š</p><ul><li><code>code-execution-2025-08-25</code></li><li><code>skills-2025-10-02</code></li><li><code>files-api-2025-04-14</code></li></ul><h2 id="å‚è€ƒèµ„æº"><a href="#å‚è€ƒèµ„æº" class="headerlink" title="å‚è€ƒèµ„æº"></a>å‚è€ƒèµ„æº</h2><ul><li><a href="https://anthropic.com/">Claude Code å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://github.com/anthropics/claude-code">Claude Code GitHub</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
      <category>ç¼–ç¨‹å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Claude-Code</tag>
      
      <tag>AIå·¥å…·</tag>
      
      <tag>Skills</tag>
      
      <tag>è‡ªåŠ¨åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Agentå·¥å…·è°ƒç”¨æŠ€æœ¯è¯¦è§£</title>
    <link href="/2026/01/14/Agent%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/14/Agent%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Agent-å·¥å…·è°ƒç”¨æŠ€æœ¯è¯¦è§£"><a href="#Agent-å·¥å…·è°ƒç”¨æŠ€æœ¯è¯¦è§£" class="headerlink" title="Agent å·¥å…·è°ƒç”¨æŠ€æœ¯è¯¦è§£"></a>Agent å·¥å…·è°ƒç”¨æŠ€æœ¯è¯¦è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>ç°ä»£ AI Agent éœ€è¦ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’æ‰èƒ½å®Œæˆå®é™…ä»»åŠ¡ã€‚æœ¬æ–‡è¯¦ç»†ä»‹ç»ä¸‰ç§æ ¸å¿ƒæŠ€æœ¯ï¼š<strong>Function Calling</strong>ã€<strong>MCP</strong> å’Œ <strong>Agent Skills</strong>ï¼Œå®ƒä»¬æ„æˆäº† Agent å·¥å…·è°ƒç”¨çš„å®Œæ•´æŠ€æœ¯æ ˆã€‚</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ada">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                    Agent Skills                         â”‚<br>â”‚    ï¼ˆé«˜å±‚å°è£…ï¼šå·¥ä½œæµæŒ‡ä»¤ + è„šæœ¬ + å‚è€ƒæ–‡æ¡£ï¼‰           â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚                         MCP                             â”‚<br>â”‚       ï¼ˆåè®®å±‚ï¼šæ ‡å‡†åŒ–è¿æ¥å¤–éƒ¨å·¥å…·/æ•°æ®æºï¼‰             â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚                  <span class="hljs-keyword">Function</span> <span class="hljs-title">Calling</span>                       â”‚<br>â”‚          ï¼ˆåº•å±‚èƒ½åŠ›ï¼šæ¨¡å‹ç”Ÿæˆç»“æ„åŒ–è°ƒç”¨å‚æ•°ï¼‰           â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><hr><h2 id="ä¸€ã€Function-Callingï¼ˆå‡½æ•°è°ƒç”¨ï¼‰"><a href="#ä¸€ã€Function-Callingï¼ˆå‡½æ•°è°ƒç”¨ï¼‰" class="headerlink" title="ä¸€ã€Function Callingï¼ˆå‡½æ•°è°ƒç”¨ï¼‰"></a>ä¸€ã€Function Callingï¼ˆå‡½æ•°è°ƒç”¨ï¼‰</h2><h3 id="1-1-å®šä¹‰"><a href="#1-1-å®šä¹‰" class="headerlink" title="1.1 å®šä¹‰"></a>1.1 å®šä¹‰</h3><p>Function Calling æ˜¯å¤§æ¨¡å‹çš„ä¸€ç§<strong>åŸç”Ÿèƒ½åŠ›</strong>ï¼Œå…è®¸æ¨¡å‹ï¼š</p><ul><li>è¯†åˆ«ä½•æ—¶éœ€è¦è°ƒç”¨å¤–éƒ¨å·¥å…·</li><li>ç”Ÿæˆç»“æ„åŒ–çš„å‡½æ•°è°ƒç”¨å‚æ•°ï¼ˆJSON æ ¼å¼ï¼‰</li><li>ç†è§£å‡½æ•°è¿”å›ç»“æœå¹¶ç»§ç»­å¯¹è¯</li></ul><h3 id="1-2-å·¥ä½œæµç¨‹"><a href="#1-2-å·¥ä½œæµç¨‹" class="headerlink" title="1.2 å·¥ä½œæµç¨‹"></a>1.2 å·¥ä½œæµç¨‹</h3><pre><code class=" mermaid">sequenceDiagram    participant U as ç”¨æˆ·    participant M as å¤§æ¨¡å‹    participant T as å¤–éƒ¨å·¥å…·        U-&gt;&gt;M: å‘é€è¯·æ±‚    M-&gt;&gt;M: åˆ¤æ–­éœ€è¦è°ƒç”¨å·¥å…·    M-&gt;&gt;T: è¾“å‡ºå‡½æ•°å + å‚æ•°ï¼ˆJSONï¼‰    T-&gt;&gt;T: æ‰§è¡Œå‡½æ•°    T-&gt;&gt;M: è¿”å›æ‰§è¡Œç»“æœ    M-&gt;&gt;U: æ•´åˆç»“æœå¹¶å›å¤</code></pre><h3 id="1-3-ç¤ºä¾‹"><a href="#1-3-ç¤ºä¾‹" class="headerlink" title="1.3 ç¤ºä¾‹"></a>1.3 ç¤ºä¾‹</h3><p>ç”¨æˆ·è¯·æ±‚ï¼š<em>â€œåŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿâ€</em></p><p>æ¨¡å‹è¾“å‡ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;function&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;get_weather&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;parameters&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;city&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;åŒ—äº¬&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;date&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2026-01-14&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="1-4-ä¸»æµå¹³å°æ”¯æŒ"><a href="#1-4-ä¸»æµå¹³å°æ”¯æŒ" class="headerlink" title="1.4 ä¸»æµå¹³å°æ”¯æŒ"></a>1.4 ä¸»æµå¹³å°æ”¯æŒ</h3><table><thead><tr><th>å¹³å°</th><th>æ”¯æŒæƒ…å†µ</th></tr></thead><tbody><tr><td>OpenAI</td><td>âœ… åŸç”Ÿæ”¯æŒï¼ˆ2023å¹´6æœˆæ¨å‡ºï¼‰</td></tr><tr><td>Anthropic Claude</td><td>âœ… Tool Use</td></tr><tr><td>é€šä¹‰åƒé—®</td><td>âœ… Function Calling</td></tr><tr><td>æ–‡å¿ƒä¸€è¨€</td><td>âœ… å‡½æ•°è°ƒç”¨</td></tr></tbody></table><h3 id="1-5-ç‰¹ç‚¹"><a href="#1-5-ç‰¹ç‚¹" class="headerlink" title="1.5 ç‰¹ç‚¹"></a>1.5 ç‰¹ç‚¹</h3><ul><li><strong>åº•å±‚èƒ½åŠ›</strong>ï¼šæ˜¯å…¶ä»–å·¥å…·è°ƒç”¨æŠ€æœ¯çš„åŸºç¡€</li><li><strong>ç»“æ„åŒ–è¾“å‡º</strong>ï¼šå¼ºåˆ¶æ¨¡å‹è¾“å‡ºç¬¦åˆ JSON Schema çš„å‚æ•°</li><li><strong>å„å‚å•†ä¸ç»Ÿä¸€</strong>ï¼šæ¯ä¸ªå¹³å°çš„å®ç°ç»†èŠ‚ç•¥æœ‰å·®å¼‚</li></ul><hr><h2 id="äºŒã€MCPï¼ˆModel-Context-Protocolï¼‰"><a href="#äºŒã€MCPï¼ˆModel-Context-Protocolï¼‰" class="headerlink" title="äºŒã€MCPï¼ˆModel Context Protocolï¼‰"></a>äºŒã€MCPï¼ˆModel Context Protocolï¼‰</h2><h3 id="2-1-å®šä¹‰"><a href="#2-1-å®šä¹‰" class="headerlink" title="2.1 å®šä¹‰"></a>2.1 å®šä¹‰</h3><p>MCP æ˜¯ Anthropic äº 2024 å¹´æ¨å‡ºçš„<strong>å¼€æ”¾åè®®æ ‡å‡†</strong>ï¼Œç”¨äºç»Ÿä¸€ AI åº”ç”¨ä¸å¤–éƒ¨æ•°æ®æº&#x2F;å·¥å…·çš„è¿æ¥æ–¹å¼ã€‚</p><blockquote><p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼šä¸€æ¬¡é€‚é…ï¼Œå¤šå¤„å¤ç”¨â€”â€”è§£å†³â€æ¯ä¸ªå·¥å…·éƒ½è¦å•ç‹¬é€‚é…â€çš„é—®é¢˜ã€‚</p></blockquote><h3 id="2-2-æ¶æ„"><a href="#2-2-æ¶æ„" class="headerlink" title="2.2 æ¶æ„"></a>2.2 æ¶æ„</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚   MCP Host   â”‚â—„â”€â”€â”€â”€â–ºâ”‚  MCP Client  â”‚â—„â”€â”€â”€â”€â–ºâ”‚  MCP Server  â”‚<br>â”‚  (AI åº”ç”¨)   â”‚      â”‚   (è¿æ¥å™¨)   â”‚     â”‚  (å·¥å…·æä¾›æ–¹)â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>        â”‚                                          â”‚<br>        â”‚            æ ‡å‡†åŒ–åè®®é€šä¿¡                  â”‚<br>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="2-3-ä¸‰ç§èƒ½åŠ›ç±»å‹"><a href="#2-3-ä¸‰ç§èƒ½åŠ›ç±»å‹" class="headerlink" title="2.3 ä¸‰ç§èƒ½åŠ›ç±»å‹"></a>2.3 ä¸‰ç§èƒ½åŠ›ç±»å‹</h3><table><thead><tr><th>ç±»å‹</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>Resources</strong></td><td>é™æ€æ•°æ®èµ„æº</td><td>æ–‡ä»¶ã€æ•°æ®åº“è®°å½•ã€API å“åº”</td></tr><tr><td><strong>Tools</strong></td><td>å¯æ‰§è¡Œçš„æ“ä½œ</td><td>å‘é€é‚®ä»¶ã€æ‰§è¡Œä»£ç ã€è°ƒç”¨ API</td></tr><tr><td><strong>Prompts</strong></td><td>é¢„å®šä¹‰çš„æç¤ºè¯æ¨¡æ¿</td><td>ä»£ç å®¡æŸ¥æ¨¡æ¿ã€ç¿»è¯‘æ¨¡æ¿</td></tr></tbody></table><h3 id="2-4-ç±»æ¯”ç†è§£"><a href="#2-4-ç±»æ¯”ç†è§£" class="headerlink" title="2.4 ç±»æ¯”ç†è§£"></a>2.4 ç±»æ¯”ç†è§£</h3><blockquote><p>MCP å°±åƒ AI é¢†åŸŸçš„ <strong>USB æ¥å£æ ‡å‡†</strong>ï¼š</p><ul><li>USB å‡ºç°å‰ï¼šæ¯ç§è®¾å¤‡éœ€è¦ä¸“ç”¨æ¥å£</li><li>USB å‡ºç°åï¼šç»Ÿä¸€æ¥å£ï¼Œå³æ’å³ç”¨</li><li>MCPï¼šç»Ÿä¸€ AI ä¸å·¥å…·çš„è¿æ¥æ ‡å‡†</li></ul></blockquote><h3 id="2-5-ä¸-Function-Calling-çš„å…³ç³»"><a href="#2-5-ä¸-Function-Calling-çš„å…³ç³»" class="headerlink" title="2.5 ä¸ Function Calling çš„å…³ç³»"></a>2.5 ä¸ Function Calling çš„å…³ç³»</h3><ul><li>Function Calling æ˜¯æ¨¡å‹<strong>è¾“å‡ºè°ƒç”¨æ„å›¾</strong>çš„èƒ½åŠ›</li><li>MCP æ˜¯<strong>æ‰§è¡Œè°ƒç”¨</strong>çš„æ ‡å‡†åŒ–åè®®</li><li>MCP Server å†…éƒ¨å¯èƒ½ä½¿ç”¨ Function Calling æ¥è§¦å‘å·¥å…·</li></ul><hr><h2 id="ä¸‰ã€Agent-Skills"><a href="#ä¸‰ã€Agent-Skills" class="headerlink" title="ä¸‰ã€Agent Skills"></a>ä¸‰ã€Agent Skills</h2><h3 id="3-1-å®šä¹‰"><a href="#3-1-å®šä¹‰" class="headerlink" title="3.1 å®šä¹‰"></a>3.1 å®šä¹‰</h3><p>Agent Skills æ˜¯ Anthropic äº 2025 å¹´ 10 æœˆæ¨å‡ºçš„ä¸€ç§æ–°æ–¹å¼ï¼Œç”¨äº<strong>å°†ä¸“ä¸šçŸ¥è¯†å°è£…æˆå¯å¤ç”¨çš„èƒ½åŠ›æ¨¡å—</strong>ã€‚</p><blockquote><p><strong>æ ¸å¿ƒç†å¿µ</strong>ï¼šä¸º Agent å‡†å¤‡â€å…¥èŒæŒ‡å—â€â€”â€”ä¸æ˜¯æ„å»ºå®šåˆ¶åŒ– Agentï¼Œè€Œæ˜¯è®©é€šç”¨ Agent å…·å¤‡ä¸“ä¸šèƒ½åŠ›ã€‚</p></blockquote><h3 id="3-2-Skill-çš„ç»“æ„"><a href="#3-2-Skill-çš„ç»“æ„" class="headerlink" title="3.2 Skill çš„ç»“æ„"></a>3.2 Skill çš„ç»“æ„</h3><p>ä¸€ä¸ª Skill æ˜¯ä¸€ä¸ªåŒ…å« <code>SKILL.md</code> æ–‡ä»¶çš„ç›®å½•ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">my</span>-skill/<br>â”œâ”€â”€ SKILL.md          <span class="hljs-comment"># å¿…éœ€ï¼šæ ¸å¿ƒæ–‡ä»¶ï¼ˆYAML å…ƒæ•°æ® + æŒ‡ä»¤ï¼‰</span><br>â”œâ”€â”€ <span class="hljs-keyword">reference</span>.md      <span class="hljs-comment"># å¯é€‰ï¼šè¯¦ç»†å‚è€ƒæ–‡æ¡£</span><br>â”œâ”€â”€ examples.md       <span class="hljs-comment"># å¯é€‰ï¼šä½¿ç”¨ç¤ºä¾‹</span><br>â””â”€â”€ scripts/<br>    â””â”€â”€ helper.py     <span class="hljs-comment"># å¯é€‰ï¼šå¯æ‰§è¡Œè„šæœ¬</span><br></code></pre></td></tr></table></figure><h3 id="3-3-SKILL-md-æ ¼å¼"><a href="#3-3-SKILL-md-æ ¼å¼" class="headerlink" title="3.3 SKILL.md æ ¼å¼"></a>3.3 SKILL.md æ ¼å¼</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">pdf-processing</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">Extract</span> <span class="hljs-string">text,</span> <span class="hljs-string">fill</span> <span class="hljs-string">forms,</span> <span class="hljs-string">merge</span> <span class="hljs-string">PDFs.</span> <span class="hljs-string">Use</span> <span class="hljs-string">when</span> <span class="hljs-string">working</span> <span class="hljs-string">with</span> <span class="hljs-string">PDF</span> <span class="hljs-string">files.</span><br><span class="hljs-attr">allowed-tools:</span> <span class="hljs-string">Read,</span> <span class="hljs-string">Bash(python:*)</span><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-comment"># PDF Processing</span><br><br><span class="hljs-comment">## Quick start</span><br><span class="hljs-attr">Extract text:</span><br><span class="hljs-string">```python</span><br><span class="hljs-string">import</span> <span class="hljs-string">pdfplumber</span><br><span class="hljs-string">with</span> <span class="hljs-string">pdfplumber.open(&quot;doc.pdf&quot;)</span> <span class="hljs-attr">as pdf:</span><br>    <span class="hljs-string">text</span> <span class="hljs-string">=</span> <span class="hljs-string">pdf.pages[0].extract_text()</span><br></code></pre></td></tr></table></figure><p>For form filling, see <a href="FORMS.md">FORMS.md</a>.</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><br><span class="hljs-comment">### 3.4 å…ƒæ•°æ®å­—æ®µè¯¦è§£</span><br><br>|<span class="hljs-string"> å­—æ®µ </span>|<span class="hljs-string"> å¿…éœ€ </span>|<span class="hljs-string"> ä½œç”¨ </span>|<br>|<span class="hljs-string">------</span>|<span class="hljs-string">------</span>|<span class="hljs-string">------</span>|<br>|<span class="hljs-string"> `name` </span>|<span class="hljs-string"> âœ… </span>|<span class="hljs-string"> Skill çš„å”¯ä¸€æ ‡è¯†å </span>|<br>|<span class="hljs-string"> `description` </span>|<span class="hljs-string"> âœ… </span>|<span class="hljs-string"> æè¿°ä½•æ—¶è§¦å‘è¯¥ Skill </span>|<br>|<span class="hljs-string"> `allowed-tools` </span>|<span class="hljs-string"> âŒ </span>|<span class="hljs-string"> é™åˆ¶å¯ç”¨å·¥å…·ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰ </span>|<br>|<span class="hljs-string"> `model` </span>|<span class="hljs-string"> âŒ </span>|<span class="hljs-string"> æŒ‡å®šä½¿ç”¨çš„æ¨¡å‹ç‰ˆæœ¬ </span>|<br>|<span class="hljs-string"> `context: fork` </span>|<span class="hljs-string"> âŒ </span>|<span class="hljs-string"> åœ¨ç‹¬ç«‹ä¸Šä¸‹æ–‡ä¸­è¿è¡Œ </span>|<br>|<span class="hljs-string"> `hooks` </span>|<span class="hljs-string"> âŒ </span>|<span class="hljs-string"> å®šä¹‰å·¥å…·è°ƒç”¨å‰åçš„é’©å­ </span>|<br>|<span class="hljs-string"> `user-invocable` </span>|<span class="hljs-string"> âŒ </span>|<span class="hljs-string"> æ˜¯å¦å…è®¸ç”¨æˆ·é€šè¿‡ `/skill-name` è°ƒç”¨ </span>|<br><br><span class="hljs-comment">### 3.5 æ¸è¿›å¼æŠ«éœ²ï¼ˆProgressive Disclosureï¼‰</span><br><br>è¿™æ˜¯ Skills çš„<span class="hljs-symbol">*</span><span class="hljs-symbol">*</span>æ ¸å¿ƒè®¾è®¡åŸåˆ™<span class="hljs-symbol">*</span><span class="hljs-symbol">*</span>ï¼š<br><br>```mermaid<br>flowchart TD<br>    A[å¯åŠ¨] --&gt; B[åŠ è½½ name + description åˆ°ç³»ç»Ÿæç¤ºè¯]<br>    B --&gt; C&#123;ç”¨æˆ·è¯·æ±‚ä¸ Skill ç›¸å…³?&#125;<br>    C --&gt;|<span class="hljs-string">æ˜¯</span>|<span class="hljs-string"> D[è¯»å–å®Œæ•´ SKILL.md]</span><br><span class="hljs-string">    C --&gt;</span>|<span class="hljs-string">å¦</span>|<span class="hljs-string"> E[ç»§ç»­æ­£å¸¸å¯¹è¯]</span><br><span class="hljs-string">    D --&gt; F&#123;éœ€è¦æ›´å¤šç»†èŠ‚?&#125;</span><br><span class="hljs-string">    F --&gt;</span>|<span class="hljs-string">æ˜¯</span>|<span class="hljs-string"> G[æŒ‰éœ€è¯»å– reference.md ç­‰]</span><br><span class="hljs-string">    F --&gt;</span>|<span class="hljs-string">å¦</span>|<span class="hljs-string"> H[æ‰§è¡Œä»»åŠ¡]</span><br><span class="hljs-string">    G --&gt; I&#123;éœ€è¦æ‰§è¡Œè„šæœ¬?&#125;</span><br><span class="hljs-string">    I --&gt;</span>|<span class="hljs-string">æ˜¯</span>|<span class="hljs-string"> J[è¿è¡Œ scripts/ ä¸­çš„è„šæœ¬]</span><br><span class="hljs-string">    I --&gt;</span>|<span class="hljs-string">å¦</span>|<span class="hljs-string"> H</span><br></code></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼šä¸Šä¸‹æ–‡çª—å£ä½¿ç”¨é‡<strong>å¯æ— é™æ‰©å±•</strong>ï¼ŒåªåŠ è½½çœŸæ­£éœ€è¦çš„å†…å®¹ã€‚</p><h3 id="3-6-Skills-å­˜æ”¾ä½ç½®"><a href="#3-6-Skills-å­˜æ”¾ä½ç½®" class="headerlink" title="3.6 Skills å­˜æ”¾ä½ç½®"></a>3.6 Skills å­˜æ”¾ä½ç½®</h3><table><thead><tr><th>ä½ç½®</th><th>ä½œç”¨åŸŸ</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>~/.claude/skills/</code></td><td>ç”¨æˆ·çº§</td><td>ä¸ªäººé€šç”¨ Skills</td></tr><tr><td><code>.claude/skills/</code></td><td>é¡¹ç›®çº§</td><td>é¡¹ç›®ä¸“ç”¨ Skills</td></tr><tr><td>æ’ä»¶ä¸­çš„ <code>skills/</code></td><td>å¯åˆ†å‘</td><td>é€šè¿‡æ’ä»¶å¸‚åœºå…±äº«</td></tr></tbody></table><h3 id="3-7-ä¸-MCP-çš„å…³ç³»"><a href="#3-7-ä¸-MCP-çš„å…³ç³»" class="headerlink" title="3.7 ä¸ MCP çš„å…³ç³»"></a>3.7 ä¸ MCP çš„å…³ç³»</h3><p>å®˜æ–¹æ˜ç¡®æŒ‡å‡º Skills å’Œ MCP æ˜¯<strong>äº’è¡¥å…³ç³»</strong>ï¼š</p><blockquote><p>â€œWeâ€™ll also explore how Skills can <strong>complement</strong> MCP servers by teaching agents more complex workflows that involve external tools and software.â€</p></blockquote><ul><li><strong>MCP</strong>ï¼šæä¾›å·¥å…·è¿æ¥çš„æ ‡å‡†åè®®ï¼ˆâ€æœ‰ä»€ä¹ˆå·¥å…·â€ï¼‰</li><li><strong>Skills</strong>ï¼šæ•™ä¼š Agent å¦‚ä½•ä½¿ç”¨è¿™äº›å·¥å…·å®Œæˆå¤æ‚å·¥ä½œæµï¼ˆâ€æ€ä¹ˆç”¨å·¥å…·â€ï¼‰</li></ul><hr><h2 id="å››ã€ä¸‰è€…å¯¹æ¯”"><a href="#å››ã€ä¸‰è€…å¯¹æ¯”" class="headerlink" title="å››ã€ä¸‰è€…å¯¹æ¯”"></a>å››ã€ä¸‰è€…å¯¹æ¯”</h2><h3 id="4-1-å®šä½å¯¹æ¯”"><a href="#4-1-å®šä½å¯¹æ¯”" class="headerlink" title="4.1 å®šä½å¯¹æ¯”"></a>4.1 å®šä½å¯¹æ¯”</h3><table><thead><tr><th>ç»´åº¦</th><th>Function Calling</th><th>MCP</th><th>Agent Skills</th></tr></thead><tbody><tr><td><strong>å±‚çº§</strong></td><td>åº•å±‚èƒ½åŠ›</td><td>åè®®æ ‡å‡†</td><td>é«˜å±‚å°è£…</td></tr><tr><td><strong>ç²’åº¦</strong></td><td>å•ä¸ªå‡½æ•°è°ƒç”¨</td><td>å·¥å…·è¿æ¥è§„èŒƒ</td><td>å®Œæ•´å·¥ä½œæµ</td></tr><tr><td><strong>æ ‡å‡†åŒ–</strong></td><td>å„å‚å•†ä¸ç»Ÿä¸€</td><td>ç»Ÿä¸€åè®®</td><td>Anthropic æ ‡å‡†</td></tr><tr><td><strong>å¤ç”¨æ€§</strong></td><td>ä½ï¼ˆéœ€é‡å¤å®šä¹‰ï¼‰</td><td>é«˜ï¼ˆä¸€æ¬¡é€‚é…ï¼‰</td><td>é«˜ï¼ˆæ–‡ä»¶å¤¹å…±äº«ï¼‰</td></tr><tr><td><strong>æ¨å‡ºæ—¶é—´</strong></td><td>2023 å¹´</td><td>2024 å¹´</td><td>2025 å¹´</td></tr></tbody></table><h3 id="4-2-åä½œå…³ç³»"><a href="#4-2-åä½œå…³ç³»" class="headerlink" title="4.2 åä½œå…³ç³»"></a>4.2 åä½œå…³ç³»</h3><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs nim">ç”¨æˆ·è¯·æ±‚: <span class="hljs-string">&quot;å¸®æˆ‘å¡«å†™è¿™ä¸ª PDF è¡¨å•&quot;</span><br>     â”‚<br>     â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-type">Agent</span> <span class="hljs-type">Skills</span>: pdf-processing                            â”‚<br>â”‚ â”œâ”€ è¯»å– <span class="hljs-type">SKILL</span>.md è·å–å¤„ç†æŒ‡ä»¤                            â”‚<br>â”‚ â”œâ”€ æŒ‰éœ€åŠ è½½ <span class="hljs-type">FORMS</span>.md è·å–è¡¨å•å¡«å†™è§„èŒƒ                     â”‚<br>â”‚ â””â”€ è°ƒç”¨ scripts/fill_form.py æ‰§è¡Œå¡«å†™                   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>     â”‚<br>     â–¼ é€šè¿‡ <span class="hljs-type">MCP</span> åè®®è¿æ¥<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-type">MCP</span> <span class="hljs-type">Server</span>: pdf-tools                                   â”‚<br>â”‚ â””â”€ æä¾› <span class="hljs-type">PDF</span> è¯»å†™å·¥å…·                                     â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>     â”‚<br>     â–¼ åŸºäº <span class="hljs-type">Function</span> <span class="hljs-type">Calling</span><br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ å¤§æ¨¡å‹: ç”Ÿæˆå·¥å…·è°ƒç”¨å‚æ•°                                  â”‚<br>â”‚ â””â”€ &#123;<span class="hljs-string">&quot;function&quot;</span>: <span class="hljs-string">&quot;fill_pdf_form&quot;</span>, <span class="hljs-string">&quot;params&quot;</span>: <span class="hljs-meta">&#123;...&#125;</span>&#125;      â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="4-3-ä½¿ç”¨åœºæ™¯é€‰æ‹©"><a href="#4-3-ä½¿ç”¨åœºæ™¯é€‰æ‹©" class="headerlink" title="4.3 ä½¿ç”¨åœºæ™¯é€‰æ‹©"></a>4.3 ä½¿ç”¨åœºæ™¯é€‰æ‹©</h3><table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>ç®€å•çš„å•æ¬¡å·¥å…·è°ƒç”¨</td><td>Function Calling</td></tr><tr><td>è¿æ¥å¤šä¸ªå¤–éƒ¨æœåŠ¡</td><td>MCP</td></tr><tr><td>å¤æ‚çš„å¤šæ­¥éª¤å·¥ä½œæµ</td><td>Agent Skills</td></tr><tr><td>éœ€è¦å›¢é˜Ÿå…±äº«çš„ä¸“ä¸šèƒ½åŠ›</td><td>Agent Skills + æ’ä»¶åˆ†å‘</td></tr><tr><td>éœ€è¦åŠ¨æ€ä¸Šä¸‹æ–‡åŠ è½½</td><td>Agent Skillsï¼ˆæ¸è¿›å¼æŠ«éœ²ï¼‰</td></tr></tbody></table><hr><h2 id="äº”ã€å®è·µå»ºè®®"><a href="#äº”ã€å®è·µå»ºè®®" class="headerlink" title="äº”ã€å®è·µå»ºè®®"></a>äº”ã€å®è·µå»ºè®®</h2><h3 id="5-1-ä½•æ—¶ä½¿ç”¨-Skills-vs-å…¶ä»–æ–¹å¼"><a href="#5-1-ä½•æ—¶ä½¿ç”¨-Skills-vs-å…¶ä»–æ–¹å¼" class="headerlink" title="5.1 ä½•æ—¶ä½¿ç”¨ Skills vs å…¶ä»–æ–¹å¼"></a>5.1 ä½•æ—¶ä½¿ç”¨ Skills vs å…¶ä»–æ–¹å¼</h3><table><thead><tr><th>æ–¹å¼</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Skills</strong></td><td>å¤æ‚çš„å¤šæ­¥éª¤å·¥ä½œæµï¼Œéœ€è¦åŠ¨æ€åŠ è½½ä¸Šä¸‹æ–‡</td></tr><tr><td><strong>CLAUDE.md</strong></td><td>é¡¹ç›®çº§é€šç”¨è§„åˆ™ï¼ˆå§‹ç»ˆåŠ è½½ï¼‰</td></tr><tr><td><strong>æ–œæ å‘½ä»¤</strong></td><td>ç”¨æˆ·ä¸»åŠ¨è§¦å‘çš„å¿«æ·æ“ä½œï¼ˆå¦‚ <code>/deploy</code>ï¼‰</td></tr><tr><td><strong>MCP æœåŠ¡å™¨</strong></td><td>è¿æ¥å¤–éƒ¨å·¥å…·å’Œæ•°æ®æº</td></tr><tr><td><strong>Hooks</strong></td><td>å·¥å…·è°ƒç”¨å‰åçš„è‡ªåŠ¨åŒ–è„šæœ¬</td></tr></tbody></table><h3 id="5-2-Skills-å¼€å‘æœ€ä½³å®è·µ"><a href="#5-2-Skills-å¼€å‘æœ€ä½³å®è·µ" class="headerlink" title="5.2 Skills å¼€å‘æœ€ä½³å®è·µ"></a>5.2 Skills å¼€å‘æœ€ä½³å®è·µ</h3><ol><li><strong>ä»è¯„ä¼°å¼€å§‹</strong>ï¼šå…ˆè§‚å¯Ÿ Agent åœ¨å“ªäº›ä»»åŠ¡ä¸Šè¡¨ç°ä¸ä½³ï¼Œå†é’ˆå¯¹æ€§å¼€å‘ Skill</li><li><strong>ç»“æ„åŒ–æ‰©å±•</strong>ï¼šå½“ SKILL.md å˜å¾—è‡ƒè‚¿æ—¶ï¼Œæ‹†åˆ†åˆ°å¤šä¸ªæ–‡ä»¶</li><li><strong>ä» Claude è§†è§’æ€è€ƒ</strong>ï¼šå…³æ³¨ name å’Œ description çš„ç¼–å†™ï¼Œè¿™å†³å®šäº†è§¦å‘æ—¶æœº</li><li><strong>ä¸ Claude è¿­ä»£</strong>ï¼šè®© Claude å¸®åŠ©æ€»ç»“æˆåŠŸæ¨¡å¼å’Œå¸¸è§é”™è¯¯</li></ol><h3 id="5-3-å®‰å…¨è€ƒè™‘"><a href="#5-3-å®‰å…¨è€ƒè™‘" class="headerlink" title="5.3 å®‰å…¨è€ƒè™‘"></a>5.3 å®‰å…¨è€ƒè™‘</h3><ul><li><strong>ä»…å®‰è£…å—ä¿¡ä»»æ¥æºçš„ Skills</strong></li><li>å®¡æŸ¥ Skill ä¸­çš„è„šæœ¬å’Œå¤–éƒ¨è¿æ¥</li><li>ä½¿ç”¨ <code>allowed-tools</code> é™åˆ¶å·¥å…·è®¿é—®èŒƒå›´</li></ul><hr><h2 id="å…­ã€å‚è€ƒèµ„æ–™"><a href="#å…­ã€å‚è€ƒèµ„æ–™" class="headerlink" title="å…­ã€å‚è€ƒèµ„æ–™"></a>å…­ã€å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.anthropic.com/engineering/equipping-agents-for-the-real-world-with-agent-skills">Anthropic Engineering Blog: Equipping Agents for the Real World with Agent Skills</a></li><li><a href="https://agentskills.io/">Agent Skills å¼€æ”¾æ ‡å‡†</a></li><li><a href="https://code.claude.com/docs/zh-CN/skills">Claude Code Skills æ–‡æ¡£</a></li><li><a href="https://modelcontextprotocol.io/">Model Context Protocol å®˜ç½‘</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Skills</tag>
      
      <tag>Agent</tag>
      
      <tag>FunctionCalling</tag>
      
      <tag>MCP</tag>
      
      <tag>å·¥å…·è°ƒç”¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Advanced-RAGè¯¦è§£</title>
    <link href="/2026/01/13/Advanced-RAG%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/13/Advanced-RAG%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Advanced-RAG-è¯¦è§£"><a href="#Advanced-RAG-è¯¦è§£" class="headerlink" title="Advanced RAG è¯¦è§£"></a>Advanced RAG è¯¦è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>RAGï¼ˆRetrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong> æ˜¯ä¸€ç§å°†å¤–éƒ¨çŸ¥è¯†æ£€ç´¢ä¸å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆèƒ½åŠ›ç›¸ç»“åˆçš„æŠ€æœ¯æ¶æ„ã€‚</p><p><strong>Advanced RAGï¼ˆé«˜çº§ RAGï¼‰</strong> æ˜¯å¯¹åŸºç¡€ RAGï¼ˆä¹Ÿç§° Naive RAGï¼‰çš„ç³»ç»Ÿæ€§ä¼˜åŒ–ï¼Œé€šè¿‡åœ¨æ£€ç´¢å‰ã€æ£€ç´¢ä¸­ã€æ£€ç´¢åå¼•å…¥å¤šç§ä¼˜åŒ–æŠ€æœ¯ï¼Œæ˜¾è‘—æå‡æ£€ç´¢è´¨é‡å’Œç”Ÿæˆå‡†ç¡®æ€§ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-Advanced-RAGï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-Advanced-RAGï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ Advanced RAGï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ Advanced RAGï¼Ÿ</h3><p>Naive RAG å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p><table><thead><tr><th>é—®é¢˜ç±»å‹</th><th>å…·ä½“è¡¨ç°</th></tr></thead><tbody><tr><td><strong>æ£€ç´¢è´¨é‡å·®</strong></td><td>å¬å›çš„æ–‡æ¡£ä¸é—®é¢˜ä¸ç›¸å…³</td></tr><tr><td><strong>ä¸Šä¸‹æ–‡ä¸¢å¤±</strong></td><td>åˆ†å—åˆ‡æ–­äº†è¯­ä¹‰å®Œæ•´æ€§</td></tr><tr><td><strong>å¹»è§‰é—®é¢˜</strong></td><td>æ¨¡å‹ç”Ÿæˆä¸æ£€ç´¢å†…å®¹ä¸ç¬¦çš„ç­”æ¡ˆ</td></tr><tr><td><strong>æ•ˆç‡ä½ä¸‹</strong></td><td>æ£€ç´¢å¤§é‡æ— å…³å†…å®¹æµªè´¹ Token</td></tr></tbody></table><hr><h2 id="RAG-æ¼”è¿›è·¯çº¿"><a href="#RAG-æ¼”è¿›è·¯çº¿" class="headerlink" title="RAG æ¼”è¿›è·¯çº¿"></a>RAG æ¼”è¿›è·¯çº¿</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚  Naive RAG  â”‚ â”€â†’ â”‚ Advanced RAGâ”‚ â”€â†’ â”‚ Modular RAG â”‚<br>â”‚  (åŸºç¡€ç‰ˆ)    â”‚    â”‚  (è¿›é˜¶ç‰ˆ)    â”‚    â”‚  (æ¨¡å—åŒ–ç‰ˆ)  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>       â†“                  â†“                  â†“<br>  ç®€å•æµç¨‹           ä¼˜åŒ–æµç¨‹            çµæ´»ç»„åˆ<br>  é—®é¢˜å¤š             è´¨é‡æå‡            é«˜åº¦å®šåˆ¶<br></code></pre></td></tr></table></figure><h3 id="ä¸‰ä»£-RAG-å¯¹æ¯”"><a href="#ä¸‰ä»£-RAG-å¯¹æ¯”" class="headerlink" title="ä¸‰ä»£ RAG å¯¹æ¯”"></a>ä¸‰ä»£ RAG å¯¹æ¯”</h3><table><thead><tr><th>ç‰¹æ€§</th><th>Naive RAG</th><th>Advanced RAG</th><th>Modular RAG</th></tr></thead><tbody><tr><td>æ£€ç´¢æ–¹å¼</td><td>å•ä¸€å‘é‡æ£€ç´¢</td><td>æ··åˆæ£€ç´¢ + é‡æ’åº</td><td>å¯æ’æ‹”æ£€ç´¢æ¨¡å—</td></tr><tr><td>æŸ¥è¯¢å¤„ç†</td><td>ç›´æ¥ä½¿ç”¨åŸå§‹æŸ¥è¯¢</td><td>æŸ¥è¯¢æ”¹å†™&#x2F;æ‰©å±•</td><td>è‡ªé€‚åº”æŸ¥è¯¢è·¯ç”±</td></tr><tr><td>ä¸Šä¸‹æ–‡å¤„ç†</td><td>ç®€å•æ‹¼æ¥</td><td>å‹ç¼©&#x2F;è¿‡æ»¤&#x2F;å»é‡</td><td>åŠ¨æ€ä¸Šä¸‹æ–‡ç®¡ç†</td></tr><tr><td>ç´¢å¼•ç­–ç•¥</td><td>å›ºå®šåˆ†å—</td><td>å¤šç²’åº¦ç´¢å¼•</td><td>è‡ªå®šä¹‰ç´¢å¼•ç®¡é“</td></tr></tbody></table><hr><h2 id="Advanced-RAG-æ ¸å¿ƒæ¶æ„"><a href="#Advanced-RAG-æ ¸å¿ƒæ¶æ„" class="headerlink" title="Advanced RAG æ ¸å¿ƒæ¶æ„"></a>Advanced RAG æ ¸å¿ƒæ¶æ„</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">ç”¨æˆ·æŸ¥è¯¢<br>    â”‚<br>    â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                    é¢„æ£€ç´¢é˜¶æ®µ                          â”‚<br>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚<br>â”‚  â”‚æŸ¥è¯¢æ”¹å†™  â”‚  â”‚æŸ¥è¯¢æ‰©å±•  â”‚  â”‚æŸ¥è¯¢è·¯ç”±  â”‚  â”‚  HyDE   â”‚  â”‚<br>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>    â”‚<br>    â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                     æ£€ç´¢é˜¶æ®µ                           â”‚<br>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚<br>â”‚  â”‚æ··åˆæ£€ç´¢  â”‚  â”‚å¤šè·¯å¬å›  â”‚  â”‚ é‡æ’åº  â”‚  â”‚å…ƒæ•°æ®è¿‡æ»¤â”‚  â”‚<br>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>    â”‚<br>    â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                    åæ£€ç´¢é˜¶æ®µ                          â”‚<br>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚<br>â”‚  â”‚ä¸Šä¸‹æ–‡å‹ç¼©â”‚  â”‚ å»é‡è¿‡æ»¤ â”‚  â”‚ç›¸å…³æ€§æ ¡éªŒâ”‚  â”‚å†…å®¹é‡ç»„  â”‚  â”‚<br>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>    â”‚<br>    â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                     ç”Ÿæˆé˜¶æ®µ                           â”‚<br>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚<br>â”‚  â”‚   <span class="hljs-keyword">LLM </span>æ ¹æ®ä¼˜åŒ–åçš„ä¸Šä¸‹æ–‡ç”Ÿæˆé«˜è´¨é‡ç­”æ¡ˆ            â”‚  â”‚<br>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><hr><h2 id="é¢„æ£€ç´¢ä¼˜åŒ–æŠ€æœ¯"><a href="#é¢„æ£€ç´¢ä¼˜åŒ–æŠ€æœ¯" class="headerlink" title="é¢„æ£€ç´¢ä¼˜åŒ–æŠ€æœ¯"></a>é¢„æ£€ç´¢ä¼˜åŒ–æŠ€æœ¯</h2><p>é¢„æ£€ç´¢é˜¶æ®µçš„ç›®æ ‡æ˜¯<strong>ä¼˜åŒ–ç”¨æˆ·æŸ¥è¯¢</strong>ï¼Œä½¿å…¶æ›´é€‚åˆæ£€ç´¢ç³»ç»Ÿã€‚</p><h3 id="1-æŸ¥è¯¢æ”¹å†™ï¼ˆQuery-Rewritingï¼‰"><a href="#1-æŸ¥è¯¢æ”¹å†™ï¼ˆQuery-Rewritingï¼‰" class="headerlink" title="1. æŸ¥è¯¢æ”¹å†™ï¼ˆQuery Rewritingï¼‰"></a>1. æŸ¥è¯¢æ”¹å†™ï¼ˆQuery Rewritingï¼‰</h3><p>å°†ç”¨æˆ·çš„åŸå§‹æŸ¥è¯¢æ”¹å†™ä¸ºæ›´é€‚åˆæ£€ç´¢çš„å½¢å¼ã€‚</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ</strong></p><ul><li>ç”¨æˆ·æŸ¥è¯¢å¯èƒ½å£è¯­åŒ–ã€æ¨¡ç³Šã€æœ‰æ­§ä¹‰</li><li>æ£€ç´¢ç³»ç»Ÿéœ€è¦ç²¾ç¡®ã€æ˜ç¡®çš„æŸ¥è¯¢</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c">åŸå§‹æŸ¥è¯¢<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;é‚£ä¸ªä¸œè¥¿æ€ä¹ˆç”¨å•Š&quot;</span><br>æ”¹å†™å<span class="hljs-punctuation">:</span>   <span class="hljs-string">&quot;è¯·è§£é‡Šè¯¥å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å’Œæ“ä½œæ­¥éª¤&quot;</span><br><br>åŸå§‹æŸ¥è¯¢<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Python çˆ¬è™«æŠ¥é”™äº†&quot;</span>  <br>æ”¹å†™å<span class="hljs-punctuation">:</span>   <span class="hljs-string">&quot;Python çˆ¬è™«å¸¸è§é”™è¯¯ç±»å‹åŠè§£å†³æ–¹æ¡ˆ&quot;</span><br></code></pre></td></tr></table></figure><p><strong>å®ç°æ–¹å¼ï¼š</strong></p><ul><li>ä½¿ç”¨ LLM è¿›è¡ŒæŸ¥è¯¢æ”¹å†™</li><li>åŸºäºè§„åˆ™çš„æ”¹å†™ï¼ˆå»åœç”¨è¯ã€çº é”™ç­‰ï¼‰</li></ul><h3 id="2-æŸ¥è¯¢æ‰©å±•ï¼ˆQuery-Expansionï¼‰"><a href="#2-æŸ¥è¯¢æ‰©å±•ï¼ˆQuery-Expansionï¼‰" class="headerlink" title="2. æŸ¥è¯¢æ‰©å±•ï¼ˆQuery Expansionï¼‰"></a>2. æŸ¥è¯¢æ‰©å±•ï¼ˆQuery Expansionï¼‰</h3><p>å°†å•ä¸ªæŸ¥è¯¢æ‰©å±•ä¸ºå¤šä¸ªç›¸å…³æŸ¥è¯¢ï¼Œå¢åŠ å¬å›è¦†ç›–é¢ã€‚</p><p><strong>æŠ€æœ¯æ–¹æ¡ˆï¼š</strong></p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>åŒä¹‰è¯æ‰©å±•</strong></td><td>æ·»åŠ åŒä¹‰è¯</td><td>â€œæœºå™¨å­¦ä¹ â€ â†’ â€œMLâ€ã€â€Machine Learningâ€</td></tr><tr><td><strong>ä¸Šä¸‹ä½è¯æ‰©å±•</strong></td><td>æ·»åŠ ä¸Šä½&#x2F;ä¸‹ä½æ¦‚å¿µ</td><td>â€œPythonâ€ â†’ â€œç¼–ç¨‹è¯­è¨€â€ã€â€Python3â€</td></tr><tr><td><strong>å¤šè§’åº¦æ‰©å±•</strong></td><td>ä»ä¸åŒè§’åº¦ç”ŸæˆæŸ¥è¯¢</td><td>åŸå› ã€æ–¹æ³•ã€æ¯”è¾ƒã€åº”ç”¨</td></tr></tbody></table><p><strong>Multi-Query ç¤ºä¾‹ï¼š</strong></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">åŸå§‹: &quot;å¦‚ä½•ä¼˜åŒ– RAG ç³»ç»Ÿï¼Ÿ&quot;</span><br><br><span class="hljs-section">æ‰©å±•ä¸º:</span><br>1. <span class="hljs-string">&quot;RAG ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–æ–¹æ³•&quot;</span><br>2. <span class="hljs-string">&quot;æå‡ RAG æ£€ç´¢å‡†ç¡®ç‡çš„æŠ€æœ¯&quot;</span><br>3. <span class="hljs-string">&quot;RAG ç³»ç»Ÿå¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ&quot;</span><br>4. <span class="hljs-string">&quot;Advanced RAG æœ€ä½³å®è·µ&quot;</span><br></code></pre></td></tr></table></figure><h3 id="3-HyDEï¼ˆHypothetical-Document-Embeddingsï¼‰"><a href="#3-HyDEï¼ˆHypothetical-Document-Embeddingsï¼‰" class="headerlink" title="3. HyDEï¼ˆHypothetical Document Embeddingsï¼‰"></a>3. HyDEï¼ˆHypothetical Document Embeddingsï¼‰</h3><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå…ˆè®© LLM ç”Ÿæˆä¸€ä¸ªã€Œå‡è®¾æ€§ç­”æ¡ˆæ–‡æ¡£ã€ï¼Œå†ç”¨è¿™ä¸ªæ–‡æ¡£å»æ£€ç´¢ã€‚</p><p><strong>ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ</strong></p><ul><li>é—®é¢˜å’Œç­”æ¡ˆçš„è¯­ä¹‰ç©ºé—´ä¸åŒ</li><li>ç”¨ã€Œç­”æ¡ˆã€æ£€ç´¢æ¯”ç”¨ã€Œé—®é¢˜ã€æ£€ç´¢æ›´ç²¾å‡†</li></ul><p><strong>æµç¨‹å›¾ï¼š</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">ç”¨æˆ·é—®é¢˜<br>    â”‚<br>    â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-keyword">LLM </span>ç”Ÿæˆå‡è®¾ç­”æ¡ˆ â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>    â”‚<br>    â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ å¯¹å‡è®¾ç­”æ¡ˆåšåµŒå…¥ â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>    â”‚<br>    â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ ç”¨åµŒå…¥å‘é‡æ£€ç´¢   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>    â”‚<br>    â–¼<br>  æ£€ç´¢ç»“æœ<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ï¼š</strong></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs 1c">é—®é¢˜<span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä»€ä¹ˆæ˜¯å‘é‡æ•°æ®åº“ï¼Ÿ&quot;</span><br><br>å‡è®¾ç­”æ¡ˆï¼ˆLLM ç”Ÿæˆï¼‰<span class="hljs-punctuation">:</span><br><span class="hljs-string">&quot;å‘é‡æ•°æ®åº“æ˜¯ä¸€ç§ä¸“é—¨ç”¨äºå­˜å‚¨å’Œæ£€ç´¢é«˜ç»´å‘é‡æ•°æ®çš„æ•°æ®åº“ç³»ç»Ÿã€‚</span><br>å®ƒæ”¯æŒç›¸ä¼¼æ€§æœç´¢ï¼Œå¸¸ç”¨äºæ¨èç³»ç»Ÿã€å›¾åƒæœç´¢ã€è¯­ä¹‰æœç´¢ç­‰åœºæ™¯ã€‚<br>å¸¸è§çš„å‘é‡æ•°æ®åº“åŒ…æ‹¬ Milvusã€Pineconeã€Weaviate ç­‰ã€‚<span class="hljs-string">&quot;</span><br><br>â†’ ç”¨è¿™æ®µæ–‡æœ¬çš„åµŒå…¥å‘é‡å»æ£€ç´¢ï¼Œæ¯”ç›´æ¥ç”¨é—®é¢˜æ£€ç´¢æ•ˆæœæ›´å¥½<br></code></pre></td></tr></table></figure><h3 id="4-æŸ¥è¯¢è·¯ç”±ï¼ˆQuery-Routingï¼‰"><a href="#4-æŸ¥è¯¢è·¯ç”±ï¼ˆQuery-Routingï¼‰" class="headerlink" title="4. æŸ¥è¯¢è·¯ç”±ï¼ˆQuery Routingï¼‰"></a>4. æŸ¥è¯¢è·¯ç”±ï¼ˆQuery Routingï¼‰</h3><p>æ ¹æ®æŸ¥è¯¢ç±»å‹ï¼Œå°†å…¶è·¯ç”±åˆ°æœ€åˆé€‚çš„æ£€ç´¢æºæˆ–å¤„ç†æµç¨‹ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">                 ç”¨æˆ·æŸ¥è¯¢<br>                     â”‚<br>                     â–¼<br>              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>              â”‚  è·¯ç”±åˆ¤æ–­å™¨  â”‚<br>              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                     â”‚<br>     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>     â–¼               â–¼               â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ å‘é‡åº“  â”‚    â”‚ çŸ¥è¯†å›¾è°± â”‚    â”‚ <span class="hljs-keyword">SQL</span>æ•°æ®åº“â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><p><strong>è·¯ç”±ç­–ç•¥ï¼š</strong></p><ul><li><strong>åŸºäºå…³é”®è¯</strong>ï¼šåŒ…å«ç‰¹å®šå…³é”®è¯èµ°ç‰¹å®šé€šé“</li><li><strong>åŸºäº LLM åˆ†ç±»</strong>ï¼šè®© LLM åˆ¤æ–­æŸ¥è¯¢ç±»å‹</li><li><strong>åŸºäºåµŒå…¥ç›¸ä¼¼åº¦</strong>ï¼šä¸é¢„è®¾ç±»åˆ«åµŒå…¥æ¯”è¾ƒ</li></ul><hr><h2 id="æ£€ç´¢ä¼˜åŒ–æŠ€æœ¯"><a href="#æ£€ç´¢ä¼˜åŒ–æŠ€æœ¯" class="headerlink" title="æ£€ç´¢ä¼˜åŒ–æŠ€æœ¯"></a>æ£€ç´¢ä¼˜åŒ–æŠ€æœ¯</h2><h3 id="1-æ··åˆæ£€ç´¢ï¼ˆHybrid-Searchï¼‰"><a href="#1-æ··åˆæ£€ç´¢ï¼ˆHybrid-Searchï¼‰" class="headerlink" title="1. æ··åˆæ£€ç´¢ï¼ˆHybrid Searchï¼‰"></a>1. æ··åˆæ£€ç´¢ï¼ˆHybrid Searchï¼‰</h3><p>ç»“åˆ<strong>å…³é”®è¯æ£€ç´¢</strong>å’Œ<strong>å‘é‡æ£€ç´¢</strong>çš„ä¼˜åŠ¿ã€‚</p><table><thead><tr><th>æ£€ç´¢æ–¹å¼</th><th>ä¼˜åŠ¿</th><th>åŠ£åŠ¿</th></tr></thead><tbody><tr><td><strong>å…³é”®è¯æ£€ç´¢</strong> (BM25)</td><td>ç²¾ç¡®åŒ¹é…ã€å¯è§£é‡Š</td><td>æ— æ³•ç†è§£è¯­ä¹‰</td></tr><tr><td><strong>å‘é‡æ£€ç´¢</strong> (Embedding)</td><td>è¯­ä¹‰ç†è§£ã€æ¨¡ç³ŠåŒ¹é…</td><td>å¯èƒ½ä¸¢å¤±å…³é”®è¯</td></tr><tr><td><strong>æ··åˆæ£€ç´¢</strong></td><td>å…¼é¡¾ç²¾ç¡®ä¸è¯­ä¹‰</td><td>éœ€è¦èåˆç­–ç•¥</td></tr></tbody></table><p><strong>èåˆç­–ç•¥ç¤ºä¾‹ï¼ˆRRF - Reciprocal Rank Fusionï¼‰ï¼š</strong></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">RRF_score = Î£ 1 / (k + rank_i)<br><br>å…¶ä¸­ï¼š<br><span class="hljs-bullet">- </span>k ä¸ºå¸¸æ•°ï¼ˆé€šå¸¸ä¸º 60ï¼‰<br><span class="hljs-bullet">- </span>rank_i ä¸ºæ–‡æ¡£åœ¨ç¬¬ i ä¸ªæ£€ç´¢ç»“æœä¸­çš„æ’å<br></code></pre></td></tr></table></figure><h3 id="2-é‡æ’åºï¼ˆRerankingï¼‰"><a href="#2-é‡æ’åºï¼ˆRerankingï¼‰" class="headerlink" title="2. é‡æ’åºï¼ˆRerankingï¼‰"></a>2. é‡æ’åºï¼ˆRerankingï¼‰</h3><p>å¯¹åˆæ­¥æ£€ç´¢ç»“æœè¿›è¡ŒäºŒæ¬¡æ’åºï¼Œæå‡ç›¸å…³æ€§ã€‚</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">æ£€ç´¢ç»“æœï¼ˆ<span class="hljs-built_in">Top</span> <span class="hljs-number">100</span>ï¼‰<br>        â”‚<br>        â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚   <span class="hljs-variable">Reranker</span> æ¨¡å‹  â”‚<br>â”‚  <span class="hljs-punctuation">(</span><span class="hljs-built_in">Cross</span><span class="hljs-operator">-</span><span class="hljs-variable">Encoder</span><span class="hljs-punctuation">)</span> â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>        â”‚<br>        â–¼<br>é‡æ’åºç»“æœï¼ˆ<span class="hljs-built_in">Top</span> <span class="hljs-number">10</span>ï¼‰<br></code></pre></td></tr></table></figure><p><strong>å¸¸ç”¨ Reranker æ¨¡å‹ï¼š</strong></p><ul><li><strong>Cohere Rerank</strong></li><li><strong>BGE Reranker</strong></li><li><strong>Jina Reranker</strong></li><li><strong>Cross-Encoder æ¨¡å‹</strong></li></ul><p><strong>Bi-Encoder vs Cross-Encoderï¼š</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Bi-Encoderï¼ˆç”¨äºåˆæ£€ç´¢ï¼Œå¿«ä½†ä¸å¤Ÿç²¾ç¡®ï¼‰:<br>  Query  â†’  <span class="hljs-selector-attr">[Encoder]</span>  â†’  å‘é‡<br>  Doc    â†’  <span class="hljs-selector-attr">[Encoder]</span>  â†’  å‘é‡<br>  ç›¸ä¼¼åº¦ = <span class="hljs-built_in">cosine</span>(Queryå‘é‡, Docå‘é‡)<br><br>Cross-Encoderï¼ˆç”¨äºé‡æ’åºï¼Œæ…¢ä½†ç²¾ç¡®ï¼‰:<br>  <span class="hljs-selector-attr">[Query, Doc]</span> â†’ <span class="hljs-selector-attr">[Encoder]</span> â†’ ç›¸å…³æ€§åˆ†æ•°<br>  ç›´æ¥è¾“å‡ºç›¸å…³æ€§ï¼Œæ›´å‡†ç¡®<br></code></pre></td></tr></table></figure><h3 id="3-å¤šè·¯å¬å›ï¼ˆMulti-way-Retrievalï¼‰"><a href="#3-å¤šè·¯å¬å›ï¼ˆMulti-way-Retrievalï¼‰" class="headerlink" title="3. å¤šè·¯å¬å›ï¼ˆMulti-way Retrievalï¼‰"></a>3. å¤šè·¯å¬å›ï¼ˆMulti-way Retrievalï¼‰</h3><p>ä»å¤šä¸ªç»´åº¦åŒæ—¶æ£€ç´¢ï¼Œæ‰©å¤§å¬å›èŒƒå›´ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs">          ç”¨æˆ·æŸ¥è¯¢<br>              â”‚<br>    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>    â–¼         â–¼         â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”<br>â”‚è¯­ä¹‰æ£€ç´¢â”‚ â”‚å…³é”®è¯ â”‚ â”‚çŸ¥è¯†å›¾è°±â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜<br>    â”‚         â”‚         â”‚<br>    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>              â–¼<br>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>        â”‚ç»“æœèåˆ  â”‚<br>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>              â”‚<br>              â–¼<br>          æœ€ç»ˆç»“æœ<br></code></pre></td></tr></table></figure><hr><h2 id="ç´¢å¼•ä¼˜åŒ–æŠ€æœ¯"><a href="#ç´¢å¼•ä¼˜åŒ–æŠ€æœ¯" class="headerlink" title="ç´¢å¼•ä¼˜åŒ–æŠ€æœ¯"></a>ç´¢å¼•ä¼˜åŒ–æŠ€æœ¯</h2><h3 id="1-åˆ†å—ç­–ç•¥ä¼˜åŒ–"><a href="#1-åˆ†å—ç­–ç•¥ä¼˜åŒ–" class="headerlink" title="1. åˆ†å—ç­–ç•¥ä¼˜åŒ–"></a>1. åˆ†å—ç­–ç•¥ä¼˜åŒ–</h3><p><strong>å¸¸è§åˆ†å—æ–¹æ³•ï¼š</strong></p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>å›ºå®šå¤§å°åˆ†å—</strong></td><td>æŒ‰å­—ç¬¦&#x2F;Token æ•°åˆ‡åˆ†</td><td>é€šç”¨åœºæ™¯</td></tr><tr><td><strong>è¯­ä¹‰åˆ†å—</strong></td><td>æŒ‰è¯­ä¹‰è¾¹ç•Œåˆ‡åˆ†</td><td>æ–‡ç« ã€æŠ¥å‘Š</td></tr><tr><td><strong>é€’å½’åˆ†å—</strong></td><td>æŒ‰æ ‡é¢˜å±‚çº§é€’å½’åˆ‡åˆ†</td><td>ç»“æ„åŒ–æ–‡æ¡£</td></tr><tr><td><strong>å¥å­çª—å£</strong></td><td>æ£€ç´¢å¥å­ + è¿”å›å‘¨å›´çª—å£</td><td>ç²¾ç¡®å®šä½</td></tr></tbody></table><p><strong>å¥å­çª—å£ï¼ˆSentence Windowï¼‰ç¤ºä¾‹ï¼š</strong></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">åŸå§‹æ–‡æ¡£:</span><br><span class="hljs-string">&quot;å¥å­1ã€‚å¥å­2ã€‚å¥å­3ã€‚å¥å­4ã€‚å¥å­5ã€‚&quot;</span><br><br><span class="hljs-section">ç´¢å¼•å•ä½: å¥å­3</span><br><span class="hljs-section">è¿”å›å†…å®¹: å¥å­2 + å¥å­3 + å¥å­4ï¼ˆçª—å£å¤§å°=1ï¼‰</span><br><br><span class="hljs-section">ä¼˜åŠ¿: ç´¢å¼•ç²’åº¦ç»†ï¼Œè¿”å›ä¸Šä¸‹æ–‡å®Œæ•´</span><br></code></pre></td></tr></table></figure><h3 id="2-å±‚æ¬¡åŒ–ç´¢å¼•ï¼ˆHierarchical-Indexingï¼‰"><a href="#2-å±‚æ¬¡åŒ–ç´¢å¼•ï¼ˆHierarchical-Indexingï¼‰" class="headerlink" title="2. å±‚æ¬¡åŒ–ç´¢å¼•ï¼ˆHierarchical Indexingï¼‰"></a>2. å±‚æ¬¡åŒ–ç´¢å¼•ï¼ˆHierarchical Indexingï¼‰</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs css">                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                  â”‚   æ–‡æ¡£æ‘˜è¦   â”‚  â† ç²—ç²’åº¦æ£€ç´¢<br>                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                        â”‚<br>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>        â–¼               â–¼               â–¼<br>   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>   â”‚ ç« èŠ‚æ‘˜è¦ â”‚    â”‚ ç« èŠ‚æ‘˜è¦ â”‚    â”‚ ç« èŠ‚æ‘˜è¦ â”‚  â† ä¸­ç²’åº¦<br>   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>        â”‚<br>  â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”<br>  â–¼     â–¼     â–¼<br><span class="hljs-selector-attr">[æ®µè½]</span> <span class="hljs-selector-attr">[æ®µè½]</span> <span class="hljs-selector-attr">[æ®µè½]</span>  â† ç»†ç²’åº¦æ£€ç´¢<br></code></pre></td></tr></table></figure><p><strong>æ£€ç´¢æµç¨‹ï¼š</strong></p><ol><li>å…ˆç”¨æ‘˜è¦å¿«é€Ÿå®šä½ç›¸å…³æ–‡æ¡£</li><li>å†æ·±å…¥æ£€ç´¢å…·ä½“æ®µè½</li></ol><h3 id="3-çˆ¶å­æ–‡æ¡£ç´¢å¼•ï¼ˆParent-Child-Indexingï¼‰"><a href="#3-çˆ¶å­æ–‡æ¡£ç´¢å¼•ï¼ˆParent-Child-Indexingï¼‰" class="headerlink" title="3. çˆ¶å­æ–‡æ¡£ç´¢å¼•ï¼ˆParent-Child Indexingï¼‰"></a>3. çˆ¶å­æ–‡æ¡£ç´¢å¼•ï¼ˆParent-Child Indexingï¼‰</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs makefile">çˆ¶æ–‡æ¡£ï¼ˆç”¨äºè¿”å›ï¼ŒåŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡ï¼‰<br>â”œâ”€â”€ å­å—1ï¼ˆç”¨äºæ£€ç´¢ï¼Œç²¾ç¡®åŒ¹é…ï¼‰<br>â”œâ”€â”€ å­å—2<br>â””â”€â”€ å­å—3<br><br><span class="hljs-section">æ£€ç´¢æ—¶: åŒ¹é…å­å—</span><br><span class="hljs-section">è¿”å›æ—¶: è¿”å›çˆ¶æ–‡æ¡£</span><br></code></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿ï¼š</strong></p><ul><li>æ£€ç´¢ç²¾ç¡®ï¼ˆå°å—åŒ¹é…åº¦é«˜ï¼‰</li><li>ä¸Šä¸‹æ–‡å®Œæ•´ï¼ˆè¿”å›å¤§å—å†…å®¹ï¼‰</li></ul><hr><h2 id="åæ£€ç´¢ä¼˜åŒ–æŠ€æœ¯"><a href="#åæ£€ç´¢ä¼˜åŒ–æŠ€æœ¯" class="headerlink" title="åæ£€ç´¢ä¼˜åŒ–æŠ€æœ¯"></a>åæ£€ç´¢ä¼˜åŒ–æŠ€æœ¯</h2><h3 id="1-ä¸Šä¸‹æ–‡å‹ç¼©ï¼ˆContext-Compressionï¼‰"><a href="#1-ä¸Šä¸‹æ–‡å‹ç¼©ï¼ˆContext-Compressionï¼‰" class="headerlink" title="1. ä¸Šä¸‹æ–‡å‹ç¼©ï¼ˆContext Compressionï¼‰"></a>1. ä¸Šä¸‹æ–‡å‹ç¼©ï¼ˆContext Compressionï¼‰</h3><p>ç§»é™¤æ£€ç´¢ç»“æœä¸­ä¸é—®é¢˜æ— å…³çš„å†…å®¹ï¼ŒèŠ‚çœ Tokenã€‚</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs 1c">åŸå§‹æ£€ç´¢ç»“æœï¼ˆ<span class="hljs-number">1000</span> Tokenï¼‰<span class="hljs-punctuation">:</span><br><span class="hljs-string">&quot;æœ¬æ–‡ä»‹ç»äº†æœºå™¨å­¦ä¹ çš„åŸºç¡€çŸ¥è¯†...ï¼ˆå¤§é‡èƒŒæ™¯ä¿¡æ¯ï¼‰...</span><br>å…¶ä¸­ï¼Œå‘é‡æ•°æ®åº“æ˜¯...ï¼ˆç›¸å…³å†…å®¹ï¼‰...<br>å‚è€ƒæ–‡çŒ®ï¼š...<span class="hljs-string">&quot;</span><br><br>å‹ç¼©åï¼ˆ<span class="hljs-number">200</span> Tokenï¼‰<span class="hljs-punctuation">:</span><br><span class="hljs-string">&quot;å‘é‡æ•°æ®åº“æ˜¯ä¸€ç§ä¸“é—¨å­˜å‚¨é«˜ç»´å‘é‡çš„æ•°æ®åº“...&quot;</span><br><br>å‹ç¼©ç‡<span class="hljs-punctuation">:</span> <span class="hljs-number">80</span>%<br></code></pre></td></tr></table></figure><p><strong>å®ç°æ–¹å¼ï¼š</strong></p><ul><li><strong>LLM å‹ç¼©</strong>ï¼šè®© LLM æå–ç›¸å…³å†…å®¹</li><li><strong>LLMLingua</strong>ï¼šåŸºäºå›°æƒ‘åº¦çš„å‹ç¼©</li><li><strong>Recomp</strong>ï¼šæŠ½å–å¼&#x2F;ç”Ÿæˆå¼å‹ç¼©</li></ul><h3 id="2-å»é‡ä¸è¿‡æ»¤"><a href="#2-å»é‡ä¸è¿‡æ»¤" class="headerlink" title="2. å»é‡ä¸è¿‡æ»¤"></a>2. å»é‡ä¸è¿‡æ»¤</h3><ul><li><strong>è¯­ä¹‰å»é‡</strong>ï¼šåˆå¹¶è¯­ä¹‰ç›¸ä¼¼çš„æ£€ç´¢ç»“æœ</li><li><strong>ç›¸å…³æ€§è¿‡æ»¤</strong>ï¼šç§»é™¤ç›¸å…³æ€§ä½äºé˜ˆå€¼çš„ç»“æœ</li><li><strong>å…ƒæ•°æ®è¿‡æ»¤</strong>ï¼šæŒ‰æ—¶é—´ã€æ¥æºç­‰æ¡ä»¶è¿‡æ»¤</li></ul><h3 id="3-ä¸Šä¸‹æ–‡é‡ç»„"><a href="#3-ä¸Šä¸‹æ–‡é‡ç»„" class="headerlink" title="3. ä¸Šä¸‹æ–‡é‡ç»„"></a>3. ä¸Šä¸‹æ–‡é‡ç»„</h3><p>å°†æ£€ç´¢ç»“æœæŒ‰é€»è¾‘é¡ºåºé‡ç»„ï¼Œæå‡ç”Ÿæˆè´¨é‡ã€‚</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs markdown">æ£€ç´¢é¡ºåºï¼ˆæŒ‰ç›¸å…³æ€§ï¼‰:<br><span class="hljs-bullet">1.</span> ç»“è®ºæ®µè½<br><span class="hljs-bullet">2.</span> èƒŒæ™¯æ®µè½<br><span class="hljs-bullet">3.</span> æ–¹æ³•æ®µè½<br><br>é‡ç»„é¡ºåºï¼ˆæŒ‰é€»è¾‘ï¼‰:<br><span class="hljs-bullet">1.</span> èƒŒæ™¯æ®µè½<br><span class="hljs-bullet">2.</span> æ–¹æ³•æ®µè½<br><span class="hljs-bullet">3.</span> ç»“è®ºæ®µè½<br></code></pre></td></tr></table></figure><hr><h2 id="é«˜çº§-RAG-èŒƒå¼"><a href="#é«˜çº§-RAG-èŒƒå¼" class="headerlink" title="é«˜çº§ RAG èŒƒå¼"></a>é«˜çº§ RAG èŒƒå¼</h2><h3 id="1-Self-RAGï¼ˆè‡ªåæ€-RAGï¼‰"><a href="#1-Self-RAGï¼ˆè‡ªåæ€-RAGï¼‰" class="headerlink" title="1. Self-RAGï¼ˆè‡ªåæ€ RAGï¼‰"></a>1. Self-RAGï¼ˆè‡ªåæ€ RAGï¼‰</h3><p>æ¨¡å‹åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­<strong>è‡ªæˆ‘è¯„ä¼°</strong>æ˜¯å¦éœ€è¦æ£€ç´¢ã€æ£€ç´¢ç»“æœæ˜¯å¦ç›¸å…³ã€ç”Ÿæˆæ˜¯å¦ç¬¦åˆäº‹å®ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                    Self-RAG æµç¨‹                     â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚  <span class="hljs-number">1</span>. <span class="hljs-selector-attr">[Retrieve]</span> æ˜¯å¦éœ€è¦æ£€ç´¢ï¼Ÿ                        â”‚<br>â”‚     â†’ Yes/No                                        â”‚<br>â”‚                                                     â”‚<br>â”‚  <span class="hljs-number">2</span>. <span class="hljs-selector-attr">[IsRel]</span> æ£€ç´¢ç»“æœæ˜¯å¦ç›¸å…³ï¼Ÿ                       â”‚<br>â”‚     â†’ Relevant/Irrelevant                           â”‚<br>â”‚                                                     â”‚<br>â”‚  <span class="hljs-number">3</span>. <span class="hljs-selector-attr">[IsSup]</span> ç”Ÿæˆå†…å®¹æ˜¯å¦æœ‰æ£€ç´¢æ”¯æŒï¼Ÿ                 â”‚<br>â”‚     â†’ Fully/Partially/No Support                    â”‚<br>â”‚                                                     â”‚<br>â”‚  <span class="hljs-number">4</span>. <span class="hljs-selector-attr">[IsUse]</span> ç”Ÿæˆå†…å®¹æ˜¯å¦æœ‰ç”¨ï¼Ÿ                       â”‚<br>â”‚     â†’ <span class="hljs-number">1</span>-<span class="hljs-number">5</span> åˆ†                                        â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="2-CRAGï¼ˆCorrective-RAGï¼‰"><a href="#2-CRAGï¼ˆCorrective-RAGï¼‰" class="headerlink" title="2. CRAGï¼ˆCorrective RAGï¼‰"></a>2. CRAGï¼ˆCorrective RAGï¼‰</h3><p>å¸¦æœ‰<strong>çº é”™æœºåˆ¶</strong>çš„ RAGï¼Œèƒ½å¤Ÿè¯†åˆ«å¹¶ä¿®æ­£æ£€ç´¢é”™è¯¯ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs">ç”¨æˆ·æŸ¥è¯¢<br>    â”‚<br>    â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚   åˆæ¬¡æ£€ç´¢   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>    â”‚<br>    â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ ç›¸å…³æ€§è¯„ä¼°  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>    â”‚<br>    â”œâ”€â”€ ç›¸å…³ â†’ ç›´æ¥ä½¿ç”¨<br>    â”‚<br>    â”œâ”€â”€ æ¨¡ç³Š â†’ çŸ¥è¯†ç²¾ç‚¼ï¼ˆæå–å…³é”®ä¿¡æ¯ï¼‰<br>    â”‚<br>    â””â”€â”€ ä¸ç›¸å…³ â†’ è§¦å‘ç½‘ç»œæœç´¢<br>              â”‚<br>              â–¼<br>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>        â”‚  çŸ¥è¯†é‡è·å–  â”‚<br>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="3-RAG-Fusion"><a href="#3-RAG-Fusion" class="headerlink" title="3. RAG Fusion"></a>3. RAG Fusion</h3><p>æ‰§è¡Œå¤šä¸ªæ”¹å†™æŸ¥è¯¢çš„æ£€ç´¢ï¼Œç„¶åèåˆç»“æœã€‚</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs tap">åŸå§‹æŸ¥è¯¢<br>    â”‚<br>    â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ ç”Ÿæˆå¤šä¸ªæ”¹å†™ â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>    â”‚<br>    â”œâ”€â”€ æ”¹å†™æŸ¥è¯¢<span class="hljs-number"> 1 </span>â†’ æ£€ç´¢ç»“æœ 1<br>    â”œâ”€â”€ æ”¹å†™æŸ¥è¯¢<span class="hljs-number"> 2 </span>â†’ æ£€ç´¢ç»“æœ 2<br>    â”œâ”€â”€ æ”¹å†™æŸ¥è¯¢<span class="hljs-number"> 3 </span>â†’ æ£€ç´¢ç»“æœ 3<br>    â””â”€â”€ æ”¹å†™æŸ¥è¯¢<span class="hljs-number"> 4 </span>â†’ æ£€ç´¢ç»“æœ 4<br>              â”‚<br>              â–¼<br>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>        â”‚  RRF èåˆ   â”‚<br>        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>              â”‚<br>              â–¼<br>          æœ€ç»ˆç»“æœ<br></code></pre></td></tr></table></figure><hr><h2 id="è¯„ä¼°æŒ‡æ ‡"><a href="#è¯„ä¼°æŒ‡æ ‡" class="headerlink" title="è¯„ä¼°æŒ‡æ ‡"></a>è¯„ä¼°æŒ‡æ ‡</h2><h3 id="æ£€ç´¢è´¨é‡è¯„ä¼°"><a href="#æ£€ç´¢è´¨é‡è¯„ä¼°" class="headerlink" title="æ£€ç´¢è´¨é‡è¯„ä¼°"></a>æ£€ç´¢è´¨é‡è¯„ä¼°</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>è¯´æ˜</th><th>å…¬å¼</th></tr></thead><tbody><tr><td><strong>Recall@K</strong></td><td>Top-K ä¸­åŒ…å«æ­£ç¡®ç­”æ¡ˆçš„æ¯”ä¾‹</td><td>ç›¸å…³æ–‡æ¡£æ•° &#x2F; æ€»ç›¸å…³æ–‡æ¡£æ•°</td></tr><tr><td><strong>Precision@K</strong></td><td>Top-K ä¸­ç›¸å…³æ–‡æ¡£çš„æ¯”ä¾‹</td><td>ç›¸å…³æ–‡æ¡£æ•° &#x2F; K</td></tr><tr><td><strong>MRR</strong></td><td>ç¬¬ä¸€ä¸ªæ­£ç¡®ç»“æœçš„æ’åå€’æ•°</td><td>1 &#x2F; rank</td></tr><tr><td><strong>NDCG</strong></td><td>å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢ç›Š</td><td>è€ƒè™‘ä½ç½®çš„ç›¸å…³æ€§è¯„åˆ†</td></tr></tbody></table><h3 id="ç”Ÿæˆè´¨é‡è¯„ä¼°"><a href="#ç”Ÿæˆè´¨é‡è¯„ä¼°" class="headerlink" title="ç”Ÿæˆè´¨é‡è¯„ä¼°"></a>ç”Ÿæˆè´¨é‡è¯„ä¼°</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Faithfulness</strong></td><td>ç”Ÿæˆå†…å®¹æ˜¯å¦å¿ äºæ£€ç´¢ç»“æœ</td></tr><tr><td><strong>Answer Relevancy</strong></td><td>ç­”æ¡ˆä¸é—®é¢˜çš„ç›¸å…³æ€§</td></tr><tr><td><strong>Context Relevancy</strong></td><td>ä¸Šä¸‹æ–‡ä¸é—®é¢˜çš„ç›¸å…³æ€§</td></tr><tr><td><strong>Hallucination Rate</strong></td><td>å¹»è§‰æ¯”ä¾‹</td></tr></tbody></table><h3 id="å¸¸ç”¨è¯„ä¼°æ¡†æ¶"><a href="#å¸¸ç”¨è¯„ä¼°æ¡†æ¶" class="headerlink" title="å¸¸ç”¨è¯„ä¼°æ¡†æ¶"></a>å¸¸ç”¨è¯„ä¼°æ¡†æ¶</h3><ul><li><strong>RAGAS</strong>ï¼šä¸“é—¨ç”¨äº RAG è¯„ä¼°çš„æ¡†æ¶</li><li><strong>TruLens</strong>ï¼šLLM åº”ç”¨è¯„ä¼°å·¥å…·</li><li><strong>LangSmith</strong>ï¼šLangChain çš„è¯„ä¼°è¿½è¸ªå·¥å…·</li></ul><hr><h2 id="æŠ€æœ¯é€‰å‹å»ºè®®"><a href="#æŠ€æœ¯é€‰å‹å»ºè®®" class="headerlink" title="æŠ€æœ¯é€‰å‹å»ºè®®"></a>æŠ€æœ¯é€‰å‹å»ºè®®</h2><h3 id="åœºæ™¯å¯¹åº”æ–¹æ¡ˆ"><a href="#åœºæ™¯å¯¹åº”æ–¹æ¡ˆ" class="headerlink" title="åœºæ™¯å¯¹åº”æ–¹æ¡ˆ"></a>åœºæ™¯å¯¹åº”æ–¹æ¡ˆ</h3><table><thead><tr><th>åœºæ™¯</th><th>æ¨èæŠ€æœ¯</th></tr></thead><tbody><tr><td><strong>ç²¾ç¡®åŒ¹é…é‡è¦</strong></td><td>æ··åˆæ£€ç´¢ï¼ˆBM25 + Vectorï¼‰</td></tr><tr><td><strong>é•¿æ–‡æ¡£ç†è§£</strong></td><td>å±‚æ¬¡åŒ–ç´¢å¼• + çˆ¶å­æ–‡æ¡£</td></tr><tr><td><strong>å¤šæºæ•°æ®</strong></td><td>æŸ¥è¯¢è·¯ç”± + å¤šè·¯å¬å›</td></tr><tr><td><strong>Token å—é™</strong></td><td>ä¸Šä¸‹æ–‡å‹ç¼© + é‡æ’åº</td></tr><tr><td><strong>é«˜å‡†ç¡®æ€§è¦æ±‚</strong></td><td>Self-RAG &#x2F; CRAG</td></tr></tbody></table><h3 id="æŠ€æœ¯æ ˆæ¨è"><a href="#æŠ€æœ¯æ ˆæ¨è" class="headerlink" title="æŠ€æœ¯æ ˆæ¨è"></a>æŠ€æœ¯æ ˆæ¨è</h3><table><thead><tr><th>ç»„ä»¶</th><th>æ¨èå·¥å…·</th></tr></thead><tbody><tr><td><strong>å‘é‡æ•°æ®åº“</strong></td><td>Milvusã€Qdrantã€Weaviateã€Chroma</td></tr><tr><td><strong>Embedding æ¨¡å‹</strong></td><td>BGEã€GTEã€Jinaã€OpenAI Embedding</td></tr><tr><td><strong>Reranker</strong></td><td>BGE Rerankerã€Cohere Rerank</td></tr><tr><td><strong>æ¡†æ¶</strong></td><td>LangChainã€LlamaIndexã€Haystack</td></tr></tbody></table><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Advanced RAG é€šè¿‡åœ¨ RAG ç®¡é“çš„å„ä¸ªé˜¶æ®µå¼•å…¥ä¼˜åŒ–æŠ€æœ¯ï¼Œç³»ç»Ÿæ€§åœ°æå‡äº†æ£€ç´¢å¢å¼ºç”Ÿæˆçš„æ•ˆæœï¼š</p><ol><li><strong>é¢„æ£€ç´¢</strong>ï¼šæŸ¥è¯¢æ”¹å†™ã€æ‰©å±•ã€è·¯ç”±ã€HyDE</li><li><strong>æ£€ç´¢</strong>ï¼šæ··åˆæ£€ç´¢ã€å¤šè·¯å¬å›ã€é‡æ’åº</li><li><strong>ç´¢å¼•</strong>ï¼šåˆ†å—ä¼˜åŒ–ã€å±‚æ¬¡ç´¢å¼•ã€çˆ¶å­æ–‡æ¡£</li><li><strong>åæ£€ç´¢</strong>ï¼šä¸Šä¸‹æ–‡å‹ç¼©ã€å»é‡ã€é‡ç»„</li><li><strong>é«˜çº§èŒƒå¼</strong>ï¼šSelf-RAGã€CRAGã€RAG Fusion</li></ol><p>é€‰æ‹©åˆé€‚çš„æŠ€æœ¯ç»„åˆéœ€è¦æ ¹æ®å…·ä½“åœºæ™¯æƒè¡¡<strong>å‡†ç¡®æ€§ã€å»¶è¿Ÿã€æˆæœ¬</strong>ä¸‰è€…çš„å…³ç³»ã€‚</p><hr><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>RAG åŸºç¡€</li><li>Agent æ¶æ„</li><li>Prompt Engineering</li></ul>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RAG</tag>
      
      <tag>Advanced-RAG</tag>
      
      <tag>LLM</tag>
      
      <tag>æ£€ç´¢å¢å¼ºç”Ÿæˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RAGæŠ€æœ¯è¯¦è§£</title>
    <link href="/2026/01/13/RAG%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/13/RAG%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="RAG-æŠ€æœ¯è¯¦è§£"><a href="#RAG-æŠ€æœ¯è¯¦è§£" class="headerlink" title="RAG æŠ€æœ¯è¯¦è§£"></a>RAG æŠ€æœ¯è¯¦è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>RAGï¼ˆRetrieval-Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong> æ˜¯ä¸€ç§ç»“åˆä¿¡æ¯æ£€ç´¢ä¸å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆèƒ½åŠ›çš„æŠ€æœ¯æ¶æ„ï¼Œé€šè¿‡ä»å¤–éƒ¨çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯æ¥å¢å¼º LLM çš„å›ç­”è´¨é‡ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-RAGï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-RAGï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ RAGï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ RAGï¼Ÿ</h3><table><thead><tr><th>é—®é¢˜</th><th>è¯´æ˜</th><th>RAG è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>çŸ¥è¯†æ—¶æ•ˆæ€§</td><td>LLM è®­ç»ƒæ•°æ®æœ‰æˆªæ­¢æ—¥æœŸ</td><td>å®æ—¶æ£€ç´¢æœ€æ–°æ–‡æ¡£</td></tr><tr><td>å¹»è§‰é—®é¢˜</td><td>LLM å¯èƒ½ç¼–é€ äº‹å®</td><td>åŸºäºçœŸå®æ–‡æ¡£ç”Ÿæˆ</td></tr><tr><td>ç§æœ‰çŸ¥è¯†</td><td>LLM ä¸äº†è§£ä¼ä¸šå†…éƒ¨æ•°æ®</td><td>æ¥å…¥ç§æœ‰çŸ¥è¯†åº“</td></tr><tr><td>å¯è¿½æº¯æ€§</td><td>æ— æ³•éªŒè¯ç­”æ¡ˆæ¥æº</td><td>æä¾›å¼•ç”¨æ¥æº</td></tr></tbody></table><h2 id="RAG-å­¦ä¹ è·¯çº¿"><a href="#RAG-å­¦ä¹ è·¯çº¿" class="headerlink" title="RAG å­¦ä¹ è·¯çº¿"></a>RAG å­¦ä¹ è·¯çº¿</h2><pre><code class=" mermaid">graph TD    A[RAGåŸºç¡€æ¦‚å¿µ] --&gt; B[æ–‡æ¡£å¤„ç†]    A --&gt; C[EmbeddingåŸç†]    B --&gt; D[æ–‡æœ¬åˆ†å‰²ç­–ç•¥]    C --&gt; E[å‘é‡æ•°æ®åº“]    D --&gt; F[æ£€ç´¢ç­–ç•¥]    E --&gt; F    F --&gt; G[Naive RAG]    G --&gt; H[Advanced RAG]    H --&gt; I[Modular RAG]    I --&gt; J[ä¼ä¸šçº§RAG]        style G fill:#e1f5fe    style H fill:#fff3e0    style I fill:#f3e5f5</code></pre><h3 id="é˜¶æ®µä¸€ï¼šåŸºç¡€æ¦‚å¿µï¼ˆ3-5å¤©ï¼‰"><a href="#é˜¶æ®µä¸€ï¼šåŸºç¡€æ¦‚å¿µï¼ˆ3-5å¤©ï¼‰" class="headerlink" title="é˜¶æ®µä¸€ï¼šåŸºç¡€æ¦‚å¿µï¼ˆ3-5å¤©ï¼‰"></a>é˜¶æ®µä¸€ï¼šåŸºç¡€æ¦‚å¿µï¼ˆ3-5å¤©ï¼‰</h3><table><thead><tr><th>å­¦ä¹ å†…å®¹</th><th>æ—¶é—´</th><th>ä¼˜å…ˆçº§</th><th>äº§å‡º</th></tr></thead><tbody><tr><td>RAG æ ¸å¿ƒåŸç†</td><td>1å¤©</td><td>â­â­â­</td><td>ç†è§£æ£€ç´¢+ç”Ÿæˆæµç¨‹</td></tr><tr><td>Embedding æ¨¡å‹é€‰å‹</td><td>1å¤©</td><td>â­â­â­</td><td>æŒæ¡ä¸»æµæ¨¡å‹å·®å¼‚</td></tr><tr><td>å‘é‡ç›¸ä¼¼åº¦è®¡ç®—</td><td>1å¤©</td><td>â­â­</td><td>ä½™å¼¦ç›¸ä¼¼åº¦ã€æ¬§æ°è·ç¦»</td></tr><tr><td>å‘é‡æ•°æ®åº“å…¥é—¨</td><td>2å¤©</td><td>â­â­â­</td><td>å®Œæˆ Milvus&#x2F;Chroma éƒ¨ç½²</td></tr></tbody></table><h3 id="é˜¶æ®µäºŒï¼šæ ¸å¿ƒæµç¨‹å®ç°ï¼ˆ1-2å‘¨ï¼‰"><a href="#é˜¶æ®µäºŒï¼šæ ¸å¿ƒæµç¨‹å®ç°ï¼ˆ1-2å‘¨ï¼‰" class="headerlink" title="é˜¶æ®µäºŒï¼šæ ¸å¿ƒæµç¨‹å®ç°ï¼ˆ1-2å‘¨ï¼‰"></a>é˜¶æ®µäºŒï¼šæ ¸å¿ƒæµç¨‹å®ç°ï¼ˆ1-2å‘¨ï¼‰</h3><table><thead><tr><th>å­¦ä¹ å†…å®¹</th><th>æ—¶é—´</th><th>ä¼˜å…ˆçº§</th><th>äº§å‡º</th></tr></thead><tbody><tr><td>æ–‡æ¡£åŠ è½½å™¨</td><td>2å¤©</td><td>â­â­â­</td><td>PDF&#x2F;Word&#x2F;ç½‘é¡µè§£æ</td></tr><tr><td>æ–‡æœ¬åˆ†å‰²ç­–ç•¥</td><td>2å¤©</td><td>â­â­â­</td><td>ç†è§£ Chunk ç­–ç•¥</td></tr><tr><td>ç´¢å¼•æ„å»º</td><td>2å¤©</td><td>â­â­â­</td><td>å®Œæˆæ–‡æ¡£å‘é‡åŒ–</td></tr><tr><td>æ£€ç´¢å®ç°</td><td>2å¤©</td><td>â­â­â­</td><td>å®ç°ç›¸ä¼¼åº¦æœç´¢</td></tr><tr><td>Prompt æ¨¡æ¿è®¾è®¡</td><td>1å¤©</td><td>â­â­</td><td>è®¾è®¡ RAG ä¸“ç”¨æ¨¡æ¿</td></tr></tbody></table><h3 id="é˜¶æ®µä¸‰ï¼šè¿›é˜¶ä¼˜åŒ–ï¼ˆ2-3å‘¨ï¼‰"><a href="#é˜¶æ®µä¸‰ï¼šè¿›é˜¶ä¼˜åŒ–ï¼ˆ2-3å‘¨ï¼‰" class="headerlink" title="é˜¶æ®µä¸‰ï¼šè¿›é˜¶ä¼˜åŒ–ï¼ˆ2-3å‘¨ï¼‰"></a>é˜¶æ®µä¸‰ï¼šè¿›é˜¶ä¼˜åŒ–ï¼ˆ2-3å‘¨ï¼‰</h3><table><thead><tr><th>å­¦ä¹ å†…å®¹</th><th>æ—¶é—´</th><th>ä¼˜å…ˆçº§</th><th>äº§å‡º</th></tr></thead><tbody><tr><td>æ··åˆæ£€ç´¢</td><td>3å¤©</td><td>â­â­â­</td><td>å‘é‡+å…³é”®è¯æ£€ç´¢</td></tr><tr><td>é‡æ’åºï¼ˆRerankï¼‰</td><td>2å¤©</td><td>â­â­â­</td><td>æå‡æ£€ç´¢ç²¾åº¦</td></tr><tr><td>æŸ¥è¯¢æ”¹å†™</td><td>2å¤©</td><td>â­â­</td><td>HyDEã€Query Expansion</td></tr><tr><td>å¤šè½®å¯¹è¯ç®¡ç†</td><td>2å¤©</td><td>â­â­</td><td>å¯¹è¯å†å²å¤„ç†</td></tr><tr><td>è¯„ä¼°æŒ‡æ ‡</td><td>2å¤©</td><td>â­â­â­</td><td>Recallã€MRRã€RAGAS</td></tr></tbody></table><h3 id="é˜¶æ®µå››ï¼šç”Ÿäº§çº§å®è·µï¼ˆæŒç»­ï¼‰"><a href="#é˜¶æ®µå››ï¼šç”Ÿäº§çº§å®è·µï¼ˆæŒç»­ï¼‰" class="headerlink" title="é˜¶æ®µå››ï¼šç”Ÿäº§çº§å®è·µï¼ˆæŒç»­ï¼‰"></a>é˜¶æ®µå››ï¼šç”Ÿäº§çº§å®è·µï¼ˆæŒç»­ï¼‰</h3><ul><li>åˆ†å¸ƒå¼å‘é‡å­˜å‚¨</li><li>å¢é‡ç´¢å¼•æ›´æ–°</li><li>å¤šç§Ÿæˆ·éš”ç¦»</li><li>ç¼“å­˜ç­–ç•¥</li><li>ç›‘æ§ä¸å¯è§‚æµ‹æ€§</li></ul><h2 id="RAG-æ ¸å¿ƒæ¶æ„"><a href="#RAG-æ ¸å¿ƒæ¶æ„" class="headerlink" title="RAG æ ¸å¿ƒæ¶æ„"></a>RAG æ ¸å¿ƒæ¶æ„</h2><h3 id="æ ‡å‡†æµç¨‹"><a href="#æ ‡å‡†æµç¨‹" class="headerlink" title="æ ‡å‡†æµç¨‹"></a>æ ‡å‡†æµç¨‹</h3><pre><code class=" mermaid">graph LR    subgraph ç¦»çº¿ç´¢å¼•        A[åŸå§‹æ–‡æ¡£] --&gt; B[æ–‡æ¡£åŠ è½½]        B --&gt; C[æ–‡æœ¬åˆ†å‰²]        C --&gt; D[Embedding]        D --&gt; E[(å‘é‡æ•°æ®åº“)]    end        subgraph åœ¨çº¿æŸ¥è¯¢        F[ç”¨æˆ·é—®é¢˜] --&gt; G[Query Embedding]        G --&gt; H[å‘é‡æ£€ç´¢]        E --&gt; H        H --&gt; I[ç›¸å…³æ–‡æ¡£]        I --&gt; J[Promptæ„å»º]        F --&gt; J        J --&gt; K[LLMç”Ÿæˆ]        K --&gt; L[å›ç­”]    end</code></pre><h3 id="æ ¸å¿ƒç»„ä»¶è¯´æ˜"><a href="#æ ¸å¿ƒç»„ä»¶è¯´æ˜" class="headerlink" title="æ ¸å¿ƒç»„ä»¶è¯´æ˜"></a>æ ¸å¿ƒç»„ä»¶è¯´æ˜</h3><table><thead><tr><th>ç»„ä»¶</th><th>ä½œç”¨</th><th>å¸¸ç”¨å·¥å…·</th></tr></thead><tbody><tr><td>Document Loader</td><td>åŠ è½½å¤šç§æ ¼å¼æ–‡æ¡£</td><td>LangChain Loaders, Unstructured</td></tr><tr><td>Text Splitter</td><td>æ–‡æœ¬åˆ†å—</td><td>RecursiveCharacterTextSplitter</td></tr><tr><td>Embedding Model</td><td>æ–‡æœ¬å‘é‡åŒ–</td><td>OpenAI Ada, BGE, M3E</td></tr><tr><td>Vector Store</td><td>å‘é‡å­˜å‚¨ä¸æ£€ç´¢</td><td>Milvus, Pinecone, Chroma</td></tr><tr><td>Retriever</td><td>æ£€ç´¢ç­–ç•¥å°è£…</td><td>MultiQueryRetriever, SelfQueryRetriever</td></tr><tr><td>LLM</td><td>ç­”æ¡ˆç”Ÿæˆ</td><td>GPT-4, Claude, é€šä¹‰åƒé—®</td></tr></tbody></table><h2 id="RAG-æŠ€æœ¯æ¼”è¿›å¯¹æ¯”"><a href="#RAG-æŠ€æœ¯æ¼”è¿›å¯¹æ¯”" class="headerlink" title="RAG æŠ€æœ¯æ¼”è¿›å¯¹æ¯”"></a>RAG æŠ€æœ¯æ¼”è¿›å¯¹æ¯”</h2><h3 id="ä¸‰ä»£-RAG-æ¶æ„å¯¹æ¯”"><a href="#ä¸‰ä»£-RAG-æ¶æ„å¯¹æ¯”" class="headerlink" title="ä¸‰ä»£ RAG æ¶æ„å¯¹æ¯”"></a>ä¸‰ä»£ RAG æ¶æ„å¯¹æ¯”</h3><table><thead><tr><th>ç»´åº¦</th><th>Naive RAG</th><th>Advanced RAG</th><th>Modular RAG</th></tr></thead><tbody><tr><td><strong>æ¶æ„</strong></td><td>çº¿æ€§æµæ°´çº¿</td><td>ä¼˜åŒ–æµæ°´çº¿</td><td>æ¨¡å—åŒ–ç»„åˆ</td></tr><tr><td><strong>ç´¢å¼•</strong></td><td>ç®€å•åˆ†å—</td><td>å±‚æ¬¡ç´¢å¼•ã€çˆ¶å­å—</td><td>å¤šç§ç´¢å¼•ç­–ç•¥</td></tr><tr><td><strong>æ£€ç´¢</strong></td><td>å•æ¬¡å‘é‡æ£€ç´¢</td><td>æ··åˆæ£€ç´¢ + é‡æ’</td><td>å¤šè·¯å¬å› + èåˆ</td></tr><tr><td><strong>ç”Ÿæˆ</strong></td><td>ç›´æ¥æ‹¼æ¥ä¸Šä¸‹æ–‡</td><td>å‹ç¼©&#x2F;ç­›é€‰ä¸Šä¸‹æ–‡</td><td>è‡ªé€‚åº”ç”Ÿæˆ</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>åŸå‹éªŒè¯</td><td>ç”Ÿäº§ç¯å¢ƒ</td><td>å¤æ‚ä¼ä¸šåœºæ™¯</td></tr></tbody></table><h3 id="Naive-RAG"><a href="#Naive-RAG" class="headerlink" title="Naive RAG"></a>Naive RAG</h3><p>æœ€åŸºç¡€çš„ RAG å®ç°ï¼Œæµç¨‹ç®€å•ä½†å­˜åœ¨æ˜æ˜¾ç¼ºé™·ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">ç”¨æˆ·é—®é¢˜ â†’ <span class="hljs-variable">Embedding</span> â†’ å‘é‡æ£€ç´¢ â†’ <span class="hljs-built_in">Top</span><span class="hljs-operator">-</span><span class="hljs-built_in">K</span> æ–‡æ¡£ â†’ æ‹¼æ¥ <span class="hljs-variable">Prompt</span> â†’ <span class="hljs-variable">LLM</span> å›ç­”<br></code></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°ç®€å•ã€å¿«é€Ÿä¸Šæ‰‹<br><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>æ£€ç´¢è´¨é‡ä¾èµ–åˆ†å—ç­–ç•¥</li><li>æ— æ³•å¤„ç†å¤æ‚æŸ¥è¯¢</li><li>ä¸Šä¸‹æ–‡åˆ©ç”¨ç‡ä½</li></ul><h3 id="Advanced-RAG"><a href="#Advanced-RAG" class="headerlink" title="Advanced RAG"></a>Advanced RAG</h3><p>åœ¨ Naive RAG åŸºç¡€ä¸Šå¢åŠ é¢„å¤„ç†å’Œåå¤„ç†ä¼˜åŒ–ï¼š</p><pre><code class=" mermaid">graph TD    subgraph é¢„æ£€ç´¢ä¼˜åŒ–        A[ç”¨æˆ·é—®é¢˜] --&gt; B[æŸ¥è¯¢æ”¹å†™]        B --&gt; C[æŸ¥è¯¢æ‰©å±•]    end        subgraph æ£€ç´¢ä¼˜åŒ–        C --&gt; D[å¤šè·¯å¬å›]        D --&gt; E[é‡æ’åºRerank]    end        subgraph åå¤„ç†ä¼˜åŒ–        E --&gt; F[ä¸Šä¸‹æ–‡å‹ç¼©]        F --&gt; G[LLMç”Ÿæˆ]    end</code></pre><p><strong>æ ¸å¿ƒä¼˜åŒ–ç‚¹</strong>ï¼š</p><table><thead><tr><th>ä¼˜åŒ–é˜¶æ®µ</th><th>æŠ€æœ¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>é¢„æ£€ç´¢</td><td>Query Rewriting</td><td>é‡å†™ç”¨æˆ·é—®é¢˜æå‡æ£€ç´¢æ•ˆæœ</td></tr><tr><td>é¢„æ£€ç´¢</td><td>HyDE</td><td>ç”Ÿæˆå‡è®¾æ–‡æ¡£è¿›è¡Œæ£€ç´¢</td></tr><tr><td>æ£€ç´¢</td><td>Hybrid Search</td><td>å‘é‡ + BM25 æ··åˆæ£€ç´¢</td></tr><tr><td>æ£€ç´¢</td><td>Reranking</td><td>ä½¿ç”¨äº¤å‰ç¼–ç å™¨é‡æ’</td></tr><tr><td>åæ£€ç´¢</td><td>Context Compression</td><td>å‹ç¼©å†—ä½™ä¸Šä¸‹æ–‡</td></tr><tr><td>åæ£€ç´¢</td><td>Self-RAG</td><td>è‡ªæˆ‘åæ€ä¸æ ¡éªŒ</td></tr></tbody></table><h3 id="Modular-RAG"><a href="#Modular-RAG" class="headerlink" title="Modular RAG"></a>Modular RAG</h3><p>å°† RAG æ‹†è§£ä¸ºå¯æ’æ‹”æ¨¡å—ï¼Œæ”¯æŒçµæ´»ç»„åˆï¼š</p><table><thead><tr><th>æ¨¡å—ç±»å‹</th><th>å¯é€‰ç»„ä»¶</th></tr></thead><tbody><tr><td>ç´¢å¼•æ¨¡å—</td><td>å±‚æ¬¡ç´¢å¼•ã€çŸ¥è¯†å›¾è°±ç´¢å¼•ã€æ‘˜è¦ç´¢å¼•</td></tr><tr><td>æ£€ç´¢æ¨¡å—</td><td>ç¨€ç–æ£€ç´¢ã€ç¨ å¯†æ£€ç´¢ã€æ··åˆæ£€ç´¢</td></tr><tr><td>é‡æ’æ¨¡å—</td><td>Cross-Encoderã€ColBERTã€LLM Rerank</td></tr><tr><td>ç”Ÿæˆæ¨¡å—</td><td>å•æ¬¡ç”Ÿæˆã€è¿­ä»£ä¼˜åŒ–ã€å¤šæ­¥æ¨ç†</td></tr></tbody></table><h2 id="ä¸»æµ-RAG-æ¡†æ¶å¯¹æ¯”"><a href="#ä¸»æµ-RAG-æ¡†æ¶å¯¹æ¯”" class="headerlink" title="ä¸»æµ RAG æ¡†æ¶å¯¹æ¯”"></a>ä¸»æµ RAG æ¡†æ¶å¯¹æ¯”</h2><h3 id="Python-ç”Ÿæ€"><a href="#Python-ç”Ÿæ€" class="headerlink" title="Python ç”Ÿæ€"></a>Python ç”Ÿæ€</h3><table><thead><tr><th>æ¡†æ¶</th><th>ç‰¹ç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>LangChain</strong></td><td>åŠŸèƒ½å…¨é¢ã€ç”Ÿæ€ä¸°å¯Œ</td><td>é€šç”¨ RAG å¼€å‘</td></tr><tr><td><strong>LlamaIndex</strong></td><td>ä¸“æ³¨æ•°æ®ç´¢å¼•ä¸æ£€ç´¢</td><td>å¤æ‚æ–‡æ¡£åœºæ™¯</td></tr><tr><td><strong>Haystack</strong></td><td>æ¨¡å—åŒ–è®¾è®¡ã€ä¼ä¸šçº§</td><td>ç”Ÿäº§ç¯å¢ƒ</td></tr><tr><td><strong>RAGFlow</strong></td><td>å¼€ç®±å³ç”¨ã€å¯è§†åŒ–</td><td>å¿«é€Ÿéƒ¨ç½²</td></tr></tbody></table><h3 id="Java-ç”Ÿæ€"><a href="#Java-ç”Ÿæ€" class="headerlink" title="Java ç”Ÿæ€"></a>Java ç”Ÿæ€</h3><table><thead><tr><th>æ¡†æ¶</th><th>ç‰¹ç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Spring AI</strong></td><td>Spring ç”Ÿæ€é›†æˆ</td><td>Spring Boot é¡¹ç›®</td></tr><tr><td><strong>LangChain4j</strong></td><td>åŠŸèƒ½å¯¹æ ‡ LangChain</td><td>Java å…¨æ ˆå¼€å‘</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Spring AI RAG ç¤ºä¾‹</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RagService</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> VectorStore vectorStore;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">query</span><span class="hljs-params">(String question)</span> &#123;<br>        <span class="hljs-comment">// 1. å‘é‡æ£€ç´¢</span><br>        List&lt;Document&gt; docs = vectorStore.similaritySearch(<br>            SearchRequest.query(question).withTopK(<span class="hljs-number">5</span>)<br>        );<br>        <br>        <span class="hljs-comment">// 2. æ„å»ºä¸Šä¸‹æ–‡</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> docs.stream()<br>            .map(Document::getContent)<br>            .collect(Collectors.joining(<span class="hljs-string">&quot;\n\n&quot;</span>));<br>        <br>        <span class="hljs-comment">// 3. è°ƒç”¨ LLM</span><br>        <span class="hljs-keyword">return</span> chatClient.prompt()<br>            .system(<span class="hljs-string">&quot;åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ï¼š\n&quot;</span> + context)<br>            .user(question)<br>            .call()<br>            .content();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Embedding-æ¨¡å‹å¯¹æ¯”"><a href="#Embedding-æ¨¡å‹å¯¹æ¯”" class="headerlink" title="Embedding æ¨¡å‹å¯¹æ¯”"></a>Embedding æ¨¡å‹å¯¹æ¯”</h2><table><thead><tr><th>æ¨¡å‹</th><th>å‚å•†</th><th>ç»´åº¦</th><th>ä¸­æ–‡æ”¯æŒ</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>text-embedding-3-large</td><td>OpenAI</td><td>3072</td><td>ä¸€èˆ¬</td><td>ç»¼åˆèƒ½åŠ›å¼º</td></tr><tr><td>text-embedding-3-small</td><td>OpenAI</td><td>1536</td><td>ä¸€èˆ¬</td><td>æ€§ä»·æ¯”é«˜</td></tr><tr><td>BGE-large-zh</td><td>BAAI</td><td>1024</td><td>â­â­â­</td><td>ä¸­æ–‡é¦–é€‰</td></tr><tr><td>M3E-base</td><td>Moka</td><td>768</td><td>â­â­â­</td><td>è½»é‡ä¸­æ–‡æ¨¡å‹</td></tr><tr><td>bge-m3</td><td>BAAI</td><td>1024</td><td>â­â­â­</td><td>å¤šè¯­è¨€ã€å¤šç²’åº¦</td></tr><tr><td>jina-embeddings-v2</td><td>Jina AI</td><td>768</td><td>â­â­</td><td>é•¿æ–‡æœ¬æ”¯æŒ</td></tr></tbody></table><blockquote><p><strong>ğŸ’¡ æç¤º: é€‰å‹å»ºè®®</strong></p><ul><li>ä¸­æ–‡åœºæ™¯ä¼˜å…ˆä½¿ç”¨ <strong>BGE</strong> æˆ– <strong>M3E</strong></li><li>å¤šè¯­è¨€åœºæ™¯ä½¿ç”¨ <strong>bge-m3</strong></li><li>è¿½æ±‚æ•ˆæœä½¿ç”¨ <strong>OpenAI text-embedding-3-large</strong></li></ul></blockquote><h2 id="å‘é‡æ•°æ®åº“å¯¹æ¯”"><a href="#å‘é‡æ•°æ®åº“å¯¹æ¯”" class="headerlink" title="å‘é‡æ•°æ®åº“å¯¹æ¯”"></a>å‘é‡æ•°æ®åº“å¯¹æ¯”</h2><table><thead><tr><th>æ•°æ®åº“</th><th>ç±»å‹</th><th>ç‰¹ç‚¹</th><th>æ¨èåœºæ™¯</th></tr></thead><tbody><tr><td><strong>Milvus</strong></td><td>å¼€æº</td><td>é«˜æ€§èƒ½ã€åˆ†å¸ƒå¼ã€åŠŸèƒ½å…¨é¢</td><td>ç”Ÿäº§ç¯å¢ƒé¦–é€‰</td></tr><tr><td><strong>Pinecone</strong></td><td>æ‰˜ç®¡</td><td>é›¶è¿ç»´ã€ç®€å•æ˜“ç”¨</td><td>å¿«é€ŸåŸå‹ã€å°å›¢é˜Ÿ</td></tr><tr><td><strong>Chroma</strong></td><td>å¼€æº</td><td>è½»é‡åµŒå…¥å¼ã€å¼€å‘å‹å¥½</td><td>æœ¬åœ°å¼€å‘ã€æµ‹è¯•</td></tr><tr><td><strong>Weaviate</strong></td><td>å¼€æº</td><td>GraphQLã€æ¨¡å—åŒ–</td><td>å¤æ‚æŸ¥è¯¢åœºæ™¯</td></tr><tr><td><strong>Qdrant</strong></td><td>å¼€æº</td><td>Rust å®ç°ã€é«˜æ€§èƒ½</td><td>é«˜å¹¶å‘åœºæ™¯</td></tr><tr><td><strong>pgvector</strong></td><td>æ’ä»¶</td><td>PostgreSQL æ‰©å±•</td><td>å·²æœ‰ PG ç¯å¢ƒ</td></tr></tbody></table><h2 id="æ£€ç´¢ç­–ç•¥å¯¹æ¯”"><a href="#æ£€ç´¢ç­–ç•¥å¯¹æ¯”" class="headerlink" title="æ£€ç´¢ç­–ç•¥å¯¹æ¯”"></a>æ£€ç´¢ç­–ç•¥å¯¹æ¯”</h2><table><thead><tr><th>ç­–ç•¥</th><th>åŸç†</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>ç¨€ç–æ£€ç´¢ï¼ˆBM25ï¼‰</strong></td><td>è¯é¢‘ç»Ÿè®¡</td><td>ç²¾ç¡®åŒ¹é…ã€å¯è§£é‡Š</td><td>è¯­ä¹‰ç†è§£å¼±</td></tr><tr><td><strong>ç¨ å¯†æ£€ç´¢ï¼ˆå‘é‡ï¼‰</strong></td><td>è¯­ä¹‰ç›¸ä¼¼åº¦</td><td>è¯­ä¹‰ç†è§£å¼º</td><td>å¯èƒ½ä¸¢å¤±å…³é”®è¯</td></tr><tr><td><strong>æ··åˆæ£€ç´¢</strong></td><td>ä¸¤è€…èåˆ</td><td>å…¼é¡¾ç²¾ç¡®ä¸è¯­ä¹‰</td><td>éœ€è¦è°ƒæƒé‡</td></tr><tr><td><strong>å¤šå‘é‡æ£€ç´¢</strong></td><td>æ®µè½+æ‘˜è¦å¤šå‘é‡</td><td>å¤šç²’åº¦åŒ¹é…</td><td>ç´¢å¼•è†¨èƒ€</td></tr></tbody></table><h3 id="æ··åˆæ£€ç´¢ç¤ºä¾‹"><a href="#æ··åˆæ£€ç´¢ç¤ºä¾‹" class="headerlink" title="æ··åˆæ£€ç´¢ç¤ºä¾‹"></a>æ··åˆæ£€ç´¢ç¤ºä¾‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.retrievers <span class="hljs-keyword">import</span> EnsembleRetriever<br><span class="hljs-keyword">from</span> langchain_community.retrievers <span class="hljs-keyword">import</span> BM25Retriever<br><br><span class="hljs-comment"># BM25 ç¨€ç–æ£€ç´¢</span><br>bm25_retriever = BM25Retriever.from_documents(documents)<br>bm25_retriever.k = <span class="hljs-number">5</span><br><br><span class="hljs-comment"># å‘é‡ç¨ å¯†æ£€ç´¢</span><br>vector_retriever = vectorstore.as_retriever(search_kwargs=&#123;<span class="hljs-string">&quot;k&quot;</span>: <span class="hljs-number">5</span>&#125;)<br><br><span class="hljs-comment"># æ··åˆæ£€ç´¢ï¼ˆæƒé‡ 0.5:0.5ï¼‰</span><br>ensemble_retriever = EnsembleRetriever(<br>    retrievers=[bm25_retriever, vector_retriever],<br>    weights=[<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>]<br>)<br></code></pre></td></tr></table></figure><h2 id="æ–‡æœ¬åˆ†å‰²ç­–ç•¥"><a href="#æ–‡æœ¬åˆ†å‰²ç­–ç•¥" class="headerlink" title="æ–‡æœ¬åˆ†å‰²ç­–ç•¥"></a>æ–‡æœ¬åˆ†å‰²ç­–ç•¥</h2><table><thead><tr><th>ç­–ç•¥</th><th>è¯´æ˜</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å›ºå®šé•¿åº¦åˆ†å‰²</td><td>æŒ‰å­—ç¬¦æ•°åˆ‡åˆ†</td><td>ç®€å•æ–‡æœ¬</td></tr><tr><td>é€’å½’å­—ç¬¦åˆ†å‰²</td><td>æŒ‰åˆ†éš”ç¬¦å±‚æ¬¡åˆ‡åˆ†</td><td>é€šç”¨æ–‡æ¡£</td></tr><tr><td>è¯­ä¹‰åˆ†å‰²</td><td>æŒ‰è¯­ä¹‰è¾¹ç•Œåˆ‡åˆ†</td><td>é«˜è´¨é‡è¦æ±‚</td></tr><tr><td>æ–‡æ¡£ç»“æ„åˆ†å‰²</td><td>æŒ‰æ ‡é¢˜&#x2F;ç« èŠ‚åˆ‡åˆ†</td><td>ç»“æ„åŒ–æ–‡æ¡£</td></tr><tr><td>çˆ¶å­å—ç­–ç•¥</td><td>å°å—æ£€ç´¢ã€å¤§å—è¿”å›</td><td>ä¸Šä¸‹æ–‡å®Œæ•´æ€§</td></tr></tbody></table><blockquote><p><strong>âš ï¸ é‡è¦: åˆ†å—è¦ç‚¹</strong></p><ul><li><strong>Chunk Size</strong>ï¼šé€šå¸¸ 500-1000 å­—ç¬¦</li><li><strong>Overlap</strong>ï¼šå»ºè®® 10%-20% é‡å </li><li><strong>ä¿æŒè¯­ä¹‰å®Œæ•´</strong>ï¼šé¿å…å¥å­è¢«åˆ‡æ–­</li></ul></blockquote><h2 id="è¯„ä¼°æŒ‡æ ‡"><a href="#è¯„ä¼°æŒ‡æ ‡" class="headerlink" title="è¯„ä¼°æŒ‡æ ‡"></a>è¯„ä¼°æŒ‡æ ‡</h2><h3 id="æ£€ç´¢è´¨é‡"><a href="#æ£€ç´¢è´¨é‡" class="headerlink" title="æ£€ç´¢è´¨é‡"></a>æ£€ç´¢è´¨é‡</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Recall@K</td><td>Top-K ä¸­åŒ…å«æ­£ç¡®æ–‡æ¡£çš„æ¯”ä¾‹</td></tr><tr><td>MRR</td><td>æ­£ç¡®æ–‡æ¡£æ’åçš„å€’æ•°å‡å€¼</td></tr><tr><td>NDCG</td><td>å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢ç›Š</td></tr></tbody></table><h3 id="ç”Ÿæˆè´¨é‡"><a href="#ç”Ÿæˆè´¨é‡" class="headerlink" title="ç”Ÿæˆè´¨é‡"></a>ç”Ÿæˆè´¨é‡</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Faithfulness</td><td>ç­”æ¡ˆæ˜¯å¦å¿ äºæ£€ç´¢å†…å®¹</td></tr><tr><td>Answer Relevancy</td><td>ç­”æ¡ˆä¸é—®é¢˜çš„ç›¸å…³æ€§</td></tr><tr><td>Context Precision</td><td>ä¸Šä¸‹æ–‡çš„ç²¾ç¡®ç‡</td></tr><tr><td>Context Recall</td><td>ä¸Šä¸‹æ–‡çš„å¬å›ç‡</td></tr></tbody></table><blockquote><p><strong>ğŸ“ æ³¨æ„: RAGAS æ¡†æ¶</strong><br>æ¨èä½¿ç”¨ <strong>RAGAS</strong> è¿›è¡Œç«¯åˆ°ç«¯ RAG è¯„ä¼°ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–è¯„ä¼°ä¸Šè¿°æŒ‡æ ‡</p></blockquote><h2 id="å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–"><a href="#å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–" class="headerlink" title="å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–"></a>å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–</h2><table><thead><tr><th>é—®é¢˜</th><th>åŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>æ£€ç´¢ä¸åˆ°ç›¸å…³æ–‡æ¡£</td><td>æŸ¥è¯¢ä¸æ–‡æ¡£è¯­ä¹‰å·®è·å¤§</td><td>æŸ¥è¯¢æ”¹å†™ã€HyDE</td></tr><tr><td>æ£€ç´¢åˆ°ä½†æ’åä½</td><td>å‘é‡ç›¸ä¼¼åº¦ä¸å‡†</td><td>æ·»åŠ  Reranker</td></tr><tr><td>ä¸Šä¸‹æ–‡è¶…é•¿</td><td>æ£€ç´¢æ–‡æ¡£è¿‡å¤š</td><td>ä¸Šä¸‹æ–‡å‹ç¼©ã€æ‘˜è¦</td></tr><tr><td>å›ç­”ä¸å‡†ç¡®</td><td>å™ªå£°æ–‡æ¡£å¹²æ‰°</td><td>æé«˜æ£€ç´¢é˜ˆå€¼ã€è¿‡æ»¤</td></tr><tr><td>æ— æ³•å›ç­”æœ€æ–°é—®é¢˜</td><td>çŸ¥è¯†åº“æœªæ›´æ–°</td><td>å¢é‡ç´¢å¼•æ›´æ–°</td></tr></tbody></table><h2 id="ç›¸å…³ç¬”è®°"><a href="#ç›¸å…³ç¬”è®°" class="headerlink" title="ç›¸å…³ç¬”è®°"></a>ç›¸å…³ç¬”è®°</h2><ul><li>å¤§æ¨¡å‹å­¦ä¹ è·¯çº¿</li><li>LLMåº”ç”¨å¼€å‘</li><li>Prompt Engineeringè¯¦è§£</li></ul>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RAG</tag>
      
      <tag>æ£€ç´¢å¢å¼ºç”Ÿæˆ</tag>
      
      <tag>AI</tag>
      
      <tag>å‘é‡æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AQSåŸç†è¯¦è§£</title>
    <link href="/2026/01/12/AQS%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/12/AQS%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="AQS-åŸç†è¯¦è§£"><a href="#AQS-åŸç†è¯¦è§£" class="headerlink" title="AQS åŸç†è¯¦è§£"></a>AQS åŸç†è¯¦è§£</h1><blockquote><p><strong>ğŸ’¡ æç¤º: çŸ¥è¯†å›¾è°±</strong><br>æŸ¥çœ‹ AQSçŸ¥è¯†å›¾è°± è·å–å¯è§†åŒ–çŸ¥è¯†ç»“æ„</p></blockquote><h2 id="ä»€ä¹ˆæ˜¯-AQSï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-AQSï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ AQSï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ AQSï¼Ÿ</h2><p><strong>AQS</strong>ï¼ˆAbstractQueuedSynchronizerï¼ŒæŠ½è±¡é˜Ÿåˆ—åŒæ­¥å™¨ï¼‰æ˜¯ Java å¹¶å‘åŒ… <code>java.util.concurrent.locks</code> ä¸­çš„æ ¸å¿ƒåŸºç¡€æ¡†æ¶ã€‚</p><h3 id="ä¸€å¥è¯ç†è§£"><a href="#ä¸€å¥è¯ç†è§£" class="headerlink" title="ä¸€å¥è¯ç†è§£"></a>ä¸€å¥è¯ç†è§£</h3><blockquote><p>AQS å°±åƒä¸€ä¸ª<strong>æ’é˜Ÿç³»ç»Ÿ</strong>ï¼šæƒ³è¦è·å–èµ„æºçš„çº¿ç¨‹ï¼Œå¦‚æœèµ„æºè¢«å ç”¨ï¼Œå°±ä¹–ä¹–æ’é˜Ÿç­‰å¾…ï¼›èµ„æºé‡Šæ”¾åï¼Œæ’åœ¨æœ€å‰é¢çš„çº¿ç¨‹è¢«å”¤é†’å»è·å–èµ„æºã€‚</p></blockquote><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-AQSï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-AQSï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ AQSï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ AQSï¼Ÿ</h3><p>åœ¨ AQS å‡ºç°ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å®ç°ä¸€ä¸ªé”æˆ–è€…åŒæ­¥å™¨ï¼Œéœ€è¦è‡ªå·±å¤„ç†ï¼š</p><ul><li>çº¿ç¨‹çš„é˜»å¡ä¸å”¤é†’</li><li>ç­‰å¾…é˜Ÿåˆ—çš„ç»´æŠ¤</li><li>çŠ¶æ€çš„ç®¡ç†</li></ul><p>AQS æŠŠè¿™äº›<strong>é€šç”¨é€»è¾‘</strong>æŠ½å–å‡ºæ¥ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨<strong>èµ„æºçš„è·å–å’Œé‡Šæ”¾è§„åˆ™</strong>å³å¯ã€‚</p><hr><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="1-Stateï¼ˆåŒæ­¥çŠ¶æ€ï¼‰"><a href="#1-Stateï¼ˆåŒæ­¥çŠ¶æ€ï¼‰" class="headerlink" title="1. Stateï¼ˆåŒæ­¥çŠ¶æ€ï¼‰"></a>1. Stateï¼ˆåŒæ­¥çŠ¶æ€ï¼‰</h3><p>AQS ä½¿ç”¨ä¸€ä¸ª <code>int</code> ç±»å‹çš„å˜é‡ <code>state</code> æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> state;<br></code></pre></td></tr></table></figure><table><thead><tr><th>åŒæ­¥å™¨ç±»å‹</th><th>state å«ä¹‰</th></tr></thead><tbody><tr><td>ReentrantLock</td><td>0 è¡¨ç¤ºæœªé”å®šï¼Œ&gt;0 è¡¨ç¤ºé”å®šæ¬¡æ•°ï¼ˆå¯é‡å…¥ï¼‰</td></tr><tr><td>Semaphore</td><td>è¡¨ç¤ºå¯ç”¨çš„è®¸å¯æ•°é‡</td></tr><tr><td>CountDownLatch</td><td>è¡¨ç¤ºéœ€è¦ç­‰å¾…çš„è®¡æ•°</td></tr></tbody></table><h3 id="2-CLH-é˜Ÿåˆ—ï¼ˆç­‰å¾…é˜Ÿåˆ—ï¼‰"><a href="#2-CLH-é˜Ÿåˆ—ï¼ˆç­‰å¾…é˜Ÿåˆ—ï¼‰" class="headerlink" title="2. CLH é˜Ÿåˆ—ï¼ˆç­‰å¾…é˜Ÿåˆ—ï¼‰"></a>2. CLH é˜Ÿåˆ—ï¼ˆç­‰å¾…é˜Ÿåˆ—ï¼‰</h3><p>å½“çº¿ç¨‹è·å–èµ„æºå¤±è´¥æ—¶ï¼Œä¼šè¢«åŒ…è£…æˆä¸€ä¸ª <strong>Node èŠ‚ç‚¹</strong>ï¼ŒåŠ å…¥åˆ°ä¸€ä¸ª <strong>FIFO åŒå‘é˜Ÿåˆ—</strong> ä¸­ç­‰å¾…ã€‚</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">     +------+  prev +------+  prev +------+<br>head |<span class="hljs-string">      </span>|<span class="hljs-string"> &lt;---- </span>|<span class="hljs-string">      </span>|<span class="hljs-string"> &lt;---- </span>|<span class="hljs-string">      </span>|<span class="hljs-string">  tail</span><br><span class="hljs-string">     </span>|<span class="hljs-string"> Node </span>|<span class="hljs-string">       </span>|<span class="hljs-string"> Node </span>|<span class="hljs-string">       </span>|<span class="hljs-string"> Node </span>|<br>     |<span class="hljs-string">      </span>|<span class="hljs-string"> ----&gt; </span>|<span class="hljs-string">      </span>|<span class="hljs-string"> ----&gt; </span>|<span class="hljs-string">      </span>|<br>     +------+  next +------+  next +------+<br></code></pre></td></tr></table></figure><h3 id="3-Node-èŠ‚ç‚¹"><a href="#3-Node-èŠ‚ç‚¹" class="headerlink" title="3. Node èŠ‚ç‚¹"></a>3. Node èŠ‚ç‚¹</h3><p>æ¯ä¸ªç­‰å¾…çš„çº¿ç¨‹éƒ½è¢«å°è£…æˆä¸€ä¸ª Nodeï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> &#123;<br>    <span class="hljs-comment">// ç­‰å¾…çŠ¶æ€</span><br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> waitStatus;<br>    <span class="hljs-comment">// å‰é©±èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">volatile</span> Node prev;<br>    <span class="hljs-comment">// åç»§èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">volatile</span> Node next;<br>    <span class="hljs-comment">// ç­‰å¾…çš„çº¿ç¨‹</span><br>    <span class="hljs-keyword">volatile</span> Thread thread;<br>    <span class="hljs-comment">// å…±äº«æ¨¡å¼ or ç‹¬å æ¨¡å¼</span><br>    Node nextWaiter;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>waitStatus çš„å–å€¼ï¼š</strong></p><table><thead><tr><th>å€¼</th><th>å¸¸é‡å</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>0</td><td>-</td><td>åˆå§‹çŠ¶æ€</td></tr><tr><td>1</td><td>CANCELLED</td><td>çº¿ç¨‹å·²å–æ¶ˆ</td></tr><tr><td>-1</td><td>SIGNAL</td><td>åç»§èŠ‚ç‚¹éœ€è¦è¢«å”¤é†’</td></tr><tr><td>-2</td><td>CONDITION</td><td>åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…</td></tr><tr><td>-3</td><td>PROPAGATE</td><td>å…±äº«æ¨¡å¼ä¸‹ä¼ æ’­å”¤é†’</td></tr></tbody></table><hr><h2 id="ä¸¤ç§èµ„æºå…±äº«æ¨¡å¼"><a href="#ä¸¤ç§èµ„æºå…±äº«æ¨¡å¼" class="headerlink" title="ä¸¤ç§èµ„æºå…±äº«æ¨¡å¼"></a>ä¸¤ç§èµ„æºå…±äº«æ¨¡å¼</h2><h3 id="ç‹¬å æ¨¡å¼ï¼ˆExclusiveï¼‰"><a href="#ç‹¬å æ¨¡å¼ï¼ˆExclusiveï¼‰" class="headerlink" title="ç‹¬å æ¨¡å¼ï¼ˆExclusiveï¼‰"></a>ç‹¬å æ¨¡å¼ï¼ˆExclusiveï¼‰</h3><p><strong>åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å–èµ„æº</strong></p><p>å…¸å‹å®ç°ï¼š<code>ReentrantLock</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">çº¿ç¨‹<span class="hljs-selector-tag">A</span>è·å–é” â†’ æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡<br>çº¿ç¨‹<span class="hljs-selector-tag">B</span>è·å–é” â†’ å¤±è´¥ï¼Œè¿›å…¥é˜Ÿåˆ—ç­‰å¾…<br>çº¿ç¨‹Cè·å–é” â†’ å¤±è´¥ï¼Œè¿›å…¥é˜Ÿåˆ—ç­‰å¾…<br>çº¿ç¨‹<span class="hljs-selector-tag">A</span>é‡Šæ”¾é” â†’ å”¤é†’çº¿ç¨‹<span class="hljs-selector-tag">B</span><br></code></pre></td></tr></table></figure><h3 id="å…±äº«æ¨¡å¼ï¼ˆSharedï¼‰"><a href="#å…±äº«æ¨¡å¼ï¼ˆSharedï¼‰" class="headerlink" title="å…±äº«æ¨¡å¼ï¼ˆSharedï¼‰"></a>å…±äº«æ¨¡å¼ï¼ˆSharedï¼‰</h3><p><strong>åŒä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹è·å–èµ„æº</strong></p><p>å…¸å‹å®ç°ï¼š<code>Semaphore</code>ã€<code>CountDownLatch</code>ã€<code>ReadWriteLock</code>ï¼ˆè¯»é”ï¼‰</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Semaphore</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span> - å…è®¸<span class="hljs-number">3</span>ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®<br>çº¿ç¨‹Aè·å– â†’ æˆåŠŸï¼Œå‰©ä½™<span class="hljs-number">2</span>ä¸ªè®¸å¯<br>çº¿ç¨‹Bè·å– â†’ æˆåŠŸï¼Œå‰©ä½™<span class="hljs-number">1</span>ä¸ªè®¸å¯<br>çº¿ç¨‹Cè·å– â†’ æˆåŠŸï¼Œå‰©ä½™<span class="hljs-number">0</span>ä¸ªè®¸å¯<br>çº¿ç¨‹Dè·å– â†’ å¤±è´¥ï¼Œè¿›å…¥é˜Ÿåˆ—ç­‰å¾…<br></code></pre></td></tr></table></figure><hr><h2 id="æ ¸å¿ƒæ–¹æ³•è§£æ"><a href="#æ ¸å¿ƒæ–¹æ³•è§£æ" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•è§£æ"></a>æ ¸å¿ƒæ–¹æ³•è§£æ</h2><h3 id="éœ€è¦å­ç±»å®ç°çš„æ–¹æ³•"><a href="#éœ€è¦å­ç±»å®ç°çš„æ–¹æ³•" class="headerlink" title="éœ€è¦å­ç±»å®ç°çš„æ–¹æ³•"></a>éœ€è¦å­ç±»å®ç°çš„æ–¹æ³•</h3><p>AQS é‡‡ç”¨<strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong>ï¼Œå­ç±»éœ€è¦å®ç°ä»¥ä¸‹æ–¹æ³•ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>æ¨¡å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>tryAcquire(int)</code></td><td>ç‹¬å </td><td>å°è¯•è·å–èµ„æº</td></tr><tr><td><code>tryRelease(int)</code></td><td>ç‹¬å </td><td>å°è¯•é‡Šæ”¾èµ„æº</td></tr><tr><td><code>tryAcquireShared(int)</code></td><td>å…±äº«</td><td>å°è¯•è·å–å…±äº«èµ„æº</td></tr><tr><td><code>tryReleaseShared(int)</code></td><td>å…±äº«</td><td>å°è¯•é‡Šæ”¾å…±äº«èµ„æº</td></tr><tr><td><code>isHeldExclusively()</code></td><td>-</td><td>æ˜¯å¦ç‹¬å æŒæœ‰</td></tr></tbody></table><h3 id="AQS-æä¾›çš„æ¨¡æ¿æ–¹æ³•"><a href="#AQS-æä¾›çš„æ¨¡æ¿æ–¹æ³•" class="headerlink" title="AQS æä¾›çš„æ¨¡æ¿æ–¹æ³•"></a>AQS æä¾›çš„æ¨¡æ¿æ–¹æ³•</h3><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>acquire(int)</code></td><td>ç‹¬å å¼è·å–ï¼ˆä¼šé˜»å¡ï¼‰</td></tr><tr><td><code>acquireInterruptibly(int)</code></td><td>ç‹¬å å¼è·å–ï¼ˆå¯ä¸­æ–­ï¼‰</td></tr><tr><td><code>tryAcquireNanos(int, long)</code></td><td>ç‹¬å å¼è·å–ï¼ˆå¸¦è¶…æ—¶ï¼‰</td></tr><tr><td><code>release(int)</code></td><td>ç‹¬å å¼é‡Šæ”¾</td></tr><tr><td><code>acquireShared(int)</code></td><td>å…±äº«å¼è·å–</td></tr><tr><td><code>releaseShared(int)</code></td><td>å…±äº«å¼é‡Šæ”¾</td></tr></tbody></table><hr><h2 id="ç‹¬å æ¨¡å¼æºç åˆ†æ"><a href="#ç‹¬å æ¨¡å¼æºç åˆ†æ" class="headerlink" title="ç‹¬å æ¨¡å¼æºç åˆ†æ"></a>ç‹¬å æ¨¡å¼æºç åˆ†æ</h2><h3 id="acquire-è·å–èµ„æº"><a href="#acquire-è·å–èµ„æº" class="headerlink" title="acquire() - è·å–èµ„æº"></a>acquire() - è·å–èµ„æº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!tryAcquire(arg) &amp;&amp;<br>        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))<br>        selfInterrupt();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ‰§è¡Œæµç¨‹ï¼š</strong></p><pre><code class=" mermaid">flowchart TD    A[è°ƒç”¨ acquire] --&gt; B&#123;tryAcquire å°è¯•è·å–&#125;    B --&gt;|æˆåŠŸ| C[ç›´æ¥è¿”å›ï¼Œè·å–åˆ°èµ„æº]    B --&gt;|å¤±è´¥| D[addWaiter åˆ›å»ºèŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—]    D --&gt; E[acquireQueued åœ¨é˜Ÿåˆ—ä¸­è‡ªæ—‹ç­‰å¾…]    E --&gt; F&#123;æ˜¯å¦è¢«ä¸­æ–­è¿‡&#125;    F --&gt;|æ˜¯| G[selfInterrupt è¡¥ä¸Šä¸­æ–­]    F --&gt;|å¦| H[è¿”å›]</code></pre><h3 id="addWaiter-åŠ å…¥ç­‰å¾…é˜Ÿåˆ—"><a href="#addWaiter-åŠ å…¥ç­‰å¾…é˜Ÿåˆ—" class="headerlink" title="addWaiter() - åŠ å…¥ç­‰å¾…é˜Ÿåˆ—"></a>addWaiter() - åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Node <span class="hljs-title function_">addWaiter</span><span class="hljs-params">(Node mode)</span> &#123;<br>    <span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(Thread.currentThread(), mode);<br>    <span class="hljs-comment">// å¿«é€Ÿå°è¯•åœ¨å°¾éƒ¨æ·»åŠ </span><br>    <span class="hljs-type">Node</span> <span class="hljs-variable">pred</span> <span class="hljs-operator">=</span> tail;<br>    <span class="hljs-keyword">if</span> (pred != <span class="hljs-literal">null</span>) &#123;<br>        node.prev = pred;<br>        <span class="hljs-keyword">if</span> (compareAndSetTail(pred, node)) &#123;<br>            pred.next = node;<br>            <span class="hljs-keyword">return</span> node;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// å¿«é€Ÿæ·»åŠ å¤±è´¥ï¼Œè¿›å…¥å®Œæ•´å…¥é˜Ÿæµç¨‹</span><br>    enq(node);<br>    <span class="hljs-keyword">return</span> node;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="acquireQueued-é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–"><a href="#acquireQueued-é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–" class="headerlink" title="acquireQueued() - é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–"></a>acquireQueued() - é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">acquireQueued</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Node node, <span class="hljs-type">int</span> arg)</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">failed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">interrupted</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">for</span> (;;) &#123;  <span class="hljs-comment">// è‡ªæ—‹</span><br>            <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> node.predecessor();<br>            <span class="hljs-comment">// åªæœ‰å‰é©±æ˜¯headæ‰æœ‰èµ„æ ¼å°è¯•è·å–</span><br>            <span class="hljs-keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;<br>                setHead(node);<br>                p.next = <span class="hljs-literal">null</span>; <span class="hljs-comment">// help GC</span><br>                failed = <span class="hljs-literal">false</span>;<br>                <span class="hljs-keyword">return</span> interrupted;<br>            &#125;<br>            <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦é˜»å¡</span><br>            <span class="hljs-keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;<br>                parkAndCheckInterrupt())<br>                interrupted = <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (failed)<br>            cancelAcquire(node);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹ï¼š</strong></p><ol><li>åªæœ‰<strong>å‰é©±èŠ‚ç‚¹æ˜¯ head</strong> çš„èŠ‚ç‚¹æ‰æœ‰èµ„æ ¼å°è¯•è·å–èµ„æº</li><li>è·å–å¤±è´¥åä¼šè°ƒç”¨ <code>LockSupport.park()</code> é˜»å¡çº¿ç¨‹</li><li>è¢«å”¤é†’åç»§ç»­è‡ªæ—‹å°è¯•è·å–</li></ol><h3 id="release-é‡Šæ”¾èµ„æº"><a href="#release-é‡Šæ”¾èµ„æº" class="headerlink" title="release() - é‡Šæ”¾èµ„æº"></a>release() - é‡Šæ”¾èµ„æº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">release</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> &#123;<br>    <span class="hljs-keyword">if</span> (tryRelease(arg)) &#123;<br>        <span class="hljs-type">Node</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> head;<br>        <span class="hljs-keyword">if</span> (h != <span class="hljs-literal">null</span> &amp;&amp; h.waitStatus != <span class="hljs-number">0</span>)<br>            unparkSuccessor(h);  <span class="hljs-comment">// å”¤é†’åç»§èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="å›¾è§£ï¼šå®Œæ•´çš„è·å–-é‡Šæ”¾æµç¨‹"><a href="#å›¾è§£ï¼šå®Œæ•´çš„è·å–-é‡Šæ”¾æµç¨‹" class="headerlink" title="å›¾è§£ï¼šå®Œæ•´çš„è·å–-é‡Šæ”¾æµç¨‹"></a>å›¾è§£ï¼šå®Œæ•´çš„è·å–-é‡Šæ”¾æµç¨‹</h2><h3 id="åœºæ™¯ï¼šä¸‰ä¸ªçº¿ç¨‹ç«äº‰ä¸€æŠŠé”"><a href="#åœºæ™¯ï¼šä¸‰ä¸ªçº¿ç¨‹ç«äº‰ä¸€æŠŠé”" class="headerlink" title="åœºæ™¯ï¼šä¸‰ä¸ªçº¿ç¨‹ç«äº‰ä¸€æŠŠé”"></a>åœºæ™¯ï¼šä¸‰ä¸ªçº¿ç¨‹ç«äº‰ä¸€æŠŠé”</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">åˆå§‹çŠ¶æ€ï¼šstate = 0ï¼Œé˜Ÿåˆ—ä¸ºç©º<br><br><span class="hljs-section">=== çº¿ç¨‹A è·å–é” ===</span><br>1. tryAcquire(1) â†’ CAS(0, 1) æˆåŠŸ<br>2. state = 1ï¼Œçº¿ç¨‹AæŒæœ‰é”<br>3. é˜Ÿåˆ—ä»ä¸ºç©º<br><br><span class="hljs-section">=== çº¿ç¨‹B è·å–é” ===</span><br>1. tryAcquire(1) â†’ å¤±è´¥ï¼ˆstate=1ï¼‰<br>2. addWaiter() â†’ åˆ›å»ºNode(B)ï¼Œåˆå§‹åŒ–é˜Ÿåˆ—<br><span class="hljs-code">   </span><br><span class="hljs-code">   +------+      +------+</span><br><span class="hljs-code">   | head | ---&gt; | B    |</span><br><span class="hljs-code">   | ç©º   |      | ç­‰å¾… |</span><br><span class="hljs-code">   +------+      +------+</span><br><span class="hljs-code">   </span><br>3. acquireQueued() â†’ parké˜»å¡<br><br><span class="hljs-section">=== çº¿ç¨‹C è·å–é” ===</span><br>1. tryAcquire(1) â†’ å¤±è´¥<br>2. addWaiter() â†’ åˆ›å»ºNode(C)åŠ å…¥é˜Ÿå°¾<br><span class="hljs-code">   </span><br><span class="hljs-code">   +------+      +------+      +------+</span><br><span class="hljs-code">   | head | ---&gt; | B    | ---&gt; | C    |</span><br><span class="hljs-code">   | ç©º   |      | ç­‰å¾… |      | ç­‰å¾… |</span><br><span class="hljs-code">   +------+      +------+      +------+</span><br><span class="hljs-code">   </span><br>3. acquireQueued() â†’ parké˜»å¡<br><br><span class="hljs-section">=== çº¿ç¨‹A é‡Šæ”¾é” ===</span><br>1. tryRelease(1) â†’ state = 0<br>2. unparkSuccessor(head) â†’ å”¤é†’çº¿ç¨‹B<br>3. çº¿ç¨‹Bè¢«å”¤é†’ï¼ŒtryAcquireæˆåŠŸ<br>4. çº¿ç¨‹Bæˆä¸ºæ–°çš„head<br><span class="hljs-code">   </span><br><span class="hljs-code">   +------+      +------+</span><br><span class="hljs-code">   | B    | ---&gt; | C    |</span><br><span class="hljs-code">   | head |      | ç­‰å¾… |</span><br><span class="hljs-code">   +------+      +------+</span><br></code></pre></td></tr></table></figure><hr><h2 id="å®æˆ˜ï¼šæ‰‹å†™ä¸€ä¸ªç®€å•çš„äº’æ–¥é”"><a href="#å®æˆ˜ï¼šæ‰‹å†™ä¸€ä¸ªç®€å•çš„äº’æ–¥é”" class="headerlink" title="å®æˆ˜ï¼šæ‰‹å†™ä¸€ä¸ªç®€å•çš„äº’æ–¥é”"></a>å®æˆ˜ï¼šæ‰‹å†™ä¸€ä¸ªç®€å•çš„äº’æ–¥é”</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleLock</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Sync</span> <span class="hljs-variable">sync</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sync</span>();<br>    <br>    <span class="hljs-comment">// ç»§æ‰¿AQS</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> &#123;<br>        <br>        <span class="hljs-comment">// å°è¯•è·å–é”</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> &#123;<br>            <span class="hljs-comment">// CAS å°† state ä» 0 æ”¹ä¸º 1</span><br>            <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-comment">// è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºç‹¬å çº¿ç¨‹</span><br>                setExclusiveOwnerThread(Thread.currentThread());<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <br>        <span class="hljs-comment">// å°è¯•é‡Šæ”¾é”</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> &#123;<br>            <span class="hljs-keyword">if</span> (getState() == <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();<br>            &#125;<br>            <span class="hljs-comment">// æ¸…é™¤ç‹¬å çº¿ç¨‹</span><br>            setExclusiveOwnerThread(<span class="hljs-literal">null</span>);<br>            <span class="hljs-comment">// é‡Šæ”¾é”</span><br>            setState(<span class="hljs-number">0</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <br>        <span class="hljs-comment">// æ˜¯å¦ç‹¬å æŒæœ‰</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> getExclusiveOwnerThread() == Thread.currentThread();<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> &#123;<br>        sync.acquire(<span class="hljs-number">1</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> &#123;<br>        sync.release(<span class="hljs-number">1</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sync.tryAcquire(<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SimpleLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleLock</span>();<br><br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// ä¸´ç•ŒåŒºä»£ç </span><br>    System.out.println(<span class="hljs-string">&quot;è·å–åˆ°é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘&quot;</span>);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    lock.unlock();<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="AQS-çš„ç»å…¸å®ç°ç±»"><a href="#AQS-çš„ç»å…¸å®ç°ç±»" class="headerlink" title="AQS çš„ç»å…¸å®ç°ç±»"></a>AQS çš„ç»å…¸å®ç°ç±»</h2><table><thead><tr><th>å®ç°ç±»</th><th>æ¨¡å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ReentrantLock</td><td>ç‹¬å </td><td>å¯é‡å…¥äº’æ–¥é”</td></tr><tr><td>ReentrantReadWriteLock</td><td>å…±äº«+ç‹¬å </td><td>è¯»å†™é”</td></tr><tr><td>CountDownLatch</td><td>å…±äº«</td><td>å€’è®¡æ—¶é—¨é—©</td></tr><tr><td>Semaphore</td><td>å…±äº«</td><td>ä¿¡å·é‡</td></tr><tr><td>CyclicBarrier</td><td>-</td><td>å¾ªç¯æ …æ ï¼ˆå†…éƒ¨ç”¨ReentrantLockï¼‰</td></tr></tbody></table><hr><h2 id="æ ¸å¿ƒè¦ç‚¹æ€»ç»“"><a href="#æ ¸å¿ƒè¦ç‚¹æ€»ç»“" class="headerlink" title="æ ¸å¿ƒè¦ç‚¹æ€»ç»“"></a>æ ¸å¿ƒè¦ç‚¹æ€»ç»“</h2><h3 id="AQS-çš„è®¾è®¡ç²¾é«“"><a href="#AQS-çš„è®¾è®¡ç²¾é«“" class="headerlink" title="AQS çš„è®¾è®¡ç²¾é«“"></a>AQS çš„è®¾è®¡ç²¾é«“</h3><ol><li><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong>ï¼šAQS å®šä¹‰ç®—æ³•éª¨æ¶ï¼Œå­ç±»å®ç°å…·ä½“é€»è¾‘</li><li><strong>CLH é˜Ÿåˆ—å˜ä½“</strong>ï¼šé«˜æ•ˆçš„ FIFO ç­‰å¾…é˜Ÿåˆ—</li><li><strong>CAS + volatile</strong>ï¼šä¿è¯çº¿ç¨‹å®‰å…¨çš„æ— é”æ“ä½œ</li><li><strong>LockSupport</strong>ï¼šç²¾ç¡®çš„çº¿ç¨‹é˜»å¡&#x2F;å”¤é†’æ§åˆ¶</li></ol><h3 id="è®°å¿†å£è¯€"><a href="#è®°å¿†å£è¯€" class="headerlink" title="è®°å¿†å£è¯€"></a>è®°å¿†å£è¯€</h3><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs erlang">AQSä¸‰è¦ç´ ï¼šçŠ¶æ€ã€é˜Ÿåˆ—ã€CAS<br>ç‹¬å çœ‹<span class="hljs-keyword">try</span>Acquireï¼Œå…±äº«çœ‹<span class="hljs-keyword">try</span>AcquireShared<br>è·å–å¤±è´¥è¿›é˜Ÿåˆ—ï¼Œå‰é©±æ˜¯headæ‰èƒ½æŠ¢<br>é‡Šæ”¾èµ„æºå”¤åç»§ï¼ŒFIFOä¿å…¬å¹³<br></code></pre></td></tr></table></figure><hr><h2 id="å¸¸è§é¢è¯•é¢˜"><a href="#å¸¸è§é¢è¯•é¢˜" class="headerlink" title="å¸¸è§é¢è¯•é¢˜"></a>å¸¸è§é¢è¯•é¢˜</h2><h3 id="Q1ï¼šAQS-ä¸ºä»€ä¹ˆä½¿ç”¨åŒå‘é“¾è¡¨ï¼Ÿ"><a href="#Q1ï¼šAQS-ä¸ºä»€ä¹ˆä½¿ç”¨åŒå‘é“¾è¡¨ï¼Ÿ" class="headerlink" title="Q1ï¼šAQS ä¸ºä»€ä¹ˆä½¿ç”¨åŒå‘é“¾è¡¨ï¼Ÿ"></a>Q1ï¼šAQS ä¸ºä»€ä¹ˆä½¿ç”¨åŒå‘é“¾è¡¨ï¼Ÿ</h3><ul><li><strong>æ–¹ä¾¿å–æ¶ˆæ“ä½œ</strong>ï¼šå–æ¶ˆèŠ‚ç‚¹æ—¶éœ€è¦ä¿®æ”¹å‰é©±çš„ next æŒ‡é’ˆ</li><li><strong>æ–¹ä¾¿åˆ¤æ–­å‰é©±çŠ¶æ€</strong>ï¼šåªæœ‰å‰é©±æ˜¯ head æ‰èƒ½å°è¯•è·å–èµ„æº</li><li><strong>æ–¹ä¾¿ä»å°¾éƒ¨éå†</strong>ï¼šæŸäº›åœºæ™¯éœ€è¦ä»åå‘å‰éå†</li></ul><h3 id="Q2ï¼šä¸ºä»€ä¹ˆ-head-èŠ‚ç‚¹æ˜¯è™šèŠ‚ç‚¹ï¼Ÿ"><a href="#Q2ï¼šä¸ºä»€ä¹ˆ-head-èŠ‚ç‚¹æ˜¯è™šèŠ‚ç‚¹ï¼Ÿ" class="headerlink" title="Q2ï¼šä¸ºä»€ä¹ˆ head èŠ‚ç‚¹æ˜¯è™šèŠ‚ç‚¹ï¼Ÿ"></a>Q2ï¼šä¸ºä»€ä¹ˆ head èŠ‚ç‚¹æ˜¯è™šèŠ‚ç‚¹ï¼Ÿ</h3><ul><li>head ä»£è¡¨<strong>å½“å‰æŒæœ‰èµ„æºçš„çº¿ç¨‹</strong>ï¼ˆæˆ–åˆå§‹ç©ºèŠ‚ç‚¹ï¼‰</li><li>çœŸæ­£ç­‰å¾…çš„çº¿ç¨‹ä» head.next å¼€å§‹</li><li>è¿™æ ·è®¾è®¡ç®€åŒ–äº†è¾¹ç•Œæ¡ä»¶å¤„ç†</li></ul><h3 id="Q3ï¼šå…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«ï¼Ÿ"><a href="#Q3ï¼šå…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="Q3ï¼šå…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«ï¼Ÿ"></a>Q3ï¼šå…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«ï¼Ÿ</h3><table><thead><tr><th>ç±»å‹</th><th>å®ç°æ–¹å¼</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>å…¬å¹³é”</td><td>tryAcquire æ—¶å…ˆæ£€æŸ¥é˜Ÿåˆ—</td><td>ä¸¥æ ¼ FIFOï¼Œååé‡è¾ƒä½</td></tr><tr><td>éå…¬å¹³é”</td><td>tryAcquire æ—¶ç›´æ¥ CAS æŠ¢é”</td><td>å¯èƒ½æ’é˜Ÿï¼Œååé‡è¾ƒé«˜</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// éå…¬å¹³é”çš„ tryAcquireï¼ˆç®€åŒ–ç‰ˆï¼‰</span><br><span class="hljs-keyword">if</span> (state == <span class="hljs-number">0</span> &amp;&amp; CAS(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br><span class="hljs-comment">// å…¬å¹³é”çš„ tryAcquireï¼ˆç®€åŒ–ç‰ˆï¼‰</span><br><span class="hljs-keyword">if</span> (state == <span class="hljs-number">0</span> &amp;&amp; !hasQueuedPredecessors() &amp;&amp; CAS(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br></code></pre></td></tr></table></figure><hr><h2 id="å»¶ä¼¸é˜…è¯»"><a href="#å»¶ä¼¸é˜…è¯»" class="headerlink" title="å»¶ä¼¸é˜…è¯»"></a>å»¶ä¼¸é˜…è¯»</h2><ul><li>ReentrantLock åŸç† - AQS çš„å…¸å‹ç‹¬å å®ç°</li><li>CountDownLatch åŸç† - AQS çš„å…¸å‹å…±äº«å®ç°</li><li>CAS åŸç† - AQS çš„åº•å±‚åŸå­æ“ä½œ</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>å¹¶å‘ç¼–ç¨‹</category>
      
      <category>åŒæ­¥å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>å¹¶å‘ç¼–ç¨‹</tag>
      
      <tag>AQS</tag>
      
      <tag>åŒæ­¥å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Agentæ¶æ„æ¨¡å¼è¯¦è§£</title>
    <link href="/2026/01/12/Agent%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/12/Agent%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Agent-æ¶æ„æ¨¡å¼è¯¦è§£"><a href="#Agent-æ¶æ„æ¨¡å¼è¯¦è§£" class="headerlink" title="Agent æ¶æ„æ¨¡å¼è¯¦è§£"></a>Agent æ¶æ„æ¨¡å¼è¯¦è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>AI Agentï¼ˆæ™ºèƒ½ä½“ï¼‰</strong> æ˜¯èƒ½å¤Ÿè‡ªä¸»æ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–å¹¶æ‰§è¡Œè¡ŒåŠ¨çš„ AI ç³»ç»Ÿã€‚ä¸æ™®é€šçš„ LLM å¯¹è¯ä¸åŒï¼ŒAgent èƒ½å¤Ÿè°ƒç”¨å¤–éƒ¨å·¥å…·ã€è®¿é—®æ•°æ®åº“ã€æ‰§è¡Œä»£ç ï¼ŒçœŸæ­£å®Œæˆä»»åŠ¡ã€‚</p><blockquote><p><strong>ğŸ’¡ æç¤º: æ ¸å¿ƒåŒºåˆ«</strong><br><strong>æ™®é€š LLM</strong>ï¼šåªèƒ½ç”Ÿæˆæ–‡æœ¬<br><strong>Agent</strong>ï¼šèƒ½æ€è€ƒ + è¡ŒåŠ¨ + è·å–åé¦ˆ + ç»§ç»­æ€è€ƒ</p></blockquote><h2 id="Agent-æ ¸å¿ƒç»„ä»¶"><a href="#Agent-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="Agent æ ¸å¿ƒç»„ä»¶"></a>Agent æ ¸å¿ƒç»„ä»¶</h2><pre><code class=" mermaid">graph TB    subgraph Agent        A[LLM å¤§è„‘] --&gt; B[è§„åˆ’æ¨¡å—]        A --&gt; C[è®°å¿†æ¨¡å—]        A --&gt; D[å·¥å…·æ¨¡å—]    end        D --&gt; E[æœç´¢å·¥å…·]    D --&gt; F[ä»£ç æ‰§è¡Œ]    D --&gt; G[æ•°æ®åº“]    D --&gt; H[APIè°ƒç”¨]        C --&gt; I[çŸ­æœŸè®°å¿†]    C --&gt; J[é•¿æœŸè®°å¿†]</code></pre><table><thead><tr><th>ç»„ä»¶</th><th>åŠŸèƒ½</th><th>æŠ€æœ¯å®ç°</th></tr></thead><tbody><tr><td><strong>LLM å¤§è„‘</strong></td><td>ç†è§£ã€æ¨ç†ã€å†³ç­–</td><td>GPT-4ã€Claudeã€é€šä¹‰åƒé—®</td></tr><tr><td><strong>è§„åˆ’æ¨¡å—</strong></td><td>ä»»åŠ¡åˆ†è§£ã€æ‰§è¡Œç­–ç•¥</td><td>ReActã€Plan-and-Execute</td></tr><tr><td><strong>è®°å¿†æ¨¡å—</strong></td><td>å­˜å‚¨ä¸Šä¸‹æ–‡ã€å†å²ç»éªŒ</td><td>å‘é‡æ•°æ®åº“ã€Redis</td></tr><tr><td><strong>å·¥å…·æ¨¡å—</strong></td><td>ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’</td><td>Function Calling</td></tr></tbody></table><hr><h2 id="ä¸€ã€ReAct-æ¨¡å¼"><a href="#ä¸€ã€ReAct-æ¨¡å¼" class="headerlink" title="ä¸€ã€ReAct æ¨¡å¼"></a>ä¸€ã€ReAct æ¨¡å¼</h2><h3 id="1-1-æ ¸å¿ƒæ€æƒ³"><a href="#1-1-æ ¸å¿ƒæ€æƒ³" class="headerlink" title="1.1 æ ¸å¿ƒæ€æƒ³"></a>1.1 æ ¸å¿ƒæ€æƒ³</h3><p><strong>ReAct &#x3D; Reasoningï¼ˆæ¨ç†ï¼‰ + Actingï¼ˆè¡ŒåŠ¨ï¼‰</strong></p><p>äº¤æ›¿è¿›è¡Œæ€è€ƒå’Œè¡ŒåŠ¨ï¼Œæ¯ä¸€æ­¥éƒ½æ ¹æ®ä¸Šä¸€æ­¥çš„ç»“æœå†³å®šä¸‹ä¸€æ­¥ã€‚</p><h3 id="1-2-æ‰§è¡Œæµç¨‹"><a href="#1-2-æ‰§è¡Œæµç¨‹" class="headerlink" title="1.2 æ‰§è¡Œæµç¨‹"></a>1.2 æ‰§è¡Œæµç¨‹</h3><pre><code class=" mermaid">graph TD    A[ç”¨æˆ·é—®é¢˜] --&gt; B[Thought: æˆ‘éœ€è¦åšä»€ä¹ˆ?]    B --&gt; C[Action: è°ƒç”¨å·¥å…·]    C --&gt; D[Observation: è§‚å¯Ÿç»“æœ]    D --&gt; E&#123;ä»»åŠ¡å®Œæˆ?&#125;    E --&gt;|å¦| B    E --&gt;|æ˜¯| F[Final Answer: æœ€ç»ˆå›ç­”]</code></pre><h3 id="1-3-Prompt-æ¨¡æ¿"><a href="#1-3-Prompt-æ¨¡æ¿" class="headerlink" title="1.3 Prompt æ¨¡æ¿"></a>1.3 Prompt æ¨¡æ¿</h3><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">ä½ æ˜¯ä¸€ä¸ªèƒ½ä½¿ç”¨å·¥å…·çš„ AI åŠ©æ‰‹ã€‚</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">å¯ç”¨å·¥å…·ï¼š</span><br><span class="hljs-attribute">1. search(query) - æœç´¢ç½‘ç»œä¿¡æ¯</span><br><span class="hljs-attribute">2. calculator(expression) - è®¡ç®—æ•°å­¦è¡¨è¾¾å¼</span><br><span class="hljs-attribute">3. get_weather(city) - è·å–åŸå¸‚å¤©æ°”</span><br><span class="hljs-attribute">4. run_code(code) - æ‰§è¡Œ Python ä»£ç </span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼å›ç­”ï¼š</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">Thought</span><span class="hljs-punctuation">:</span> <span class="hljs-string">æ€è€ƒå½“å‰åº”è¯¥åšä»€ä¹ˆ</span><br><span class="hljs-attribute">Action</span><span class="hljs-punctuation">:</span> <span class="hljs-string">å·¥å…·åç§°</span><br><span class="hljs-attribute">Action Input</span><span class="hljs-punctuation">:</span> <span class="hljs-string">å·¥å…·å‚æ•°ï¼ˆJSONæ ¼å¼ï¼‰</span><br><span class="hljs-attribute">Observation</span><span class="hljs-punctuation">:</span> <span class="hljs-string">[ç³»ç»Ÿè¿”å›å·¥å…·æ‰§è¡Œç»“æœ]</span><br><br><span class="hljs-attribute">...ï¼ˆé‡å¤ Thought/Action/Observation ç›´åˆ°ä»»åŠ¡å®Œæˆï¼‰</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">Thought</span><span class="hljs-punctuation">:</span> <span class="hljs-string">æˆ‘å·²ç»è·å¾—äº†è¶³å¤Ÿçš„ä¿¡æ¯</span><br><span class="hljs-attribute">Final Answer</span><span class="hljs-punctuation">:</span> <span class="hljs-string">æœ€ç»ˆç­”æ¡ˆ</span><br><br>æ³¨æ„ï¼š<br><span class="hljs-bullet">-</span> <span class="hljs-string">æ¯æ¬¡åªèƒ½è°ƒç”¨ä¸€ä¸ªå·¥å…·</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">å¿…é¡»ç­‰å¾… Observation åå†ç»§ç»­æ€è€ƒ</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">ä¸è¦ç¼–é€  Observationï¼Œç­‰å¾…ç³»ç»Ÿè¿”å›</span><br><br>ç”¨æˆ·é—®é¢˜ï¼š&#123;question&#125;<br></code></pre></td></tr></table></figure><h3 id="1-4-æ‰§è¡Œç¤ºä¾‹"><a href="#1-4-æ‰§è¡Œç¤ºä¾‹" class="headerlink" title="1.4 æ‰§è¡Œç¤ºä¾‹"></a>1.4 æ‰§è¡Œç¤ºä¾‹</h3><p><strong>ç”¨æˆ·é—®</strong>ï¼šâ€å¸®æˆ‘æŸ¥ä¸€ä¸‹ä¸Šæµ·ä»Šå¤©çš„å¤©æ°”ï¼Œå¦‚æœæ°”æ¸©è¶…è¿‡30åº¦ï¼Œå¸®æˆ‘è®¡ç®—éœ€è¦å–å¤šå°‘æ°´ï¼ˆä½“é‡70kgï¼Œæ¯å…¬æ–¤40mlï¼‰â€</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Thought</span>: æˆ‘éœ€è¦å…ˆæŸ¥è¯¢ä¸Šæµ·çš„å¤©æ°”ï¼Œè·å–æ¸©åº¦ä¿¡æ¯<br><span class="hljs-attribute">Action</span>: get_weather<br><span class="hljs-attribute">Action</span> Input: &#123;<span class="hljs-string">&quot;city&quot;</span>: <span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>&#125;<br><span class="hljs-attribute">Observation</span>: &#123;<span class="hljs-string">&quot;city&quot;</span>: <span class="hljs-string">&quot;ä¸Šæµ·&quot;</span>, <span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-number">35</span>, <span class="hljs-string">&quot;humidity&quot;</span>: <span class="hljs-number">75</span>, <span class="hljs-string">&quot;condition&quot;</span>: <span class="hljs-string">&quot;æ™´&quot;</span>&#125;<br><br><span class="hljs-attribute">Thought</span>: ä¸Šæµ·æ°”æ¸©<span class="hljs-number">35</span>åº¦ï¼Œè¶…è¿‡<span class="hljs-number">30</span>åº¦äº†ã€‚ç°åœ¨æˆ‘éœ€è¦è®¡ç®—å–æ°´é‡ï¼š<span class="hljs-number">70</span>kg Ã— <span class="hljs-number">40</span>ml = <span class="hljs-number">2800</span>ml<br><span class="hljs-attribute">Action</span>: calculator<br><span class="hljs-attribute">Action</span> Input: &#123;<span class="hljs-string">&quot;expression&quot;</span>: <span class="hljs-string">&quot;70 * 40&quot;</span>&#125;<br><span class="hljs-attribute">Observation</span>: <span class="hljs-number">2800</span><br><br><span class="hljs-attribute">Thought</span>: æˆ‘å·²ç»è·å¾—äº†æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯<br><span class="hljs-attribute">Final</span> Answer: ä¸Šæµ·ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œæ°”æ¸©<span class="hljs-number">35</span>Â°Cï¼Œæ¹¿åº¦<span class="hljs-number">75</span>%ã€‚ç”±äºæ°”æ¸©è¶…è¿‡<span class="hljs-number">30</span>åº¦ï¼Œå»ºè®®æ‚¨å¤šè¡¥å……æ°´åˆ†ã€‚æŒ‰ç…§æ‚¨çš„ä½“é‡<span class="hljs-number">70</span>kgè®¡ç®—ï¼Œä»Šå¤©å»ºè®®é¥®æ°´é‡ä¸º<span class="hljs-number">2800</span>mlï¼ˆçº¦<span class="hljs-number">2</span>.<span class="hljs-number">8</span>å‡ï¼‰ã€‚<br></code></pre></td></tr></table></figure><h3 id="1-5-Spring-AI-å®ç°"><a href="#1-5-Spring-AI-å®ç°" class="headerlink" title="1.5 Spring AI å®ç°"></a>1.5 Spring AI å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentConfig</span> &#123;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ChatClient <span class="hljs-title function_">chatClient</span><span class="hljs-params">(ChatClient.Builder builder,</span><br><span class="hljs-params">                                  WeatherTool weatherTool,</span><br><span class="hljs-params">                                  CalculatorTool calculatorTool)</span> &#123;<br>        <span class="hljs-keyword">return</span> builder<br>            .defaultSystem(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">                ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·æ¥å¸®åŠ©ç”¨æˆ·ã€‚</span><br><span class="hljs-string">                è¯·ä»”ç»†åˆ†æç”¨æˆ·çš„é—®é¢˜ï¼Œé€‰æ‹©åˆé€‚çš„å·¥å…·æ¥è·å–ä¿¡æ¯ã€‚</span><br><span class="hljs-string">                &quot;&quot;&quot;</span>)<br>            .defaultTools(weatherTool, calculatorTool)<br>            .build();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeatherTool</span> &#123;<br>    <br>    <span class="hljs-meta">@Tool(description = &quot;è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯ï¼Œè¿”å›æ¸©åº¦ã€æ¹¿åº¦ç­‰&quot;)</span><br>    <span class="hljs-keyword">public</span> WeatherInfo <span class="hljs-title function_">getWeather</span><span class="hljs-params">(</span><br><span class="hljs-params">        <span class="hljs-meta">@ToolParam(description = &quot;åŸå¸‚åç§°ï¼Œå¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·&quot;)</span> String city</span><br><span class="hljs-params">    )</span> &#123;<br>        <span class="hljs-comment">// è°ƒç”¨å¤©æ°” API</span><br>        <span class="hljs-keyword">return</span> weatherApi.query(city);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CalculatorTool</span> &#123;<br>    <br>    <span class="hljs-meta">@Tool(description = &quot;è®¡ç®—æ•°å­¦è¡¨è¾¾å¼ï¼Œæ”¯æŒåŠ å‡ä¹˜é™¤&quot;)</span><br>    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">calculator</span><span class="hljs-params">(</span><br><span class="hljs-params">        <span class="hljs-meta">@ToolParam(description = &quot;æ•°å­¦è¡¨è¾¾å¼ï¼Œå¦‚ï¼š70 * 40&quot;)</span> String expression</span><br><span class="hljs-params">    )</span> &#123;<br>        <span class="hljs-type">ScriptEngine</span> <span class="hljs-variable">engine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScriptEngineManager</span>()<br>            .getEngineByName(<span class="hljs-string">&quot;JavaScript&quot;</span>);<br>        <span class="hljs-keyword">return</span> ((Number) engine.eval(expression)).doubleValue();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentController</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br>    <br>    <span class="hljs-meta">@PostMapping(&quot;/agent/chat&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">chat</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String question)</span> &#123;<br>        <span class="hljs-keyword">return</span> chatClient.prompt()<br>            .user(question)<br>            .call()<br>            .content();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-6-ReAct-ä¼˜ç¼ºç‚¹"><a href="#1-6-ReAct-ä¼˜ç¼ºç‚¹" class="headerlink" title="1.6 ReAct ä¼˜ç¼ºç‚¹"></a>1.6 ReAct ä¼˜ç¼ºç‚¹</h3><table><thead><tr><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>å®ç°ç®€å•ç›´è§‚</td><td>å¯èƒ½èµ°å¼¯è·¯ï¼Œæ•ˆç‡ä¸é«˜</td></tr><tr><td>çµæ´»æ€§é«˜ï¼Œå¯éšæ—¶è°ƒæ•´</td><td>å¤æ‚ä»»åŠ¡å®¹æ˜“è¿·å¤±æ–¹å‘</td></tr><tr><td>é€‚åˆæ¢ç´¢æ€§ä»»åŠ¡</td><td>Token æ¶ˆè€—è¾ƒå¤š</td></tr><tr><td>ä¸­é—´è¿‡ç¨‹å¯è§‚å¯Ÿ</td><td>é•¿ä»»åŠ¡å®¹æ˜“è¶…å‡ºä¸Šä¸‹æ–‡</td></tr></tbody></table><hr><h2 id="äºŒã€Plan-and-Execute-æ¨¡å¼"><a href="#äºŒã€Plan-and-Execute-æ¨¡å¼" class="headerlink" title="äºŒã€Plan-and-Execute æ¨¡å¼"></a>äºŒã€Plan-and-Execute æ¨¡å¼</h2><h3 id="2-1-æ ¸å¿ƒæ€æƒ³"><a href="#2-1-æ ¸å¿ƒæ€æƒ³" class="headerlink" title="2.1 æ ¸å¿ƒæ€æƒ³"></a>2.1 æ ¸å¿ƒæ€æƒ³</h3><p><strong>å…ˆè§„åˆ’ï¼Œåæ‰§è¡Œ</strong>ã€‚å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªå­ä»»åŠ¡ï¼Œç„¶åæŒ‰è®¡åˆ’é€æ­¥æ‰§è¡Œã€‚</p><h3 id="2-2-æ‰§è¡Œæµç¨‹"><a href="#2-2-æ‰§è¡Œæµç¨‹" class="headerlink" title="2.2 æ‰§è¡Œæµç¨‹"></a>2.2 æ‰§è¡Œæµç¨‹</h3><pre><code class=" mermaid">graph TD    A[ç”¨æˆ·é—®é¢˜] --&gt; B[Planner: åˆ†æä»»åŠ¡]    B --&gt; C[ç”Ÿæˆæ‰§è¡Œè®¡åˆ’]    C --&gt; D[Executor: æ‰§è¡Œæ­¥éª¤1]    D --&gt; E[Executor: æ‰§è¡Œæ­¥éª¤2]    E --&gt; F[Executor: æ‰§è¡Œæ­¥éª¤N]    F --&gt; G&#123;æ‰§è¡Œç»“æœç¬¦åˆé¢„æœŸ?&#125;    G --&gt;|å¦| H[Replanner: è°ƒæ•´è®¡åˆ’]    H --&gt; C    G --&gt;|æ˜¯| I[æ±‡æ€»ç»“æœ]    I --&gt; J[Final Answer]</code></pre><h3 id="2-3-åŒ-Agent-æ¶æ„"><a href="#2-3-åŒ-Agent-æ¶æ„" class="headerlink" title="2.3 åŒ Agent æ¶æ„"></a>2.3 åŒ Agent æ¶æ„</h3><pre><code class=" mermaid">graph LR    subgraph Planner Agent        A[ä»»åŠ¡åˆ†æ] --&gt; B[è®¡åˆ’ç”Ÿæˆ]        B --&gt; C[è®¡åˆ’ä¼˜åŒ–]    end        subgraph Executor Agent        D[æ¥æ”¶æ­¥éª¤] --&gt; E[æ‰§è¡Œå·¥å…·]        E --&gt; F[è¿”å›ç»“æœ]    end        C --&gt; D    F --&gt; G&#123;éœ€è¦é‡æ–°è§„åˆ’?&#125;    G --&gt;|æ˜¯| A    G --&gt;|å¦| H[å®Œæˆ]</code></pre><h3 id="2-4-Planner-Prompt-æ¨¡æ¿"><a href="#2-4-Planner-Prompt-æ¨¡æ¿" class="headerlink" title="2.4 Planner Prompt æ¨¡æ¿"></a>2.4 Planner Prompt æ¨¡æ¿</h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs perl">ä½ æ˜¯ä¸€ä¸ªä»»åŠ¡è§„åˆ’ä¸“å®¶ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„é—®é¢˜ï¼Œåˆ¶å®šè¯¦ç»†çš„æ‰§è¡Œè®¡åˆ’ã€‚<br><br><span class="hljs-comment">## è§„åˆ’åŸåˆ™</span><br><span class="hljs-number">1</span>. å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºç®€å•çš„å­æ­¥éª¤<br><span class="hljs-number">2</span>. æ¯ä¸ªæ­¥éª¤åº”è¯¥æ˜¯åŸå­æ€§çš„ã€å¯æ‰§è¡Œçš„<br><span class="hljs-number">3</span>. æ­¥éª¤ä¹‹é—´è¦æœ‰æ¸…æ™°çš„ä¾èµ–å…³ç³»<br><span class="hljs-number">4</span>. è€ƒè™‘å¯èƒ½çš„å¤±è´¥æƒ…å†µå’Œå¤‡é€‰æ–¹æ¡ˆ<br><br><span class="hljs-comment">## å¯ç”¨å·¥å…·</span><br>- search(query): æœç´¢ç½‘ç»œä¿¡æ¯<br>- read_file(path): è¯»å–æ–‡ä»¶å†…å®¹<br>- write_file(path, content): å†™å…¥æ–‡ä»¶<br>- run_code(language, code): æ‰§è¡Œä»£ç <br>- api_call(url, <span class="hljs-function"><span class="hljs-keyword">method</span>, <span class="hljs-title">data</span>): è°ƒç”¨ <span class="hljs-title">API</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">## è¾“å‡ºæ ¼å¼</span><br><span class="hljs-function">è¯·ä»¥ <span class="hljs-title">JSON</span> æ ¼å¼è¾“å‡ºè®¡åˆ’ï¼š</span><br><span class="hljs-function">```<span class="hljs-title">json</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-string">&quot;goal&quot;</span>: <span class="hljs-string">&quot;ä»»åŠ¡ç›®æ ‡æè¿°&quot;</span>,<br>  <span class="hljs-string">&quot;steps&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,<br>      <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;æ­¥éª¤æè¿°&quot;</span>,<br>      <span class="hljs-string">&quot;tool&quot;</span>: <span class="hljs-string">&quot;å·¥å…·åç§°&quot;</span>,<br>      <span class="hljs-string">&quot;params&quot;</span>: &#123;<span class="hljs-string">&quot;å‚æ•°&quot;</span>: <span class="hljs-string">&quot;å€¼&quot;</span>&#125;,<br>      <span class="hljs-string">&quot;depends_on&quot;</span>: [],<br>      <span class="hljs-string">&quot;expected_output&quot;</span>: <span class="hljs-string">&quot;é¢„æœŸè¾“å‡º&quot;</span><br>    &#125;<br>  ],<br>  <span class="hljs-string">&quot;success_criteria&quot;</span>: <span class="hljs-string">&quot;æˆåŠŸæ ‡å‡†&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç”¨æˆ·é—®é¢˜ï¼š{question}</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>### <span class="hljs-number">2.5</span> æ‰§è¡Œç¤ºä¾‹<br><br>**ç”¨æˆ·é—®**ï¼š<span class="hljs-string">&quot;å¸®æˆ‘è°ƒç ” Spring AI æ¡†æ¶ï¼Œå†™ä¸€ä»½æŠ€æœ¯é€‰å‹æŠ¥å‘Š&quot;</span><br><br>#### Planner è¾“å‡º<br><br>```json<br>&#123;<br>  <span class="hljs-string">&quot;goal&quot;</span>: <span class="hljs-string">&quot;å®Œæˆ Spring AI æ¡†æ¶æŠ€æœ¯é€‰å‹æŠ¥å‘Š&quot;</span>,<br>  <span class="hljs-string">&quot;steps&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,<br>      <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;æœç´¢ Spring AI å®˜æ–¹æ–‡æ¡£å’ŒåŸºæœ¬ä»‹ç»&quot;</span>,<br>      <span class="hljs-string">&quot;tool&quot;</span>: <span class="hljs-string">&quot;search&quot;</span>,<br>      <span class="hljs-string">&quot;params&quot;</span>: &#123;<span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Spring AI official documentation introduction&quot;</span>&#125;,<br>      <span class="hljs-string">&quot;depends_on&quot;</span>: [],<br>      <span class="hljs-string">&quot;expected_output&quot;</span>: <span class="hljs-string">&quot;Spring AI åŸºæœ¬æ¦‚å¿µå’Œç‰¹æ€§&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">2</span>,<br>      <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;æœç´¢ Spring AI æœ€æ–°ç‰ˆæœ¬å’Œæ›´æ–°å†…å®¹&quot;</span>,<br>      <span class="hljs-string">&quot;tool&quot;</span>: <span class="hljs-string">&quot;search&quot;</span>,<br>      <span class="hljs-string">&quot;params&quot;</span>: &#123;<span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Spring AI latest version features 2024&quot;</span>&#125;,<br>      <span class="hljs-string">&quot;depends_on&quot;</span>: [],<br>      <span class="hljs-string">&quot;expected_output&quot;</span>: <span class="hljs-string">&quot;ç‰ˆæœ¬ä¿¡æ¯å’Œæ–°ç‰¹æ€§&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">3</span>,<br>      <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;æœç´¢ Spring AI ä¸ LangChain4j å¯¹æ¯”&quot;</span>,<br>      <span class="hljs-string">&quot;tool&quot;</span>: <span class="hljs-string">&quot;search&quot;</span>,<br>      <span class="hljs-string">&quot;params&quot;</span>: &#123;<span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Spring AI vs LangChain4j comparison&quot;</span>&#125;,<br>      <span class="hljs-string">&quot;depends_on&quot;</span>: [],<br>      <span class="hljs-string">&quot;expected_output&quot;</span>: <span class="hljs-string">&quot;æ¡†æ¶å¯¹æ¯”åˆ†æ&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">4</span>,<br>      <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;æœç´¢ Spring AI å®é™…åº”ç”¨æ¡ˆä¾‹&quot;</span>,<br>      <span class="hljs-string">&quot;tool&quot;</span>: <span class="hljs-string">&quot;search&quot;</span>,<br>      <span class="hljs-string">&quot;params&quot;</span>: &#123;<span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Spring AI production use cases&quot;</span>&#125;,<br>      <span class="hljs-string">&quot;depends_on&quot;</span>: [],<br>      <span class="hljs-string">&quot;expected_output&quot;</span>: <span class="hljs-string">&quot;ä¼ä¸šåº”ç”¨æ¡ˆä¾‹&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">5</span>,<br>      <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;æ•´åˆæ‰€æœ‰ä¿¡æ¯ï¼Œç”ŸæˆæŠ€æœ¯é€‰å‹æŠ¥å‘Š&quot;</span>,<br>      <span class="hljs-string">&quot;tool&quot;</span>: <span class="hljs-string">&quot;generate_report&quot;</span>,<br>      <span class="hljs-string">&quot;params&quot;</span>: &#123;<span class="hljs-string">&quot;template&quot;</span>: <span class="hljs-string">&quot;tech_selection&quot;</span>&#125;,<br>      <span class="hljs-string">&quot;depends_on&quot;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>],<br>      <span class="hljs-string">&quot;expected_output&quot;</span>: <span class="hljs-string">&quot;å®Œæ•´çš„æŠ€æœ¯é€‰å‹æŠ¥å‘Š&quot;</span><br>    &#125;<br>  ],<br>  <span class="hljs-string">&quot;success_criteria&quot;</span>: <span class="hljs-string">&quot;æŠ¥å‘ŠåŒ…å«æ¡†æ¶ä»‹ç»ã€ç‰¹æ€§åˆ†æã€å¯¹æ¯”è¯„ä¼°ã€åº”ç”¨å»ºè®®&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Executor-æ‰§è¡Œ"><a href="#Executor-æ‰§è¡Œ" class="headerlink" title="Executor æ‰§è¡Œ"></a>Executor æ‰§è¡Œ</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">=== æ‰§è¡Œæ­¥éª¤ 1-4ï¼ˆå¯å¹¶è¡Œï¼‰===</span><br>Step 1 ç»“æœ: Spring AI æ˜¯ Spring å®˜æ–¹çš„ AI é›†æˆæ¡†æ¶...<br>Step 2 ç»“æœ: æœ€æ–°ç‰ˆæœ¬ 1.0.0ï¼Œæ”¯æŒå¤šç§æ¨¡å‹æä¾›å•†...<br>Step 3 ç»“æœ: Spring AI æ›´æ³¨é‡ Spring ç”Ÿæ€é›†æˆ...<br>Step 4 ç»“æœ: æŸç”µå•†å…¬å¸ä½¿ç”¨ Spring AI æ„å»ºæ™ºèƒ½å®¢æœ...<br><br><span class="hljs-section">=== æ‰§è¡Œæ­¥éª¤ 5 ===</span><br><span class="hljs-meta">[ç”Ÿæˆå®Œæ•´æŠ¥å‘Š]</span><br></code></pre></td></tr></table></figure><h3 id="2-6-Java-å®ç°æ¡†æ¶"><a href="#2-6-Java-å®ç°æ¡†æ¶" class="headerlink" title="2.6 Java å®ç°æ¡†æ¶"></a>2.6 Java å®ç°æ¡†æ¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlanAndExecuteAgent</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient plannerClient;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient executorClient;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ToolRegistry toolRegistry;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">execute</span><span class="hljs-params">(String question)</span> &#123;<br>        <span class="hljs-comment">// 1. ç”Ÿæˆè®¡åˆ’</span><br>        <span class="hljs-type">Plan</span> <span class="hljs-variable">plan</span> <span class="hljs-operator">=</span> generatePlan(question);<br>        <br>        <span class="hljs-comment">// 2. æ‰§è¡Œè®¡åˆ’</span><br>        Map&lt;Integer, StepResult&gt; results = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <br>        <span class="hljs-keyword">for</span> (Step step : plan.getSteps()) &#123;<br>            <span class="hljs-comment">// æ£€æŸ¥ä¾èµ–æ˜¯å¦å®Œæˆ</span><br>            <span class="hljs-keyword">if</span> (!checkDependencies(step, results)) &#123;<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <br>            <span class="hljs-comment">// æ‰§è¡Œæ­¥éª¤</span><br>            <span class="hljs-type">StepResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> executeStep(step, results);<br>            results.put(step.getId(), result);<br>            <br>            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦é‡æ–°è§„åˆ’</span><br>            <span class="hljs-keyword">if</span> (result.needsReplan()) &#123;<br>                plan = replan(question, plan, results);<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-comment">// 3. æ±‡æ€»ç»“æœ</span><br>        <span class="hljs-keyword">return</span> summarize(question, results);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> Plan <span class="hljs-title function_">generatePlan</span><span class="hljs-params">(String question)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> plannerClient.prompt()<br>            .system(PLANNER_PROMPT)<br>            .user(question)<br>            .call()<br>            .content();<br>        <span class="hljs-keyword">return</span> parseJson(response, Plan.class);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> StepResult <span class="hljs-title function_">executeStep</span><span class="hljs-params">(Step step, Map&lt;Integer, StepResult&gt; context)</span> &#123;<br>        <span class="hljs-type">Tool</span> <span class="hljs-variable">tool</span> <span class="hljs-operator">=</span> toolRegistry.get(step.getTool());<br>        <span class="hljs-keyword">return</span> tool.execute(step.getParams(), context);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Plan</span> &#123;<br>    <span class="hljs-keyword">private</span> String goal;<br>    <span class="hljs-keyword">private</span> List&lt;Step&gt; steps;<br>    <span class="hljs-keyword">private</span> String successCriteria;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Step</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-keyword">private</span> String description;<br>    <span class="hljs-keyword">private</span> String tool;<br>    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; params;<br>    <span class="hljs-keyword">private</span> List&lt;Integer&gt; dependsOn;<br>    <span class="hljs-keyword">private</span> String expectedOutput;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-7-Plan-and-Execute-ä¼˜ç¼ºç‚¹"><a href="#2-7-Plan-and-Execute-ä¼˜ç¼ºç‚¹" class="headerlink" title="2.7 Plan-and-Execute ä¼˜ç¼ºç‚¹"></a>2.7 Plan-and-Execute ä¼˜ç¼ºç‚¹</h3><table><thead><tr><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>å…¨å±€è§†è§’ï¼Œä¸æ˜“è¿·å¤±</td><td>åˆå§‹è§„åˆ’å¯èƒ½ä¸å¤Ÿå‡†ç¡®</td></tr><tr><td>å¯å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹æ­¥éª¤</td><td>éœ€è¦é¢å¤–çš„è§„åˆ’å¼€é”€</td></tr><tr><td>å¤æ‚ä»»åŠ¡æ•ˆç‡é«˜</td><td>çµæ´»æ€§ç›¸å¯¹è¾ƒä½</td></tr><tr><td>æ˜“äºè¿½è¸ªå’Œè°ƒè¯•</td><td>å®ç°å¤æ‚åº¦è¾ƒé«˜</td></tr></tbody></table><hr><h2 id="ä¸‰ã€å…¶ä»–-Agent-æ¨¡å¼"><a href="#ä¸‰ã€å…¶ä»–-Agent-æ¨¡å¼" class="headerlink" title="ä¸‰ã€å…¶ä»– Agent æ¨¡å¼"></a>ä¸‰ã€å…¶ä»– Agent æ¨¡å¼</h2><h3 id="3-1-Reflexionï¼ˆåæ€æ¨¡å¼ï¼‰"><a href="#3-1-Reflexionï¼ˆåæ€æ¨¡å¼ï¼‰" class="headerlink" title="3.1 Reflexionï¼ˆåæ€æ¨¡å¼ï¼‰"></a>3.1 Reflexionï¼ˆåæ€æ¨¡å¼ï¼‰</h3><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæ‰§è¡Œåè¿›è¡Œè‡ªæˆ‘åæ€ï¼Œä»é”™è¯¯ä¸­å­¦ä¹ ã€‚</p><pre><code class=" mermaid">graph TD    A[æ‰§è¡Œä»»åŠ¡] --&gt; B[è¯„ä¼°ç»“æœ]    B --&gt; C&#123;æˆåŠŸ?&#125;    C --&gt;|æ˜¯| D[å®Œæˆ]    C --&gt;|å¦| E[åæ€: ä¸ºä»€ä¹ˆå¤±è´¥?]    E --&gt; F[æ€»ç»“ç»éªŒæ•™è®­]    F --&gt; G[æ”¹è¿›ç­–ç•¥]    G --&gt; A</code></pre><p><strong>Prompt ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs clean">## ä»»åŠ¡<br>&#123;task&#125;<br><br>## ä¸Šæ¬¡å°è¯•<br>&#123;previous_attempt&#125;<br><br>## æ‰§è¡Œç»“æœ<br>&#123;result&#125;<br><br>## åæ€<br>è¯·åˆ†æä¸Šæ¬¡å°è¯•ä¸ºä»€ä¹ˆæ²¡æœ‰è¾¾åˆ°é¢„æœŸæ•ˆæœï¼š<br><span class="hljs-number">1.</span> å“ªäº›æ­¥éª¤æ˜¯æ­£ç¡®çš„ï¼Ÿ<br><span class="hljs-number">2.</span> å“ªäº›æ­¥éª¤éœ€è¦æ”¹è¿›ï¼Ÿ<br><span class="hljs-number">3.</span> æœ‰ä»€ä¹ˆé—æ¼çš„ä¿¡æ¯ï¼Ÿ<br><br>## æ”¹è¿›è®¡åˆ’<br>åŸºäºåæ€ï¼Œåˆ¶å®šæ–°çš„æ‰§è¡Œè®¡åˆ’ï¼š<br></code></pre></td></tr></table></figure><h3 id="3-2-LATSï¼ˆLanguage-Agent-Tree-Searchï¼‰"><a href="#3-2-LATSï¼ˆLanguage-Agent-Tree-Searchï¼‰" class="headerlink" title="3.2 LATSï¼ˆLanguage Agent Tree Searchï¼‰"></a>3.2 LATSï¼ˆLanguage Agent Tree Searchï¼‰</h3><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šç»“åˆè’™ç‰¹å¡æ´›æ ‘æœç´¢ï¼ˆMCTSï¼‰ï¼Œæ¢ç´¢å¤šä¸ªæ‰§è¡Œè·¯å¾„ã€‚</p><pre><code class=" mermaid">graph TD    A[æ ¹èŠ‚ç‚¹: é—®é¢˜] --&gt; B[æ–¹æ¡ˆA]    A --&gt; C[æ–¹æ¡ˆB]    A --&gt; D[æ–¹æ¡ˆC]    B --&gt; E[A1]    B --&gt; F[A2]    C --&gt; G[B1]    C --&gt; H[B2]        style E fill:#90EE90    style H fill:#90EE90</code></pre><p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</p><ol><li><strong>é€‰æ‹©</strong>ï¼šé€‰æ‹©æœ€æœ‰å¸Œæœ›çš„èŠ‚ç‚¹</li><li><strong>æ‰©å±•</strong>ï¼šç”Ÿæˆå¯èƒ½çš„ä¸‹ä¸€æ­¥</li><li><strong>æ¨¡æ‹Ÿ</strong>ï¼šæ¨¡æ‹Ÿæ‰§è¡Œåˆ°ç»“æŸ</li><li><strong>å›æº¯</strong>ï¼šæ›´æ–°è·¯å¾„ä¸ŠèŠ‚ç‚¹çš„è¯„åˆ†</li></ol><h3 id="3-3-Multi-Agentï¼ˆå¤šæ™ºèƒ½ä½“ï¼‰"><a href="#3-3-Multi-Agentï¼ˆå¤šæ™ºèƒ½ä½“ï¼‰" class="headerlink" title="3.3 Multi-Agentï¼ˆå¤šæ™ºèƒ½ä½“ï¼‰"></a>3.3 Multi-Agentï¼ˆå¤šæ™ºèƒ½ä½“ï¼‰</h3><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå¤šä¸ªä¸“ä¸š Agent åä½œå®Œæˆä»»åŠ¡ã€‚</p><pre><code class=" mermaid">graph TB    A[ç”¨æˆ·é—®é¢˜] --&gt; B[Orchestrator]    B --&gt; C[Research Agent]    B --&gt; D[Coding Agent]    B --&gt; E[Review Agent]    C --&gt; F[æœç´¢/é˜…è¯»]    D --&gt; G[ç¼–å†™ä»£ç ]    E --&gt; H[ä»£ç å®¡æŸ¥]    F --&gt; B    G --&gt; B    H --&gt; B    B --&gt; I[æœ€ç»ˆç»“æœ]</code></pre><p><strong>è§’è‰²åˆ†å·¥ç¤ºä¾‹</strong>ï¼š</p><table><thead><tr><th>Agent</th><th>èŒè´£</th><th>å·¥å…·</th></tr></thead><tbody><tr><td>Orchestrator</td><td>ä»»åŠ¡åˆ†å‘ã€ç»“æœæ±‡æ€»</td><td>æ— </td></tr><tr><td>Research Agent</td><td>ä¿¡æ¯æ”¶é›†ã€è°ƒç ”</td><td>searchã€read_url</td></tr><tr><td>Coding Agent</td><td>ä»£ç ç¼–å†™</td><td>code_interpreter</td></tr><tr><td>Review Agent</td><td>ä»£ç å®¡æŸ¥ã€è´¨é‡æ£€æŸ¥</td><td>static_analysis</td></tr><tr><td>Test Agent</td><td>ç¼–å†™å’Œè¿è¡Œæµ‹è¯•</td><td>test_runner</td></tr></tbody></table><p><strong>Spring AI å¤š Agent å®ç°</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiAgentOrchestrator</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Agent&gt; agents;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">orchestrate</span><span class="hljs-params">(String task)</span> &#123;<br>        <span class="hljs-comment">// 1. åˆ†æä»»åŠ¡ï¼Œç¡®å®šéœ€è¦å“ªäº› Agent</span><br>        List&lt;AgentTask&gt; agentTasks = analyzeTask(task);<br>        <br>        <span class="hljs-comment">// 2. åˆ†å‘ä»»åŠ¡ç»™å„ Agent</span><br>        Map&lt;String, CompletableFuture&lt;String&gt;&gt; futures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (AgentTask agentTask : agentTasks) &#123;<br>            <span class="hljs-type">Agent</span> <span class="hljs-variable">agent</span> <span class="hljs-operator">=</span> agents.get(agentTask.getAgentType());<br>            futures.put(agentTask.getId(), <br>                CompletableFuture.supplyAsync(() -&gt; <br>                    agent.execute(agentTask.getPrompt())<br>                )<br>            );<br>        &#125;<br>        <br>        <span class="hljs-comment">// 3. æ”¶é›†ç»“æœ</span><br>        Map&lt;String, String&gt; results = futures.entrySet().stream()<br>            .collect(Collectors.toMap(<br>                Map.Entry::getKey,<br>                e -&gt; e.getValue().join()<br>            ));<br>        <br>        <span class="hljs-comment">// 4. æ±‡æ€»ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ</span><br>        <span class="hljs-keyword">return</span> synthesize(task, results);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Agent</span> &#123;<br>    String <span class="hljs-title function_">execute</span><span class="hljs-params">(String prompt)</span>;<br>&#125;<br><br><span class="hljs-meta">@Component(&quot;research&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ResearchAgent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Agent</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SearchTool searchTool;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">execute</span><span class="hljs-params">(String prompt)</span> &#123;<br>        <span class="hljs-keyword">return</span> chatClient.prompt()<br>            .system(<span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªç ”ç©¶ä¸“å®¶ï¼Œå–„äºæ”¶é›†å’Œæ•´ç†ä¿¡æ¯&quot;</span>)<br>            .user(prompt)<br>            .tools(searchTool)<br>            .call()<br>            .content();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-4-AutoGPT-æ¨¡å¼"><a href="#3-4-AutoGPT-æ¨¡å¼" class="headerlink" title="3.4 AutoGPT æ¨¡å¼"></a>3.4 AutoGPT æ¨¡å¼</h3><p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå…¨è‡ªåŠ¨ä»»åŠ¡æ‰§è¡Œï¼Œæœ€å°‘äººå·¥å¹²é¢„ã€‚</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs markdown">ç›®æ ‡ï¼š&#123;goal&#125;<br><br>çº¦æŸï¼š<br><span class="hljs-bullet">1.</span> æ¯æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªåŠ¨ä½œ<br><span class="hljs-bullet">2.</span> å¿…é¡»åœ¨ 10 æ­¥å†…å®Œæˆ<br><span class="hljs-bullet">3.</span> é‡åˆ°ä¸ç¡®å®šæ—¶è¯¢é—®ç”¨æˆ·<br><br>å½“å‰çŠ¶æ€ï¼š&#123;current<span class="hljs-emphasis">_state&#125;</span><br><span class="hljs-emphasis">å·²å®Œæˆæ­¥éª¤ï¼š&#123;completed_</span>steps&#125;<br>å¯ç”¨å·¥å…·ï¼š&#123;tools&#125;<br><br>è¯·å†³å®šä¸‹ä¸€æ­¥åŠ¨ä½œï¼š<br><span class="hljs-bullet">1.</span> æ€è€ƒå½“å‰è¿›åº¦<br><span class="hljs-bullet">2.</span> é€‰æ‹©ä¸‹ä¸€ä¸ªåŠ¨ä½œ<br><span class="hljs-bullet">3.</span> æ‰§è¡Œå¹¶è§‚å¯Ÿç»“æœ<br><span class="hljs-bullet">4.</span> åˆ¤æ–­æ˜¯å¦å®Œæˆç›®æ ‡<br></code></pre></td></tr></table></figure><hr><h2 id="å››ã€æ¨¡å¼é€‰æ‹©æŒ‡å—"><a href="#å››ã€æ¨¡å¼é€‰æ‹©æŒ‡å—" class="headerlink" title="å››ã€æ¨¡å¼é€‰æ‹©æŒ‡å—"></a>å››ã€æ¨¡å¼é€‰æ‹©æŒ‡å—</h2><h3 id="4-1-åœºæ™¯åŒ¹é…"><a href="#4-1-åœºæ™¯åŒ¹é…" class="headerlink" title="4.1 åœºæ™¯åŒ¹é…"></a>4.1 åœºæ™¯åŒ¹é…</h3><table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ¨¡å¼</th><th>åŸå› </th></tr></thead><tbody><tr><td>ç®€å•é—®ç­” + å•å·¥å…·</td><td>ReAct</td><td>ç›´æ¥é«˜æ•ˆ</td></tr><tr><td>å¤šæ­¥éª¤å¤æ‚ä»»åŠ¡</td><td>Plan-and-Execute</td><td>éœ€è¦å…¨å±€è§„åˆ’</td></tr><tr><td>éœ€è¦è¯•é”™çš„ä»»åŠ¡</td><td>Reflexion</td><td>ä»é”™è¯¯ä¸­å­¦ä¹ </td></tr><tr><td>æœ‰å¤šç§è§£å†³æ–¹æ¡ˆ</td><td>LATS</td><td>æ¢ç´¢æœ€ä¼˜è·¯å¾„</td></tr><tr><td>å¤§å‹å¤æ‚é¡¹ç›®</td><td>Multi-Agent</td><td>ä¸“ä¸šåˆ†å·¥åä½œ</td></tr></tbody></table><h3 id="4-2-å†³ç­–æµç¨‹å›¾"><a href="#4-2-å†³ç­–æµç¨‹å›¾" class="headerlink" title="4.2 å†³ç­–æµç¨‹å›¾"></a>4.2 å†³ç­–æµç¨‹å›¾</h3><pre><code class=" mermaid">graph TD    A[ä»»åŠ¡ç±»å‹?] --&gt; B&#123;å•æ­¥éª¤?&#125;    B --&gt;|æ˜¯| C[ç›´æ¥è°ƒç”¨ LLM]    B --&gt;|å¦| D&#123;æ­¥éª¤æ•°é‡?&#125;    D --&gt;|2-5æ­¥| E[ReAct]    D --&gt;|5+æ­¥| F&#123;éœ€è¦å¹¶è¡Œ?&#125;    F --&gt;|æ˜¯| G[Plan-and-Execute]    F --&gt;|å¦| H&#123;å¯èƒ½å¤±è´¥?&#125;    H --&gt;|æ˜¯| I[Reflexion]    H --&gt;|å¦| E</code></pre><hr><h2 id="äº”ã€æœ€ä½³å®è·µ"><a href="#äº”ã€æœ€ä½³å®è·µ" class="headerlink" title="äº”ã€æœ€ä½³å®è·µ"></a>äº”ã€æœ€ä½³å®è·µ</h2><h3 id="5-1-å·¥å…·è®¾è®¡åŸåˆ™"><a href="#5-1-å·¥å…·è®¾è®¡åŸåˆ™" class="headerlink" title="5.1 å·¥å…·è®¾è®¡åŸåˆ™"></a>5.1 å·¥å…·è®¾è®¡åŸåˆ™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// âœ… å¥½çš„å·¥å…·è®¾è®¡</span><br><span class="hljs-meta">@Tool(description = &quot;æœç´¢æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯ï¼Œè¿”å›æ¸©åº¦ï¼ˆæ‘„æ°åº¦ï¼‰ã€æ¹¿åº¦ã€å¤©æ°”çŠ¶å†µ&quot;)</span><br><span class="hljs-keyword">public</span> WeatherInfo <span class="hljs-title function_">getWeather</span><span class="hljs-params">(</span><br><span class="hljs-params">    <span class="hljs-meta">@ToolParam(description = &quot;åŸå¸‚åç§°ï¼Œæ”¯æŒä¸­æ–‡ï¼Œå¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·&quot;)</span> </span><br><span class="hljs-params">    String city</span><br><span class="hljs-params">)</span> &#123; ... &#125;<br><br><span class="hljs-comment">// âŒ ä¸å¥½çš„å·¥å…·è®¾è®¡</span><br><span class="hljs-meta">@Tool(description = &quot;è·å–å¤©æ°”&quot;)</span>  <span class="hljs-comment">// æè¿°å¤ªæ¨¡ç³Š</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">weather</span><span class="hljs-params">(String c)</span> &#123; ... &#125;  <span class="hljs-comment">// å‚æ•°åä¸æ¸…æ™°</span><br></code></pre></td></tr></table></figure><p><strong>å·¥å…·è®¾è®¡è¦ç‚¹</strong>ï¼š</p><ul><li>æè¿°æ¸…æ™°ï¼ŒåŒ…å«è¾“å…¥è¾“å‡ºè¯´æ˜</li><li>å‚æ•°å‘½åæœ‰æ„ä¹‰</li><li>è¿”å›ç±»å‹æ˜ç¡®</li><li>å•ä¸€èŒè´£</li></ul><h3 id="5-2-è®°å¿†ç®¡ç†"><a href="#5-2-è®°å¿†ç®¡ç†" class="headerlink" title="5.2 è®°å¿†ç®¡ç†"></a>5.2 è®°å¿†ç®¡ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentMemory</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> VectorStore vectorStore;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Message&gt; shortTermMemory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <br>    <span class="hljs-comment">// çŸ­æœŸè®°å¿†ï¼šå½“å‰å¯¹è¯</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToShortTerm</span><span class="hljs-params">(Message message)</span> &#123;<br>        shortTermMemory.add(message);<br>        <span class="hljs-comment">// ä¿æŒæœ€è¿‘ N æ¡</span><br>        <span class="hljs-keyword">if</span> (shortTermMemory.size() &gt; MAX_SHORT_TERM) &#123;<br>            summarizeAndArchive();<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// é•¿æœŸè®°å¿†ï¼šå‘é‡å­˜å‚¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToLongTerm</span><span class="hljs-params">(String content, Map&lt;String, Object&gt; metadata)</span> &#123;<br>        <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>(content, metadata);<br>        vectorStore.add(List.of(doc));<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ£€ç´¢ç›¸å…³è®°å¿†</span><br>    <span class="hljs-keyword">public</span> List&lt;Document&gt; <span class="hljs-title function_">recall</span><span class="hljs-params">(String query, <span class="hljs-type">int</span> topK)</span> &#123;<br>        <span class="hljs-keyword">return</span> vectorStore.similaritySearch(<br>            SearchRequest.query(query).withTopK(topK)<br>        );<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-3-é”™è¯¯å¤„ç†"><a href="#5-3-é”™è¯¯å¤„ç†" class="headerlink" title="5.3 é”™è¯¯å¤„ç†"></a>5.3 é”™è¯¯å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Tool(description = &quot;æ‰§è¡Œç½‘ç»œæœç´¢&quot;)</span><br><span class="hljs-keyword">public</span> SearchResult <span class="hljs-title function_">search</span><span class="hljs-params">(String query)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">return</span> searchApi.search(query);<br>    &#125; <span class="hljs-keyword">catch</span> (RateLimitException e) &#123;<br>        <span class="hljs-keyword">return</span> SearchResult.error(<span class="hljs-string">&quot;æœç´¢æœåŠ¡ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (NetworkException e) &#123;<br>        <span class="hljs-keyword">return</span> SearchResult.error(<span class="hljs-string">&quot;ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        log.error(<span class="hljs-string">&quot;æœç´¢å¼‚å¸¸&quot;</span>, e);<br>        <span class="hljs-keyword">return</span> SearchResult.error(<span class="hljs-string">&quot;æœç´¢å¤±è´¥ï¼š&quot;</span> + e.getMessage());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-4-ç›‘æ§ä¸è¿½è¸ª"><a href="#5-4-ç›‘æ§ä¸è¿½è¸ª" class="headerlink" title="5.4 ç›‘æ§ä¸è¿½è¸ª"></a>5.4 ç›‘æ§ä¸è¿½è¸ª</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentTracingAspect</span> &#123;<br>    <br>    <span class="hljs-meta">@Around(&quot;@annotation(Tool)&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">traceToolCall</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">toolName</span> <span class="hljs-operator">=</span> pjp.getSignature().getName();<br>        Object[] args = pjp.getArgs();<br>        <br>        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> pjp.proceed();<br>            log.info(<span class="hljs-string">&quot;Tool: &#123;&#125;, Args: &#123;&#125;, Result: &#123;&#125;, Time: &#123;&#125;ms&quot;</span>,<br>                toolName, args, result, System.currentTimeMillis() - start);<br>            <span class="hljs-keyword">return</span> result;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            log.error(<span class="hljs-string">&quot;Tool: &#123;&#125; failed&quot;</span>, toolName, e);<br>            <span class="hljs-keyword">throw</span> e;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="å…­ã€å®æˆ˜é¡¹ç›®"><a href="#å…­ã€å®æˆ˜é¡¹ç›®" class="headerlink" title="å…­ã€å®æˆ˜é¡¹ç›®"></a>å…­ã€å®æˆ˜é¡¹ç›®</h2><h3 id="6-1-æ™ºèƒ½ä»£ç åŠ©æ‰‹"><a href="#6-1-æ™ºèƒ½ä»£ç åŠ©æ‰‹" class="headerlink" title="6.1 æ™ºèƒ½ä»£ç åŠ©æ‰‹"></a>6.1 æ™ºèƒ½ä»£ç åŠ©æ‰‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CodeAssistantAgent</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br>    <br>    <span class="hljs-meta">@Tool(description = &quot;è¯»å–é¡¹ç›®ä¸­çš„æºä»£ç æ–‡ä»¶&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">readCode</span><span class="hljs-params">(String filePath)</span> &#123; ... &#125;<br>    <br>    <span class="hljs-meta">@Tool(description = &quot;åœ¨é¡¹ç›®ä¸­æœç´¢ä»£ç &quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;SearchHit&gt; <span class="hljs-title function_">searchCode</span><span class="hljs-params">(String query)</span> &#123; ... &#125;<br>    <br>    <span class="hljs-meta">@Tool(description = &quot;æ‰§è¡Œå•å…ƒæµ‹è¯•&quot;)</span><br>    <span class="hljs-keyword">public</span> TestResult <span class="hljs-title function_">runTests</span><span class="hljs-params">(String testClass)</span> &#123; ... &#125;<br>    <br>    <span class="hljs-meta">@Tool(description = &quot;é™æ€ä»£ç åˆ†æ&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;Issue&gt; <span class="hljs-title function_">analyzeCode</span><span class="hljs-params">(String filePath)</span> &#123; ... &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">assist</span><span class="hljs-params">(String question)</span> &#123;<br>        <span class="hljs-keyword">return</span> chatClient.prompt()<br>            .system(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">                ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»£ç åŠ©æ‰‹ï¼Œå¯ä»¥ï¼š</span><br><span class="hljs-string">                1. é˜…è¯»å’Œç†è§£ä»£ç </span><br><span class="hljs-string">                2. æœç´¢ç›¸å…³ä»£ç ç‰‡æ®µ</span><br><span class="hljs-string">                3. è¿è¡Œæµ‹è¯•éªŒè¯</span><br><span class="hljs-string">                4. åˆ†æä»£ç è´¨é‡</span><br><span class="hljs-string">                </span><br><span class="hljs-string">                è¯·æ ¹æ®ç”¨æˆ·é—®é¢˜ï¼Œåˆç†ä½¿ç”¨å·¥å…·æ¥æä¾›å¸®åŠ©ã€‚</span><br><span class="hljs-string">                &quot;&quot;&quot;</span>)<br>            .user(question)<br>            .call()<br>            .content();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-2-è‡ªåŠ¨åŒ–è¿ç»´-Agent"><a href="#6-2-è‡ªåŠ¨åŒ–è¿ç»´-Agent" class="headerlink" title="6.2 è‡ªåŠ¨åŒ–è¿ç»´ Agent"></a>6.2 è‡ªåŠ¨åŒ–è¿ç»´ Agent</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OpsAgent</span> &#123;<br>    <br>    <span class="hljs-meta">@Tool(description = &quot;æŸ¥è¯¢æœåŠ¡å™¨æŒ‡æ ‡ï¼šCPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡&quot;)</span><br>    <span class="hljs-keyword">public</span> ServerMetrics <span class="hljs-title function_">getMetrics</span><span class="hljs-params">(String serverIp)</span> &#123; ... &#125;<br>    <br>    <span class="hljs-meta">@Tool(description = &quot;æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼Œæ”¯æŒæ—¶é—´èŒƒå›´å’Œå…³é”®å­—è¿‡æ»¤&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;LogEntry&gt; <span class="hljs-title function_">getLogs</span><span class="hljs-params">(String app, String keyword, <span class="hljs-type">int</span> minutes)</span> &#123; ... &#125;<br>    <br>    <span class="hljs-meta">@Tool(description = &quot;é‡å¯æŒ‡å®šæœåŠ¡&quot;)</span><br>    <span class="hljs-keyword">public</span> RestartResult <span class="hljs-title function_">restartService</span><span class="hljs-params">(String serviceName)</span> &#123; ... &#125;<br>    <br>    <span class="hljs-meta">@Tool(description = &quot;æ‰§è¡Œ SQL æŸ¥è¯¢ï¼ˆåªè¯»ï¼‰&quot;)</span><br>    <span class="hljs-keyword">public</span> QueryResult <span class="hljs-title function_">queryDatabase</span><span class="hljs-params">(String sql)</span> &#123; ... &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="ç›¸å…³ç¬”è®°"><a href="#ç›¸å…³ç¬”è®°" class="headerlink" title="ç›¸å…³ç¬”è®°"></a>ç›¸å…³ç¬”è®°</h2><ul><li>å¤§æ¨¡å‹å­¦ä¹ è·¯çº¿</li><li>Prompt Engineeringè¯¦è§£</li><li>RAGæŠ€æœ¯è¯¦è§£</li></ul>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Agent</tag>
      
      <tag>LLM</tag>
      
      <tag>AI</tag>
      
      <tag>ReAct</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Prompt Engineeringè¯¦è§£</title>
    <link href="/2026/01/12/Prompt%20Engineering%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/12/Prompt%20Engineering%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Prompt-Engineering-è¯¦è§£"><a href="#Prompt-Engineering-è¯¦è§£" class="headerlink" title="Prompt Engineering è¯¦è§£"></a>Prompt Engineering è¯¦è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>Prompt Engineeringï¼ˆæç¤ºè¯å·¥ç¨‹ï¼‰</strong> æ˜¯è®¾è®¡å’Œä¼˜åŒ–è¾“å…¥ç»™å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æç¤ºè¯ï¼Œä»¥è·å¾—æ›´å‡†ç¡®ã€æ›´ç¬¦åˆé¢„æœŸè¾“å‡ºçš„æŠ€æœ¯ã€‚</p><blockquote><p><strong>ğŸ’¡ æç¤º: æ ¸å¿ƒæ€æƒ³</strong><br>å¤§æ¨¡å‹çš„è¾“å‡ºè´¨é‡å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºè¾“å…¥çš„è´¨é‡ã€‚å¥½çš„ Prompt &#x3D; å¥½çš„ç»“æœã€‚</p></blockquote><h2 id="ä¸ºä»€ä¹ˆéœ€è¦-Prompt-Engineering"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-Prompt-Engineering" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ Prompt Engineering"></a>ä¸ºä»€ä¹ˆéœ€è¦ Prompt Engineering</h2><table><thead><tr><th>é—®é¢˜</th><th>åŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>è¾“å‡ºä¸å‡†ç¡®</td><td>é—®é¢˜æè¿°æ¨¡ç³Š</td><td>æ˜ç¡®ä»»åŠ¡ç›®æ ‡</td></tr><tr><td>æ ¼å¼æ··ä¹±</td><td>ç¼ºå°‘æ ¼å¼çº¦æŸ</td><td>æŒ‡å®šè¾“å‡ºæ ¼å¼</td></tr><tr><td>ç¼ºå°‘æ·±åº¦</td><td>ä¸Šä¸‹æ–‡ä¸è¶³</td><td>æä¾›èƒŒæ™¯ä¿¡æ¯</td></tr><tr><td>æ¨ç†é”™è¯¯</td><td>ä¸€æ­¥åˆ°ä½å¤ªéš¾</td><td>å¼•å¯¼é€æ­¥æ€è€ƒ</td></tr></tbody></table><hr><h2 id="ä¸€ã€åŸºç¡€æç¤ºæŠ€æœ¯"><a href="#ä¸€ã€åŸºç¡€æç¤ºæŠ€æœ¯" class="headerlink" title="ä¸€ã€åŸºç¡€æç¤ºæŠ€æœ¯"></a>ä¸€ã€åŸºç¡€æç¤ºæŠ€æœ¯</h2><h3 id="1-1-Zero-shot-Prompting"><a href="#1-1-Zero-shot-Prompting" class="headerlink" title="1.1 Zero-shot Prompting"></a>1.1 Zero-shot Prompting</h3><p><strong>å®šä¹‰</strong>ï¼šä¸æä¾›ä»»ä½•ç¤ºä¾‹ï¼Œç›´æ¥å‘æ¨¡å‹æé—®ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘æˆè‹±æ–‡ï¼š<br>ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œé€‚åˆå‡ºå»æ•£æ­¥ã€‚<br></code></pre></td></tr></table></figure><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç®€å•ä»»åŠ¡ã€æ¨¡å‹å·²ç»è®­ç»ƒè¿‡çš„å¸¸è§ä»»åŠ¡ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•ç›´æ¥<br><strong>ç¼ºç‚¹</strong>ï¼šå¤æ‚ä»»åŠ¡æ•ˆæœå·®</p><hr><h3 id="1-2-One-shot-Prompting"><a href="#1-2-One-shot-Prompting" class="headerlink" title="1.2 One-shot Prompting"></a>1.2 One-shot Prompting</h3><p><strong>å®šä¹‰</strong>ï¼šæä¾› 1 ä¸ªç¤ºä¾‹ï¼Œå¼•å¯¼æ¨¡å‹ç†è§£ä»»åŠ¡æ ¼å¼ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs">è¯·å°†ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼š<br><br>ç¤ºä¾‹ï¼š<br>ä¸­æ–‡ï¼šè‹¹æœ<br>è‹±æ–‡ï¼šApple<br><br>è¯·ç¿»è¯‘ï¼š<br>ä¸­æ–‡ï¼šé¦™è•‰<br>è‹±æ–‡ï¼š<br></code></pre></td></tr></table></figure><hr><h3 id="1-3-Few-shot-Prompting"><a href="#1-3-Few-shot-Prompting" class="headerlink" title="1.3 Few-shot Prompting"></a>1.3 Few-shot Prompting</h3><p><strong>å®šä¹‰</strong>ï¼šæä¾›å¤šä¸ªï¼ˆé€šå¸¸ 3-5 ä¸ªï¼‰ç¤ºä¾‹ï¼Œè®©æ¨¡å‹å­¦ä¹ æ¨¡å¼ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs">è¯·æ ¹æ®ä»¥ä¸‹ç¤ºä¾‹ï¼Œå¯¹ç”¨æˆ·è¯„è®ºè¿›è¡Œæƒ…æ„Ÿåˆ†ç±»ï¼š<br><br>è¯„è®ºï¼šè¿™ä¸ªäº§å“å¤ªæ£’äº†ï¼Œç‰©è¶…æ‰€å€¼ï¼<br>æƒ…æ„Ÿï¼šæ­£é¢<br><br>è¯„è®ºï¼šè´¨é‡ä¸€èˆ¬ï¼Œä¸æ¨èè´­ä¹°ã€‚<br>æƒ…æ„Ÿï¼šè´Ÿé¢<br><br>è¯„è®ºï¼šè¿˜è¡Œå§ï¼Œä¸­è§„ä¸­çŸ©ã€‚<br>æƒ…æ„Ÿï¼šä¸­æ€§<br><br>è¯„è®ºï¼šå¿«é€’è¶…å¿«ï¼ŒåŒ…è£…ä¹Ÿå¾ˆå¥½ï¼Œéå¸¸æ»¡æ„ï¼<br>æƒ…æ„Ÿï¼š<br></code></pre></td></tr></table></figure><blockquote><p><strong>ğŸ“ æ³¨æ„: æœ€ä½³å®è·µ</strong></p><ul><li>ç¤ºä¾‹è¦å¤šæ ·åŒ–ï¼Œè¦†ç›–ä¸åŒæƒ…å†µ</li><li>ç¤ºä¾‹æ ¼å¼è¦ä¸æœŸæœ›è¾“å‡ºä¸€è‡´</li><li>3-5 ä¸ªç¤ºä¾‹é€šå¸¸è¶³å¤Ÿï¼Œå¤ªå¤šå¯èƒ½é€ æˆå¹²æ‰°</li></ul></blockquote><hr><h2 id="äºŒã€æ¨ç†å¢å¼ºæŠ€æœ¯"><a href="#äºŒã€æ¨ç†å¢å¼ºæŠ€æœ¯" class="headerlink" title="äºŒã€æ¨ç†å¢å¼ºæŠ€æœ¯"></a>äºŒã€æ¨ç†å¢å¼ºæŠ€æœ¯</h2><h3 id="2-1-Chain-of-Thought-CoT-æ€ç»´é“¾"><a href="#2-1-Chain-of-Thought-CoT-æ€ç»´é“¾" class="headerlink" title="2.1 Chain of Thought (CoT) - æ€ç»´é“¾"></a>2.1 Chain of Thought (CoT) - æ€ç»´é“¾</h3><p><strong>å®šä¹‰</strong>ï¼šå¼•å¯¼æ¨¡å‹å±•ç¤ºæ¨ç†è¿‡ç¨‹ï¼Œé€æ­¥å¾—å‡ºç­”æ¡ˆã€‚</p><h4 id="åŸºç¡€-CoT"><a href="#åŸºç¡€-CoT" class="headerlink" title="åŸºç¡€ CoT"></a>åŸºç¡€ CoT</h4><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tap">é—®é¢˜ï¼šä¸€ä¸ªå•†åº—æœ‰<span class="hljs-number"> 23 </span>ä¸ªè‹¹æœï¼Œå–æ‰äº†<span class="hljs-number"> 7 </span>ä¸ªï¼Œåˆè¿›è´§äº†<span class="hljs-number"> 12 </span>ä¸ªï¼Œç°åœ¨æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ<br><br>è¯·ä¸€æ­¥ä¸€æ­¥æ€è€ƒï¼š<br></code></pre></td></tr></table></figure><p><strong>æ¨¡å‹è¾“å‡º</strong>ï¼š</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs tap">è®©æˆ‘ä¸€æ­¥ä¸€æ­¥è®¡ç®—ï¼š<br>1. åˆå§‹è‹¹æœæ•°é‡ï¼š23 ä¸ª<br>2. å–æ‰åï¼š23 -<span class="hljs-number"> 7 </span>=<span class="hljs-number"> 16 </span>ä¸ª<br>3. è¿›è´§åï¼š16 +<span class="hljs-number"> 12 </span>=<span class="hljs-number"> 28 </span>ä¸ª<br><br>ç­”æ¡ˆï¼šç°åœ¨æœ‰<span class="hljs-number"> 28 </span>ä¸ªè‹¹æœã€‚<br></code></pre></td></tr></table></figure><h4 id="Few-shot-CoT"><a href="#Few-shot-CoT" class="headerlink" title="Few-shot CoT"></a>Few-shot CoT</h4><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs tap">é—®é¢˜ï¼šå°æ˜æœ‰<span class="hljs-number"> 5 </span>ä¸ªè‹¹æœï¼Œå°çº¢ç»™äº†ä»–<span class="hljs-number"> 3 </span>ä¸ªï¼Œä»–åˆåƒäº†<span class="hljs-number"> 2 </span>ä¸ªï¼Œè¿˜å‰©å‡ ä¸ªï¼Ÿ<br>æ€è€ƒè¿‡ç¨‹ï¼š<br>- åˆå§‹ï¼š5 ä¸ª<br>- å°çº¢ç»™äº†<span class="hljs-number"> 3 </span>ä¸ªï¼š5 +<span class="hljs-number"> 3 </span>=<span class="hljs-number"> 8 </span>ä¸ª<br>- åƒäº†<span class="hljs-number"> 2 </span>ä¸ªï¼š8 -<span class="hljs-number"> 2 </span>=<span class="hljs-number"> 6 </span>ä¸ª<br>ç­”æ¡ˆï¼š6 ä¸ª<br><br>é—®é¢˜ï¼šä¸€ä¸ªå†œåœºæœ‰<span class="hljs-number"> 15 </span>åªé¸¡ï¼Œå–æ‰äº†<span class="hljs-number"> 6 </span>åªï¼Œåˆä¹°äº†<span class="hljs-number"> 8 </span>åªï¼Œç°åœ¨æœ‰å¤šå°‘åªï¼Ÿ<br>æ€è€ƒè¿‡ç¨‹ï¼š<br></code></pre></td></tr></table></figure><blockquote><p><strong>âš ï¸ é‡è¦: CoT é€‚ç”¨åœºæ™¯</strong></p><ul><li>æ•°å­¦è®¡ç®—</li><li>é€»è¾‘æ¨ç†</li><li>å¤šæ­¥éª¤é—®é¢˜</li><li>éœ€è¦è§£é‡Šè¿‡ç¨‹çš„ä»»åŠ¡</li></ul></blockquote><hr><h3 id="2-2-Zero-shot-CoT"><a href="#2-2-Zero-shot-CoT" class="headerlink" title="2.2 Zero-shot CoT"></a>2.2 Zero-shot CoT</h3><p><strong>å®šä¹‰</strong>ï¼šä¸æä¾›ç¤ºä¾‹ï¼Œä»…é€šè¿‡é­”æ³•çŸ­è¯­è§¦å‘æ¨ç†ã€‚</p><p><strong>é­”æ³•çŸ­è¯­</strong>ï¼š</p><ul><li>â€œLetâ€™s think step by stepâ€ï¼ˆè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ€è€ƒï¼‰</li><li>â€œè¯·é€æ­¥åˆ†æâ€</li><li>â€œè®©æˆ‘ä»¬ä»”ç»†æ¨ç†â€</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs armasm">é—®é¢˜ï¼šä¸€åˆ—ç«è½¦ä» A ç«™å‡ºå‘ï¼Œæ¯å°æ—¶è¡Œé©¶ <span class="hljs-number">60</span> å…¬é‡Œï¼Œ<span class="hljs-number">2</span> å°æ—¶ååˆ°è¾¾ <span class="hljs-keyword">B</span> ç«™ã€‚<br>å¦ä¸€åˆ—ç«è½¦åŒæ—¶ä» <span class="hljs-keyword">B</span> ç«™å‡ºå‘ï¼Œæ¯å°æ—¶ <span class="hljs-number">80</span> å…¬é‡Œã€‚ä¸¤è½¦ä½•æ—¶ç›¸é‡ï¼Ÿ<br><br><span class="hljs-symbol">Let</span><span class="hljs-string">&#x27;s think step by step.</span><br></code></pre></td></tr></table></figure><hr><h3 id="2-3-Tree-of-Thought-ToT-æ€ç»´æ ‘"><a href="#2-3-Tree-of-Thought-ToT-æ€ç»´æ ‘" class="headerlink" title="2.3 Tree of Thought (ToT) - æ€ç»´æ ‘"></a>2.3 Tree of Thought (ToT) - æ€ç»´æ ‘</h3><p><strong>å®šä¹‰</strong>ï¼šæ¢ç´¢å¤šä¸ªæ¨ç†è·¯å¾„ï¼Œè‡ªæˆ‘è¯„ä¼°é€‰æ‹©æœ€ä¼˜è§£ã€‚</p><pre><code class=" mermaid">graph TD    A[é—®é¢˜] --&gt; B[æ€è·¯1]    A --&gt; C[æ€è·¯2]    A --&gt; D[æ€è·¯3]    B --&gt; E[è¯„ä¼°: å¯è¡Œ]    C --&gt; F[è¯„ä¼°: ä¸å¯è¡Œ]    D --&gt; G[è¯„ä¼°: å¯è¡Œä½†å¤æ‚]    E --&gt; H[æ·±å…¥æ¢ç´¢]    H --&gt; I[æœ€ç»ˆç­”æ¡ˆ]</code></pre><p><strong>Prompt ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs markdown">é—®é¢˜ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘çš„ç§’æ€ç³»ç»Ÿï¼Ÿ<br><br>è¯·ç”¨ä»¥ä¸‹æ€ç»´æ¡†æ¶åˆ†æï¼š<br><br><span class="hljs-section">## æ€è·¯æ¢ç´¢</span><br><span class="hljs-bullet">1.</span> æ€è·¯ Aï¼š[æè¿°æ–¹æ¡ˆ]<br><span class="hljs-bullet">   -</span> ä¼˜ç‚¹ï¼š<br><span class="hljs-bullet">   -</span> ç¼ºç‚¹ï¼š<br><span class="hljs-bullet">   -</span> å¯è¡Œæ€§è¯„åˆ†ï¼š1-10<br><br><span class="hljs-bullet">2.</span> æ€è·¯ Bï¼š[æè¿°æ–¹æ¡ˆ]<br><span class="hljs-bullet">   -</span> ä¼˜ç‚¹ï¼š<br><span class="hljs-bullet">   -</span> ç¼ºç‚¹ï¼š<br><span class="hljs-bullet">   -</span> å¯è¡Œæ€§è¯„åˆ†ï¼š1-10<br><br><span class="hljs-bullet">3.</span> æ€è·¯ Cï¼š[æè¿°æ–¹æ¡ˆ]<br><span class="hljs-bullet">   -</span> ä¼˜ç‚¹ï¼š<br><span class="hljs-bullet">   -</span> ç¼ºç‚¹ï¼š<br><span class="hljs-bullet">   -</span> å¯è¡Œæ€§è¯„åˆ†ï¼š1-10<br><br><span class="hljs-section">## æœ€ä¼˜æ–¹æ¡ˆé€‰æ‹©</span><br>åŸºäºä»¥ä¸Šåˆ†æï¼Œé€‰æ‹©å¹¶è¯¦ç»†é˜è¿°æœ€ä½³æ–¹æ¡ˆã€‚<br></code></pre></td></tr></table></figure><hr><h3 id="2-4-Self-Consistencyï¼ˆè‡ªä¸€è‡´æ€§ï¼‰"><a href="#2-4-Self-Consistencyï¼ˆè‡ªä¸€è‡´æ€§ï¼‰" class="headerlink" title="2.4 Self-Consistencyï¼ˆè‡ªä¸€è‡´æ€§ï¼‰"></a>2.4 Self-Consistencyï¼ˆè‡ªä¸€è‡´æ€§ï¼‰</h3><p><strong>å®šä¹‰</strong>ï¼šå¤šæ¬¡é‡‡æ ·ç­”æ¡ˆï¼Œé€‰æ‹©å‡ºç°é¢‘ç‡æœ€é«˜çš„ç»“æœã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css">è¯·å¯¹ä»¥ä¸‹é—®é¢˜ç»™å‡º <span class="hljs-number">3</span> ä¸ªç‹¬ç«‹çš„æ¨ç†è¿‡ç¨‹å’Œç­”æ¡ˆï¼š<br><br>é—®é¢˜ï¼š<span class="hljs-selector-attr">[å¤æ‚é—®é¢˜]</span><br><br>æ¨ç† <span class="hljs-number">1</span>ï¼š<br>æ¨ç† <span class="hljs-number">2</span>ï¼š<br>æ¨ç† <span class="hljs-number">3</span>ï¼š<br><br>æœ€ç»ˆç­”æ¡ˆï¼ˆé€‰æ‹©å‡ºç°æœ€å¤šçš„ç­”æ¡ˆï¼‰ï¼š<br></code></pre></td></tr></table></figure><hr><h2 id="ä¸‰ã€è§’è‰²ä¸ä¸Šä¸‹æ–‡è®¾å®š"><a href="#ä¸‰ã€è§’è‰²ä¸ä¸Šä¸‹æ–‡è®¾å®š" class="headerlink" title="ä¸‰ã€è§’è‰²ä¸ä¸Šä¸‹æ–‡è®¾å®š"></a>ä¸‰ã€è§’è‰²ä¸ä¸Šä¸‹æ–‡è®¾å®š</h2><h3 id="3-1-è§’è‰²è®¾å®šï¼ˆRole-Promptingï¼‰"><a href="#3-1-è§’è‰²è®¾å®šï¼ˆRole-Promptingï¼‰" class="headerlink" title="3.1 è§’è‰²è®¾å®šï¼ˆRole Promptingï¼‰"></a>3.1 è§’è‰²è®¾å®šï¼ˆRole Promptingï¼‰</h3><p><strong>å®šä¹‰</strong>ï¼šæŒ‡å®š AI æ‰®æ¼”ç‰¹å®šè§’è‰²ï¼Œå½±å“å…¶å›ç­”é£æ ¼å’Œä¸“ä¸šåº¦ã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">ä½ æ˜¯ä¸€ä½æ‹¥æœ‰ <span class="hljs-number">15</span> å¹´ç»éªŒçš„ Java æ¶æ„å¸ˆï¼Œç²¾é€šåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ã€å¾®æœåŠ¡æ¶æ„å’Œæ€§èƒ½ä¼˜åŒ–ã€‚<br><br>è¯·ä»¥ä½ çš„ä¸“ä¸šè§†è§’ï¼Œåˆ†æä»¥ä¸‹ä»£ç çš„æ½œåœ¨é—®é¢˜ï¼š<br><span class="hljs-string"></span><br><span class="hljs-string">[ä»£ç å†…å®¹]</span><br></code></pre></td></tr></table></figure><p><strong>å¸¸ç”¨è§’è‰²æ¨¡æ¿</strong>ï¼š</p><table><thead><tr><th>è§’è‰²</th><th>æè¿°</th></tr></thead><tbody><tr><td>æŠ€æœ¯ä¸“å®¶</td><td>â€œä½ æ˜¯ä¸€ä½èµ„æ·±çš„ [é¢†åŸŸ] ä¸“å®¶â€</td></tr><tr><td>ä»£ç å®¡æŸ¥å‘˜</td><td>â€œä½ æ˜¯ä¸€ä½ä¸¥æ ¼çš„ä»£ç å®¡æŸ¥å‘˜â€</td></tr><tr><td>äº§å“ç»ç†</td><td>â€œä½ æ˜¯ä¸€ä½ç”¨æˆ·å¯¼å‘çš„äº§å“ç»ç†â€</td></tr><tr><td>æ•™å¸ˆ</td><td>â€œä½ æ˜¯ä¸€ä½è€å¿ƒçš„ç¼–ç¨‹æ•™å¸ˆâ€</td></tr></tbody></table><hr><h3 id="3-2-ç³»ç»Ÿæç¤ºï¼ˆSystem-Promptï¼‰"><a href="#3-2-ç³»ç»Ÿæç¤ºï¼ˆSystem-Promptï¼‰" class="headerlink" title="3.2 ç³»ç»Ÿæç¤ºï¼ˆSystem Promptï¼‰"></a>3.2 ç³»ç»Ÿæç¤ºï¼ˆSystem Promptï¼‰</h3><p><strong>å®šä¹‰</strong>ï¼šè®¾ç½®æ¨¡å‹çš„è¡Œä¸ºå‡†åˆ™å’Œçº¦æŸæ¡ä»¶ï¼ˆAPI è°ƒç”¨æ—¶çš„ system è§’è‰²ï¼‰ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;messages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;system&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯æ–‡æ¡£åŠ©æ‰‹ã€‚è§„åˆ™ï¼š1. åªå›ç­”æŠ€æœ¯ç›¸å…³é—®é¢˜ 2. ä½¿ç”¨ Markdown æ ¼å¼ 3. ä»£ç ç¤ºä¾‹ä½¿ç”¨ Java&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;role&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ï¼Ÿ&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><hr><h3 id="3-3-ä¸Šä¸‹æ–‡æ³¨å…¥"><a href="#3-3-ä¸Šä¸‹æ–‡æ³¨å…¥" class="headerlink" title="3.3 ä¸Šä¸‹æ–‡æ³¨å…¥"></a>3.3 ä¸Šä¸‹æ–‡æ³¨å…¥</h3><p><strong>å®šä¹‰</strong>ï¼šåœ¨ Prompt ä¸­æä¾›ç›¸å…³èƒŒæ™¯çŸ¥è¯†ï¼ˆRAG åœºæ™¯çš„æ ¸å¿ƒï¼‰ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">## èƒŒæ™¯çŸ¥è¯†</span><br><span class="hljs-string">ä»¥ä¸‹æ˜¯å…³äº</span> <span class="hljs-string">Spring</span> <span class="hljs-string">AI</span> <span class="hljs-string">çš„å®˜æ–¹æ–‡æ¡£æ‘˜è¦ï¼š</span><br><span class="hljs-meta">---</span><br>[<span class="hljs-string">æ£€ç´¢åˆ°çš„æ–‡æ¡£å†…å®¹</span>]<br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-comment">## ç”¨æˆ·é—®é¢˜</span><br><span class="hljs-string">å¦‚ä½•åœ¨</span> <span class="hljs-string">Spring</span> <span class="hljs-string">AI</span> <span class="hljs-string">ä¸­é…ç½®</span> <span class="hljs-string">OpenAI</span> <span class="hljs-string">çš„</span> <span class="hljs-string">API</span> <span class="hljs-string">Keyï¼Ÿ</span><br><br><span class="hljs-comment">## è¦æ±‚</span><br><span class="hljs-string">è¯·æ ¹æ®èƒŒæ™¯çŸ¥è¯†å›ç­”é—®é¢˜ï¼Œå¦‚æœèƒŒæ™¯çŸ¥è¯†ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·æ˜ç¡®è¯´æ˜ã€‚</span><br></code></pre></td></tr></table></figure><hr><h2 id="å››ã€è¾“å‡ºæ§åˆ¶æŠ€æœ¯"><a href="#å››ã€è¾“å‡ºæ§åˆ¶æŠ€æœ¯" class="headerlink" title="å››ã€è¾“å‡ºæ§åˆ¶æŠ€æœ¯"></a>å››ã€è¾“å‡ºæ§åˆ¶æŠ€æœ¯</h2><h3 id="4-1-æ ¼å¼çº¦æŸ"><a href="#4-1-æ ¼å¼çº¦æŸ" class="headerlink" title="4.1 æ ¼å¼çº¦æŸ"></a>4.1 æ ¼å¼çº¦æŸ</h3><h4 id="JSON-æ ¼å¼"><a href="#JSON-æ ¼å¼" class="headerlink" title="JSON æ ¼å¼"></a>JSON æ ¼å¼</h4><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">è¯·åˆ†æä»¥ä¸‹ç”¨æˆ·è¯„è®ºï¼Œä»¥ <span class="hljs-built_in">JSON</span> æ ¼å¼è¾“å‡ºç»“æœï¼š<br><br>è¯„è®ºï¼šè¿™æ¬¾æ‰‹æœºæ‹ç…§æ•ˆæœå¾ˆå¥½ï¼Œä½†ç”µæ± ç»­èˆªå¤ªå·®äº†ã€‚<br><br>è¾“å‡ºæ ¼å¼ï¼š<br>&#123;<br>  <span class="hljs-string">&quot;sentiment&quot;</span>: <span class="hljs-string">&quot;æ­£é¢/è´Ÿé¢/ä¸­æ€§&quot;</span>,<br>  <span class="hljs-string">&quot;aspects&quot;</span>: [<br>    &#123;<span class="hljs-string">&quot;aspect&quot;</span>: <span class="hljs-string">&quot;æ–¹é¢å&quot;</span>, <span class="hljs-string">&quot;sentiment&quot;</span>: <span class="hljs-string">&quot;æ­£é¢/è´Ÿé¢&quot;</span>, <span class="hljs-string">&quot;comment&quot;</span>: <span class="hljs-string">&quot;å…·ä½“è¯„ä»·&quot;</span>&#125;<br>  ],<br>  <span class="hljs-string">&quot;summary&quot;</span>: <span class="hljs-string">&quot;ä¸€å¥è¯æ€»ç»“&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Markdown-æ ¼å¼"><a href="#Markdown-æ ¼å¼" class="headerlink" title="Markdown æ ¼å¼"></a>Markdown æ ¼å¼</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">è¯·ç”¨ Markdown æ ¼å¼è¾“å‡ºæŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£ï¼š<br><br><span class="hljs-section">## è¦æ±‚</span><br><span class="hljs-bullet">-</span> ä½¿ç”¨å¤šçº§æ ‡é¢˜ç»„ç»‡å†…å®¹<br><span class="hljs-bullet">-</span> ä»£ç å—ä½¿ç”¨æ­£ç¡®çš„è¯­è¨€æ ‡è¯†<br><span class="hljs-bullet">-</span> é‡ç‚¹å†…å®¹ä½¿ç”¨ç²—ä½“<br><span class="hljs-bullet">-</span> åŒ…å«æµç¨‹å›¾ï¼ˆMermaidï¼‰<br></code></pre></td></tr></table></figure><hr><h3 id="4-2-é•¿åº¦æ§åˆ¶"><a href="#4-2-é•¿åº¦æ§åˆ¶" class="headerlink" title="4.2 é•¿åº¦æ§åˆ¶"></a>4.2 é•¿åº¦æ§åˆ¶</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">è¯·ç”¨ä¸è¶…è¿‡</span> <span class="hljs-number">100</span> <span class="hljs-string">å­—æ€»ç»“è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒè§‚ç‚¹ã€‚</span><br><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-string">è¯·è¯¦ç»†è§£é‡Šè¿™ä¸ªæ¦‚å¿µï¼ŒåŒ…æ‹¬ï¼š</span><br><span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">å®šä¹‰ï¼ˆ50å­—ï¼‰</span><br><span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">å·¥ä½œåŸç†ï¼ˆ200å­—ï¼‰</span><br><span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">åº”ç”¨åœºæ™¯ï¼ˆ100å­—ï¼‰</span><br><span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">ä»£ç ç¤ºä¾‹ï¼ˆå®Œæ•´å¯è¿è¡Œï¼‰</span><br></code></pre></td></tr></table></figure><hr><h3 id="4-3-åˆ†éš”ç¬¦ä½¿ç”¨"><a href="#4-3-åˆ†éš”ç¬¦ä½¿ç”¨" class="headerlink" title="4.3 åˆ†éš”ç¬¦ä½¿ç”¨"></a>4.3 åˆ†éš”ç¬¦ä½¿ç”¨</h3><p>ä½¿ç”¨æ˜ç¡®çš„åˆ†éš”ç¬¦é¿å… Prompt æ³¨å…¥å’Œå†…å®¹æ··æ·†ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs clean">è¯·ç¿»è¯‘ä»¥ä¸‹æ–‡æœ¬ï¼Œæ–‡æœ¬ç”¨ ### åŒ…è£¹ï¼š<br><br>###<br>ç”¨æˆ·è¾“å…¥çš„å†…å®¹<br>###<br><br>ç¿»è¯‘ç»“æœï¼š<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨åˆ†éš”ç¬¦ï¼š</p><ul><li><code>###</code></li><li><code>---</code></li><li><code>&quot;&quot;&quot;</code> </li><li><code>&lt;text&gt;&lt;/text&gt;</code></li><li><code>[START][END]</code></li></ul><hr><h2 id="äº”ã€é«˜çº§æŠ€æœ¯"><a href="#äº”ã€é«˜çº§æŠ€æœ¯" class="headerlink" title="äº”ã€é«˜çº§æŠ€æœ¯"></a>äº”ã€é«˜çº§æŠ€æœ¯</h2><h3 id="5-1-ReActï¼ˆReasoning-Actingï¼‰"><a href="#5-1-ReActï¼ˆReasoning-Actingï¼‰" class="headerlink" title="5.1 ReActï¼ˆReasoning + Actingï¼‰"></a>5.1 ReActï¼ˆReasoning + Actingï¼‰</h3><p><strong>å®šä¹‰</strong>ï¼šæ¨ç†ä¸è¡ŒåŠ¨äº¤æ›¿è¿›è¡Œï¼Œé€‚åˆ Agent åœºæ™¯ã€‚</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">ä½ æ˜¯ä¸€ä¸ªèƒ½å¤Ÿä½¿ç”¨å·¥å…·çš„ AI åŠ©æ‰‹ã€‚</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">å¯ç”¨å·¥å…·ï¼š</span><br><span class="hljs-attribute">1. search(query) - æœç´¢ä¿¡æ¯</span><br><span class="hljs-attribute">2. calculator(expression) - è®¡ç®—æ•°å­¦è¡¨è¾¾å¼</span><br><span class="hljs-attribute">3. get_weather(city) - è·å–å¤©æ°”</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">è¯·ç”¨ä»¥ä¸‹æ ¼å¼å›ç­”é—®é¢˜ï¼š</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">Thought</span><span class="hljs-punctuation">:</span> <span class="hljs-string">æ€è€ƒä¸‹ä¸€æ­¥è¯¥åšä»€ä¹ˆ</span><br><span class="hljs-attribute">Action</span><span class="hljs-punctuation">:</span> <span class="hljs-string">å·¥å…·åç§°</span><br><span class="hljs-attribute">Action Input</span><span class="hljs-punctuation">:</span> <span class="hljs-string">å·¥å…·è¾“å…¥</span><br><span class="hljs-attribute">Observation</span><span class="hljs-punctuation">:</span> <span class="hljs-string">å·¥å…·è¿”å›ç»“æœ</span><br><span class="hljs-attribute">... (é‡å¤ç›´åˆ°å¾—å‡ºç­”æ¡ˆ)</span><br><span class="hljs-attribute">Thought</span><span class="hljs-punctuation">:</span> <span class="hljs-string">æˆ‘ç°åœ¨çŸ¥é“æœ€ç»ˆç­”æ¡ˆäº†</span><br><span class="hljs-attribute">Final Answer</span><span class="hljs-punctuation">:</span> <span class="hljs-string">æœ€ç»ˆç­”æ¡ˆ</span><br><br>é—®é¢˜ï¼šåŒ—äº¬ä»Šå¤©çš„æ°”æ¸©æ˜¯å¤šå°‘æ‘„æ°åº¦ï¼Ÿæ¢ç®—æˆåæ°åº¦æ˜¯å¤šå°‘ï¼Ÿ<br></code></pre></td></tr></table></figure><hr><h3 id="5-2-Generated-Knowledge-Prompting"><a href="#5-2-Generated-Knowledge-Prompting" class="headerlink" title="5.2 Generated Knowledge Prompting"></a>5.2 Generated Knowledge Prompting</h3><p><strong>å®šä¹‰</strong>ï¼šè®©æ¨¡å‹å…ˆç”Ÿæˆç›¸å…³çŸ¥è¯†ï¼Œå†åŸºäºçŸ¥è¯†å›ç­”é—®é¢˜ã€‚</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clean">## ç¬¬ä¸€æ­¥ï¼šç”ŸæˆçŸ¥è¯†<br>è¯·åˆ—å‡ºå…³äº Java çº¿ç¨‹æ± çš„ <span class="hljs-number">5</span> ä¸ªå…³é”®çŸ¥è¯†ç‚¹ã€‚<br><br>## ç¬¬äºŒæ­¥ï¼šå›ç­”é—®é¢˜<br>åŸºäºä»¥ä¸ŠçŸ¥è¯†ï¼Œè§£é‡Šä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ Executors.newFixedThreadPool()ï¼Ÿ<br></code></pre></td></tr></table></figure><hr><h3 id="5-3-Directional-Stimulus-Prompting"><a href="#5-3-Directional-Stimulus-Prompting" class="headerlink" title="5.3 Directional Stimulus Prompting"></a>5.3 Directional Stimulus Prompting</h3><p><strong>å®šä¹‰</strong>ï¼šæä¾›æç¤ºè¯æš—ç¤ºï¼Œå¼•å¯¼æ¨¡å‹è¾“å‡ºæ–¹å‘ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">è¯·å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—ã€‚<br><br>æç¤ºè¯ï¼šèŠ±å¼€ã€æš–é£ã€å¸Œæœ›ã€æ–°ç”Ÿ<br></code></pre></td></tr></table></figure><hr><h2 id="å…­ã€Prompt-æ¨¡æ¿åº“"><a href="#å…­ã€Prompt-æ¨¡æ¿åº“" class="headerlink" title="å…­ã€Prompt æ¨¡æ¿åº“"></a>å…­ã€Prompt æ¨¡æ¿åº“</h2><h3 id="6-1-ä»£ç å®¡æŸ¥æ¨¡æ¿"><a href="#6-1-ä»£ç å®¡æŸ¥æ¨¡æ¿" class="headerlink" title="6.1 ä»£ç å®¡æŸ¥æ¨¡æ¿"></a>6.1 ä»£ç å®¡æŸ¥æ¨¡æ¿</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs markdown">ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ Java ä»£ç å®¡æŸ¥ä¸“å®¶ã€‚<br><br>è¯·å®¡æŸ¥ä»¥ä¸‹ä»£ç ï¼Œä»ä»¥ä¸‹ç»´åº¦åˆ†æï¼š<br><span class="hljs-bullet">1.</span> <span class="hljs-strong">**ä»£ç è§„èŒƒ**</span>ï¼šå‘½åã€æ ¼å¼ã€æ³¨é‡Š<br><span class="hljs-bullet">2.</span> <span class="hljs-strong">**æ½œåœ¨ Bug**</span>ï¼šç©ºæŒ‡é’ˆã€å¹¶å‘é—®é¢˜ã€èµ„æºæ³„éœ²<br><span class="hljs-bullet">3.</span> <span class="hljs-strong">**æ€§èƒ½é—®é¢˜**</span>ï¼šæ—¶é—´å¤æ‚åº¦ã€å†…å­˜ä½¿ç”¨<br><span class="hljs-bullet">4.</span> <span class="hljs-strong">**å®‰å…¨é£é™©**</span>ï¼šSQL æ³¨å…¥ã€XSS ç­‰<br><span class="hljs-bullet">5.</span> <span class="hljs-strong">**å¯ç»´æŠ¤æ€§**</span>ï¼šä»£ç å¤æ‚åº¦ã€å¯æµ‹è¯•æ€§<br><br>ä»£ç ï¼š<br><span class="hljs-code">```java</span><br><span class="hljs-code">[ä»£ç å†…å®¹]</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºæ ¼å¼ï¼š</p><table><thead><tr><th>é—®é¢˜</th><th>ä¸¥é‡ç¨‹åº¦</th><th>ä½ç½®</th><th>ä¿®æ”¹å»ºè®®</th></tr></thead></table><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-comment">### 6.2 æŠ€æœ¯æ–¹æ¡ˆæ¨¡æ¿</span><br><br></code></pre></td></tr></table></figure><p>è¯·è®¾è®¡ä¸€ä¸ªæŠ€æœ¯æ–¹æ¡ˆï¼Œè¦æ±‚ï¼š</p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>[é—®é¢˜æè¿°]</p><h2 id="è¾“å‡ºè¦æ±‚"><a href="#è¾“å‡ºè¦æ±‚" class="headerlink" title="è¾“å‡ºè¦æ±‚"></a>è¾“å‡ºè¦æ±‚</h2><ol><li><strong>éœ€æ±‚åˆ†æ</strong>ï¼šæ˜ç¡®åŠŸèƒ½å’ŒéåŠŸèƒ½éœ€æ±‚</li><li><strong>æ¶æ„è®¾è®¡</strong>ï¼šæ•´ä½“æ¶æ„å›¾ï¼ˆMermaidï¼‰</li><li><strong>æŠ€æœ¯é€‰å‹</strong>ï¼šæ¡†æ¶ã€ä¸­é—´ä»¶é€‰æ‹©åŠç†ç”±</li><li><strong>æ ¸å¿ƒæµç¨‹</strong>ï¼šå…³é”®æµç¨‹æ—¶åºå›¾</li><li><strong>æ•°æ®è®¾è®¡</strong>ï¼šæ ¸å¿ƒè¡¨ç»“æ„</li><li><strong>é£é™©è¯„ä¼°</strong>ï¼šæ½œåœ¨é£é™©åŠåº”å¯¹ç­–ç•¥</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><br><span class="hljs-meta">---</span><br><span class="hljs-meta"></span><br><span class="hljs-comment">### 6.3 Debug åŠ©æ‰‹æ¨¡æ¿</span><br><br></code></pre></td></tr></table></figure><p>ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„ Debug ä¸“å®¶ã€‚</p><h2 id="é”™è¯¯ä¿¡æ¯"><a href="#é”™è¯¯ä¿¡æ¯" class="headerlink" title="é”™è¯¯ä¿¡æ¯"></a>é”™è¯¯ä¿¡æ¯</h2><p>[é”™è¯¯æ—¥å¿—]</p><h2 id="ç›¸å…³ä»£ç "><a href="#ç›¸å…³ä»£ç " class="headerlink" title="ç›¸å…³ä»£ç "></a>ç›¸å…³ä»£ç </h2><p>[ä»£ç ç‰‡æ®µ]</p><h2 id="è¯·åˆ†æ"><a href="#è¯·åˆ†æ" class="headerlink" title="è¯·åˆ†æ"></a>è¯·åˆ†æ</h2><ol><li>é”™è¯¯çš„ç›´æ¥åŸå› </li><li>æ ¹æœ¬åŸå› åˆ†æ</li><li>è§£å†³æ–¹æ¡ˆï¼ˆç»™å‡ºå…·ä½“ä»£ç ï¼‰</li><li>å¦‚ä½•é¿å…ç±»ä¼¼é—®é¢˜</li></ol><pre><code class="hljs">---## ä¸ƒã€æœ€ä½³å®è·µ### 7.1 Prompt è®¾è®¡åŸåˆ™| åŸåˆ™ | è¯´æ˜ ||------|------|| **æ˜ç¡®å…·ä½“** | é¿å…æ¨¡ç³Šè¡¨è¿°ï¼Œæ˜ç¡®ä»»åŠ¡ç›®æ ‡ || **ç»“æ„æ¸…æ™°** | ä½¿ç”¨åˆ†éš”ç¬¦ã€ç¼–å·ç»„ç»‡å†…å®¹ || **æä¾›ç¤ºä¾‹** | å¤æ‚ä»»åŠ¡ç”¨ Few-shot å¼•å¯¼ || **è¿­ä»£ä¼˜åŒ–** | æ ¹æ®è¾“å‡ºæ•ˆæœä¸æ–­è°ƒæ•´ || **æ§åˆ¶é•¿åº¦** | é¿å…è¿‡é•¿å¯¼è‡´ä¿¡æ¯ä¸¢å¤± |### 7.2 å¸¸è§é”™è¯¯| é”™è¯¯ | ç¤ºä¾‹ | æ”¹è¿› ||------|------|------|| è¿‡äºæ¨¡ç³Š | &quot;å¸®æˆ‘å†™ä»£ç &quot; | &quot;ç”¨ Java å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ LRU ç¼“å­˜&quot; || ç¼ºå°‘ä¸Šä¸‹æ–‡ | &quot;è¿™ä¸ªæŠ¥é”™æ€ä¹ˆè§£å†³&quot; | &quot;Spring Boot 3.x å¯åŠ¨æŠ¥é”™ï¼š[å…·ä½“é”™è¯¯]&quot; || æœŸæœ›è¿‡é«˜ | &quot;å†™ä¸€ä¸ªå®Œæ•´çš„ç”µå•†ç³»ç»Ÿ&quot; | æ‹†åˆ†ä¸ºå¤šä¸ªå°ä»»åŠ¡é€æ­¥å®ç° |### 7.3 è°ƒè¯•æŠ€å·§1. **æ‰“å°æ€è€ƒè¿‡ç¨‹**ï¼šåŠ å…¥ &quot;è¯·å±•ç¤ºä½ çš„æ¨ç†è¿‡ç¨‹&quot;2. **è¦æ±‚è‡ªæˆ‘æ£€æŸ¥**ï¼šåŠ å…¥ &quot;è¯·æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®&quot;3. **åˆ†æ­¥éªŒè¯**ï¼šå¤æ‚ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šè½®å¯¹è¯---## å…«ã€å·¥å…·ä¸èµ„æº### åœ¨çº¿å·¥å…·| å·¥å…· | ç”¨é€” ||------|------|| [PromptPerfect](https://promptperfect.jina.ai/) | Prompt ä¼˜åŒ– || [OpenAI Playground](https://platform.openai.com/playground) | åœ¨çº¿æµ‹è¯• || [LangSmith](https://smith.langchain.com/) | Prompt ç®¡ç†ä¸è¿½è¸ª |### å­¦ä¹ èµ„æº- [Prompt Engineering Guide](https://www.promptingguide.ai/)- [OpenAI Prompt Engineering](https://platform.openai.com/docs/guides/prompt-engineering)- [Learn Prompting](https://learnprompting.org/)---## ç›¸å…³ç¬”è®°- å¤§æ¨¡å‹å­¦ä¹ è·¯çº¿- LLMåº”ç”¨å¼€å‘- RAGæŠ€æœ¯è¯¦è§£</code></pre>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>å¤§æ¨¡å‹</tag>
      
      <tag>Prompt</tag>
      
      <tag>æç¤ºè¯å·¥ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RDFè§„èŒƒ</title>
    <link href="/2026/01/12/RDF%E8%A7%84%E8%8C%83/"/>
    <url>/2026/01/12/RDF%E8%A7%84%E8%8C%83/</url>
    
    <content type="html"><![CDATA[<h1 id="RDF-è§„èŒƒ"><a href="#RDF-è§„èŒƒ" class="headerlink" title="RDF è§„èŒƒ"></a>RDF è§„èŒƒ</h1><blockquote><p><strong>â„¹ï¸ ä¿¡æ¯: è¡ç”Ÿæ¥æº</strong><br>æœ¬ç¬”è®°è¡ç”Ÿè‡ª ä¸‰å…ƒç»„è¯¦è§£</p></blockquote><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>RDFï¼ˆResource Description Frameworkï¼‰</strong> æ˜¯ W3C åˆ¶å®šçš„èµ„æºæè¿°æ¡†æ¶ï¼Œç”¨äºæè¿° Web èµ„æºçš„æ ‡å‡†æ¨¡å‹ã€‚RDF åŸºäºä¸‰å…ƒç»„æ¨¡å‹ï¼Œæ˜¯è¯­ä¹‰ç½‘å’ŒçŸ¥è¯†å›¾è°±çš„åŸºç¡€æŠ€æœ¯ã€‚</p><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="èµ„æºï¼ˆResourceï¼‰"><a href="#èµ„æºï¼ˆResourceï¼‰" class="headerlink" title="èµ„æºï¼ˆResourceï¼‰"></a>èµ„æºï¼ˆResourceï¼‰</h3><ul><li>ä¸€åˆ‡å¯è¢«æè¿°çš„äº‹ç‰©éƒ½æ˜¯èµ„æº</li><li>ä½¿ç”¨ <strong>URIï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰</strong> å”¯ä¸€æ ‡è¯†</li><li>ç¤ºä¾‹ï¼š<code>http://example.org/person/å¼ ä¸‰</code></li></ul><h3 id="å±æ€§ï¼ˆPropertyï¼‰"><a href="#å±æ€§ï¼ˆPropertyï¼‰" class="headerlink" title="å±æ€§ï¼ˆPropertyï¼‰"></a>å±æ€§ï¼ˆPropertyï¼‰</h3><ul><li>æè¿°èµ„æºç‰¹å¾æˆ–å…³ç³»çš„è°“è¯­</li><li>ä¹Ÿä½¿ç”¨ URI æ ‡è¯†</li><li>ç¤ºä¾‹ï¼š<code>http://xmlns.com/foaf/0.1/name</code></li></ul><h3 id="å­—é¢é‡ï¼ˆLiteralï¼‰"><a href="#å­—é¢é‡ï¼ˆLiteralï¼‰" class="headerlink" title="å­—é¢é‡ï¼ˆLiteralï¼‰"></a>å­—é¢é‡ï¼ˆLiteralï¼‰</h3><ul><li>å±æ€§çš„å…·ä½“å€¼</li><li>å¯å¸¦æ•°æ®ç±»å‹æˆ–è¯­è¨€æ ‡ç­¾</li><li>ç¤ºä¾‹ï¼š<code>&quot;25&quot;^^xsd:integer</code>ã€<code>&quot;åŒ—äº¬&quot;@zh</code></li></ul><h2 id="RDF-åºåˆ—åŒ–æ ¼å¼"><a href="#RDF-åºåˆ—åŒ–æ ¼å¼" class="headerlink" title="RDF åºåˆ—åŒ–æ ¼å¼"></a>RDF åºåˆ—åŒ–æ ¼å¼</h2><table><thead><tr><th>æ ¼å¼</th><th>æ‰©å±•å</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong>N-Triples</strong></td><td><code>.nt</code></td><td>æœ€ç®€å•ï¼Œæ¯è¡Œä¸€ä¸ªä¸‰å…ƒç»„</td></tr><tr><td><strong>Turtle</strong></td><td><code>.ttl</code></td><td>å¯è¯»æ€§å¼ºï¼Œæ”¯æŒå‰ç¼€</td></tr><tr><td><strong>RDF&#x2F;XML</strong></td><td><code>.rdf</code></td><td>XML æ ¼å¼ï¼Œè¾ƒå†—é•¿</td></tr><tr><td><strong>JSON-LD</strong></td><td><code>.jsonld</code></td><td>JSON å…¼å®¹ï¼ŒWeb å‹å¥½</td></tr><tr><td><strong>N-Quads</strong></td><td><code>.nq</code></td><td>å››å…ƒç»„ï¼Œæ”¯æŒå‘½åå›¾</td></tr></tbody></table><h2 id="N-Triples-æ ¼å¼"><a href="#N-Triples-æ ¼å¼" class="headerlink" title="N-Triples æ ¼å¼"></a>N-Triples æ ¼å¼</h2><p>æœ€ç®€å•çš„ RDF åºåˆ—åŒ–æ ¼å¼ï¼Œæ¯è¡Œä¸€ä¸ªä¸‰å…ƒç»„ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;http:<span class="hljs-regexp">//</span>example.org<span class="hljs-regexp">/å¼ ä¸‰&gt; &lt;http:/</span><span class="hljs-regexp">/example.org/</span>è®¤è¯†&gt; &lt;http:<span class="hljs-regexp">//</span>example.org/æå››&gt; .<br>&lt;http:<span class="hljs-regexp">//</span>example.org<span class="hljs-regexp">/å¼ ä¸‰&gt; &lt;http:/</span><span class="hljs-regexp">/example.org/</span>å¹´é¾„&gt; <span class="hljs-string">&quot;25&quot;</span>^^&lt;http:<span class="hljs-regexp">//</span>www.w3.org<span class="hljs-regexp">/2001/</span>XMLSchema<span class="hljs-comment">#integer&gt; .</span><br>&lt;http:<span class="hljs-regexp">//</span>example.org<span class="hljs-regexp">/å¼ ä¸‰&gt; &lt;http:/</span><span class="hljs-regexp">/xmlns.com/</span>foaf<span class="hljs-regexp">/0.1/</span>name&gt; <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>@zh .<br></code></pre></td></tr></table></figure><h3 id="è¯­æ³•è§„åˆ™"><a href="#è¯­æ³•è§„åˆ™" class="headerlink" title="è¯­æ³•è§„åˆ™"></a>è¯­æ³•è§„åˆ™</h3><ul><li>URI ç”¨ <code>&lt; &gt;</code> åŒ…å›´</li><li>å­—é¢é‡ç”¨ <code>&quot; &quot;</code> åŒ…å›´</li><li>æ•°æ®ç±»å‹ç”¨ <code>^^&lt;type&gt;</code> æ ‡æ³¨</li><li>è¯­è¨€æ ‡ç­¾ç”¨ <code>@lang</code> æ ‡æ³¨</li><li>æ¯ä¸ªä¸‰å…ƒç»„ä»¥ <code>.</code> ç»“å°¾</li></ul><h2 id="Turtle-æ ¼å¼"><a href="#Turtle-æ ¼å¼" class="headerlink" title="Turtle æ ¼å¼"></a>Turtle æ ¼å¼</h2><p>æ›´æ˜“è¯»çš„æ ¼å¼ï¼Œæ”¯æŒå‰ç¼€å’Œç®€å†™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs turtle">@prefix ex: &lt;http://example.org/&gt; .<br>@prefix foaf: &lt;http://xmlns.com/foaf/0.1/&gt; .<br>@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .<br><br>ex:å¼ ä¸‰ <br>    foaf:name &quot;å¼ ä¸‰&quot;@zh ;<br>    ex:å¹´é¾„ &quot;25&quot;^^xsd:integer ;<br>    ex:è®¤è¯† ex:æå›› .<br><br>ex:æå››<br>    foaf:name &quot;æå››&quot;@zh ;<br>    ex:å·¥ä½œäº ex:è…¾è®¯ .<br></code></pre></td></tr></table></figure><h3 id="Turtle-è¯­æ³•ç‰¹ç‚¹"><a href="#Turtle-è¯­æ³•ç‰¹ç‚¹" class="headerlink" title="Turtle è¯­æ³•ç‰¹ç‚¹"></a>Turtle è¯­æ³•ç‰¹ç‚¹</h3><table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>@prefix</code></td><td>å®šä¹‰å‘½åç©ºé—´å‰ç¼€</td></tr><tr><td><code>;</code></td><td>åŒä¸€ä¸»è¯­çš„å¤šä¸ªè°“è¯­-å®¾è¯­</td></tr><tr><td><code>,</code></td><td>åŒä¸€è°“è¯­çš„å¤šä¸ªå®¾è¯­</td></tr><tr><td><code>.</code></td><td>ä¸‰å…ƒç»„ç»“æŸ</td></tr><tr><td><code>a</code></td><td><code>rdf:type</code> çš„ç®€å†™</td></tr></tbody></table><h2 id="JSON-LD-æ ¼å¼"><a href="#JSON-LD-æ ¼å¼" class="headerlink" title="JSON-LD æ ¼å¼"></a>JSON-LD æ ¼å¼</h2><p>JSON å…¼å®¹æ ¼å¼ï¼Œé€‚åˆ Web å¼€å‘ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;@context&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;ex&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://example.org/&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;foaf&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://xmlns.com/foaf/0.1/&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;foaf:name&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;knows&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;@id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ex:è®¤è¯†&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;@id&quot;</span> <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;@id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ex:å¼ ä¸‰&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¼ ä¸‰&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;knows&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ex:æå››&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="å¸¸ç”¨è¯æ±‡è¡¨"><a href="#å¸¸ç”¨è¯æ±‡è¡¨" class="headerlink" title="å¸¸ç”¨è¯æ±‡è¡¨"></a>å¸¸ç”¨è¯æ±‡è¡¨</h2><table><thead><tr><th>è¯æ±‡è¡¨</th><th>å‰ç¼€</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>RDF</td><td><code>rdf:</code></td><td>åŸºç¡€ RDF è¯æ±‡</td></tr><tr><td>RDFS</td><td><code>rdfs:</code></td><td>RDF Schemaï¼Œç±»å’Œå±æ€§å®šä¹‰</td></tr><tr><td>OWL</td><td><code>owl:</code></td><td>æœ¬ä½“æè¿°è¯­è¨€</td></tr><tr><td>FOAF</td><td><code>foaf:</code></td><td>äººç‰©å…³ç³»æè¿°</td></tr><tr><td>DC</td><td><code>dc:</code></td><td>éƒ½æŸæ—æ ¸å¿ƒå…ƒæ•°æ®</td></tr><tr><td>SKOS</td><td><code>skos:</code></td><td>æ¦‚å¿µå’Œåˆ†ç±»ä½“ç³»</td></tr></tbody></table><h2 id="RDF-Schemaï¼ˆRDFSï¼‰"><a href="#RDF-Schemaï¼ˆRDFSï¼‰" class="headerlink" title="RDF Schemaï¼ˆRDFSï¼‰"></a>RDF Schemaï¼ˆRDFSï¼‰</h2><p>RDFS æä¾›äº†å®šä¹‰ç±»å’Œå±æ€§çš„æœºåˆ¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs turtle">@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .<br>@prefix ex: &lt;http://example.org/&gt; .<br><br># å®šä¹‰ç±»<br>ex:Person a rdfs:Class ;<br>    rdfs:label &quot;äºº&quot;@zh .<br><br># å®šä¹‰å±æ€§<br>ex:è®¤è¯† a rdf:Property ;<br>    rdfs:domain ex:Person ;<br>    rdfs:range ex:Person ;<br>    rdfs:label &quot;è®¤è¯†&quot;@zh .<br><br># å®šä¹‰å®ä¾‹<br>ex:å¼ ä¸‰ a ex:Person ;<br>    ex:è®¤è¯† ex:æå›› .<br></code></pre></td></tr></table></figure><h2 id="ç©ºç™½èŠ‚ç‚¹ï¼ˆBlank-Nodeï¼‰"><a href="#ç©ºç™½èŠ‚ç‚¹ï¼ˆBlank-Nodeï¼‰" class="headerlink" title="ç©ºç™½èŠ‚ç‚¹ï¼ˆBlank Nodeï¼‰"></a>ç©ºç™½èŠ‚ç‚¹ï¼ˆBlank Nodeï¼‰</h2><p>è¡¨ç¤ºåŒ¿åèµ„æºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs turtle">ex:å¼ ä¸‰ ex:ä½å€ [<br>    ex:åŸå¸‚ &quot;åŒ—äº¬&quot; ;<br>    ex:åŒº &quot;æµ·æ·€åŒº&quot; ;<br>    ex:è¡—é“ &quot;ä¸­å…³æ‘å¤§è¡—&quot;<br>] .<br></code></pre></td></tr></table></figure><h2 id="RDF-éªŒè¯"><a href="#RDF-éªŒè¯" class="headerlink" title="RDF éªŒè¯"></a>RDF éªŒè¯</h2><p>ä½¿ç”¨ <strong>SHACLï¼ˆShapes Constraint Languageï¼‰</strong> éªŒè¯ RDF æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs turtle">@prefix sh: &lt;http://www.w3.org/ns/shacl#&gt; .<br><br>ex:PersonShape a sh:NodeShape ;<br>    sh:targetClass ex:Person ;<br>    sh:property [<br>        sh:path foaf:name ;<br>        sh:minCount 1 ;<br>        sh:datatype xsd:string<br>    ] .<br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸‰å…ƒç»„è¯¦è§£ - è¡ç”Ÿæ¥æº</li><li>SPARQLè¯¦è§£ - RDF æŸ¥è¯¢è¯­è¨€</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>å›¾æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å›¾æ•°æ®åº“</tag>
      
      <tag>RDF</tag>
      
      <tag>è¯­ä¹‰ç½‘</tag>
      
      <tag>å…¨æ–‡å¼•ç”¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SPARQLè¯¦è§£</title>
    <link href="/2026/01/12/SPARQL%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/12/SPARQL%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="SPARQL-è¯¦è§£"><a href="#SPARQL-è¯¦è§£" class="headerlink" title="SPARQL è¯¦è§£"></a>SPARQL è¯¦è§£</h1><blockquote><p><strong>â„¹ï¸ ä¿¡æ¯: è¡ç”Ÿæ¥æº</strong><br>æœ¬ç¬”è®°è¡ç”Ÿè‡ª ä¸‰å…ƒç»„è¯¦è§£</p></blockquote><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>SPARQLï¼ˆSPARQL Protocol and RDF Query Languageï¼‰</strong> æ˜¯ W3C æ ‡å‡†çš„ RDF æŸ¥è¯¢è¯­è¨€ï¼Œç±»ä¼¼äºå…³ç³»æ•°æ®åº“çš„ SQLï¼Œç”¨äºæŸ¥è¯¢å’Œæ“ä½œ RDF æ•°æ®ã€‚</p><h2 id="æŸ¥è¯¢ç±»å‹"><a href="#æŸ¥è¯¢ç±»å‹" class="headerlink" title="æŸ¥è¯¢ç±»å‹"></a>æŸ¥è¯¢ç±»å‹</h2><table><thead><tr><th>ç±»å‹</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><code>SELECT</code></td><td>è¿”å›åŒ¹é…çš„å˜é‡ç»‘å®š</td></tr><tr><td><code>CONSTRUCT</code></td><td>æ„é€ æ–°çš„ RDF å›¾</td></tr><tr><td><code>ASK</code></td><td>è¿”å›å¸ƒå°”å€¼ï¼ˆæ˜¯å¦å­˜åœ¨åŒ¹é…ï¼‰</td></tr><tr><td><code>DESCRIBE</code></td><td>è¿”å›èµ„æºçš„æè¿°ä¿¡æ¯</td></tr></tbody></table><h2 id="åŸºæœ¬è¯­æ³•ç»“æ„"><a href="#åŸºæœ¬è¯­æ³•ç»“æ„" class="headerlink" title="åŸºæœ¬è¯­æ³•ç»“æ„"></a>åŸºæœ¬è¯­æ³•ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sparql">PREFIX ex: &lt;http://example.org/&gt;<br>PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;<br><br>SELECT ?name ?age<br>WHERE &#123;<br>    ?person foaf:name ?name .<br>    ?person ex:å¹´é¾„ ?age .<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¯­æ³•è¦ç´ "><a href="#è¯­æ³•è¦ç´ " class="headerlink" title="è¯­æ³•è¦ç´ "></a>è¯­æ³•è¦ç´ </h3><table><thead><tr><th>è¦ç´ </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>PREFIX</code></td><td>å®šä¹‰å‘½åç©ºé—´å‰ç¼€</td></tr><tr><td><code>SELECT</code></td><td>æŒ‡å®šè¿”å›çš„å˜é‡</td></tr><tr><td><code>WHERE</code></td><td>å®šä¹‰å›¾æ¨¡å¼ï¼ˆåŒ¹é…æ¡ä»¶ï¼‰</td></tr><tr><td><code>?var</code></td><td>å˜é‡ï¼Œä»¥ <code>?</code> æˆ– <code>$</code> å¼€å¤´</td></tr><tr><td><code>.</code></td><td>ä¸‰å…ƒç»„æ¨¡å¼åˆ†éš”ç¬¦</td></tr></tbody></table><h2 id="åŸºç¡€æŸ¥è¯¢ç¤ºä¾‹"><a href="#åŸºç¡€æŸ¥è¯¢ç¤ºä¾‹" class="headerlink" title="åŸºç¡€æŸ¥è¯¢ç¤ºä¾‹"></a>åŸºç¡€æŸ¥è¯¢ç¤ºä¾‹</h2><h3 id="ç®€å•æŸ¥è¯¢"><a href="#ç®€å•æŸ¥è¯¢" class="headerlink" title="ç®€å•æŸ¥è¯¢"></a>ç®€å•æŸ¥è¯¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># æŸ¥è¯¢æ‰€æœ‰äººçš„åå­—<br>SELECT ?name<br>WHERE &#123;<br>    ?person a ex:Person .<br>    ?person foaf:name ?name .<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¯é€‰åŒ¹é…ï¼ˆOPTIONALï¼‰"><a href="#å¯é€‰åŒ¹é…ï¼ˆOPTIONALï¼‰" class="headerlink" title="å¯é€‰åŒ¹é…ï¼ˆOPTIONALï¼‰"></a>å¯é€‰åŒ¹é…ï¼ˆOPTIONALï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># æŸ¥è¯¢äººåï¼Œå¹´é¾„å¯é€‰<br>SELECT ?name ?age<br>WHERE &#123;<br>    ?person foaf:name ?name .<br>    OPTIONAL &#123; ?person ex:å¹´é¾„ ?age &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è¿‡æ»¤æ¡ä»¶ï¼ˆFILTERï¼‰"><a href="#è¿‡æ»¤æ¡ä»¶ï¼ˆFILTERï¼‰" class="headerlink" title="è¿‡æ»¤æ¡ä»¶ï¼ˆFILTERï¼‰"></a>è¿‡æ»¤æ¡ä»¶ï¼ˆFILTERï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># æŸ¥è¯¢å¹´é¾„å¤§äº 20 çš„äºº<br>SELECT ?name ?age<br>WHERE &#123;<br>    ?person foaf:name ?name .<br>    ?person ex:å¹´é¾„ ?age .<br>    FILTER (?age &gt; 20)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¸¸ç”¨è¿‡æ»¤å‡½æ•°"><a href="#å¸¸ç”¨è¿‡æ»¤å‡½æ•°" class="headerlink" title="å¸¸ç”¨è¿‡æ»¤å‡½æ•°"></a>å¸¸ç”¨è¿‡æ»¤å‡½æ•°</h2><table><thead><tr><th>å‡½æ•°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>FILTER</code></td><td>æ¡ä»¶è¿‡æ»¤</td><td><code>FILTER (?age &gt; 20)</code></td></tr><tr><td><code>REGEX</code></td><td>æ­£åˆ™åŒ¹é…</td><td><code>FILTER REGEX(?name, &quot;^å¼ &quot;)</code></td></tr><tr><td><code>BOUND</code></td><td>æ£€æŸ¥å˜é‡æ˜¯å¦ç»‘å®š</td><td><code>FILTER BOUND(?age)</code></td></tr><tr><td><code>LANG</code></td><td>è·å–è¯­è¨€æ ‡ç­¾</td><td><code>FILTER (LANG(?name) = &quot;zh&quot;)</code></td></tr><tr><td><code>STR</code></td><td>è½¬æ¢ä¸ºå­—ç¬¦ä¸²</td><td><code>STR(?uri)</code></td></tr></tbody></table><h2 id="èšåˆå‡½æ•°"><a href="#èšåˆå‡½æ•°" class="headerlink" title="èšåˆå‡½æ•°"></a>èšåˆå‡½æ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># ç»Ÿè®¡æ¯ä¸ªåŸå¸‚çš„äººæ•°<br>SELECT ?city (COUNT(?person) AS ?count)<br>WHERE &#123;<br>    ?person ex:å±…ä½äº ?city .<br>&#125;<br>GROUP BY ?city<br>HAVING (COUNT(?person) &gt; 10)<br>ORDER BY DESC(?count)<br>LIMIT 10<br></code></pre></td></tr></table></figure><h3 id="èšåˆå‡½æ•°åˆ—è¡¨"><a href="#èšåˆå‡½æ•°åˆ—è¡¨" class="headerlink" title="èšåˆå‡½æ•°åˆ—è¡¨"></a>èšåˆå‡½æ•°åˆ—è¡¨</h3><table><thead><tr><th>å‡½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>COUNT</code></td><td>è®¡æ•°</td></tr><tr><td><code>SUM</code></td><td>æ±‚å’Œ</td></tr><tr><td><code>AVG</code></td><td>å¹³å‡å€¼</td></tr><tr><td><code>MIN</code> &#x2F; <code>MAX</code></td><td>æœ€å°&#x2F;æœ€å¤§å€¼</td></tr><tr><td><code>GROUP_CONCAT</code></td><td>å­—ç¬¦ä¸²è¿æ¥</td></tr><tr><td><code>SAMPLE</code></td><td>éšæœºå–æ ·</td></tr></tbody></table><h2 id="é«˜çº§æŸ¥è¯¢"><a href="#é«˜çº§æŸ¥è¯¢" class="headerlink" title="é«˜çº§æŸ¥è¯¢"></a>é«˜çº§æŸ¥è¯¢</h2><h3 id="UNIONï¼ˆè”åˆæŸ¥è¯¢ï¼‰"><a href="#UNIONï¼ˆè”åˆæŸ¥è¯¢ï¼‰" class="headerlink" title="UNIONï¼ˆè”åˆæŸ¥è¯¢ï¼‰"></a>UNIONï¼ˆè”åˆæŸ¥è¯¢ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># æŸ¥è¯¢è®¤è¯†æˆ–å–œæ¬¢æå››çš„äºº<br>SELECT ?person<br>WHERE &#123;<br>    &#123; ?person ex:è®¤è¯† ex:æå›› &#125;<br>    UNION<br>    &#123; ?person ex:å–œæ¬¢ ex:æå›› &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="MINUSï¼ˆå·®é›†ï¼‰"><a href="#MINUSï¼ˆå·®é›†ï¼‰" class="headerlink" title="MINUSï¼ˆå·®é›†ï¼‰"></a>MINUSï¼ˆå·®é›†ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># æŸ¥è¯¢æ²¡æœ‰å¹´é¾„ä¿¡æ¯çš„äºº<br>SELECT ?person<br>WHERE &#123;<br>    ?person a ex:Person .<br>    MINUS &#123; ?person ex:å¹´é¾„ ?age &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># æŸ¥è¯¢å¥½å‹æ•°æœ€å¤šçš„äºº<br>SELECT ?person ?friendCount<br>WHERE &#123;<br>    &#123;<br>        SELECT ?person (COUNT(?friend) AS ?friendCount)<br>        WHERE &#123;<br>            ?person ex:è®¤è¯† ?friend .<br>        &#125;<br>        GROUP BY ?person<br>    &#125;<br>&#125;<br>ORDER BY DESC(?friendCount)<br>LIMIT 1<br></code></pre></td></tr></table></figure><h2 id="å±æ€§è·¯å¾„"><a href="#å±æ€§è·¯å¾„" class="headerlink" title="å±æ€§è·¯å¾„"></a>å±æ€§è·¯å¾„</h2><p>SPARQL 1.1 æ”¯æŒå±æ€§è·¯å¾„è¡¨è¾¾å¼ï¼š</p><table><thead><tr><th>è¯­æ³•</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>ex:a/ex:b</code></td><td>è·¯å¾„è¿æ¥ï¼ˆa ç„¶å bï¼‰</td></tr><tr><td><code>ex:a|ex:b</code></td><td>è·¯å¾„é€‰æ‹©ï¼ˆa æˆ– bï¼‰</td></tr><tr><td><code>ex:a*</code></td><td>é›¶æˆ–å¤šæ¬¡</td></tr><tr><td><code>ex:a+</code></td><td>ä¸€æˆ–å¤šæ¬¡</td></tr><tr><td><code>ex:a?</code></td><td>é›¶æˆ–ä¸€æ¬¡</td></tr><tr><td><code>^ex:a</code></td><td>åå‘è·¯å¾„</td></tr></tbody></table><h3 id="å±æ€§è·¯å¾„ç¤ºä¾‹"><a href="#å±æ€§è·¯å¾„ç¤ºä¾‹" class="headerlink" title="å±æ€§è·¯å¾„ç¤ºä¾‹"></a>å±æ€§è·¯å¾„ç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># æŸ¥è¯¢å¼ ä¸‰ç›´æ¥æˆ–é—´æ¥è®¤è¯†çš„äººï¼ˆä¼ é€’é—­åŒ…ï¼‰<br>SELECT ?person<br>WHERE &#123;<br>    ex:å¼ ä¸‰ ex:è®¤è¯†+ ?person .<br>&#125;<br><br># æŸ¥è¯¢å¼ ä¸‰çš„æœ‹å‹çš„æœ‹å‹<br>SELECT ?fof<br>WHERE &#123;<br>    ex:å¼ ä¸‰ ex:è®¤è¯†/ex:è®¤è¯† ?fof .<br>    FILTER (?fof != ex:å¼ ä¸‰)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="CONSTRUCT-æ„é€ æŸ¥è¯¢"><a href="#CONSTRUCT-æ„é€ æŸ¥è¯¢" class="headerlink" title="CONSTRUCT æ„é€ æŸ¥è¯¢"></a>CONSTRUCT æ„é€ æŸ¥è¯¢</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># æ„é€ æ–°çš„ RDF å›¾<br>CONSTRUCT &#123;<br>    ?person ex:is_adult true .<br>&#125;<br>WHERE &#123;<br>    ?person ex:å¹´é¾„ ?age .<br>    FILTER (?age &gt;= 18)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ›´æ–°æ“ä½œï¼ˆSPARQL-Updateï¼‰"><a href="#æ›´æ–°æ“ä½œï¼ˆSPARQL-Updateï¼‰" class="headerlink" title="æ›´æ–°æ“ä½œï¼ˆSPARQL Updateï¼‰"></a>æ›´æ–°æ“ä½œï¼ˆSPARQL Updateï¼‰</h2><h3 id="INSERT-DATA"><a href="#INSERT-DATA" class="headerlink" title="INSERT DATA"></a>INSERT DATA</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sparql">INSERT DATA &#123;<br>    ex:ç‹äº” a ex:Person ;<br>           foaf:name &quot;ç‹äº”&quot; ;<br>           ex:å¹´é¾„ 30 .<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="DELETE-DATA"><a href="#DELETE-DATA" class="headerlink" title="DELETE DATA"></a>DELETE DATA</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sparql">DELETE DATA &#123;<br>    ex:å¼ ä¸‰ ex:å¹´é¾„ 25 .<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="DELETE-INSERT"><a href="#DELETE-INSERT" class="headerlink" title="DELETE&#x2F;INSERT"></a>DELETE&#x2F;INSERT</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sparql">DELETE &#123; ?person ex:å¹´é¾„ ?oldAge &#125;<br>INSERT &#123; ?person ex:å¹´é¾„ ?newAge &#125;<br>WHERE &#123;<br>    ?person ex:å¹´é¾„ ?oldAge .<br>    BIND (?oldAge + 1 AS ?newAge)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¸¸ç”¨-SPARQL-ç«¯ç‚¹"><a href="#å¸¸ç”¨-SPARQL-ç«¯ç‚¹" class="headerlink" title="å¸¸ç”¨ SPARQL ç«¯ç‚¹"></a>å¸¸ç”¨ SPARQL ç«¯ç‚¹</h2><table><thead><tr><th>ç«¯ç‚¹</th><th>URL</th></tr></thead><tbody><tr><td>DBpedia</td><td><code>https://dbpedia.org/sparql</code></td></tr><tr><td>Wikidata</td><td><code>https://query.wikidata.org/sparql</code></td></tr><tr><td>UniProt</td><td><code>https://sparql.uniprot.org/sparql</code></td></tr></tbody></table><h2 id="æŸ¥è¯¢ç¤ºä¾‹ï¼šWikidata"><a href="#æŸ¥è¯¢ç¤ºä¾‹ï¼šWikidata" class="headerlink" title="æŸ¥è¯¢ç¤ºä¾‹ï¼šWikidata"></a>æŸ¥è¯¢ç¤ºä¾‹ï¼šWikidata</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># æŸ¥è¯¢æ‰€æœ‰ä¸­å›½åŸå¸‚<br>SELECT ?city ?cityLabel ?population<br>WHERE &#123;<br>    ?city wdt:P31 wd:Q515 .        # å®ä¾‹ç±»å‹ï¼šåŸå¸‚<br>    ?city wdt:P17 wd:Q148 .        # æ‰€å±å›½å®¶ï¼šä¸­å›½<br>    OPTIONAL &#123; ?city wdt:P1082 ?population &#125;<br>    SERVICE wikibase:label &#123; bd:serviceParam wikibase:language &quot;zh,en&quot; &#125;<br>&#125;<br>ORDER BY DESC(?population)<br>LIMIT 20<br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸‰å…ƒç»„è¯¦è§£ - è¡ç”Ÿæ¥æº</li><li>RDFè§„èŒƒ - SPARQL æŸ¥è¯¢çš„æ•°æ®æ ¼å¼</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>å›¾æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å›¾æ•°æ®åº“</tag>
      
      <tag>RDF</tag>
      
      <tag>å…¨æ–‡å¼•ç”¨</tag>
      
      <tag>SPARQL</tag>
      
      <tag>æŸ¥è¯¢è¯­è¨€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Reflexionè‡ªåæ€Agentè¯¦è§£</title>
    <link href="/2026/01/12/Reflexion%E8%87%AA%E5%8F%8D%E6%80%9DAgent%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/12/Reflexion%E8%87%AA%E5%8F%8D%E6%80%9DAgent%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Reflexion-è‡ªåæ€-Agent-è¯¦è§£"><a href="#Reflexion-è‡ªåæ€-Agent-è¯¦è§£" class="headerlink" title="Reflexion è‡ªåæ€ Agent è¯¦è§£"></a>Reflexion è‡ªåæ€ Agent è¯¦è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>Reflexion</strong> æ˜¯ä¸€ç§è®© Agent å…·å¤‡â€ä»é”™è¯¯ä¸­å­¦ä¹ â€èƒ½åŠ›çš„æ¶æ„æ¨¡å¼ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæ‰§è¡Œä»»åŠ¡åè¿›è¡Œè‡ªæˆ‘è¯„ä¼°å’Œåæ€ï¼Œå°†ç»éªŒæ•™è®­å­˜å…¥è®°å¿†ï¼Œåœ¨åç»­å°è¯•ä¸­é¿å…é‡å¤é”™è¯¯ã€‚</p><blockquote><p><strong>ğŸ’¡ æç¤º: æ ¸å¿ƒä»·å€¼</strong><br>ä¼ ç»Ÿ Agent æ¯æ¬¡éƒ½æ˜¯â€ä»é›¶å¼€å§‹â€ï¼Œè€Œ Reflexion Agent èƒ½å¤Ÿ<strong>ç§¯ç´¯ç»éªŒã€æŒç»­æ”¹è¿›</strong>ã€‚</p></blockquote><h2 id="ä¸ä¼ ç»Ÿ-Agent-çš„å¯¹æ¯”"><a href="#ä¸ä¼ ç»Ÿ-Agent-çš„å¯¹æ¯”" class="headerlink" title="ä¸ä¼ ç»Ÿ Agent çš„å¯¹æ¯”"></a>ä¸ä¼ ç»Ÿ Agent çš„å¯¹æ¯”</h2><table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿ Agent</th><th>Reflexion Agent</th></tr></thead><tbody><tr><td>å¤±è´¥å¤„ç†</td><td>ç®€å•é‡è¯•</td><td>åæ€åæ”¹è¿›å†è¯•</td></tr><tr><td>ç»éªŒç§¯ç´¯</td><td>æ— </td><td>æœ‰ï¼ˆè®°å¿†æ¨¡å—ï¼‰</td></tr><tr><td>å­¦ä¹ èƒ½åŠ›</td><td>æ— </td><td>ä»é”™è¯¯ä¸­å­¦ä¹ </td></tr><tr><td>æˆåŠŸç‡</td><td>éšæœº</td><td>é€æ¬¡æå‡</td></tr></tbody></table><hr><h2 id="ä¸€ã€æ ¸å¿ƒæ¶æ„"><a href="#ä¸€ã€æ ¸å¿ƒæ¶æ„" class="headerlink" title="ä¸€ã€æ ¸å¿ƒæ¶æ„"></a>ä¸€ã€æ ¸å¿ƒæ¶æ„</h2><h3 id="1-1-ä¸‰å¤§ç»„ä»¶"><a href="#1-1-ä¸‰å¤§ç»„ä»¶" class="headerlink" title="1.1 ä¸‰å¤§ç»„ä»¶"></a>1.1 ä¸‰å¤§ç»„ä»¶</h3><pre><code class=" mermaid">graph TB    subgraph Reflexion Agent        A[Actor&lt;br/&gt;æ‰§è¡Œè€…] --&gt; B[Evaluator&lt;br/&gt;è¯„ä¼°è€…]        B --&gt; C&#123;æˆåŠŸ?&#125;        C --&gt;|æ˜¯| D[è¿”å›ç»“æœ]        C --&gt;|å¦| E[Self-Reflection&lt;br/&gt;è‡ªåæ€]        E --&gt; F[Memory&lt;br/&gt;ç»éªŒè®°å¿†]        F --&gt; A    end</code></pre><table><thead><tr><th>ç»„ä»¶</th><th>èŒè´£</th><th>è¾“å…¥</th><th>è¾“å‡º</th></tr></thead><tbody><tr><td><strong>Actor</strong></td><td>æ‰§è¡Œä»»åŠ¡</td><td>ä»»åŠ¡ + å†å²ç»éªŒ</td><td>æ‰§è¡Œç»“æœ</td></tr><tr><td><strong>Evaluator</strong></td><td>è¯„ä¼°ç»“æœè´¨é‡</td><td>ä»»åŠ¡ + ç»“æœ</td><td>æˆåŠŸ&#x2F;å¤±è´¥ + åé¦ˆ</td></tr><tr><td><strong>Self-Reflection</strong></td><td>åˆ†æå¤±è´¥åŸå› </td><td>æ‰§è¡Œå†å² + è¯„ä¼°åé¦ˆ</td><td>ç»éªŒæ•™è®­</td></tr><tr><td><strong>Memory</strong></td><td>å­˜å‚¨ç»éªŒ</td><td>åæ€ç»“æœ</td><td>å†å²ç»éªŒåˆ—è¡¨</td></tr></tbody></table><h3 id="1-2-æ‰§è¡Œæµç¨‹"><a href="#1-2-æ‰§è¡Œæµç¨‹" class="headerlink" title="1.2 æ‰§è¡Œæµç¨‹"></a>1.2 æ‰§è¡Œæµç¨‹</h3><pre><code class=" mermaid">sequenceDiagram    participant U as ç”¨æˆ·    participant A as Actor    participant E as Evaluator    participant R as Self-Reflection    participant M as Memory        U-&gt;&gt;A: ä»»åŠ¡    M-&gt;&gt;A: å†å²ç»éªŒ    A-&gt;&gt;E: æ‰§è¡Œç»“æœ    E-&gt;&gt;E: è¯„ä¼°        alt æˆåŠŸ        E-&gt;&gt;U: è¿”å›ç»“æœ    else å¤±è´¥        E-&gt;&gt;R: è¯„ä¼°åé¦ˆ        R-&gt;&gt;R: åæ€åˆ†æ        R-&gt;&gt;M: å­˜å‚¨ç»éªŒ        M-&gt;&gt;A: æ›´æ–°ç»éªŒ        Note over A: é‡æ–°å°è¯•    end</code></pre><hr><h2 id="äºŒã€å„ç»„ä»¶è¯¦è§£"><a href="#äºŒã€å„ç»„ä»¶è¯¦è§£" class="headerlink" title="äºŒã€å„ç»„ä»¶è¯¦è§£"></a>äºŒã€å„ç»„ä»¶è¯¦è§£</h2><h3 id="2-1-Actorï¼ˆæ‰§è¡Œè€…ï¼‰"><a href="#2-1-Actorï¼ˆæ‰§è¡Œè€…ï¼‰" class="headerlink" title="2.1 Actorï¼ˆæ‰§è¡Œè€…ï¼‰"></a>2.1 Actorï¼ˆæ‰§è¡Œè€…ï¼‰</h3><p>Actor è´Ÿè´£å®é™…æ‰§è¡Œä»»åŠ¡ï¼Œä½†ä¼šå‚è€ƒå†å²ç»éªŒé¿å…é‡å¤é”™è¯¯ã€‚</p><h4 id="Prompt-æ¨¡æ¿"><a href="#Prompt-æ¨¡æ¿" class="headerlink" title="Prompt æ¨¡æ¿"></a>Prompt æ¨¡æ¿</h4><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs clean">ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œè´Ÿè´£å®Œæˆç”¨æˆ·ä»»åŠ¡ã€‚<br><br>## ä»»åŠ¡<br>&#123;task&#125;<br><br>## å†å²ç»éªŒæ•™è®­ï¼ˆè¯·åŠ¡å¿…å‚è€ƒï¼Œé¿å…é‡å¤é”™è¯¯ï¼‰<br>&#123;experiences&#125;<br><br>## è¦æ±‚<br><span class="hljs-number">1.</span> ä»”ç»†é˜…è¯»å†å²ç»éªŒï¼Œé¿å…çŠ¯åŒæ ·çš„é”™è¯¯<br><span class="hljs-number">2.</span> å¦‚æœå†å²ç»éªŒæåˆ°æŸç§æ–¹æ³•ä¸å¯è¡Œï¼Œè¯·å°è¯•å…¶ä»–æ–¹æ³•<br><span class="hljs-number">3.</span> è¾“å‡ºä½ çš„æ€è€ƒè¿‡ç¨‹å’Œæœ€ç»ˆç»“æœ<br><br>## è¾“å‡ºæ ¼å¼<br>### æ€è€ƒ<br>[åˆ†æä»»åŠ¡ï¼Œå‚è€ƒç»éªŒï¼Œè§„åˆ’æ–¹æ¡ˆ]<br><br>### æ‰§è¡Œ<br>[å…·ä½“æ‰§è¡Œæ­¥éª¤å’Œç»“æœ]<br></code></pre></td></tr></table></figure><h4 id="Java-å®ç°"><a href="#Java-å®ç°" class="headerlink" title="Java å®ç°"></a>Java å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Actor</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br>    <br>    <span class="hljs-keyword">public</span> ActorResult <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, List&lt;String&gt; experiences)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">experienceText</span> <span class="hljs-operator">=</span> experiences.isEmpty() <br>            ? <span class="hljs-string">&quot;æš‚æ— å†å²ç»éªŒ&quot;</span><br>            : experiences.stream()<br>                .map(e -&gt; <span class="hljs-string">&quot;- &quot;</span> + e)<br>                .collect(Collectors.joining(<span class="hljs-string">&quot;\n&quot;</span>));<br>        <br>        <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> chatClient.prompt()<br>            .system(ACTOR_PROMPT)<br>            .user(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">                ## ä»»åŠ¡</span><br><span class="hljs-string">                %s</span><br><span class="hljs-string">                </span><br><span class="hljs-string">                ## å†å²ç»éªŒæ•™è®­</span><br><span class="hljs-string">                %s</span><br><span class="hljs-string">                &quot;&quot;&quot;</span>.formatted(task, experienceText))<br>            .call()<br>            .content();<br>        <br>        <span class="hljs-keyword">return</span> parseActorResult(response);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActorResult</span> &#123;<br>    <span class="hljs-keyword">private</span> String thinking;      <span class="hljs-comment">// æ€è€ƒè¿‡ç¨‹</span><br>    <span class="hljs-keyword">private</span> String execution;     <span class="hljs-comment">// æ‰§è¡Œç»“æœ</span><br>    <span class="hljs-keyword">private</span> List&lt;String&gt; actions; <span class="hljs-comment">// æ‰§è¡Œçš„åŠ¨ä½œåˆ—è¡¨</span><br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="2-2-Evaluatorï¼ˆè¯„ä¼°è€…ï¼‰"><a href="#2-2-Evaluatorï¼ˆè¯„ä¼°è€…ï¼‰" class="headerlink" title="2.2 Evaluatorï¼ˆè¯„ä¼°è€…ï¼‰"></a>2.2 Evaluatorï¼ˆè¯„ä¼°è€…ï¼‰</h3><p>Evaluator è´Ÿè´£åˆ¤æ–­æ‰§è¡Œç»“æœæ˜¯å¦è¾¾æ ‡ï¼Œå¯ä»¥ç”¨ LLM è¯„ä¼°ã€è§„åˆ™è¯„ä¼°æˆ–æµ‹è¯•ç”¨ä¾‹è¯„ä¼°ã€‚</p><h4 id="è¯„ä¼°æ–¹å¼å¯¹æ¯”"><a href="#è¯„ä¼°æ–¹å¼å¯¹æ¯”" class="headerlink" title="è¯„ä¼°æ–¹å¼å¯¹æ¯”"></a>è¯„ä¼°æ–¹å¼å¯¹æ¯”</h4><table><thead><tr><th>è¯„ä¼°æ–¹å¼</th><th>é€‚ç”¨åœºæ™¯</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>LLM è¯„ä¼°</strong></td><td>å¼€æ”¾æ€§ä»»åŠ¡</td><td>çµæ´»</td><td>å¯èƒ½ä¸å‡†ç¡®</td></tr><tr><td><strong>è§„åˆ™è¯„ä¼°</strong></td><td>æœ‰æ˜ç¡®æ ‡å‡†çš„ä»»åŠ¡</td><td>å‡†ç¡®</td><td>ä¸å¤Ÿçµæ´»</td></tr><tr><td><strong>æµ‹è¯•ç”¨ä¾‹</strong></td><td>ä»£ç ç”Ÿæˆä»»åŠ¡</td><td>å®¢è§‚å‡†ç¡®</td><td>éœ€è¦é¢„å…ˆå‡†å¤‡</td></tr><tr><td><strong>äººå·¥è¯„ä¼°</strong></td><td>é«˜é£é™©å†³ç­–</td><td>æœ€å‡†ç¡®</td><td>æˆæœ¬é«˜</td></tr></tbody></table><h4 id="LLM-è¯„ä¼°-Prompt"><a href="#LLM-è¯„ä¼°-Prompt" class="headerlink" title="LLM è¯„ä¼° Prompt"></a>LLM è¯„ä¼° Prompt</h4><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs clean">ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„ä»»åŠ¡è¯„ä¼°ä¸“å®¶ã€‚<br><br>## åŸå§‹ä»»åŠ¡<br>&#123;task&#125;<br><br>## æ‰§è¡Œç»“æœ<br>&#123;result&#125;<br><br>## è¯„ä¼°ç»´åº¦<br><span class="hljs-number">1.</span> **æ­£ç¡®æ€§**ï¼šç»“æœæ˜¯å¦æ­£ç¡®å®Œæˆäº†ä»»åŠ¡è¦æ±‚<br><span class="hljs-number">2.</span> **å®Œæ•´æ€§**ï¼šæ˜¯å¦è¦†ç›–äº†æ‰€æœ‰è¦æ±‚<br><span class="hljs-number">3.</span> **è´¨é‡**ï¼šç»“æœçš„è´¨é‡å¦‚ä½•<br><br>## è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰<br>&#123;<br>  <span class="hljs-string">&quot;success&quot;</span>: true/false,<br>  <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">0</span><span class="hljs-number">-100</span>,<br>  <span class="hljs-string">&quot;dimensions&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;correctness&quot;</span>: &#123;<span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">0</span><span class="hljs-number">-100</span>, <span class="hljs-string">&quot;feedback&quot;</span>: <span class="hljs-string">&quot;...&quot;</span>&#125;,<br>    <span class="hljs-string">&quot;completeness&quot;</span>: &#123;<span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">0</span><span class="hljs-number">-100</span>, <span class="hljs-string">&quot;feedback&quot;</span>: <span class="hljs-string">&quot;...&quot;</span>&#125;,<br>    <span class="hljs-string">&quot;quality&quot;</span>: &#123;<span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">0</span><span class="hljs-number">-100</span>, <span class="hljs-string">&quot;feedback&quot;</span>: <span class="hljs-string">&quot;...&quot;</span>&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;overall_feedback&quot;</span>: <span class="hljs-string">&quot;æ€»ä½“è¯„ä»·&quot;</span>,<br>  <span class="hljs-string">&quot;specific_issues&quot;</span>: [<span class="hljs-string">&quot;é—®é¢˜1&quot;</span>, <span class="hljs-string">&quot;é—®é¢˜2&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Java-å®ç°-1"><a href="#Java-å®ç°-1" class="headerlink" title="Java å®ç°"></a>Java å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Evaluator</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br>    <br>    <span class="hljs-comment">// LLM è¯„ä¼°</span><br>    <span class="hljs-keyword">public</span> EvaluationResult <span class="hljs-title function_">evaluateWithLLM</span><span class="hljs-params">(String task, String result)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> chatClient.prompt()<br>            .system(EVALUATOR_PROMPT)<br>            .user(<span class="hljs-string">&quot;ä»»åŠ¡ï¼š%s\n\nç»“æœï¼š%s&quot;</span>.formatted(task, result))<br>            .call()<br>            .content();<br>        <br>        <span class="hljs-keyword">return</span> parseJson(response, EvaluationResult.class);<br>    &#125;<br>    <br>    <span class="hljs-comment">// ä»£ç ä»»åŠ¡ï¼šæµ‹è¯•ç”¨ä¾‹è¯„ä¼°</span><br>    <span class="hljs-keyword">public</span> EvaluationResult <span class="hljs-title function_">evaluateCode</span><span class="hljs-params">(String code, List&lt;TestCase&gt; testCases)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">passed</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        List&lt;String&gt; failures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <br>        <span class="hljs-keyword">for</span> (TestCase tc : testCases) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> executeCode(code, tc.getInput());<br>                <span class="hljs-keyword">if</span> (tc.getExpected().equals(result)) &#123;<br>                    passed++;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    failures.add(<span class="hljs-string">&quot;è¾“å…¥ %s æœŸæœ› %s å®é™… %s&quot;</span><br>                        .formatted(tc.getInput(), tc.getExpected(), result));<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                failures.add(<span class="hljs-string">&quot;è¾“å…¥ %s æ‰§è¡Œå¼‚å¸¸ï¼š%s&quot;</span><br>                    .formatted(tc.getInput(), e.getMessage()));<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-type">int</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> passed * <span class="hljs-number">100</span> / testCases.size();<br>        <span class="hljs-keyword">return</span> EvaluationResult.builder()<br>            .success(score &gt;= <span class="hljs-number">100</span>)<br>            .score(score)<br>            .specificIssues(failures)<br>            .build();<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Builder</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EvaluationResult</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> success;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> score;<br>    <span class="hljs-keyword">private</span> Map&lt;String, DimensionScore&gt; dimensions;<br>    <span class="hljs-keyword">private</span> String overallFeedback;<br>    <span class="hljs-keyword">private</span> List&lt;String&gt; specificIssues;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="2-3-Self-Reflectionï¼ˆè‡ªåæ€ï¼‰"><a href="#2-3-Self-Reflectionï¼ˆè‡ªåæ€ï¼‰" class="headerlink" title="2.3 Self-Reflectionï¼ˆè‡ªåæ€ï¼‰"></a>2.3 Self-Reflectionï¼ˆè‡ªåæ€ï¼‰</h3><p>Self-Reflection æ˜¯ Reflexion çš„æ ¸å¿ƒï¼Œè´Ÿè´£æ·±åº¦åˆ†æå¤±è´¥åŸå› å¹¶æ€»ç»“ç»éªŒã€‚</p><h4 id="åæ€-Prompt"><a href="#åæ€-Prompt" class="headerlink" title="åæ€ Prompt"></a>åæ€ Prompt</h4><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs clean">ä½ æ˜¯ä¸€ä¸ªå–„äºåæ€å’Œæ€»ç»“çš„åˆ†æä¸“å®¶ã€‚<br><br>## ä»»åŠ¡ç›®æ ‡<br>&#123;task&#125;<br><br>## æ‰§è¡Œè¿‡ç¨‹<br>&#123;execution_trace&#125;<br><br>## æ‰§è¡Œç»“æœ<br>&#123;result&#125;<br><br>## è¯„ä¼°åé¦ˆ<br>&#123;evaluation_feedback&#125;<br><br>## è¯·è¿›è¡Œæ·±åº¦åæ€<br><br>### <span class="hljs-number">1.</span> é—®é¢˜è¯Šæ–­<br>- è¿™æ¬¡å°è¯•å…·ä½“å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Ÿ<br>- æ˜¯ç†è§£é”™è¯¯ã€æ–¹æ³•é”™è¯¯è¿˜æ˜¯æ‰§è¡Œé”™è¯¯ï¼Ÿ<br><br>### <span class="hljs-number">2.</span> æ ¹å› åˆ†æ<br>- é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ<br>- æ˜¯å¦æœ‰é”™è¯¯çš„å‡è®¾ï¼Ÿ<br><br>### <span class="hljs-number">3.</span> ç»éªŒæ€»ç»“<br>- ä»è¿™æ¬¡å¤±è´¥ä¸­å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ<br>- ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜åº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ<br><br>### <span class="hljs-number">4.</span> æ”¹è¿›æ–¹æ¡ˆ<br>- å…·ä½“çš„æ”¹è¿›æªæ–½æ˜¯ä»€ä¹ˆï¼Ÿ<br>- ä¸‹ä¸€æ¬¡å°è¯•åº”è¯¥æ€ä¹ˆåšï¼Ÿ<br><br>## è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰<br>&#123;<br>  <span class="hljs-string">&quot;problem_diagnosis&quot;</span>: <span class="hljs-string">&quot;é—®é¢˜è¯Šæ–­&quot;</span>,<br>  <span class="hljs-string">&quot;root_cause&quot;</span>: <span class="hljs-string">&quot;æ ¹æœ¬åŸå› &quot;</span>,<br>  <span class="hljs-string">&quot;lessons_learned&quot;</span>: [<br>    <span class="hljs-string">&quot;ç»éªŒ1ï¼š...&quot;</span>,<br>    <span class="hljs-string">&quot;ç»éªŒ2ï¼š...&quot;</span><br>  ],<br>  <span class="hljs-string">&quot;improvement_plan&quot;</span>: <span class="hljs-string">&quot;æ”¹è¿›æ–¹æ¡ˆ&quot;</span>,<br>  <span class="hljs-string">&quot;confidence&quot;</span>: <span class="hljs-number">0</span><span class="hljs-number">-100</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Java-å®ç°-2"><a href="#Java-å®ç°-2" class="headerlink" title="Java å®ç°"></a>Java å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelfReflection</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br>    <br>    <span class="hljs-keyword">public</span> ReflectionResult <span class="hljs-title function_">reflect</span><span class="hljs-params">(ReflectionInput input)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> chatClient.prompt()<br>            .system(REFLECTION_PROMPT)<br>            .user(<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">                ## ä»»åŠ¡ç›®æ ‡</span><br><span class="hljs-string">                %s</span><br><span class="hljs-string">                </span><br><span class="hljs-string">                ## æ‰§è¡Œè¿‡ç¨‹</span><br><span class="hljs-string">                %s</span><br><span class="hljs-string">                </span><br><span class="hljs-string">                ## æ‰§è¡Œç»“æœ</span><br><span class="hljs-string">                %s</span><br><span class="hljs-string">                </span><br><span class="hljs-string">                ## è¯„ä¼°åé¦ˆ</span><br><span class="hljs-string">                %s</span><br><span class="hljs-string">                &quot;&quot;&quot;</span>.formatted(<br>                    input.getTask(),<br>                    input.getExecutionTrace(),<br>                    input.getResult(),<br>                    input.getEvaluationFeedback()<br>                ))<br>            .call()<br>            .content();<br>        <br>        <span class="hljs-keyword">return</span> parseJson(response, ReflectionResult.class);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectionInput</span> &#123;<br>    <span class="hljs-keyword">private</span> String task;<br>    <span class="hljs-keyword">private</span> String executionTrace;<br>    <span class="hljs-keyword">private</span> String result;<br>    <span class="hljs-keyword">private</span> String evaluationFeedback;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectionResult</span> &#123;<br>    <span class="hljs-keyword">private</span> String problemDiagnosis;<br>    <span class="hljs-keyword">private</span> String rootCause;<br>    <span class="hljs-keyword">private</span> List&lt;String&gt; lessonsLearned;<br>    <span class="hljs-keyword">private</span> String improvementPlan;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> confidence;<br>    <br>    <span class="hljs-comment">// è½¬æ¢ä¸ºå¯å­˜å‚¨çš„ç»éªŒæ–‡æœ¬</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toExperienceText</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            é—®é¢˜ï¼š%s</span><br><span class="hljs-string">            åŸå› ï¼š%s</span><br><span class="hljs-string">            æ•™è®­ï¼š%s</span><br><span class="hljs-string">            æ”¹è¿›ï¼š%s</span><br><span class="hljs-string">            &quot;&quot;&quot;</span>.formatted(<br>                problemDiagnosis,<br>                rootCause,<br>                String.join(<span class="hljs-string">&quot;ï¼›&quot;</span>, lessonsLearned),<br>                improvementPlan<br>            );<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="2-4-Memoryï¼ˆè®°å¿†æ¨¡å—ï¼‰"><a href="#2-4-Memoryï¼ˆè®°å¿†æ¨¡å—ï¼‰" class="headerlink" title="2.4 Memoryï¼ˆè®°å¿†æ¨¡å—ï¼‰"></a>2.4 Memoryï¼ˆè®°å¿†æ¨¡å—ï¼‰</h3><p>Memory è´Ÿè´£å­˜å‚¨å’Œæ£€ç´¢ç»éªŒï¼Œæ”¯æŒçŸ­æœŸè®°å¿†ï¼ˆå½“å‰ä»»åŠ¡ï¼‰å’Œé•¿æœŸè®°å¿†ï¼ˆè·¨ä»»åŠ¡ï¼‰ã€‚</p><h4 id="è®°å¿†æ¶æ„"><a href="#è®°å¿†æ¶æ„" class="headerlink" title="è®°å¿†æ¶æ„"></a>è®°å¿†æ¶æ„</h4><pre><code class=" mermaid">graph TB    subgraph Memory        A[çŸ­æœŸè®°å¿†] --&gt; C[ç»éªŒæ£€ç´¢]        B[é•¿æœŸè®°å¿†] --&gt; C    end        D[å½“å‰ä»»åŠ¡ç»éªŒ] --&gt; A    E[å†å²ä»»åŠ¡ç»éªŒ] --&gt; B    C --&gt; F[ç›¸å…³ç»éªŒ]</code></pre><h4 id="Java-å®ç°-3"><a href="#Java-å®ç°-3" class="headerlink" title="Java å®ç°"></a>Java å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflexionMemory</span> &#123;<br>    <br>    <span class="hljs-comment">// çŸ­æœŸè®°å¿†ï¼šå½“å‰ä»»åŠ¡çš„å°è¯•å†å²</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;String&gt; shortTermMemory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <br>    <span class="hljs-comment">// é•¿æœŸè®°å¿†ï¼šå‘é‡æ•°æ®åº“</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> VectorStore vectorStore;<br>    <br>    <span class="hljs-comment">// æ·»åŠ çŸ­æœŸè®°å¿†</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addShortTerm</span><span class="hljs-params">(String experience)</span> &#123;<br>        shortTermMemory.add(experience);<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ¸…ç©ºçŸ­æœŸè®°å¿†ï¼ˆä»»åŠ¡å®Œæˆåï¼‰</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearShortTerm</span><span class="hljs-params">()</span> &#123;<br>        shortTermMemory.clear();<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ·»åŠ é•¿æœŸè®°å¿†</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addLongTerm</span><span class="hljs-params">(String experience, String taskType)</span> &#123;<br>        <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>(<br>            experience,<br>            Map.of(<br>                <span class="hljs-string">&quot;task_type&quot;</span>, taskType,<br>                <span class="hljs-string">&quot;timestamp&quot;</span>, System.currentTimeMillis(),<br>                <span class="hljs-string">&quot;source&quot;</span>, <span class="hljs-string">&quot;reflexion&quot;</span><br>            )<br>        );<br>        vectorStore.add(List.of(doc));<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ£€ç´¢ç›¸å…³ç»éªŒ</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">recall</span><span class="hljs-params">(String task, <span class="hljs-type">int</span> topK)</span> &#123;<br>        List&lt;String&gt; experiences = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <br>        <span class="hljs-comment">// 1. æ·»åŠ çŸ­æœŸè®°å¿†ï¼ˆå½“å‰ä»»åŠ¡çš„æ‰€æœ‰å°è¯•ï¼‰</span><br>        experiences.addAll(shortTermMemory);<br>        <br>        <span class="hljs-comment">// 2. æ£€ç´¢é•¿æœŸè®°å¿†ä¸­çš„ç›¸å…³ç»éªŒ</span><br>        List&lt;Document&gt; docs = vectorStore.similaritySearch(<br>            SearchRequest.query(task).withTopK(topK)<br>        );<br>        <br>        <span class="hljs-keyword">for</span> (Document doc : docs) &#123;<br>            experiences.add(doc.getContent());<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> experiences;<br>    &#125;<br>    <br>    <span class="hljs-comment">// è·å–çŸ­æœŸè®°å¿†</span><br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getShortTermMemory</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(shortTermMemory);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="ä¸‰ã€å®Œæ•´å®ç°"><a href="#ä¸‰ã€å®Œæ•´å®ç°" class="headerlink" title="ä¸‰ã€å®Œæ•´å®ç°"></a>ä¸‰ã€å®Œæ•´å®ç°</h2><h3 id="3-1-Reflexion-Agent-ä¸»ç±»"><a href="#3-1-Reflexion-Agent-ä¸»ç±»" class="headerlink" title="3.1 Reflexion Agent ä¸»ç±»"></a>3.1 Reflexion Agent ä¸»ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflexionAgent</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Actor actor;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Evaluator evaluator;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> SelfReflection selfReflection;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReflexionMemory memory;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_RETRIES</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SUCCESS_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">80</span>;<br>    <br>    <span class="hljs-keyword">public</span> ReflexionResponse <span class="hljs-title function_">execute</span><span class="hljs-params">(String task)</span> &#123;<br>        log.info(<span class="hljs-string">&quot;å¼€å§‹æ‰§è¡Œä»»åŠ¡: &#123;&#125;&quot;</span>, task);<br>        <br>        List&lt;AttemptRecord&gt; attempts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;<br>            log.info(<span class="hljs-string">&quot;=== ç¬¬ &#123;&#125; æ¬¡å°è¯• ===&quot;</span>, attempt);<br>            <br>            <span class="hljs-comment">// 1. æ£€ç´¢ç›¸å…³ç»éªŒ</span><br>            List&lt;String&gt; experiences = memory.recall(task, <span class="hljs-number">5</span>);<br>            log.info(<span class="hljs-string">&quot;æ£€ç´¢åˆ° &#123;&#125; æ¡ç›¸å…³ç»éªŒ&quot;</span>, experiences.size());<br>            <br>            <span class="hljs-comment">// 2. Actor æ‰§è¡Œ</span><br>            <span class="hljs-type">ActorResult</span> <span class="hljs-variable">actorResult</span> <span class="hljs-operator">=</span> actor.execute(task, experiences);<br>            log.info(<span class="hljs-string">&quot;æ‰§è¡Œå®Œæˆ&quot;</span>);<br>            <br>            <span class="hljs-comment">// 3. Evaluator è¯„ä¼°</span><br>            <span class="hljs-type">EvaluationResult</span> <span class="hljs-variable">evalResult</span> <span class="hljs-operator">=</span> evaluator.evaluateWithLLM(<br>                task, actorResult.getExecution()<br>            );<br>            log.info(<span class="hljs-string">&quot;è¯„ä¼°å¾—åˆ†: &#123;&#125;&quot;</span>, evalResult.getScore());<br>            <br>            <span class="hljs-comment">// è®°å½•æœ¬æ¬¡å°è¯•</span><br>            attempts.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AttemptRecord</span>(attempt, actorResult, evalResult));<br>            <br>            <span class="hljs-comment">// 4. æ£€æŸ¥æ˜¯å¦æˆåŠŸ</span><br>            <span class="hljs-keyword">if</span> (evalResult.isSuccess() || evalResult.getScore() &gt;= SUCCESS_THRESHOLD) &#123;<br>                log.info(<span class="hljs-string">&quot;âœ… ä»»åŠ¡æˆåŠŸå®Œæˆ&quot;</span>);<br>                <br>                <span class="hljs-comment">// æˆåŠŸä¹Ÿå¯ä»¥æ€»ç»“ç»éªŒï¼ˆå¯é€‰ï¼‰</span><br>                <span class="hljs-keyword">if</span> (evalResult.getScore() == <span class="hljs-number">100</span>) &#123;<br>                    saveSuccessExperience(task, actorResult);<br>                &#125;<br>                <br>                memory.clearShortTerm();<br>                <span class="hljs-keyword">return</span> ReflexionResponse.success(<br>                    actorResult.getExecution(), attempts<br>                );<br>            &#125;<br>            <br>            <span class="hljs-comment">// 5. Self-Reflection åæ€</span><br>            log.info(<span class="hljs-string">&quot;å¼€å§‹åæ€...&quot;</span>);<br>            <span class="hljs-type">ReflectionResult</span> <span class="hljs-variable">reflection</span> <span class="hljs-operator">=</span> selfReflection.reflect(<br>                ReflectionInput.builder()<br>                    .task(task)<br>                    .executionTrace(actorResult.getThinking())<br>                    .result(actorResult.getExecution())<br>                    .evaluationFeedback(evalResult.getOverallFeedback())<br>                    .build()<br>            );<br>            <br>            log.info(<span class="hljs-string">&quot;åæ€ç»“æœ: &#123;&#125;&quot;</span>, reflection.getLessonsLearned());<br>            <br>            <span class="hljs-comment">// 6. å­˜å‚¨ç»éªŒ</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">experience</span> <span class="hljs-operator">=</span> reflection.toExperienceText();<br>            memory.addShortTerm(experience);<br>            <br>            <span class="hljs-comment">// å¦‚æœæ˜¯æœ‰ä»·å€¼çš„ç»éªŒï¼Œå­˜å…¥é•¿æœŸè®°å¿†</span><br>            <span class="hljs-keyword">if</span> (reflection.getConfidence() &gt; <span class="hljs-number">70</span>) &#123;<br>                memory.addLongTerm(experience, classifyTask(task));<br>            &#125;<br>        &#125;<br>        <br>        log.warn(<span class="hljs-string">&quot;âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä»»åŠ¡æœªèƒ½æˆåŠŸå®Œæˆ&quot;</span>);<br>        memory.clearShortTerm();<br>        <br>        <span class="hljs-keyword">return</span> ReflexionResponse.failure(<br>            attempts.get(attempts.size() - <span class="hljs-number">1</span>).getActorResult().getExecution(),<br>            attempts<br>        );<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">classifyTask</span><span class="hljs-params">(String task)</span> &#123;<br>        <span class="hljs-comment">// ç®€å•çš„ä»»åŠ¡åˆ†ç±»é€»è¾‘</span><br>        <span class="hljs-keyword">if</span> (task.contains(<span class="hljs-string">&quot;ä»£ç &quot;</span>) || task.contains(<span class="hljs-string">&quot;å®ç°&quot;</span>) || task.contains(<span class="hljs-string">&quot;å‡½æ•°&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;coding&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (task.contains(<span class="hljs-string">&quot;åˆ†æ&quot;</span>) || task.contains(<span class="hljs-string">&quot;è§£é‡Š&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;analysis&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;general&quot;</span>;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveSuccessExperience</span><span class="hljs-params">(String task, ActorResult result)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">experience</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;æˆåŠŸç»éªŒï¼šä»»åŠ¡ã€Œ%sã€çš„æœ‰æ•ˆè§£å†³æ–¹æ¡ˆæ˜¯ï¼š%s&quot;</span><br>            .formatted(task, result.getThinking());<br>        memory.addLongTerm(experience, classifyTask(task));<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AttemptRecord</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> attemptNumber;<br>    <span class="hljs-keyword">private</span> ActorResult actorResult;<br>    <span class="hljs-keyword">private</span> EvaluationResult evaluationResult;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflexionResponse</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> success;<br>    <span class="hljs-keyword">private</span> String result;<br>    <span class="hljs-keyword">private</span> List&lt;AttemptRecord&gt; attempts;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> totalAttempts;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ReflexionResponse <span class="hljs-title function_">success</span><span class="hljs-params">(String result, List&lt;AttemptRecord&gt; attempts)</span> &#123;<br>        <span class="hljs-type">ReflexionResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReflexionResponse</span>();<br>        response.success = <span class="hljs-literal">true</span>;<br>        response.result = result;<br>        response.attempts = attempts;<br>        response.totalAttempts = attempts.size();<br>        <span class="hljs-keyword">return</span> response;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ReflexionResponse <span class="hljs-title function_">failure</span><span class="hljs-params">(String result, List&lt;AttemptRecord&gt; attempts)</span> &#123;<br>        <span class="hljs-type">ReflexionResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReflexionResponse</span>();<br>        response.success = <span class="hljs-literal">false</span>;<br>        response.result = result;<br>        response.attempts = attempts;<br>        response.totalAttempts = attempts.size();<br>        <span class="hljs-keyword">return</span> response;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-2-Controller-å±‚"><a href="#3-2-Controller-å±‚" class="headerlink" title="3.2 Controller å±‚"></a>3.2 Controller å±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/api/reflexion&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflexionController</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReflexionAgent reflexionAgent;<br>    <br>    <span class="hljs-meta">@PostMapping(&quot;/execute&quot;)</span><br>    <span class="hljs-keyword">public</span> ReflexionResponse <span class="hljs-title function_">execute</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> TaskRequest request)</span> &#123;<br>        <span class="hljs-keyword">return</span> reflexionAgent.execute(request.getTask());<br>    &#125;<br>    <br>    <span class="hljs-meta">@GetMapping(&quot;/memory/stats&quot;)</span><br>    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getMemoryStats</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// è¿”å›è®°å¿†ç»Ÿè®¡ä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> Map.of(<br>            <span class="hljs-string">&quot;shortTermCount&quot;</span>, memory.getShortTermMemory().size(),<br>            <span class="hljs-string">&quot;longTermCount&quot;</span>, memory.getLongTermCount()<br>        );<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskRequest</span> &#123;<br>    <span class="hljs-keyword">private</span> String task;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="å››ã€å®æˆ˜æ¡ˆä¾‹"><a href="#å››ã€å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="å››ã€å®æˆ˜æ¡ˆä¾‹"></a>å››ã€å®æˆ˜æ¡ˆä¾‹</h2><h3 id="4-1-ä»£ç ç”Ÿæˆä»»åŠ¡"><a href="#4-1-ä»£ç ç”Ÿæˆä»»åŠ¡" class="headerlink" title="4.1 ä»£ç ç”Ÿæˆä»»åŠ¡"></a>4.1 ä»£ç ç”Ÿæˆä»»åŠ¡</h3><p><strong>ä»»åŠ¡</strong>ï¼šâ€ç”¨ Java å®ç°ä¸€ä¸ª LRU ç¼“å­˜ï¼Œæ”¯æŒ get å’Œ put æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ O(1)â€</p><h4 id="ç¬¬-1-æ¬¡å°è¯•"><a href="#ç¬¬-1-æ¬¡å°è¯•" class="headerlink" title="ç¬¬ 1 æ¬¡å°è¯•"></a>ç¬¬ 1 æ¬¡å°è¯•</h4><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs processing">Actor è¾“å‡º:<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUCache</span> &#123;<br>    <span class="hljs-keyword">private</span> Map&lt;Integer, Integer&gt; cache;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> capacity;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LRUCache</span>(<span class="hljs-type">int</span> capacity) &#123;<br>        <span class="hljs-variable">this</span>.<span class="hljs-property">cache</span> = <span class="hljs-keyword">new </span><span class="hljs-class title_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-variable">this</span>.<span class="hljs-property">capacity</span> = capacity;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-built_in">get</span>(<span class="hljs-type">int</span> <span class="hljs-built_in">key</span>) &#123;<br>        <span class="hljs-keyword">return</span> cache.<span class="hljs-property">getOrDefault</span>(<span class="hljs-built_in">key</span>, <span class="hljs-number">-1</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span>(<span class="hljs-type">int</span> <span class="hljs-built_in">key</span>, <span class="hljs-type">int</span> value) &#123;<br>        <span class="hljs-keyword">if</span> (cache.<span class="hljs-property">size</span>() &gt;= capacity) &#123;<br>            <span class="hljs-comment">// åˆ é™¤æœ€æ—§çš„ï¼Ÿä½† HashMap æ— åº...</span><br>            cache.<span class="hljs-property">remove</span>(cache.<span class="hljs-property">keySet</span>().<span class="hljs-property">iterator</span>().<span class="hljs-property">next</span>());<br>        &#125;<br>        cache.<span class="hljs-property">put</span>(<span class="hljs-built_in">key</span>, value);<br>    &#125;<br>&#125;<br><br>Evaluator åé¦ˆ:<br>&#123;<br>  <span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-string">&quot;score&quot;</span>: <span class="hljs-number">40</span>,<br>  <span class="hljs-string">&quot;specific_issues&quot;</span>: [<br>    <span class="hljs-string">&quot;HashMap æ— æ³•ä¿è¯ LRU é¡ºåº&quot;</span>,<br>    <span class="hljs-string">&quot;åˆ é™¤çš„ä¸ä¸€å®šæ˜¯æœ€ä¹…æœªä½¿ç”¨çš„å…ƒç´ &quot;</span>,<br>    <span class="hljs-string">&quot;get æ“ä½œæ²¡æœ‰æ›´æ–°è®¿é—®é¡ºåº&quot;</span><br>  ]<br>&#125;<br><br>Self-Reflection:<br>&#123;<br>  <span class="hljs-string">&quot;problem_diagnosis&quot;</span>: <span class="hljs-string">&quot;ä½¿ç”¨äº†æ™®é€š HashMapï¼Œæ— æ³•ç»´æŠ¤è®¿é—®é¡ºåº&quot;</span>,<br>  <span class="hljs-string">&quot;root_cause&quot;</span>: <span class="hljs-string">&quot;æ²¡æœ‰è€ƒè™‘ LRU éœ€è¦è®°å½•è®¿é—®é¡ºåºçš„ç‰¹æ€§&quot;</span>,<br>  <span class="hljs-string">&quot;lessons_learned&quot;</span>: [<br>    <span class="hljs-string">&quot;LRU ç¼“å­˜éœ€è¦èƒ½è®°å½•è®¿é—®é¡ºåºçš„æ•°æ®ç»“æ„&quot;</span>,<br>    <span class="hljs-string">&quot;å¯ä»¥ä½¿ç”¨ LinkedHashMap æˆ–è‡ªå·±å®ç°åŒå‘é“¾è¡¨ + HashMap&quot;</span><br>  ],<br>  <span class="hljs-string">&quot;improvement_plan&quot;</span>: <span class="hljs-string">&quot;ä½¿ç”¨ LinkedHashMap å¹¶é‡å†™ removeEldestEntry æ–¹æ³•&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç¬¬-2-æ¬¡å°è¯•"><a href="#ç¬¬-2-æ¬¡å°è¯•" class="headerlink" title="ç¬¬ 2 æ¬¡å°è¯•"></a>ç¬¬ 2 æ¬¡å°è¯•</h4><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs aspectj">Actor è¾“å‡ºï¼ˆå¸¦ç»éªŒï¼‰:<br><span class="hljs-keyword">public</span> class LRUCache <span class="hljs-keyword">extends</span> LinkedHashMap&lt;Integer, Integer&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> capacity;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">LRUCache</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(capacity, <span class="hljs-number">0.75</span>f, <span class="hljs-keyword">true</span>); <span class="hljs-comment">// true è¡¨ç¤ºæŒ‰è®¿é—®é¡ºåº</span><br>        <span class="hljs-keyword">this</span>.capacity = capacity;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key)</span> </span>&#123;<br>        <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.<span class="hljs-title">getOrDefault</span><span class="hljs-params">(key, <span class="hljs-number">-1</span>)</span></span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key, <span class="hljs-keyword">int</span> value)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>.put(key, value);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">removeEldestEntry</span><span class="hljs-params">(Map.Entry eldest)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> size() &gt; capacity;<br>    &#125;<br>&#125;<br><br>Evaluator åé¦ˆ:<br>&#123;<br>  <span class="hljs-string">&quot;success&quot;</span>: <span class="hljs-keyword">true</span>,<br>  <span class="hljs-string">&quot;score&quot;</span>: 95,<br>  <span class="hljs-string">&quot;overall_feedback&quot;</span>: <span class="hljs-string">&quot;æ­£ç¡®å®ç°äº† LRU ç¼“å­˜ï¼Œä½¿ç”¨ LinkedHashMap ç®€æ´é«˜æ•ˆ&quot;</span><br>&#125;<br><br>âœ… æˆåŠŸå®Œæˆ<br></code></pre></td></tr></table></figure><h3 id="4-2-æ•°æ®åˆ†æä»»åŠ¡"><a href="#4-2-æ•°æ®åˆ†æä»»åŠ¡" class="headerlink" title="4.2 æ•°æ®åˆ†æä»»åŠ¡"></a>4.2 æ•°æ®åˆ†æä»»åŠ¡</h3><p><strong>ä»»åŠ¡</strong>ï¼šâ€åˆ†æè¿™æ®µ SQL çš„æ€§èƒ½é—®é¢˜å¹¶ç»™å‡ºä¼˜åŒ–å»ºè®®â€</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders o<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> o.user_id <span class="hljs-operator">=</span> u.id<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> products p <span class="hljs-keyword">ON</span> o.product_id <span class="hljs-operator">=</span> p.id<br><span class="hljs-keyword">WHERE</span> o.created_at <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;2024-01-01&#x27;</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> o.created_at <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure><h4 id="åæ€æ”¹è¿›è¿‡ç¨‹"><a href="#åæ€æ”¹è¿›è¿‡ç¨‹" class="headerlink" title="åæ€æ”¹è¿›è¿‡ç¨‹"></a>åæ€æ”¹è¿›è¿‡ç¨‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">ç¬¬ <span class="hljs-number">1</span> æ¬¡ï¼šåªå…³æ³¨äº†ç´¢å¼•é—®é¢˜<br>ç»éªŒï¼š<span class="hljs-keyword">SQL</span> ä¼˜åŒ–è¦å…¨é¢è€ƒè™‘ç´¢å¼•ã€æŸ¥è¯¢å­—æ®µã€è¿æ¥æ–¹å¼ç­‰<br><br>ç¬¬ <span class="hljs-number">2</span> æ¬¡ï¼šå¢åŠ äº†å­—æ®µé€‰æ‹©å»ºè®®<br>ç»éªŒï¼š<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> æ˜¯å¸¸è§æ€§èƒ½é—®é¢˜ï¼Œåº”æ˜ç¡®æŒ‡å‡º<br><br>ç¬¬ <span class="hljs-number">3</span> æ¬¡ï¼šå®Œæ•´åˆ†æ<br><span class="hljs-operator">-</span> ç´¢å¼•å»ºè®®ï¼šcreated_at, user_id, product_id<br><span class="hljs-operator">-</span> æŸ¥è¯¢ä¼˜åŒ–ï¼šé¿å… <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><span class="hljs-operator">-</span> è¿æ¥ä¼˜åŒ–ï¼šè€ƒè™‘æ˜¯å¦éœ€è¦ <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span><br><span class="hljs-operator">-</span> åˆ†é¡µå»ºè®®ï¼šå¤§æ•°æ®é‡éœ€è¦åˆ†é¡µ<br><br>âœ… æˆåŠŸ<br></code></pre></td></tr></table></figure><hr><h2 id="äº”ã€è¿›é˜¶ä¼˜åŒ–"><a href="#äº”ã€è¿›é˜¶ä¼˜åŒ–" class="headerlink" title="äº”ã€è¿›é˜¶ä¼˜åŒ–"></a>äº”ã€è¿›é˜¶ä¼˜åŒ–</h2><h3 id="5-1-åˆ†å±‚åæ€"><a href="#5-1-åˆ†å±‚åæ€" class="headerlink" title="5.1 åˆ†å±‚åæ€"></a>5.1 åˆ†å±‚åæ€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HierarchicalReflection</span> &#123;<br>    <br>    <span class="hljs-comment">// æµ…å±‚åæ€ï¼šå¿«é€Ÿä¿®å¤</span><br>    <span class="hljs-keyword">public</span> QuickFix <span class="hljs-title function_">shallowReflect</span><span class="hljs-params">(EvaluationResult eval)</span> &#123;<br>        <span class="hljs-comment">// é’ˆå¯¹å…·ä½“é”™è¯¯çš„å¿«é€Ÿä¿®å¤å»ºè®®</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// æ·±å±‚åæ€ï¼šæ ¹å› åˆ†æ</span><br>    <span class="hljs-keyword">public</span> DeepAnalysis <span class="hljs-title function_">deepReflect</span><span class="hljs-params">(List&lt;AttemptRecord&gt; attempts)</span> &#123;<br>        <span class="hljs-comment">// å¤šæ¬¡å¤±è´¥åçš„æ·±åº¦åˆ†æ</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// å…ƒåæ€ï¼šåæ€ç­–ç•¥æœ¬èº«</span><br>    <span class="hljs-keyword">public</span> MetaReflection <span class="hljs-title function_">metaReflect</span><span class="hljs-params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;<br>        <span class="hljs-comment">// åæ€çš„åæ€ï¼šåæ€ç­–ç•¥æ˜¯å¦æœ‰æ•ˆ</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-2-ç»éªŒè’¸é¦"><a href="#5-2-ç»éªŒè’¸é¦" class="headerlink" title="5.2 ç»éªŒè’¸é¦"></a>5.2 ç»éªŒè’¸é¦</h3><p>å®šæœŸå°†ç¢ç‰‡åŒ–ç»éªŒæ•´åˆä¸ºç»“æ„åŒ–çŸ¥è¯†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Scheduled(cron = &quot;0 0 2 * * ?&quot;)</span> <span class="hljs-comment">// æ¯å¤©å‡Œæ™¨2ç‚¹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">distillExperiences</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1. è·å–æœ€è¿‘çš„ç»éªŒ</span><br>    List&lt;Document&gt; recentExperiences = memory.getRecentExperiences(<span class="hljs-number">100</span>);<br>    <br>    <span class="hljs-comment">// 2. èšç±»ç›¸ä¼¼ç»éªŒ</span><br>    Map&lt;String, List&lt;Document&gt;&gt; clusters = clusterExperiences(recentExperiences);<br>    <br>    <span class="hljs-comment">// 3. ä¸ºæ¯ä¸ªèšç±»ç”Ÿæˆæ€»ç»“</span><br>    <span class="hljs-keyword">for</span> (Map.Entry&lt;String, List&lt;Document&gt;&gt; entry : clusters.entrySet()) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">summary</span> <span class="hljs-operator">=</span> llm.summarize(entry.getValue());<br>        memory.addDistilledKnowledge(entry.getKey(), summary);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-3-ç»éªŒè¿ç§»"><a href="#5-3-ç»éªŒè¿ç§»" class="headerlink" title="5.3 ç»éªŒè¿ç§»"></a>5.3 ç»éªŒè¿ç§»</h3><p>è·¨ä»»åŠ¡ç±»å‹è¿ç§»é€šç”¨ç»éªŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">transferExperiences</span><span class="hljs-params">(String newTask)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">taskType</span> <span class="hljs-operator">=</span> classifyTask(newTask);<br>    <br>    <span class="hljs-comment">// è·å–åŒç±»å‹ä»»åŠ¡ç»éªŒ</span><br>    List&lt;String&gt; sameTypeExp = memory.getByTaskType(taskType);<br>    <br>    <span class="hljs-comment">// è·å–é€šç”¨ç»éªŒï¼ˆé€‚ç”¨äºæ‰€æœ‰ä»»åŠ¡ï¼‰</span><br>    List&lt;String&gt; universalExp = memory.getUniversalExperiences();<br>    <br>    <span class="hljs-comment">// æ™ºèƒ½ç­›é€‰å¯è¿ç§»çš„ç»éªŒ</span><br>    <span class="hljs-keyword">return</span> filterTransferableExperiences(newTask, sameTypeExp, universalExp);<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="å…­ã€æœ€ä½³å®è·µ"><a href="#å…­ã€æœ€ä½³å®è·µ" class="headerlink" title="å…­ã€æœ€ä½³å®è·µ"></a>å…­ã€æœ€ä½³å®è·µ</h2><h3 id="6-1-è¯„ä¼°å™¨è®¾è®¡"><a href="#6-1-è¯„ä¼°å™¨è®¾è®¡" class="headerlink" title="6.1 è¯„ä¼°å™¨è®¾è®¡"></a>6.1 è¯„ä¼°å™¨è®¾è®¡</h3><table><thead><tr><th>ä»»åŠ¡ç±»å‹</th><th>æ¨èè¯„ä¼°æ–¹å¼</th></tr></thead><tbody><tr><td>ä»£ç ç”Ÿæˆ</td><td>æµ‹è¯•ç”¨ä¾‹ + é™æ€åˆ†æ</td></tr><tr><td>æ–‡æœ¬å†™ä½œ</td><td>LLM è¯„ä¼° + è§„åˆ™æ£€æŸ¥</td></tr><tr><td>æ•°å­¦è®¡ç®—</td><td>ç»“æœéªŒè¯</td></tr><tr><td>ä¿¡æ¯æ£€ç´¢</td><td>äººå·¥æŠ½æ£€ + LLM è¯„ä¼°</td></tr></tbody></table><h3 id="6-2-åæ€æ·±åº¦æ§åˆ¶"><a href="#6-2-åæ€æ·±åº¦æ§åˆ¶" class="headerlink" title="6.2 åæ€æ·±åº¦æ§åˆ¶"></a>6.2 åæ€æ·±åº¦æ§åˆ¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ ¹æ®å¤±è´¥æ¬¡æ•°è°ƒæ•´åæ€æ·±åº¦</span><br><span class="hljs-keyword">public</span> ReflectionResult <span class="hljs-title function_">adaptiveReflect</span><span class="hljs-params">(<span class="hljs-type">int</span> attemptCount, ...)</span> &#123;<br>    <span class="hljs-keyword">if</span> (attemptCount == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">return</span> quickReflect(...);  <span class="hljs-comment">// å¿«é€Ÿåæ€</span><br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (attemptCount == <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-keyword">return</span> normalReflect(...); <span class="hljs-comment">// æ ‡å‡†åæ€</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> deepReflect(...);   <span class="hljs-comment">// æ·±åº¦åæ€</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-3-é¿å…è¿‡åº¦åæ€"><a href="#6-3-é¿å…è¿‡åº¦åæ€" class="headerlink" title="6.3 é¿å…è¿‡åº¦åæ€"></a>6.3 é¿å…è¿‡åº¦åæ€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ£€æµ‹æ˜¯å¦é™·å…¥æ— æ•ˆå¾ªç¯</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isStuck</span><span class="hljs-params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;<br>    <span class="hljs-keyword">if</span> (reflections.size() &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <br>    <span class="hljs-comment">// æ£€æŸ¥æœ€è¿‘ä¸¤æ¬¡åæ€æ˜¯å¦ç›¸ä¼¼åº¦è¿‡é«˜</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">last</span> <span class="hljs-operator">=</span> reflections.get(reflections.size() - <span class="hljs-number">1</span>).toExperienceText();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> reflections.get(reflections.size() - <span class="hljs-number">2</span>).toExperienceText();<br>    <br>    <span class="hljs-keyword">return</span> calculateSimilarity(last, prev) &gt; <span class="hljs-number">0.8</span>;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="ä¸ƒã€è¿­ä»£æ§åˆ¶ä¸å¾ªç¯é¿å…"><a href="#ä¸ƒã€è¿­ä»£æ§åˆ¶ä¸å¾ªç¯é¿å…" class="headerlink" title="ä¸ƒã€è¿­ä»£æ§åˆ¶ä¸å¾ªç¯é¿å…"></a>ä¸ƒã€è¿­ä»£æ§åˆ¶ä¸å¾ªç¯é¿å…</h2><h3 id="7-1-è¿­ä»£æ¬¡æ•°æ§åˆ¶æœºåˆ¶"><a href="#7-1-è¿­ä»£æ¬¡æ•°æ§åˆ¶æœºåˆ¶" class="headerlink" title="7.1 è¿­ä»£æ¬¡æ•°æ§åˆ¶æœºåˆ¶"></a>7.1 è¿­ä»£æ¬¡æ•°æ§åˆ¶æœºåˆ¶</h3><h4 id="åŸºç¡€æ§åˆ¶ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°"><a href="#åŸºç¡€æ§åˆ¶ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°" class="headerlink" title="åŸºç¡€æ§åˆ¶ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°"></a>åŸºç¡€æ§åˆ¶ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflexionAgent</span> &#123;<br>    <br>    <span class="hljs-comment">// æ ¸å¿ƒæ§åˆ¶å‚æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_RETRIES</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;           <span class="hljs-comment">// æœ€å¤šé‡è¯• 3 æ¬¡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SUCCESS_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">80</span>;    <span class="hljs-comment">// æˆåŠŸé˜ˆå€¼ 80 åˆ†</span><br>    <br>    <span class="hljs-keyword">public</span> ReflexionResponse <span class="hljs-title function_">execute</span><span class="hljs-params">(String task)</span> &#123;<br>        List&lt;AttemptRecord&gt; attempts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <br>        <span class="hljs-comment">// å…³é”®ï¼šfor å¾ªç¯é™åˆ¶è¿­ä»£æ¬¡æ•°</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;<br>            log.info(<span class="hljs-string">&quot;=== ç¬¬ &#123;&#125; æ¬¡å°è¯• ===&quot;</span>, attempt);<br>            <br>            <span class="hljs-comment">// ... æ‰§è¡Œé€»è¾‘ ...</span><br>            <br>            <span class="hljs-comment">// æˆåŠŸåˆ™ç«‹å³è¿”å›ï¼Œä¸ç»§ç»­è¿­ä»£</span><br>            <span class="hljs-keyword">if</span> (evalResult.isSuccess() || evalResult.getScore() &gt;= SUCCESS_THRESHOLD) &#123;<br>                log.info(<span class="hljs-string">&quot;âœ… ä»»åŠ¡æˆåŠŸå®Œæˆ&quot;</span>);<br>                <span class="hljs-keyword">return</span> ReflexionResponse.success(result, attempts);<br>            &#125;<br>            <br>            <span class="hljs-comment">// å¤±è´¥åˆ™ç»§ç»­ä¸‹ä¸€æ¬¡è¿­ä»£</span><br>        &#125;<br>        <br>        <span class="hljs-comment">// è¾¾åˆ°æœ€å¤§æ¬¡æ•°åè¿”å›å¤±è´¥</span><br>        log.warn(<span class="hljs-string">&quot;âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä»»åŠ¡æœªèƒ½æˆåŠŸå®Œæˆ&quot;</span>);<br>        <span class="hljs-keyword">return</span> ReflexionResponse.failure(lastResult, attempts);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(MAX_RETRIES)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(MAX_RETRIES)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>for</code> å¾ªç¯è€Œä¸æ˜¯ <code>while</code>ï¼Œæ˜ç¡®é™åˆ¶è¿­ä»£æ¬¡æ•°</li><li>æˆåŠŸæ—¶ç«‹å³è¿”å›ï¼Œä¸æµªè´¹èµ„æº</li><li>è¾¾åˆ°æœ€å¤§æ¬¡æ•°è‡ªåŠ¨åœæ­¢ï¼Œä¸ä¼šæ— é™å¾ªç¯</li></ul><h4 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h4><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>å»ºè®®å€¼</th><th>å½±å“</th></tr></thead><tbody><tr><td><strong>MAX_RETRIES</strong></td><td>æœ€å¤§é‡è¯•æ¬¡æ•°</td><td>3-5</td><td>æ¬¡æ•°è¶Šå¤šï¼ŒæˆåŠŸç‡è¶Šé«˜ä½†æˆæœ¬è¶Šé«˜</td></tr><tr><td><strong>SUCCESS_THRESHOLD</strong></td><td>æˆåŠŸè¯„åˆ†é˜ˆå€¼</td><td>80-90</td><td>é˜ˆå€¼è¶Šé«˜ï¼Œè¦æ±‚è¶Šä¸¥æ ¼</td></tr><tr><td><strong>MAX_REFLECTION_DEPTH</strong></td><td>æœ€å¤§åæ€æ·±åº¦</td><td>2-3</td><td>æ§åˆ¶åæ€çš„è¯¦ç»†ç¨‹åº¦</td></tr></tbody></table><h3 id="7-2-å¤šå±‚æ¬¡çš„å¾ªç¯æ§åˆ¶"><a href="#7-2-å¤šå±‚æ¬¡çš„å¾ªç¯æ§åˆ¶" class="headerlink" title="7.2 å¤šå±‚æ¬¡çš„å¾ªç¯æ§åˆ¶"></a>7.2 å¤šå±‚æ¬¡çš„å¾ªç¯æ§åˆ¶</h3><h4 id="æ–¹å¼1ï¼šåŸºäºæˆåŠŸç‡çš„åŠ¨æ€æ§åˆ¶"><a href="#æ–¹å¼1ï¼šåŸºäºæˆåŠŸç‡çš„åŠ¨æ€æ§åˆ¶" class="headerlink" title="æ–¹å¼1ï¼šåŸºäºæˆåŠŸç‡çš„åŠ¨æ€æ§åˆ¶"></a>æ–¹å¼1ï¼šåŸºäºæˆåŠŸç‡çš„åŠ¨æ€æ§åˆ¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdaptiveReflexionAgent</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_RETRIES</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SUCCESS_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">MIN_IMPROVEMENT_RATE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.05</span>;  <span class="hljs-comment">// æœ€å°æ”¹è¿›ç‡ 5%</span><br>    <br>    <span class="hljs-keyword">public</span> ReflexionResponse <span class="hljs-title function_">execute</span><span class="hljs-params">(String task)</span> &#123;<br>        List&lt;AttemptRecord&gt; attempts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">lastScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;<br>            <span class="hljs-comment">// ... æ‰§è¡Œé€»è¾‘ ...</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">currentScore</span> <span class="hljs-operator">=</span> evalResult.getScore();<br>            <br>            <span class="hljs-comment">// 1. æˆåŠŸåˆ™è¿”å›</span><br>            <span class="hljs-keyword">if</span> (currentScore &gt;= SUCCESS_THRESHOLD) &#123;<br>                log.info(<span class="hljs-string">&quot;âœ… ä»»åŠ¡æˆåŠŸ&quot;</span>);<br>                <span class="hljs-keyword">return</span> ReflexionResponse.success(result, attempts);<br>            &#125;<br>            <br>            <span class="hljs-comment">// 2. æ£€æŸ¥æ˜¯å¦æœ‰æ”¹è¿›</span><br>            <span class="hljs-type">double</span> <span class="hljs-variable">improvementRate</span> <span class="hljs-operator">=</span> (<span class="hljs-type">double</span>)(currentScore - lastScore) / lastScore;<br>            <span class="hljs-keyword">if</span> (attempt &gt; <span class="hljs-number">2</span> &amp;&amp; improvementRate &lt; MIN_IMPROVEMENT_RATE) &#123;<br>                log.warn(<span class="hljs-string">&quot;âš ï¸ æ”¹è¿›ä¸è¶³ &#123;&#125;%ï¼Œåœæ­¢è¿­ä»£&quot;</span>, MIN_IMPROVEMENT_RATE * <span class="hljs-number">100</span>);<br>                <span class="hljs-keyword">return</span> ReflexionResponse.failure(result, attempts);<br>            &#125;<br>            <br>            lastScore = currentScore;<br>        &#125;<br>        <br>        log.warn(<span class="hljs-string">&quot;âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°&quot;</span>);<br>        <span class="hljs-keyword">return</span> ReflexionResponse.failure(lastResult, attempts);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ€è·¯ï¼š</span><br><span class="hljs-comment">// ç¬¬1æ¬¡ï¼šå¾—åˆ† 40</span><br><span class="hljs-comment">// ç¬¬2æ¬¡ï¼šå¾—åˆ† 60ï¼ˆæ”¹è¿› 50%ï¼Œç»§ç»­ï¼‰</span><br><span class="hljs-comment">// ç¬¬3æ¬¡ï¼šå¾—åˆ† 65ï¼ˆæ”¹è¿› 8%ï¼Œç»§ç»­ï¼‰</span><br><span class="hljs-comment">// ç¬¬4æ¬¡ï¼šå¾—åˆ† 66ï¼ˆæ”¹è¿› 1.5% &lt; 5%ï¼Œåœæ­¢ï¼‰</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>ä¸ä»…é™åˆ¶æ¬¡æ•°ï¼Œè¿˜æ£€æŸ¥æ”¹è¿›å¹…åº¦</li><li>å¦‚æœè¿ç»­æ”¹è¿›ä¸è¶³ï¼Œæå‰åœæ­¢</li><li>é¿å…åœ¨æ— æ•ˆå¾ªç¯ä¸­æµªè´¹èµ„æº</li></ul><h4 id="æ–¹å¼2ï¼šåŸºäºåæ€ç›¸ä¼¼åº¦çš„æ§åˆ¶"><a href="#æ–¹å¼2ï¼šåŸºäºåæ€ç›¸ä¼¼åº¦çš„æ§åˆ¶" class="headerlink" title="æ–¹å¼2ï¼šåŸºäºåæ€ç›¸ä¼¼åº¦çš„æ§åˆ¶"></a>æ–¹å¼2ï¼šåŸºäºåæ€ç›¸ä¼¼åº¦çš„æ§åˆ¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartReflexionAgent</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_RETRIES</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">SIMILARITY_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.8</span>;  <span class="hljs-comment">// ç›¸ä¼¼åº¦é˜ˆå€¼</span><br>    <br>    <span class="hljs-keyword">public</span> ReflexionResponse <span class="hljs-title function_">execute</span><span class="hljs-params">(String task)</span> &#123;<br>        List&lt;AttemptRecord&gt; attempts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        List&lt;ReflectionResult&gt; reflections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;<br>            <span class="hljs-comment">// ... æ‰§è¡Œé€»è¾‘ ...</span><br>            <br>            <span class="hljs-keyword">if</span> (evalResult.isSuccess()) &#123;<br>                <span class="hljs-keyword">return</span> ReflexionResponse.success(result, attempts);<br>            &#125;<br>            <br>            <span class="hljs-comment">// åæ€</span><br>            <span class="hljs-type">ReflectionResult</span> <span class="hljs-variable">reflection</span> <span class="hljs-operator">=</span> selfReflection.reflect(input);<br>            reflections.add(reflection);<br>            <br>            <span class="hljs-comment">// æ£€æµ‹æ˜¯å¦é™·å…¥å¾ªç¯</span><br>            <span class="hljs-keyword">if</span> (isStuckInLoop(reflections)) &#123;<br>                log.warn(<span class="hljs-string">&quot;âš ï¸ æ£€æµ‹åˆ°æ— æ•ˆå¾ªç¯ï¼Œåœæ­¢è¿­ä»£&quot;</span>);<br>                <span class="hljs-keyword">return</span> ReflexionResponse.failure(result, attempts);<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> ReflexionResponse.failure(lastResult, attempts);<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ£€æµ‹æ˜¯å¦é™·å…¥å¾ªç¯</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isStuckInLoop</span><span class="hljs-params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;<br>        <span class="hljs-keyword">if</span> (reflections.size() &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        <br>        <span class="hljs-comment">// è·å–æœ€è¿‘ä¸¤æ¬¡åæ€</span><br>        <span class="hljs-type">ReflectionResult</span> <span class="hljs-variable">last</span> <span class="hljs-operator">=</span> reflections.get(reflections.size() - <span class="hljs-number">1</span>);<br>        <span class="hljs-type">ReflectionResult</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> reflections.get(reflections.size() - <span class="hljs-number">2</span>);<br>        <br>        <span class="hljs-comment">// è®¡ç®—ç›¸ä¼¼åº¦</span><br>        <span class="hljs-type">double</span> <span class="hljs-variable">similarity</span> <span class="hljs-operator">=</span> calculateSimilarity(<br>            last.toExperienceText(),<br>            prev.toExperienceText()<br>        );<br>        <br>        log.info(<span class="hljs-string">&quot;åæ€ç›¸ä¼¼åº¦: &#123;&#125;&quot;</span>, similarity);<br>        <br>        <span class="hljs-comment">// å¦‚æœç›¸ä¼¼åº¦è¿‡é«˜ï¼Œè¯´æ˜é™·å…¥å¾ªç¯</span><br>        <span class="hljs-keyword">return</span> similarity &gt; SIMILARITY_THRESHOLD;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> <span class="hljs-title function_">calculateSimilarity</span><span class="hljs-params">(String text1, String text2)</span> &#123;<br>        <span class="hljs-comment">// ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æˆ–ç¼–è¾‘è·ç¦»</span><br>        <span class="hljs-comment">// è¿™é‡Œç®€åŒ–å¤„ç†</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">commonChars</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">maxLen</span> <span class="hljs-operator">=</span> Math.max(text1.length(), text2.length());<br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : text1.toCharArray()) &#123;<br>            <span class="hljs-keyword">if</span> (text2.contains(String.valueOf(c))) &#123;<br>                commonChars++;<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> (<span class="hljs-type">double</span>) commonChars / maxLen;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ€è·¯ï¼š</span><br><span class="hljs-comment">// ç¬¬1æ¬¡åæ€ï¼šé—®é¢˜æ˜¯&quot;æ²¡æœ‰è€ƒè™‘è¾¹ç•Œæƒ…å†µ&quot;</span><br><span class="hljs-comment">// ç¬¬2æ¬¡åæ€ï¼šé—®é¢˜æ˜¯&quot;æ²¡æœ‰è€ƒè™‘è¾¹ç•Œæƒ…å†µ&quot;ï¼ˆç›¸ä¼¼åº¦ 95%ï¼‰</span><br><span class="hljs-comment">// â†’ æ£€æµ‹åˆ°å¾ªç¯ï¼Œåœæ­¢è¿­ä»£</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>ç›‘æµ‹åæ€å†…å®¹çš„ç›¸ä¼¼åº¦</li><li>å¦‚æœåæ€é‡å¤ï¼Œè¯´æ˜é™·å…¥æ­»å¾ªç¯</li><li>æå‰åœæ­¢é¿å…æµªè´¹èµ„æº</li></ul><h3 id="7-3-å¾ªç¯é£é™©è¯†åˆ«"><a href="#7-3-å¾ªç¯é£é™©è¯†åˆ«" class="headerlink" title="7.3 å¾ªç¯é£é™©è¯†åˆ«"></a>7.3 å¾ªç¯é£é™©è¯†åˆ«</h3><h4 id="å¸¸è§çš„æ— é™å¾ªç¯åœºæ™¯"><a href="#å¸¸è§çš„æ— é™å¾ªç¯åœºæ™¯" class="headerlink" title="å¸¸è§çš„æ— é™å¾ªç¯åœºæ™¯"></a>å¸¸è§çš„æ— é™å¾ªç¯åœºæ™¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// âŒ åœºæ™¯1ï¼šè¯„ä¼°æ ‡å‡†è¿‡é«˜</span><br><span class="hljs-comment">// é—®é¢˜ï¼šSUCCESS_THRESHOLD = 100ï¼ˆå®Œç¾ï¼‰</span><br><span class="hljs-comment">// ç»“æœï¼šæ°¸è¿œæ— æ³•æ»¡è¶³ï¼Œé™·å…¥å¾ªç¯</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SUCCESS_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;  <span class="hljs-comment">// ä¸ç°å®</span><br><br><span class="hljs-comment">// âœ… è§£å†³ï¼šè®¾ç½®åˆç†çš„é˜ˆå€¼</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SUCCESS_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">80</span>;   <span class="hljs-comment">// 80% å°±è®¤ä¸ºæˆåŠŸ</span><br><br><span class="hljs-comment">// âŒ åœºæ™¯2ï¼šåæ€æ²¡æœ‰äº§ç”Ÿæ–°çš„æ”¹è¿›æ–¹æ¡ˆ</span><br><span class="hljs-comment">// é—®é¢˜ï¼šæ¯æ¬¡åæ€éƒ½è¯´&quot;éœ€è¦æ›´ä»”ç»†&quot;ï¼Œä½†æ²¡æœ‰å…·ä½“æ”¹è¿›</span><br><span class="hljs-comment">// ç»“æœï¼šActor é‡å¤åŒæ ·çš„é”™è¯¯</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">reflect</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// åæ€ç»“æœï¼šéœ€è¦æ›´ä»”ç»†åœ°å¤„ç†</span><br>    <span class="hljs-comment">// æ”¹è¿›æ–¹æ¡ˆï¼šæ— ï¼ˆç©ºï¼‰</span><br>    <span class="hljs-comment">// â†’ ä¸‹æ¬¡è¿˜æ˜¯åŒæ ·çš„é”™è¯¯</span><br>&#125;<br><br><span class="hljs-comment">// âœ… è§£å†³ï¼šè¦æ±‚åæ€å¿…é¡»äº§ç”Ÿå…·ä½“çš„æ”¹è¿›æ–¹æ¡ˆ</span><br><span class="hljs-type">ReflectionResult</span> <span class="hljs-variable">reflection</span> <span class="hljs-operator">=</span> selfReflection.reflect(input);<br><span class="hljs-keyword">if</span> (reflection.getImprovementPlan() == <span class="hljs-literal">null</span> || <br>    reflection.getImprovementPlan().isEmpty()) &#123;<br>    log.warn(<span class="hljs-string">&quot;åæ€æœªäº§ç”Ÿæ”¹è¿›æ–¹æ¡ˆï¼Œåœæ­¢è¿­ä»£&quot;</span>);<br>    <span class="hljs-keyword">return</span> ReflexionResponse.failure(result, attempts);<br>&#125;<br><br><span class="hljs-comment">// âŒ åœºæ™¯3ï¼šç»éªŒæ²¡æœ‰è¢«æ­£ç¡®åº”ç”¨</span><br><span class="hljs-comment">// é—®é¢˜ï¼šActor æ”¶åˆ°ç»éªŒä½†æ²¡æœ‰çœŸæ­£åº”ç”¨</span><br><span class="hljs-comment">// ç»“æœï¼šæ¯æ¬¡éƒ½çŠ¯åŒæ ·çš„é”™è¯¯</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(String task, List&lt;String&gt; experiences)</span> &#123;<br>    <span class="hljs-comment">// è™½ç„¶æ”¶åˆ°äº†ç»éªŒï¼Œä½†åœ¨ Prompt ä¸­æ²¡æœ‰å¼ºè°ƒ</span><br>    <span class="hljs-comment">// â†’ Actor å¿½è§†äº†ç»éªŒ</span><br>&#125;<br><br><span class="hljs-comment">// âœ… è§£å†³ï¼šåœ¨ Prompt ä¸­å¼ºè°ƒç»éªŒçš„é‡è¦æ€§</span><br><span class="hljs-type">String</span> <span class="hljs-variable">prompt</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ## å†å²ç»éªŒæ•™è®­ï¼ˆå¿…é¡»å‚è€ƒï¼ï¼‰</span><br><span class="hljs-string">    %s</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    ## é‡è¦æç¤º</span><br><span class="hljs-string">    ä¸Šæ¬¡å¤±è´¥çš„åŸå› æ˜¯ï¼š%s</span><br><span class="hljs-string">    è¯·åŠ¡å¿…é¿å…é‡å¤è¿™ä¸ªé”™è¯¯ï¼</span><br><span class="hljs-string">    &quot;&quot;&quot;</span>.formatted(experiences, lastFailureReason);<br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>è¯†åˆ«å¾ªç¯çš„æ ¹æœ¬åŸå› </li><li>åœ¨è®¾è®¡é˜¶æ®µå°±é¢„é˜²å¾ªç¯</li><li>ä¸æ˜¯ç®€å•åœ°å¢åŠ é‡è¯•æ¬¡æ•°</li></ul><h3 id="7-4-å®Œæ•´çš„å¾ªç¯æ§åˆ¶å®ç°"><a href="#7-4-å®Œæ•´çš„å¾ªç¯æ§åˆ¶å®ç°" class="headerlink" title="7.4 å®Œæ•´çš„å¾ªç¯æ§åˆ¶å®ç°"></a>7.4 å®Œæ•´çš„å¾ªç¯æ§åˆ¶å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RobustReflexionAgent</span> &#123;<br>    <br>    <span class="hljs-comment">// å¤šå±‚æ¬¡çš„æ§åˆ¶å‚æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_RETRIES</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SUCCESS_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">MIN_IMPROVEMENT_RATE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.05</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">SIMILARITY_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.8</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_CONSECUTIVE_FAILURES</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <br>    <span class="hljs-keyword">public</span> ReflexionResponse <span class="hljs-title function_">execute</span><span class="hljs-params">(String task)</span> &#123;<br>        List&lt;AttemptRecord&gt; attempts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        List&lt;ReflectionResult&gt; reflections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">lastScore</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">consecutiveFailures</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;<br>            log.info(<span class="hljs-string">&quot;=== ç¬¬ &#123;&#125; æ¬¡å°è¯• ===&quot;</span>, attempt);<br>            <br>            <span class="hljs-comment">// 1. æ‰§è¡Œ</span><br>            <span class="hljs-type">ActorResult</span> <span class="hljs-variable">actorResult</span> <span class="hljs-operator">=</span> actor.execute(task, memory.recall(task, <span class="hljs-number">5</span>));<br>            <span class="hljs-type">EvaluationResult</span> <span class="hljs-variable">evalResult</span> <span class="hljs-operator">=</span> evaluator.evaluateWithLLM(task, actorResult.getExecution());<br>            <span class="hljs-type">int</span> <span class="hljs-variable">currentScore</span> <span class="hljs-operator">=</span> evalResult.getScore();<br>            <br>            attempts.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AttemptRecord</span>(attempt, actorResult, evalResult));<br>            <br>            <span class="hljs-comment">// 2. æ£€æŸ¥æˆåŠŸ</span><br>            <span class="hljs-keyword">if</span> (currentScore &gt;= SUCCESS_THRESHOLD) &#123;<br>                log.info(<span class="hljs-string">&quot;âœ… ä»»åŠ¡æˆåŠŸå®Œæˆ&quot;</span>);<br>                <span class="hljs-keyword">return</span> ReflexionResponse.success(actorResult.getExecution(), attempts);<br>            &#125;<br>            <br>            <span class="hljs-comment">// 3. æ£€æŸ¥æ”¹è¿›ç‡ï¼ˆä»ç¬¬2æ¬¡å¼€å§‹ï¼‰</span><br>            <span class="hljs-keyword">if</span> (attempt &gt; <span class="hljs-number">1</span>) &#123;<br>                <span class="hljs-type">double</span> <span class="hljs-variable">improvementRate</span> <span class="hljs-operator">=</span> (<span class="hljs-type">double</span>)(currentScore - lastScore) / Math.max(lastScore, <span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">if</span> (improvementRate &lt; MIN_IMPROVEMENT_RATE) &#123;<br>                    consecutiveFailures++;<br>                    log.warn(<span class="hljs-string">&quot;æ”¹è¿›ä¸è¶³: &#123;&#125;%&quot;</span>, improvementRate * <span class="hljs-number">100</span>);<br>                    <br>                    <span class="hljs-keyword">if</span> (consecutiveFailures &gt;= MAX_CONSECUTIVE_FAILURES) &#123;<br>                        log.warn(<span class="hljs-string">&quot;âš ï¸ è¿ç»­ &#123;&#125; æ¬¡æ”¹è¿›ä¸è¶³ï¼Œåœæ­¢è¿­ä»£&quot;</span>, MAX_CONSECUTIVE_FAILURES);<br>                        <span class="hljs-keyword">return</span> ReflexionResponse.failure(actorResult.getExecution(), attempts);<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    consecutiveFailures = <span class="hljs-number">0</span>;  <span class="hljs-comment">// é‡ç½®è®¡æ•°å™¨</span><br>                &#125;<br>            &#125;<br>            <br>            <span class="hljs-comment">// 4. åæ€</span><br>            <span class="hljs-type">ReflectionResult</span> <span class="hljs-variable">reflection</span> <span class="hljs-operator">=</span> selfReflection.reflect(<br>                ReflectionInput.builder()<br>                    .task(task)<br>                    .executionTrace(actorResult.getThinking())<br>                    .result(actorResult.getExecution())<br>                    .evaluationFeedback(evalResult.getOverallFeedback())<br>                    .build()<br>            );<br>            reflections.add(reflection);<br>            <br>            <span class="hljs-comment">// 5. æ£€æŸ¥æ˜¯å¦é™·å…¥å¾ªç¯</span><br>            <span class="hljs-keyword">if</span> (isStuckInLoop(reflections)) &#123;<br>                log.warn(<span class="hljs-string">&quot;âš ï¸ æ£€æµ‹åˆ°æ— æ•ˆå¾ªç¯ï¼Œåœæ­¢è¿­ä»£&quot;</span>);<br>                <span class="hljs-keyword">return</span> ReflexionResponse.failure(actorResult.getExecution(), attempts);<br>            &#125;<br>            <br>            <span class="hljs-comment">// 6. æ£€æŸ¥åæ€è´¨é‡</span><br>            <span class="hljs-keyword">if</span> (reflection.getImprovementPlan() == <span class="hljs-literal">null</span> || <br>                reflection.getImprovementPlan().isEmpty()) &#123;<br>                log.warn(<span class="hljs-string">&quot;âš ï¸ åæ€æœªäº§ç”Ÿæ”¹è¿›æ–¹æ¡ˆï¼Œåœæ­¢è¿­ä»£&quot;</span>);<br>                <span class="hljs-keyword">return</span> ReflexionResponse.failure(actorResult.getExecution(), attempts);<br>            &#125;<br>            <br>            <span class="hljs-comment">// 7. å­˜å‚¨ç»éªŒ</span><br>            memory.addShortTerm(reflection.toExperienceText());<br>            <span class="hljs-keyword">if</span> (reflection.getConfidence() &gt; <span class="hljs-number">70</span>) &#123;<br>                memory.addLongTerm(reflection.toExperienceText(), classifyTask(task));<br>            &#125;<br>            <br>            lastScore = currentScore;<br>        &#125;<br>        <br>        log.warn(<span class="hljs-string">&quot;âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°&quot;</span>);<br>        <span class="hljs-keyword">return</span> ReflexionResponse.failure(attempts.get(attempts.size() - <span class="hljs-number">1</span>).getActorResult().getExecution(), attempts);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isStuckInLoop</span><span class="hljs-params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;<br>        <span class="hljs-keyword">if</span> (reflections.size() &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        <br>        <span class="hljs-type">String</span> <span class="hljs-variable">last</span> <span class="hljs-operator">=</span> reflections.get(reflections.size() - <span class="hljs-number">1</span>).toExperienceText();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> reflections.get(reflections.size() - <span class="hljs-number">2</span>).toExperienceText();<br>        <br>        <span class="hljs-type">double</span> <span class="hljs-variable">similarity</span> <span class="hljs-operator">=</span> calculateSimilarity(last, prev);<br>        <span class="hljs-keyword">return</span> similarity &gt; SIMILARITY_THRESHOLD;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> <span class="hljs-title function_">calculateSimilarity</span><span class="hljs-params">(String text1, String text2)</span> &#123;<br>        <span class="hljs-comment">// å®ç°ç›¸ä¼¼åº¦è®¡ç®—</span><br>        <span class="hljs-comment">// å¯ä»¥ä½¿ç”¨ Levenshtein è·ç¦»ã€ä½™å¼¦ç›¸ä¼¼åº¦ç­‰</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ§åˆ¶æµç¨‹ï¼š</span><br><span class="hljs-comment">// ç¬¬1æ¬¡ï¼šå¾—åˆ† 40 â†’ ç»§ç»­</span><br><span class="hljs-comment">// ç¬¬2æ¬¡ï¼šå¾—åˆ† 60ï¼ˆæ”¹è¿› 50%ï¼‰â†’ ç»§ç»­</span><br><span class="hljs-comment">// ç¬¬3æ¬¡ï¼šå¾—åˆ† 62ï¼ˆæ”¹è¿› 3% &lt; 5%ï¼‰â†’ è®¡æ•°å™¨ +1</span><br><span class="hljs-comment">// ç¬¬4æ¬¡ï¼šå¾—åˆ† 63ï¼ˆæ”¹è¿› 1.6% &lt; 5%ï¼‰â†’ è®¡æ•°å™¨ +1ï¼ˆè¾¾åˆ° 2ï¼‰â†’ åœæ­¢</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li><strong>å¤šå±‚æ¬¡é˜²æŠ¤</strong>ï¼šæ¬¡æ•°é™åˆ¶ + æ”¹è¿›ç‡æ£€æŸ¥ + å¾ªç¯æ£€æµ‹ + åæ€è´¨é‡æ£€æŸ¥</li><li><strong>è¿ç»­å¤±è´¥è®¡æ•°</strong>ï¼šå…è®¸å¶å°”çš„æ”¹è¿›ä¸è¶³ï¼Œä½†è¿ç»­å¤šæ¬¡å°±åœæ­¢</li><li><strong>ç»¼åˆåˆ¤æ–­</strong>ï¼šä¸ä¾èµ–å•ä¸€æŒ‡æ ‡ï¼Œå¤šä¸ªæ¡ä»¶å…±åŒå†³å®šæ˜¯å¦ç»§ç»­</li></ul><h3 id="7-5-ç›‘æ§å’Œæ—¥å¿—"><a href="#7-5-ç›‘æ§å’Œæ—¥å¿—" class="headerlink" title="7.5 ç›‘æ§å’Œæ—¥å¿—"></a>7.5 ç›‘æ§å’Œæ—¥å¿—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoredReflexionAgent</span> &#123;<br>    <br>    <span class="hljs-keyword">public</span> ReflexionResponse <span class="hljs-title function_">execute</span><span class="hljs-params">(String task)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        List&lt;AttemptRecord&gt; attempts = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">attemptStart</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>                <br>                <span class="hljs-comment">// ... æ‰§è¡Œé€»è¾‘ ...</span><br>                <br>                <span class="hljs-type">long</span> <span class="hljs-variable">attemptDuration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - attemptStart;<br>                log.info(<span class="hljs-string">&quot;ç¬¬ &#123;&#125; æ¬¡å°è¯•è€—æ—¶: &#123;&#125;msï¼Œå¾—åˆ†: &#123;&#125;&quot;</span>, <br>                    attempt, attemptDuration, evalResult.getScore());<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">totalDuration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;<br>            log.info(<span class="hljs-string">&quot;ä»»åŠ¡æ€»è€—æ—¶: &#123;&#125;msï¼Œæ€»å°è¯•æ¬¡æ•°: &#123;&#125;&quot;</span>, totalDuration, attempts.size());<br>            <br>            <span class="hljs-comment">// è®°å½•ç»Ÿè®¡ä¿¡æ¯</span><br>            logStatistics(attempts);<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logStatistics</span><span class="hljs-params">(List&lt;AttemptRecord&gt; attempts)</span> &#123;<br>        <span class="hljs-keyword">if</span> (attempts.isEmpty()) <span class="hljs-keyword">return</span>;<br>        <br>        <span class="hljs-type">int</span> <span class="hljs-variable">maxScore</span> <span class="hljs-operator">=</span> attempts.stream()<br>            .mapToInt(a -&gt; a.getEvaluationResult().getScore())<br>            .max()<br>            .orElse(<span class="hljs-number">0</span>);<br>        <br>        <span class="hljs-type">double</span> <span class="hljs-variable">avgScore</span> <span class="hljs-operator">=</span> attempts.stream()<br>            .mapToInt(a -&gt; a.getEvaluationResult().getScore())<br>            .average()<br>            .orElse(<span class="hljs-number">0</span>);<br>        <br>        log.info(<span class="hljs-string">&quot;ç»Ÿè®¡ä¿¡æ¯ - æœ€é«˜åˆ†: &#123;&#125;ï¼Œå¹³å‡åˆ†: &#123;:.2f&#125;ï¼Œæ€»æ¬¡æ•°: &#123;&#125;&quot;</span>, <br>            maxScore, avgScore, attempts.size());<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š</span><br><span class="hljs-comment">// === ç¬¬ 1 æ¬¡å°è¯• ===</span><br><span class="hljs-comment">// ç¬¬ 1 æ¬¡å°è¯•è€—æ—¶: 2341msï¼Œå¾—åˆ†: 40</span><br><span class="hljs-comment">// === ç¬¬ 2 æ¬¡å°è¯• ===</span><br><span class="hljs-comment">// ç¬¬ 2 æ¬¡å°è¯•è€—æ—¶: 2156msï¼Œå¾—åˆ†: 65</span><br><span class="hljs-comment">// === ç¬¬ 3 æ¬¡å°è¯• ===</span><br><span class="hljs-comment">// ç¬¬ 3 æ¬¡å°è¯•è€—æ—¶: 2089msï¼Œå¾—åˆ†: 68</span><br><span class="hljs-comment">// âš ï¸ æ”¹è¿›ä¸è¶³: 4.6%ï¼Œåœæ­¢è¿­ä»£</span><br><span class="hljs-comment">// ç»Ÿè®¡ä¿¡æ¯ - æœ€é«˜åˆ†: 68ï¼Œå¹³å‡åˆ†: 57.67ï¼Œæ€»æ¬¡æ•°: 3</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>è®°å½•æ¯æ¬¡å°è¯•çš„è€—æ—¶å’Œå¾—åˆ†</li><li>ä¾¿äºåˆ†ææ€§èƒ½å’Œæ”¹è¿›æ•ˆæœ</li><li>å¸®åŠ©è°ƒæ•´æ§åˆ¶å‚æ•°</li></ul><hr><h2 id="ç›¸å…³ç¬”è®°"><a href="#ç›¸å…³ç¬”è®°" class="headerlink" title="ç›¸å…³ç¬”è®°"></a>ç›¸å…³ç¬”è®°</h2><ul><li>Agentæ¶æ„æ¨¡å¼è¯¦è§£</li><li>Prompt Engineeringè¯¦è§£</li><li>å¤§æ¨¡å‹å­¦ä¹ è·¯çº¿</li></ul>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Agent</tag>
      
      <tag>AI</tag>
      
      <tag>Reflexion</tag>
      
      <tag>è‡ªåæ€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸‰å…ƒç»„è¯¦è§£</title>
    <link href="/2026/01/12/%E4%B8%89%E5%85%83%E7%BB%84%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/12/%E4%B8%89%E5%85%83%E7%BB%84%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸‰å…ƒç»„è¯¦è§£"><a href="#ä¸‰å…ƒç»„è¯¦è§£" class="headerlink" title="ä¸‰å…ƒç»„è¯¦è§£"></a>ä¸‰å…ƒç»„è¯¦è§£</h1><h2 id="ä»€ä¹ˆæ˜¯ä¸‰å…ƒç»„"><a href="#ä»€ä¹ˆæ˜¯ä¸‰å…ƒç»„" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸‰å…ƒç»„"></a>ä»€ä¹ˆæ˜¯ä¸‰å…ƒç»„</h2><p>ä¸‰å…ƒç»„ï¼ˆTripleï¼‰æ˜¯ <strong>RDF å›¾æ•°æ®åº“</strong> ä¸­çš„åŸºæœ¬æ•°æ®å­˜å‚¨å•å…ƒï¼Œç”¨äºè¡¨è¾¾ä¸€ä¸ªå®Œæ•´çš„äº‹å®é™ˆè¿°ã€‚</p><h3 id="ä¸‰å…ƒç»„ç»„æˆ"><a href="#ä¸‰å…ƒç»„ç»„æˆ" class="headerlink" title="ä¸‰å…ƒç»„ç»„æˆ"></a>ä¸‰å…ƒç»„ç»„æˆ</h3><table><thead><tr><th>ç»„æˆéƒ¨åˆ†</th><th>è‹±æ–‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ä¸»è¯­</strong></td><td>Subject</td><td>è¢«æè¿°çš„å®ä½“æˆ–èµ„æº</td></tr><tr><td><strong>è°“è¯­</strong></td><td>Predicate</td><td>å…³ç³»æˆ–å±æ€§</td></tr><tr><td><strong>å®¾è¯­</strong></td><td>Object</td><td>å±æ€§å€¼æˆ–å…³è”çš„å¦ä¸€ä¸ªå®ä½“</td></tr></tbody></table><h3 id="åŸºæœ¬å½¢å¼"><a href="#åŸºæœ¬å½¢å¼" class="headerlink" title="åŸºæœ¬å½¢å¼"></a>åŸºæœ¬å½¢å¼</h3><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clojure">(<span class="hljs-name">Subject</span><span class="hljs-punctuation">,</span> Predicate<span class="hljs-punctuation">,</span> Object)<br></code></pre></td></tr></table></figure><h2 id="ä¸‰å…ƒç»„ç¤ºä¾‹"><a href="#ä¸‰å…ƒç»„ç¤ºä¾‹" class="headerlink" title="ä¸‰å…ƒç»„ç¤ºä¾‹"></a>ä¸‰å…ƒç»„ç¤ºä¾‹</h2><h3 id="è¡¨ç¤ºå…³ç³»"><a href="#è¡¨ç¤ºå…³ç³»" class="headerlink" title="è¡¨ç¤ºå…³ç³»"></a>è¡¨ç¤ºå…³ç³»</h3><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clojure">(å¼ ä¸‰<span class="hljs-punctuation">,</span> è®¤è¯†<span class="hljs-punctuation">,</span> æå››)<br>(åŒ—äº¬<span class="hljs-punctuation">,</span> æ˜¯é¦–éƒ½<span class="hljs-punctuation">,</span> ä¸­å›½)<br>(<span class="hljs-name">Java</span><span class="hljs-punctuation">,</span> å±äº<span class="hljs-punctuation">,</span> ç¼–ç¨‹è¯­è¨€)<br></code></pre></td></tr></table></figure><h3 id="è¡¨ç¤ºå±æ€§"><a href="#è¡¨ç¤ºå±æ€§" class="headerlink" title="è¡¨ç¤ºå±æ€§"></a>è¡¨ç¤ºå±æ€§</h3><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clojure">(å¼ ä¸‰<span class="hljs-punctuation">,</span> å¹´é¾„<span class="hljs-punctuation">,</span> <span class="hljs-number">25</span>)<br>(å¼ ä¸‰<span class="hljs-punctuation">,</span> èŒä¸š<span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;è½¯ä»¶å·¥ç¨‹å¸ˆ&quot;</span>)<br>(åŒ—äº¬<span class="hljs-punctuation">,</span> äººå£<span class="hljs-punctuation">,</span> <span class="hljs-number">21540000</span>)<br></code></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒç‰¹ç‚¹"><a href="#æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="æ ¸å¿ƒç‰¹ç‚¹"></a>æ ¸å¿ƒç‰¹ç‚¹</h2><ul><li><strong>åŸå­æ€§</strong>ï¼šæ¯ä¸ªä¸‰å…ƒç»„è¡¨è¾¾ä¸€ä¸ªç‹¬ç«‹ã€ä¸å¯åˆ†å‰²çš„äº‹å®</li><li><strong>å¯ç»„åˆ</strong>ï¼šå¤šä¸ªä¸‰å…ƒç»„é€šè¿‡å…±äº«èŠ‚ç‚¹å½¢æˆå¤æ‚çš„çŸ¥è¯†å›¾è°±</li><li><strong>è¯­ä¹‰æ˜ç¡®</strong>ï¼šè°“è¯­ç²¾ç¡®å®šä¹‰äº†ä¸»è¯­å’Œå®¾è¯­ä¹‹é—´çš„å…³ç³»</li><li><strong>æ ‡å‡†åŒ–</strong>ï¼šéµå¾ª W3C RDF æ ‡å‡†ï¼Œå…·æœ‰è‰¯å¥½çš„äº’æ“ä½œæ€§</li></ul><h2 id="ä¸‰å…ƒç»„-vs-å±æ€§å›¾"><a href="#ä¸‰å…ƒç»„-vs-å±æ€§å›¾" class="headerlink" title="ä¸‰å…ƒç»„ vs å±æ€§å›¾"></a>ä¸‰å…ƒç»„ vs å±æ€§å›¾</h2><p>å›¾æ•°æ®åº“åˆ†ä¸ºä¸¤å¤§æµæ´¾ï¼š<strong>RDF å›¾æ•°æ®åº“</strong>å’Œ<strong>å±æ€§å›¾æ•°æ®åº“</strong>ï¼Œè™½ç„¶éƒ½æ˜¯å›¾æ•°æ®åº“ï¼Œä½†æ•°æ®æ¨¡å‹ä¸åŒã€‚ğŸ‘‰è¯¦è§£ ^model-comparison</p><table><thead><tr><th>ç‰¹æ€§</th><th>ä¸‰å…ƒç»„æ¨¡å‹ï¼ˆRDFï¼‰</th><th>å±æ€§å›¾æ¨¡å‹</th></tr></thead><tbody><tr><td>ä»£è¡¨æ•°æ®åº“</td><td>Apache Jenaã€Stardog</td><td>Neo4jã€JanusGraph</td></tr><tr><td>è¾¹çš„å±æ€§</td><td>éœ€è¦é¢å¤–ä¸‰å…ƒç»„è¡¨ç¤ºï¼ˆå…·ä½“åŒ–ï¼‰</td><td>è¾¹å¯ç›´æ¥é™„åŠ å±æ€§</td></tr><tr><td>æŸ¥è¯¢è¯­è¨€</td><td>SPARQL</td><td>Cypherã€Gremlin</td></tr><tr><td>æ ‡å‡†åŒ–ç¨‹åº¦</td><td>W3C æ ‡å‡†</td><td>æ— ç»Ÿä¸€æ ‡å‡†</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>è¯­ä¹‰ç½‘ã€æœ¬ä½“å»ºæ¨¡</td><td>ç¤¾äº¤ç½‘ç»œã€æ¨èç³»ç»Ÿ</td></tr></tbody></table><h2 id="RDF-ä¸‰å…ƒç»„è¡¨ç¤ºæ³•"><a href="#RDF-ä¸‰å…ƒç»„è¡¨ç¤ºæ³•" class="headerlink" title="RDF ä¸‰å…ƒç»„è¡¨ç¤ºæ³•"></a>RDF ä¸‰å…ƒç»„è¡¨ç¤ºæ³•</h2><h3 id="N-Triples-æ ¼å¼"><a href="#N-Triples-æ ¼å¼" class="headerlink" title="N-Triples æ ¼å¼"></a>N-Triples æ ¼å¼</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">&lt;http:<span class="hljs-regexp">//</span>example.org<span class="hljs-regexp">/å¼ ä¸‰&gt; &lt;http:/</span><span class="hljs-regexp">/example.org/</span>è®¤è¯†&gt; &lt;http:<span class="hljs-regexp">//</span>example.org/æå››&gt; .<br>&lt;http:<span class="hljs-regexp">//</span>example.org<span class="hljs-regexp">/å¼ ä¸‰&gt; &lt;http:/</span><span class="hljs-regexp">/example.org/</span>å¹´é¾„&gt; <span class="hljs-string">&quot;25&quot;</span>^^&lt;http:<span class="hljs-regexp">//</span>www.w3.org<span class="hljs-regexp">/2001/</span>XMLSchema<span class="hljs-comment">#integer&gt; .</span><br></code></pre></td></tr></table></figure><h3 id="Turtle-æ ¼å¼"><a href="#Turtle-æ ¼å¼" class="headerlink" title="Turtle æ ¼å¼"></a>Turtle æ ¼å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs turtle">@prefix ex: &lt;http://example.org/&gt; .<br>@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .<br><br>ex:å¼ ä¸‰ ex:è®¤è¯† ex:æå›› ;<br>        ex:å¹´é¾„ &quot;25&quot;^^xsd:integer .<br></code></pre></td></tr></table></figure><h2 id="SPARQL-æŸ¥è¯¢ç¤ºä¾‹"><a href="#SPARQL-æŸ¥è¯¢ç¤ºä¾‹" class="headerlink" title="SPARQL æŸ¥è¯¢ç¤ºä¾‹"></a>SPARQL æŸ¥è¯¢ç¤ºä¾‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sparql"># æŸ¥è¯¢å¼ ä¸‰è®¤è¯†çš„æ‰€æœ‰äºº<br>SELECT ?person<br>WHERE &#123;<br>    ex:å¼ ä¸‰ ex:è®¤è¯† ?person .<br>&#125;<br><br># æŸ¥è¯¢æ‰€æœ‰å¹´é¾„å¤§äº20çš„äºº<br>SELECT ?person ?age<br>WHERE &#123;<br>    ?person ex:å¹´é¾„ ?age .<br>    FILTER (?age &gt; 20)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰å…ƒç»„åœ¨çŸ¥è¯†å›¾è°±ä¸­çš„åº”ç”¨"><a href="#ä¸‰å…ƒç»„åœ¨çŸ¥è¯†å›¾è°±ä¸­çš„åº”ç”¨" class="headerlink" title="ä¸‰å…ƒç»„åœ¨çŸ¥è¯†å›¾è°±ä¸­çš„åº”ç”¨"></a>ä¸‰å…ƒç»„åœ¨çŸ¥è¯†å›¾è°±ä¸­çš„åº”ç”¨</h2><pre><code class=" mermaid">graph LR    A[å¼ ä¸‰] --&gt;|è®¤è¯†| B[æå››]    A --&gt;|å·¥ä½œäº| C[é˜¿é‡Œå·´å·´]    B --&gt;|å·¥ä½œäº| D[è…¾è®¯]    C --&gt;|ä½äº| E[æ­å·]    D --&gt;|ä½äº| F[æ·±åœ³]</code></pre><h2 id="å®é™…åº”ç”¨åœºæ™¯"><a href="#å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…åº”ç”¨åœºæ™¯"></a>å®é™…åº”ç”¨åœºæ™¯</h2><ul><li><strong>çŸ¥è¯†å›¾è°±</strong>ï¼šGoogle Knowledge Graphã€ç™¾åº¦çŸ¥è¯†å›¾è°±</li><li><strong>è¯­ä¹‰ç½‘</strong>ï¼šLinked Open Data</li><li><strong>æœ¬ä½“å»ºæ¨¡</strong>ï¼šOWL æœ¬ä½“æè¿°</li><li><strong>æ™ºèƒ½é—®ç­”</strong>ï¼šåŸºäºçŸ¥è¯†å›¾è°±çš„é—®ç­”ç³»ç»Ÿ</li><li><strong>æ¨èç³»ç»Ÿ</strong>ï¼šåŸºäºçŸ¥è¯†å›¾è°±çš„æ¨è</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸‰å…ƒç»„æ˜¯å›¾æ•°æ®åº“çš„åŸºç¡€æ•°æ®ç»“æ„ï¼Œé€šè¿‡ <code>(ä¸»è¯­, è°“è¯­, å®¾è¯­)</code> çš„å½¢å¼è¡¨è¾¾äº‹å®ã€‚å®ƒæ˜¯æ„å»ºçŸ¥è¯†å›¾è°±çš„åŸºçŸ³ï¼Œå¹¿æ³›åº”ç”¨äºè¯­ä¹‰ç½‘ã€æ™ºèƒ½é—®ç­”ç­‰é¢†åŸŸã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
      <category>å›¾æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å›¾æ•°æ®åº“</tag>
      
      <tag>RDF</tag>
      
      <tag>ä¸‰å…ƒç»„</tag>
      
      <tag>çŸ¥è¯†å›¾è°±</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤§æ¨¡å‹å­¦ä¹ è·¯çº¿</title>
    <link href="/2026/01/12/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/"/>
    <url>/2026/01/12/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/</url>
    
    <content type="html"><![CDATA[<h1 id="å¤§æ¨¡å‹å­¦ä¹ è·¯çº¿ï¼ˆJavaå·¥ç¨‹å¸ˆç‰ˆï¼‰"><a href="#å¤§æ¨¡å‹å­¦ä¹ è·¯çº¿ï¼ˆJavaå·¥ç¨‹å¸ˆç‰ˆï¼‰" class="headerlink" title="å¤§æ¨¡å‹å­¦ä¹ è·¯çº¿ï¼ˆJavaå·¥ç¨‹å¸ˆç‰ˆï¼‰"></a>å¤§æ¨¡å‹å­¦ä¹ è·¯çº¿ï¼ˆJavaå·¥ç¨‹å¸ˆç‰ˆï¼‰</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æœ¬ç¬”è®°ä¸“ä¸º <strong>Java å·¥ç¨‹å¸ˆè½¬å‹ AI&#x2F;å¤§æ¨¡å‹æ–¹å‘</strong> è®¾è®¡ï¼Œå……åˆ†åˆ©ç”¨å·²æœ‰çš„ç¼–ç¨‹åŸºç¡€ï¼Œä»¥æœ€é«˜æ•ˆçš„è·¯å¾„åˆ‡å…¥å¤§æ¨¡å‹é¢†åŸŸã€‚</p><h2 id="å­¦ä¹ è·¯çº¿æ€»è§ˆ"><a href="#å­¦ä¹ è·¯çº¿æ€»è§ˆ" class="headerlink" title="å­¦ä¹ è·¯çº¿æ€»è§ˆ"></a>å­¦ä¹ è·¯çº¿æ€»è§ˆ</h2><pre><code class=" mermaid">graph TD    A[Javaå·¥ç¨‹å¸ˆ] --&gt; B[PythonåŸºç¡€]    A --&gt; C[Javaç”Ÿæ€AIå·¥å…·]    B --&gt; D[LLMåº”ç”¨å¼€å‘]    C --&gt; D    D --&gt; E[RAGæŠ€æœ¯]    D --&gt; F[Prompt Engineering]    E --&gt; G[å‘é‡æ•°æ®åº“]    F --&gt; H[Agentå¼€å‘]    G --&gt; I[ä¼ä¸šçº§åº”ç”¨]    H --&gt; I    I --&gt; J[æ¨¡å‹å¾®è°ƒ]</code></pre><h2 id="é˜¶æ®µä¸€ï¼šåŸºç¡€å‡†å¤‡ï¼ˆ1-2å‘¨ï¼‰"><a href="#é˜¶æ®µä¸€ï¼šåŸºç¡€å‡†å¤‡ï¼ˆ1-2å‘¨ï¼‰" class="headerlink" title="é˜¶æ®µä¸€ï¼šåŸºç¡€å‡†å¤‡ï¼ˆ1-2å‘¨ï¼‰"></a>é˜¶æ®µä¸€ï¼šåŸºç¡€å‡†å¤‡ï¼ˆ1-2å‘¨ï¼‰</h2><h3 id="1-1-Python-å¿«é€Ÿå…¥é—¨"><a href="#1-1-Python-å¿«é€Ÿå…¥é—¨" class="headerlink" title="1.1 Python å¿«é€Ÿå…¥é—¨"></a>1.1 Python å¿«é€Ÿå…¥é—¨</h3><table><thead><tr><th>å­¦ä¹ å†…å®¹</th><th>æ—¶é—´</th><th>ä¼˜å…ˆçº§</th></tr></thead><tbody><tr><td>åŸºç¡€è¯­æ³•ï¼ˆå˜é‡ã€å‡½æ•°ã€ç±»ï¼‰</td><td>3å¤©</td><td>â­â­â­</td></tr><tr><td>å¸¸ç”¨åº“ï¼ˆrequests, jsonï¼‰</td><td>2å¤©</td><td>â­â­â­</td></tr><tr><td>å¼‚æ­¥ç¼–ç¨‹ï¼ˆasyncioï¼‰</td><td>2å¤©</td><td>â­â­</td></tr><tr><td>è™šæ‹Ÿç¯å¢ƒä¸åŒ…ç®¡ç†</td><td>1å¤©</td><td>â­â­â­</td></tr></tbody></table><blockquote><p><strong>ğŸ’¡ æç¤º: Java å·¥ç¨‹å¸ˆä¼˜åŠ¿</strong><br>Python è¯­æ³•æ¯” Java ç®€å•å¾ˆå¤šï¼Œæœ‰ Java åŸºç¡€ 2-3 å‘¨å¯ç†Ÿç»ƒä½¿ç”¨</p></blockquote><h3 id="1-2-æ•°å­¦åŸºç¡€ï¼ˆæŒ‰éœ€è¡¥å……ï¼‰"><a href="#1-2-æ•°å­¦åŸºç¡€ï¼ˆæŒ‰éœ€è¡¥å……ï¼‰" class="headerlink" title="1.2 æ•°å­¦åŸºç¡€ï¼ˆæŒ‰éœ€è¡¥å……ï¼‰"></a>1.2 æ•°å­¦åŸºç¡€ï¼ˆæŒ‰éœ€è¡¥å……ï¼‰</h3><ul><li><strong>çº¿æ€§ä»£æ•°</strong> â€” å‘é‡ã€çŸ©é˜µè¿ç®—ï¼ˆç†è§£ Embedding åŸç†ï¼‰</li><li><strong>æ¦‚ç‡ç»Ÿè®¡</strong> â€” æ¦‚ç‡åˆ†å¸ƒã€è´å¶æ–¯å®šç†</li><li><strong>å¾®ç§¯åˆ†</strong> â€” æ¢¯åº¦ã€å¯¼æ•°ï¼ˆç†è§£æ¨¡å‹è®­ç»ƒåŸç†ï¼‰</li></ul><blockquote><p><strong>ğŸ“ æ³¨æ„: å»ºè®®</strong><br>å…ˆè·³è¿‡æ·±å…¥æ•°å­¦ï¼Œé‡åˆ°ä¸æ‡‚çš„æ¦‚å¿µå†å›æ¥è¡¥å……</p></blockquote><h2 id="é˜¶æ®µäºŒï¼šLLM-åº”ç”¨å¼€å‘ï¼ˆ2-4å‘¨ï¼‰"><a href="#é˜¶æ®µäºŒï¼šLLM-åº”ç”¨å¼€å‘ï¼ˆ2-4å‘¨ï¼‰" class="headerlink" title="é˜¶æ®µäºŒï¼šLLM åº”ç”¨å¼€å‘ï¼ˆ2-4å‘¨ï¼‰"></a>é˜¶æ®µäºŒï¼šLLM åº”ç”¨å¼€å‘ï¼ˆ2-4å‘¨ï¼‰</h2><h3 id="2-1-æ ¸å¿ƒæ¦‚å¿µ"><a href="#2-1-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="2.1 æ ¸å¿ƒæ¦‚å¿µ"></a>2.1 æ ¸å¿ƒæ¦‚å¿µ</h3><table><thead><tr><th>æ¦‚å¿µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Token</td><td>æ–‡æœ¬çš„æœ€å°å¤„ç†å•ä½</td></tr><tr><td>Embedding</td><td>æ–‡æœ¬çš„å‘é‡è¡¨ç¤º</td></tr><tr><td>Prompt</td><td>ç»™æ¨¡å‹çš„è¾“å…¥æŒ‡ä»¤</td></tr><tr><td>Context Window</td><td>æ¨¡å‹èƒ½å¤„ç†çš„æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦</td></tr><tr><td>Temperature</td><td>æ§åˆ¶è¾“å‡ºéšæœºæ€§çš„å‚æ•°</td></tr></tbody></table><h3 id="2-2-ä¸»æµå¤§æ¨¡å‹-API"><a href="#2-2-ä¸»æµå¤§æ¨¡å‹-API" class="headerlink" title="2.2 ä¸»æµå¤§æ¨¡å‹ API"></a>2.2 ä¸»æµå¤§æ¨¡å‹ API</h3><table><thead><tr><th>æ¨¡å‹</th><th>å‚å•†</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>GPT-4 &#x2F; GPT-4o</td><td>OpenAI</td><td>ç»¼åˆèƒ½åŠ›æœ€å¼º</td></tr><tr><td>Claude 3.5</td><td>Anthropic</td><td>é•¿æ–‡æœ¬ã€ä»£ç èƒ½åŠ›å¼º</td></tr><tr><td>é€šä¹‰åƒé—®</td><td>é˜¿é‡Œå·´å·´</td><td>å›½å†…é¦–é€‰ï¼Œä¸­æ–‡èƒ½åŠ›å¥½</td></tr><tr><td>æ–‡å¿ƒä¸€è¨€</td><td>ç™¾åº¦</td><td>å›½å†…ä¸»æµ</td></tr><tr><td>GLM-4</td><td>æ™ºè°±AI</td><td>å¼€æºå‹å¥½</td></tr></tbody></table><h3 id="2-3-å¼€å‘æ¡†æ¶é€‰æ‹©"><a href="#2-3-å¼€å‘æ¡†æ¶é€‰æ‹©" class="headerlink" title="2.3 å¼€å‘æ¡†æ¶é€‰æ‹©"></a>2.3 å¼€å‘æ¡†æ¶é€‰æ‹©</h3><h4 id="Python-ç”Ÿæ€"><a href="#Python-ç”Ÿæ€" class="headerlink" title="Python ç”Ÿæ€"></a>Python ç”Ÿæ€</h4><ul><li><strong>LangChain</strong> â€” æœ€æµè¡Œçš„ LLM åº”ç”¨æ¡†æ¶</li><li><strong>LlamaIndex</strong> â€” ä¸“æ³¨äº RAG åœºæ™¯</li></ul><h4 id="Java-ç”Ÿæ€ï¼ˆæ¨èä¼˜å…ˆæŒæ¡ï¼‰"><a href="#Java-ç”Ÿæ€ï¼ˆæ¨èä¼˜å…ˆæŒæ¡ï¼‰" class="headerlink" title="Java ç”Ÿæ€ï¼ˆæ¨èä¼˜å…ˆæŒæ¡ï¼‰"></a>Java ç”Ÿæ€ï¼ˆæ¨èä¼˜å…ˆæŒæ¡ï¼‰</h4><ul><li><strong>Spring AI</strong> â€” Spring å®˜æ–¹ AI æ¡†æ¶ï¼Œä¸ Spring Boot æ— ç¼é›†æˆ</li><li><strong>LangChain4j</strong> â€” LangChain çš„ Java ç‰ˆæœ¬</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Spring AI ç¤ºä¾‹</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatController</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ChatController</span><span class="hljs-params">(ChatClient.Builder builder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.chatClient = builder.build();<br>    &#125;<br>    <br>    <span class="hljs-meta">@GetMapping(&quot;/chat&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">chat</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String message)</span> &#123;<br>        <span class="hljs-keyword">return</span> chatClient.prompt()<br>            .user(message)<br>            .call()<br>            .content();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é˜¶æ®µä¸‰ï¼šRAG-æŠ€æœ¯ï¼ˆ2-3å‘¨ï¼‰"><a href="#é˜¶æ®µä¸‰ï¼šRAG-æŠ€æœ¯ï¼ˆ2-3å‘¨ï¼‰" class="headerlink" title="é˜¶æ®µä¸‰ï¼šRAG æŠ€æœ¯ï¼ˆ2-3å‘¨ï¼‰"></a>é˜¶æ®µä¸‰ï¼šRAG æŠ€æœ¯ï¼ˆ2-3å‘¨ï¼‰</h2><h3 id="3-1-RAG-åŸç†"><a href="#3-1-RAG-åŸç†" class="headerlink" title="3.1 RAG åŸç†"></a>3.1 RAG åŸç†</h3><p><strong>RAGï¼ˆRetrieval-Augmented Generationï¼‰</strong> &#x3D; æ£€ç´¢ + ç”Ÿæˆ</p><pre><code class=" mermaid">graph LR    A[ç”¨æˆ·é—®é¢˜] --&gt; B[Embedding]    B --&gt; C[å‘é‡æ£€ç´¢]    C --&gt; D[ç›¸å…³æ–‡æ¡£]    D --&gt; E[æ„å»ºPrompt]    A --&gt; E    E --&gt; F[LLMç”Ÿæˆ]    F --&gt; G[å›ç­”]</code></pre><h3 id="3-2-å‘é‡æ•°æ®åº“"><a href="#3-2-å‘é‡æ•°æ®åº“" class="headerlink" title="3.2 å‘é‡æ•°æ®åº“"></a>3.2 å‘é‡æ•°æ®åº“</h3><table><thead><tr><th>æ•°æ®åº“</th><th>ç‰¹ç‚¹</th><th>æ¨èåœºæ™¯</th></tr></thead><tbody><tr><td>Milvus</td><td>å¼€æºã€é«˜æ€§èƒ½</td><td>ç”Ÿäº§ç¯å¢ƒé¦–é€‰</td></tr><tr><td>Pinecone</td><td>æ‰˜ç®¡æœåŠ¡ã€æ˜“ç”¨</td><td>å¿«é€ŸåŸå‹</td></tr><tr><td>Chroma</td><td>è½»é‡ã€åµŒå…¥å¼</td><td>æœ¬åœ°å¼€å‘</td></tr><tr><td>Weaviate</td><td>GraphQL æ”¯æŒ</td><td>å¤æ‚æŸ¥è¯¢</td></tr><tr><td>pgvector</td><td>PostgreSQL æ’ä»¶</td><td>å·²æœ‰ PG ç¯å¢ƒ</td></tr></tbody></table><h3 id="3-3-æ ¸å¿ƒæµç¨‹"><a href="#3-3-æ ¸å¿ƒæµç¨‹" class="headerlink" title="3.3 æ ¸å¿ƒæµç¨‹"></a>3.3 æ ¸å¿ƒæµç¨‹</h3><ol><li><strong>æ–‡æ¡£åŠ è½½</strong> â€” è¯»å– PDFã€Wordã€ç½‘é¡µç­‰</li><li><strong>æ–‡æœ¬åˆ†å‰²</strong> â€” æŒ‰ chunk åˆ‡åˆ†æ–‡æ¡£</li><li><strong>å‘é‡åŒ–</strong> â€” è°ƒç”¨ Embedding æ¨¡å‹</li><li><strong>å­˜å‚¨</strong> â€” å†™å…¥å‘é‡æ•°æ®åº“</li><li><strong>æ£€ç´¢</strong> â€” ç›¸ä¼¼åº¦æœç´¢</li><li><strong>ç”Ÿæˆ</strong> â€” æ„å»º Prompt è°ƒç”¨ LLM</li></ol><h2 id="é˜¶æ®µå››ï¼šPrompt-Engineeringï¼ˆ1-2å‘¨ï¼‰"><a href="#é˜¶æ®µå››ï¼šPrompt-Engineeringï¼ˆ1-2å‘¨ï¼‰" class="headerlink" title="é˜¶æ®µå››ï¼šPrompt Engineeringï¼ˆ1-2å‘¨ï¼‰"></a>é˜¶æ®µå››ï¼šPrompt Engineeringï¼ˆ1-2å‘¨ï¼‰</h2><h3 id="4-1-æ ¸å¿ƒæŠ€å·§"><a href="#4-1-æ ¸å¿ƒæŠ€å·§" class="headerlink" title="4.1 æ ¸å¿ƒæŠ€å·§"></a>4.1 æ ¸å¿ƒæŠ€å·§</h3><ul><li><strong>è§’è‰²è®¾å®š</strong> â€” æŒ‡å®š AI æ‰®æ¼”çš„è§’è‰²</li><li><strong>Few-shot</strong> â€” æä¾›ç¤ºä¾‹å¼•å¯¼è¾“å‡ºæ ¼å¼</li><li><strong>Chain of Thought</strong> â€” å¼•å¯¼é€æ­¥æ¨ç†</li><li><strong>ç»“æ„åŒ–è¾“å‡º</strong> â€” è¦æ±‚ JSON&#x2F;Markdown æ ¼å¼</li></ul><h3 id="4-2-ç¤ºä¾‹æ¨¡æ¿"><a href="#4-2-ç¤ºä¾‹æ¨¡æ¿" class="headerlink" title="4.2 ç¤ºä¾‹æ¨¡æ¿"></a>4.2 ç¤ºä¾‹æ¨¡æ¿</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs clean">ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ Java æ¶æ„å¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹ä»£ç åˆ†ææ½œåœ¨é—®é¢˜ï¼š<br><br>## ä»£ç <br>&#123;<span class="hljs-keyword">code</span>&#125;<br><br>## è¾“å‡ºè¦æ±‚<br><span class="hljs-number">1.</span> é—®é¢˜åˆ—è¡¨ï¼ˆä¸¥é‡ç¨‹åº¦ï¼šé«˜/ä¸­/ä½ï¼‰<br><span class="hljs-number">2.</span> ä¿®æ”¹å»ºè®®<br><span class="hljs-number">3.</span> æœ€ä½³å®è·µå‚è€ƒ<br></code></pre></td></tr></table></figure><h2 id="é˜¶æ®µäº”ï¼šè¿›é˜¶æ–¹å‘"><a href="#é˜¶æ®µäº”ï¼šè¿›é˜¶æ–¹å‘" class="headerlink" title="é˜¶æ®µäº”ï¼šè¿›é˜¶æ–¹å‘"></a>é˜¶æ®µäº”ï¼šè¿›é˜¶æ–¹å‘</h2><h3 id="5-1-Agent-å¼€å‘"><a href="#5-1-Agent-å¼€å‘" class="headerlink" title="5.1 Agent å¼€å‘"></a>5.1 Agent å¼€å‘</h3><ul><li><strong>Function Calling</strong> â€” è®© LLM è°ƒç”¨å¤–éƒ¨å·¥å…·</li><li><strong>ReAct æ¨¡å¼</strong> â€” æ¨ç† + è¡ŒåŠ¨å¾ªç¯</li><li><strong>Multi-Agent</strong> â€” å¤šæ™ºèƒ½ä½“åä½œ</li></ul><h3 id="5-2-æ¨¡å‹å¾®è°ƒ"><a href="#5-2-æ¨¡å‹å¾®è°ƒ" class="headerlink" title="5.2 æ¨¡å‹å¾®è°ƒ"></a>5.2 æ¨¡å‹å¾®è°ƒ</h3><table><thead><tr><th>æŠ€æœ¯</th><th>è¯´æ˜</th><th>èµ„æºéœ€æ±‚</th></tr></thead><tbody><tr><td>Full Fine-tuning</td><td>å…¨å‚æ•°å¾®è°ƒ</td><td>æé«˜ï¼ˆå¤šå¡A100ï¼‰</td></tr><tr><td>LoRA</td><td>ä½ç§©é€‚åº”</td><td>ä¸­ç­‰ï¼ˆå•å¡å¯è¡Œï¼‰</td></tr><tr><td>QLoRA</td><td>é‡åŒ– + LoRA</td><td>ä½ï¼ˆæ¶ˆè´¹çº§æ˜¾å¡ï¼‰</td></tr><tr><td>Prompt Tuning</td><td>è½¯æç¤ºå¾®è°ƒ</td><td>ä½</td></tr></tbody></table><h3 id="5-3-å¼€æºæ¨¡å‹éƒ¨ç½²"><a href="#5-3-å¼€æºæ¨¡å‹éƒ¨ç½²" class="headerlink" title="5.3 å¼€æºæ¨¡å‹éƒ¨ç½²"></a>5.3 å¼€æºæ¨¡å‹éƒ¨ç½²</h3><ul><li><strong>Ollama</strong> â€” æœ¬åœ°è¿è¡Œå¼€æºæ¨¡å‹</li><li><strong>vLLM</strong> â€” é«˜æ€§èƒ½æ¨ç†å¼•æ“</li><li><strong>Text Generation Inference</strong> â€” HuggingFace å®˜æ–¹æ–¹æ¡ˆ</li></ul><h2 id="æ¨èå­¦ä¹ èµ„æº"><a href="#æ¨èå­¦ä¹ èµ„æº" class="headerlink" title="æ¨èå­¦ä¹ èµ„æº"></a>æ¨èå­¦ä¹ èµ„æº</h2><h3 id="è¯¾ç¨‹"><a href="#è¯¾ç¨‹" class="headerlink" title="è¯¾ç¨‹"></a>è¯¾ç¨‹</h3><table><thead><tr><th>èµ„æº</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å´æ©è¾¾ã€ŠGenerative AI for Everyoneã€‹</td><td>å…¥é—¨æ¦‚å¿µ</td></tr><tr><td>DeepLearning.AI çŸ­è¯¾ç¨‹ç³»åˆ—</td><td>LangChainã€RAG ç­‰ä¸“é¢˜</td></tr><tr><td>ææ²ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹</td><td>æ·±å…¥åŸç†</td></tr></tbody></table><h3 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h3><ul><li><a href="https://python.langchain.com/">LangChain å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://docs.spring.io/spring-ai/reference/">Spring AI å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://huggingface.co/learn">HuggingFace æ•™ç¨‹</a></li></ul><h3 id="å®è·µå¹³å°"><a href="#å®è·µå¹³å°" class="headerlink" title="å®è·µå¹³å°"></a>å®è·µå¹³å°</h3><ul><li><strong>Colab</strong> â€” å…è´¹ GPU ç¯å¢ƒ</li><li><strong>Kaggle</strong> â€” æ•°æ®é›† + GPU</li><li><strong>é­”æ­ç¤¾åŒº</strong> â€” å›½å†…æ¨¡å‹å¹³å°</li></ul><h2 id="å®æˆ˜é¡¹ç›®å»ºè®®"><a href="#å®æˆ˜é¡¹ç›®å»ºè®®" class="headerlink" title="å®æˆ˜é¡¹ç›®å»ºè®®"></a>å®æˆ˜é¡¹ç›®å»ºè®®</h2><h3 id="å…¥é—¨é¡¹ç›®"><a href="#å…¥é—¨é¡¹ç›®" class="headerlink" title="å…¥é—¨é¡¹ç›®"></a>å…¥é—¨é¡¹ç›®</h3><ol><li><strong>æ™ºèƒ½å®¢æœ</strong> â€” åŸºäº RAG çš„é—®ç­”ç³»ç»Ÿ</li><li><strong>æ–‡æ¡£åŠ©æ‰‹</strong> â€” PDF&#x2F;æ–‡æ¡£æ™ºèƒ½é—®ç­”</li><li><strong>ä»£ç åŠ©æ‰‹</strong> â€” ä»£ç è§£é‡Šã€Review å·¥å…·</li></ol><h3 id="è¿›é˜¶é¡¹ç›®"><a href="#è¿›é˜¶é¡¹ç›®" class="headerlink" title="è¿›é˜¶é¡¹ç›®"></a>è¿›é˜¶é¡¹ç›®</h3><ol><li><strong>ä¼ä¸šçŸ¥è¯†åº“</strong> â€” å¤šæ•°æ®æºã€æƒé™æ§åˆ¶</li><li><strong>AI Agent</strong> â€” è‡ªåŠ¨åŒ–ä»»åŠ¡æ‰§è¡Œ</li><li><strong>å‚ç›´é¢†åŸŸæ¨¡å‹</strong> â€” è¡Œä¸šå¾®è°ƒæ¨¡å‹</li></ol><h2 id="æ—¶é—´è§„åˆ’å»ºè®®"><a href="#æ—¶é—´è§„åˆ’å»ºè®®" class="headerlink" title="æ—¶é—´è§„åˆ’å»ºè®®"></a>æ—¶é—´è§„åˆ’å»ºè®®</h2><table><thead><tr><th>é˜¶æ®µ</th><th>æ—¶é—´</th><th>äº§å‡º</th></tr></thead><tbody><tr><td>åŸºç¡€å‡†å¤‡</td><td>2å‘¨</td><td>Python ç†Ÿç»ƒä½¿ç”¨</td></tr><tr><td>LLM åº”ç”¨</td><td>3å‘¨</td><td>å®Œæˆç¬¬ä¸€ä¸ª AI åº”ç”¨</td></tr><tr><td>RAG æŠ€æœ¯</td><td>3å‘¨</td><td>æ„å»ºçŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿ</td></tr><tr><td>è¿›é˜¶æ–¹å‘</td><td>æŒç»­</td><td>æ ¹æ®å…´è¶£æ·±å…¥</td></tr></tbody></table><blockquote><p><strong>âš ï¸ é‡è¦: æ ¸å¿ƒå»ºè®®</strong><br>ä» <strong>Spring AI + å¤§æ¨¡å‹ API</strong> åˆ‡å…¥æœ€å¿«è§æ•ˆï¼Œè¾¹åšé¡¹ç›®è¾¹å­¦ä¹ ç†è®º</p></blockquote><h2 id="ç›¸å…³ç¬”è®°"><a href="#ç›¸å…³ç¬”è®°" class="headerlink" title="ç›¸å…³ç¬”è®°"></a>ç›¸å…³ç¬”è®°</h2><ul><li>Pythonå¿«é€Ÿå…¥é—¨</li><li>LLMåº”ç”¨å¼€å‘</li><li>RAGæŠ€æœ¯è¯¦è§£</li></ul>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AI</tag>
      
      <tag>å¤§æ¨¡å‹</tag>
      
      <tag>å­¦ä¹ è·¯çº¿</tag>
      
      <tag>Javaè½¬å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ†æ¨¡å—æ‰“åŒ…å®æˆ˜</title>
    <link href="/2026/01/12/%E5%88%86%E6%A8%A1%E5%9D%97%E6%89%93%E5%8C%85%E5%AE%9E%E6%88%98/"/>
    <url>/2026/01/12/%E5%88%86%E6%A8%A1%E5%9D%97%E6%89%93%E5%8C%85%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h1 id="Maven-åˆ†æ¨¡å—æ‰“åŒ…å®æˆ˜"><a href="#Maven-åˆ†æ¨¡å—æ‰“åŒ…å®æˆ˜" class="headerlink" title="Maven åˆ†æ¨¡å—æ‰“åŒ…å®æˆ˜"></a>Maven åˆ†æ¨¡å—æ‰“åŒ…å®æˆ˜</h1><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><p>åœ¨å¤šæ¨¡å—é¡¹ç›®ä¸­ï¼Œä¸åŒæ¨¡å—çš„æ‰“åŒ…æ–¹å¼å’Œç›®æ ‡ä¸åŒï¼š</p><ul><li><strong>çˆ¶æ¨¡å—</strong>ï¼šä¸æ‰“åŒ…ï¼Œä»…ç”¨äºèšåˆ</li><li><strong>å…¬å…±æ¨¡å—</strong>ï¼šæ‰“åŒ…æˆæ™®é€š JARï¼Œä¾›å…¶ä»–æ¨¡å—ä¾èµ–</li><li><strong>æœåŠ¡æ¨¡å—</strong>ï¼šæ‰“åŒ…æˆæ™®é€š JAR æˆ–å¯æ‰§è¡Œ JAR</li><li><strong>å¯åŠ¨æ¨¡å—</strong>ï¼šæ‰“åŒ…æˆå¯æ‰§è¡Œ JARï¼ŒåŒ…å«æ‰€æœ‰ä¾èµ–</li></ul><hr><h2 id="æ‰“åŒ…ç±»å‹å¯¹æ¯”"><a href="#æ‰“åŒ…ç±»å‹å¯¹æ¯”" class="headerlink" title="æ‰“åŒ…ç±»å‹å¯¹æ¯”"></a>æ‰“åŒ…ç±»å‹å¯¹æ¯”</h2><table><thead><tr><th>æ‰“åŒ…ç±»å‹</th><th>packaging</th><th>äº§ç‰©</th><th>é€‚ç”¨åœºæ™¯</th><th>å¤§å°</th></tr></thead><tbody><tr><td><strong>POM</strong></td><td><code>pom</code></td><td>æ—  JAR</td><td>çˆ¶æ¨¡å—ã€èšåˆæ¨¡å—</td><td>-</td></tr><tr><td><strong>æ™®é€š JAR</strong></td><td><code>jar</code></td><td>ä»…åŒ…å«æœ¬æ¨¡å—ä»£ç </td><td>å…¬å…±æ¨¡å—ã€è¢«ä¾èµ–æ¨¡å—</td><td>å°ï¼ˆå‡ å KB - å‡  MBï¼‰</td></tr><tr><td><strong>å¯æ‰§è¡Œ JAR</strong></td><td><code>jar</code></td><td>åŒ…å«æ‰€æœ‰ä¾èµ–</td><td>å¯åŠ¨æ¨¡å—ã€ç‹¬ç«‹åº”ç”¨</td><td>å¤§ï¼ˆå‡ å MB - å‡ ç™¾ MBï¼‰</td></tr><tr><td><strong>WAR</strong></td><td><code>war</code></td><td>Web åº”ç”¨åŒ…</td><td>éƒ¨ç½²åˆ° Tomcat ç­‰å®¹å™¨</td><td>ä¸­ç­‰</td></tr></tbody></table><hr><h2 id="çˆ¶æ¨¡å—æ‰“åŒ…é…ç½®"><a href="#çˆ¶æ¨¡å—æ‰“åŒ…é…ç½®" class="headerlink" title="çˆ¶æ¨¡å—æ‰“åŒ…é…ç½®"></a>çˆ¶æ¨¡å—æ‰“åŒ…é…ç½®</h2><h3 id="åŸºæœ¬é…ç½®"><a href="#åŸºæœ¬é…ç½®" class="headerlink" title="åŸºæœ¬é…ç½®"></a>åŸºæœ¬é…ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- çˆ¶æ¨¡å— pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-project<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>  <span class="hljs-comment">&lt;!-- å¿…é¡»æ˜¯ pom --&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>my-common<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>my-service<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>my-app<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li><code>packaging</code> å¿…é¡»æ˜¯ <code>pom</code></li><li>ä¸ä¼šç”Ÿæˆ JAR æ–‡ä»¶</li><li>æ‰§è¡Œ <code>mvn package</code> æ—¶ä¼šæ„å»ºæ‰€æœ‰å­æ¨¡å—</li></ul><hr><h2 id="å…¬å…±æ¨¡å—æ‰“åŒ…é…ç½®"><a href="#å…¬å…±æ¨¡å—æ‰“åŒ…é…ç½®" class="headerlink" title="å…¬å…±æ¨¡å—æ‰“åŒ…é…ç½®"></a>å…¬å…±æ¨¡å—æ‰“åŒ…é…ç½®</h2><p>å…¬å…±æ¨¡å—ï¼ˆå¦‚ commonã€domainã€repositoryï¼‰è¢«å…¶ä»–æ¨¡å—ä¾èµ–ï¼Œåªéœ€æ‰“åŒ…æˆæ™®é€š JARã€‚</p><h3 id="åŸºæœ¬é…ç½®-1"><a href="#åŸºæœ¬é…ç½®-1" class="headerlink" title="åŸºæœ¬é…ç½®"></a>åŸºæœ¬é…ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- my-common/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-project<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>  <span class="hljs-comment">&lt;!-- é»˜è®¤å°±æ˜¯ jarï¼Œå¯çœç•¥ --&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- Maven JAR æ’ä»¶ï¼ˆé»˜è®¤å·²é…ç½®ï¼‰ --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-jar-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">addDefaultImplementationEntries</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">addDefaultImplementationEntries</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="æ‰“åŒ…äº§ç‰©"><a href="#æ‰“åŒ…äº§ç‰©" class="headerlink" title="æ‰“åŒ…äº§ç‰©"></a>æ‰“åŒ…äº§ç‰©</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">my-common/target/<br>â””â”€â”€ my-common-1.0.0.jar      <span class="hljs-comment"># åªåŒ…å«æœ¬æ¨¡å—ç¼–è¯‘çš„ class æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ‰“åŒ…å¹¶å®‰è£…åˆ°æœ¬åœ°ä»“åº“</span><br>mvn clean install<br><br><span class="hljs-comment"># å…¶ä»–æ¨¡å—é€šè¿‡ä¾èµ–å¼•ç”¨</span><br>&lt;dependency&gt;<br>    &lt;groupId&gt;com.example&lt;/groupId&gt;<br>    &lt;artifactId&gt;my-common&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><hr><h2 id="å¯åŠ¨æ¨¡å—æ‰“åŒ…é…ç½®"><a href="#å¯åŠ¨æ¨¡å—æ‰“åŒ…é…ç½®" class="headerlink" title="å¯åŠ¨æ¨¡å—æ‰“åŒ…é…ç½®"></a>å¯åŠ¨æ¨¡å—æ‰“åŒ…é…ç½®</h2><p>å¯åŠ¨æ¨¡å—éœ€è¦æ‰“åŒ…æˆ<strong>å¯æ‰§è¡Œ JAR</strong>ï¼ŒåŒ…å«æ‰€æœ‰ä¾èµ–ï¼Œå¯ç‹¬ç«‹è¿è¡Œã€‚</p><h3 id="æ–¹å¼ä¸€ï¼šSpring-Boot-Maven-Pluginï¼ˆæ¨èï¼‰"><a href="#æ–¹å¼ä¸€ï¼šSpring-Boot-Maven-Pluginï¼ˆæ¨èï¼‰" class="headerlink" title="æ–¹å¼ä¸€ï¼šSpring Boot Maven Pluginï¼ˆæ¨èï¼‰"></a>æ–¹å¼ä¸€ï¼šSpring Boot Maven Pluginï¼ˆæ¨èï¼‰</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- my-app/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-project<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-app<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ä¾èµ–å…¶ä»–æ¨¡å— --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- Spring Boot --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- Spring Boot æ‰“åŒ…æ’ä»¶ --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-comment">&lt;!-- æŒ‡å®šä¸»ç±»ï¼ˆå¯é€‰ï¼Œè‡ªåŠ¨æ£€æµ‹ï¼‰ --&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.MyApplication<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span><br>                    <span class="hljs-comment">&lt;!-- æ’é™¤æŸäº›ä¾èµ–ï¼ˆå¯é€‰ï¼‰ --&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>repackage<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>å…³é”®é…ç½®</strong>ï¼š</p><ul><li><code>repackage</code> goalï¼šå°†ä¾èµ–æ‰“åŒ…åˆ° JAR ä¸­</li><li>è‡ªåŠ¨é…ç½® MANIFEST.MF ä¸­çš„ Main-Class</li><li>ä½¿ç”¨ Spring Boot çš„ç±»åŠ è½½å™¨</li></ul><p><strong>æ‰“åŒ…äº§ç‰©</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">my-app/target/<br>â”œâ”€â”€ my-app-1.0.0.jar          <span class="hljs-comment"># å¯æ‰§è¡Œ JARï¼ˆ50-100 MBï¼‰</span><br>â””â”€â”€ my-app-1.0.0.jar.original <span class="hljs-comment"># åŸå§‹ JARï¼ˆåªæœ‰æœ¬æ¨¡å—ä»£ç ï¼‰</span><br></code></pre></td></tr></table></figure><p><strong>è¿è¡Œ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar target/my-app-1.0.0.jar<br></code></pre></td></tr></table></figure><hr><h3 id="æ–¹å¼äºŒï¼šMaven-Assembly-Pluginï¼ˆè‡ªå®šä¹‰æ‰“åŒ…ï¼‰"><a href="#æ–¹å¼äºŒï¼šMaven-Assembly-Pluginï¼ˆè‡ªå®šä¹‰æ‰“åŒ…ï¼‰" class="headerlink" title="æ–¹å¼äºŒï¼šMaven Assembly Pluginï¼ˆè‡ªå®šä¹‰æ‰“åŒ…ï¼‰"></a>æ–¹å¼äºŒï¼šMaven Assembly Pluginï¼ˆè‡ªå®šä¹‰æ‰“åŒ…ï¼‰</h3><p>é€‚ç”¨äºé Spring Boot é¡¹ç›®æˆ–éœ€è¦è‡ªå®šä¹‰æ‰“åŒ…ç»“æ„ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- Assembly æ’ä»¶ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.Main<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRefs</span>&gt;</span><br>                    <span class="hljs-comment">&lt;!-- é¢„å®šä¹‰çš„æ‰“åŒ…æ–¹å¼ --&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRef</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRefs</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>make-assembly<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>single<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ‰“åŒ…äº§ç‰©</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">target/my-app-1.0.0-jar-with-dependencies.jar<br></code></pre></td></tr></table></figure><p><strong>è¿è¡Œ</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -jar target/my-app-1.0.0-jar-with-dependencies.jar<br></code></pre></td></tr></table></figure><hr><h3 id="æ–¹å¼ä¸‰ï¼šMaven-Shade-Pluginï¼ˆåˆå¹¶ä¾èµ–ï¼‰"><a href="#æ–¹å¼ä¸‰ï¼šMaven-Shade-Pluginï¼ˆåˆå¹¶ä¾èµ–ï¼‰" class="headerlink" title="æ–¹å¼ä¸‰ï¼šMaven Shade Pluginï¼ˆåˆå¹¶ä¾èµ–ï¼‰"></a>æ–¹å¼ä¸‰ï¼šMaven Shade Pluginï¼ˆåˆå¹¶ä¾èµ–ï¼‰</h3><p>é€‚ç”¨äºéœ€è¦è§£å†³ä¾èµ–å†²çªæˆ–é‡å‘½ååŒ…çš„åœºæ™¯ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- Shade æ’ä»¶ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-shade-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">transformers</span>&gt;</span><br>                    <span class="hljs-comment">&lt;!-- æŒ‡å®šä¸»ç±» --&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">transformer</span> <span class="hljs-attr">implementation</span>=<span class="hljs-string">&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.Main<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">transformer</span>&gt;</span><br>                    <span class="hljs-comment">&lt;!-- åˆå¹¶ Spring é…ç½®æ–‡ä»¶ --&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">transformer</span> <span class="hljs-attr">implementation</span>=<span class="hljs-string">&quot;org.apache.maven.plugins.shade.resource.AppendingTransformer&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>META-INF/spring.handlers<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">transformer</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">transformer</span> <span class="hljs-attr">implementation</span>=<span class="hljs-string">&quot;org.apache.maven.plugins.shade.resource.AppendingTransformer&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span>META-INF/spring.schemas<span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">transformer</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">transformers</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- æ’é™¤ç­¾åæ–‡ä»¶ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">filters</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">artifact</span>&gt;</span>*:*<span class="hljs-tag">&lt;/<span class="hljs-name">artifact</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>META-INF/*.SF<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>META-INF/*.DSA<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>META-INF/*.RSA<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">filters</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>shade<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>å¯ä»¥é‡å‘½ååŒ…ï¼ˆrelocateï¼‰é¿å…å†²çª</li><li>å¯ä»¥åˆå¹¶ META-INF ä¸‹çš„é…ç½®æ–‡ä»¶</li><li>ç”Ÿæˆçš„ JAR æ›¿æ¢åŸå§‹ JAR</li></ul><hr><h2 id="ç˜¦-JAR-lib-ç›®å½•æ–¹å¼"><a href="#ç˜¦-JAR-lib-ç›®å½•æ–¹å¼" class="headerlink" title="ç˜¦ JAR + lib ç›®å½•æ–¹å¼"></a>ç˜¦ JAR + lib ç›®å½•æ–¹å¼</h2><p>æœ‰äº›åœºæ™¯ä¸‹ä¸å¸Œæœ›æ‰€æœ‰ä¾èµ–æ‰“åŒ…åˆ°ä¸€ä¸ª JAR ä¸­ï¼Œå¯ä»¥é‡‡ç”¨ç˜¦ JAR + lib ç›®å½•çš„æ–¹å¼ã€‚</p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- å¤åˆ¶ä¾èµ–åˆ° lib ç›®å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- JAR æ’ä»¶é…ç½® classpath --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-jar-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">addClasspath</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">addClasspath</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">classpathPrefix</span>&gt;</span>lib/<span class="hljs-tag">&lt;/<span class="hljs-name">classpathPrefix</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.Main<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="æ‰“åŒ…äº§ç‰©-1"><a href="#æ‰“åŒ…äº§ç‰©-1" class="headerlink" title="æ‰“åŒ…äº§ç‰©"></a>æ‰“åŒ…äº§ç‰©</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">target/<br>â”œâ”€â”€ my-app-1.0.0.jar          <span class="hljs-comment"># ç˜¦ JARï¼ˆåªæœ‰æœ¬æ¨¡å—ä»£ç ï¼Œå‡ ç™¾ KBï¼‰</span><br>â””â”€â”€ lib/                      <span class="hljs-comment"># ä¾èµ–ç›®å½•</span><br>    â”œâ”€â”€ my-common-1.0.0.jar<br>    â”œâ”€â”€ my-service-1.0.0.jar<br>    â”œâ”€â”€ spring-boot-3.2.0.jar<br>    â””â”€â”€ ...<br></code></pre></td></tr></table></figure><h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ–¹å¼ 1ï¼šç›´æ¥è¿è¡Œï¼ˆMANIFEST.MF å·²é…ç½® classpathï¼‰</span><br>java -jar target/my-app-1.0.0.jar<br><br><span class="hljs-comment"># æ–¹å¼ 2ï¼šæ‰‹åŠ¨æŒ‡å®š classpath</span><br>java -<span class="hljs-built_in">cp</span> <span class="hljs-string">&quot;target/my-app-1.0.0.jar:target/lib/*&quot;</span> com.example.Main<br></code></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ›´æ–°å•ä¸ªæ¨¡å—æ—¶ï¼Œåªéœ€æ›¿æ¢å¯¹åº”çš„ JAR</li><li>ä¾èµ–å¯å¤ç”¨ï¼Œå¤šä¸ªåº”ç”¨å…±äº«</li><li>JAR æ–‡ä»¶å°ï¼Œä¼ è¾“å¿«</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>éƒ¨ç½²æ—¶éœ€è¦ä¿æŒç›®å½•ç»“æ„</li><li>ä¸å¦‚å• JAR æ–¹ä¾¿</li></ul><hr><h2 id="å¸¸ç”¨æ‰“åŒ…å‘½ä»¤"><a href="#å¸¸ç”¨æ‰“åŒ…å‘½ä»¤" class="headerlink" title="å¸¸ç”¨æ‰“åŒ…å‘½ä»¤"></a>å¸¸ç”¨æ‰“åŒ…å‘½ä»¤</h2><h3 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ¸…ç† + æ‰“åŒ…ï¼ˆè·³è¿‡æµ‹è¯•ï¼‰</span><br>mvn clean package -DskipTests<br><br><span class="hljs-comment"># æ¸…ç† + æ‰“åŒ… + å®‰è£…åˆ°æœ¬åœ°ä»“åº“</span><br>mvn clean install<br><br><span class="hljs-comment"># åªæ‰“åŒ…ç‰¹å®šæ¨¡å—</span><br>mvn clean package -pl my-app<br><br><span class="hljs-comment"># æ‰“åŒ…æ¨¡å—åŠå…¶ä¾èµ–</span><br>mvn clean package -pl my-app -am<br><br><span class="hljs-comment"># æ‰“åŒ…å¤šä¸ªæ¨¡å—</span><br>mvn clean package -pl my-common,my-service<br><br><span class="hljs-comment"># è·³è¿‡æŸä¸ªæ¨¡å—</span><br>mvn clean package -pl !my-test<br><br><span class="hljs-comment"># å¹¶è¡Œæ„å»ºï¼ˆåŠ é€Ÿï¼‰</span><br>mvn clean package -T 4<br></code></pre></td></tr></table></figure><h3 id="å¤šç¯å¢ƒæ‰“åŒ…"><a href="#å¤šç¯å¢ƒæ‰“åŒ…" class="headerlink" title="å¤šç¯å¢ƒæ‰“åŒ…"></a>å¤šç¯å¢ƒæ‰“åŒ…</h3><p>ä½¿ç”¨ Maven Profile å®ç°å¤šç¯å¢ƒæ‰“åŒ…ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- çˆ¶ POM ä¸­å®šä¹‰ profiles --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- å¼€å‘ç¯å¢ƒ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">activeByDefault</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">activeByDefault</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">spring.profiles.active</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">spring.profiles.active</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- æµ‹è¯•ç¯å¢ƒ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">spring.profiles.active</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">spring.profiles.active</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">spring.profiles.active</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">spring.profiles.active</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ‰“åŒ…å‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¼€å‘ç¯å¢ƒï¼ˆé»˜è®¤ï¼‰</span><br>mvn clean package<br><br><span class="hljs-comment"># æµ‹è¯•ç¯å¢ƒ</span><br>mvn clean package -Ptest<br><br><span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒ</span><br>mvn clean package -Pprod<br><br><span class="hljs-comment"># åŒæ—¶æ¿€æ´»å¤šä¸ª profile</span><br>mvn clean package -Ptest,docker<br></code></pre></td></tr></table></figure><p><strong>èµ„æºè¿‡æ»¤</strong>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>application.yml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>application-$&#123;env&#125;.yml<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h2 id="æ‰“åŒ…ä¼˜åŒ–"><a href="#æ‰“åŒ…ä¼˜åŒ–" class="headerlink" title="æ‰“åŒ…ä¼˜åŒ–"></a>æ‰“åŒ…ä¼˜åŒ–</h2><h3 id="1-æ’é™¤ä¸å¿…è¦çš„ä¾èµ–"><a href="#1-æ’é™¤ä¸å¿…è¦çš„ä¾èµ–" class="headerlink" title="1. æ’é™¤ä¸å¿…è¦çš„ä¾èµ–"></a>1. æ’é™¤ä¸å¿…è¦çš„ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- æ’é™¤ provided scope çš„ä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>  <span class="hljs-comment">&lt;!-- ç¼–è¯‘æ—¶éœ€è¦ï¼Œè¿è¡Œæ—¶ä¸éœ€è¦ --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- æ’é™¤ä¼ é€’ä¾èµ– --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="2-ä¾èµ–åˆ†æ"><a href="#2-ä¾èµ–åˆ†æ" class="headerlink" title="2. ä¾èµ–åˆ†æ"></a>2. ä¾èµ–åˆ†æ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹ä¾èµ–æ ‘</span><br>mvn dependency:tree<br><br><span class="hljs-comment"># åˆ†æä¾èµ–å†²çª</span><br>mvn dependency:tree -Dverbose<br><br><span class="hljs-comment"># æŸ¥çœ‹ç›´æ¥ä¾èµ–</span><br>mvn dependency:list<br><br><span class="hljs-comment"># åˆ†ææœªä½¿ç”¨çš„ä¾èµ–</span><br>mvn dependency:analyze<br></code></pre></td></tr></table></figure><h3 id="3-å‹ç¼©-JAR-åŒ…"><a href="#3-å‹ç¼©-JAR-åŒ…" class="headerlink" title="3. å‹ç¼© JAR åŒ…"></a>3. å‹ç¼© JAR åŒ…</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-jar-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">compress</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">compress</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">index</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">index</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="4-è·³è¿‡ä¸å¿…è¦çš„æ­¥éª¤"><a href="#4-è·³è¿‡ä¸å¿…è¦çš„æ­¥éª¤" class="headerlink" title="4. è·³è¿‡ä¸å¿…è¦çš„æ­¥éª¤"></a>4. è·³è¿‡ä¸å¿…è¦çš„æ­¥éª¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è·³è¿‡æµ‹è¯•</span><br>mvn clean package -DskipTests<br><br><span class="hljs-comment"># è·³è¿‡æµ‹è¯•ç¼–è¯‘å’Œæ‰§è¡Œ</span><br>mvn clean package -Dmaven.test.skip=<span class="hljs-literal">true</span><br><br><span class="hljs-comment"># è·³è¿‡ Javadoc ç”Ÿæˆ</span><br>mvn clean package -Dmaven.javadoc.skip=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><hr><h2 id="Docker-é•œåƒæ‰“åŒ…"><a href="#Docker-é•œåƒæ‰“åŒ…" class="headerlink" title="Docker é•œåƒæ‰“åŒ…"></a>Docker é•œåƒæ‰“åŒ…</h2><h3 id="æ–¹å¼ä¸€ï¼šDockerfile-Maven-æ‰“åŒ…"><a href="#æ–¹å¼ä¸€ï¼šDockerfile-Maven-æ‰“åŒ…" class="headerlink" title="æ–¹å¼ä¸€ï¼šDockerfile + Maven æ‰“åŒ…"></a>æ–¹å¼ä¸€ï¼šDockerfile + Maven æ‰“åŒ…</h3><h4 id="1-Maven-æ‰“åŒ…å¯æ‰§è¡Œ-JAR"><a href="#1-Maven-æ‰“åŒ…å¯æ‰§è¡Œ-JAR" class="headerlink" title="1. Maven æ‰“åŒ…å¯æ‰§è¡Œ JAR"></a>1. Maven æ‰“åŒ…å¯æ‰§è¡Œ JAR</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean package -DskipTests<br></code></pre></td></tr></table></figure><h4 id="2-ç¼–å†™-Dockerfile"><a href="#2-ç¼–å†™-Dockerfile" class="headerlink" title="2. ç¼–å†™ Dockerfile"></a>2. ç¼–å†™ Dockerfile</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># å¤šé˜¶æ®µæ„å»ºï¼ˆæ¨èï¼‰</span><br><span class="hljs-keyword">FROM</span> eclipse-temurin:<span class="hljs-number">17</span>-jdk-alpine AS builder<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><br><span class="hljs-comment"># å¤åˆ¶ Maven é…ç½®å’Œæºç </span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> pom.xml .</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> my-common ./my-common</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> my-service ./my-service</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> my-app ./my-app</span><br><br><span class="hljs-comment"># Maven æ‰“åŒ…</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> ./mvnw clean package -DskipTests</span><br><br><span class="hljs-comment"># è¿è¡Œé˜¶æ®µ</span><br><span class="hljs-keyword">FROM</span> eclipse-temurin:<span class="hljs-number">17</span>-jre-alpine<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><br><span class="hljs-comment"># å¤åˆ¶æ„å»ºäº§ç‰©</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder /app/my-app/target/my-app-1.0.0.jar app.jar</span><br><br><span class="hljs-comment"># æš´éœ²ç«¯å£</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br><br><span class="hljs-comment"># å¯åŠ¨å‘½ä»¤</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-jar&quot;</span>, <span class="hljs-string">&quot;app.jar&quot;</span>]</span><br></code></pre></td></tr></table></figure><p><strong>ç®€åŒ–ç‰ˆï¼ˆæœ¬åœ°å·²æ‰“åŒ…ï¼‰</strong>ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> eclipse-temurin:<span class="hljs-number">17</span>-jre-alpine<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> my-app/target/my-app-1.0.0.jar app.jar</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-jar&quot;</span>, <span class="hljs-string">&quot;app.jar&quot;</span>]</span><br></code></pre></td></tr></table></figure><h4 id="3-æ„å»ºé•œåƒ"><a href="#3-æ„å»ºé•œåƒ" class="headerlink" title="3. æ„å»ºé•œåƒ"></a>3. æ„å»ºé•œåƒ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ„å»ºé•œåƒ</span><br>docker build -t my-app:1.0.0 .<br><br><span class="hljs-comment"># è¿è¡Œå®¹å™¨</span><br>docker run -d -p 8080:8080 my-app:1.0.0<br></code></pre></td></tr></table></figure><hr><h3 id="æ–¹å¼äºŒï¼šJib-Maven-Pluginï¼ˆæ— éœ€-Dockerfileï¼‰"><a href="#æ–¹å¼äºŒï¼šJib-Maven-Pluginï¼ˆæ— éœ€-Dockerfileï¼‰" class="headerlink" title="æ–¹å¼äºŒï¼šJib Maven Pluginï¼ˆæ— éœ€ Dockerfileï¼‰"></a>æ–¹å¼äºŒï¼šJib Maven Pluginï¼ˆæ— éœ€ Dockerfileï¼‰</h3><p>Jib æ˜¯ Google å¼€æºçš„ Maven&#x2F;Gradle æ’ä»¶ï¼Œæ— éœ€ Dockerfile å³å¯æ„å»º Docker é•œåƒã€‚</p><h4 id="é…ç½®-1"><a href="#é…ç½®-1" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- Jib æ’ä»¶ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.cloud.tools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jib-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- åŸºç¡€é•œåƒ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">image</span>&gt;</span>eclipse-temurin:17-jre-alpine<span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- ç›®æ ‡é•œåƒ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">image</span>&gt;</span>my-app<span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">tags</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">tag</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">tag</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">tag</span>&gt;</span>latest<span class="hljs-tag">&lt;/<span class="hljs-name">tag</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">tags</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- å®¹å™¨é…ç½® --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">container</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">jvmFlags</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">jvmFlag</span>&gt;</span>-Xms512m<span class="hljs-tag">&lt;/<span class="hljs-name">jvmFlag</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">jvmFlag</span>&gt;</span>-Xmx1024m<span class="hljs-tag">&lt;/<span class="hljs-name">jvmFlag</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">jvmFlags</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">ports</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>8080<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">ports</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.MyApplication<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">creationTime</span>&gt;</span>USE_CURRENT_TIMESTAMP<span class="hljs-tag">&lt;/<span class="hljs-name">creationTime</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">container</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="æ„å»ºå‘½ä»¤"><a href="#æ„å»ºå‘½ä»¤" class="headerlink" title="æ„å»ºå‘½ä»¤"></a>æ„å»ºå‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ„å»ºåˆ°æœ¬åœ° Docker</span><br>mvn compile jib:dockerBuild<br><br><span class="hljs-comment"># æ„å»ºå¹¶æ¨é€åˆ° Docker Hub</span><br>mvn compile jib:build<br><br><span class="hljs-comment"># æ„å»ºåˆ° tar æ–‡ä»¶</span><br>mvn compile jib:buildTar<br></code></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>æ— éœ€å®‰è£… Docker</li><li>æ— éœ€ç¼–å†™ Dockerfile</li><li>æ„å»ºé€Ÿåº¦å¿«ï¼ˆå¢é‡æ„å»ºï¼‰</li><li>è‡ªåŠ¨ä¼˜åŒ–é•œåƒåˆ†å±‚</li></ul><hr><h3 id="æ–¹å¼ä¸‰ï¼šSpring-Boot-Maven-Plugin-æ„å»ºé•œåƒ"><a href="#æ–¹å¼ä¸‰ï¼šSpring-Boot-Maven-Plugin-æ„å»ºé•œåƒ" class="headerlink" title="æ–¹å¼ä¸‰ï¼šSpring Boot Maven Plugin æ„å»ºé•œåƒ"></a>æ–¹å¼ä¸‰ï¼šSpring Boot Maven Plugin æ„å»ºé•œåƒ</h3><p>Spring Boot 2.3+ å†…ç½®äº†é•œåƒæ„å»ºåŠŸèƒ½ï¼ˆä½¿ç”¨ Cloud Native Buildpacksï¼‰ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">image</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>my-app:$&#123;project.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">BP_JVM_VERSION</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">BP_JVM_VERSION</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>æ„å»ºå‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ„å»ºé•œåƒ</span><br>mvn spring-boot:build-image<br><br><span class="hljs-comment"># æ¨é€é•œåƒ</span><br>mvn spring-boot:build-image -Dspring-boot.build-image.publish=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><hr><h2 id="å®æˆ˜æ¡ˆä¾‹"><a href="#å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="å®æˆ˜æ¡ˆä¾‹"></a>å®æˆ˜æ¡ˆä¾‹</h2><h3 id="åœºæ™¯-1ï¼šå¾®æœåŠ¡é¡¹ç›®æ‰“åŒ…"><a href="#åœºæ™¯-1ï¼šå¾®æœåŠ¡é¡¹ç›®æ‰“åŒ…" class="headerlink" title="åœºæ™¯ 1ï¼šå¾®æœåŠ¡é¡¹ç›®æ‰“åŒ…"></a>åœºæ™¯ 1ï¼šå¾®æœåŠ¡é¡¹ç›®æ‰“åŒ…</h3><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix">microservices-project<span class="hljs-symbol">/</span><br>â”œâ”€â”€ pom.xml                    <span class="hljs-comment"># çˆ¶ POM</span><br>â”œâ”€â”€ common<span class="hljs-symbol">/</span>                    <span class="hljs-comment"># å…¬å…±æ¨¡å—ï¼ˆæ™®é€š JARï¼‰</span><br>â”œâ”€â”€ user-service<span class="hljs-symbol">/</span>              <span class="hljs-comment"># ç”¨æˆ·æœåŠ¡ï¼ˆå¯æ‰§è¡Œ JARï¼‰</span><br>â”œâ”€â”€ order-service<span class="hljs-symbol">/</span>             <span class="hljs-comment"># è®¢å•æœåŠ¡ï¼ˆå¯æ‰§è¡Œ JARï¼‰</span><br>â””â”€â”€ gateway<span class="hljs-symbol">/</span>                   <span class="hljs-comment"># ç½‘å…³ï¼ˆå¯æ‰§è¡Œ JARï¼‰</span><br></code></pre></td></tr></table></figure><h4 id="çˆ¶-POM"><a href="#çˆ¶-POM" class="headerlink" title="çˆ¶ POM"></a>çˆ¶ POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">spring-boot.version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">spring-boot.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- ç»Ÿä¸€é…ç½® Spring Boot æ’ä»¶ --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>repackage<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="å…¬å…±æ¨¡å—-POMï¼ˆcommonï¼‰"><a href="#å…¬å…±æ¨¡å—-POMï¼ˆcommonï¼‰" class="headerlink" title="å…¬å…±æ¨¡å— POMï¼ˆcommonï¼‰"></a>å…¬å…±æ¨¡å— POMï¼ˆcommonï¼‰</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-comment">&lt;!-- ä¸éœ€è¦ä»»ä½•æ‰“åŒ…æ’ä»¶ï¼Œé»˜è®¤æ‰“åŒ…æˆæ™®é€š JAR --&gt;</span><br></code></pre></td></tr></table></figure><h4 id="æœåŠ¡æ¨¡å—-POMï¼ˆuser-serviceï¼‰"><a href="#æœåŠ¡æ¨¡å—-POMï¼ˆuser-serviceï¼‰" class="headerlink" title="æœåŠ¡æ¨¡å— POMï¼ˆuser-serviceï¼‰"></a>æœåŠ¡æ¨¡å— POMï¼ˆuser-serviceï¼‰</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>user-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ä½¿ç”¨çˆ¶ POM ä¸­é…ç½®çš„ Spring Boot æ’ä»¶ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="æ‰“åŒ…å‘½ä»¤"><a href="#æ‰“åŒ…å‘½ä»¤" class="headerlink" title="æ‰“åŒ…å‘½ä»¤"></a>æ‰“åŒ…å‘½ä»¤</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ‰“åŒ…æ‰€æœ‰æœåŠ¡</span><br>mvn clean package -DskipTests<br><br><span class="hljs-comment"># åªæ‰“åŒ…ç”¨æˆ·æœåŠ¡</span><br>mvn clean package -pl user-service -am -DskipTests<br><br><span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…</span><br>mvn clean package -Pprod -DskipTests<br></code></pre></td></tr></table></figure><h4 id="äº§ç‰©"><a href="#äº§ç‰©" class="headerlink" title="äº§ç‰©"></a>äº§ç‰©</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">common/target/common-1.0.0.jar                     <span class="hljs-comment"># æ™®é€š JAR</span><br>user-service/target/user-service-1.0.0.jar         <span class="hljs-comment"># å¯æ‰§è¡Œ JAR</span><br>order-service/target/order-service-1.0.0.jar       <span class="hljs-comment"># å¯æ‰§è¡Œ JAR</span><br>gateway/target/gateway-1.0.0.jar                   <span class="hljs-comment"># å¯æ‰§è¡Œ JAR</span><br></code></pre></td></tr></table></figure><hr><h3 id="åœºæ™¯-2ï¼šæ¡†æ¶é¡¹ç›®æ‰“åŒ…ï¼ˆä¾›ç¬¬ä¸‰æ–¹ä½¿ç”¨ï¼‰"><a href="#åœºæ™¯-2ï¼šæ¡†æ¶é¡¹ç›®æ‰“åŒ…ï¼ˆä¾›ç¬¬ä¸‰æ–¹ä½¿ç”¨ï¼‰" class="headerlink" title="åœºæ™¯ 2ï¼šæ¡†æ¶é¡¹ç›®æ‰“åŒ…ï¼ˆä¾›ç¬¬ä¸‰æ–¹ä½¿ç”¨ï¼‰"></a>åœºæ™¯ 2ï¼šæ¡†æ¶é¡¹ç›®æ‰“åŒ…ï¼ˆä¾›ç¬¬ä¸‰æ–¹ä½¿ç”¨ï¼‰</h3><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix">rag-framework<span class="hljs-symbol">/</span><br>â”œâ”€â”€ pom.xml                    <span class="hljs-comment"># çˆ¶ POM</span><br>â”œâ”€â”€ rag-core<span class="hljs-symbol">/</span>                  <span class="hljs-comment"># æ ¸å¿ƒæ¨¡å—ï¼ˆæ™®é€š JARï¼‰</span><br>â”œâ”€â”€ rag-store-pgvector<span class="hljs-symbol">/</span>        <span class="hljs-comment"># å®ç°æ¨¡å—ï¼ˆæ™®é€š JARï¼‰</span><br>â”œâ”€â”€ rag-spring-boot-starter<span class="hljs-symbol">/</span>   <span class="hljs-comment"># Starterï¼ˆæ™®é€š JARï¼‰</span><br>â””â”€â”€ rag-app<span class="hljs-symbol">/</span>                   <span class="hljs-comment"># ç¤ºä¾‹åº”ç”¨ï¼ˆå¯æ‰§è¡Œ JARï¼‰</span><br></code></pre></td></tr></table></figure><h4 id="æ ¸å¿ƒæ¨¡å—å’Œå®ç°æ¨¡å—"><a href="#æ ¸å¿ƒæ¨¡å—å’Œå®ç°æ¨¡å—" class="headerlink" title="æ ¸å¿ƒæ¨¡å—å’Œå®ç°æ¨¡å—"></a>æ ¸å¿ƒæ¨¡å—å’Œå®ç°æ¨¡å—</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag-core/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-comment">&lt;!-- ä¸éœ€è¦ç‰¹æ®Šé…ç½®ï¼Œæ‰“åŒ…æˆæ™®é€š JAR --&gt;</span><br><br><span class="hljs-comment">&lt;!-- rag-store-pgvector/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-store-pgvector<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-comment">&lt;!-- æ‰“åŒ…æˆæ™®é€š JARï¼Œä¾›ç”¨æˆ·æŒ‰éœ€å¼•å…¥ --&gt;</span><br></code></pre></td></tr></table></figure><h4 id="å‘å¸ƒåˆ°-Maven-ä»“åº“"><a href="#å‘å¸ƒåˆ°-Maven-ä»“åº“" class="headerlink" title="å‘å¸ƒåˆ° Maven ä»“åº“"></a>å‘å¸ƒåˆ° Maven ä»“åº“</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ„å»ºå¹¶å®‰è£…åˆ°æœ¬åœ°</span><br>mvn clean install<br><br><span class="hljs-comment"># éƒ¨ç½²åˆ°ç§æœ‰ä»“åº“ï¼ˆéœ€é…ç½® distributionManagementï¼‰</span><br>mvn clean deploy<br><br><span class="hljs-comment"># å‘å¸ƒåˆ° Maven ä¸­å¤®ä»“åº“ï¼ˆéœ€é…ç½® GPG ç­¾åç­‰ï¼‰</span><br>mvn clean deploy -P release<br></code></pre></td></tr></table></figure><h4 id="ç”¨æˆ·ä½¿ç”¨"><a href="#ç”¨æˆ·ä½¿ç”¨" class="headerlink" title="ç”¨æˆ·ä½¿ç”¨"></a>ç”¨æˆ·ä½¿ç”¨</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ç”¨æˆ·é¡¹ç›® pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- å¼•å…¥æ ¸å¿ƒ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- æŒ‰éœ€å¼•å…¥å®ç° --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-store-pgvector<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="Q1-Spring-Boot-æ‰“åŒ…å-JAR-å¾ˆå¤§æ€ä¹ˆåŠï¼Ÿ"><a href="#Q1-Spring-Boot-æ‰“åŒ…å-JAR-å¾ˆå¤§æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="Q1: Spring Boot æ‰“åŒ…å JAR å¾ˆå¤§æ€ä¹ˆåŠï¼Ÿ"></a>Q1: Spring Boot æ‰“åŒ…å JAR å¾ˆå¤§æ€ä¹ˆåŠï¼Ÿ</h3><p><strong>A</strong>: å‡ ç§ä¼˜åŒ–æ–¹å¼ï¼š</p><ol><li><p><strong>æ’é™¤ä¸å¿…è¦çš„ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ç˜¦ JAR + lib ç›®å½•</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span>&gt;</span>ZIP<span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ Docker åˆ†å±‚æ„å»º</strong></p><ul><li>ä¾èµ–å±‚å•ç‹¬ç¼“å­˜ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½æ‰“åŒ…</li></ul></li></ol><hr><h3 id="Q2-å¤šæ¨¡å—æ‰“åŒ…æ—¶å‡ºç°-â€œCould-not-resolve-dependenciesâ€-é”™è¯¯ï¼Ÿ"><a href="#Q2-å¤šæ¨¡å—æ‰“åŒ…æ—¶å‡ºç°-â€œCould-not-resolve-dependenciesâ€-é”™è¯¯ï¼Ÿ" class="headerlink" title="Q2: å¤šæ¨¡å—æ‰“åŒ…æ—¶å‡ºç° â€œCould not resolve dependenciesâ€ é”™è¯¯ï¼Ÿ"></a>Q2: å¤šæ¨¡å—æ‰“åŒ…æ—¶å‡ºç° â€œCould not resolve dependenciesâ€ é”™è¯¯ï¼Ÿ</h3><p><strong>A</strong>: åŸå› å’Œè§£å†³æ–¹æ³•ï¼š</p><ol><li><p><strong>æ¨¡å—æœªå®‰è£…åˆ°æœ¬åœ°ä»“åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å…ˆ install ä¾èµ–çš„æ¨¡å—</span><br>mvn clean install -pl common -am<br></code></pre></td></tr></table></figure></li><li><p><strong>ç‰ˆæœ¬ä¸ä¸€è‡´</strong></p><ul><li>æ£€æŸ¥å­æ¨¡å—ç‰ˆæœ¬æ˜¯å¦ä¸çˆ¶ POM ä¸€è‡´</li><li>ä½¿ç”¨ <code>${project.version}</code> å¼•ç”¨</li></ul></li><li><p><strong>æ„å»ºé¡ºåºé”™è¯¯</strong></p><ul><li>Maven ä¼šè‡ªåŠ¨è®¡ç®—ä¾èµ–é¡ºåº</li><li>ä½¿ç”¨ <code>-am</code> å‚æ•°æ„å»ºä¾èµ–æ¨¡å—</li></ul></li></ol><hr><h3 id="Q3-å¦‚ä½•åœ¨æ‰“åŒ…æ—¶æŒ‡å®šä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Ÿ"><a href="#Q3-å¦‚ä½•åœ¨æ‰“åŒ…æ—¶æŒ‡å®šä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Ÿ" class="headerlink" title="Q3: å¦‚ä½•åœ¨æ‰“åŒ…æ—¶æŒ‡å®šä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Ÿ"></a>Q3: å¦‚ä½•åœ¨æ‰“åŒ…æ—¶æŒ‡å®šä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Ÿ</h3><p><strong>A</strong>: ä½¿ç”¨ Maven Profile + èµ„æºè¿‡æ»¤ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">config.file</span>&gt;</span>application-dev.yml<span class="hljs-tag">&lt;/<span class="hljs-name">config.file</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">config.file</span>&gt;</span>application-prod.yml<span class="hljs-tag">&lt;/<span class="hljs-name">config.file</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">filtering</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">filtering</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æ‰“åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean package -Pprod<br></code></pre></td></tr></table></figure><hr><h3 id="Q4-å¦‚ä½•ç”Ÿæˆæºç -JAR-å’Œ-Javadoc-JARï¼Ÿ"><a href="#Q4-å¦‚ä½•ç”Ÿæˆæºç -JAR-å’Œ-Javadoc-JARï¼Ÿ" class="headerlink" title="Q4: å¦‚ä½•ç”Ÿæˆæºç  JAR å’Œ Javadoc JARï¼Ÿ"></a>Q4: å¦‚ä½•ç”Ÿæˆæºç  JAR å’Œ Javadoc JARï¼Ÿ</h3><p><strong>A</strong>: ç”¨äºå‘å¸ƒåˆ° Maven ä»“åº“ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æºç  JAR --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-source-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>attach-sources<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- Javadoc JAR --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>attach-javadocs<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h3 id="Q5-æ‰“åŒ…æ—¶å¦‚ä½•è·³è¿‡æŸäº›æ¨¡å—ï¼Ÿ"><a href="#Q5-æ‰“åŒ…æ—¶å¦‚ä½•è·³è¿‡æŸäº›æ¨¡å—ï¼Ÿ" class="headerlink" title="Q5: æ‰“åŒ…æ—¶å¦‚ä½•è·³è¿‡æŸäº›æ¨¡å—ï¼Ÿ"></a>Q5: æ‰“åŒ…æ—¶å¦‚ä½•è·³è¿‡æŸäº›æ¨¡å—ï¼Ÿ</h3><p><strong>A</strong>: ä½¿ç”¨ <code>-pl</code> å’Œ <code>!</code> æ’é™¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è·³è¿‡æµ‹è¯•æ¨¡å—</span><br>mvn clean package -pl !test-module<br><br><span class="hljs-comment"># åªæ‰“åŒ…æŒ‡å®šæ¨¡å—</span><br>mvn clean package -pl user-service,order-service<br></code></pre></td></tr></table></figure><hr><h2 id="æ‰“åŒ…æœ€ä½³å®è·µ"><a href="#æ‰“åŒ…æœ€ä½³å®è·µ" class="headerlink" title="æ‰“åŒ…æœ€ä½³å®è·µ"></a>æ‰“åŒ…æœ€ä½³å®è·µ</h2><h3 id="1-æ¨¡å—èŒè´£æ¸…æ™°"><a href="#1-æ¨¡å—èŒè´£æ¸…æ™°" class="headerlink" title="1. æ¨¡å—èŒè´£æ¸…æ™°"></a>1. æ¨¡å—èŒè´£æ¸…æ™°</h3><table><thead><tr><th>æ¨¡å—ç±»å‹</th><th>æ‰“åŒ…æ–¹å¼</th><th>å‘å¸ƒ</th></tr></thead><tbody><tr><td><strong>å…¬å…±æ¨¡å—</strong></td><td>æ™®é€š JAR</td><td>install åˆ°æœ¬åœ°ä»“åº“</td></tr><tr><td><strong>æœåŠ¡æ¨¡å—</strong></td><td>æ™®é€š JAR æˆ–å¯æ‰§è¡Œ JAR</td><td>çœ‹æ˜¯å¦ç‹¬ç«‹è¿è¡Œ</td></tr><tr><td><strong>å¯åŠ¨æ¨¡å—</strong></td><td>å¯æ‰§è¡Œ JAR</td><td>éƒ¨ç½²</td></tr></tbody></table><h3 id="2-ç»Ÿä¸€ç®¡ç†æ’ä»¶ç‰ˆæœ¬"><a href="#2-ç»Ÿä¸€ç®¡ç†æ’ä»¶ç‰ˆæœ¬" class="headerlink" title="2. ç»Ÿä¸€ç®¡ç†æ’ä»¶ç‰ˆæœ¬"></a>2. ç»Ÿä¸€ç®¡ç†æ’ä»¶ç‰ˆæœ¬</h3><p>åœ¨çˆ¶ POM çš„ <code>pluginManagement</code> ä¸­ç»Ÿä¸€é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-jar-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3-ä½¿ç”¨-Profile-ç®¡ç†å¤šç¯å¢ƒ"><a href="#3-ä½¿ç”¨-Profile-ç®¡ç†å¤šç¯å¢ƒ" class="headerlink" title="3. ä½¿ç”¨ Profile ç®¡ç†å¤šç¯å¢ƒ"></a>3. ä½¿ç”¨ Profile ç®¡ç†å¤šç¯å¢ƒ</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">activeByDefault</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">activeByDefault</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="4-ä¼˜åŒ–æ„å»ºé€Ÿåº¦"><a href="#4-ä¼˜åŒ–æ„å»ºé€Ÿåº¦" class="headerlink" title="4. ä¼˜åŒ–æ„å»ºé€Ÿåº¦"></a>4. ä¼˜åŒ–æ„å»ºé€Ÿåº¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¹¶è¡Œæ„å»º</span><br>mvn clean package -T 4<br><br><span class="hljs-comment"># è·³è¿‡æµ‹è¯•</span><br>mvn clean package -DskipTests<br><br><span class="hljs-comment"># ç¦»çº¿æ¨¡å¼ï¼ˆä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼‰</span><br>mvn clean package -o<br></code></pre></td></tr></table></figure><h3 id="5-ä¾èµ–ç®¡ç†"><a href="#5-ä¾èµ–ç®¡ç†" class="headerlink" title="5. ä¾èµ–ç®¡ç†"></a>5. ä¾èµ–ç®¡ç†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®šæœŸåˆ†æä¾èµ–</span><br>mvn dependency:analyze<br><br><span class="hljs-comment"># æ£€æŸ¥ç‰ˆæœ¬å†²çª</span><br>mvn dependency:tree -Dverbose<br><br><span class="hljs-comment"># æ¸…ç†æœªä½¿ç”¨çš„ä¾èµ–</span><br>mvn dependency:purge-local-repository<br></code></pre></td></tr></table></figure><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table><thead><tr><th>æ‰“åŒ…æ–¹å¼</th><th>é€‚ç”¨åœºæ™¯</th><th>å‘½ä»¤</th><th>äº§ç‰©å¤§å°</th></tr></thead><tbody><tr><td><strong>æ™®é€š JAR</strong></td><td>å…¬å…±æ¨¡å—ã€è¢«ä¾èµ–æ¨¡å—</td><td><code>mvn package</code></td><td>å°</td></tr><tr><td><strong>å¯æ‰§è¡Œ JARï¼ˆSpring Bootï¼‰</strong></td><td>å¯åŠ¨æ¨¡å—ã€å¾®æœåŠ¡</td><td><code>mvn package</code></td><td>å¤§</td></tr><tr><td><strong>ç˜¦ JAR + lib</strong></td><td>éœ€è¦åˆ†ç¦»ä¾èµ–çš„åœºæ™¯</td><td><code>mvn package</code></td><td>å° + lib ç›®å½•</td></tr><tr><td><strong>Docker é•œåƒ</strong></td><td>å®¹å™¨åŒ–éƒ¨ç½²</td><td><code>mvn jib:dockerBuild</code></td><td>é•œåƒ</td></tr></tbody></table><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li>çˆ¶æ¨¡å— <code>packaging=pom</code>ï¼Œä¸æ‰“åŒ…</li><li>å…¬å…±æ¨¡å—æ‰“åŒ…æˆæ™®é€š JARï¼Œ<code>install</code> åˆ°æœ¬åœ°ä»“åº“</li><li>å¯åŠ¨æ¨¡å—ä½¿ç”¨ Spring Boot Maven Plugin æ‰“åŒ…æˆå¯æ‰§è¡Œ JAR</li><li>ä½¿ç”¨ Profile ç®¡ç†å¤šç¯å¢ƒé…ç½®</li><li>ä½¿ç”¨ <code>-pl</code> å’Œ <code>-am</code> ç²¾ç¡®æ§åˆ¶æ‰“åŒ…èŒƒå›´</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Maven</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Maven</tag>
      
      <tag>æ‰“åŒ…</tag>
      
      <tag>å¤šæ¨¡å—</tag>
      
      <tag>éƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤šæ¨¡å—é¡¹ç›®è®¾è®¡</title>
    <link href="/2026/01/12/%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E8%AE%BE%E8%AE%A1/"/>
    <url>/2026/01/12/%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E8%AE%BE%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="Maven-å¤šæ¨¡å—é¡¹ç›®è®¾è®¡"><a href="#Maven-å¤šæ¨¡å—é¡¹ç›®è®¾è®¡" class="headerlink" title="Maven å¤šæ¨¡å—é¡¹ç›®è®¾è®¡"></a>Maven å¤šæ¨¡å—é¡¹ç›®è®¾è®¡</h1><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><p>Maven å¤šæ¨¡å—é¡¹ç›®æ˜¯ä¸€ä¸ª<strong>çˆ¶é¡¹ç›®</strong>åŒ…å«å¤šä¸ª<strong>å­æ¨¡å—</strong>çš„ç»“æ„ï¼Œé€šè¿‡ç»Ÿä¸€çš„ POM æ–‡ä»¶ç®¡ç†ä¾èµ–ç‰ˆæœ¬ã€ç¼–è¯‘é…ç½®ç­‰ï¼Œå®ç°ä»£ç å¤ç”¨å’Œé¡¹ç›®è§£è€¦ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨å¤šæ¨¡å—ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨å¤šæ¨¡å—ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨å¤šæ¨¡å—ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨å¤šæ¨¡å—ï¼Ÿ</h3><table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ä¾èµ–ç®¡ç†</strong></td><td>ç»Ÿä¸€ç®¡ç†ç‰ˆæœ¬å·ï¼Œé¿å…ç‰ˆæœ¬å†²çª</td></tr><tr><td><strong>ä»£ç å¤ç”¨</strong></td><td>å…¬å…±ä»£ç æå–åˆ°ç‹¬ç«‹æ¨¡å—</td></tr><tr><td><strong>æ¨¡å—è§£è€¦</strong></td><td>å„æ¨¡å—èŒè´£æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤</td></tr><tr><td><strong>æ„å»ºä¼˜åŒ–</strong></td><td>æ”¯æŒå¢é‡æ„å»ºï¼Œæé«˜æ•ˆç‡</td></tr><tr><td><strong>å›¢é˜Ÿåä½œ</strong></td><td>ä¸åŒå›¢é˜Ÿå¯ç‹¬ç«‹å¼€å‘ä¸åŒæ¨¡å—</td></tr></tbody></table><hr><h2 id="å…¸å‹çš„å¤šæ¨¡å—ç»“æ„"><a href="#å…¸å‹çš„å¤šæ¨¡å—ç»“æ„" class="headerlink" title="å…¸å‹çš„å¤šæ¨¡å—ç»“æ„"></a>å…¸å‹çš„å¤šæ¨¡å—ç»“æ„</h2><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">my-project/                    <span class="hljs-comment"># çˆ¶é¡¹ç›®</span><br>â”œâ”€â”€ pom.<span class="hljs-keyword">xml</span>                    <span class="hljs-title"># çˆ¶ POM</span>ï¼ˆèšåˆå’Œä¾èµ–ç®¡ç†ï¼‰<br>â”œâ”€â”€ my-common/                 <span class="hljs-comment"># å…¬å…±æ¨¡å—</span><br>â”‚   â”œâ”€â”€ pom.<span class="hljs-keyword">xml</span><br><span class="hljs-title">â”‚   â””â”€â”€ src</span>/<br>â”œâ”€â”€ my-service/                <span class="hljs-comment"># ä¸šåŠ¡æœåŠ¡æ¨¡å—</span><br>â”‚   â”œâ”€â”€ pom.<span class="hljs-keyword">xml</span><br><span class="hljs-title">â”‚   â””â”€â”€ src</span>/<br>â”œâ”€â”€ my-web/                    <span class="hljs-comment"># Web æ¨¡å—</span><br>â”‚   â”œâ”€â”€ pom.<span class="hljs-keyword">xml</span><br><span class="hljs-title">â”‚   â””â”€â”€ src</span>/<br>â””â”€â”€ my-app/                    <span class="hljs-comment"># åº”ç”¨å¯åŠ¨æ¨¡å—</span><br>    â”œâ”€â”€ pom.<span class="hljs-keyword">xml</span><br>    <span class="hljs-title">â””â”€â”€ src</span>/<br></code></pre></td></tr></table></figure><h3 id="æ¨¡å—åˆ†ç±»"><a href="#æ¨¡å—åˆ†ç±»" class="headerlink" title="æ¨¡å—åˆ†ç±»"></a>æ¨¡å—åˆ†ç±»</h3><ul><li><strong>çˆ¶æ¨¡å—</strong>ï¼šåªåŒ…å« POMï¼Œä¸å«æºä»£ç </li><li><strong>å…¬å…±æ¨¡å—</strong>ï¼šæä¾›é€šç”¨å·¥å…·ã€å¸¸é‡ã€åŸºç±»ç­‰</li><li><strong>ä¸šåŠ¡æ¨¡å—</strong>ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘</li><li><strong>Web&#x2F;API æ¨¡å—</strong>ï¼šå¯¹å¤–æ¥å£å±‚</li><li><strong>å¯åŠ¨æ¨¡å—</strong>ï¼šåº”ç”¨å…¥å£</li></ul><hr><h2 id="çˆ¶-POM-é…ç½®"><a href="#çˆ¶-POM-é…ç½®" class="headerlink" title="çˆ¶ POM é…ç½®"></a>çˆ¶ POM é…ç½®</h2><h3 id="1-èšåˆé…ç½®ï¼ˆAggregationï¼‰"><a href="#1-èšåˆé…ç½®ï¼ˆAggregationï¼‰" class="headerlink" title="1. èšåˆé…ç½®ï¼ˆAggregationï¼‰"></a>1. èšåˆé…ç½®ï¼ˆAggregationï¼‰</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-project<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>  <span class="hljs-comment">&lt;!-- çˆ¶æ¨¡å—å¿…é¡»æ˜¯ pom --&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!-- èšåˆå­æ¨¡å— --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>my-common<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>my-service<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>my-web<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>my-app<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ä½œç”¨</strong>ï¼šæ‰§è¡Œ <code>mvn clean install</code> æ—¶ï¼Œä¼šè‡ªåŠ¨æ„å»ºæ‰€æœ‰å­æ¨¡å—</p><h3 id="2-ä¾èµ–ç®¡ç†ï¼ˆDependency-Managementï¼‰"><a href="#2-ä¾èµ–ç®¡ç†ï¼ˆDependency-Managementï¼‰" class="headerlink" title="2. ä¾èµ–ç®¡ç†ï¼ˆDependency Managementï¼‰"></a>2. ä¾èµ–ç®¡ç†ï¼ˆDependency Managementï¼‰</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- å®šä¹‰ç‰ˆæœ¬ï¼Œå­æ¨¡å—ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;project.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li>åªå£°æ˜ç‰ˆæœ¬ï¼Œä¸å¼•å…¥ä¾èµ–</li><li>å­æ¨¡å—å¯é€‰æ‹©æ˜¯å¦ä½¿ç”¨</li><li>é¿å…ç‰ˆæœ¬å†²çª</li></ul><h3 id="3-æ’ä»¶ç®¡ç†ï¼ˆPlugin-Managementï¼‰"><a href="#3-æ’ä»¶ç®¡ç†ï¼ˆPlugin-Managementï¼‰" class="headerlink" title="3. æ’ä»¶ç®¡ç†ï¼ˆPlugin Managementï¼‰"></a>3. æ’ä»¶ç®¡ç†ï¼ˆPlugin Managementï¼‰</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h2 id="å­æ¨¡å—-POM-é…ç½®"><a href="#å­æ¨¡å—-POM-é…ç½®" class="headerlink" title="å­æ¨¡å— POM é…ç½®"></a>å­æ¨¡å— POM é…ç½®</h2><h3 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!-- ç»§æ‰¿çˆ¶æ¨¡å— --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-project<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Common Module<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!-- ä¾èµ–ï¼ˆç‰ˆæœ¬ä»çˆ¶ POM ç»§æ‰¿ï¼‰ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬ --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="æ¨¡å—é—´ä¾èµ–"><a href="#æ¨¡å—é—´ä¾èµ–" class="headerlink" title="æ¨¡å—é—´ä¾èµ–"></a>æ¨¡å—é—´ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- my-service æ¨¡å—ä¾èµ– my-common --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ç‰ˆæœ¬ä» dependencyManagement ç»§æ‰¿ --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h2 id="è®¾è®¡æœ€ä½³å®è·µ"><a href="#è®¾è®¡æœ€ä½³å®è·µ" class="headerlink" title="è®¾è®¡æœ€ä½³å®è·µ"></a>è®¾è®¡æœ€ä½³å®è·µ</h2><h3 id="1-æ¨¡å—èŒè´£åˆ’åˆ†"><a href="#1-æ¨¡å—èŒè´£åˆ’åˆ†" class="headerlink" title="1. æ¨¡å—èŒè´£åˆ’åˆ†"></a>1. æ¨¡å—èŒè´£åˆ’åˆ†</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">my</span>-project/<br>â”œâ”€â”€ <span class="hljs-keyword">my</span>-common/           <span class="hljs-comment"># å·¥å…·ç±»ã€å¸¸é‡ã€åŸºç±»</span><br>â”œâ”€â”€ <span class="hljs-keyword">my</span>-domain/           <span class="hljs-comment"># é¢†åŸŸæ¨¡å‹ã€å®ä½“</span><br>â”œâ”€â”€ <span class="hljs-keyword">my</span>-repository/       <span class="hljs-comment"># æ•°æ®è®¿é—®å±‚</span><br>â”œâ”€â”€ <span class="hljs-keyword">my</span>-service/          <span class="hljs-comment"># ä¸šåŠ¡é€»è¾‘å±‚</span><br>â”œâ”€â”€ <span class="hljs-keyword">my</span>-controller/       <span class="hljs-comment"># æ§åˆ¶å±‚</span><br>â””â”€â”€ <span class="hljs-keyword">my</span>-app/              <span class="hljs-comment"># å¯åŠ¨æ¨¡å—</span><br></code></pre></td></tr></table></figure><p><strong>ä¾èµ–æµå‘</strong>ï¼š<code>app â†’ controller â†’ service â†’ repository â†’ domain â† common</code></p><h3 id="2-ç‰ˆæœ¬ç®¡ç†ç­–ç•¥"><a href="#2-ç‰ˆæœ¬ç®¡ç†ç­–ç•¥" class="headerlink" title="2. ç‰ˆæœ¬ç®¡ç†ç­–ç•¥"></a>2. ç‰ˆæœ¬ç®¡ç†ç­–ç•¥</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- çˆ¶ POM ä¸­å®šä¹‰ç‰ˆæœ¬å˜é‡ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">project.version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">project.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">spring-boot.version</span>&gt;</span>2.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">spring-boot.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- å­æ¨¡å—å¼•ç”¨ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3-é¿å…å¾ªç¯ä¾èµ–"><a href="#3-é¿å…å¾ªç¯ä¾èµ–" class="headerlink" title="3. é¿å…å¾ªç¯ä¾èµ–"></a>3. é¿å…å¾ªç¯ä¾èµ–</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">âŒ é”™è¯¯ï¼š<span class="hljs-selector-tag">A</span> â†’ <span class="hljs-selector-tag">B</span> â†’ <span class="hljs-selector-tag">A</span><br>âœ… æ­£ç¡®ï¼š<span class="hljs-selector-tag">A</span> â†’ <span class="hljs-selector-tag">B</span> â†’ Cï¼ˆå•å‘ä¾èµ–ï¼‰<br></code></pre></td></tr></table></figure><p><strong>æ£€æŸ¥å‘½ä»¤</strong>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn dependency:tree<br></code></pre></td></tr></table></figure><h3 id="4-æ¨¡å—ç²’åº¦æ§åˆ¶"><a href="#4-æ¨¡å—ç²’åº¦æ§åˆ¶" class="headerlink" title="4. æ¨¡å—ç²’åº¦æ§åˆ¶"></a>4. æ¨¡å—ç²’åº¦æ§åˆ¶</h3><table><thead><tr><th>ç²’åº¦</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>ç²—ç²’åº¦</strong></td><td>æ„å»ºå¿«ï¼Œç®¡ç†ç®€å•</td><td>æ¨¡å—èŒè´£æ··ä¹±</td></tr><tr><td><strong>ç»†ç²’åº¦</strong></td><td>èŒè´£æ¸…æ™°ï¼Œå¤ç”¨æ€§å¥½</td><td>æ„å»ºå¤æ‚ï¼Œä¾èµ–ç®¡ç†å›°éš¾</td></tr></tbody></table><p><strong>å»ºè®®</strong>ï¼šæ ¹æ®å›¢é˜Ÿè§„æ¨¡å’Œé¡¹ç›®å¤æ‚åº¦å¹³è¡¡</p><hr><h2 id="å¸¸ç”¨-Maven-å‘½ä»¤"><a href="#å¸¸ç”¨-Maven-å‘½ä»¤" class="headerlink" title="å¸¸ç”¨ Maven å‘½ä»¤"></a>å¸¸ç”¨ Maven å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ„å»ºæ‰€æœ‰æ¨¡å—</span><br>mvn clean install<br><br><span class="hljs-comment"># æ„å»ºç‰¹å®šæ¨¡å—</span><br>mvn clean install -pl my-common<br><br><span class="hljs-comment"># æ„å»ºæ¨¡å—åŠå…¶ä¾èµ–</span><br>mvn clean install -pl my-service -am<br><br><span class="hljs-comment"># è·³è¿‡æµ‹è¯•</span><br>mvn clean install -DskipTests<br><br><span class="hljs-comment"># æŸ¥çœ‹ä¾èµ–æ ‘</span><br>mvn dependency:tree<br><br><span class="hljs-comment"># æ£€æŸ¥å¾ªç¯ä¾èµ–</span><br>mvn dependency:tree | grep <span class="hljs-string">&quot;CIRCULAR&quot;</span><br></code></pre></td></tr></table></figure><hr><h2 id="å®æˆ˜ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿ"><a href="#å®æˆ˜ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿ" class="headerlink" title="å®æˆ˜ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿ"></a>å®æˆ˜ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿ</h2><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nix">ecommerce-platform<span class="hljs-symbol">/</span><br>â”œâ”€â”€ pom.xml                    <span class="hljs-comment"># çˆ¶ POM</span><br>â”œâ”€â”€ ecommerce-common<span class="hljs-symbol">/</span>          <span class="hljs-comment"># é€šç”¨å·¥å…·ã€å¸¸é‡</span><br>â”œâ”€â”€ ecommerce-domain<span class="hljs-symbol">/</span>          <span class="hljs-comment"># é¢†åŸŸæ¨¡å‹</span><br>â”œâ”€â”€ ecommerce-repository<span class="hljs-symbol">/</span>      <span class="hljs-comment"># æ•°æ®è®¿é—®</span><br>â”œâ”€â”€ ecommerce-service<span class="hljs-symbol">/</span>         <span class="hljs-comment"># ä¸šåŠ¡é€»è¾‘</span><br>â”œâ”€â”€ ecommerce-api<span class="hljs-symbol">/</span>             <span class="hljs-comment"># REST API</span><br>â””â”€â”€ ecommerce-app<span class="hljs-symbol">/</span>             <span class="hljs-comment"># Spring Boot å¯åŠ¨ç±»</span><br></code></pre></td></tr></table></figure><h3 id="ä¾èµ–å…³ç³»"><a href="#ä¾èµ–å…³ç³»" class="headerlink" title="ä¾èµ–å…³ç³»"></a>ä¾èµ–å…³ç³»</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">ecommerce</span>-app<br>  â”œâ”€â”€ ecommerce-api<br>  â”‚   â”œâ”€â”€ ecommerce-service<br>  â”‚   â”‚   â”œâ”€â”€ ecommerce-repository<br>  â”‚   â”‚   â”‚   â””â”€â”€ ecommerce-domain<br>  â”‚   â”‚   â””â”€â”€ ecommerce-<span class="hljs-meta">common</span><br>  â”‚   â””â”€â”€ ecommerce-<span class="hljs-meta">common</span><br>  â””â”€â”€ ...<br></code></pre></td></tr></table></figure><hr><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="Q1-å­æ¨¡å—å¦‚ä½•è®¿é—®å…¶ä»–å­æ¨¡å—çš„èµ„æºï¼Ÿ"><a href="#Q1-å­æ¨¡å—å¦‚ä½•è®¿é—®å…¶ä»–å­æ¨¡å—çš„èµ„æºï¼Ÿ" class="headerlink" title="Q1: å­æ¨¡å—å¦‚ä½•è®¿é—®å…¶ä»–å­æ¨¡å—çš„èµ„æºï¼Ÿ"></a>Q1: å­æ¨¡å—å¦‚ä½•è®¿é—®å…¶ä»–å­æ¨¡å—çš„èµ„æºï¼Ÿ</h3><p><strong>A</strong>: é€šè¿‡ä¾èµ–å£°æ˜ï¼Œä¸è¦ç›´æ¥å¼•ç”¨æ–‡ä»¶è·¯å¾„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- âœ… æ­£ç¡® --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>my-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- âŒ é”™è¯¯ --&gt;</span><br><span class="hljs-comment">&lt;!-- ä¸è¦ä½¿ç”¨ç›¸å¯¹è·¯å¾„ --&gt;</span><br></code></pre></td></tr></table></figure><h3 id="Q2-å¦‚ä½•åªæ„å»ºæŸä¸ªæ¨¡å—ï¼Ÿ"><a href="#Q2-å¦‚ä½•åªæ„å»ºæŸä¸ªæ¨¡å—ï¼Ÿ" class="headerlink" title="Q2: å¦‚ä½•åªæ„å»ºæŸä¸ªæ¨¡å—ï¼Ÿ"></a>Q2: å¦‚ä½•åªæ„å»ºæŸä¸ªæ¨¡å—ï¼Ÿ</h3><p><strong>A</strong>: ä½¿ç”¨ <code>-pl</code> å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean install -pl my-service<br></code></pre></td></tr></table></figure><h3 id="Q3-å­æ¨¡å—ç‰ˆæœ¬ä¸çˆ¶æ¨¡å—ä¸åŒå¯ä»¥å—ï¼Ÿ"><a href="#Q3-å­æ¨¡å—ç‰ˆæœ¬ä¸çˆ¶æ¨¡å—ä¸åŒå¯ä»¥å—ï¼Ÿ" class="headerlink" title="Q3: å­æ¨¡å—ç‰ˆæœ¬ä¸çˆ¶æ¨¡å—ä¸åŒå¯ä»¥å—ï¼Ÿ"></a>Q3: å­æ¨¡å—ç‰ˆæœ¬ä¸çˆ¶æ¨¡å—ä¸åŒå¯ä»¥å—ï¼Ÿ</h3><p><strong>A</strong>: ä¸å»ºè®®ã€‚åº”è¯¥ä¿æŒä¸€è‡´ï¼Œä½¿ç”¨ <code>${project.version}</code></p><h3 id="Q4-å¦‚ä½•å¤„ç†æ¨¡å—é—´çš„ç‰ˆæœ¬å†²çªï¼Ÿ"><a href="#Q4-å¦‚ä½•å¤„ç†æ¨¡å—é—´çš„ç‰ˆæœ¬å†²çªï¼Ÿ" class="headerlink" title="Q4: å¦‚ä½•å¤„ç†æ¨¡å—é—´çš„ç‰ˆæœ¬å†²çªï¼Ÿ"></a>Q4: å¦‚ä½•å¤„ç†æ¨¡å—é—´çš„ç‰ˆæœ¬å†²çªï¼Ÿ</h3><p><strong>A</strong>: åœ¨çˆ¶ POM çš„ <code>dependencyManagement</code> ä¸­ç»Ÿä¸€å®šä¹‰</p><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table><thead><tr><th>è¦ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>èšåˆ</strong></td><td>çˆ¶ POM é€šè¿‡ <code>&lt;modules&gt;</code> ç»Ÿä¸€æ„å»º</td></tr><tr><td><strong>ç»§æ‰¿</strong></td><td>å­æ¨¡å—é€šè¿‡ <code>&lt;parent&gt;</code> ç»§æ‰¿é…ç½®</td></tr><tr><td><strong>ä¾èµ–ç®¡ç†</strong></td><td>ä½¿ç”¨ <code>&lt;dependencyManagement&gt;</code> ç»Ÿä¸€ç‰ˆæœ¬</td></tr><tr><td><strong>æ¨¡å—åˆ’åˆ†</strong></td><td>æŒ‰èŒè´£æ¸…æ™°åˆ’åˆ†ï¼Œé¿å…å¾ªç¯ä¾èµ–</td></tr><tr><td><strong>ç‰ˆæœ¬ç­–ç•¥</strong></td><td>ç»Ÿä¸€ç‰ˆæœ¬å·ï¼Œä¾¿äºç»´æŠ¤å’Œå‘å¸ƒ</td></tr></tbody></table><hr><h2 id="æ¡†æ¶ç±»å‹é¡¹ç›®è®¾è®¡ï¼ˆSPI-æ¨¡å¼ï¼‰"><a href="#æ¡†æ¶ç±»å‹é¡¹ç›®è®¾è®¡ï¼ˆSPI-æ¨¡å¼ï¼‰" class="headerlink" title="æ¡†æ¶ç±»å‹é¡¹ç›®è®¾è®¡ï¼ˆSPI æ¨¡å¼ï¼‰"></a>æ¡†æ¶ç±»å‹é¡¹ç›®è®¾è®¡ï¼ˆSPI æ¨¡å¼ï¼‰</h2><p>æ¡†æ¶ç±»å‹é¡¹ç›®ä¸æ™®é€šä¸šåŠ¡ç³»ç»Ÿä¸åŒï¼Œéœ€è¦æ”¯æŒ<strong>å¯æ’æ‹”</strong>å’Œ<strong>æ‰©å±•æ€§</strong>ã€‚å…¸å‹åœºæ™¯ï¼š</p><ul><li>RAG ç³»ç»Ÿï¼šå¤šç§å‘é‡æ•°æ®åº“ï¼ˆESã€PGã€Neo4jã€Milvusï¼‰</li><li>ORM æ¡†æ¶ï¼šå¤šç§æ•°æ®åº“æ–¹è¨€ï¼ˆMySQLã€PostgreSQLã€Oracleï¼‰</li><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¤šç§å®ç°ï¼ˆKafkaã€RabbitMQã€RocketMQï¼‰</li></ul><h3 id="æ ¸å¿ƒè®¾è®¡æ€æƒ³"><a href="#æ ¸å¿ƒè®¾è®¡æ€æƒ³" class="headerlink" title="æ ¸å¿ƒè®¾è®¡æ€æƒ³"></a>æ ¸å¿ƒè®¾è®¡æ€æƒ³</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                      ç”¨æˆ·åº”ç”¨å±‚                              â”‚<br>â”‚                  (åªä¾èµ– API + éœ€è¦çš„å®ç°)                    â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                              â”‚<br>                              â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                    rag-core (æ ¸å¿ƒæ¨¡å—)                       â”‚<br>â”‚              å®šä¹‰æ¥å£ + é»˜è®¤å®ç° + SPI åŠ è½½æœºåˆ¶               â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                              â”‚<br>          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>          â–¼                   â–¼                   â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚  rag-store-es   â”‚ â”‚  rag-store-pg   â”‚ â”‚ rag-store-neo4j â”‚<br>â”‚   (ES å®ç°)      â”‚ â”‚  (PgVector)     â”‚ â”‚   (Neo4j å®ç°)   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><p><strong>å…³é”®åŸåˆ™</strong>ï¼š</p><ul><li><strong>ä¾èµ–å€’ç½®</strong>ï¼šæ ¸å¿ƒæ¨¡å—å®šä¹‰æ¥å£ï¼Œå®ç°æ¨¡å—ä¾èµ–æ ¸å¿ƒ</li><li><strong>æŒ‰éœ€å¼•å…¥</strong>ï¼šç”¨æˆ·åªå¼•å…¥éœ€è¦çš„å®ç°æ¨¡å—</li><li><strong>SPI å‘ç°</strong>ï¼šè¿è¡Œæ—¶è‡ªåŠ¨å‘ç°å¹¶åŠ è½½å®ç°</li></ul><hr><h3 id="å®æˆ˜ç¤ºä¾‹ï¼šRAG-ç³»ç»Ÿæ¨¡å—ç»“æ„"><a href="#å®æˆ˜ç¤ºä¾‹ï¼šRAG-ç³»ç»Ÿæ¨¡å—ç»“æ„" class="headerlink" title="å®æˆ˜ç¤ºä¾‹ï¼šRAG ç³»ç»Ÿæ¨¡å—ç»“æ„"></a>å®æˆ˜ç¤ºä¾‹ï¼šRAG ç³»ç»Ÿæ¨¡å—ç»“æ„</h3><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs nix">rag-framework<span class="hljs-symbol">/</span><br>â”œâ”€â”€ pom.xml                        <span class="hljs-comment"># çˆ¶ POM</span><br>â”‚<br>â”œâ”€â”€ rag-core<span class="hljs-symbol">/</span>                      <span class="hljs-comment"># æ ¸å¿ƒæ¨¡å—</span><br>â”‚   â”œâ”€â”€ pom.xml<br>â”‚   â””â”€â”€ src<span class="hljs-operator">/</span>main<span class="hljs-operator">/</span>java<span class="hljs-symbol">/</span><br>â”‚       â””â”€â”€ com<span class="hljs-operator">/</span>example<span class="hljs-operator">/</span>rag<span class="hljs-symbol">/</span><br>â”‚           â”œâ”€â”€ api<span class="hljs-symbol">/</span>               <span class="hljs-comment"># æ ¸å¿ƒæ¥å£å®šä¹‰</span><br>â”‚           â”‚   â”œâ”€â”€ VectorStore.java<br>â”‚           â”‚   â””â”€â”€ DocumentSplitter.java<br>â”‚           â”œâ”€â”€ spi<span class="hljs-symbol">/</span>               <span class="hljs-comment"># SPI åŠ è½½æœºåˆ¶</span><br>â”‚           â”‚   â””â”€â”€ SpiLoader.java<br>â”‚           â””â”€â”€ model<span class="hljs-symbol">/</span>             <span class="hljs-comment"># é¢†åŸŸæ¨¡å‹</span><br>â”‚               â””â”€â”€ Document.java<br>â”‚<br>â”œâ”€â”€ rag-store-elasticsearch<span class="hljs-symbol">/</span>       <span class="hljs-comment"># ES å®ç°</span><br>â”‚   â”œâ”€â”€ pom.xml<br>â”‚   â””â”€â”€ src<span class="hljs-operator">/</span>main<span class="hljs-symbol">/</span><br>â”‚       â”œâ”€â”€ java<span class="hljs-symbol">/.../ElasticsearchVectorStore.java</span><br>â”‚       â””â”€â”€ resources<span class="hljs-operator">/</span>META-INF<span class="hljs-operator">/</span>services<span class="hljs-symbol">/</span><br>â”‚           â””â”€â”€ com.example.rag.api.VectorStore<br>â”‚<br>â”œâ”€â”€ rag-store-pgvector<span class="hljs-symbol">/</span>            <span class="hljs-comment"># PgVector å®ç°</span><br>â”‚   â”œâ”€â”€ pom.xml<br>â”‚   â””â”€â”€ src<span class="hljs-operator">/</span>main<span class="hljs-symbol">/</span><br>â”‚       â”œâ”€â”€ java<span class="hljs-symbol">/.../PgVectorStore.java</span><br>â”‚       â””â”€â”€ resources<span class="hljs-operator">/</span>META-INF<span class="hljs-operator">/</span>services<span class="hljs-symbol">/</span><br>â”‚           â””â”€â”€ com.example.rag.api.VectorStore<br>â”‚<br>â”œâ”€â”€ rag-store-neo4j<span class="hljs-symbol">/</span>               <span class="hljs-comment"># Neo4j å®ç°</span><br>â”‚   â””â”€â”€ ...<br>â”‚<br>â”œâ”€â”€ rag-splitter-fixed<span class="hljs-symbol">/</span>            <span class="hljs-comment"># å›ºå®šé•¿åº¦åˆ‡ç‰‡</span><br>â”‚   â””â”€â”€ ...<br>â”‚<br>â”œâ”€â”€ rag-splitter-sentence<span class="hljs-symbol">/</span>         <span class="hljs-comment"># æŒ‰å¥å­åˆ‡ç‰‡</span><br>â”‚   â””â”€â”€ ...<br>â”‚<br>â”œâ”€â”€ rag-splitter-semantic<span class="hljs-symbol">/</span>         <span class="hljs-comment"># è¯­ä¹‰åˆ‡ç‰‡</span><br>â”‚   â””â”€â”€ ...<br>â”‚<br>â””â”€â”€ rag-spring-boot-starter<span class="hljs-symbol">/</span>       <span class="hljs-comment"># Spring Boot è‡ªåŠ¨é…ç½®</span><br>    â””â”€â”€ ...<br></code></pre></td></tr></table></figure><hr><h3 id="æ ¸å¿ƒæ¨¡å—è®¾è®¡ï¼ˆrag-coreï¼‰"><a href="#æ ¸å¿ƒæ¨¡å—è®¾è®¡ï¼ˆrag-coreï¼‰" class="headerlink" title="æ ¸å¿ƒæ¨¡å—è®¾è®¡ï¼ˆrag-coreï¼‰"></a>æ ¸å¿ƒæ¨¡å—è®¾è®¡ï¼ˆrag-coreï¼‰</h3><h4 id="1-å®šä¹‰-SPI-æ¥å£"><a href="#1-å®šä¹‰-SPI-æ¥å£" class="headerlink" title="1. å®šä¹‰ SPI æ¥å£"></a>1. å®šä¹‰ SPI æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// VectorStore.java - å‘é‡å­˜å‚¨æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VectorStore</span> &#123;<br>    <br>    <span class="hljs-comment">/** SPI æ‰©å±•ç‚¹æ ‡è¯† */</span><br>    String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span>;<br>    <br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">store</span><span class="hljs-params">(List&lt;Document&gt; documents)</span>;<br>    <br>    List&lt;Document&gt; <span class="hljs-title function_">search</span><span class="hljs-params">(String query, <span class="hljs-type">int</span> topK)</span>;<br>&#125;<br><br><span class="hljs-comment">// DocumentSplitter.java - æ–‡æ¡£åˆ‡ç‰‡æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DocumentSplitter</span> &#123;<br>    <br>    String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span>;<br>    <br>    List&lt;Document&gt; <span class="hljs-title function_">split</span><span class="hljs-params">(Document document)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-SPI-åŠ è½½å™¨"><a href="#2-SPI-åŠ è½½å™¨" class="headerlink" title="2. SPI åŠ è½½å™¨"></a>2. SPI åŠ è½½å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpiLoader</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;Class&lt;?&gt;, Map&lt;String, Object&gt;&gt; CACHE = <br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>    <br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">load</span><span class="hljs-params">(Class&lt;T&gt; clazz, String type)</span> &#123;<br>        Map&lt;String, Object&gt; implementations = CACHE.computeIfAbsent(<br>            clazz, <br>            k -&gt; loadImplementations(clazz)<br>        );<br>        <br>        <span class="hljs-type">T</span> <span class="hljs-variable">impl</span> <span class="hljs-operator">=</span> (T) implementations.get(type);<br>        <span class="hljs-keyword">if</span> (impl == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<br>                <span class="hljs-string">&quot;No implementation found for type: &quot;</span> + type<br>            );<br>        &#125;<br>        <span class="hljs-keyword">return</span> impl;<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T&gt; Map&lt;String, Object&gt; <span class="hljs-title function_">loadImplementations</span><span class="hljs-params">(Class&lt;T&gt; clazz)</span> &#123;<br>        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        ServiceLoader&lt;T&gt; loader = ServiceLoader.load(clazz);<br>        <br>        <span class="hljs-keyword">for</span> (T impl : loader) &#123;<br>            <span class="hljs-comment">// å‡è®¾æ¥å£æœ‰ getType() æ–¹æ³•</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> getType(impl);<br>            map.put(type, impl);<br>        &#125;<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-æ ¸å¿ƒæ¨¡å—-POM"><a href="#3-æ ¸å¿ƒæ¨¡å—-POM" class="headerlink" title="3. æ ¸å¿ƒæ¨¡å— POM"></a>3. æ ¸å¿ƒæ¨¡å— POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag-core/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>RAG Core<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- åªæ”¾æœ€åŸºç¡€çš„ä¾èµ– --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h3 id="å®ç°æ¨¡å—è®¾è®¡"><a href="#å®ç°æ¨¡å—è®¾è®¡" class="headerlink" title="å®ç°æ¨¡å—è®¾è®¡"></a>å®ç°æ¨¡å—è®¾è®¡</h3><h4 id="1-ES-å®ç°æ¨¡å—"><a href="#1-ES-å®ç°æ¨¡å—" class="headerlink" title="1. ES å®ç°æ¨¡å—"></a>1. ES å®ç°æ¨¡å—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ElasticsearchVectorStore.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ElasticsearchVectorStore</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">VectorStore</span> &#123;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;elasticsearch&quot;</span>;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">store</span><span class="hljs-params">(List&lt;Document&gt; documents)</span> &#123;<br>        <span class="hljs-comment">// ES ç‰¹å®šå®ç°</span><br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;Document&gt; <span class="hljs-title function_">search</span><span class="hljs-params">(String query, <span class="hljs-type">int</span> topK)</span> &#123;<br>        <span class="hljs-comment">// ES ç‰¹å®šå®ç°</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-SPI-é…ç½®æ–‡ä»¶"><a href="#2-SPI-é…ç½®æ–‡ä»¶" class="headerlink" title="2. SPI é…ç½®æ–‡ä»¶"></a>2. SPI é…ç½®æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">src/main/resources/META-INF/services/com.example.rag.api.VectorStore</span><br>com.example.rag.store.es.ElasticsearchVectorStore<br></code></pre></td></tr></table></figure><h4 id="3-å®ç°æ¨¡å—-POM"><a href="#3-å®ç°æ¨¡å—-POM" class="headerlink" title="3. å®ç°æ¨¡å— POM"></a>3. å®ç°æ¨¡å— POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag-store-elasticsearch/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-store-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ä¾èµ–æ ¸å¿ƒæ¨¡å— --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- ES ç‰¹å®šä¾èµ– --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>co.elastic.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.10.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h3 id="ç”¨æˆ·ä½¿ç”¨æ–¹å¼"><a href="#ç”¨æˆ·ä½¿ç”¨æ–¹å¼" class="headerlink" title="ç”¨æˆ·ä½¿ç”¨æ–¹å¼"></a>ç”¨æˆ·ä½¿ç”¨æ–¹å¼</h3><h4 id="æŒ‰éœ€å¼•å…¥"><a href="#æŒ‰éœ€å¼•å…¥" class="headerlink" title="æŒ‰éœ€å¼•å…¥"></a>æŒ‰éœ€å¼•å…¥</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ç”¨æˆ·é¡¹ç›® pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- æ ¸å¿ƒï¼ˆå¿…éœ€ï¼‰ --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!-- åªå¼•å…¥éœ€è¦çš„å®ç° --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-store-pgvector<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-splitter-semantic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="ä»£ç ä½¿ç”¨"><a href="#ä»£ç ä½¿ç”¨" class="headerlink" title="ä»£ç ä½¿ç”¨"></a>ä»£ç ä½¿ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€šè¿‡ SPI è‡ªåŠ¨åŠ è½½</span><br><span class="hljs-type">VectorStore</span> <span class="hljs-variable">store</span> <span class="hljs-operator">=</span> SpiLoader.load(VectorStore.class, <span class="hljs-string">&quot;pgvector&quot;</span>);<br><span class="hljs-type">DocumentSplitter</span> <span class="hljs-variable">splitter</span> <span class="hljs-operator">=</span> SpiLoader.load(DocumentSplitter.class, <span class="hljs-string">&quot;semantic&quot;</span>);<br><br><span class="hljs-comment">// æˆ–é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®š</span><br><span class="hljs-meta">@Value(&quot;$&#123;rag.store.type&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String storeType;<br><br><span class="hljs-type">VectorStore</span> <span class="hljs-variable">store</span> <span class="hljs-operator">=</span> SpiLoader.load(VectorStore.class, storeType);<br></code></pre></td></tr></table></figure><hr><h3 id="ä¾èµ–å…³ç³»å›¾"><a href="#ä¾èµ–å…³ç³»å›¾" class="headerlink" title="ä¾èµ–å…³ç³»å›¾"></a>ä¾èµ–å…³ç³»å›¾</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">ç”¨æˆ·é¡¹ç›®<br>    â”‚<br>    â”œâ”€â”€ rag-core (å¿…éœ€)<br>    â”‚<br>    â”œâ”€â”€ rag-store-xxx (é€‰ä¸€ä¸ª)<br>    â”‚   â””â”€â”€ rag-core<br>    â”‚<br>    â””â”€â”€ rag-splitter-xxx (é€‰ä¸€ä¸ª)<br>        â””â”€â”€ rag-core<br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li>ç”¨æˆ·<strong>ä¸éœ€è¦</strong>åŒæ—¶å¼•å…¥æ‰€æœ‰å®ç°</li><li>è¿è¡Œæ—¶é€šè¿‡ SPI è‡ªåŠ¨å‘ç°å¼•å…¥çš„å®ç°</li><li>æ–°å¢å®ç°åªéœ€è¦æ·»åŠ æ–°æ¨¡å—ï¼Œä¸ä¿®æ”¹æ ¸å¿ƒä»£ç </li></ul><hr><h3 id="Spring-Boot-Starter-å°è£…"><a href="#Spring-Boot-Starter-å°è£…" class="headerlink" title="Spring Boot Starter å°è£…"></a>Spring Boot Starter å°è£…</h3><p>ä¸ºäº†æ›´å¥½çš„é›†æˆä½“éªŒï¼Œå¯ä»¥æä¾› Starterï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag-spring-boot-starter/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// RagAutoConfiguration.java</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableConfigurationProperties(RagProperties.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RagAutoConfiguration</span> &#123;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-keyword">public</span> VectorStore <span class="hljs-title function_">vectorStore</span><span class="hljs-params">(RagProperties props)</span> &#123;<br>        <span class="hljs-keyword">return</span> SpiLoader.load(VectorStore.class, props.getStore().getType());<br>    &#125;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConditionalOnMissingBean</span><br>    <span class="hljs-keyword">public</span> DocumentSplitter <span class="hljs-title function_">documentSplitter</span><span class="hljs-params">(RagProperties props)</span> &#123;<br>        <span class="hljs-keyword">return</span> SpiLoader.load(DocumentSplitter.class, props.getSplitter().getType());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># ç”¨æˆ·é…ç½® application.yml</span><br><span class="hljs-attr">rag:</span><br>  <span class="hljs-attr">store:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">pgvector</span><br>  <span class="hljs-attr">splitter:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">semantic</span><br>    <span class="hljs-attr">chunk-size:</span> <span class="hljs-number">500</span><br></code></pre></td></tr></table></figure><hr><h3 id="æ¡†æ¶è®¾è®¡å¯¹æ¯”"><a href="#æ¡†æ¶è®¾è®¡å¯¹æ¯”" class="headerlink" title="æ¡†æ¶è®¾è®¡å¯¹æ¯”"></a>æ¡†æ¶è®¾è®¡å¯¹æ¯”</h3><table><thead><tr><th>è®¾è®¡æ¨¡å¼</th><th>é€‚ç”¨åœºæ™¯</th><th>å…¸å‹æ¡†æ¶</th></tr></thead><tbody><tr><td><strong>SPI + å¤šå®ç°æ¨¡å—</strong></td><td>åŒä¸€æ¥å£å¤šç§å®ç°</td><td>JDBCã€SLF4J</td></tr><tr><td><strong>ç­–ç•¥æ¨¡å¼</strong></td><td>ç®—æ³•&#x2F;è¡Œä¸ºå¯æ›¿æ¢</td><td>åˆ‡ç‰‡æ–¹å¼ã€åµŒå…¥æ¨¡å‹</td></tr><tr><td><strong>æ¨¡æ¿æ–¹æ³•</strong></td><td>å›ºå®šæµç¨‹å¯æ‰©å±•æ­¥éª¤</td><td>Spring Template</td></tr><tr><td><strong>å·¥å‚æ¨¡å¼</strong></td><td>å¯¹è±¡åˆ›å»ºè§£è€¦</td><td>å„ç§ Factory</td></tr></tbody></table><hr><h3 id="æ‰©å±•æ€§è®¾è®¡è¦ç‚¹"><a href="#æ‰©å±•æ€§è®¾è®¡è¦ç‚¹" class="headerlink" title="æ‰©å±•æ€§è®¾è®¡è¦ç‚¹"></a>æ‰©å±•æ€§è®¾è®¡è¦ç‚¹</h3><ol><li><strong>æ¥å£éš”ç¦»</strong>ï¼šæ ¸å¿ƒæ¥å£æ”¾åœ¨ç‹¬ç«‹æ¨¡å—ï¼Œæ— ç¬¬ä¸‰æ–¹ä¾èµ–</li><li><strong>å¯é€‰ä¾èµ–</strong>ï¼šä½¿ç”¨ <code>&lt;optional&gt;true&lt;/optional&gt;</code> é¿å…ä¼ é€’ä¾èµ–</li><li><strong>é»˜è®¤å®ç°</strong>ï¼šæ ¸å¿ƒæ¨¡å—æä¾›ç®€å•é»˜è®¤å®ç°</li><li><strong>é…ç½®é©±åŠ¨</strong>ï¼šé€šè¿‡é…ç½®åˆ‡æ¢å®ç°ï¼Œè€Œéä»£ç ä¿®æ”¹</li><li><strong>ç‰ˆæœ¬å…¼å®¹</strong>ï¼šæ¥å£å˜æ›´éœ€è€ƒè™‘å‘åå…¼å®¹</li></ol><hr><h2 id="å®Œæ•´æ¡†æ¶ç»“æ„ï¼ˆå«åº”ç”¨å±‚ï¼‰"><a href="#å®Œæ•´æ¡†æ¶ç»“æ„ï¼ˆå«åº”ç”¨å±‚ï¼‰" class="headerlink" title="å®Œæ•´æ¡†æ¶ç»“æ„ï¼ˆå«åº”ç”¨å±‚ï¼‰"></a>å®Œæ•´æ¡†æ¶ç»“æ„ï¼ˆå«åº”ç”¨å±‚ï¼‰</h2><p>å®é™…é¡¹ç›®ä¸­ï¼Œé™¤äº†å¯æ’æ‹”çš„åº•å±‚æ¨¡å—ï¼Œè¿˜éœ€è¦<strong>åº”ç”¨å±‚</strong>æ¥ç»„åˆè¿™äº›æ¨¡å—å¹¶å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><h3 id="å®Œæ•´æ¨¡å—ç»“æ„"><a href="#å®Œæ•´æ¨¡å—ç»“æ„" class="headerlink" title="å®Œæ•´æ¨¡å—ç»“æ„"></a>å®Œæ•´æ¨¡å—ç»“æ„</h3><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs nix">rag-framework<span class="hljs-symbol">/</span><br>â”œâ”€â”€ pom.xml                        <span class="hljs-comment"># çˆ¶ POM</span><br>â”‚<br>â”‚  <span class="hljs-operator">==</span><span class="hljs-operator">==</span><span class="hljs-operator">=</span> æ¡†æ¶å±‚ï¼ˆå¯ç‹¬ç«‹å‘å¸ƒç»™ç¬¬ä¸‰æ–¹ä½¿ç”¨ï¼‰<span class="hljs-operator">==</span><span class="hljs-operator">==</span><span class="hljs-operator">=</span><br>â”‚<br>â”œâ”€â”€ rag-core<span class="hljs-symbol">/</span>                      <span class="hljs-comment"># æ ¸å¿ƒæ¥å£ + SPI</span><br>â”‚   â””â”€â”€ æ— å¤–éƒ¨ä¾èµ–ï¼Œçº¯æ¥å£å®šä¹‰<br>â”‚<br>â”œâ”€â”€ rag-stores<span class="hljs-symbol">/</span>                    <span class="hljs-comment"># å‘é‡å­˜å‚¨å®ç°ï¼ˆèšåˆæ¨¡å—ï¼‰</span><br>â”‚   â”œâ”€â”€ pom.xml                    <span class="hljs-comment"># packaging=pomï¼Œèšåˆå­æ¨¡å—</span><br>â”‚   â”œâ”€â”€ rag-store-core<span class="hljs-symbol">/</span>            <span class="hljs-comment"># ğŸ”‘ æŠ½è±¡å±‚ï¼šåŸºç±» + å…¬å…±å·¥å…·</span><br>â”‚   â”œâ”€â”€ rag-store-elasticsearch<span class="hljs-symbol">/</span>   <span class="hljs-comment"># ç»§æ‰¿æŠ½è±¡å±‚</span><br>â”‚   â”œâ”€â”€ rag-store-pgvector<span class="hljs-symbol">/</span><br>â”‚   â””â”€â”€ rag-store-neo4j<span class="hljs-symbol">/</span><br>â”‚<br>â”œâ”€â”€ rag-splitters<span class="hljs-symbol">/</span>                 <span class="hljs-comment"># åˆ‡ç‰‡ç­–ç•¥å®ç°ï¼ˆèšåˆæ¨¡å—ï¼‰</span><br>â”‚   â”œâ”€â”€ pom.xml<br>â”‚   â”œâ”€â”€ rag-splitter-core<span class="hljs-symbol">/</span>         <span class="hljs-comment"># ğŸ”‘ æŠ½è±¡å±‚</span><br>â”‚   â”œâ”€â”€ rag-splitter-fixed<span class="hljs-symbol">/</span><br>â”‚   â”œâ”€â”€ rag-splitter-sentence<span class="hljs-symbol">/</span><br>â”‚   â””â”€â”€ rag-splitter-semantic<span class="hljs-symbol">/</span><br>â”‚<br>â”œâ”€â”€ rag-embeddings<span class="hljs-symbol">/</span>                <span class="hljs-comment"># åµŒå…¥æ¨¡å‹å®ç°ï¼ˆèšåˆæ¨¡å—ï¼‰</span><br>â”‚   â”œâ”€â”€ pom.xml<br>â”‚   â”œâ”€â”€ rag-embedding-core<span class="hljs-symbol">/</span>        <span class="hljs-comment"># ğŸ”‘ æŠ½è±¡å±‚</span><br>â”‚   â”œâ”€â”€ rag-embedding-openai<span class="hljs-symbol">/</span><br>â”‚   â””â”€â”€ rag-embedding-local<span class="hljs-symbol">/</span><br>â”‚<br>â”œâ”€â”€ rag-spring-boot-starter<span class="hljs-symbol">/</span>       <span class="hljs-comment"># Spring Boot è‡ªåŠ¨é…ç½®</span><br>â”‚<br>â”‚  <span class="hljs-operator">==</span><span class="hljs-operator">==</span><span class="hljs-operator">=</span> åº”ç”¨å±‚ï¼ˆç»„åˆæ¨¡å—ï¼Œå¯¹å¤–æä¾›æœåŠ¡ï¼‰<span class="hljs-operator">==</span><span class="hljs-operator">==</span><span class="hljs-operator">=</span><br>â”‚<br>â”œâ”€â”€ rag-service<span class="hljs-symbol">/</span>                   <span class="hljs-comment"># ä¸šåŠ¡æœåŠ¡å±‚</span><br>â”œâ”€â”€ rag-api<span class="hljs-symbol">/</span>                       <span class="hljs-comment"># Controller å±‚ï¼ˆREST APIï¼‰</span><br>â””â”€â”€ rag-server<span class="hljs-symbol">/</span>                    <span class="hljs-comment"># å¯åŠ¨æ¨¡å—</span><br></code></pre></td></tr></table></figure><h3 id="æŠ½è±¡å±‚è®¾è®¡ï¼ˆrag-store-coreï¼‰"><a href="#æŠ½è±¡å±‚è®¾è®¡ï¼ˆrag-store-coreï¼‰" class="headerlink" title="æŠ½è±¡å±‚è®¾è®¡ï¼ˆrag-store-coreï¼‰"></a>æŠ½è±¡å±‚è®¾è®¡ï¼ˆrag-store-coreï¼‰</h3><p>æŠ½è±¡å±‚çš„èŒè´£ï¼š</p><ul><li><strong>æŠ½è±¡åŸºç±»</strong>ï¼šå®ç°å…¬å…±é€»è¾‘ï¼Œå­ç±»åªéœ€å®ç°å·®å¼‚éƒ¨åˆ†</li><li><strong>å·¥å…·ç±»</strong>ï¼šè¿æ¥æ± ç®¡ç†ã€åºåˆ—åŒ–ã€é‡è¯•æœºåˆ¶ç­‰</li><li><strong>é…ç½®åŸºç±»</strong>ï¼šå…¬å…±é…ç½®é¡¹</li></ul><h4 id="ä¾èµ–å…³ç³»-1"><a href="#ä¾èµ–å…³ç³»-1" class="headerlink" title="ä¾èµ–å…³ç³»"></a>ä¾èµ–å…³ç³»</h4><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs llvm">rag-<span class="hljs-keyword">store</span>-elasticsearch<br>        â”‚<br>        â–¼<br>rag-<span class="hljs-keyword">store</span>-core (æŠ½è±¡å±‚)<br>        â”‚<br>        â–¼<br>   rag-core (æ¥å£)<br></code></pre></td></tr></table></figure><h4 id="æŠ½è±¡å±‚ä»£ç ç¤ºä¾‹"><a href="#æŠ½è±¡å±‚ä»£ç ç¤ºä¾‹" class="headerlink" title="æŠ½è±¡å±‚ä»£ç ç¤ºä¾‹"></a>æŠ½è±¡å±‚ä»£ç ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// rag-store-core æ¨¡å—</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * VectorStore æŠ½è±¡åŸºç±»</span><br><span class="hljs-comment"> * å®ç°å…¬å…±é€»è¾‘ï¼Œå­ç±»åªéœ€å…³æ³¨ç‰¹å®šæ•°æ®åº“æ“ä½œ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractVectorStore</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">VectorStore</span> &#123;<br>    <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> VectorStoreConfig config;<br>    <br>    <span class="hljs-keyword">protected</span> <span class="hljs-title function_">AbstractVectorStore</span><span class="hljs-params">(VectorStoreConfig config)</span> &#123;<br>        <span class="hljs-built_in">this</span>.config = config;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">store</span><span class="hljs-params">(List&lt;Document&gt; documents)</span> &#123;<br>        <span class="hljs-comment">// 1. å…¬å…±é€»è¾‘ï¼šå‚æ•°æ ¡éªŒ</span><br>        validateDocuments(documents);<br>        <br>        <span class="hljs-comment">// 2. å…¬å…±é€»è¾‘ï¼šæ‰¹é‡å¤„ç†</span><br>        List&lt;List&lt;Document&gt;&gt; batches = partition(documents, config.getBatchSize());<br>        <br>        <span class="hljs-keyword">for</span> (List&lt;Document&gt; batch : batches) &#123;<br>            <span class="hljs-comment">// 3. è°ƒç”¨å­ç±»å®ç°çš„å…·ä½“å­˜å‚¨é€»è¾‘</span><br>            doStore(batch);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;Document&gt; <span class="hljs-title function_">search</span><span class="hljs-params">(String query, <span class="hljs-type">int</span> topK)</span> &#123;<br>        <span class="hljs-comment">// å…¬å…±é€»è¾‘ï¼šå‚æ•°æ ¡éªŒ</span><br>        <span class="hljs-keyword">if</span> (topK &lt;= <span class="hljs-number">0</span> || topK &gt; config.getMaxTopK()) &#123;<br>            topK = config.getDefaultTopK();<br>        &#125;<br>        <br>        <span class="hljs-comment">// è°ƒç”¨å­ç±»å®ç°</span><br>        <span class="hljs-keyword">return</span> doSearch(query, topK);<br>    &#125;<br>    <br>    <span class="hljs-comment">// ===== å­ç±»å¿…é¡»å®ç°çš„æŠ½è±¡æ–¹æ³• =====</span><br>    <br>    <span class="hljs-comment">/** å…·ä½“çš„å­˜å‚¨å®ç° */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doStore</span><span class="hljs-params">(List&lt;Document&gt; documents)</span>;<br>    <br>    <span class="hljs-comment">/** å…·ä½“çš„æœç´¢å®ç° */</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> List&lt;Document&gt; <span class="hljs-title function_">doSearch</span><span class="hljs-params">(String query, <span class="hljs-type">int</span> topK)</span>;<br>    <br>    <span class="hljs-comment">// ===== å…¬å…±å·¥å…·æ–¹æ³• =====</span><br>    <br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateDocuments</span><span class="hljs-params">(List&lt;Document&gt; docs)</span> &#123;<br>        <span class="hljs-keyword">if</span> (docs == <span class="hljs-literal">null</span> || docs.isEmpty()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Documents cannot be empty&quot;</span>);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">protected</span> &lt;T&gt; List&lt;List&lt;T&gt;&gt; <span class="hljs-title function_">partition</span><span class="hljs-params">(List&lt;T&gt; list, <span class="hljs-type">int</span> size)</span> &#123;<br>        <span class="hljs-comment">// åˆ†æ‰¹å·¥å…·æ–¹æ³•</span><br>        List&lt;List&lt;T&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; list.size(); i += size) &#123;<br>            result.add(list.subList(i, Math.min(i + size, list.size())));<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å…¬å…±é…ç½®åŸºç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VectorStoreConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">defaultTopK</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxTopK</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">connectTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">5000</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">readTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">30000</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å…·ä½“å®ç°ï¼ˆç»§æ‰¿æŠ½è±¡å±‚ï¼‰"><a href="#å…·ä½“å®ç°ï¼ˆç»§æ‰¿æŠ½è±¡å±‚ï¼‰" class="headerlink" title="å…·ä½“å®ç°ï¼ˆç»§æ‰¿æŠ½è±¡å±‚ï¼‰"></a>å…·ä½“å®ç°ï¼ˆç»§æ‰¿æŠ½è±¡å±‚ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// rag-store-pgvector æ¨¡å—</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PgVectorStore</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractVectorStore</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JdbcTemplate jdbcTemplate;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PgVectorStore</span><span class="hljs-params">(PgVectorConfig config, JdbcTemplate jdbcTemplate)</span> &#123;<br>        <span class="hljs-built_in">super</span>(config);  <span class="hljs-comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å™¨</span><br>        <span class="hljs-built_in">this</span>.jdbcTemplate = jdbcTemplate;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;pgvector&quot;</span>;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doStore</span><span class="hljs-params">(List&lt;Document&gt; documents)</span> &#123;<br>        <span class="hljs-comment">// åªéœ€å®ç° PgVector ç‰¹å®šçš„å­˜å‚¨é€»è¾‘</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;INSERT INTO documents (content, embedding) VALUES (?, ?::vector)&quot;</span>;<br>        jdbcTemplate.batchUpdate(sql, documents, documents.size(), <br>            (ps, doc) -&gt; &#123;<br>                ps.setString(<span class="hljs-number">1</span>, doc.getContent());<br>                ps.setArray(<span class="hljs-number">2</span>, toSqlArray(doc.getEmbedding()));<br>            &#125;);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> List&lt;Document&gt; <span class="hljs-title function_">doSearch</span><span class="hljs-params">(String query, <span class="hljs-type">int</span> topK)</span> &#123;<br>        <span class="hljs-comment">// åªéœ€å®ç° PgVector ç‰¹å®šçš„æœç´¢é€»è¾‘</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            SELECT content, 1 - (embedding &lt;=&gt; ?::vector) as score</span><br><span class="hljs-string">            FROM documents</span><br><span class="hljs-string">            ORDER BY embedding &lt;=&gt; ?::vector</span><br><span class="hljs-string">            LIMIT ?</span><br><span class="hljs-string">            &quot;&quot;&quot;</span>;<br>        <span class="hljs-keyword">return</span> jdbcTemplate.query(sql, documentRowMapper, queryVector, queryVector, topK);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ç»§æ‰¿å…¬å…±é…ç½®ï¼Œæ·»åŠ ç‰¹å®šé…ç½®</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@EqualsAndHashCode(callSuper = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PgVectorConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">VectorStoreConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">tableName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;documents&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">dimension</span> <span class="hljs-operator">=</span> <span class="hljs-number">1536</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">indexType</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ivfflat&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="èšåˆæ¨¡å—-POM-ç¤ºä¾‹"><a href="#èšåˆæ¨¡å—-POM-ç¤ºä¾‹" class="headerlink" title="èšåˆæ¨¡å— POM ç¤ºä¾‹"></a>èšåˆæ¨¡å— POM ç¤ºä¾‹</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag-stores/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-stores<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>RAG Vector Stores<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-store-core<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>        <span class="hljs-comment">&lt;!-- æŠ½è±¡å±‚ä¼˜å…ˆæ„å»º --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-store-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-store-pgvector<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-store-neo4j<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag-stores/rag-store-core/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-stores<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-store-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- åªä¾èµ–æ ¸å¿ƒæ¥å£ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag-stores/rag-store-pgvector/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-stores<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-store-pgvector<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ä¾èµ–æŠ½è±¡å±‚ï¼ˆä¼šä¼ é€’ rag-coreï¼‰ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-store-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- PgVector ç‰¹å®šä¾èµ– --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.postgresql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>postgresql<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.pgvector<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pgvector<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="çˆ¶-POM-èšåˆé…ç½®"><a href="#çˆ¶-POM-èšåˆé…ç½®" class="headerlink" title="çˆ¶ POM èšåˆé…ç½®"></a>çˆ¶ POM èšåˆé…ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- æ ¹ pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-core<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-stores<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>       <span class="hljs-comment">&lt;!-- èšåˆç›®å½• --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-splitters<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>    <span class="hljs-comment">&lt;!-- èšåˆç›®å½• --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-embeddings<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>   <span class="hljs-comment">&lt;!-- èšåˆç›®å½• --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-service<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-api<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag-server<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="æ¨¡å—ä¾èµ–å…¨æ™¯å›¾"><a href="#æ¨¡å—ä¾èµ–å…¨æ™¯å›¾" class="headerlink" title="æ¨¡å—ä¾èµ–å…¨æ™¯å›¾"></a>æ¨¡å—ä¾èµ–å…¨æ™¯å›¾</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs scss">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>         â”‚         rag-server              â”‚<br>         â”‚   (å¯åŠ¨ç±» + é…ç½® + æ‰“åŒ…)         â”‚<br>         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                         â”‚<br>         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>         â–¼               â–¼               â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚   rag-api    â”‚  â”‚rag-store-pg  â”‚  â”‚rag-splitter- â”‚<br>â”‚ (Controller) â”‚  â”‚  (é€‰æ‹©çš„å®ç°) â”‚  â”‚  semantic    â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>         â”‚               â”‚               â”‚<br>         â–¼               â–¼               â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚               â”‚<br>â”‚ rag-service  â”‚        â”‚               â”‚<br>â”‚  (ä¸šåŠ¡é€»è¾‘)   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>         â”‚<br>         â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚   rag-core   â”‚<br>â”‚  (æ ¸å¿ƒæ¥å£)   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><hr><h3 id="Service-å±‚è®¾è®¡ï¼ˆrag-serviceï¼‰"><a href="#Service-å±‚è®¾è®¡ï¼ˆrag-serviceï¼‰" class="headerlink" title="Service å±‚è®¾è®¡ï¼ˆrag-serviceï¼‰"></a>Service å±‚è®¾è®¡ï¼ˆrag-serviceï¼‰</h3><p>Service å±‚è´Ÿè´£<strong>ç»„åˆ</strong>åº•å±‚ç»„ä»¶ï¼Œå®ç°å…·ä½“ä¸šåŠ¡é€»è¾‘ã€‚</p><h4 id="æ¨¡å—-POM"><a href="#æ¨¡å—-POM" class="headerlink" title="æ¨¡å— POM"></a>æ¨¡å— POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag-service/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ä¾èµ–æ ¸å¿ƒæ¨¡å— --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- Spring ä¾èµ– --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="Service-å®ç°"><a href="#Service-å®ç°" class="headerlink" title="Service å®ç°"></a>Service å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// RagService.java - ç»„åˆåº•å±‚ç»„ä»¶</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RagService</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> VectorStore vectorStore;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DocumentSplitter splitter;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EmbeddingModel embeddingModel;<br>    <br>    <span class="hljs-comment">// é€šè¿‡æ„é€ å™¨æ³¨å…¥ï¼ˆå…·ä½“å®ç°ç”± Starter è‡ªåŠ¨é…ç½®ï¼‰</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RagService</span><span class="hljs-params">(VectorStore vectorStore, </span><br><span class="hljs-params">                      DocumentSplitter splitter,</span><br><span class="hljs-params">                      EmbeddingModel embeddingModel)</span> &#123;<br>        <span class="hljs-built_in">this</span>.vectorStore = vectorStore;<br>        <span class="hljs-built_in">this</span>.splitter = splitter;<br>        <span class="hljs-built_in">this</span>.embeddingModel = embeddingModel;<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡æ¡£å…¥åº“æµç¨‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ingest</span><span class="hljs-params">(Document document)</span> &#123;<br>        <span class="hljs-comment">// 1. åˆ‡ç‰‡</span><br>        List&lt;Document&gt; chunks = splitter.split(document);<br>        <br>        <span class="hljs-comment">// 2. ç”Ÿæˆå‘é‡</span><br>        <span class="hljs-keyword">for</span> (Document chunk : chunks) &#123;<br>            <span class="hljs-type">float</span>[] embedding = embeddingModel.embed(chunk.getContent());<br>            chunk.setEmbedding(embedding);<br>        &#125;<br>        <br>        <span class="hljs-comment">// 3. å­˜å‚¨</span><br>        vectorStore.store(chunks);<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ£€ç´¢æµç¨‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;Document&gt; <span class="hljs-title function_">retrieve</span><span class="hljs-params">(String query, <span class="hljs-type">int</span> topK)</span> &#123;<br>        <span class="hljs-keyword">return</span> vectorStore.search(query, topK);<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * RAG å®Œæ•´æµç¨‹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">chat</span><span class="hljs-params">(String question)</span> &#123;<br>        <span class="hljs-comment">// 1. æ£€ç´¢ç›¸å…³æ–‡æ¡£</span><br>        List&lt;Document&gt; contexts = retrieve(question, <span class="hljs-number">5</span>);<br>        <br>        <span class="hljs-comment">// 2. æ„å»º Prompt</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">prompt</span> <span class="hljs-operator">=</span> buildPrompt(question, contexts);<br>        <br>        <span class="hljs-comment">// 3. è°ƒç”¨ LLMï¼ˆè¿™é‡Œå¯ä»¥å†æŠ½è±¡ä¸€ä¸ª LLM æ¥å£ï¼‰</span><br>        <span class="hljs-keyword">return</span> llmClient.generate(prompt);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="Controller-å±‚è®¾è®¡ï¼ˆrag-apiï¼‰"><a href="#Controller-å±‚è®¾è®¡ï¼ˆrag-apiï¼‰" class="headerlink" title="Controller å±‚è®¾è®¡ï¼ˆrag-apiï¼‰"></a>Controller å±‚è®¾è®¡ï¼ˆrag-apiï¼‰</h3><p>Controller å±‚è´Ÿè´£<strong>å¯¹å¤–æš´éœ² HTTP æ¥å£</strong>ã€‚</p><h4 id="æ¨¡å—-POM-1"><a href="#æ¨¡å—-POM-1" class="headerlink" title="æ¨¡å— POM"></a>æ¨¡å— POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag-api/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- ä¾èµ– service å±‚ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- Web ä¾èµ– --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="Controller-å®ç°"><a href="#Controller-å®ç°" class="headerlink" title="Controller å®ç°"></a>Controller å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// RagController.java</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/api/rag&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RagController</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RagService ragService;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RagController</span><span class="hljs-params">(RagService ragService)</span> &#123;<br>        <span class="hljs-built_in">this</span>.ragService = ragService;<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡æ¡£å…¥åº“</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/ingest&quot;)</span><br>    <span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title function_">ingest</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> IngestRequest request)</span> &#123;<br>        <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>(request.getContent(), request.getMetadata());<br>        ragService.ingest(doc);<br>        <span class="hljs-keyword">return</span> ResponseEntity.ok().build();<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ£€ç´¢</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GetMapping(&quot;/retrieve&quot;)</span><br>    <span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;DocumentVO&gt;&gt; <span class="hljs-title function_">retrieve</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-meta">@RequestParam</span> String query,</span><br><span class="hljs-params">            <span class="hljs-meta">@RequestParam(defaultValue = &quot;5&quot;)</span> <span class="hljs-type">int</span> topK)</span> &#123;<br>        List&lt;Document&gt; docs = ragService.retrieve(query, topK);<br>        <span class="hljs-keyword">return</span> ResponseEntity.ok(DocumentVO.from(docs));<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é—®ç­”</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostMapping(&quot;/chat&quot;)</span><br>    <span class="hljs-keyword">public</span> ResponseEntity&lt;ChatResponse&gt; <span class="hljs-title function_">chat</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ChatRequest request)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">answer</span> <span class="hljs-operator">=</span> ragService.chat(request.getQuestion());<br>        <span class="hljs-keyword">return</span> ResponseEntity.ok(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatResponse</span>(answer));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="DTO-å®šä¹‰"><a href="#DTO-å®šä¹‰" class="headerlink" title="DTO å®šä¹‰"></a>DTO å®šä¹‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¯·æ±‚/å“åº”å¯¹è±¡æ”¾åœ¨ api æ¨¡å—</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">IngestRequest</span><span class="hljs-params">(String content, Map&lt;String, Object&gt; metadata)</span> &#123;&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">ChatRequest</span><span class="hljs-params">(String question)</span> &#123;&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">ChatResponse</span><span class="hljs-params">(String answer)</span> &#123;&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="å¯åŠ¨æ¨¡å—è®¾è®¡ï¼ˆrag-serverï¼‰"><a href="#å¯åŠ¨æ¨¡å—è®¾è®¡ï¼ˆrag-serverï¼‰" class="headerlink" title="å¯åŠ¨æ¨¡å—è®¾è®¡ï¼ˆrag-serverï¼‰"></a>å¯åŠ¨æ¨¡å—è®¾è®¡ï¼ˆrag-serverï¼‰</h3><p>å¯åŠ¨æ¨¡å—è´Ÿè´£<strong>é€‰æ‹©å…·ä½“å®ç° + æ‰“åŒ…éƒ¨ç½²</strong>ã€‚</p><h4 id="æ¨¡å—-POM-2"><a href="#æ¨¡å—-POM-2" class="headerlink" title="æ¨¡å— POM"></a>æ¨¡å— POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag-server/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- API å±‚ï¼ˆåŒ…å« Controllerï¼‰ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- è‡ªåŠ¨é…ç½® --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- ===== é€‰æ‹©å…·ä½“å®ç° ===== --&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- å‘é‡å­˜å‚¨ï¼šé€‰æ‹© PgVector --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-store-pgvector<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- åˆ‡ç‰‡æ–¹å¼ï¼šé€‰æ‹©è¯­ä¹‰åˆ‡ç‰‡ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag-splitter-semantic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- Spring Boot --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- æ‰“åŒ…æˆå¯æ‰§è¡Œ JAR --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// RagServerApplication.java</span><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RagServerApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(RagServerApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># application.yml</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><br><span class="hljs-attr">rag:</span><br>  <span class="hljs-attr">store:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">pgvector</span><br>    <span class="hljs-attr">datasource:</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:postgresql://localhost:5432/rag</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">postgres</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">secret</span><br>  <span class="hljs-attr">splitter:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">semantic</span><br>    <span class="hljs-attr">chunk-size:</span> <span class="hljs-number">500</span><br>    <span class="hljs-attr">overlap:</span> <span class="hljs-number">50</span><br>  <span class="hljs-attr">embedding:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">openai</span><br>    <span class="hljs-attr">api-key:</span> <span class="hljs-string">$&#123;OPENAI_API_KEY&#125;</span><br></code></pre></td></tr></table></figure><hr><h3 id="å¤šç§éƒ¨ç½²æ–¹å¼"><a href="#å¤šç§éƒ¨ç½²æ–¹å¼" class="headerlink" title="å¤šç§éƒ¨ç½²æ–¹å¼"></a>å¤šç§éƒ¨ç½²æ–¹å¼</h3><p>é€šè¿‡ä¸åŒçš„ server æ¨¡å—ï¼Œå¯ä»¥çµæ´»ç»„åˆï¼š</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">rag-server-pg/          <span class="hljs-comment"># PgVector + è¯­ä¹‰åˆ‡ç‰‡</span><br>â”œâ”€â”€ pom.<span class="hljs-keyword">xml</span>             <span class="hljs-title"># å¼•å…¥ pgvector</span> + semantic<br>â””â”€â”€ application.yml<br><br>rag-server-es/          <span class="hljs-comment"># ES + å›ºå®šåˆ‡ç‰‡</span><br>â”œâ”€â”€ pom.<span class="hljs-keyword">xml</span>             <span class="hljs-title"># å¼•å…¥ elasticsearch</span> + fixed<br>â””â”€â”€ application.yml<br><br>rag-server-all/         <span class="hljs-comment"># å…¨éƒ¨å®ç°ï¼ˆé€šè¿‡é…ç½®åˆ‡æ¢ï¼‰</span><br>â”œâ”€â”€ pom.<span class="hljs-keyword">xml</span>             <span class="hljs-title"># å¼•å…¥æ‰€æœ‰å®ç°</span><br><span class="hljs-title">â””â”€â”€ application</span>.yml     <span class="hljs-comment"># é…ç½®æŒ‡å®šä½¿ç”¨å“ªä¸ª</span><br></code></pre></td></tr></table></figure><hr><h3 id="æ¨¡å—èŒè´£æ€»ç»“"><a href="#æ¨¡å—èŒè´£æ€»ç»“" class="headerlink" title="æ¨¡å—èŒè´£æ€»ç»“"></a>æ¨¡å—èŒè´£æ€»ç»“</h3><table><thead><tr><th>æ¨¡å—</th><th>èŒè´£</th><th>ä¾èµ–</th></tr></thead><tbody><tr><td><strong>rag-core</strong></td><td>æ ¸å¿ƒæ¥å£å®šä¹‰</td><td>æ— </td></tr><tr><td><strong>rag-store-xxx</strong></td><td>å‘é‡å­˜å‚¨å®ç°</td><td>core</td></tr><tr><td><strong>rag-splitter-xxx</strong></td><td>åˆ‡ç‰‡ç­–ç•¥å®ç°</td><td>core</td></tr><tr><td><strong>rag-spring-boot-starter</strong></td><td>è‡ªåŠ¨é…ç½®</td><td>core</td></tr><tr><td><strong>rag-service</strong></td><td>ä¸šåŠ¡é€»è¾‘ï¼Œç»„åˆç»„ä»¶</td><td>core</td></tr><tr><td><strong>rag-api</strong></td><td>REST Controller</td><td>service</td></tr><tr><td><strong>rag-server</strong></td><td>å¯åŠ¨æ¨¡å—ï¼Œé€‰æ‹©å®ç°</td><td>api + starter + å…·ä½“å®ç°</td></tr></tbody></table><h3 id="æ¡†æ¶ä½¿ç”¨è€…-vs-æ¡†æ¶å¼€å‘è€…"><a href="#æ¡†æ¶ä½¿ç”¨è€…-vs-æ¡†æ¶å¼€å‘è€…" class="headerlink" title="æ¡†æ¶ä½¿ç”¨è€… vs æ¡†æ¶å¼€å‘è€…"></a>æ¡†æ¶ä½¿ç”¨è€… vs æ¡†æ¶å¼€å‘è€…</h3><table><thead><tr><th>è§’è‰²</th><th>ä½¿ç”¨æ¨¡å—</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ¡†æ¶ä½¿ç”¨è€…</strong></td><td>core + starter + å®ç°æ¨¡å—</td><td>é›†æˆåˆ°è‡ªå·±é¡¹ç›®</td></tr><tr><td><strong>æ¡†æ¶å¼€å‘è€…</strong></td><td>å…¨éƒ¨æ¨¡å—</td><td>å¼€å‘å’Œç»´æŠ¤æ¡†æ¶</td></tr><tr><td><strong>ç‹¬ç«‹éƒ¨ç½²</strong></td><td>server</td><td>ç›´æ¥è¿è¡ŒæœåŠ¡</td></tr></tbody></table><hr><h2 id="ç®€åŒ–ä¸‰å±‚ç»“æ„ï¼ˆæ¨èï¼‰"><a href="#ç®€åŒ–ä¸‰å±‚ç»“æ„ï¼ˆæ¨èï¼‰" class="headerlink" title="ç®€åŒ–ä¸‰å±‚ç»“æ„ï¼ˆæ¨èï¼‰"></a>ç®€åŒ–ä¸‰å±‚ç»“æ„ï¼ˆæ¨èï¼‰</h2><p>å¯¹äºä¸­å°å‹é¡¹ç›®ï¼Œå¯ä»¥é‡‡ç”¨æ›´ç®€æ´çš„ä¸‰å±‚ç»“æ„ï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix">rag4j<span class="hljs-symbol">/</span><br>â”œâ”€â”€ pom.xml                       <span class="hljs-comment"># çˆ¶ POM</span><br>â”œâ”€â”€ rag4j-framework<span class="hljs-symbol">/</span>              <span class="hljs-comment"># æ¡†æ¶å±‚ - æ ¸å¿ƒæŠ½è±¡ä¸é€šç”¨èƒ½åŠ›</span><br>â”œâ”€â”€ rag4j-project<span class="hljs-symbol">/</span>                <span class="hljs-comment"># å®ç°å±‚ - å…·ä½“æŠ€æœ¯å®ç°</span><br>â”œâ”€â”€ rag4j-app<span class="hljs-symbol">/</span>                    <span class="hljs-comment"># åº”ç”¨å±‚ - WebæœåŠ¡å…¥å£</span><br>â””â”€â”€ test<span class="hljs-symbol">/</span>                         <span class="hljs-comment"># æµ‹è¯•æ¨¡å—</span><br></code></pre></td></tr></table></figure><h3 id="å„å±‚è¯¦ç»†ç»“æ„"><a href="#å„å±‚è¯¦ç»†ç»“æ„" class="headerlink" title="å„å±‚è¯¦ç»†ç»“æ„"></a>å„å±‚è¯¦ç»†ç»“æ„</h3><h4 id="1-æ¡†æ¶å±‚ï¼ˆrag4j-frameworkï¼‰"><a href="#1-æ¡†æ¶å±‚ï¼ˆrag4j-frameworkï¼‰" class="headerlink" title="1. æ¡†æ¶å±‚ï¼ˆrag4j-frameworkï¼‰"></a>1. æ¡†æ¶å±‚ï¼ˆrag4j-frameworkï¼‰</h4><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs nix">rag4j-framework<span class="hljs-symbol">/</span><br>â”œâ”€â”€ pom.xml<br>â””â”€â”€ src<span class="hljs-operator">/</span>main<span class="hljs-operator">/</span>java<span class="hljs-operator">/</span>com<span class="hljs-operator">/</span>example<span class="hljs-operator">/</span>rag4j<span class="hljs-operator">/</span>framework<span class="hljs-symbol">/</span><br>    â”‚<br>    â”œâ”€â”€ core<span class="hljs-symbol">/</span>                     <span class="hljs-comment"># æ ¸å¿ƒæ¥å£å®šä¹‰</span><br>    â”‚   â”œâ”€â”€ VectorStore.java<br>    â”‚   â”œâ”€â”€ DocumentSplitter.java<br>    â”‚   â”œâ”€â”€ EmbeddingModel.java<br>    â”‚   â””â”€â”€ Document.java<br>    â”‚<br>    â”œâ”€â”€ store<span class="hljs-symbol">/</span>                    <span class="hljs-comment"># å‘é‡å­˜å‚¨æŠ½è±¡</span><br>    â”‚   â”œâ”€â”€ AbstractVectorStore.java<br>    â”‚   â””â”€â”€ VectorStoreConfig.java<br>    â”‚<br>    â”œâ”€â”€ splitter<span class="hljs-symbol">/</span>                 <span class="hljs-comment"># åˆ‡ç‰‡å™¨æŠ½è±¡</span><br>    â”‚   â”œâ”€â”€ AbstractSplitter.java<br>    â”‚   â””â”€â”€ SplitterConfig.java<br>    â”‚<br>    â”œâ”€â”€ embedding<span class="hljs-symbol">/</span>                <span class="hljs-comment"># åµŒå…¥æ¨¡å‹æŠ½è±¡</span><br>    â”‚   â””â”€â”€ AbstractEmbeddingModel.java<br>    â”‚<br>    â”œâ”€â”€ spi<span class="hljs-symbol">/</span>                      <span class="hljs-comment"># SPI åŠ è½½æœºåˆ¶</span><br>    â”‚   â””â”€â”€ SpiLoader.java<br>    â”‚<br>    â””â”€â”€ util<span class="hljs-symbol">/</span>                     <span class="hljs-comment"># é€šç”¨å·¥å…·</span><br>        â”œâ”€â”€ RetryUtil.java<br>        â””â”€â”€ BatchUtil.java<br></code></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼šçº¯æŠ½è±¡ï¼Œæ— ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆæˆ–æœ€å°ä¾èµ–ï¼‰</p><h4 id="2-å®ç°å±‚ï¼ˆrag4j-projectï¼‰"><a href="#2-å®ç°å±‚ï¼ˆrag4j-projectï¼‰" class="headerlink" title="2. å®ç°å±‚ï¼ˆrag4j-projectï¼‰"></a>2. å®ç°å±‚ï¼ˆrag4j-projectï¼‰</h4><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs nix">rag4j-project<span class="hljs-symbol">/</span><br>â”œâ”€â”€ pom.xml                       <span class="hljs-comment"># èšåˆæ¨¡å—</span><br>â”‚<br>â”œâ”€â”€ rag4j-store-pgvector<span class="hljs-symbol">/</span>         <span class="hljs-comment"># PgVector å®ç°</span><br>â”‚   â”œâ”€â”€ pom.xml<br>â”‚   â””â”€â”€ src<span class="hljs-symbol">/.../PgVectorStore.java</span><br>â”‚<br>â”œâ”€â”€ rag4j-store-elasticsearch<span class="hljs-symbol">/</span>    <span class="hljs-comment"># ES å®ç°</span><br>â”‚   â””â”€â”€ ...<br>â”‚<br>â”œâ”€â”€ rag4j-store-neo4j<span class="hljs-symbol">/</span>            <span class="hljs-comment"># Neo4j å®ç°</span><br>â”‚   â””â”€â”€ ...<br>â”‚<br>â”œâ”€â”€ rag4j-splitter-fixed<span class="hljs-symbol">/</span>         <span class="hljs-comment"># å›ºå®šåˆ‡ç‰‡</span><br>â”‚   â””â”€â”€ ...<br>â”‚<br>â”œâ”€â”€ rag4j-splitter-semantic<span class="hljs-symbol">/</span>      <span class="hljs-comment"># è¯­ä¹‰åˆ‡ç‰‡</span><br>â”‚   â””â”€â”€ ...<br>â”‚<br>â”œâ”€â”€ rag4j-embedding-openai<span class="hljs-symbol">/</span>       <span class="hljs-comment"># OpenAI åµŒå…¥</span><br>â”‚   â””â”€â”€ ...<br>â”‚<br>â””â”€â”€ rag4j-spring-boot-starter<span class="hljs-symbol">/</span>    <span class="hljs-comment"># Spring Boot è‡ªåŠ¨é…ç½®</span><br>    â””â”€â”€ ...<br></code></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼šæ¯ä¸ªå®ç°ç‹¬ç«‹æ¨¡å—ï¼ŒæŒ‰éœ€å¼•å…¥</p><h4 id="3-åº”ç”¨å±‚ï¼ˆrag4j-appï¼‰"><a href="#3-åº”ç”¨å±‚ï¼ˆrag4j-appï¼‰" class="headerlink" title="3. åº”ç”¨å±‚ï¼ˆrag4j-appï¼‰"></a>3. åº”ç”¨å±‚ï¼ˆrag4j-appï¼‰</h4><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs nix">rag4j-app<span class="hljs-symbol">/</span><br>â”œâ”€â”€ pom.xml<br>â””â”€â”€ src<span class="hljs-operator">/</span>main<span class="hljs-symbol">/</span><br>    â”œâ”€â”€ java<span class="hljs-operator">/</span>com<span class="hljs-operator">/</span>example<span class="hljs-operator">/</span>rag4j<span class="hljs-operator">/</span>app<span class="hljs-symbol">/</span><br>    â”‚   â”œâ”€â”€ Rag4jApplication.java     <span class="hljs-comment"># å¯åŠ¨ç±»</span><br>    â”‚   â”œâ”€â”€ config<span class="hljs-symbol">/</span>                   <span class="hljs-comment"># é…ç½®ç±»</span><br>    â”‚   â”‚   â””â”€â”€ Rag4jConfig.java<br>    â”‚   â”œâ”€â”€ service<span class="hljs-symbol">/</span>                  <span class="hljs-comment"># ä¸šåŠ¡æœåŠ¡</span><br>    â”‚   â”‚   â””â”€â”€ RagService.java<br>    â”‚   â”œâ”€â”€ controller<span class="hljs-symbol">/</span>               <span class="hljs-comment"># REST API</span><br>    â”‚   â”‚   â””â”€â”€ RagController.java<br>    â”‚   â””â”€â”€ dto<span class="hljs-symbol">/</span>                      <span class="hljs-comment"># è¯·æ±‚/å“åº”å¯¹è±¡</span><br>    â”‚       â”œâ”€â”€ ChatRequest.java<br>    â”‚       â””â”€â”€ ChatResponse.java<br>    â””â”€â”€ resources<span class="hljs-symbol">/</span><br>        â””â”€â”€ application.yml<br></code></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼šç»„åˆæ¡†æ¶å±‚å’Œå®ç°å±‚ï¼Œå¯¹å¤–æä¾›æœåŠ¡</p><hr><h3 id="ä¾èµ–å…³ç³»-2"><a href="#ä¾èµ–å…³ç³»-2" class="headerlink" title="ä¾èµ–å…³ç³»"></a>ä¾èµ–å…³ç³»</h3><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                      rag4j-app                               â”‚<br>â”‚            (Controller + Service + å¯åŠ¨é…ç½®)                  â”‚<br>â”‚                                                              â”‚<br>â”‚   ä¾èµ–: framework + é€‰æ‹©çš„å®ç°æ¨¡å— + starter                   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                              â”‚<br>          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>          â–¼                   â–¼                   â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ rag4j-store-pg  â”‚ â”‚rag4j-splitter-  â”‚ â”‚ rag4j-embedding â”‚<br>â”‚                 â”‚ â”‚   semantic      â”‚ â”‚    -openai      â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>          â”‚                   â”‚                   â”‚<br>          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                              â–¼<br>              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>              â”‚      rag4j-framework      â”‚<br>              â”‚   (æ¥å£ + æŠ½è±¡ç±» + <span class="hljs-built_in">SPI</span>)    â”‚<br>              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><hr><h3 id="POM-é…ç½®ç¤ºä¾‹"><a href="#POM-é…ç½®ç¤ºä¾‹" class="headerlink" title="POM é…ç½®ç¤ºä¾‹"></a>POM é…ç½®ç¤ºä¾‹</h3><h4 id="çˆ¶-POM"><a href="#çˆ¶-POM" class="headerlink" title="çˆ¶ POM"></a>çˆ¶ POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag4j/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag4j-framework<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag4j-project<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>rag4j-app<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">spring-boot.version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">spring-boot.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- å†…éƒ¨æ¨¡å—ç‰ˆæœ¬ç®¡ç† --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag4j-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;project.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- å…¶ä»–æ¨¡å—... --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="åº”ç”¨å±‚-POM"><a href="#åº”ç”¨å±‚-POM" class="headerlink" title="åº”ç”¨å±‚ POM"></a>åº”ç”¨å±‚ POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- rag4j-app/pom.xml --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag4j-app<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ¡†æ¶å±‚ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag4j-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- é€‰æ‹©å…·ä½“å®ç° --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag4j-store-pgvector<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag4j-splitter-semantic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag4j-embedding-openai<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- è‡ªåŠ¨é…ç½® --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>rag4j-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- Spring Boot --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><hr><h3 id="ä¸¤ç§ç»“æ„å¯¹æ¯”"><a href="#ä¸¤ç§ç»“æ„å¯¹æ¯”" class="headerlink" title="ä¸¤ç§ç»“æ„å¯¹æ¯”"></a>ä¸¤ç§ç»“æ„å¯¹æ¯”</h3><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>ç»†ç²’åº¦ç»“æ„</th><th>ä¸‰å±‚ç®€åŒ–ç»“æ„</th></tr></thead><tbody><tr><td><strong>æ¨¡å—æ•°é‡</strong></td><td>å¤šï¼ˆ10+ï¼‰</td><td>å°‘ï¼ˆ3-4 + å®ç°ï¼‰</td></tr><tr><td><strong>é€‚ç”¨è§„æ¨¡</strong></td><td>å¤§å‹æ¡†æ¶</td><td>ä¸­å°å‹é¡¹ç›®</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td>é«˜</td><td>é€‚ä¸­</td></tr><tr><td><strong>ç»´æŠ¤æˆæœ¬</strong></td><td>é«˜</td><td>ä½</td></tr><tr><td><strong>å­¦ä¹ æ›²çº¿</strong></td><td>é™¡</td><td>å¹³ç¼“</td></tr><tr><td><strong>å…¸å‹æ¡ˆä¾‹</strong></td><td>Spring Framework</td><td>ä¸šåŠ¡ç³»ç»Ÿ</td></tr></tbody></table><p><strong>å»ºè®®</strong>ï¼š</p><ul><li><strong>å¯¹å¤–å‘å¸ƒçš„æ¡†æ¶</strong> â†’ ç»†ç²’åº¦ç»“æ„ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‰éœ€å¼•å…¥</li><li><strong>å†…éƒ¨é¡¹ç›®&#x2F;ä¸šåŠ¡ç³»ç»Ÿ</strong> â†’ ä¸‰å±‚ç®€åŒ–ç»“æ„ï¼Œå¼€å‘æ•ˆç‡é«˜</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Maven</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Maven</tag>
      
      <tag>å¤šæ¨¡å—</tag>
      
      <tag>é¡¹ç›®æ¶æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é€’å½’è¯¦è§£ä¸åº”ç”¨</title>
    <link href="/2026/01/12/%E9%80%92%E5%BD%92%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8/"/>
    <url>/2026/01/12/%E9%80%92%E5%BD%92%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="é€’å½’è¯¦è§£ä¸åº”ç”¨"><a href="#é€’å½’è¯¦è§£ä¸åº”ç”¨" class="headerlink" title="é€’å½’è¯¦è§£ä¸åº”ç”¨"></a>é€’å½’è¯¦è§£ä¸åº”ç”¨</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>é€’å½’</strong> æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€å·§ï¼Œå‡½æ•°è°ƒç”¨è‡ªèº«æ¥è§£å†³é—®é¢˜ã€‚é€’å½’çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å°†å¤§é—®é¢˜åˆ†è§£ä¸ºç›¸åŒçš„å°é—®é¢˜ï¼Œç›´åˆ°é—®é¢˜è¶³å¤Ÿå°å¯ä»¥ç›´æ¥æ±‚è§£</strong>ã€‚</p><blockquote><p><strong>ğŸ’¡ æç¤º: æ ¸å¿ƒæ€æƒ³</strong><br>é€’å½’ &#x3D; è‡ªæˆ‘è°ƒç”¨ + ç»ˆæ­¢æ¡ä»¶ + é—®é¢˜åˆ†è§£</p></blockquote><hr><h2 id="ä¸€ã€é€’å½’çš„ä¸‰ä¸ªè¦ç´ "><a href="#ä¸€ã€é€’å½’çš„ä¸‰ä¸ªè¦ç´ " class="headerlink" title="ä¸€ã€é€’å½’çš„ä¸‰ä¸ªè¦ç´ "></a>ä¸€ã€é€’å½’çš„ä¸‰ä¸ªè¦ç´ </h2><h3 id="1-1-é€’å½’çš„æœ¬è´¨"><a href="#1-1-é€’å½’çš„æœ¬è´¨" class="headerlink" title="1.1 é€’å½’çš„æœ¬è´¨"></a>1.1 é€’å½’çš„æœ¬è´¨</h3><p>é€’å½’å°±æ˜¯<strong>å‡½æ•°è°ƒç”¨è‡ªå·±</strong>ï¼Œä½†æ¯æ¬¡è°ƒç”¨éƒ½åœ¨å¤„ç†ä¸€ä¸ªæ›´å°çš„é—®é¢˜ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs">å¤§é—®é¢˜<br>  â†“<br>åˆ†è§£ä¸ºæ›´å°çš„é—®é¢˜ + è°ƒç”¨è‡ªå·±<br>  â†“<br>ç»§ç»­åˆ†è§£<br>  â†“<br>ç›´åˆ°é—®é¢˜è¶³å¤Ÿå°<br>  â†“<br>ç›´æ¥æ±‚è§£ï¼ˆè¿”å›ç»“æœï¼‰<br>  â†“<br>é€å±‚è¿”å›ç»“æœ<br></code></pre></td></tr></table></figure><h3 id="1-2-é€’å½’çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶"><a href="#1-2-é€’å½’çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶" class="headerlink" title="1.2 é€’å½’çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶"></a>1.2 é€’å½’çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶</h3><table><thead><tr><th>æ¡ä»¶</th><th>è¯´æ˜</th><th>é‡è¦æ€§</th></tr></thead><tbody><tr><td><strong>é€’å½’å…³ç³»</strong></td><td>å‡½æ•°è°ƒç”¨è‡ªèº«</td><td>å¿…é¡»</td></tr><tr><td><strong>ç»ˆæ­¢æ¡ä»¶</strong></td><td>ä½•æ—¶åœæ­¢é€’å½’</td><td><strong>å¿…é¡»</strong>ï¼ˆæ²¡æœ‰ä¼šæ— é™å¾ªç¯ï¼‰</td></tr><tr><td><strong>é—®é¢˜åˆ†è§£</strong></td><td>å¦‚ä½•å°†å¤§é—®é¢˜åˆ†è§£ä¸ºå°é—®é¢˜</td><td>å¿…é¡»</td></tr></tbody></table><h3 id="1-3-é€’å½’çš„é€šç”¨æ¨¡æ¿"><a href="#1-3-é€’å½’çš„é€šç”¨æ¨¡æ¿" class="headerlink" title="1.3 é€’å½’çš„é€šç”¨æ¨¡æ¿"></a>1.3 é€’å½’çš„é€šç”¨æ¨¡æ¿</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€’å½’å‡½æ•°çš„æ ‡å‡†æ¨¡æ¿</span><br>è¿”å›å€¼ç±»å‹ recursiveFunction(å‚æ•°) &#123;<br>    <span class="hljs-comment">// 1. ç»ˆæ­¢æ¡ä»¶ï¼ˆåŸºç¡€æƒ…å†µï¼‰</span><br>    <span class="hljs-keyword">if</span> (ç»ˆæ­¢æ¡ä»¶) &#123;<br>        <span class="hljs-keyword">return</span> åŸºç¡€æƒ…å†µçš„ç»“æœ;<br>    &#125;<br>    <br>    <span class="hljs-comment">// 2. é€’å½’å…³ç³»ï¼ˆé€’å½’æƒ…å†µï¼‰</span><br>    <span class="hljs-comment">// è°ƒç”¨è‡ªèº«å¤„ç†æ›´å°çš„é—®é¢˜</span><br>    è¿”å›å€¼ = recursiveFunction(æ›´å°çš„å‚æ•°);<br>    <br>    <span class="hljs-comment">// 3. å¤„ç†ç»“æœ</span><br>    <span class="hljs-keyword">return</span> å¤„ç†åçš„ç»“æœ;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="äºŒã€é€’å½’çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#äºŒã€é€’å½’çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="äºŒã€é€’å½’çš„æ‰§è¡Œè¿‡ç¨‹"></a>äºŒã€é€’å½’çš„æ‰§è¡Œè¿‡ç¨‹</h2><h3 id="2-1-é€’å½’æ ˆçš„æ¦‚å¿µ"><a href="#2-1-é€’å½’æ ˆçš„æ¦‚å¿µ" class="headerlink" title="2.1 é€’å½’æ ˆçš„æ¦‚å¿µ"></a>2.1 é€’å½’æ ˆçš„æ¦‚å¿µ</h3><p>å½“å‡½æ•°è°ƒç”¨è‡ªå·±æ—¶ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šåœ¨<strong>æ ˆ</strong>ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°æ‰§è¡Œç¯å¢ƒã€‚</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs isbl">é€’å½’è°ƒç”¨è¿‡ç¨‹ï¼š<br><span class="hljs-function"><span class="hljs-title">recursion</span>(<span class="hljs-number">5</span>)</span><br>  â†“ è°ƒç”¨<br><span class="hljs-function"><span class="hljs-title">recursion</span>(<span class="hljs-number">4</span>)</span><br>  â†“ è°ƒç”¨<br><span class="hljs-function"><span class="hljs-title">recursion</span>(<span class="hljs-number">3</span>)</span><br>  â†“ è°ƒç”¨<br><span class="hljs-function"><span class="hljs-title">recursion</span>(<span class="hljs-number">2</span>)</span><br>  â†“ è°ƒç”¨<br><span class="hljs-function"><span class="hljs-title">recursion</span>(<span class="hljs-number">1</span>)</span><br>  â†“ åˆ°è¾¾ç»ˆæ­¢æ¡ä»¶<br><span class="hljs-variable">return</span> <span class="hljs-number">1</span><br>  â†‘ è¿”å›<br><span class="hljs-variable">return</span> <span class="hljs-number">2</span> * <span class="hljs-number">1</span> = <span class="hljs-number">2</span><br>  â†‘ è¿”å›<br><span class="hljs-variable">return</span> <span class="hljs-number">3</span> * <span class="hljs-number">2</span> = <span class="hljs-number">6</span><br>  â†‘ è¿”å›<br><span class="hljs-variable">return</span> <span class="hljs-number">4</span> * <span class="hljs-number">6</span> = <span class="hljs-number">24</span><br>  â†‘ è¿”å›<br><span class="hljs-variable">return</span> <span class="hljs-number">5</span> * <span class="hljs-number">24</span> = <span class="hljs-number">120</span><br></code></pre></td></tr></table></figure><h3 id="2-2-é€’å½’æ ˆçš„å†…å­˜å ç”¨"><a href="#2-2-é€’å½’æ ˆçš„å†…å­˜å ç”¨" class="headerlink" title="2.2 é€’å½’æ ˆçš„å†…å­˜å ç”¨"></a>2.2 é€’å½’æ ˆçš„å†…å­˜å ç”¨</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs routeros">æ ˆå†…å­˜ï¼š<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ recursion(1)    â”‚ â† æœ€åå…¥æ ˆ<br>â”‚ å±€éƒ¨å˜é‡: <span class="hljs-attribute">n</span>=1   â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚ recursion(2)    â”‚<br>â”‚ å±€éƒ¨å˜é‡: <span class="hljs-attribute">n</span>=2   â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚ recursion(3)    â”‚<br>â”‚ å±€éƒ¨å˜é‡: <span class="hljs-attribute">n</span>=3   â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚ recursion(4)    â”‚<br>â”‚ å±€éƒ¨å˜é‡: <span class="hljs-attribute">n</span>=4   â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚ recursion(5)    â”‚ â† æœ€å…ˆå…¥æ ˆ<br>â”‚ å±€éƒ¨å˜é‡: <span class="hljs-attribute">n</span>=5   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br><br>é€’å½’æ·±åº¦ = 5<br>æ ˆç©ºé—´ = 5 Ã— æ¯ä¸ªå‡½æ•°çš„ç©ºé—´<br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li>æ¯æ¬¡é€’å½’è°ƒç”¨éƒ½ä¼šå ç”¨æ ˆç©ºé—´</li><li>é€’å½’æ·±åº¦è¶Šæ·±ï¼Œå ç”¨çš„æ ˆç©ºé—´è¶Šå¤š</li><li>æ ˆç©ºé—´æœ‰é™ï¼Œè¿‡æ·±çš„é€’å½’ä¼šå¯¼è‡´æ ˆæº¢å‡º</li></ul><hr><h2 id="ä¸‰ã€é€’å½’çš„å®é™…ä¾‹å­"><a href="#ä¸‰ã€é€’å½’çš„å®é™…ä¾‹å­" class="headerlink" title="ä¸‰ã€é€’å½’çš„å®é™…ä¾‹å­"></a>ä¸‰ã€é€’å½’çš„å®é™…ä¾‹å­</h2><h3 id="3-1-ä¾‹å­1ï¼šè®¡ç®—é˜¶ä¹˜"><a href="#3-1-ä¾‹å­1ï¼šè®¡ç®—é˜¶ä¹˜" class="headerlink" title="3.1 ä¾‹å­1ï¼šè®¡ç®—é˜¶ä¹˜"></a>3.1 ä¾‹å­1ï¼šè®¡ç®—é˜¶ä¹˜</h3><h4 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">5</span>! = <span class="hljs-number">5</span> Ã— <span class="hljs-number">4</span>!<br><span class="hljs-attribute">4</span>! = <span class="hljs-number">4</span> Ã— <span class="hljs-number">3</span>!<br><span class="hljs-attribute">3</span>! = <span class="hljs-number">3</span> Ã— <span class="hljs-number">2</span>!<br><span class="hljs-attribute">2</span>! = <span class="hljs-number">2</span> Ã— <span class="hljs-number">1</span>!<br><span class="hljs-attribute">1</span>! = <span class="hljs-number">1</span>ï¼ˆåŸºç¡€æƒ…å†µï¼‰<br></code></pre></td></tr></table></figure><p><strong>é€’å½’å…³ç³»</strong>ï¼š<code>n! = n Ã— (n-1)!</code><br><strong>ç»ˆæ­¢æ¡ä»¶</strong>ï¼š<code>n == 1</code></p><h4 id="é€’å½’å®ç°"><a href="#é€’å½’å®ç°" class="headerlink" title="é€’å½’å®ç°"></a>é€’å½’å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€’å½’æ–¹å¼</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">factorial</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-comment">// 1. ç»ˆæ­¢æ¡ä»¶</span><br>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">// åŸºç¡€æƒ…å†µ</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// 2. é€’å½’å…³ç³»</span><br>    <span class="hljs-comment">// è°ƒç”¨è‡ªèº«å¤„ç†æ›´å°çš„é—®é¢˜</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> n * factorial(n - <span class="hljs-number">1</span>);<br>    <br>    <span class="hljs-comment">// 3. è¿”å›ç»“æœ</span><br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-comment">// è°ƒç”¨</span><br><span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> factorial(<span class="hljs-number">5</span>);  <span class="hljs-comment">// è¿”å› 120</span><br></code></pre></td></tr></table></figure><h4 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">factorial</span>(<span class="hljs-number">5</span>)</span><br>  â†“ <span class="hljs-number">5</span> <span class="hljs-variable">!</span>= <span class="hljs-number">1</span>ï¼Œç»§ç»­é€’å½’<br>  â†“ è®¡ç®— <span class="hljs-number">5</span> * <span class="hljs-function"><span class="hljs-title">factorial</span>(<span class="hljs-number">4</span>)</span><br>    â†“ <span class="hljs-function"><span class="hljs-title">factorial</span>(<span class="hljs-number">4</span>)</span><br>    â†“ <span class="hljs-number">4</span> <span class="hljs-variable">!</span>= <span class="hljs-number">1</span>ï¼Œç»§ç»­é€’å½’<br>    â†“ è®¡ç®— <span class="hljs-number">4</span> * <span class="hljs-function"><span class="hljs-title">factorial</span>(<span class="hljs-number">3</span>)</span><br>      â†“ <span class="hljs-function"><span class="hljs-title">factorial</span>(<span class="hljs-number">3</span>)</span><br>      â†“ <span class="hljs-number">3</span> <span class="hljs-variable">!</span>= <span class="hljs-number">1</span>ï¼Œç»§ç»­é€’å½’<br>      â†“ è®¡ç®— <span class="hljs-number">3</span> * <span class="hljs-function"><span class="hljs-title">factorial</span>(<span class="hljs-number">2</span>)</span><br>        â†“ <span class="hljs-function"><span class="hljs-title">factorial</span>(<span class="hljs-number">2</span>)</span><br>        â†“ <span class="hljs-number">2</span> <span class="hljs-variable">!</span>= <span class="hljs-number">1</span>ï¼Œç»§ç»­é€’å½’<br>        â†“ è®¡ç®— <span class="hljs-number">2</span> * <span class="hljs-function"><span class="hljs-title">factorial</span>(<span class="hljs-number">1</span>)</span><br>          â†“ <span class="hljs-function"><span class="hljs-title">factorial</span>(<span class="hljs-number">1</span>)</span><br>          â†“ <span class="hljs-number">1</span> == <span class="hljs-number">1</span>ï¼Œåˆ°è¾¾ç»ˆæ­¢æ¡ä»¶<br>          â†“ <span class="hljs-variable">return</span> <span class="hljs-number">1</span><br>        â†“ <span class="hljs-variable">return</span> <span class="hljs-number">2</span> * <span class="hljs-number">1</span> = <span class="hljs-number">2</span><br>      â†“ <span class="hljs-variable">return</span> <span class="hljs-number">3</span> * <span class="hljs-number">2</span> = <span class="hljs-number">6</span><br>    â†“ <span class="hljs-variable">return</span> <span class="hljs-number">4</span> * <span class="hljs-number">6</span> = <span class="hljs-number">24</span><br>  â†“ <span class="hljs-variable">return</span> <span class="hljs-number">5</span> * <span class="hljs-number">24</span> = <span class="hljs-number">120</span><br></code></pre></td></tr></table></figure><p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼ˆé€’å½’æ ˆæ·±åº¦ï¼‰</p><h3 id="3-2-ä¾‹å­2ï¼šé“¾è¡¨éå†ï¼ˆæ ‘éå†çš„åŸºç¡€ï¼‰"><a href="#3-2-ä¾‹å­2ï¼šé“¾è¡¨éå†ï¼ˆæ ‘éå†çš„åŸºç¡€ï¼‰" class="headerlink" title="3.2 ä¾‹å­2ï¼šé“¾è¡¨éå†ï¼ˆæ ‘éå†çš„åŸºç¡€ï¼‰"></a>3.2 ä¾‹å­2ï¼šé“¾è¡¨éå†ï¼ˆæ ‘éå†çš„åŸºç¡€ï¼‰</h3><h4 id="é—®é¢˜åˆ†æ-1"><a href="#é—®é¢˜åˆ†æ-1" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">é“¾è¡¨ï¼š1 â†’ 2 â†’ 3 â†’ null<br><br>éå†æ€è·¯ï¼š<br><span class="hljs-bullet">- </span>è®¿é—®å½“å‰èŠ‚ç‚¹<br><span class="hljs-bullet">- </span>é€’å½’éå†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹<br><span class="hljs-bullet">- </span>ç»ˆæ­¢æ¡ä»¶ï¼šèŠ‚ç‚¹ä¸º null<br></code></pre></td></tr></table></figure><h4 id="é€’å½’å®ç°-1"><a href="#é€’å½’å®ç°-1" class="headerlink" title="é€’å½’å®ç°"></a>é€’å½’å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListNode</span> &#123;<br>    <span class="hljs-type">int</span> val;<br>    ListNode next;<br>    <br>    ListNode(<span class="hljs-type">int</span> val) &#123;<br>        <span class="hljs-built_in">this</span>.val = val;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// é€’å½’éå†é“¾è¡¨</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">traverse</span><span class="hljs-params">(ListNode node)</span> &#123;<br>    <span class="hljs-comment">// 1. ç»ˆæ­¢æ¡ä»¶</span><br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// åˆ°è¾¾é“¾è¡¨æœ«å°¾</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// 2. å¤„ç†å½“å‰èŠ‚ç‚¹</span><br>    System.out.println(node.val);<br>    <br>    <span class="hljs-comment">// 3. é€’å½’å¤„ç†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span><br>    traverse(node.next);<br>&#125;<br><br><span class="hljs-comment">// è°ƒç”¨</span><br><span class="hljs-type">ListNode</span> <span class="hljs-variable">head</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">1</span>);<br>head.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">2</span>);<br>head.next.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">3</span>);<br><br>traverse(head);  <span class="hljs-comment">// è¾“å‡ºï¼š1 2 3</span><br></code></pre></td></tr></table></figure><h4 id="æ‰§è¡Œè¿‡ç¨‹-1"><a href="#æ‰§è¡Œè¿‡ç¨‹-1" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">traverse</span>(<span class="hljs-variable">node1</span>)  <span class="hljs-comment">// node1.val = 1</span></span><br><span class="hljs-function">  â†“ <span class="hljs-variable">node1</span> <span class="hljs-variable">!</span>= <span class="hljs-variable"><span class="hljs-literal">null</span></span></span><br><span class="hljs-function">  â†“ æ‰“å° <span class="hljs-number">1</span></span><br><span class="hljs-function">  â†“ è°ƒç”¨ <span class="hljs-title">traverse</span>(<span class="hljs-variable">node2</span>)</span><br>    â†“ <span class="hljs-function"><span class="hljs-title">traverse</span>(<span class="hljs-variable">node2</span>)  <span class="hljs-comment">// node2.val = 2</span></span><br><span class="hljs-function">    â†“ <span class="hljs-variable">node2</span> <span class="hljs-variable">!</span>= <span class="hljs-variable"><span class="hljs-literal">null</span></span></span><br><span class="hljs-function">    â†“ æ‰“å° <span class="hljs-number">2</span></span><br><span class="hljs-function">    â†“ è°ƒç”¨ <span class="hljs-title">traverse</span>(<span class="hljs-variable">node3</span>)</span><br>      â†“ <span class="hljs-function"><span class="hljs-title">traverse</span>(<span class="hljs-variable">node3</span>)  <span class="hljs-comment">// node3.val = 3</span></span><br><span class="hljs-function">      â†“ <span class="hljs-variable">node3</span> <span class="hljs-variable">!</span>= <span class="hljs-variable"><span class="hljs-literal">null</span></span></span><br><span class="hljs-function">      â†“ æ‰“å° <span class="hljs-number">3</span></span><br><span class="hljs-function">      â†“ è°ƒç”¨ <span class="hljs-title">traverse</span>(<span class="hljs-variable"><span class="hljs-literal">null</span></span>)</span><br>        â†“ <span class="hljs-function"><span class="hljs-title">traverse</span>(<span class="hljs-variable"><span class="hljs-literal">null</span></span>)</span><br>        â†“ <span class="hljs-variable"><span class="hljs-literal">null</span></span> == <span class="hljs-variable"><span class="hljs-literal">null</span></span>ï¼Œåˆ°è¾¾ç»ˆæ­¢æ¡ä»¶<br>        â†“ <span class="hljs-variable">return</span><br>      â†“ <span class="hljs-variable">return</span><br>    â†“ <span class="hljs-variable">return</span><br>  â†“ <span class="hljs-variable">return</span><br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li>æ¯æ¬¡é€’å½’éƒ½å¤„ç†ä¸€ä¸ªèŠ‚ç‚¹</li><li>é€šè¿‡ <code>node.next</code> å°†é—®é¢˜åˆ†è§£ä¸ºæ›´å°çš„é—®é¢˜</li><li>å½“ <code>node == null</code> æ—¶åœæ­¢é€’å½’</li></ul><h3 id="3-3-ä¾‹å­3ï¼šäºŒå‰æ ‘å‰åºéå†"><a href="#3-3-ä¾‹å­3ï¼šäºŒå‰æ ‘å‰åºéå†" class="headerlink" title="3.3 ä¾‹å­3ï¼šäºŒå‰æ ‘å‰åºéå†"></a>3.3 ä¾‹å­3ï¼šäºŒå‰æ ‘å‰åºéå†</h3><h4 id="é—®é¢˜åˆ†æ-2"><a href="#é—®é¢˜åˆ†æ-2" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs markdown">æ ‘ç»“æ„ï¼š<br><span class="hljs-code">      1</span><br><span class="hljs-code">     / \</span><br><span class="hljs-code">    2   3</span><br><span class="hljs-code"></span><br>å‰åºéå†ï¼šæ ¹ â†’ å·¦å­æ ‘ â†’ å³å­æ ‘<br>è¾“å‡ºï¼š1 2 3<br><br>é€’å½’æ€è·¯ï¼š<br><span class="hljs-bullet">1.</span> è®¿é—®æ ¹èŠ‚ç‚¹<br><span class="hljs-bullet">2.</span> é€’å½’éå†å·¦å­æ ‘<br><span class="hljs-bullet">3.</span> é€’å½’éå†å³å­æ ‘<br></code></pre></td></tr></table></figure><h4 id="é€’å½’å®ç°-2"><a href="#é€’å½’å®ç°-2" class="headerlink" title="é€’å½’å®ç°"></a>é€’å½’å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span> &#123;<br>    <span class="hljs-type">int</span> val;<br>    TreeNode left;<br>    TreeNode right;<br>    <br>    TreeNode(<span class="hljs-type">int</span> val) &#123;<br>        <span class="hljs-built_in">this</span>.val = val;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å‰åºéå†</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">preorder</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-comment">// 1. ç»ˆæ­¢æ¡ä»¶</span><br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// 2. å¤„ç†æ ¹èŠ‚ç‚¹</span><br>    System.out.println(node.val);<br>    <br>    <span class="hljs-comment">// 3. é€’å½’å¤„ç†å·¦å­æ ‘</span><br>    preorder(node.left);<br>    <br>    <span class="hljs-comment">// 4. é€’å½’å¤„ç†å³å­æ ‘</span><br>    preorder(node.right);<br>&#125;<br><br><span class="hljs-comment">// è°ƒç”¨</span><br><span class="hljs-type">TreeNode</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>(<span class="hljs-number">1</span>);<br>root.left = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>(<span class="hljs-number">2</span>);<br>root.right = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>(<span class="hljs-number">3</span>);<br><br>preorder(root);  <span class="hljs-comment">// è¾“å‡ºï¼š1 2 3</span><br></code></pre></td></tr></table></figure><h4 id="æ‰§è¡Œè¿‡ç¨‹-2"><a href="#æ‰§è¡Œè¿‡ç¨‹-2" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">preorder(node1)  <span class="hljs-comment">// node1.val = 1</span><br>  â†“ node1 != <span class="hljs-literal">null</span><br>  â†“ æ‰“å° <span class="hljs-number">1</span><br>  â†“ è°ƒç”¨ preorder(node2)  <span class="hljs-comment">// å¤„ç†å·¦å­æ ‘</span><br>    â†“ preorder(node2)  <span class="hljs-comment">// node2.val = 2</span><br>    â†“ node2 != <span class="hljs-literal">null</span><br>    â†“ æ‰“å° <span class="hljs-number">2</span><br>    â†“ è°ƒç”¨ preorder(<span class="hljs-literal">null</span>)  <span class="hljs-comment">// å·¦å­æ ‘ä¸º null</span><br>      â†“ <span class="hljs-keyword">return</span><br>    â†“ è°ƒç”¨ preorder(<span class="hljs-literal">null</span>)  <span class="hljs-comment">// å³å­æ ‘ä¸º null</span><br>      â†“ <span class="hljs-keyword">return</span><br>    â†“ <span class="hljs-keyword">return</span><br>  â†“ è°ƒç”¨ preorder(node3)  <span class="hljs-comment">// å¤„ç†å³å­æ ‘</span><br>    â†“ preorder(node3)  <span class="hljs-comment">// node3.val = 3</span><br>    â†“ node3 != <span class="hljs-literal">null</span><br>    â†“ æ‰“å° <span class="hljs-number">3</span><br>    â†“ è°ƒç”¨ preorder(<span class="hljs-literal">null</span>)  <span class="hljs-comment">// å·¦å­æ ‘ä¸º null</span><br>      â†“ <span class="hljs-keyword">return</span><br>    â†“ è°ƒç”¨ preorder(<span class="hljs-literal">null</span>)  <span class="hljs-comment">// å³å­æ ‘ä¸º null</span><br>      â†“ <span class="hljs-keyword">return</span><br>    â†“ <span class="hljs-keyword">return</span><br>  â†“ <span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li>é€’å½’å¤„ç†ä¸‰ä¸ªéƒ¨åˆ†ï¼šæ ¹ã€å·¦å­æ ‘ã€å³å­æ ‘</li><li>æ¯ä¸ªé€’å½’è°ƒç”¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¤„ç†ä¸€ä¸ªå­æ ‘</li><li>é€šè¿‡ <code>node == null</code> åˆ¤æ–­æ˜¯å¦ç»§ç»­é€’å½’</li></ul><hr><h2 id="å››ã€é€’å½’çš„ä¸‰ä¸ªå…³é”®æ¦‚å¿µ"><a href="#å››ã€é€’å½’çš„ä¸‰ä¸ªå…³é”®æ¦‚å¿µ" class="headerlink" title="å››ã€é€’å½’çš„ä¸‰ä¸ªå…³é”®æ¦‚å¿µ"></a>å››ã€é€’å½’çš„ä¸‰ä¸ªå…³é”®æ¦‚å¿µ</h2><h3 id="4-1-é€’å½’çš„â€ä¿¡ä»»â€"><a href="#4-1-é€’å½’çš„â€ä¿¡ä»»â€" class="headerlink" title="4.1 é€’å½’çš„â€ä¿¡ä»»â€"></a>4.1 é€’å½’çš„â€ä¿¡ä»»â€</h3><p><strong>å…³é”®æ€æƒ³</strong>ï¼šä¸è¦è¯•å›¾è¿½è¸ªæ•´ä¸ªé€’å½’è¿‡ç¨‹ï¼Œè€Œæ˜¯<strong>ç›¸ä¿¡é€’å½’å‡½æ•°èƒ½æ­£ç¡®å¤„ç†æ›´å°çš„é—®é¢˜</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// âŒ é”™è¯¯çš„æ€ç»´æ–¹å¼</span><br><span class="hljs-comment">// è¯•å›¾è¿½è¸ªæ•´ä¸ªé€’å½’è¿‡ç¨‹</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">preorder</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    System.out.println(node.val);<br>    preorder(node.left);   <span class="hljs-comment">// æˆ‘éœ€è¦çŸ¥é“è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ...</span><br>    preorder(node.right);  <span class="hljs-comment">// è¿˜æœ‰è¿™é‡Œ...</span><br>&#125;<br><br><span class="hljs-comment">// âœ… æ­£ç¡®çš„æ€ç»´æ–¹å¼</span><br><span class="hljs-comment">// ç›¸ä¿¡é€’å½’å‡½æ•°èƒ½æ­£ç¡®å¤„ç†å­æ ‘</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">preorder</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    <span class="hljs-comment">// 1. å¤„ç†å½“å‰èŠ‚ç‚¹</span><br>    System.out.println(node.val);<br>    <br>    <span class="hljs-comment">// 2. ç›¸ä¿¡ preorder èƒ½æ­£ç¡®å¤„ç†å·¦å­æ ‘</span><br>    preorder(node.left);<br>    <br>    <span class="hljs-comment">// 3. ç›¸ä¿¡ preorder èƒ½æ­£ç¡®å¤„ç†å³å­æ ‘</span><br>    preorder(node.right);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å…³é”®</strong>ï¼š</p><ul><li>ä¸è¦è¯•å›¾åœ¨è„‘å­é‡Œæ¨¡æ‹Ÿæ•´ä¸ªé€’å½’è¿‡ç¨‹</li><li>åªéœ€è¦ç¡®ä¿ï¼šç»ˆæ­¢æ¡ä»¶æ­£ç¡® + é€’å½’å…³ç³»æ­£ç¡®</li><li>ç›¸ä¿¡é€’å½’å‡½æ•°èƒ½å¤„ç†æ›´å°çš„é—®é¢˜</li></ul><h3 id="4-2-é€’å½’çš„â€åˆ†æ²»â€"><a href="#4-2-é€’å½’çš„â€åˆ†æ²»â€" class="headerlink" title="4.2 é€’å½’çš„â€åˆ†æ²»â€"></a>4.2 é€’å½’çš„â€åˆ†æ²»â€</h3><p><strong>åˆ†æ²»æ€æƒ³</strong>ï¼šå°†å¤§é—®é¢˜åˆ†è§£ä¸ºç›¸åŒçš„å°é—®é¢˜ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs">å¤§é—®é¢˜ï¼šéå†æ•´ä¸ªæ ‘<br>  â†“ åˆ†è§£<br>å°é—®é¢˜1ï¼šå¤„ç†æ ¹èŠ‚ç‚¹<br>å°é—®é¢˜2ï¼šéå†å·¦å­æ ‘ï¼ˆä¸å¤§é—®é¢˜ç›¸åŒï¼Œä½†è§„æ¨¡æ›´å°ï¼‰<br>å°é—®é¢˜3ï¼šéå†å³å­æ ‘ï¼ˆä¸å¤§é—®é¢˜ç›¸åŒï¼Œä½†è§„æ¨¡æ›´å°ï¼‰<br>  â†“ é€’å½’å¤„ç†å°é—®é¢˜<br>  â†“ åˆå¹¶ç»“æœ<br>å®Œæˆ<br></code></pre></td></tr></table></figure><p><strong>å…³é”®</strong>ï¼š</p><ul><li>æ¯æ¬¡é€’å½’éƒ½åœ¨å¤„ç†ä¸€ä¸ªæ›´å°çš„é—®é¢˜</li><li>é—®é¢˜çš„ç»“æ„ç›¸åŒï¼Œåªæ˜¯è§„æ¨¡ä¸åŒ</li><li>æœ€ç»ˆä¼šåˆ°è¾¾åŸºç¡€æƒ…å†µï¼ˆç»ˆæ­¢æ¡ä»¶ï¼‰</li></ul><h3 id="4-3-é€’å½’çš„â€å›æº¯â€"><a href="#4-3-é€’å½’çš„â€å›æº¯â€" class="headerlink" title="4.3 é€’å½’çš„â€å›æº¯â€"></a>4.3 é€’å½’çš„â€å›æº¯â€</h3><p><strong>å›æº¯æ€æƒ³</strong>ï¼šé€’å½’ä¼šè‡ªåŠ¨å›æº¯ï¼Œé€å±‚è¿”å›ç»“æœã€‚</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tap">é€’å½’ä¸‹é™ï¼š<br>level<span class="hljs-number"> 1 </span>â†’ level<span class="hljs-number"> 2 </span>â†’ level<span class="hljs-number"> 3 </span>â†’ ... â†’ åŸºç¡€æƒ…å†µ<br>                                      â†“<br>å›æº¯ä¸Šå‡ï¼š<br>level<span class="hljs-number"> 1 </span>â† level<span class="hljs-number"> 2 </span>â† level<span class="hljs-number"> 3 </span>â† ... â† è¿”å›ç»“æœ<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ååºéå†ï¼ˆå›æº¯çš„å…¸å‹åº”ç”¨ï¼‰</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">postorder</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    postorder(node.left);   <span class="hljs-comment">// å…ˆå¤„ç†å·¦å­æ ‘</span><br>    postorder(node.right);  <span class="hljs-comment">// å†å¤„ç†å³å­æ ‘</span><br>    System.out.println(node.val);  <span class="hljs-comment">// æœ€åå¤„ç†æ ¹èŠ‚ç‚¹ï¼ˆå›æº¯æ—¶ï¼‰</span><br>&#125;<br><br><span class="hljs-comment">// æ‰§è¡Œè¿‡ç¨‹ï¼š</span><br><span class="hljs-comment">// 1. é€’å½’ä¸‹é™åˆ°å¶å­èŠ‚ç‚¹</span><br><span class="hljs-comment">// 2. å›æº¯æ—¶å¤„ç†èŠ‚ç‚¹ï¼ˆååºï¼‰</span><br></code></pre></td></tr></table></figure><hr><h2 id="äº”ã€é€’å½’-vs-è¿­ä»£"><a href="#äº”ã€é€’å½’-vs-è¿­ä»£" class="headerlink" title="äº”ã€é€’å½’ vs è¿­ä»£"></a>äº”ã€é€’å½’ vs è¿­ä»£</h2><h3 id="5-1-å¯¹æ¯”è¡¨"><a href="#5-1-å¯¹æ¯”è¡¨" class="headerlink" title="5.1 å¯¹æ¯”è¡¨"></a>5.1 å¯¹æ¯”è¡¨</h3><table><thead><tr><th>ç»´åº¦</th><th>é€’å½’</th><th>è¿­ä»£</th></tr></thead><tbody><tr><td><strong>ä»£ç ç®€æ´æ€§</strong></td><td>ç®€æ´ã€æ˜“è¯»</td><td>å¤æ‚ã€éœ€è¦æ‰‹åŠ¨ç®¡ç†çŠ¶æ€</td></tr><tr><td><strong>ç©ºé—´å¤æ‚åº¦</strong></td><td>O(h)ï¼ˆé€’å½’æ ˆï¼‰</td><td>O(1)ï¼ˆé€šå¸¸ï¼‰</td></tr><tr><td><strong>æ—¶é—´å¤æ‚åº¦</strong></td><td>ç›¸åŒ</td><td>ç›¸åŒ</td></tr><tr><td><strong>æ ˆæº¢å‡ºé£é™©</strong></td><td>é«˜ï¼ˆæ·±åº¦å¤§æ—¶ï¼‰</td><td>æ— </td></tr><tr><td><strong>ç†è§£éš¾åº¦</strong></td><td>éœ€è¦ç†è§£é€’å½’æ€æƒ³</td><td>ç›¸å¯¹ç›´è§‚</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>ç•¥ä½ï¼ˆå‡½æ•°è°ƒç”¨å¼€é”€ï¼‰</td><td>ç•¥é«˜</td></tr></tbody></table><h3 id="5-2-é€’å½’-vs-è¿­ä»£ï¼šé“¾è¡¨éå†"><a href="#5-2-é€’å½’-vs-è¿­ä»£ï¼šé“¾è¡¨éå†" class="headerlink" title="5.2 é€’å½’ vs è¿­ä»£ï¼šé“¾è¡¨éå†"></a>5.2 é€’å½’ vs è¿­ä»£ï¼šé“¾è¡¨éå†</h3><h4 id="é€’å½’æ–¹å¼"><a href="#é€’å½’æ–¹å¼" class="headerlink" title="é€’å½’æ–¹å¼"></a>é€’å½’æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">traverse</span><span class="hljs-params">(ListNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    System.out.println(node.val);<br>    traverse(node.next);<br>&#125;<br><br><span class="hljs-comment">// ä¼˜ç‚¹ï¼šç®€æ´ã€æ˜“è¯»</span><br><span class="hljs-comment">// ç¼ºç‚¹ï¼šå ç”¨æ ˆç©ºé—´ï¼Œé“¾è¡¨å¾ˆé•¿æ—¶å¯èƒ½æ ˆæº¢å‡º</span><br></code></pre></td></tr></table></figure><h4 id="è¿­ä»£æ–¹å¼"><a href="#è¿­ä»£æ–¹å¼" class="headerlink" title="è¿­ä»£æ–¹å¼"></a>è¿­ä»£æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">traverse</span><span class="hljs-params">(ListNode node)</span> &#123;<br>    <span class="hljs-type">ListNode</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> node;<br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span>) &#123;<br>        System.out.println(current.val);<br>        current = current.next;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ä¼˜ç‚¹ï¼šä¸å ç”¨é¢å¤–æ ˆç©ºé—´ï¼Œæ•ˆç‡é«˜</span><br><span class="hljs-comment">// ç¼ºç‚¹ï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç†æŒ‡é’ˆ</span><br></code></pre></td></tr></table></figure><h3 id="5-3-é€’å½’-vs-è¿­ä»£ï¼šæ ‘éå†"><a href="#5-3-é€’å½’-vs-è¿­ä»£ï¼šæ ‘éå†" class="headerlink" title="5.3 é€’å½’ vs è¿­ä»£ï¼šæ ‘éå†"></a>5.3 é€’å½’ vs è¿­ä»£ï¼šæ ‘éå†</h3><h4 id="é€’å½’æ–¹å¼ï¼ˆå‰åºï¼‰"><a href="#é€’å½’æ–¹å¼ï¼ˆå‰åºï¼‰" class="headerlink" title="é€’å½’æ–¹å¼ï¼ˆå‰åºï¼‰"></a>é€’å½’æ–¹å¼ï¼ˆå‰åºï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">preorder</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    System.out.println(node.val);<br>    preorder(node.left);<br>    preorder(node.right);<br>&#125;<br><br><span class="hljs-comment">// ä»£ç ç®€æ´ï¼Œé€»è¾‘æ¸…æ™°</span><br></code></pre></td></tr></table></figure><h4 id="è¿­ä»£æ–¹å¼ï¼ˆå‰åºï¼‰"><a href="#è¿­ä»£æ–¹å¼ï¼ˆå‰åºï¼‰" class="headerlink" title="è¿­ä»£æ–¹å¼ï¼ˆå‰åºï¼‰"></a>è¿­ä»£æ–¹å¼ï¼ˆå‰åºï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">preorderIterative</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    Stack&lt;TreeNode&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    stack.push(root);<br>    <br>    <span class="hljs-keyword">while</span> (!stack.isEmpty()) &#123;<br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> stack.pop();<br>        System.out.println(node.val);<br>        <br>        <span class="hljs-keyword">if</span> (node.right != <span class="hljs-literal">null</span>) &#123;<br>            stack.push(node.right);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (node.left != <span class="hljs-literal">null</span>) &#123;<br>            stack.push(node.left);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// éœ€è¦æ‰‹åŠ¨ç®¡ç†æ ˆï¼Œé€»è¾‘å¤æ‚</span><br></code></pre></td></tr></table></figure><p><strong>å…³é”®è§‚å¯Ÿ</strong>ï¼š</p><ul><li>é€’å½’æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨ç³»ç»Ÿæ ˆ</li><li>è¿­ä»£æ˜¯æ‰‹åŠ¨ç®¡ç†æ ˆ</li><li>é€’å½’ç®€æ´ï¼Œè¿­ä»£é«˜æ•ˆ</li></ul><hr><h2 id="å…­ã€é€’å½’çš„å¸¸è§é™·é˜±"><a href="#å…­ã€é€’å½’çš„å¸¸è§é™·é˜±" class="headerlink" title="å…­ã€é€’å½’çš„å¸¸è§é™·é˜±"></a>å…­ã€é€’å½’çš„å¸¸è§é™·é˜±</h2><h3 id="6-1-é™·é˜±1ï¼šæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶"><a href="#6-1-é™·é˜±1ï¼šæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶" class="headerlink" title="6.1 é™·é˜±1ï¼šæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶"></a>6.1 é™·é˜±1ï¼šæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šæ— é™é€’å½’</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">recursion</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    System.out.println(n);<br>    recursion(n + <span class="hljs-number">1</span>);  <span class="hljs-comment">// æ°¸è¿œä¸ä¼šåœæ­¢</span><br>&#125;<br><br><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šæœ‰ç»ˆæ­¢æ¡ä»¶</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">recursion</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">10</span>) <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// ç»ˆæ­¢æ¡ä»¶</span><br>    System.out.println(n);<br>    recursion(n + <span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-2-é™·é˜±2ï¼šç»ˆæ­¢æ¡ä»¶æ°¸è¿œä¸ä¼šåˆ°è¾¾"><a href="#6-2-é™·é˜±2ï¼šç»ˆæ­¢æ¡ä»¶æ°¸è¿œä¸ä¼šåˆ°è¾¾" class="headerlink" title="6.2 é™·é˜±2ï¼šç»ˆæ­¢æ¡ä»¶æ°¸è¿œä¸ä¼šåˆ°è¾¾"></a>6.2 é™·é˜±2ï¼šç»ˆæ­¢æ¡ä»¶æ°¸è¿œä¸ä¼šåˆ°è¾¾</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šç»ˆæ­¢æ¡ä»¶é”™è¯¯</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">recursion</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<br>    System.out.println(n);<br>    recursion(n - <span class="hljs-number">2</span>);  <span class="hljs-comment">// å¦‚æœ n æ˜¯å¥‡æ•°ï¼Œæ°¸è¿œä¸ä¼šç­‰äº 0</span><br>&#125;<br><br><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šç»ˆæ­¢æ¡ä»¶æ­£ç¡®</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">recursion</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-keyword">if</span> (n &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// åŒ…å«æ‰€æœ‰åœæ­¢æƒ…å†µ</span><br>    System.out.println(n);<br>    recursion(n - <span class="hljs-number">2</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-3-é™·é˜±3ï¼šé—®é¢˜æ²¡æœ‰çœŸæ­£åˆ†è§£"><a href="#6-3-é™·é˜±3ï¼šé—®é¢˜æ²¡æœ‰çœŸæ­£åˆ†è§£" class="headerlink" title="6.3 é™·é˜±3ï¼šé—®é¢˜æ²¡æœ‰çœŸæ­£åˆ†è§£"></a>6.3 é™·é˜±3ï¼šé—®é¢˜æ²¡æœ‰çœŸæ­£åˆ†è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šé—®é¢˜æ²¡æœ‰å˜å°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">recursion</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<br>    System.out.println(n);<br>    recursion(n);  <span class="hljs-comment">// é—®é¢˜å¤§å°æ²¡å˜ï¼Œæ— é™é€’å½’</span><br>&#125;<br><br><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šé—®é¢˜é€æ­¥å˜å°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">recursion</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<br>    System.out.println(n);<br>    recursion(n - <span class="hljs-number">1</span>);  <span class="hljs-comment">// é—®é¢˜é€æ­¥å˜å°</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-4-é™·é˜±4ï¼šæ ˆæº¢å‡º"><a href="#6-4-é™·é˜±4ï¼šæ ˆæº¢å‡º" class="headerlink" title="6.4 é™·é˜±4ï¼šæ ˆæº¢å‡º"></a>6.4 é™·é˜±4ï¼šæ ˆæº¢å‡º</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// âŒ å±é™©ï¼šé€’å½’æ·±åº¦å¤ªå¤§</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">recursion</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<br>    recursion(n - <span class="hljs-number">1</span>);<br>&#125;<br><br>recursion(<span class="hljs-number">100000</span>);  <span class="hljs-comment">// æ ˆæº¢å‡ºï¼</span><br><br><span class="hljs-comment">// âœ… è§£å†³ï¼šä½¿ç”¨è¿­ä»£æˆ–å¢åŠ æ ˆå¤§å°</span><br><span class="hljs-comment">// æ–¹å¼1ï¼šä½¿ç”¨è¿­ä»£</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">100000</span>; i &gt; <span class="hljs-number">0</span>; i--) &#123;<br>    <span class="hljs-comment">// å¤„ç†</span><br>&#125;<br><br><span class="hljs-comment">// æ–¹å¼2ï¼šå¢åŠ æ ˆå¤§å°ï¼ˆJVM å‚æ•°ï¼‰</span><br><span class="hljs-comment">// java -Xss10m MyProgram</span><br></code></pre></td></tr></table></figure><hr><h2 id="ä¸ƒã€é€’å½’çš„åº”ç”¨åœºæ™¯"><a href="#ä¸ƒã€é€’å½’çš„åº”ç”¨åœºæ™¯" class="headerlink" title="ä¸ƒã€é€’å½’çš„åº”ç”¨åœºæ™¯"></a>ä¸ƒã€é€’å½’çš„åº”ç”¨åœºæ™¯</h2><h3 id="7-1-é€‚åˆç”¨é€’å½’çš„åœºæ™¯"><a href="#7-1-é€‚åˆç”¨é€’å½’çš„åœºæ™¯" class="headerlink" title="7.1 é€‚åˆç”¨é€’å½’çš„åœºæ™¯"></a>7.1 é€‚åˆç”¨é€’å½’çš„åœºæ™¯</h3><table><thead><tr><th>åœºæ™¯</th><th>åŸå› </th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><strong>æ ‘&#x2F;å›¾éå†</strong></td><td>å¤©ç„¶çš„é€’å½’ç»“æ„</td><td>å‰åºã€ä¸­åºã€ååºéå†</td></tr><tr><td><strong>åˆ†æ²»ç®—æ³•</strong></td><td>é—®é¢˜å¯åˆ†è§£</td><td>å¿«é€Ÿæ’åºã€å½’å¹¶æ’åº</td></tr><tr><td><strong>å›æº¯ç®—æ³•</strong></td><td>éœ€è¦å°è¯•æ‰€æœ‰å¯èƒ½</td><td>N çš‡åã€ç»„åˆé—®é¢˜</td></tr><tr><td><strong>åŠ¨æ€è§„åˆ’</strong></td><td>æœ‰é‡å å­é—®é¢˜</td><td>æ–æ³¢é‚£å¥‘æ•°åˆ—</td></tr></tbody></table><h3 id="7-2-ä¸é€‚åˆç”¨é€’å½’çš„åœºæ™¯"><a href="#7-2-ä¸é€‚åˆç”¨é€’å½’çš„åœºæ™¯" class="headerlink" title="7.2 ä¸é€‚åˆç”¨é€’å½’çš„åœºæ™¯"></a>7.2 ä¸é€‚åˆç”¨é€’å½’çš„åœºæ™¯</h3><table><thead><tr><th>åœºæ™¯</th><th>åŸå› </th><th>æ›¿ä»£æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td><strong>çº¿æ€§éå†</strong></td><td>è¿­ä»£æ›´é«˜æ•ˆ</td><td>ä½¿ç”¨ while å¾ªç¯</td></tr><tr><td><strong>æ·±åº¦å¾ˆå¤§</strong></td><td>å®¹æ˜“æ ˆæº¢å‡º</td><td>ä½¿ç”¨è¿­ä»£æˆ–å¢åŠ æ ˆå¤§å°</td></tr><tr><td><strong>æ€§èƒ½å…³é”®</strong></td><td>å‡½æ•°è°ƒç”¨å¼€é”€å¤§</td><td>ä½¿ç”¨è¿­ä»£</td></tr></tbody></table><hr><h2 id="å…«ã€é€’å½’çš„è°ƒè¯•æŠ€å·§"><a href="#å…«ã€é€’å½’çš„è°ƒè¯•æŠ€å·§" class="headerlink" title="å…«ã€é€’å½’çš„è°ƒè¯•æŠ€å·§"></a>å…«ã€é€’å½’çš„è°ƒè¯•æŠ€å·§</h2><h3 id="8-1-æ‰“å°é€’å½’æ ˆ"><a href="#8-1-æ‰“å°é€’å½’æ ˆ" class="headerlink" title="8.1 æ‰“å°é€’å½’æ ˆ"></a>8.1 æ‰“å°é€’å½’æ ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">preorder</span><span class="hljs-params">(TreeNode node, <span class="hljs-type">int</span> depth)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    <span class="hljs-comment">// æ‰“å°ç¼©è¿›è¡¨ç¤ºæ·±åº¦</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">indent</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;  &quot;</span>.repeat(depth);<br>    System.out.println(indent + <span class="hljs-string">&quot;è¿›å…¥: &quot;</span> + node.val);<br>    <br>    preorder(node.left, depth + <span class="hljs-number">1</span>);<br>    preorder(node.right, depth + <span class="hljs-number">1</span>);<br>    <br>    System.out.println(indent + <span class="hljs-string">&quot;è¿”å›: &quot;</span> + node.val);<br>&#125;<br><br><span class="hljs-comment">// è¾“å‡ºï¼š</span><br><span class="hljs-comment">// è¿›å…¥: 1</span><br><span class="hljs-comment">//   è¿›å…¥: 2</span><br><span class="hljs-comment">//   è¿”å›: 2</span><br><span class="hljs-comment">//   è¿›å…¥: 3</span><br><span class="hljs-comment">//   è¿”å›: 3</span><br><span class="hljs-comment">// è¿”å›: 1</span><br></code></pre></td></tr></table></figure><h3 id="8-2-éªŒè¯ç»ˆæ­¢æ¡ä»¶"><a href="#8-2-éªŒè¯ç»ˆæ­¢æ¡ä»¶" class="headerlink" title="8.2 éªŒè¯ç»ˆæ­¢æ¡ä»¶"></a>8.2 éªŒè¯ç»ˆæ­¢æ¡ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">recursion</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    <span class="hljs-comment">// æ·»åŠ æ—¥å¿—éªŒè¯ç»ˆæ­¢æ¡ä»¶</span><br>    System.out.println(<span class="hljs-string">&quot;é€’å½’è°ƒç”¨: n = &quot;</span> + n);<br>    <br>    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">0</span>) &#123;<br>        System.out.println(<span class="hljs-string">&quot;åˆ°è¾¾ç»ˆæ­¢æ¡ä»¶&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    recursion(n - <span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="8-3-æ£€æŸ¥é—®é¢˜åˆ†è§£"><a href="#8-3-æ£€æŸ¥é—®é¢˜åˆ†è§£" class="headerlink" title="8.3 æ£€æŸ¥é—®é¢˜åˆ†è§£"></a>8.3 æ£€æŸ¥é—®é¢˜åˆ†è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">recursion</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;å¤„ç†é—®é¢˜å¤§å°: &quot;</span> + n);<br>    <br>    <span class="hljs-keyword">if</span> (n &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;<br>    <br>    <span class="hljs-comment">// éªŒè¯é—®é¢˜ç¡®å®åœ¨å˜å°</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">nextSize</span> <span class="hljs-operator">=</span> n - <span class="hljs-number">1</span>;<br>    System.out.println(<span class="hljs-string">&quot;ä¸‹ä¸€ä¸ªé—®é¢˜å¤§å°: &quot;</span> + nextSize);<br>    <br>    recursion(nextSize);<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="ä¹ã€é€’å½’æ€ç»´çš„åŸ¹å…»"><a href="#ä¹ã€é€’å½’æ€ç»´çš„åŸ¹å…»" class="headerlink" title="ä¹ã€é€’å½’æ€ç»´çš„åŸ¹å…»"></a>ä¹ã€é€’å½’æ€ç»´çš„åŸ¹å…»</h2><h3 id="9-1-ä¸‰æ­¥æ³•"><a href="#9-1-ä¸‰æ­¥æ³•" class="headerlink" title="9.1 ä¸‰æ­¥æ³•"></a>9.1 ä¸‰æ­¥æ³•</h3><p><strong>ç¬¬1æ­¥</strong>ï¼šæ˜ç¡®é€’å½’çš„ä¸‰ä¸ªè¦ç´ </p><ul><li>ç»ˆæ­¢æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>é€’å½’å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>å¦‚ä½•åˆ†è§£é—®é¢˜ï¼Ÿ</li></ul><p><strong>ç¬¬2æ­¥</strong>ï¼šç›¸ä¿¡é€’å½’</p><ul><li>ä¸è¦è¯•å›¾è¿½è¸ªæ•´ä¸ªè¿‡ç¨‹</li><li>åªéœ€ç¡®ä¿é€»è¾‘æ­£ç¡®</li><li>ç›¸ä¿¡é€’å½’èƒ½å¤„ç†æ›´å°çš„é—®é¢˜</li></ul><p><strong>ç¬¬3æ­¥</strong>ï¼šéªŒè¯</p><ul><li>æµ‹è¯•åŸºç¡€æƒ…å†µ</li><li>æµ‹è¯•ç®€å•æƒ…å†µï¼ˆn&#x3D;1, 2, 3ï¼‰</li><li>æµ‹è¯•å¤æ‚æƒ…å†µ</li></ul><h3 id="9-2-ç»ƒä¹ å»ºè®®"><a href="#9-2-ç»ƒä¹ å»ºè®®" class="headerlink" title="9.2 ç»ƒä¹ å»ºè®®"></a>9.2 ç»ƒä¹ å»ºè®®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä»ç®€å•åˆ°å¤æ‚</span><br><span class="hljs-number">1.</span> é˜¶ä¹˜ï¼šfactorial(n)<br><span class="hljs-number">2.</span> æ–æ³¢é‚£å¥‘ï¼šfib(n)<br><span class="hljs-number">3.</span> é“¾è¡¨éå†ï¼štraverse(node)<br><span class="hljs-number">4.</span> æ ‘éå†ï¼špreorder(node)<br><span class="hljs-number">5.</span> äºŒåˆ†æŸ¥æ‰¾ï¼šbinarySearch(arr, target)<br><span class="hljs-number">6.</span> å¿«é€Ÿæ’åºï¼šquickSort(arr)<br><span class="hljs-number">7.</span> å›æº¯ï¼špermutation(arr)<br></code></pre></td></tr></table></figure><hr><h2 id="ç›¸å…³ç¬”è®°"><a href="#ç›¸å…³ç¬”è®°" class="headerlink" title="ç›¸å…³ç¬”è®°"></a>ç›¸å…³ç¬”è®°</h2><ul><li>å±æ€§æ•°æ®ç»“æ„éå†è¯¦è§£</li><li>é“¾è¡¨æ“ä½œè¯¦è§£</li><li>æ ‘çš„æ“ä½œè¯¦è§£</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®ç»“æ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é€’å½’</tag>
      
      <tag>ç®—æ³•</tag>
      
      <tag>ç¼–ç¨‹æ€æƒ³</tag>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å±æ€§æ•°æ®ç»“æ„éå†è¯¦è§£</title>
    <link href="/2026/01/12/%E5%B1%9E%E6%80%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E9%81%8D%E5%8E%86%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/12/%E5%B1%9E%E6%80%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E9%81%8D%E5%8E%86%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="å±æ€§æ•°æ®ç»“æ„éå†è¯¦è§£"><a href="#å±æ€§æ•°æ®ç»“æ„éå†è¯¦è§£" class="headerlink" title="å±æ€§æ•°æ®ç»“æ„éå†è¯¦è§£"></a>å±æ€§æ•°æ®ç»“æ„éå†è¯¦è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>å±æ€§æ•°æ®ç»“æ„</strong> æ˜¯æŒ‡å…·æœ‰ç‰¹å®šå±æ€§æˆ–ç‰¹å¾çš„æ•°æ®ç»“æ„ï¼Œå¦‚æœ‰åºæ€§ã€å±‚çº§æ€§ã€è¿é€šæ€§ç­‰ã€‚éå†æ˜¯è®¿é—®æ•°æ®ç»“æ„ä¸­æ‰€æœ‰å…ƒç´ çš„åŸºæœ¬æ“ä½œï¼Œä¸åŒçš„æ•°æ®ç»“æ„æœ‰ä¸åŒçš„éå†ç­–ç•¥ã€‚</p><blockquote><p><strong>ğŸ’¡ æç¤º: æ ¸å¿ƒæ€æƒ³</strong><br>éå†çš„æœ¬è´¨æ˜¯ï¼š<strong>æŒ‰ç…§æ•°æ®ç»“æ„çš„ç‰¹æ€§ï¼Œç”¨åˆé€‚çš„æ–¹å¼è®¿é—®æ¯ä¸ªå…ƒç´ ä¸€æ¬¡ï¼Œä¸”ä»…ä¸€æ¬¡</strong>ã€‚</p></blockquote><hr><h2 id="ä¸€ã€æ•°ç»„éå†"><a href="#ä¸€ã€æ•°ç»„éå†" class="headerlink" title="ä¸€ã€æ•°ç»„éå†"></a>ä¸€ã€æ•°ç»„éå†</h2><h3 id="1-1-åŸºæœ¬ç‰¹æ€§"><a href="#1-1-åŸºæœ¬ç‰¹æ€§" class="headerlink" title="1.1 åŸºæœ¬ç‰¹æ€§"></a>1.1 åŸºæœ¬ç‰¹æ€§</h3><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å­˜å‚¨æ–¹å¼</strong></td><td>è¿ç»­å†…å­˜ï¼Œéšæœºè®¿é—®</td></tr><tr><td><strong>è®¿é—®å¤æ‚åº¦</strong></td><td>O(1)</td></tr><tr><td><strong>éå†å¤æ‚åº¦</strong></td><td>O(n)</td></tr><tr><td><strong>å±æ€§</strong></td><td>æœ‰åºã€å›ºå®šå¤§å°ã€å¯é‡å¤</td></tr></tbody></table><h3 id="1-2-éå†æ€è·¯"><a href="#1-2-éå†æ€è·¯" class="headerlink" title="1.2 éå†æ€è·¯"></a>1.2 éå†æ€è·¯</h3><p>æ•°ç»„éå†çš„æ ¸å¿ƒæ€è·¯æ˜¯<strong>çº¿æ€§æ‰«æ</strong>ï¼šä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œä¾æ¬¡è®¿é—®æ¯ä¸ªå…ƒç´ ï¼Œç›´åˆ°æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown">æ€è·¯æµç¨‹ï¼š<br><span class="hljs-bullet">1.</span> åˆå§‹åŒ–æŒ‡é’ˆ/ç´¢å¼• i = 0<br><span class="hljs-bullet">2.</span> æ£€æŸ¥ i &lt; æ•°ç»„é•¿åº¦<br><span class="hljs-bullet">3.</span> è®¿é—® array[i]<br><span class="hljs-bullet">4.</span> i++<br><span class="hljs-bullet">5.</span> å›åˆ°æ­¥éª¤2<br></code></pre></td></tr></table></figure><h3 id="1-3-å®ç°æ–¹å¼"><a href="#1-3-å®ç°æ–¹å¼" class="headerlink" title="1.3 å®ç°æ–¹å¼"></a>1.3 å®ç°æ–¹å¼</h3><h4 id="æ–¹å¼1ï¼šä¼ ç»Ÿ-for-å¾ªç¯ï¼ˆæœ€ç›´æ¥ï¼‰"><a href="#æ–¹å¼1ï¼šä¼ ç»Ÿ-for-å¾ªç¯ï¼ˆæœ€ç›´æ¥ï¼‰" class="headerlink" title="æ–¹å¼1ï¼šä¼ ç»Ÿ for å¾ªç¯ï¼ˆæœ€ç›´æ¥ï¼‰"></a>æ–¹å¼1ï¼šä¼ ç»Ÿ for å¾ªç¯ï¼ˆæœ€ç›´æ¥ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šéœ€è¦ç´¢å¼•å€¼ï¼Œéœ€è¦æå‰çŸ¥é“æ•°ç»„å¤§å°</span><br><span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br>    System.out.println(arr[i]);  <span class="hljs-comment">// è®¿é—®å…ƒç´ </span><br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>æ˜¾å¼æ§åˆ¶ç´¢å¼•ï¼Œå¯ä»¥éšæ„è®¿é—®ä»»ä½•ä½ç½®</li><li>é€‚åˆéœ€è¦ç´¢å¼•çš„åœºæ™¯ï¼ˆå¦‚ä¿®æ”¹å…ƒç´ ã€è®¡ç®—ä½ç½®ç­‰ï¼‰</li></ul><h4 id="æ–¹å¼2ï¼šå¢å¼º-for-å¾ªç¯ï¼ˆç®€æ´ï¼‰"><a href="#æ–¹å¼2ï¼šå¢å¼º-for-å¾ªç¯ï¼ˆç®€æ´ï¼‰" class="headerlink" title="æ–¹å¼2ï¼šå¢å¼º for å¾ªç¯ï¼ˆç®€æ´ï¼‰"></a>æ–¹å¼2ï¼šå¢å¼º for å¾ªç¯ï¼ˆç®€æ´ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šåªéœ€è¦å…ƒç´ å€¼ï¼Œä¸éœ€è¦ç´¢å¼•</span><br><span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) &#123;<br>    System.out.println(num);  <span class="hljs-comment">// è®¿é—®å…ƒç´ </span><br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>éšè—ç´¢å¼•ç»†èŠ‚ï¼Œä»£ç æ›´ç®€æ´</li><li>æœ¬è´¨ä¸Šè¿˜æ˜¯é¡ºåºè®¿é—®</li><li>ä¸èƒ½ä¿®æ”¹æ•°ç»„å…ƒç´ ï¼ˆå¯¹åŸºæœ¬ç±»å‹ï¼‰</li></ul><h4 id="æ–¹å¼3ï¼šè¿­ä»£å™¨éå†ï¼ˆé€šç”¨ï¼‰"><a href="#æ–¹å¼3ï¼šè¿­ä»£å™¨éå†ï¼ˆé€šç”¨ï¼‰" class="headerlink" title="æ–¹å¼3ï¼šè¿­ä»£å™¨éå†ï¼ˆé€šç”¨ï¼‰"></a>æ–¹å¼3ï¼šè¿­ä»£å™¨éå†ï¼ˆé€šç”¨ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šéœ€è¦åœ¨éå†ä¸­åˆ é™¤å…ƒç´ </span><br>List&lt;Integer&gt; list = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);<br><br>Iterator&lt;Integer&gt; iterator = list.iterator();<br><span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> iterator.next();<br>    <span class="hljs-keyword">if</span> (num == <span class="hljs-number">3</span>) &#123;<br>        iterator.remove();  <span class="hljs-comment">// å®‰å…¨åˆ é™¤</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>è¿­ä»£å™¨ç»´æŠ¤éå†çŠ¶æ€</li><li>æ”¯æŒåœ¨éå†ä¸­å®‰å…¨åˆ é™¤</li><li>é€‚åˆé›†åˆæ¡†æ¶</li></ul><h4 id="æ–¹å¼4ï¼šæµå¼éå†ï¼ˆå‡½æ•°å¼ï¼‰"><a href="#æ–¹å¼4ï¼šæµå¼éå†ï¼ˆå‡½æ•°å¼ï¼‰" class="headerlink" title="æ–¹å¼4ï¼šæµå¼éå†ï¼ˆå‡½æ•°å¼ï¼‰"></a>æ–¹å¼4ï¼šæµå¼éå†ï¼ˆå‡½æ•°å¼ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šéœ€è¦å‡½æ•°å¼ç¼–ç¨‹é£æ ¼</span><br><span class="hljs-type">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><br>Arrays.stream(arr)<br>    .forEach(System.out::println);<br><br><span class="hljs-comment">// æˆ–è€…å¸¦ç´¢å¼•</span><br>IntStream.range(<span class="hljs-number">0</span>, arr.length)<br>    .forEach(i -&gt; System.out.println(arr[i]));<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>å£°æ˜å¼ç¼–ç¨‹ï¼Œè¡¨è¾¾æ„å›¾æ¸…æ™°</li><li>æ”¯æŒé“¾å¼æ“ä½œå’Œå‡½æ•°ç»„åˆ</li><li>å¯èƒ½æœ‰é¢å¤–å¼€é”€</li></ul><h3 id="1-4-äºŒç»´æ•°ç»„éå†"><a href="#1-4-äºŒç»´æ•°ç»„éå†" class="headerlink" title="1.4 äºŒç»´æ•°ç»„éå†"></a>1.4 äºŒç»´æ•°ç»„éå†</h3><h4 id="æŒ‰è¡Œéå†ï¼ˆæœ€å¸¸ç”¨ï¼‰"><a href="#æŒ‰è¡Œéå†ï¼ˆæœ€å¸¸ç”¨ï¼‰" class="headerlink" title="æŒ‰è¡Œéå†ï¼ˆæœ€å¸¸ç”¨ï¼‰"></a>æŒ‰è¡Œéå†ï¼ˆæœ€å¸¸ç”¨ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[][] matrix = &#123;<br>    &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;,<br>    &#123;<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;,<br>    &#123;<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>&#125;<br>&#125;;<br><br><span class="hljs-comment">// æ€è·¯ï¼šå¤–å±‚å¾ªç¯éå†è¡Œï¼Œå†…å±‚å¾ªç¯éå†åˆ—</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; matrix.length; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; matrix[i].length; j++) &#123;<br>        System.out.println(matrix[i][j]);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// è®¿é—®é¡ºåºï¼š1 2 3 4 5 6 7 8 9</span><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(m*n)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>å¤–å±‚æ§åˆ¶è¡Œï¼Œå†…å±‚æ§åˆ¶åˆ—</li><li>æŒ‰è¡Œä¼˜å…ˆé¡ºåºè®¿é—®ï¼ˆcache å‹å¥½ï¼‰</li><li>é€‚åˆå¤§å¤šæ•°çŸ©é˜µæ“ä½œ</li></ul><h4 id="æŒ‰åˆ—éå†"><a href="#æŒ‰åˆ—éå†" class="headerlink" title="æŒ‰åˆ—éå†"></a>æŒ‰åˆ—éå†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ€è·¯ï¼šå¤–å±‚å¾ªç¯éå†åˆ—ï¼Œå†…å±‚å¾ªç¯éå†è¡Œ</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; matrix[<span class="hljs-number">0</span>].length; j++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; matrix.length; i++) &#123;<br>        System.out.println(matrix[i][j]);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// è®¿é—®é¡ºåºï¼š1 4 7 2 5 8 3 6 9</span><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(m*n)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>é€‚åˆéœ€è¦æŒ‰åˆ—å¤„ç†çš„åœºæ™¯</li><li>å¯èƒ½å¯¼è‡´ cache missï¼ˆä¸å¦‚æŒ‰è¡Œéå†é«˜æ•ˆï¼‰</li></ul><h4 id="å¯¹è§’çº¿éå†"><a href="#å¯¹è§’çº¿éå†" class="headerlink" title="å¯¹è§’çº¿éå†"></a>å¯¹è§’çº¿éå†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ€è·¯ï¼šæŒ‰å¯¹è§’çº¿æ–¹å‘éå†</span><br><span class="hljs-comment">// ç¬¬ä¸€æ¡å¯¹è§’çº¿ï¼š(0,0)</span><br><span class="hljs-comment">// ç¬¬äºŒæ¡å¯¹è§’çº¿ï¼š(0,1), (1,0)</span><br><span class="hljs-comment">// ç¬¬ä¸‰æ¡å¯¹è§’çº¿ï¼š(0,2), (1,1), (2,0)</span><br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">diag</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; diag &lt; matrix.length + matrix[<span class="hljs-number">0</span>].length - <span class="hljs-number">1</span>; diag++) &#123;<br>    <span class="hljs-comment">// å¯¹äºç¬¬ diag æ¡å¯¹è§’çº¿</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">startRow</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>, diag - matrix[<span class="hljs-number">0</span>].length + <span class="hljs-number">1</span>);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">endRow</span> <span class="hljs-operator">=</span> Math.min(diag, matrix.length - <span class="hljs-number">1</span>);<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> startRow; i &lt;= endRow; i++) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> diag - i;<br>        System.out.println(matrix[i][j]);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// è®¿é—®é¡ºåºï¼š1 2 4 3 5 7 6 8 9</span><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(m*n)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>å¯¹è§’çº¿ç¼–å·ï¼ši + j &#x3D; diag</li><li>éœ€è¦è®¡ç®—æ¯æ¡å¯¹è§’çº¿çš„èµ·ç‚¹å’Œç»ˆç‚¹</li><li>é€‚åˆç‰¹å®šçš„çŸ©é˜µé—®é¢˜</li></ul><h3 id="1-5-éå†å˜ç§"><a href="#1-5-éå†å˜ç§" class="headerlink" title="1.5 éå†å˜ç§"></a>1.5 éå†å˜ç§</h3><h4 id="åå‘éå†"><a href="#åå‘éå†" class="headerlink" title="åå‘éå†"></a>åå‘éå†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä»åå¾€å‰éå†</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> arr.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>    System.out.println(arr[i]);<br>&#125;<br><br><span class="hljs-comment">// é€‚ç”¨åœºæ™¯ï¼š</span><br><span class="hljs-comment">// 1. éœ€è¦ä»åå¾€å‰å¤„ç†</span><br><span class="hljs-comment">// 2. åˆ é™¤å…ƒç´ æ—¶é¿å…ç´¢å¼•æ··ä¹±</span><br></code></pre></td></tr></table></figure><h4 id="è·³è·ƒéå†"><a href="#è·³è·ƒéå†" class="headerlink" title="è·³è·ƒéå†"></a>è·³è·ƒéå†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ¯éš” k ä¸ªå…ƒç´ è®¿é—®ä¸€ä¸ª</span><br><span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i += k) &#123;<br>    System.out.println(arr[i]);<br>&#125;<br><br><span class="hljs-comment">// é€‚ç”¨åœºæ™¯ï¼š</span><br><span class="hljs-comment">// 1. é‡‡æ ·</span><br><span class="hljs-comment">// 2. æ­¥é•¿éå†</span><br></code></pre></td></tr></table></figure><h4 id="æ¡ä»¶éå†"><a href="#æ¡ä»¶éå†" class="headerlink" title="æ¡ä»¶éå†"></a>æ¡ä»¶éå†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åªéå†æ»¡è¶³æ¡ä»¶çš„å…ƒç´ </span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br>    <span class="hljs-keyword">if</span> (arr[i] &gt; <span class="hljs-number">5</span>) &#123;<br>        System.out.println(arr[i]);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æˆ–ä½¿ç”¨æµ</span><br>Arrays.stream(arr)<br>    .filter(x -&gt; x &gt; <span class="hljs-number">5</span>)<br>    .forEach(System.out::println);<br></code></pre></td></tr></table></figure><hr><h2 id="äºŒã€é“¾è¡¨éå†"><a href="#äºŒã€é“¾è¡¨éå†" class="headerlink" title="äºŒã€é“¾è¡¨éå†"></a>äºŒã€é“¾è¡¨éå†</h2><h3 id="2-1-åŸºæœ¬ç‰¹æ€§"><a href="#2-1-åŸºæœ¬ç‰¹æ€§" class="headerlink" title="2.1 åŸºæœ¬ç‰¹æ€§"></a>2.1 åŸºæœ¬ç‰¹æ€§</h3><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å­˜å‚¨æ–¹å¼</strong></td><td>ç¦»æ•£å†…å­˜ï¼Œé€šè¿‡æŒ‡é’ˆè¿æ¥</td></tr><tr><td><strong>è®¿é—®å¤æ‚åº¦</strong></td><td>O(n)</td></tr><tr><td><strong>éå†å¤æ‚åº¦</strong></td><td>O(n)</td></tr><tr><td><strong>å±æ€§</strong></td><td>æœ‰åºã€åŠ¨æ€å¤§å°ã€å¯é‡å¤</td></tr></tbody></table><h3 id="2-2-é“¾è¡¨èŠ‚ç‚¹å®šä¹‰"><a href="#2-2-é“¾è¡¨èŠ‚ç‚¹å®šä¹‰" class="headerlink" title="2.2 é“¾è¡¨èŠ‚ç‚¹å®šä¹‰"></a>2.2 é“¾è¡¨èŠ‚ç‚¹å®šä¹‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListNode</span> &#123;<br>    <span class="hljs-type">int</span> val;           <span class="hljs-comment">// æ•°æ®</span><br>    ListNode next;     <span class="hljs-comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span><br>    <br>    ListNode(<span class="hljs-type">int</span> val) &#123;<br>        <span class="hljs-built_in">this</span>.val = val;<br>        <span class="hljs-built_in">this</span>.next = <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-éå†æ€è·¯"><a href="#2-3-éå†æ€è·¯" class="headerlink" title="2.3 éå†æ€è·¯"></a>2.3 éå†æ€è·¯</h3><p>é“¾è¡¨éå†çš„æ ¸å¿ƒæ€è·¯æ˜¯<strong>æŒ‡é’ˆè·Ÿè¸ª</strong>ï¼šä»å¤´èŠ‚ç‚¹å¼€å§‹ï¼Œé€šè¿‡ next æŒ‡é’ˆé€ä¸ªè®¿é—®æ¯ä¸ªèŠ‚ç‚¹ã€‚</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">æ€è·¯æµç¨‹ï¼š<br><span class="hljs-number">1.</span> åˆå§‹åŒ–æŒ‡é’ˆ <span class="hljs-keyword">current</span> = head<br><span class="hljs-number">2.</span> æ£€æŸ¥ <span class="hljs-keyword">current</span> != <span class="hljs-keyword">null</span><br><span class="hljs-number">3.</span> è®¿é—® <span class="hljs-keyword">current</span>.val<br><span class="hljs-number">4.</span> <span class="hljs-keyword">current</span> = <span class="hljs-keyword">current</span>.next<br><span class="hljs-number">5.</span> å›åˆ°æ­¥éª¤<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h3 id="2-4-å®ç°æ–¹å¼"><a href="#2-4-å®ç°æ–¹å¼" class="headerlink" title="2.4 å®ç°æ–¹å¼"></a>2.4 å®ç°æ–¹å¼</h3><h4 id="æ–¹å¼1ï¼šwhile-å¾ªç¯ï¼ˆæœ€å¸¸ç”¨ï¼‰"><a href="#æ–¹å¼1ï¼šwhile-å¾ªç¯ï¼ˆæœ€å¸¸ç”¨ï¼‰" class="headerlink" title="æ–¹å¼1ï¼šwhile å¾ªç¯ï¼ˆæœ€å¸¸ç”¨ï¼‰"></a>æ–¹å¼1ï¼šwhile å¾ªç¯ï¼ˆæœ€å¸¸ç”¨ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šéœ€è¦é€ä¸ªè®¿é—®èŠ‚ç‚¹</span><br><span class="hljs-type">ListNode</span> <span class="hljs-variable">head</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">1</span>);<br>head.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">2</span>);<br>head.next.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">3</span>);<br><br><span class="hljs-type">ListNode</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> head;<br><span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span>) &#123;<br>    System.out.println(current.val);  <span class="hljs-comment">// è®¿é—®èŠ‚ç‚¹</span><br>    current = current.next;            <span class="hljs-comment">// ç§»åŠ¨æŒ‡é’ˆ</span><br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>æœ€ç›´æ¥çš„éå†æ–¹å¼</li><li>é€šè¿‡ null æ£€æŸ¥ç¡®å®šéå†ç»“æŸ</li><li>ä¸ä¿®æ”¹é“¾è¡¨ç»“æ„</li></ul><h4 id="æ–¹å¼2ï¼šé€’å½’éå†"><a href="#æ–¹å¼2ï¼šé€’å½’éå†" class="headerlink" title="æ–¹å¼2ï¼šé€’å½’éå†"></a>æ–¹å¼2ï¼šé€’å½’éå†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šéœ€è¦é€’å½’å¤„ç†æˆ–åå‘éå†</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">traverse</span><span class="hljs-params">(ListNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span>;  <span class="hljs-comment">// é€’å½’ç»ˆæ­¢æ¡ä»¶</span><br>    &#125;<br>    <br>    System.out.println(node.val);      <span class="hljs-comment">// å‰åºå¤„ç†</span><br>    traverse(node.next);               <span class="hljs-comment">// é€’å½’è®¿é—®ä¸‹ä¸€ä¸ª</span><br>&#125;<br><br><span class="hljs-comment">// è°ƒç”¨</span><br>traverse(head);<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼ˆé€’å½’æ ˆï¼‰</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>é€’å½’å¤©ç„¶é€‚åˆé“¾è¡¨ç»“æ„</li><li>ç©ºé—´å¤æ‚åº¦è¾ƒé«˜ï¼ˆæ ˆæ·±åº¦ï¼‰</li><li>é€‚åˆéœ€è¦åå‘å¤„ç†çš„åœºæ™¯</li></ul><h4 id="æ–¹å¼3ï¼šåå‘éå†ï¼ˆé€’å½’ï¼‰"><a href="#æ–¹å¼3ï¼šåå‘éå†ï¼ˆé€’å½’ï¼‰" class="headerlink" title="æ–¹å¼3ï¼šåå‘éå†ï¼ˆé€’å½’ï¼‰"></a>æ–¹å¼3ï¼šåå‘éå†ï¼ˆé€’å½’ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šéœ€è¦ä»åå¾€å‰è®¿é—®</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">reverseTraverse</span><span class="hljs-params">(ListNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    reverseTraverse(node.next);        <span class="hljs-comment">// å…ˆé€’å½’åˆ°æœ«å°¾</span><br>    System.out.println(node.val);      <span class="hljs-comment">// ååºå¤„ç†ï¼ˆåå‘ï¼‰</span><br>&#125;<br><br><span class="hljs-comment">// è°ƒç”¨</span><br>reverseTraverse(head);<br><br><span class="hljs-comment">// è¾“å‡ºé¡ºåºï¼š3 2 1ï¼ˆå¦‚æœé“¾è¡¨æ˜¯ 1-&gt;2-&gt;3ï¼‰</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>åˆ©ç”¨é€’å½’æ ˆå®ç°åå‘éå†</li><li>ä¸éœ€è¦é¢å¤–çš„åå‘é“¾è¡¨</li><li>ç©ºé—´å¤æ‚åº¦ O(n)</li></ul><h4 id="æ–¹å¼4ï¼šå¿«æ…¢æŒ‡é’ˆéå†"><a href="#æ–¹å¼4ï¼šå¿«æ…¢æŒ‡é’ˆéå†" class="headerlink" title="æ–¹å¼4ï¼šå¿«æ…¢æŒ‡é’ˆéå†"></a>æ–¹å¼4ï¼šå¿«æ…¢æŒ‡é’ˆéå†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šéœ€è¦æ‰¾åˆ°ä¸­ç‚¹ã€æ£€æµ‹ç¯ç­‰</span><br><span class="hljs-type">ListNode</span> <span class="hljs-variable">slow</span> <span class="hljs-operator">=</span> head;<br><span class="hljs-type">ListNode</span> <span class="hljs-variable">fast</span> <span class="hljs-operator">=</span> head;<br><br><span class="hljs-comment">// æ€è·¯ï¼šslow æ¯æ¬¡èµ°ä¸€æ­¥ï¼Œfast æ¯æ¬¡èµ°ä¸¤æ­¥</span><br><span class="hljs-keyword">while</span> (fast != <span class="hljs-literal">null</span> &amp;&amp; fast.next != <span class="hljs-literal">null</span>) &#123;<br>    slow = slow.next;<br>    fast = fast.next.next;<br>&#125;<br><br><span class="hljs-comment">// slow ç°åœ¨æŒ‡å‘ä¸­ç‚¹</span><br>System.out.println(<span class="hljs-string">&quot;ä¸­ç‚¹å€¼ï¼š&quot;</span> + slow.val);<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>å¿«æŒ‡é’ˆé€Ÿåº¦æ˜¯æ…¢æŒ‡é’ˆçš„ä¸¤å€</li><li>å½“å¿«æŒ‡é’ˆåˆ°è¾¾æœ«å°¾æ—¶ï¼Œæ…¢æŒ‡é’ˆåœ¨ä¸­ç‚¹</li><li>é€‚åˆæ£€æµ‹ç¯ã€æ‰¾ä¸­ç‚¹ç­‰</li></ul><h4 id="æ–¹å¼5ï¼šè¿­ä»£å™¨éå†"><a href="#æ–¹å¼5ï¼šè¿­ä»£å™¨éå†" class="headerlink" title="æ–¹å¼5ï¼šè¿­ä»£å™¨éå†"></a>æ–¹å¼5ï¼šè¿­ä»£å™¨éå†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šä½¿ç”¨é›†åˆæ¡†æ¶</span><br>List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>list.add(<span class="hljs-number">1</span>);<br>list.add(<span class="hljs-number">2</span>);<br>list.add(<span class="hljs-number">3</span>);<br><br>Iterator&lt;Integer&gt; iterator = list.iterator();<br><span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>    System.out.println(iterator.next());<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>éšè—æŒ‡é’ˆç»†èŠ‚</li><li>æ”¯æŒåœ¨éå†ä¸­åˆ é™¤</li><li>æ›´å®‰å…¨çš„éå†æ–¹å¼</li></ul><h3 id="2-5-åŒå‘é“¾è¡¨éå†"><a href="#2-5-åŒå‘é“¾è¡¨éå†" class="headerlink" title="2.5 åŒå‘é“¾è¡¨éå†"></a>2.5 åŒå‘é“¾è¡¨éå†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DoublyListNode</span> &#123;<br>    <span class="hljs-type">int</span> val;<br>    DoublyListNode prev;  <span class="hljs-comment">// å‰é©±æŒ‡é’ˆ</span><br>    DoublyListNode next;  <span class="hljs-comment">// åç»§æŒ‡é’ˆ</span><br>    <br>    DoublyListNode(<span class="hljs-type">int</span> val) &#123;<br>        <span class="hljs-built_in">this</span>.val = val;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ­£å‘éå†</span><br><span class="hljs-type">DoublyListNode</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> head;<br><span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span>) &#123;<br>    System.out.println(current.val);<br>    current = current.next;<br>&#125;<br><br><span class="hljs-comment">// åå‘éå†ï¼ˆåˆ©ç”¨ prev æŒ‡é’ˆï¼‰</span><br>current = tail;<br><span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span>) &#123;<br>    System.out.println(current.val);<br>    current = current.prev;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>åŒå‘é“¾è¡¨æ”¯æŒåŒå‘éå†</li><li>åå‘éå†ä¸éœ€è¦é€’å½’</li><li>é€‚åˆéœ€è¦åŒå‘è®¿é—®çš„åœºæ™¯</li></ul><hr><h2 id="ä¸‰ã€æ ‘çš„éå†"><a href="#ä¸‰ã€æ ‘çš„éå†" class="headerlink" title="ä¸‰ã€æ ‘çš„éå†"></a>ä¸‰ã€æ ‘çš„éå†</h2><h3 id="3-1-åŸºæœ¬ç‰¹æ€§"><a href="#3-1-åŸºæœ¬ç‰¹æ€§" class="headerlink" title="3.1 åŸºæœ¬ç‰¹æ€§"></a>3.1 åŸºæœ¬ç‰¹æ€§</h3><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å­˜å‚¨æ–¹å¼</strong></td><td>å±‚çº§ç»“æ„ï¼Œçˆ¶å­å…³ç³»</td></tr><tr><td><strong>è®¿é—®å¤æ‚åº¦</strong></td><td>O(n)</td></tr><tr><td><strong>éå†å¤æ‚åº¦</strong></td><td>O(n)</td></tr><tr><td><strong>å±æ€§</strong></td><td>æœ‰åºã€éçº¿æ€§ã€æ— ç¯</td></tr></tbody></table><h3 id="3-2-æ ‘èŠ‚ç‚¹å®šä¹‰"><a href="#3-2-æ ‘èŠ‚ç‚¹å®šä¹‰" class="headerlink" title="3.2 æ ‘èŠ‚ç‚¹å®šä¹‰"></a>3.2 æ ‘èŠ‚ç‚¹å®šä¹‰</h3><h4 id="äºŒå‰æ ‘èŠ‚ç‚¹"><a href="#äºŒå‰æ ‘èŠ‚ç‚¹" class="headerlink" title="äºŒå‰æ ‘èŠ‚ç‚¹"></a>äºŒå‰æ ‘èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span> &#123;<br>    <span class="hljs-type">int</span> val;              <span class="hljs-comment">// æ•°æ®</span><br>    TreeNode left;        <span class="hljs-comment">// å·¦å­æ ‘</span><br>    TreeNode right;       <span class="hljs-comment">// å³å­æ ‘</span><br>    <br>    TreeNode(<span class="hljs-type">int</span> val) &#123;<br>        <span class="hljs-built_in">this</span>.val = val;<br>        <span class="hljs-built_in">this</span>.left = <span class="hljs-literal">null</span>;<br>        <span class="hljs-built_in">this</span>.right = <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å¤šå‰æ ‘èŠ‚ç‚¹"><a href="#å¤šå‰æ ‘èŠ‚ç‚¹" class="headerlink" title="å¤šå‰æ ‘èŠ‚ç‚¹"></a>å¤šå‰æ ‘èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NaryTreeNode</span> &#123;<br>    <span class="hljs-type">int</span> val;                          <span class="hljs-comment">// æ•°æ®</span><br>    List&lt;NaryTreeNode&gt; children;      <span class="hljs-comment">// å­èŠ‚ç‚¹åˆ—è¡¨</span><br>    <br>    NaryTreeNode(<span class="hljs-type">int</span> val) &#123;<br>        <span class="hljs-built_in">this</span>.val = val;<br>        <span class="hljs-built_in">this</span>.children = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„å­èŠ‚ç‚¹</li><li>é€‚åˆè¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿã€ç»„ç»‡ç»“æ„ç­‰</li><li>éå†é€»è¾‘æ›´é€šç”¨</li></ul><h3 id="3-3-æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰"><a href="#3-3-æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰" class="headerlink" title="3.3 æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰"></a>3.3 æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰</h3><h4 id="å‰åºéå†ï¼ˆPre-orderï¼‰"><a href="#å‰åºéå†ï¼ˆPre-orderï¼‰" class="headerlink" title="å‰åºéå†ï¼ˆPre-orderï¼‰"></a>å‰åºéå†ï¼ˆPre-orderï¼‰</h4><p><strong>éå†é¡ºåº</strong>ï¼šæ ¹ â†’ å·¦å­æ ‘ â†’ å³å­æ ‘</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">æ€è·¯æµç¨‹ï¼š<br><span class="hljs-bullet">1.</span> è®¿é—®å½“å‰èŠ‚ç‚¹<br><span class="hljs-bullet">2.</span> é€’å½’éå†å·¦å­æ ‘<br><span class="hljs-bullet">3.</span> é€’å½’éå†å³å­æ ‘<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€’å½’å®ç°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">preorder</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    System.out.println(node.val);      <span class="hljs-comment">// 1. è®¿é—®æ ¹</span><br>    preorder(node.left);               <span class="hljs-comment">// 2. éå†å·¦å­æ ‘</span><br>    preorder(node.right);              <span class="hljs-comment">// 3. éå†å³å­æ ‘</span><br>&#125;<br><br><span class="hljs-comment">// ç¤ºä¾‹æ ‘ï¼š</span><br><span class="hljs-comment">//       1</span><br><span class="hljs-comment">//      / \</span><br><span class="hljs-comment">//     2   3</span><br><span class="hljs-comment">// è¾“å‡ºï¼š1 2 3</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>æœ€å…ˆè®¿é—®æ ¹èŠ‚ç‚¹</li><li>é€‚åˆéœ€è¦å…ˆå¤„ç†çˆ¶èŠ‚ç‚¹çš„åœºæ™¯</li><li>å¦‚ï¼šå¤åˆ¶æ ‘ã€åºåˆ—åŒ–æ ‘</li></ul><p><strong>è¿­ä»£å®ç°</strong>ï¼ˆä½¿ç”¨æ ˆï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">preorderIterative</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    Stack&lt;TreeNode&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    stack.push(root);<br>    <br>    <span class="hljs-keyword">while</span> (!stack.isEmpty()) &#123;<br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> stack.pop();<br>        System.out.println(node.val);<br>        <br>        <span class="hljs-comment">// æ³¨æ„ï¼šå…ˆå‹å³å­æ ‘ï¼Œåå‹å·¦å­æ ‘</span><br>        <span class="hljs-comment">// è¿™æ ·å¼¹å‡ºæ—¶å·¦å­æ ‘å…ˆå‡º</span><br>        <span class="hljs-keyword">if</span> (node.right != <span class="hljs-literal">null</span>) &#123;<br>            stack.push(node.right);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (node.left != <span class="hljs-literal">null</span>) &#123;<br>            stack.push(node.left);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(h)ï¼Œh æ˜¯æ ‘çš„é«˜åº¦</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>æ ˆæ¨¡æ‹Ÿé€’å½’è°ƒç”¨</li><li>å‹æ ˆé¡ºåºå¾ˆå…³é”®ï¼ˆå³å…ˆå‹ï¼Œå·¦åå‹ï¼‰</li><li>é¿å…é€’å½’æ ˆæº¢å‡º</li></ul><h4 id="ä¸­åºéå†ï¼ˆIn-orderï¼‰"><a href="#ä¸­åºéå†ï¼ˆIn-orderï¼‰" class="headerlink" title="ä¸­åºéå†ï¼ˆIn-orderï¼‰"></a>ä¸­åºéå†ï¼ˆIn-orderï¼‰</h4><p><strong>éå†é¡ºåº</strong>ï¼šå·¦å­æ ‘ â†’ æ ¹ â†’ å³å­æ ‘</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">æ€è·¯æµç¨‹ï¼š<br><span class="hljs-bullet">1.</span> é€’å½’éå†å·¦å­æ ‘<br><span class="hljs-bullet">2.</span> è®¿é—®å½“å‰èŠ‚ç‚¹<br><span class="hljs-bullet">3.</span> é€’å½’éå†å³å­æ ‘<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€’å½’å®ç°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">inorder</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    inorder(node.left);                <span class="hljs-comment">// 1. éå†å·¦å­æ ‘</span><br>    System.out.println(node.val);      <span class="hljs-comment">// 2. è®¿é—®æ ¹</span><br>    inorder(node.right);               <span class="hljs-comment">// 3. éå†å³å­æ ‘</span><br>&#125;<br><br><span class="hljs-comment">// ç¤ºä¾‹æ ‘ï¼š</span><br><span class="hljs-comment">//       2</span><br><span class="hljs-comment">//      / \</span><br><span class="hljs-comment">//     1   3</span><br><span class="hljs-comment">// è¾“å‡ºï¼š1 2 3</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>å¯¹äºäºŒå‰æœç´¢æ ‘ï¼Œä¸­åºéå†å¾—åˆ°æœ‰åºåºåˆ—</li><li>é€‚åˆéœ€è¦æœ‰åºå¤„ç†çš„åœºæ™¯</li><li>æœ€å¸¸ç”¨çš„éå†æ–¹å¼</li></ul><p><strong>è¿­ä»£å®ç°</strong>ï¼ˆä½¿ç”¨æ ˆï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">inorderIterative</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>    Stack&lt;TreeNode&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    <span class="hljs-type">TreeNode</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> root;<br>    <br>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span> || !stack.isEmpty()) &#123;<br>        <span class="hljs-comment">// 1. ä¸€ç›´å‘å·¦èµ°ï¼Œå‹æ ˆæ‰€æœ‰å·¦èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span>) &#123;<br>            stack.push(current);<br>            current = current.left;<br>        &#125;<br>        <br>        <span class="hljs-comment">// 2. å·¦å­æ ‘éå†å®Œï¼Œå¼¹å‡ºæ ˆé¡¶ï¼ˆæ ¹ï¼‰</span><br>        current = stack.pop();<br>        System.out.println(current.val);<br>        <br>        <span class="hljs-comment">// 3. éå†å³å­æ ‘</span><br>        current = current.right;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(h)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>å…³é”®ï¼šå…ˆä¸€ç›´å‘å·¦ï¼Œç›´åˆ° null</li><li>ç„¶åå¤„ç†æ ˆé¡¶ï¼Œå†å‘å³</li><li>æ¯”å‰åºéå†æ›´å¤æ‚</li></ul><h4 id="ååºéå†ï¼ˆPost-orderï¼‰"><a href="#ååºéå†ï¼ˆPost-orderï¼‰" class="headerlink" title="ååºéå†ï¼ˆPost-orderï¼‰"></a>ååºéå†ï¼ˆPost-orderï¼‰</h4><p><strong>éå†é¡ºåº</strong>ï¼šå·¦å­æ ‘ â†’ å³å­æ ‘ â†’ æ ¹</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">æ€è·¯æµç¨‹ï¼š<br><span class="hljs-bullet">1.</span> é€’å½’éå†å·¦å­æ ‘<br><span class="hljs-bullet">2.</span> é€’å½’éå†å³å­æ ‘<br><span class="hljs-bullet">3.</span> è®¿é—®å½“å‰èŠ‚ç‚¹<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€’å½’å®ç°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">postorder</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    postorder(node.left);              <span class="hljs-comment">// 1. éå†å·¦å­æ ‘</span><br>    postorder(node.right);             <span class="hljs-comment">// 2. éå†å³å­æ ‘</span><br>    System.out.println(node.val);      <span class="hljs-comment">// 3. è®¿é—®æ ¹</span><br>&#125;<br><br><span class="hljs-comment">// ç¤ºä¾‹æ ‘ï¼š</span><br><span class="hljs-comment">//       3</span><br><span class="hljs-comment">//      / \</span><br><span class="hljs-comment">//     1   2</span><br><span class="hljs-comment">// è¾“å‡ºï¼š1 2 3</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>æœ€åè®¿é—®æ ¹èŠ‚ç‚¹</li><li>é€‚åˆéœ€è¦å…ˆå¤„ç†å­èŠ‚ç‚¹çš„åœºæ™¯</li><li>å¦‚ï¼šåˆ é™¤æ ‘ã€è®¡ç®—æ ‘çš„é«˜åº¦</li></ul><p><strong>è¿­ä»£å®ç°</strong>ï¼ˆä½¿ç”¨ä¸¤ä¸ªæ ˆï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">postorderIterative</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    Stack&lt;TreeNode&gt; stack1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    Stack&lt;TreeNode&gt; stack2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    <br>    stack1.push(root);<br>    <br>    <span class="hljs-comment">// ç¬¬ä¸€æ¬¡éå†ï¼šæ ¹ â†’ å³ â†’ å·¦ï¼ˆåå‘çš„ååºï¼‰</span><br>    <span class="hljs-keyword">while</span> (!stack1.isEmpty()) &#123;<br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> stack1.pop();<br>        stack2.push(node);<br>        <br>        <span class="hljs-keyword">if</span> (node.left != <span class="hljs-literal">null</span>) &#123;<br>            stack1.push(node.left);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (node.right != <span class="hljs-literal">null</span>) &#123;<br>            stack1.push(node.right);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// ç¬¬äºŒæ¬¡éå†ï¼šå¼¹å‡º stack2ï¼ˆå¾—åˆ°æ­£ç¡®çš„ååºï¼‰</span><br>    <span class="hljs-keyword">while</span> (!stack2.isEmpty()) &#123;<br>        System.out.println(stack2.pop().val);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(n)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>ä½¿ç”¨ä¸¤ä¸ªæ ˆå®ç°</li><li>ç¬¬ä¸€ä¸ªæ ˆç”Ÿæˆåå‘ååº</li><li>ç¬¬äºŒä¸ªæ ˆåè½¬å¾—åˆ°æ­£ç¡®é¡ºåº</li></ul><h3 id="3-4-å¤šå‰æ ‘éå†"><a href="#3-4-å¤šå‰æ ‘éå†" class="headerlink" title="3.4 å¤šå‰æ ‘éå†"></a>3.4 å¤šå‰æ ‘éå†</h3><h4 id="å¤šå‰æ ‘å‰åºéå†"><a href="#å¤šå‰æ ‘å‰åºéå†" class="headerlink" title="å¤šå‰æ ‘å‰åºéå†"></a>å¤šå‰æ ‘å‰åºéå†</h4><p><strong>éå†é¡ºåº</strong>ï¼šæ ¹ â†’ æ‰€æœ‰å­èŠ‚ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€’å½’å®ç°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">preorderNary</span><span class="hljs-params">(NaryTreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    System.out.println(node.val);      <span class="hljs-comment">// 1. è®¿é—®æ ¹</span><br>    <br>    <span class="hljs-comment">// 2. éå†æ‰€æœ‰å­èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">for</span> (NaryTreeNode child : node.children) &#123;<br>        preorderNary(child);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ç¤ºä¾‹æ ‘ï¼š</span><br><span class="hljs-comment">//         1</span><br><span class="hljs-comment">//      /  |  \</span><br><span class="hljs-comment">//     2   3   4</span><br><span class="hljs-comment">//    / \</span><br><span class="hljs-comment">//   5   6</span><br><span class="hljs-comment">// è¾“å‡ºï¼š1 2 5 6 3 4</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>ä¸äºŒå‰æ ‘å‰åºç±»ä¼¼ï¼Œå…ˆè®¿é—®æ ¹</li><li>éå†æ‰€æœ‰å­èŠ‚ç‚¹è€Œä¸æ˜¯åªæœ‰å·¦å³</li><li>æ—¶é—´å¤æ‚åº¦ O(n)ï¼Œç©ºé—´å¤æ‚åº¦ O(h)</li></ul><p><strong>è¿­ä»£å®ç°</strong>ï¼ˆä½¿ç”¨æ ˆï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">preorderNaryIterative</span><span class="hljs-params">(NaryTreeNode root)</span> &#123;<br>    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    Stack&lt;NaryTreeNode&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    stack.push(root);<br>    <br>    <span class="hljs-keyword">while</span> (!stack.isEmpty()) &#123;<br>        <span class="hljs-type">NaryTreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> stack.pop();<br>        System.out.println(node.val);<br>        <br>        <span class="hljs-comment">// å…³é”®ï¼šåå‘å‹æ ˆå­èŠ‚ç‚¹ï¼Œä¿è¯æ­£ç¡®çš„è®¿é—®é¡ºåº</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> node.children.size() - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>            stack.push(node.children.get(i));<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(h)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>åå‘å‹æ ˆæ˜¯å…³é”®ï¼ˆä»æœ€åä¸€ä¸ªå­èŠ‚ç‚¹å¼€å§‹ï¼‰</li><li>è¿™æ ·å¼¹å‡ºæ—¶ï¼Œç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹å…ˆå‡º</li><li>ä¿è¯äº†æ­£ç¡®çš„å‰åºéå†é¡ºåº</li></ul><h4 id="å¤šå‰æ ‘ååºéå†"><a href="#å¤šå‰æ ‘ååºéå†" class="headerlink" title="å¤šå‰æ ‘ååºéå†"></a>å¤šå‰æ ‘ååºéå†</h4><p><strong>éå†é¡ºåº</strong>ï¼šæ‰€æœ‰å­èŠ‚ç‚¹ â†’ æ ¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€’å½’å®ç°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">postorderNary</span><span class="hljs-params">(NaryTreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    <span class="hljs-comment">// 1. éå†æ‰€æœ‰å­èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">for</span> (NaryTreeNode child : node.children) &#123;<br>        postorderNary(child);<br>    &#125;<br>    <br>    System.out.println(node.val);      <span class="hljs-comment">// 2. è®¿é—®æ ¹</span><br>&#125;<br><br><span class="hljs-comment">// ç¤ºä¾‹æ ‘åŒä¸Š</span><br><span class="hljs-comment">// è¾“å‡ºï¼š5 6 2 3 4 1</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>å…ˆå¤„ç†æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæœ€åå¤„ç†æ ¹</li><li>é€‚åˆéœ€è¦å…ˆå¤„ç†å­æ ‘çš„åœºæ™¯ï¼ˆå¦‚åˆ é™¤æ ‘ï¼‰</li><li>æ—¶é—´å¤æ‚åº¦ O(n)ï¼Œç©ºé—´å¤æ‚åº¦ O(h)</li></ul><p><strong>è¿­ä»£å®ç°</strong>ï¼ˆä½¿ç”¨ä¸¤ä¸ªæ ˆï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">postorderNaryIterative</span><span class="hljs-params">(NaryTreeNode root)</span> &#123;<br>    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    Stack&lt;NaryTreeNode&gt; stack1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    Stack&lt;NaryTreeNode&gt; stack2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    <br>    stack1.push(root);<br>    <br>    <span class="hljs-comment">// ç¬¬ä¸€æ¬¡éå†ï¼šç”Ÿæˆåå‘çš„ååº</span><br>    <span class="hljs-keyword">while</span> (!stack1.isEmpty()) &#123;<br>        <span class="hljs-type">NaryTreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> stack1.pop();<br>        stack2.push(node);<br>        <br>        <span class="hljs-comment">// æ­£å‘å‹æ ˆå­èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">for</span> (NaryTreeNode child : node.children) &#123;<br>            stack1.push(child);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// ç¬¬äºŒæ¬¡éå†ï¼šå¼¹å‡º stack2</span><br>    <span class="hljs-keyword">while</span> (!stack2.isEmpty()) &#123;<br>        System.out.println(stack2.pop().val);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(n)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>ä¸äºŒå‰æ ‘ååºç±»ä¼¼ï¼Œä½¿ç”¨ä¸¤ä¸ªæ ˆ</li><li>ç¬¬ä¸€ä¸ªæ ˆç”Ÿæˆåå‘ååº</li><li>ç¬¬äºŒä¸ªæ ˆåè½¬å¾—åˆ°æ­£ç¡®é¡ºåº</li></ul><h4 id="å¤šå‰æ ‘å±‚åºéå†"><a href="#å¤šå‰æ ‘å±‚åºéå†" class="headerlink" title="å¤šå‰æ ‘å±‚åºéå†"></a>å¤šå‰æ ‘å±‚åºéå†</h4><p><strong>éå†é¡ºåº</strong>ï¼šæŒ‰å±‚ä»ä¸Šåˆ°ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">levelorderNary</span><span class="hljs-params">(NaryTreeNode root)</span> &#123;<br>    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    Queue&lt;NaryTreeNode&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>    queue.add(root);<br>    <br>    <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;<br>        <span class="hljs-type">NaryTreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> queue.poll();<br>        System.out.println(node.val);<br>        <br>        <span class="hljs-comment">// å°†æ‰€æœ‰å­èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—</span><br>        <span class="hljs-keyword">for</span> (NaryTreeNode child : node.children) &#123;<br>            queue.add(child);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// è¾“å‡ºï¼š1 2 3 4 5 6</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>é˜Ÿåˆ—ä¿è¯å±‚åºè®¿é—®</li><li>éå†æ‰€æœ‰å­èŠ‚ç‚¹è€Œä¸æ˜¯åªæœ‰å·¦å³</li><li>æ—¶é—´å¤æ‚åº¦ O(n)ï¼Œç©ºé—´å¤æ‚åº¦ O(w)</li></ul><h4 id="åˆ†å±‚éå†ï¼ˆè¿”å›æ¯å±‚çš„åˆ—è¡¨ï¼‰"><a href="#åˆ†å±‚éå†ï¼ˆè¿”å›æ¯å±‚çš„åˆ—è¡¨ï¼‰" class="headerlink" title="åˆ†å±‚éå†ï¼ˆè¿”å›æ¯å±‚çš„åˆ—è¡¨ï¼‰"></a>åˆ†å±‚éå†ï¼ˆè¿”å›æ¯å±‚çš„åˆ—è¡¨ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;List&lt;Integer&gt;&gt; <span class="hljs-title function_">levelorderNaryList</span><span class="hljs-params">(NaryTreeNode root)</span> &#123;<br>    List&lt;List&lt;Integer&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> result;<br>    <br>    Queue&lt;NaryTreeNode&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>    queue.add(root);<br>    <br>    <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">levelSize</span> <span class="hljs-operator">=</span> queue.size();  <span class="hljs-comment">// è®°å½•å½“å‰å±‚çš„èŠ‚ç‚¹æ•°</span><br>        List&lt;Integer&gt; currentLevel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <br>        <span class="hljs-comment">// å¤„ç†å½“å‰å±‚çš„æ‰€æœ‰èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; levelSize; i++) &#123;<br>            <span class="hljs-type">NaryTreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> queue.poll();<br>            currentLevel.add(node.val);<br>            <br>            <span class="hljs-comment">// å°†æ‰€æœ‰å­èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—</span><br>            <span class="hljs-keyword">for</span> (NaryTreeNode child : node.children) &#123;<br>                queue.add(child);<br>            &#125;<br>        &#125;<br>        <br>        result.add(currentLevel);<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-comment">// è¾“å‡ºï¼š[[1], [2, 3, 4], [5, 6]]</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>å…³é”®ï¼šè®°å½•æ¯å±‚çš„èŠ‚ç‚¹æ•°</li><li>åœ¨å¤„ç†å½“å‰å±‚æ—¶ï¼Œåªå¤„ç† levelSize ä¸ªèŠ‚ç‚¹</li><li>è¿™æ ·å¯ä»¥æ¸…æ™°åœ°åˆ†ç¦»å„å±‚</li></ul><h3 id="3-5-å¤šå‰æ ‘-vs-äºŒå‰æ ‘å¯¹æ¯”"><a href="#3-5-å¤šå‰æ ‘-vs-äºŒå‰æ ‘å¯¹æ¯”" class="headerlink" title="3.5 å¤šå‰æ ‘ vs äºŒå‰æ ‘å¯¹æ¯”"></a>3.5 å¤šå‰æ ‘ vs äºŒå‰æ ‘å¯¹æ¯”</h3><table><thead><tr><th>ç»´åº¦</th><th>äºŒå‰æ ‘</th><th>å¤šå‰æ ‘</th></tr></thead><tbody><tr><td><strong>å­èŠ‚ç‚¹æ•°</strong></td><td>æœ€å¤š 2 ä¸ª</td><td>ä»»æ„ä¸ª</td></tr><tr><td><strong>å‰åºéå†</strong></td><td>æ ¹â†’å·¦â†’å³</td><td>æ ¹â†’æ‰€æœ‰å­</td></tr><tr><td><strong>ååºéå†</strong></td><td>å·¦â†’å³â†’æ ¹</td><td>æ‰€æœ‰å­â†’æ ¹</td></tr><tr><td><strong>ä¸­åºéå†</strong></td><td>å·¦â†’æ ¹â†’å³</td><td>ä¸é€‚ç”¨</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>æœç´¢æ ‘ã€å †</td><td>æ–‡ä»¶ç³»ç»Ÿã€ç»„ç»‡ç»“æ„</td></tr><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>ç®€å•</td><td>ç¨å¤æ‚ï¼ˆå¾ªç¯éå†å­èŠ‚ç‚¹ï¼‰</td></tr></tbody></table><hr><h3 id="3-6-å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰"><a href="#3-6-å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰" class="headerlink" title="3.6 å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰"></a>3.6 å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰</h3><h4 id="å±‚åºéå†ï¼ˆLevel-orderï¼‰"><a href="#å±‚åºéå†ï¼ˆLevel-orderï¼‰" class="headerlink" title="å±‚åºéå†ï¼ˆLevel-orderï¼‰"></a>å±‚åºéå†ï¼ˆLevel-orderï¼‰</h4><p><strong>éå†é¡ºåº</strong>ï¼šæŒ‰å±‚ä»ä¸Šåˆ°ä¸‹ï¼ŒåŒå±‚ä»å·¦åˆ°å³</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css">æ€è·¯æµç¨‹ï¼š<br><span class="hljs-number">1</span>. åˆå§‹åŒ–é˜Ÿåˆ—ï¼Œæ”¾å…¥æ ¹èŠ‚ç‚¹<br><span class="hljs-number">2</span>. é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶ï¼š<br>   <span class="hljs-selector-tag">a</span>. å¼¹å‡ºé˜Ÿåˆ—å‰ç«¯èŠ‚ç‚¹<br>   <span class="hljs-selector-tag">b</span>. è®¿é—®è¯¥èŠ‚ç‚¹<br>   c. å°†å…¶å­èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä½¿ç”¨é˜Ÿåˆ—å®ç°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">levelorder</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    Queue&lt;TreeNode&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>    queue.add(root);<br>    <br>    <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;<br>        <span class="hljs-type">TreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> queue.poll();<br>        System.out.println(node.val);<br>        <br>        <span class="hljs-keyword">if</span> (node.left != <span class="hljs-literal">null</span>) &#123;<br>            queue.add(node.left);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (node.right != <span class="hljs-literal">null</span>) &#123;<br>            queue.add(node.right);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ç¤ºä¾‹æ ‘ï¼š</span><br><span class="hljs-comment">//       1</span><br><span class="hljs-comment">//      / \</span><br><span class="hljs-comment">//     2   3</span><br><span class="hljs-comment">//    / \</span><br><span class="hljs-comment">//   4   5</span><br><span class="hljs-comment">// è¾“å‡ºï¼š1 2 3 4 5</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>é˜Ÿåˆ—ä¿è¯äº†å±‚åºè®¿é—®</li><li>å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§å¾ˆå…³é”®</li><li>é€‚åˆéœ€è¦æŒ‰å±‚å¤„ç†çš„åœºæ™¯</li></ul><h4 id="åˆ†å±‚éå†ï¼ˆè¿”å›æ¯å±‚çš„åˆ—è¡¨ï¼‰-1"><a href="#åˆ†å±‚éå†ï¼ˆè¿”å›æ¯å±‚çš„åˆ—è¡¨ï¼‰-1" class="headerlink" title="åˆ†å±‚éå†ï¼ˆè¿”å›æ¯å±‚çš„åˆ—è¡¨ï¼‰"></a>åˆ†å±‚éå†ï¼ˆè¿”å›æ¯å±‚çš„åˆ—è¡¨ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;List&lt;Integer&gt;&gt; <span class="hljs-title function_">levelOrderList</span><span class="hljs-params">(TreeNode root)</span> &#123;<br>    List&lt;List&lt;Integer&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> result;<br>    <br>    Queue&lt;TreeNode&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>    queue.add(root);<br>    <br>    <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">levelSize</span> <span class="hljs-operator">=</span> queue.size();  <span class="hljs-comment">// å…³é”®ï¼šè®°å½•å½“å‰å±‚çš„èŠ‚ç‚¹æ•°</span><br>        List&lt;Integer&gt; currentLevel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <br>        <span class="hljs-comment">// å¤„ç†å½“å‰å±‚çš„æ‰€æœ‰èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; levelSize; i++) &#123;<br>            <span class="hljs-type">TreeNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> queue.poll();<br>            currentLevel.add(node.val);<br>            <br>            <span class="hljs-keyword">if</span> (node.left != <span class="hljs-literal">null</span>) &#123;<br>                queue.add(node.left);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (node.right != <span class="hljs-literal">null</span>) &#123;<br>                queue.add(node.right);<br>            &#125;<br>        &#125;<br>        <br>        result.add(currentLevel);<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-comment">// è¾“å‡ºï¼š[[1], [2, 3], [4, 5]]</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>å…³é”®ï¼šè®°å½•æ¯å±‚çš„èŠ‚ç‚¹æ•°</li><li>åœ¨å¤„ç†å½“å‰å±‚æ—¶ï¼Œåªå¤„ç† levelSize ä¸ªèŠ‚ç‚¹</li><li>è¿™æ ·å¯ä»¥æ¸…æ™°åœ°åˆ†ç¦»å„å±‚</li></ul><h3 id="3-5-DFS-vs-BFS-å¯¹æ¯”"><a href="#3-5-DFS-vs-BFS-å¯¹æ¯”" class="headerlink" title="3.5 DFS vs BFS å¯¹æ¯”"></a>3.5 DFS vs BFS å¯¹æ¯”</h3><table><thead><tr><th>ç»´åº¦</th><th>DFSï¼ˆé€’å½’&#x2F;æ ˆï¼‰</th><th>BFSï¼ˆé˜Ÿåˆ—ï¼‰</th></tr></thead><tbody><tr><td><strong>å®ç°</strong></td><td>é€’å½’æˆ–æ ˆ</td><td>é˜Ÿåˆ—</td></tr><tr><td><strong>ç©ºé—´å¤æ‚åº¦</strong></td><td>O(h)ï¼ˆé«˜åº¦ï¼‰</td><td>O(w)ï¼ˆæœ€å¤§å®½åº¦ï¼‰</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>è·¯å¾„é—®é¢˜ã€æ·±åº¦é—®é¢˜</td><td>æœ€çŸ­è·¯å¾„ã€å±‚çº§é—®é¢˜</td></tr><tr><td><strong>éå†é¡ºåº</strong></td><td>æ·±åº¦ä¼˜å…ˆ</td><td>å¹¿åº¦ä¼˜å…ˆ</td></tr></tbody></table><hr><h2 id="å››ã€å›¾çš„éå†"><a href="#å››ã€å›¾çš„éå†" class="headerlink" title="å››ã€å›¾çš„éå†"></a>å››ã€å›¾çš„éå†</h2><h3 id="4-1-åŸºæœ¬ç‰¹æ€§"><a href="#4-1-åŸºæœ¬ç‰¹æ€§" class="headerlink" title="4.1 åŸºæœ¬ç‰¹æ€§"></a>4.1 åŸºæœ¬ç‰¹æ€§</h3><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å­˜å‚¨æ–¹å¼</strong></td><td>é‚»æ¥è¡¨æˆ–é‚»æ¥çŸ©é˜µ</td></tr><tr><td><strong>è®¿é—®å¤æ‚åº¦</strong></td><td>O(V+E)</td></tr><tr><td><strong>éå†å¤æ‚åº¦</strong></td><td>O(V+E)</td></tr><tr><td><strong>å±æ€§</strong></td><td>å¯èƒ½æœ‰ç¯ã€å¯èƒ½ä¸è¿é€š</td></tr></tbody></table><h3 id="4-2-å›¾çš„è¡¨ç¤º"><a href="#4-2-å›¾çš„è¡¨ç¤º" class="headerlink" title="4.2 å›¾çš„è¡¨ç¤º"></a>4.2 å›¾çš„è¡¨ç¤º</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é‚»æ¥è¡¨è¡¨ç¤º</span><br>Map&lt;Integer, List&lt;Integer&gt;&gt; graph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>graph.put(<span class="hljs-number">1</span>, Arrays.asList(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>));<br>graph.put(<span class="hljs-number">2</span>, Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>));<br>graph.put(<span class="hljs-number">3</span>, Arrays.asList(<span class="hljs-number">1</span>));<br>graph.put(<span class="hljs-number">4</span>, Arrays.asList(<span class="hljs-number">2</span>));<br><br><span class="hljs-comment">// é‚»æ¥çŸ©é˜µè¡¨ç¤º</span><br><span class="hljs-type">int</span>[][] adjMatrix = &#123;<br>    &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;,  <span class="hljs-comment">// èŠ‚ç‚¹ 0 çš„é‚»æ¥</span><br>    &#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>&#125;,  <span class="hljs-comment">// èŠ‚ç‚¹ 1 çš„é‚»æ¥</span><br>    &#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>&#125;,  <span class="hljs-comment">// èŠ‚ç‚¹ 2 çš„é‚»æ¥</span><br>    &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>&#125;   <span class="hljs-comment">// èŠ‚ç‚¹ 3 çš„é‚»æ¥</span><br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="4-3-æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰"><a href="#4-3-æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰" class="headerlink" title="4.3 æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰"></a>4.3 æ·±åº¦ä¼˜å…ˆéå†ï¼ˆDFSï¼‰</h3><p><strong>æ€è·¯</strong>ï¼šä»èµ·ç‚¹å¼€å§‹ï¼Œæ²¿ç€ä¸€æ¡è·¯å¾„å°½å¯èƒ½æ·±åœ°æ¢ç´¢ï¼Œç›´åˆ°æ— æ³•ç»§ç»­ï¼Œç„¶åå›æº¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€’å½’å®ç°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> node, Map&lt;Integer, List&lt;Integer&gt;&gt; graph, Set&lt;Integer&gt; visited)</span> &#123;<br>    visited.add(node);<br>    System.out.println(node);<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> neighbor : graph.getOrDefault(node, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;())) &#123;<br>        <span class="hljs-keyword">if</span> (!visited.contains(neighbor)) &#123;<br>            dfs(neighbor, graph, visited);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// è°ƒç”¨</span><br>Set&lt;Integer&gt; visited = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>dfs(<span class="hljs-number">1</span>, graph, visited);<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(V+E)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(V)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>ä½¿ç”¨ visited é›†åˆé˜²æ­¢é‡å¤è®¿é—®ï¼ˆå¤„ç†ç¯ï¼‰</li><li>é€’å½’è‡ªç„¶åœ°å®ç°äº†æ·±åº¦ä¼˜å…ˆ</li><li>é€‚åˆæ£€æµ‹ç¯ã€æ‹“æ‰‘æ’åºç­‰</li></ul><p><strong>è¿­ä»£å®ç°</strong>ï¼ˆä½¿ç”¨æ ˆï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">dfsIterative</span><span class="hljs-params">(<span class="hljs-type">int</span> start, Map&lt;Integer, List&lt;Integer&gt;&gt; graph)</span> &#123;<br>    Set&lt;Integer&gt; visited = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>    Stack&lt;Integer&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    <br>    stack.push(start);<br>    <br>    <span class="hljs-keyword">while</span> (!stack.isEmpty()) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> stack.pop();<br>        <br>        <span class="hljs-keyword">if</span> (visited.contains(node)) &#123;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        <br>        visited.add(node);<br>        System.out.println(node);<br>        <br>        <span class="hljs-comment">// å‹æ ˆæ‰€æœ‰æœªè®¿é—®çš„é‚»æ¥èŠ‚ç‚¹</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> neighbor : graph.getOrDefault(node, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;())) &#123;<br>            <span class="hljs-keyword">if</span> (!visited.contains(neighbor)) &#123;<br>                stack.push(neighbor);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(V+E)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(V)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>æ ˆæ¨¡æ‹Ÿé€’å½’</li><li>éœ€è¦æ£€æŸ¥æ˜¯å¦å·²è®¿é—®</li><li>é¿å…é‡å¤å¤„ç†</li></ul><h3 id="4-4-å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰"><a href="#4-4-å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰" class="headerlink" title="4.4 å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰"></a>4.4 å¹¿åº¦ä¼˜å…ˆéå†ï¼ˆBFSï¼‰</h3><p><strong>æ€è·¯</strong>ï¼šä»èµ·ç‚¹å¼€å§‹ï¼Œé€å±‚æ¢ç´¢æ‰€æœ‰é‚»æ¥èŠ‚ç‚¹ï¼Œç„¶åæ¢ç´¢ä¸‹ä¸€å±‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">bfs</span><span class="hljs-params">(<span class="hljs-type">int</span> start, Map&lt;Integer, List&lt;Integer&gt;&gt; graph)</span> &#123;<br>    Set&lt;Integer&gt; visited = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>    Queue&lt;Integer&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>    <br>    queue.add(start);<br>    visited.add(start);<br>    <br>    <span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> queue.poll();<br>        System.out.println(node);<br>        <br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> neighbor : graph.getOrDefault(node, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;())) &#123;<br>            <span class="hljs-keyword">if</span> (!visited.contains(neighbor)) &#123;<br>                visited.add(neighbor);<br>                queue.add(neighbor);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(V+E)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(V)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>é˜Ÿåˆ—ä¿è¯äº†å¹¿åº¦ä¼˜å…ˆ</li><li>è®¿é—®æ—¶å°±æ ‡è®°ï¼Œé¿å…é‡å¤åŠ å…¥é˜Ÿåˆ—</li><li>é€‚åˆæœ€çŸ­è·¯å¾„é—®é¢˜</li></ul><h3 id="4-5-DFS-vs-BFS-å¯¹æ¯”"><a href="#4-5-DFS-vs-BFS-å¯¹æ¯”" class="headerlink" title="4.5 DFS vs BFS å¯¹æ¯”"></a>4.5 DFS vs BFS å¯¹æ¯”</h3><table><thead><tr><th>ç»´åº¦</th><th>DFS</th><th>BFS</th></tr></thead><tbody><tr><td><strong>æ•°æ®ç»“æ„</strong></td><td>æ ˆ</td><td>é˜Ÿåˆ—</td></tr><tr><td><strong>ç©ºé—´å¤æ‚åº¦</strong></td><td>O(V)</td><td>O(V)</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>è¿é€šæ€§ã€ç¯æ£€æµ‹ã€æ‹“æ‰‘æ’åº</td><td>æœ€çŸ­è·¯å¾„ã€åˆ†å±‚</td></tr><tr><td><strong>éå†é¡ºåº</strong></td><td>æ·±åº¦ä¼˜å…ˆ</td><td>å¹¿åº¦ä¼˜å…ˆ</td></tr></tbody></table><hr><h2 id="äº”ã€ç‰¹æ®Šæ•°æ®ç»“æ„éå†"><a href="#äº”ã€ç‰¹æ®Šæ•°æ®ç»“æ„éå†" class="headerlink" title="äº”ã€ç‰¹æ®Šæ•°æ®ç»“æ„éå†"></a>äº”ã€ç‰¹æ®Šæ•°æ®ç»“æ„éå†</h2><h3 id="5-1-äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰éå†"><a href="#5-1-äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰éå†" class="headerlink" title="5.1 äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰éå†"></a>5.1 äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰éå†</h3><p><strong>ç‰¹æ€§</strong>ï¼šå·¦å­æ ‘ &lt; æ ¹ &lt; å³å­æ ‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸­åºéå†å¾—åˆ°æœ‰åºåºåˆ—</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">inorderBST</span><span class="hljs-params">(TreeNode node)</span> &#123;<br>    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;<br>    <br>    inorderBST(node.left);<br>    System.out.println(node.val);  <span class="hljs-comment">// è¾“å‡ºæœ‰åº</span><br>    inorderBST(node.right);<br>&#125;<br><br><span class="hljs-comment">// ç¤ºä¾‹ï¼š</span><br><span class="hljs-comment">//       5</span><br><span class="hljs-comment">//      / \</span><br><span class="hljs-comment">//     3   7</span><br><span class="hljs-comment">//    / \ / \</span><br><span class="hljs-comment">//   2  4 6  8</span><br><span class="hljs-comment">// ä¸­åºè¾“å‡ºï¼š2 3 4 5 6 7 8</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>ä¸­åºéå†çš„ç‰¹æ®Šåº”ç”¨</li><li>åˆ©ç”¨ BST çš„æœ‰åºæ€§</li><li>æ—¶é—´å¤æ‚åº¦ O(n)</li></ul><h3 id="5-2-å †çš„éå†"><a href="#5-2-å †çš„éå†" class="headerlink" title="5.2 å †çš„éå†"></a>5.2 å †çš„éå†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å †é€šå¸¸ç”¨æ•°ç»„è¡¨ç¤º</span><br><span class="hljs-type">int</span>[] heap = &#123;<span class="hljs-number">10</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>&#125;;<br><br><span class="hljs-comment">// æŒ‰æ•°ç»„é¡ºåºéå†ï¼ˆå±‚åºï¼‰</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; heap.length; i++) &#123;<br>    System.out.println(heap[i]);<br>&#125;<br><br><span class="hljs-comment">// èŠ‚ç‚¹å…³ç³»ï¼š</span><br><span class="hljs-comment">// èŠ‚ç‚¹ i çš„å·¦å­èŠ‚ç‚¹ï¼š2*i + 1</span><br><span class="hljs-comment">// èŠ‚ç‚¹ i çš„å³å­èŠ‚ç‚¹ï¼š2*i + 2</span><br><span class="hljs-comment">// èŠ‚ç‚¹ i çš„çˆ¶èŠ‚ç‚¹ï¼š(i-1)/2</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>å †ç”¨æ•°ç»„è¡¨ç¤ºï¼ŒæŒ‰å±‚åºå­˜å‚¨</li><li>éå†å°±æ˜¯æŒ‰æ•°ç»„é¡ºåºè®¿é—®</li><li>æ—¶é—´å¤æ‚åº¦ O(n)</li></ul><h3 id="5-3-å“ˆå¸Œè¡¨éå†"><a href="#5-3-å“ˆå¸Œè¡¨éå†" class="headerlink" title="5.3 å“ˆå¸Œè¡¨éå†"></a>5.3 å“ˆå¸Œè¡¨éå†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>map.put(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">1</span>);<br>map.put(<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-number">2</span>);<br>map.put(<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-number">3</span>);<br><br><span class="hljs-comment">// æ–¹å¼1ï¼šéå† key</span><br><span class="hljs-keyword">for</span> (String key : map.keySet()) &#123;<br>    System.out.println(key);<br>&#125;<br><br><span class="hljs-comment">// æ–¹å¼2ï¼šéå† value</span><br><span class="hljs-keyword">for</span> (Integer value : map.values()) &#123;<br>    System.out.println(value);<br>&#125;<br><br><span class="hljs-comment">// æ–¹å¼3ï¼šéå† entryï¼ˆæœ€é«˜æ•ˆï¼‰</span><br><span class="hljs-keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : map.entrySet()) &#123;<br>    System.out.println(entry.getKey() + <span class="hljs-string">&quot;: &quot;</span> + entry.getValue());<br>&#125;<br><br><span class="hljs-comment">// æ–¹å¼4ï¼šè¿­ä»£å™¨</span><br>Iterator&lt;Map.Entry&lt;String, Integer&gt;&gt; iterator = map.entrySet().iterator();<br><span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>    Map.Entry&lt;String, Integer&gt; entry = iterator.next();<br>    System.out.println(entry.getKey() + <span class="hljs-string">&quot;: &quot;</span> + entry.getValue());<br>&#125;<br><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(n)</span><br><span class="hljs-comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(1)</span><br></code></pre></td></tr></table></figure><p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p><ul><li>éå† entry æœ€é«˜æ•ˆï¼ˆé¿å…é‡å¤æŸ¥è¯¢ï¼‰</li><li>å“ˆå¸Œè¡¨æ— åºï¼Œéå†é¡ºåºä¸ç¡®å®š</li><li>éå†ä¸­åˆ é™¤éœ€è¦ç”¨è¿­ä»£å™¨</li></ul><hr><h2 id="å…­ã€éå†çš„é€šç”¨æ€è·¯æ€»ç»“"><a href="#å…­ã€éå†çš„é€šç”¨æ€è·¯æ€»ç»“" class="headerlink" title="å…­ã€éå†çš„é€šç”¨æ€è·¯æ€»ç»“"></a>å…­ã€éå†çš„é€šç”¨æ€è·¯æ€»ç»“</h2><h3 id="6-1-éå†çš„ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ "><a href="#6-1-éå†çš„ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ " class="headerlink" title="6.1 éå†çš„ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ "></a>6.1 éå†çš„ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ </h3><table><thead><tr><th>è¦ç´ </th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>è®¿é—®é¡ºåº</strong></td><td>æŒ‰ä»€ä¹ˆé¡ºåºè®¿é—®å…ƒç´ </td><td>å‰åºã€ä¸­åºã€ååºã€å±‚åº</td></tr><tr><td><strong>çŠ¶æ€ç®¡ç†</strong></td><td>å¦‚ä½•è·Ÿè¸ªå·²è®¿é—®çš„å…ƒç´ </td><td>visited é›†åˆã€æŒ‡é’ˆä½ç½®</td></tr><tr><td><strong>ç»ˆæ­¢æ¡ä»¶</strong></td><td>ä½•æ—¶åœæ­¢éå†</td><td>nullã€é˜Ÿåˆ—ä¸ºç©ºã€visited å®Œå…¨</td></tr></tbody></table><h3 id="6-2-é€‰æ‹©éå†æ–¹å¼çš„å†³ç­–æ ‘"><a href="#6-2-é€‰æ‹©éå†æ–¹å¼çš„å†³ç­–æ ‘" class="headerlink" title="6.2 é€‰æ‹©éå†æ–¹å¼çš„å†³ç­–æ ‘"></a>6.2 é€‰æ‹©éå†æ–¹å¼çš„å†³ç­–æ ‘</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">éœ€è¦éå†æ•°æ®ç»“æ„<br>    â†“<br>æ˜¯å¦éœ€è¦ç‰¹å®šé¡ºåºï¼Ÿ<br>    â”œâ”€ æ˜¯ â†’ é€‰æ‹©å¯¹åº”çš„éå†æ–¹å¼<br>    â”‚       â”œâ”€ å‰åºï¼šå…ˆå¤„ç†çˆ¶èŠ‚ç‚¹<br>    â”‚       â”œâ”€ ä¸­åºï¼šæœ‰åºå¤„ç†ï¼ˆ<span class="hljs-keyword">BSTï¼‰</span><br><span class="hljs-keyword"></span>    â”‚       â”œâ”€ ååºï¼šå…ˆå¤„ç†å­èŠ‚ç‚¹<br>    â”‚       â””â”€ å±‚åºï¼šæŒ‰å±‚å¤„ç†<br>    â”‚<br>    â””â”€ å¦ â†’ é€‰æ‹©æœ€ç®€å•çš„æ–¹å¼<br>            â”œâ”€ çº¿æ€§ç»“æ„ â†’ for å¾ªç¯<br>            â”œâ”€ æ ‘ â†’ DFS æˆ– <span class="hljs-keyword">BFS</span><br><span class="hljs-keyword"></span>            â””â”€ å›¾ â†’ DFS æˆ– <span class="hljs-keyword">BFS</span><br></code></pre></td></tr></table></figure><h3 id="6-3-é€’å½’-vs-è¿­ä»£"><a href="#6-3-é€’å½’-vs-è¿­ä»£" class="headerlink" title="6.3 é€’å½’ vs è¿­ä»£"></a>6.3 é€’å½’ vs è¿­ä»£</h3><table><thead><tr><th>ç»´åº¦</th><th>é€’å½’</th><th>è¿­ä»£</th></tr></thead><tbody><tr><td><strong>ä»£ç ç®€æ´æ€§</strong></td><td>ç®€æ´</td><td>å¤æ‚</td></tr><tr><td><strong>ç©ºé—´å¤æ‚åº¦</strong></td><td>O(h)ï¼ˆæ ˆï¼‰</td><td>O(h)ï¼ˆæ ˆï¼‰</td></tr><tr><td><strong>æ ˆæº¢å‡ºé£é™©</strong></td><td>é«˜ï¼ˆæ·±åº¦å¤§ï¼‰</td><td>ä½</td></tr><tr><td><strong>ç†è§£éš¾åº¦</strong></td><td>å®¹æ˜“</td><td>è¾ƒéš¾</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>ç•¥ä½ï¼ˆå‡½æ•°è°ƒç”¨ï¼‰</td><td>ç•¥é«˜</td></tr></tbody></table><hr><h2 id="ä¸ƒã€å¸¸è§éå†é—®é¢˜"><a href="#ä¸ƒã€å¸¸è§éå†é—®é¢˜" class="headerlink" title="ä¸ƒã€å¸¸è§éå†é—®é¢˜"></a>ä¸ƒã€å¸¸è§éå†é—®é¢˜</h2><h3 id="7-1-å¦‚ä½•åœ¨éå†ä¸­åˆ é™¤å…ƒç´ ï¼Ÿ"><a href="#7-1-å¦‚ä½•åœ¨éå†ä¸­åˆ é™¤å…ƒç´ ï¼Ÿ" class="headerlink" title="7.1 å¦‚ä½•åœ¨éå†ä¸­åˆ é™¤å…ƒç´ ï¼Ÿ"></a>7.1 å¦‚ä½•åœ¨éå†ä¸­åˆ é™¤å…ƒç´ ï¼Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// âŒ é”™è¯¯æ–¹å¼ï¼šç›´æ¥åˆ é™¤</span><br>List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>));<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; list.size(); i++) &#123;<br>    <span class="hljs-keyword">if</span> (list.get(i) == <span class="hljs-number">3</span>) &#123;<br>        list.remove(i);  <span class="hljs-comment">// ä¼šå¯¼è‡´ç´¢å¼•æ··ä¹±</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// âœ… æ­£ç¡®æ–¹å¼1ï¼šä½¿ç”¨è¿­ä»£å™¨</span><br>Iterator&lt;Integer&gt; iterator = list.iterator();<br><span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>    <span class="hljs-keyword">if</span> (iterator.next() == <span class="hljs-number">3</span>) &#123;<br>        iterator.remove();  <span class="hljs-comment">// å®‰å…¨åˆ é™¤</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// âœ… æ­£ç¡®æ–¹å¼2ï¼šåå‘éå†</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> list.size() - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>    <span class="hljs-keyword">if</span> (list.get(i) == <span class="hljs-number">3</span>) &#123;<br>        list.remove(i);  <span class="hljs-comment">// ä¸å½±å“åç»­ç´¢å¼•</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// âœ… æ­£ç¡®æ–¹å¼3ï¼šæ”¶é›†è¦åˆ é™¤çš„å…ƒç´ </span><br>List&lt;Integer&gt; toRemove = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : list) &#123;<br>    <span class="hljs-keyword">if</span> (num == <span class="hljs-number">3</span>) &#123;<br>        toRemove.add(num);<br>    &#125;<br>&#125;<br>list.removeAll(toRemove);<br></code></pre></td></tr></table></figure><h3 id="7-2-å¦‚ä½•å¤„ç†ç¯å½¢ç»“æ„ï¼Ÿ"><a href="#7-2-å¦‚ä½•å¤„ç†ç¯å½¢ç»“æ„ï¼Ÿ" class="headerlink" title="7.2 å¦‚ä½•å¤„ç†ç¯å½¢ç»“æ„ï¼Ÿ"></a>7.2 å¦‚ä½•å¤„ç†ç¯å½¢ç»“æ„ï¼Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é—®é¢˜ï¼šé“¾è¡¨ä¸­å¯èƒ½æœ‰ç¯</span><br><span class="hljs-comment">// è§£å†³ï¼šä½¿ç”¨ visited é›†åˆæˆ–å¿«æ…¢æŒ‡é’ˆ</span><br><br><span class="hljs-comment">// æ–¹å¼1ï¼švisited é›†åˆ</span><br>Set&lt;ListNode&gt; visited = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br><span class="hljs-type">ListNode</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> head;<br><span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">if</span> (visited.contains(current)) &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ£€æµ‹åˆ°ç¯&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    visited.add(current);<br>    current = current.next;<br>&#125;<br><br><span class="hljs-comment">// æ–¹å¼2ï¼šå¿«æ…¢æŒ‡é’ˆï¼ˆFloyd ç®—æ³•ï¼‰</span><br><span class="hljs-type">ListNode</span> <span class="hljs-variable">slow</span> <span class="hljs-operator">=</span> head;<br><span class="hljs-type">ListNode</span> <span class="hljs-variable">fast</span> <span class="hljs-operator">=</span> head;<br><span class="hljs-keyword">while</span> (fast != <span class="hljs-literal">null</span> &amp;&amp; fast.next != <span class="hljs-literal">null</span>) &#123;<br>    slow = slow.next;<br>    fast = fast.next.next;<br>    <span class="hljs-keyword">if</span> (slow == fast) &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ£€æµ‹åˆ°ç¯&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="7-3-å¦‚ä½•å¤„ç†ä¸è¿é€šçš„å›¾ï¼Ÿ"><a href="#7-3-å¦‚ä½•å¤„ç†ä¸è¿é€šçš„å›¾ï¼Ÿ" class="headerlink" title="7.3 å¦‚ä½•å¤„ç†ä¸è¿é€šçš„å›¾ï¼Ÿ"></a>7.3 å¦‚ä½•å¤„ç†ä¸è¿é€šçš„å›¾ï¼Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é—®é¢˜ï¼šå›¾å¯èƒ½æœ‰å¤šä¸ªè¿é€šåˆ†é‡</span><br><span class="hljs-comment">// è§£å†³ï¼šå¯¹æ¯ä¸ªæœªè®¿é—®çš„èŠ‚ç‚¹è¿›è¡Œ DFS/BFS</span><br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">traverseAllComponents</span><span class="hljs-params">(Map&lt;Integer, List&lt;Integer&gt;&gt; graph)</span> &#123;<br>    Set&lt;Integer&gt; visited = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> node : graph.keySet()) &#123;<br>        <span class="hljs-keyword">if</span> (!visited.contains(node)) &#123;<br>            System.out.println(<span class="hljs-string">&quot;--- æ–°çš„è¿é€šåˆ†é‡ ---&quot;</span>);<br>            dfs(node, graph, visited);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="å…«ã€æ€§èƒ½å¯¹æ¯”æ€»ç»“"><a href="#å…«ã€æ€§èƒ½å¯¹æ¯”æ€»ç»“" class="headerlink" title="å…«ã€æ€§èƒ½å¯¹æ¯”æ€»ç»“"></a>å…«ã€æ€§èƒ½å¯¹æ¯”æ€»ç»“</h2><table><thead><tr><th>æ•°æ®ç»“æ„</th><th>éå†æ–¹å¼</th><th>æ—¶é—´å¤æ‚åº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>æ•°ç»„</td><td>for å¾ªç¯</td><td>O(n)</td><td>O(1)</td><td>é¡ºåºè®¿é—®</td></tr><tr><td>é“¾è¡¨</td><td>while å¾ªç¯</td><td>O(n)</td><td>O(1)</td><td>é¡ºåºè®¿é—®</td></tr><tr><td>æ ‘</td><td>DFSï¼ˆé€’å½’ï¼‰</td><td>O(n)</td><td>O(h)</td><td>æ·±åº¦ä¼˜å…ˆ</td></tr><tr><td>æ ‘</td><td>BFSï¼ˆé˜Ÿåˆ—ï¼‰</td><td>O(n)</td><td>O(w)</td><td>å¹¿åº¦ä¼˜å…ˆ</td></tr><tr><td>å›¾</td><td>DFS</td><td>O(V+E)</td><td>O(V)</td><td>è¿é€šæ€§æ£€æµ‹</td></tr><tr><td>å›¾</td><td>BFS</td><td>O(V+E)</td><td>O(V)</td><td>æœ€çŸ­è·¯å¾„</td></tr><tr><td>å“ˆå¸Œè¡¨</td><td>entry éå†</td><td>O(n)</td><td>O(1)</td><td>é”®å€¼å¯¹è®¿é—®</td></tr></tbody></table><hr><h2 id="ç›¸å…³ç¬”è®°"><a href="#ç›¸å…³ç¬”è®°" class="headerlink" title="ç›¸å…³ç¬”è®°"></a>ç›¸å…³ç¬”è®°</h2><ul><li>æ•°ç»„æ“ä½œè¯¦è§£</li><li>é“¾è¡¨æ“ä½œè¯¦è§£</li><li>æ ‘çš„æ“ä½œè¯¦è§£</li><li>å›¾çš„æ“ä½œè¯¦è§£</li></ul>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®ç»“æ„</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
      <tag>éå†</tag>
      
      <tag>å±æ€§ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fluxæ˜¯ç®¡é“ä¸æ˜¯å®¹å™¨</title>
    <link href="/2026/01/10/Flux%E6%98%AF%E7%AE%A1%E9%81%93%E4%B8%8D%E6%98%AF%E5%AE%B9%E5%99%A8/"/>
    <url>/2026/01/10/Flux%E6%98%AF%E7%AE%A1%E9%81%93%E4%B8%8D%E6%98%AF%E5%AE%B9%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="Flux-æ˜¯ç®¡é“ï¼Œä¸æ˜¯å®¹å™¨"><a href="#Flux-æ˜¯ç®¡é“ï¼Œä¸æ˜¯å®¹å™¨" class="headerlink" title="Flux æ˜¯ç®¡é“ï¼Œä¸æ˜¯å®¹å™¨"></a>Flux æ˜¯ç®¡é“ï¼Œä¸æ˜¯å®¹å™¨</h1><h2 id="å¸¸è§è¯¯è§£"><a href="#å¸¸è§è¯¯è§£" class="headerlink" title="å¸¸è§è¯¯è§£"></a>å¸¸è§è¯¯è§£</h2><p>å¾ˆå¤šäººåˆå­¦ Reactor æ—¶ä¼šæœ‰è¿™æ ·çš„è¯¯è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é”™è¯¯ç†è§£ï¼šFlux å°±åƒ Listï¼Œæ˜¯è£…æ•°æ®çš„å®¹å™¨</span><br>List&lt;String&gt; list = Arrays.asList(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>);  <span class="hljs-comment">// 3ä¸ªå…ƒç´ ï¼Œç¡®å®šçš„</span><br>Flux&lt;String&gt; flux = Flux.just(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>);      <span class="hljs-comment">// ä¹Ÿæ˜¯3ä¸ªå…ƒç´ ï¼Œç¡®å®šçš„ï¼Ÿ</span><br></code></pre></td></tr></table></figure><p>è¿™ç§ç†è§£åœ¨ç®€å•åœºæ™¯ä¸‹æ²¡é—®é¢˜ï¼Œä½†ä¼šå¯¼è‡´æ— æ³•ç†è§£å¤æ‚åœºæ™¯ã€‚</p><hr><h2 id="æ­£ç¡®ç†è§£ï¼šFlux-æ˜¯æ•°æ®ç®¡é“"><a href="#æ­£ç¡®ç†è§£ï¼šFlux-æ˜¯æ•°æ®ç®¡é“" class="headerlink" title="æ­£ç¡®ç†è§£ï¼šFlux æ˜¯æ•°æ®ç®¡é“"></a>æ­£ç¡®ç†è§£ï¼šFlux æ˜¯æ•°æ®ç®¡é“</h2><h3 id="ç®¡é“-vs-å®¹å™¨"><a href="#ç®¡é“-vs-å®¹å™¨" class="headerlink" title="ç®¡é“ vs å®¹å™¨"></a>ç®¡é“ vs å®¹å™¨</h3><table><thead><tr><th>æ¦‚å¿µ</th><th>å®¹å™¨ï¼ˆListï¼‰</th><th>ç®¡é“ï¼ˆFluxï¼‰</th></tr></thead><tbody><tr><td><strong>æ•°æ®å­˜å‚¨</strong></td><td>æ•°æ®å­˜åœ¨å†…å­˜ä¸­</td><td>æ•°æ®æµç»ç®¡é“</td></tr><tr><td><strong>æ•°æ®æ—¶æœº</strong></td><td>åˆ›å»ºæ—¶å°±æœ‰</td><td>è®¢é˜…åæ‰å¼€å§‹æµåŠ¨</td></tr><tr><td><strong>æ•°æ®æ¥æº</strong></td><td>å·²çŸ¥ã€å›ºå®š</td><td>å¯ä»¥æ˜¯ä»»ä½•æºå¤´</td></tr><tr><td><strong>æ•°æ®æ•°é‡</strong></td><td>ç¡®å®šçš„</td><td>å¯èƒ½ä¸ç¡®å®š</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>ä¸€ç›´å­˜åœ¨</td><td>æµå®Œå°±ç»“æŸ</td></tr></tbody></table><h3 id="å½¢è±¡æ¯”å–»"><a href="#å½¢è±¡æ¯”å–»" class="headerlink" title="å½¢è±¡æ¯”å–»"></a>å½¢è±¡æ¯”å–»</h3><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">å®¹å™¨ï¼ˆ<span class="hljs-built_in">List</span>ï¼‰åƒä¸€ä¸ªæ°´æ¡¶ï¼š<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚  æ°´æ°´æ°´  â”‚  â† æ°´å·²ç»åœ¨æ¡¶é‡Œäº†<br>â”‚  æ°´æ°´æ°´  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br><br>ç®¡é“ï¼ˆ<span class="hljs-variable">Flux</span>ï¼‰åƒä¸€æ ¹æ°´ç®¡ï¼š<br>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>æ°´æº â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚  æ°´ç®¡   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¶ å‡ºæ°´å£<br>ï¼ˆä¸Šæ¸¸ï¼‰              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 ï¼ˆä¸‹æ¸¸ï¼‰<br>                         â†‘<br>                    æ°´æµç»è¿™é‡Œ<br>                    ä½†ä¸å­˜å‚¨åœ¨è¿™é‡Œ<br></code></pre></td></tr></table></figure><hr><h2 id="å®é™…æ¡ˆä¾‹ï¼šè°ƒç”¨å¤§æ¨¡å‹-API"><a href="#å®é™…æ¡ˆä¾‹ï¼šè°ƒç”¨å¤§æ¨¡å‹-API" class="headerlink" title="å®é™…æ¡ˆä¾‹ï¼šè°ƒç”¨å¤§æ¨¡å‹ API"></a>å®é™…æ¡ˆä¾‹ï¼šè°ƒç”¨å¤§æ¨¡å‹ API</h2><h3 id="åœºæ™¯æè¿°"><a href="#åœºæ™¯æè¿°" class="headerlink" title="åœºæ™¯æè¿°"></a>åœºæ™¯æè¿°</h3><p>è°ƒç”¨ OpenAI&#x2F;Claude ç­‰å¤§æ¨¡å‹ APIï¼Œè¿”å›æµå¼å“åº”ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux&lt;String&gt; response = webClient.post()<br>    .uri(<span class="hljs-string">&quot;https://api.openai.com/v1/chat/completions&quot;</span>)<br>    .header(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;Bearer &quot;</span> + apiKey)<br>    .bodyValue(Map.of(<br>        <span class="hljs-string">&quot;model&quot;</span>, <span class="hljs-string">&quot;gpt-4&quot;</span>,<br>        <span class="hljs-string">&quot;messages&quot;</span>, List.of(Map.of(<span class="hljs-string">&quot;role&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>, <span class="hljs-string">&quot;ä½ å¥½&quot;</span>)),<br>        <span class="hljs-string">&quot;stream&quot;</span>, <span class="hljs-literal">true</span><br>    ))<br>    .retrieve()<br>    .bodyToFlux(String.class);<br></code></pre></td></tr></table></figure><h3 id="é—®é¢˜ï¼šFlux-é‡Œæœ‰å¤šå°‘æ•°æ®ï¼Ÿ"><a href="#é—®é¢˜ï¼šFlux-é‡Œæœ‰å¤šå°‘æ•°æ®ï¼Ÿ" class="headerlink" title="é—®é¢˜ï¼šFlux é‡Œæœ‰å¤šå°‘æ•°æ®ï¼Ÿ"></a>é—®é¢˜ï¼šFlux é‡Œæœ‰å¤šå°‘æ•°æ®ï¼Ÿ</h3><p><strong>ç­”æ¡ˆï¼šä¸çŸ¥é“ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ï¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¿™ä¸ª Flux åˆ›å»ºæ—¶ï¼Œå¤§æ¨¡å‹è¿˜æ²¡å¼€å§‹å›å¤</span><br><span class="hljs-comment">// æ•°æ®é‡å®Œå…¨å–å†³äºå¤§æ¨¡å‹è¦è¯´å¤šå°‘è¯</span><br>Flux&lt;String&gt; response = callLLM(<span class="hljs-string">&quot;è¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±&quot;</span>);<br><br><span class="hljs-comment">// å¯èƒ½è¿”å› 10 ä¸ª chunkï¼Œä¹Ÿå¯èƒ½è¿”å› 100 ä¸ª</span><br><span class="hljs-comment">// Flux ä¸å…³å¿ƒï¼Œå®ƒåªè´Ÿè´£æŠŠæ•°æ®ä»ä¸Šæ¸¸ä¼ åˆ°ä¸‹æ¸¸</span><br></code></pre></td></tr></table></figure><h3 id="æ•°æ®æµåŠ¨è¿‡ç¨‹"><a href="#æ•°æ®æµåŠ¨è¿‡ç¨‹" class="headerlink" title="æ•°æ®æµåŠ¨è¿‡ç¨‹"></a>æ•°æ®æµåŠ¨è¿‡ç¨‹</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                        æ—¶é—´çº¿                                    â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚                                                                 â”‚<br>â”‚  T0: åˆ›å»º Flux                                                  â”‚<br>â”‚      Flux&lt;String&gt; flux = <span class="hljs-built_in">callLLM</span>(prompt);                       â”‚<br>â”‚      æ­¤æ—¶ï¼šç®¡é“å·²å»ºç«‹ï¼Œä½†æ²¡æœ‰æ•°æ®æµåŠ¨                              â”‚<br>â”‚                                                                 â”‚<br>â”‚  T1: è®¢é˜… Flux                                                  â”‚<br>â”‚      flux.<span class="hljs-built_in">subscribe</span>(chunk -&gt; <span class="hljs-built_in">print</span>(chunk));                     â”‚<br>â”‚      æ­¤æ—¶ï¼šå‘ä¸Šæ¸¸å‘é€è¯·æ±‚ï¼Œå¼€å§‹ç­‰å¾…æ•°æ®                            â”‚<br>â”‚                                                                 â”‚<br>â”‚  T2: å¤§æ¨¡å‹å¼€å§‹å›å¤                                              â”‚<br>â”‚      ä¸Šæ¸¸å‘é€ <span class="hljs-built_in">onNext</span>(<span class="hljs-string">&quot;ä½ &quot;</span>)                                       â”‚<br>â”‚      ä¸‹æ¸¸æ”¶åˆ° <span class="hljs-string">&quot;ä½ &quot;</span>ï¼Œæ‰“å°                                         â”‚<br>â”‚                                                                 â”‚<br>â”‚  T3: å¤§æ¨¡å‹ç»§ç»­å›å¤                                              â”‚<br>â”‚      ä¸Šæ¸¸å‘é€ <span class="hljs-built_in">onNext</span>(<span class="hljs-string">&quot;å¥½&quot;</span>)                                       â”‚<br>â”‚      ä¸‹æ¸¸æ”¶åˆ° <span class="hljs-string">&quot;å¥½&quot;</span>ï¼Œæ‰“å°                                         â”‚<br>â”‚                                                                 â”‚<br>â”‚  T4: å¤§æ¨¡å‹ç»§ç»­å›å¤                                              â”‚<br>â”‚      ä¸Šæ¸¸å‘é€ <span class="hljs-built_in">onNext</span>(<span class="hljs-string">&quot;ï¼Œæˆ‘æ˜¯AIåŠ©æ‰‹&quot;</span>)                             â”‚<br>â”‚      ä¸‹æ¸¸æ”¶åˆ°ï¼Œæ‰“å°                                              â”‚<br>â”‚                                                                 â”‚<br>â”‚  T5: å¤§æ¨¡å‹å›å¤å®Œæ¯•                                              â”‚<br>â”‚      ä¸Šæ¸¸å‘é€ <span class="hljs-built_in">onComplete</span>()                                       â”‚<br>â”‚      ä¸‹æ¸¸çŸ¥é“æµç»“æŸäº†                                            â”‚<br>â”‚                                                                 â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(value = &quot;/chat&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span><br><span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">chat</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String prompt)</span> &#123;<br>    <br>    <span class="hljs-comment">// 1. åˆ›å»º Fluxï¼ˆæ­¤æ—¶æ²¡æœ‰æ•°æ®ï¼‰</span><br>    Flux&lt;String&gt; response = webClient.post()<br>        .uri(<span class="hljs-string">&quot;/v1/chat/completions&quot;</span>)<br>        .bodyValue(buildRequest(prompt))<br>        .retrieve()<br>        .bodyToFlux(ChatResponse.class)<br>        .map(r -&gt; r.getChoices().get(<span class="hljs-number">0</span>).getDelta().getContent())<br>        .filter(Objects::nonNull);<br>    <br>    <span class="hljs-comment">// 2. è¿”å› Fluxï¼ˆSpring WebFlux ä¼šè‡ªåŠ¨è®¢é˜…å¹¶æµå¼è¿”å›ç»™å‰ç«¯ï¼‰</span><br>    <span class="hljs-keyword">return</span> response;<br>    <br>    <span class="hljs-comment">// 3. å‰ç«¯ä¼šé€å­—æ”¶åˆ°å¤§æ¨¡å‹çš„å›å¤</span><br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="Flux-çš„æ•°æ®æ¥æº"><a href="#Flux-çš„æ•°æ®æ¥æº" class="headerlink" title="Flux çš„æ•°æ®æ¥æº"></a>Flux çš„æ•°æ®æ¥æº</h2><p>Flux çš„æ•°æ®å¯ä»¥æ¥è‡ªå„ç§æºå¤´ï¼š</p><h3 id="1-é™æ€æ•°æ®ï¼ˆç¡®å®šçš„ï¼‰"><a href="#1-é™æ€æ•°æ®ï¼ˆç¡®å®šçš„ï¼‰" class="headerlink" title="1. é™æ€æ•°æ®ï¼ˆç¡®å®šçš„ï¼‰"></a>1. é™æ€æ•°æ®ï¼ˆç¡®å®šçš„ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ•°æ®åœ¨åˆ›å»ºæ—¶å°±ç¡®å®šäº†</span><br>Flux.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br>Flux.fromIterable(list);<br>Flux.fromArray(array);<br></code></pre></td></tr></table></figure><h3 id="2-ç”Ÿæˆè§„åˆ™ï¼ˆæŒ‰è§„åˆ™äº§ç”Ÿï¼‰"><a href="#2-ç”Ÿæˆè§„åˆ™ï¼ˆæŒ‰è§„åˆ™äº§ç”Ÿï¼‰" class="headerlink" title="2. ç”Ÿæˆè§„åˆ™ï¼ˆæŒ‰è§„åˆ™äº§ç”Ÿï¼‰"></a>2. ç”Ÿæˆè§„åˆ™ï¼ˆæŒ‰è§„åˆ™äº§ç”Ÿï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æŒ‰è§„åˆ™ç”Ÿæˆï¼Œæ•°é‡å¯èƒ½æ— é™</span><br>Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>);                    <span class="hljs-comment">// 1åˆ°100</span><br>Flux.interval(Duration.ofSeconds(<span class="hljs-number">1</span>));  <span class="hljs-comment">// æ¯ç§’ä¸€ä¸ªï¼Œæ— é™</span><br></code></pre></td></tr></table></figure><h3 id="3-å¤–éƒ¨æ•°æ®æºï¼ˆä¸ç¡®å®šçš„ï¼‰"><a href="#3-å¤–éƒ¨æ•°æ®æºï¼ˆä¸ç¡®å®šçš„ï¼‰" class="headerlink" title="3. å¤–éƒ¨æ•°æ®æºï¼ˆä¸ç¡®å®šçš„ï¼‰"></a>3. å¤–éƒ¨æ•°æ®æºï¼ˆä¸ç¡®å®šçš„ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ•°æ®æ¥è‡ªå¤–éƒ¨ï¼Œæ•°é‡ä¸ç¡®å®š</span><br>Flux&lt;String&gt; httpResponse = webClient.get().retrieve().bodyToFlux(String.class);<br>Flux&lt;Message&gt; kafkaMessages = kafkaReceiver.receive();<br>Flux&lt;String&gt; websocketMessages = session.receive().map(WebSocketMessage::getPayloadAsText);<br>Flux&lt;String&gt; fileLines = Flux.using(<br>    () -&gt; Files.lines(path),<br>    Flux::fromStream,<br>    Stream::close<br>);<br></code></pre></td></tr></table></figure><h3 id="4-æ‰‹åŠ¨æ¨é€ï¼ˆSinksï¼‰"><a href="#4-æ‰‹åŠ¨æ¨é€ï¼ˆSinksï¼‰" class="headerlink" title="4. æ‰‹åŠ¨æ¨é€ï¼ˆSinksï¼‰"></a>4. æ‰‹åŠ¨æ¨é€ï¼ˆSinksï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä½ è‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™å‘é€ä»€ä¹ˆæ•°æ®</span><br>Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯1&quot;</span>);<br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯2&quot;</span>);<br>Flux&lt;String&gt; flux = sink.asFlux();<br></code></pre></td></tr></table></figure><hr><h2 id="Flux-æ€ä¹ˆçŸ¥é“æ•°æ®ç»“æŸï¼Ÿ"><a href="#Flux-æ€ä¹ˆçŸ¥é“æ•°æ®ç»“æŸï¼Ÿ" class="headerlink" title="Flux æ€ä¹ˆçŸ¥é“æ•°æ®ç»“æŸï¼Ÿ"></a>Flux æ€ä¹ˆçŸ¥é“æ•°æ®ç»“æŸï¼Ÿ</h2><h3 id="ä¸‰ç§ç»ˆæ­¢ä¿¡å·"><a href="#ä¸‰ç§ç»ˆæ­¢ä¿¡å·" class="headerlink" title="ä¸‰ç§ç»ˆæ­¢ä¿¡å·"></a>ä¸‰ç§ç»ˆæ­¢ä¿¡å·</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">flux.subscribe(<br>    data -&gt; &#123; &#125;,           <span class="hljs-comment">// onNext: æ”¶åˆ°æ•°æ®</span><br>    error -&gt; &#123; &#125;,          <span class="hljs-comment">// onError: å‘ç”Ÿé”™è¯¯ï¼Œæµç»ˆæ­¢</span><br>    () -&gt; &#123; &#125;              <span class="hljs-comment">// onComplete: æ­£å¸¸å®Œæˆï¼Œæµç»ˆæ­¢</span><br>);<br></code></pre></td></tr></table></figure><h3 id="è°å‘é€ç»ˆæ­¢ä¿¡å·ï¼Ÿ"><a href="#è°å‘é€ç»ˆæ­¢ä¿¡å·ï¼Ÿ" class="headerlink" title="è°å‘é€ç»ˆæ­¢ä¿¡å·ï¼Ÿ"></a>è°å‘é€ç»ˆæ­¢ä¿¡å·ï¼Ÿ</h3><p><strong>ä¸Šæ¸¸ï¼ˆç”Ÿäº§è€…ï¼‰å†³å®šä½•æ—¶ç»“æŸ</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç¤ºä¾‹1ï¼šé™æ€æ•°æ® - å‘å®Œå°±ç»“æŸ</span><br>Flux.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br><span class="hljs-comment">// å†…éƒ¨ï¼šonNext(1), onNext(2), onNext(3), onComplete()</span><br><br><span class="hljs-comment">// ç¤ºä¾‹2ï¼šHTTP å“åº” - æœåŠ¡ç«¯å…³é—­è¿æ¥æ—¶ç»“æŸ</span><br>webClient.get().retrieve().bodyToFlux(String.class);<br><span class="hljs-comment">// å†…éƒ¨ï¼šonNext(chunk1), onNext(chunk2), ..., onComplete()</span><br><br><span class="hljs-comment">// ç¤ºä¾‹3ï¼šæ— é™æµ - æ°¸ä¸ç»“æŸï¼ˆé™¤éå‡ºé”™æˆ–å–æ¶ˆï¼‰</span><br>Flux.interval(Duration.ofSeconds(<span class="hljs-number">1</span>));<br><span class="hljs-comment">// å†…éƒ¨ï¼šonNext(0), onNext(1), onNext(2), ... (æ°¸è¿œç»§ç»­)</span><br><br><span class="hljs-comment">// ç¤ºä¾‹4ï¼šæ‰‹åŠ¨æ§åˆ¶ - ä½ å†³å®šä½•æ—¶ç»“æŸ</span><br>Sinks.Many&lt;String&gt; sink = Sinks.many().unicast().onBackpressureBuffer();<br>sink.tryEmitNext(<span class="hljs-string">&quot;a&quot;</span>);<br>sink.tryEmitNext(<span class="hljs-string">&quot;b&quot;</span>);<br>sink.tryEmitComplete();  <span class="hljs-comment">// ä½ å†³å®šç»“æŸ</span><br></code></pre></td></tr></table></figure><hr><h2 id="å¯¹æ¯”ï¼šä»€ä¹ˆæ—¶å€™ç”¨-Fluxï¼Œä»€ä¹ˆæ—¶å€™ç”¨-Sinks"><a href="#å¯¹æ¯”ï¼šä»€ä¹ˆæ—¶å€™ç”¨-Fluxï¼Œä»€ä¹ˆæ—¶å€™ç”¨-Sinks" class="headerlink" title="å¯¹æ¯”ï¼šä»€ä¹ˆæ—¶å€™ç”¨ Fluxï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Sinks"></a>å¯¹æ¯”ï¼šä»€ä¹ˆæ—¶å€™ç”¨ Fluxï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Sinks</h2><h3 id="ä½ æ˜¯æ¶ˆè´¹è€…-â†’-ç”¨-Flux"><a href="#ä½ æ˜¯æ¶ˆè´¹è€…-â†’-ç”¨-Flux" class="headerlink" title="ä½ æ˜¯æ¶ˆè´¹è€… â†’ ç”¨ Flux"></a>ä½ æ˜¯æ¶ˆè´¹è€… â†’ ç”¨ Flux</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šè°ƒç”¨åˆ«äººçš„ APIï¼Œæ¥æ”¶æ•°æ®</span><br>Flux&lt;String&gt; response = callExternalAPI();<br>response.subscribe(data -&gt; process(data));<br><br><span class="hljs-comment">// åœºæ™¯ï¼šä»æ•°æ®åº“æŸ¥è¯¢</span><br>Flux&lt;User&gt; users = userRepository.findAll();<br><br><span class="hljs-comment">// åœºæ™¯ï¼šè¯»å–æ–‡ä»¶</span><br>Flux&lt;String&gt; lines = readFileLines(path);<br></code></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼šæ•°æ®ç”±åˆ«äººäº§ç”Ÿï¼Œä½ åªéœ€è¦æ¥æ”¶å’Œå¤„ç†ã€‚</p><h3 id="ä½ æ˜¯ç”Ÿäº§è€…-â†’-ç”¨-Sinks"><a href="#ä½ æ˜¯ç”Ÿäº§è€…-â†’-ç”¨-Sinks" class="headerlink" title="ä½ æ˜¯ç”Ÿäº§è€… â†’ ç”¨ Sinks"></a>ä½ æ˜¯ç”Ÿäº§è€… â†’ ç”¨ Sinks</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åœºæ™¯ï¼šWebSocket æœåŠ¡ç«¯ï¼Œä¸»åŠ¨æ¨é€æ¶ˆæ¯</span><br>Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// åœ¨æŸä¸ªäº‹ä»¶è§¦å‘æ—¶å‘é€æ•°æ®</span><br><span class="hljs-meta">@EventListener</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserLogin</span><span class="hljs-params">(UserLoginEvent event)</span> &#123;<br>    sink.tryEmitNext(<span class="hljs-string">&quot;ç”¨æˆ· &quot;</span> + event.getUsername() + <span class="hljs-string">&quot; ç™»å½•äº†&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// å®¢æˆ·ç«¯è®¢é˜…è¿™ä¸ªæµ</span><br><span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">getNotifications</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> sink.asFlux();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼šæ•°æ®ç”±ä½ äº§ç”Ÿï¼Œä½ éœ€è¦ä¸»åŠ¨æ¨é€ã€‚</p><h3 id="å¯¹æ¯”è¡¨"><a href="#å¯¹æ¯”è¡¨" class="headerlink" title="å¯¹æ¯”è¡¨"></a>å¯¹æ¯”è¡¨</h3><table><thead><tr><th>åœºæ™¯</th><th>è§’è‰²</th><th>ä½¿ç”¨</th><th>æ•°æ®æ¥æº</th></tr></thead><tbody><tr><td>è°ƒç”¨ HTTP API</td><td>æ¶ˆè´¹è€…</td><td>Flux</td><td>æœåŠ¡ç«¯è¿”å›</td></tr><tr><td>æŸ¥è¯¢æ•°æ®åº“</td><td>æ¶ˆè´¹è€…</td><td>Flux</td><td>æ•°æ®åº“è¿”å›</td></tr><tr><td>è¯»å–æ¶ˆæ¯é˜Ÿåˆ—</td><td>æ¶ˆè´¹è€…</td><td>Flux</td><td>é˜Ÿåˆ—æ¨é€</td></tr><tr><td>WebSocket æ¨é€</td><td>ç”Ÿäº§è€…</td><td>Sinks</td><td>ä½ ä¸»åŠ¨å‘é€</td></tr><tr><td>äº‹ä»¶å¹¿æ’­</td><td>ç”Ÿäº§è€…</td><td>Sinks</td><td>ä½ ä¸»åŠ¨å‘é€</td></tr><tr><td>å°è£…å›è°ƒ API</td><td>ç”Ÿäº§è€…</td><td>Sinks</td><td>å›è°ƒè§¦å‘æ—¶å‘é€</td></tr></tbody></table><hr><h2 id="æ·±å…¥ç†è§£ï¼šæ‡’åŠ è½½ä¸è®¢é˜…"><a href="#æ·±å…¥ç†è§£ï¼šæ‡’åŠ è½½ä¸è®¢é˜…" class="headerlink" title="æ·±å…¥ç†è§£ï¼šæ‡’åŠ è½½ä¸è®¢é˜…"></a>æ·±å…¥ç†è§£ï¼šæ‡’åŠ è½½ä¸è®¢é˜…</h2><h3 id="Flux-æ˜¯æ‡’åŠ è½½çš„"><a href="#Flux-æ˜¯æ‡’åŠ è½½çš„" class="headerlink" title="Flux æ˜¯æ‡’åŠ è½½çš„"></a>Flux æ˜¯æ‡’åŠ è½½çš„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¿™è¡Œä»£ç æ‰§è¡Œæ—¶ï¼Œå¹¶æ²¡æœ‰çœŸæ­£è°ƒç”¨ API</span><br>Flux&lt;String&gt; flux = webClient.get().uri(<span class="hljs-string">&quot;/api&quot;</span>).retrieve().bodyToFlux(String.class);<br>System.out.println(<span class="hljs-string">&quot;Flux åˆ›å»ºå®Œæˆ&quot;</span>);<br><br><span class="hljs-comment">// åªæœ‰è®¢é˜…æ—¶ï¼Œæ‰çœŸæ­£å‘èµ·è¯·æ±‚</span><br>flux.subscribe(data -&gt; System.out.println(<span class="hljs-string">&quot;æ”¶åˆ°: &quot;</span> + data));<br>System.out.println(<span class="hljs-string">&quot;è®¢é˜…å®Œæˆ&quot;</span>);<br><br><span class="hljs-comment">// è¾“å‡ºé¡ºåºï¼š</span><br><span class="hljs-comment">// Flux åˆ›å»ºå®Œæˆ</span><br><span class="hljs-comment">// è®¢é˜…å®Œæˆ</span><br><span class="hljs-comment">// æ”¶åˆ°: xxxï¼ˆå¼‚æ­¥ï¼Œç¨åè¾“å‡ºï¼‰</span><br></code></pre></td></tr></table></figure><h3 id="æ¯æ¬¡è®¢é˜…éƒ½æ˜¯ç‹¬ç«‹çš„"><a href="#æ¯æ¬¡è®¢é˜…éƒ½æ˜¯ç‹¬ç«‹çš„" class="headerlink" title="æ¯æ¬¡è®¢é˜…éƒ½æ˜¯ç‹¬ç«‹çš„"></a>æ¯æ¬¡è®¢é˜…éƒ½æ˜¯ç‹¬ç«‹çš„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux&lt;String&gt; flux = webClient.get().uri(<span class="hljs-string">&quot;/api/random&quot;</span>).retrieve().bodyToFlux(String.class);<br><br><span class="hljs-comment">// ç¬¬ä¸€æ¬¡è®¢é˜… - å‘èµ·ç¬¬ä¸€æ¬¡è¯·æ±‚</span><br>flux.subscribe(data -&gt; System.out.println(<span class="hljs-string">&quot;è®¢é˜…1: &quot;</span> + data));<br><br><span class="hljs-comment">// ç¬¬äºŒæ¬¡è®¢é˜… - å‘èµ·ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆç‹¬ç«‹çš„ï¼‰</span><br>flux.subscribe(data -&gt; System.out.println(<span class="hljs-string">&quot;è®¢é˜…2: &quot;</span> + data));<br><br><span class="hljs-comment">// ä¸¤æ¬¡è®¢é˜…å¯èƒ½æ”¶åˆ°ä¸åŒçš„æ•°æ®ï¼</span><br></code></pre></td></tr></table></figure><h3 id="å†·æµ-vs-çƒ­æµ"><a href="#å†·æµ-vs-çƒ­æµ" class="headerlink" title="å†·æµ vs çƒ­æµ"></a>å†·æµ vs çƒ­æµ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å†·æµï¼šæ¯ä¸ªè®¢é˜…è€…éƒ½ä»å¤´å¼€å§‹</span><br>Flux&lt;Integer&gt; cold = Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>);<br>cold.subscribe(i -&gt; System.out.println(<span class="hljs-string">&quot;A: &quot;</span> + i));  <span class="hljs-comment">// A: 1, 2, 3</span><br>cold.subscribe(i -&gt; System.out.println(<span class="hljs-string">&quot;B: &quot;</span> + i));  <span class="hljs-comment">// B: 1, 2, 3</span><br><br><span class="hljs-comment">// çƒ­æµï¼šè®¢é˜…è€…å…±äº«æ•°æ®æµ</span><br>Sinks.Many&lt;Integer&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br>Flux&lt;Integer&gt; hot = sink.asFlux();<br><br>hot.subscribe(i -&gt; System.out.println(<span class="hljs-string">&quot;A: &quot;</span> + i));<br>sink.tryEmitNext(<span class="hljs-number">1</span>);  <span class="hljs-comment">// A: 1</span><br>hot.subscribe(i -&gt; System.out.println(<span class="hljs-string">&quot;B: &quot;</span> + i));<br>sink.tryEmitNext(<span class="hljs-number">2</span>);  <span class="hljs-comment">// A: 2, B: 2ï¼ˆB æ²¡æ”¶åˆ° 1ï¼‰</span><br></code></pre></td></tr></table></figure><hr><h2 id="å®æˆ˜ï¼šå¤§æ¨¡å‹æµå¼è°ƒç”¨å®Œæ•´ç¤ºä¾‹"><a href="#å®æˆ˜ï¼šå¤§æ¨¡å‹æµå¼è°ƒç”¨å®Œæ•´ç¤ºä¾‹" class="headerlink" title="å®æˆ˜ï¼šå¤§æ¨¡å‹æµå¼è°ƒç”¨å®Œæ•´ç¤ºä¾‹"></a>å®æˆ˜ï¼šå¤§æ¨¡å‹æµå¼è°ƒç”¨å®Œæ•´ç¤ºä¾‹</h2><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/api/chat&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatController</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebClient webClient;<br>    <br>    <span class="hljs-meta">@GetMapping(produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span><br>    <span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">chat</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String prompt)</span> &#123;<br>        <span class="hljs-keyword">return</span> webClient.post()<br>            .uri(<span class="hljs-string">&quot;https://api.openai.com/v1/chat/completions&quot;</span>)<br>            .header(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;Bearer &quot;</span> + apiKey)<br>            .bodyValue(Map.of(<br>                <span class="hljs-string">&quot;model&quot;</span>, <span class="hljs-string">&quot;gpt-4&quot;</span>,<br>                <span class="hljs-string">&quot;messages&quot;</span>, List.of(Map.of(<span class="hljs-string">&quot;role&quot;</span>, <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>, prompt)),<br>                <span class="hljs-string">&quot;stream&quot;</span>, <span class="hljs-literal">true</span><br>            ))<br>            .retrieve()<br>            .bodyToFlux(String.class)<br>            .filter(line -&gt; !line.equals(<span class="hljs-string">&quot;[DONE]&quot;</span>))<br>            .map(<span class="hljs-built_in">this</span>::extractContent)<br>            .filter(Objects::nonNull)<br>            .doOnNext(chunk -&gt; log.debug(<span class="hljs-string">&quot;å‘é€: &#123;&#125;&quot;</span>, chunk))<br>            .doOnComplete(() -&gt; log.info(<span class="hljs-string">&quot;æµå¼å“åº”å®Œæˆ&quot;</span>))<br>            .doOnError(e -&gt; log.error(<span class="hljs-string">&quot;æµå¼å“åº”é”™è¯¯&quot;</span>, e));<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">extractContent</span><span class="hljs-params">(String line)</span> &#123;<br>        <span class="hljs-comment">// è§£æ SSE æ•°æ®ï¼Œæå–å†…å®¹</span><br>        <span class="hljs-comment">// data: &#123;&quot;choices&quot;:[&#123;&quot;delta&quot;:&#123;&quot;content&quot;:&quot;ä½ å¥½&quot;&#125;&#125;]&#125;</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">JsonNode</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> objectMapper.readTree(line.substring(<span class="hljs-number">6</span>));<br>            <span class="hljs-keyword">return</span> node.at(<span class="hljs-string">&quot;/choices/0/delta/content&quot;</span>).asText(<span class="hljs-literal">null</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å‰ç«¯æ¥æ”¶"><a href="#å‰ç«¯æ¥æ”¶" class="headerlink" title="å‰ç«¯æ¥æ”¶"></a>å‰ç«¯æ¥æ”¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ä½¿ç”¨ EventSource æ¥æ”¶ SSE</span><br><span class="hljs-keyword">const</span> eventSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(<span class="hljs-string">&#x27;/api/chat?prompt=ä½ å¥½&#x27;</span>);<br><br>eventSource.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// é€å­—æ˜¾ç¤º</span><br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;response&#x27;</span>).<span class="hljs-property">textContent</span> += event.<span class="hljs-property">data</span>;<br>&#125;;<br><br>eventSource.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>    eventSource.<span class="hljs-title function_">close</span>();<br>&#125;;<br><br><span class="hljs-comment">// æˆ–è€…ä½¿ç”¨ fetch</span><br><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/api/chat?prompt=ä½ å¥½&#x27;</span>);<br><span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();<br><span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();<br><br><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; done, value &#125; = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();<br>    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">const</span> chunk = decoder.<span class="hljs-title function_">decode</span>(value);<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;response&#x27;</span>).<span class="hljs-property">textContent</span> += chunk;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table><thead><tr><th>æ¦‚å¿µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Flux æ˜¯ç®¡é“</strong></td><td>æ•°æ®æµç»ç®¡é“ï¼Œä¸å­˜å‚¨åœ¨ç®¡é“ä¸­</td></tr><tr><td><strong>æ•°æ®ä½•æ—¶ç¡®å®š</strong></td><td>å–å†³äºä¸Šæ¸¸ï¼Œå¯èƒ½åˆ›å»ºæ—¶ç¡®å®šï¼Œä¹Ÿå¯èƒ½è¿è¡Œæ—¶æ‰çŸ¥é“</td></tr><tr><td><strong>æ•°æ®æ•°é‡</strong></td><td>ç”±ä¸Šæ¸¸å†³å®šï¼Œä¸‹æ¸¸ä¸éœ€è¦æå‰çŸ¥é“</td></tr><tr><td><strong>æµä½•æ—¶ç»“æŸ</strong></td><td>ä¸Šæ¸¸å‘é€ <code>onComplete()</code> æˆ– <code>onError()</code></td></tr><tr><td><strong>æ‡’åŠ è½½</strong></td><td>åˆ›å»º Flux ä¸æ‰§è¡Œï¼Œè®¢é˜…æ—¶æ‰æ‰§è¡Œ</td></tr><tr><td><strong>Sinks çš„ä½œç”¨</strong></td><td>è®©ä½ æˆä¸ºä¸Šæ¸¸ï¼Œä¸»åŠ¨æ¨é€æ•°æ®</td></tr></tbody></table><p><strong>æ ¸å¿ƒç†è§£</strong>ï¼š</p><ul><li>Flux ä¸æ˜¯â€è£…äº†å¤šå°‘æ•°æ®â€ï¼Œè€Œæ˜¯â€æ•°æ®ä»å“ªæ¥ã€å¾€å“ªå»â€</li><li>ä½ ä¸éœ€è¦çŸ¥é“ Flux é‡Œæœ‰å¤šå°‘æ•°æ®ï¼Œåªéœ€è¦å¤„ç†æµè¿‡æ¥çš„æ¯ä¸€ä¸ªæ•°æ®</li><li>è¿™å°±æ˜¯å“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒæ€æƒ³ï¼š<strong>å¯¹æ•°æ®æµåšå‡ºå“åº”</strong></li></ul><hr><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>Sinks è¯¦è§£</li><li>Project Reactor å®ç°</li><li>WebFlux - Reactoræ ¸å¿ƒAPI</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Reactive Streams</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>ReactiveStreams</tag>
      
      <tag>Reactor</tag>
      
      <tag>Flux</tag>
      
      <tag>ç®¡é“</tag>
      
      <tag>æ‡’åŠ è½½</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ForkJoinPool</title>
    <link href="/2026/01/10/ForkJoinPool/"/>
    <url>/2026/01/10/ForkJoinPool/</url>
    
    <content type="html"><![CDATA[<h1 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a>ForkJoinPool</h1><blockquote><p><strong>â„¹ï¸ ä¿¡æ¯: è¡ç”Ÿæ¥æº</strong><br>æœ¬ç¬”è®°è¡ç”Ÿè‡ª çº¿ç¨‹æ± ç±»å‹-WorkStealingPool</p></blockquote><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><code>ForkJoinPool</code> æ˜¯ Java 7 å¼•å…¥çš„ç‰¹æ®Šçº¿ç¨‹æ± ï¼Œä¸“ä¸º<strong>åˆ†æ²»ç®—æ³•</strong>å’Œ<strong>å¹¶è¡Œè®¡ç®—</strong>è®¾è®¡ã€‚å®ƒæ˜¯ <code>ExecutorService</code> çš„å®ç°ï¼Œä½†é‡‡ç”¨äº†å®Œå…¨ä¸åŒçš„ä»»åŠ¡è°ƒåº¦ç­–ç•¥ã€‚</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="hljs-attribute">â”‚                        ForkJoinPool                            â”‚</span><br><span class="hljs-attribute">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="hljs-attribute">â”‚  æ ¸å¿ƒæ€æƒ³</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Forkï¼ˆæ‹†åˆ†ï¼‰ + Joinï¼ˆåˆå¹¶ï¼‰                          â”‚</span><br><span class="hljs-attribute">â”‚  è°ƒåº¦ç­–ç•¥</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Work-Stealingï¼ˆå·¥ä½œçªƒå–ï¼‰                            â”‚</span><br><span class="hljs-attribute">â”‚  é€‚ç”¨åœºæ™¯</span><span class="hljs-punctuation">:</span> <span class="hljs-string">é€’å½’ä»»åŠ¡ã€å¹¶è¡Œè®¡ç®—ã€åˆ†æ²»ç®—æ³•                          â”‚</span><br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><hr><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="Fork-ä¸-Join"><a href="#Fork-ä¸-Join" class="headerlink" title="Fork ä¸ Join"></a>Fork ä¸ Join</h3><table><thead><tr><th>æ“ä½œ</th><th>è¯´æ˜</th><th>æ–¹æ³•</th></tr></thead><tbody><tr><td><strong>Fork</strong></td><td>å°†å¤§ä»»åŠ¡æ‹†åˆ†æˆå°ä»»åŠ¡ï¼Œå¼‚æ­¥æ‰§è¡Œ</td><td><code>task.fork()</code></td></tr><tr><td><strong>Join</strong></td><td>ç­‰å¾…å­ä»»åŠ¡å®Œæˆï¼Œè·å–ç»“æœ</td><td><code>task.join()</code></td></tr></tbody></table><h3 id="åˆ†æ²»æ€æƒ³å›¾è§£"><a href="#åˆ†æ²»æ€æƒ³å›¾è§£" class="headerlink" title="åˆ†æ²»æ€æƒ³å›¾è§£"></a>åˆ†æ²»æ€æƒ³å›¾è§£</h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs perl">            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>            â”‚   å¤§ä»»åŠ¡    â”‚<br>            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜<br>                   â”‚ <span class="hljs-keyword">fork</span><br>      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>      â–¼            â–¼            â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ å­ä»»åŠ¡<span class="hljs-number">1</span> â”‚  â”‚ å­ä»»åŠ¡<span class="hljs-number">2</span> â”‚  â”‚ å­ä»»åŠ¡<span class="hljs-number">3</span> â”‚<br>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜<br>     â”‚            â”‚            â”‚<br>     â–¼            â–¼            â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ ç»“æœ<span class="hljs-number">1</span>   â”‚  â”‚ ç»“æœ<span class="hljs-number">2</span>   â”‚  â”‚ ç»“æœ<span class="hljs-number">3</span>   â”‚<br>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜<br>     â”‚            â”‚            â”‚<br>     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                  â”‚ <span class="hljs-keyword">join</span><br>            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”<br>            â”‚  åˆå¹¶ç»“æœ  â”‚<br>            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><hr><h2 id="å·¥ä½œçªƒå–ç®—æ³•ï¼ˆWork-Stealingï¼‰"><a href="#å·¥ä½œçªƒå–ç®—æ³•ï¼ˆWork-Stealingï¼‰" class="headerlink" title="å·¥ä½œçªƒå–ç®—æ³•ï¼ˆWork-Stealingï¼‰"></a>å·¥ä½œçªƒå–ç®—æ³•ï¼ˆWork-Stealingï¼‰</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æ¯ä¸ªå·¥ä½œçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ª<strong>åŒç«¯é˜Ÿåˆ—ï¼ˆDequeï¼‰</strong>ï¼š</p><ul><li><strong>è‡ªå·±çš„ä»»åŠ¡</strong>ï¼šä»é˜Ÿåˆ—<strong>å¤´éƒ¨</strong>å–ï¼ˆLIFOï¼‰</li><li><strong>çªƒå–ä»–äººä»»åŠ¡</strong>ï¼šä»é˜Ÿåˆ—<strong>å°¾éƒ¨</strong>å–ï¼ˆFIFOï¼‰</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                     ForkJoinPool                                â”‚<br>â”‚                                                                 â”‚<br>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚<br>â”‚  â”‚  Worker-<span class="hljs-number">1</span>   â”‚    â”‚  Worker-<span class="hljs-number">2</span>   â”‚    â”‚  Worker-<span class="hljs-number">3</span>   â”‚         â”‚<br>â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚<br>â”‚  â”‚ å¤´ <span class="hljs-selector-attr">[T1]</span>     â”‚    â”‚ å¤´ <span class="hljs-selector-attr">[T4]</span>     â”‚    â”‚ å¤´ <span class="hljs-selector-attr">[ç©ºé—²]</span>   â”‚         â”‚<br>â”‚  â”‚    <span class="hljs-selector-attr">[T2]</span>     â”‚    â”‚    <span class="hljs-selector-attr">[T5]</span>     â”‚    â”‚             â”‚         â”‚<br>â”‚  â”‚    <span class="hljs-selector-attr">[T3]</span>     â”‚    â”‚             â”‚    â”‚             â”‚         â”‚<br>â”‚  â”‚ å°¾          â”‚    â”‚ å°¾          â”‚    â”‚ å°¾    â†‘     â”‚         â”‚<br>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜         â”‚<br>â”‚         â”‚                  â”‚                  â”‚                â”‚<br>â”‚         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚<br>â”‚         â”‚                    Worker-<span class="hljs-number">3</span> ä» Worker-<span class="hljs-number">2</span> å°¾éƒ¨çªƒå– T5   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="ä¸ºä»€ä¹ˆä»å°¾éƒ¨çªƒå–ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä»å°¾éƒ¨çªƒå–ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä»å°¾éƒ¨çªƒå–ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä»å°¾éƒ¨çªƒå–ï¼Ÿ</h3><table><thead><tr><th>åŸå› </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å‡å°‘ç«äº‰</strong></td><td>å·¥ä½œçº¿ç¨‹ä»å¤´éƒ¨å–ï¼Œçªƒå–ä»å°¾éƒ¨ï¼Œé¿å…é”äº‰ç”¨</td></tr><tr><td><strong>ä»»åŠ¡ç‰¹æ€§</strong></td><td>å°¾éƒ¨é€šå¸¸æ˜¯è¾ƒå¤§çš„ä»»åŠ¡ï¼ˆåˆš fork å‡ºæ¥çš„ï¼‰ï¼Œçªƒå–åå¯ç»§ç»­æ‹†åˆ†</td></tr><tr><td><strong>å±€éƒ¨æ€§</strong></td><td>å¤´éƒ¨ä»»åŠ¡æ˜¯æœ€è¿‘æäº¤çš„ï¼Œç¼“å­˜å‹å¥½</td></tr></tbody></table><hr><h2 id="æ ¸å¿ƒç±»ç»“æ„"><a href="#æ ¸å¿ƒç±»ç»“æ„" class="headerlink" title="æ ¸å¿ƒç±»ç»“æ„"></a>æ ¸å¿ƒç±»ç»“æ„</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚          ForkJoinTask&lt;V&gt;              â”‚  æŠ½è±¡åŸºç±»<br>â”‚  â”œâ”€â”€ <span class="hljs-built_in">fork</span>()    å¼‚æ­¥æ‰§è¡Œ               â”‚<br>â”‚  â”œâ”€â”€ <span class="hljs-built_in">join</span>()    ç­‰å¾…ç»“æœ               â”‚<br>â”‚  â””â”€â”€ <span class="hljs-built_in">invoke</span>()  åŒæ­¥æ‰§è¡Œ               â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                â”‚<br>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”<br>        â–¼               â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚RecursiveTask  â”‚ â”‚ RecursiveAction â”‚<br>â”‚   &lt;V&gt;         â”‚ â”‚                 â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚ æœ‰è¿”å›å€¼      â”‚ â”‚ æ— è¿”å›å€¼        â”‚<br>â”‚ <span class="hljs-built_in">compute</span>()â†’V   â”‚ â”‚ <span class="hljs-built_in">compute</span>()â†’void  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><hr><h2 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h2><h3 id="1-RecursiveTaskï¼šæœ‰è¿”å›å€¼ï¼ˆæ•°ç»„æ±‚å’Œï¼‰"><a href="#1-RecursiveTaskï¼šæœ‰è¿”å›å€¼ï¼ˆæ•°ç»„æ±‚å’Œï¼‰" class="headerlink" title="1. RecursiveTaskï¼šæœ‰è¿”å›å€¼ï¼ˆæ•°ç»„æ±‚å’Œï¼‰"></a>1. RecursiveTaskï¼šæœ‰è¿”å›å€¼ï¼ˆæ•°ç»„æ±‚å’Œï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SumTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecursiveTask</span>&lt;Long&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;  <span class="hljs-comment">// é˜ˆå€¼</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span>[] array;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> start;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> end;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SumTask</span><span class="hljs-params">(<span class="hljs-type">long</span>[] array, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> &#123;<br>        <span class="hljs-built_in">this</span>.array = array;<br>        <span class="hljs-built_in">this</span>.start = start;<br>        <span class="hljs-built_in">this</span>.end = end;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Long <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> end - start;<br>        <br>        <span class="hljs-comment">// ä»»åŠ¡è¶³å¤Ÿå°ï¼Œç›´æ¥è®¡ç®—</span><br>        <span class="hljs-keyword">if</span> (length &lt;= THRESHOLD) &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) &#123;<br>                sum += array[i];<br>            &#125;<br>            <span class="hljs-keyword">return</span> sum;<br>        &#125;<br>        <br>        <span class="hljs-comment">// æ‹†åˆ†ä»»åŠ¡</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> start + length / <span class="hljs-number">2</span>;<br>        <span class="hljs-type">SumTask</span> <span class="hljs-variable">leftTask</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SumTask</span>(array, start, mid);<br>        <span class="hljs-type">SumTask</span> <span class="hljs-variable">rightTask</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SumTask</span>(array, mid, end);<br>        <br>        <span class="hljs-comment">// å¼‚æ­¥æ‰§è¡Œå·¦åŠéƒ¨åˆ†</span><br>        leftTask.fork();<br>        <br>        <span class="hljs-comment">// åŒæ­¥æ‰§è¡Œå³åŠéƒ¨åˆ†ï¼ˆå½“å‰çº¿ç¨‹ï¼‰</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">rightResult</span> <span class="hljs-operator">=</span> rightTask.compute();<br>        <br>        <span class="hljs-comment">// ç­‰å¾…å·¦åŠéƒ¨åˆ†å®Œæˆå¹¶åˆå¹¶ç»“æœ</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">leftResult</span> <span class="hljs-operator">=</span> leftTask.join();<br>        <br>        <span class="hljs-keyword">return</span> leftResult + rightResult;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ä½¿ç”¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">long</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">long</span>[<span class="hljs-number">10000000</span>];<br>    Arrays.fill(array, <span class="hljs-number">1</span>);<br>    <br>    <span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ForkJoinPool.commonPool();<br>    <span class="hljs-type">SumTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SumTask</span>(array, <span class="hljs-number">0</span>, array.length);<br>    <br>    <span class="hljs-type">long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> pool.invoke(task);  <span class="hljs-comment">// åŒæ­¥æ‰§è¡Œ</span><br>    System.out.println(<span class="hljs-string">&quot;Sum: &quot;</span> + result);  <span class="hljs-comment">// è¾“å‡º: Sum: 10000000</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-RecursiveActionï¼šæ— è¿”å›å€¼ï¼ˆå¹¶è¡Œæ’åºï¼‰"><a href="#2-RecursiveActionï¼šæ— è¿”å›å€¼ï¼ˆå¹¶è¡Œæ’åºï¼‰" class="headerlink" title="2. RecursiveActionï¼šæ— è¿”å›å€¼ï¼ˆå¹¶è¡Œæ’åºï¼‰"></a>2. RecursiveActionï¼šæ— è¿”å›å€¼ï¼ˆå¹¶è¡Œæ’åºï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParallelMergeSort</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecursiveAction</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">1024</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] array;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> start;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> end;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ParallelMergeSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> &#123;<br>        <span class="hljs-built_in">this</span>.array = array;<br>        <span class="hljs-built_in">this</span>.start = start;<br>        <span class="hljs-built_in">this</span>.end = end;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (end - start &lt;= THRESHOLD) &#123;<br>            <span class="hljs-comment">// å°æ•°ç»„ç›´æ¥ç”¨ Arrays.sort</span><br>            Arrays.sort(array, start, end);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <br>        <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> (start + end) / <span class="hljs-number">2</span>;<br>        <br>        <span class="hljs-comment">// å¹¶è¡Œæ’åºä¸¤åŠ</span><br>        <span class="hljs-type">ParallelMergeSort</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParallelMergeSort</span>(array, start, mid);<br>        <span class="hljs-type">ParallelMergeSort</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParallelMergeSort</span>(array, mid, end);<br>        <br>        invokeAll(left, right);  <span class="hljs-comment">// å¹¶è¡Œæ‰§è¡Œä¸¤ä¸ªä»»åŠ¡</span><br>        <br>        <span class="hljs-comment">// åˆå¹¶å·²æ’åºçš„ä¸¤åŠ</span><br>        merge(array, start, mid, end);<br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">merge</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> mid, <span class="hljs-type">int</span> end)</span> &#123;<br>        <span class="hljs-comment">// åˆå¹¶é€»è¾‘...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="ForkJoinPool-åˆ›å»ºæ–¹å¼"><a href="#ForkJoinPool-åˆ›å»ºæ–¹å¼" class="headerlink" title="ForkJoinPool åˆ›å»ºæ–¹å¼"></a>ForkJoinPool åˆ›å»ºæ–¹å¼</h2><h3 id="1-å…¬å…±æ± ï¼ˆæ¨èï¼‰"><a href="#1-å…¬å…±æ± ï¼ˆæ¨èï¼‰" class="headerlink" title="1. å…¬å…±æ± ï¼ˆæ¨èï¼‰"></a>1. å…¬å…±æ± ï¼ˆæ¨èï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å–å…¬å…±æ± ï¼ˆJVM å…±äº«ï¼Œçº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° - 1ï¼‰</span><br><span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">commonPool</span> <span class="hljs-operator">=</span> ForkJoinPool.commonPool();<br><br><span class="hljs-comment">// ç›´æ¥ä½¿ç”¨</span><br><span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> commonPool.invoke(task);<br></code></pre></td></tr></table></figure><h3 id="2-è‡ªå®šä¹‰æ± "><a href="#2-è‡ªå®šä¹‰æ± " class="headerlink" title="2. è‡ªå®šä¹‰æ± "></a>2. è‡ªå®šä¹‰æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è‡ªå®šä¹‰çº¿ç¨‹æ•°</span><br><span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">customPool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>(<span class="hljs-number">4</span>);<br><br><span class="hljs-comment">// å®Œæ•´æ„é€ å‡½æ•°</span><br><span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>(<br>    <span class="hljs-number">4</span>,                                    <span class="hljs-comment">// å¹¶è¡Œåº¦</span><br>    ForkJoinPool.defaultForkJoinWorkerThreadFactory,  <span class="hljs-comment">// çº¿ç¨‹å·¥å‚</span><br>    <span class="hljs-literal">null</span>,                                 <span class="hljs-comment">// å¼‚å¸¸å¤„ç†å™¨</span><br>    <span class="hljs-literal">true</span>                                  <span class="hljs-comment">// asyncModeï¼ˆtrue=FIFOï¼Œfalse=LIFOï¼‰</span><br>);<br></code></pre></td></tr></table></figure><h3 id="3-é€šè¿‡-Executors-å·¥å‚"><a href="#3-é€šè¿‡-Executors-å·¥å‚" class="headerlink" title="3. é€šè¿‡ Executors å·¥å‚"></a>3. é€šè¿‡ Executors å·¥å‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Java 8+ WorkStealingPool åº•å±‚å°±æ˜¯ ForkJoinPool</span><br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newWorkStealingPool();<br></code></pre></td></tr></table></figure><hr><h2 id="æäº¤ä»»åŠ¡çš„æ–¹å¼"><a href="#æäº¤ä»»åŠ¡çš„æ–¹å¼" class="headerlink" title="æäº¤ä»»åŠ¡çš„æ–¹å¼"></a>æäº¤ä»»åŠ¡çš„æ–¹å¼</h2><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td><code>invoke(task)</code></td><td>åŒæ­¥æ‰§è¡Œï¼Œé˜»å¡ç›´åˆ°å®Œæˆ</td><td>ä»»åŠ¡ç»“æœ</td></tr><tr><td><code>execute(task)</code></td><td>å¼‚æ­¥æ‰§è¡Œï¼Œä¸ç­‰å¾…ç»“æœ</td><td>void</td></tr><tr><td><code>submit(task)</code></td><td>å¼‚æ­¥æ‰§è¡Œï¼Œè¿”å› Future</td><td><code>ForkJoinTask&lt;V&gt;</code></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ForkJoinPool.commonPool();<br><span class="hljs-type">SumTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SumTask</span>(array, <span class="hljs-number">0</span>, array.length);<br><br><span class="hljs-comment">// æ–¹å¼1ï¼šåŒæ­¥</span><br><span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> pool.invoke(task);<br><br><span class="hljs-comment">// æ–¹å¼2ï¼šå¼‚æ­¥æäº¤</span><br>ForkJoinTask&lt;Long&gt; future = pool.submit(task);<br><span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> future.get();  <span class="hljs-comment">// é˜»å¡ç­‰å¾…</span><br><br><span class="hljs-comment">// æ–¹å¼3ï¼šå¼‚æ­¥æ‰§è¡Œï¼ˆä¸å…³å¿ƒç»“æœï¼‰</span><br>pool.execute(task);<br></code></pre></td></tr></table></figure><hr><h2 id="ä¸æ™®é€šçº¿ç¨‹æ± å¯¹æ¯”"><a href="#ä¸æ™®é€šçº¿ç¨‹æ± å¯¹æ¯”" class="headerlink" title="ä¸æ™®é€šçº¿ç¨‹æ± å¯¹æ¯”"></a>ä¸æ™®é€šçº¿ç¨‹æ± å¯¹æ¯”</h2><table><thead><tr><th>ç‰¹æ€§</th><th>ThreadPoolExecutor</th><th>ForkJoinPool</th></tr></thead><tbody><tr><td><strong>ä»»åŠ¡é˜Ÿåˆ—</strong></td><td>å…±äº«é˜Ÿåˆ—ï¼ˆå•ä¸€ï¼‰</td><td>æ¯çº¿ç¨‹ç‹¬ç«‹åŒç«¯é˜Ÿåˆ—</td></tr><tr><td><strong>è°ƒåº¦ç­–ç•¥</strong></td><td>å…ˆè¿›å…ˆå‡º</td><td>å·¥ä½œçªƒå–</td></tr><tr><td><strong>é€‚ç”¨ä»»åŠ¡</strong></td><td>ç‹¬ç«‹ä»»åŠ¡</td><td>å¯æ‹†åˆ†çš„é€’å½’ä»»åŠ¡</td></tr><tr><td><strong>è´Ÿè½½å‡è¡¡</strong></td><td>ä¾èµ–é˜Ÿåˆ—è°ƒåº¦</td><td>å·¥ä½œçªƒå–è‡ªåŠ¨å‡è¡¡</td></tr><tr><td><strong>CPU åˆ©ç”¨</strong></td><td>å¯èƒ½æœ‰çº¿ç¨‹ç©ºé—²</td><td>æ›´é«˜æ•ˆï¼ˆå‡å°‘ç©ºé—²ï¼‰</td></tr><tr><td><strong>ä»»åŠ¡ç²’åº¦</strong></td><td>ä»»æ„</td><td>é€‚åˆå¯æ‹†åˆ†ä»»åŠ¡</td></tr></tbody></table><hr><h2 id="å®é™…åº”ç”¨åœºæ™¯"><a href="#å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…åº”ç”¨åœºæ™¯"></a>å®é™…åº”ç”¨åœºæ™¯</h2><h3 id="1-Java-8-å¹¶è¡Œæµ"><a href="#1-Java-8-å¹¶è¡Œæµ" class="headerlink" title="1. Java 8 å¹¶è¡Œæµ"></a>1. Java 8 å¹¶è¡Œæµ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// parallelStream() åº•å±‚ä½¿ç”¨ ForkJoinPool.commonPool()</span><br>List&lt;Integer&gt; numbers = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>);<br><br><span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> numbers.parallelStream()<br>                 .mapToInt(Integer::intValue)<br>                 .sum();<br></code></pre></td></tr></table></figure><h3 id="2-CompletableFuture-é»˜è®¤æ‰§è¡Œå™¨"><a href="#2-CompletableFuture-é»˜è®¤æ‰§è¡Œå™¨" class="headerlink" title="2. CompletableFuture é»˜è®¤æ‰§è¡Œå™¨"></a>2. CompletableFuture é»˜è®¤æ‰§è¡Œå™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é»˜è®¤ä½¿ç”¨ ForkJoinPool.commonPool()</span><br>CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="3-å¤§æ•°æ®å¤„ç†"><a href="#3-å¤§æ•°æ®å¤„ç†" class="headerlink" title="3. å¤§æ•°æ®å¤„ç†"></a>3. å¤§æ•°æ®å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¹¶è¡Œå¤„ç†å¤§é‡æ•°æ®</span><br>Arrays.parallelSort(largeArray);<br>Arrays.parallelSetAll(array, i -&gt; i * <span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure><hr><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><h3 id="1-é˜ˆå€¼è®¾ç½®"><a href="#1-é˜ˆå€¼è®¾ç½®" class="headerlink" title="1. é˜ˆå€¼è®¾ç½®"></a>1. é˜ˆå€¼è®¾ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é˜ˆå€¼å¤ªå°ï¼šæ‹†åˆ†å¼€é”€ &gt; å¹¶è¡Œæ”¶ç›Š</span><br><span class="hljs-comment">// é˜ˆå€¼å¤ªå¤§ï¼šæ— æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸</span><br><span class="hljs-comment">// ç»éªŒå€¼ï¼šæ ¹æ®ä»»åŠ¡å¤æ‚åº¦å’Œæ•°æ®é‡æµ‹è¯•ç¡®å®š</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;  <span class="hljs-comment">// éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</span><br></code></pre></td></tr></table></figure><h3 id="2-é¿å…é˜»å¡æ“ä½œ"><a href="#2-é¿å…é˜»å¡æ“ä½œ" class="headerlink" title="2. é¿å…é˜»å¡æ“ä½œ"></a>2. é¿å…é˜»å¡æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šåœ¨ ForkJoinPool ä¸­æ‰§è¡Œé˜»å¡ IO</span><br><span class="hljs-keyword">protected</span> Long <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ä¸è¦åœ¨è¿™é‡Œåš IO æ“ä½œï¼</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> httpClient.get(url);  <span class="hljs-comment">// é˜»å¡ï¼Œæµªè´¹çº¿ç¨‹</span><br>    <span class="hljs-keyword">return</span> process(data);<br>&#125;<br><br><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šForkJoinPool åªç”¨äº CPU è®¡ç®—</span><br><span class="hljs-comment">// IO æ“ä½œä½¿ç”¨å…¶ä»–çº¿ç¨‹æ± </span><br></code></pre></td></tr></table></figure><h3 id="3-å…¬å…±æ± çš„é£é™©"><a href="#3-å…¬å…±æ± çš„é£é™©" class="headerlink" title="3. å…¬å…±æ± çš„é£é™©"></a>3. å…¬å…±æ± çš„é£é™©</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ‰€æœ‰å¹¶è¡Œæµå…±äº« commonPool</span><br><span class="hljs-comment">// å¦‚æœæŸä¸ªä»»åŠ¡é˜»å¡ï¼Œä¼šå½±å“å…¶ä»–ä»»åŠ¡</span><br><br><span class="hljs-comment">// è§£å†³æ–¹æ¡ˆï¼šä¸ºå…³é”®ä»»åŠ¡åˆ›å»ºç‹¬ç«‹çš„ ForkJoinPool</span><br><span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">customPool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>(<span class="hljs-number">8</span>);<br>customPool.submit(() -&gt; &#123;<br>    <span class="hljs-comment">// ç‹¬ç«‹æ‰§è¡Œï¼Œä¸å½±å“ commonPool</span><br>    myParallelStream.forEach(...);<br>&#125;).get();<br></code></pre></td></tr></table></figure><hr><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li><strong>ä¸Šä¸€ç¯‡</strong>ï¼š03-çº¿ç¨‹æ± ç±»å‹</li><li><strong>çº¿ç¨‹æ± åŸç†</strong>ï¼š02-çº¿ç¨‹æ± åŸç†</li><li><strong>çº¿ç¨‹æ± ç®€ä»‹</strong>ï¼š01-çº¿ç¨‹æ± ç®€ä»‹</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>å¹¶å‘ç¼–ç¨‹</category>
      
      <category>çº¿ç¨‹æ± </category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>å¹¶å‘ç¼–ç¨‹</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
      <tag>ForkJoinPool</tag>
      
      <tag>åˆ†æ²»ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaå¼•ç”¨ç±»å‹</title>
    <link href="/2026/01/10/Java%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/"/>
    <url>/2026/01/10/Java%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Java-å¼•ç”¨ç±»å‹"><a href="#Java-å¼•ç”¨ç±»å‹" class="headerlink" title="Java å¼•ç”¨ç±»å‹"></a>Java å¼•ç”¨ç±»å‹</h1><blockquote><p><strong>â„¹ï¸ ä¿¡æ¯: è¡ç”Ÿæ¥æº</strong><br>æœ¬ç¬”è®°è¡ç”Ÿè‡ª ThreadLocalåŸç†-å¼±å¼•ç”¨è®¾è®¡</p></blockquote><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Java ä» JDK 1.2 å¼€å§‹æä¾›äº†å››ç§å¼•ç”¨ç±»å‹ï¼Œç”¨äºæ›´çµæ´»åœ°æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œåƒåœ¾å›æ”¶è¡Œä¸ºã€‚</p><h2 id="å››ç§å¼•ç”¨ç±»å‹"><a href="#å››ç§å¼•ç”¨ç±»å‹" class="headerlink" title="å››ç§å¼•ç”¨ç±»å‹"></a>å››ç§å¼•ç”¨ç±»å‹</h2><table><thead><tr><th>å¼•ç”¨ç±»å‹</th><th>ç±»</th><th>GC å›æ”¶æ—¶æœº</th><th>æ˜¯å¦å¯è·å–å¯¹è±¡</th></tr></thead><tbody><tr><td><strong>å¼ºå¼•ç”¨</strong></td><td>ç›´æ¥å¼•ç”¨</td><td>æ°¸ä¸å›æ”¶ï¼ˆé™¤éä¸å¯è¾¾ï¼‰</td><td>æ˜¯</td></tr><tr><td><strong>è½¯å¼•ç”¨</strong></td><td><code>SoftReference</code></td><td>å†…å­˜ä¸è¶³æ—¶å›æ”¶</td><td>æ˜¯ï¼ˆæœªå›æ”¶å‰ï¼‰</td></tr><tr><td><strong>å¼±å¼•ç”¨</strong></td><td><code>WeakReference</code></td><td>ä¸‹æ¬¡ GC æ—¶å›æ”¶</td><td>æ˜¯ï¼ˆæœªå›æ”¶å‰ï¼‰</td></tr><tr><td><strong>è™šå¼•ç”¨</strong></td><td><code>PhantomReference</code></td><td>éšæ—¶å¯èƒ½å›æ”¶</td><td>å¦</td></tr></tbody></table><p>^ref-types</p><pre><code class=" mermaid">graph TD    A[å¼•ç”¨å¼ºåº¦] --&gt; B[å¼ºå¼•ç”¨ Strong]    B --&gt; C[è½¯å¼•ç”¨ Soft]    C --&gt; D[å¼±å¼•ç”¨ Weak]    D --&gt; E[è™šå¼•ç”¨ Phantom]        style B fill:#ff6b6b    style C fill:#feca57    style D fill:#48dbfb    style E fill:#c8d6e5</code></pre><h2 id="è¯¦ç»†è¯´æ˜"><a href="#è¯¦ç»†è¯´æ˜" class="headerlink" title="è¯¦ç»†è¯´æ˜"></a>è¯¦ç»†è¯´æ˜</h2><h3 id="1-å¼ºå¼•ç”¨ï¼ˆStrong-Referenceï¼‰"><a href="#1-å¼ºå¼•ç”¨ï¼ˆStrong-Referenceï¼‰" class="headerlink" title="1. å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰"></a>1. å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</h3><p>æœ€å¸¸è§çš„å¼•ç”¨ç±»å‹ï¼Œåªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢« GC å›æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¼ºå¼•ç”¨</span><br>obj = <span class="hljs-literal">null</span>;                 <span class="hljs-comment">// æ–­å¼€å¼•ç”¨åæ‰å¯èƒ½è¢«å›æ”¶</span><br></code></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>é»˜è®¤çš„å¼•ç”¨ç±»å‹</li><li>å³ä½¿ OOM ä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨å¯¹è±¡</li><li>éœ€è¦æ‰‹åŠ¨ç½® null æ‰èƒ½è®© GC å›æ”¶</li></ul><h3 id="2-è½¯å¼•ç”¨ï¼ˆSoft-Referenceï¼‰"><a href="#2-è½¯å¼•ç”¨ï¼ˆSoft-Referenceï¼‰" class="headerlink" title="2. è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰"></a>2. è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</h3><p>å†…å­˜å……è¶³æ—¶ä¸ä¼šå›æ”¶ï¼Œå†…å­˜ä¸è¶³æ—¶ä¼šè¢«å›æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">SoftReference&lt;<span class="hljs-type">byte</span>[]&gt; softRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SoftReference</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>]);<br><br><span class="hljs-type">byte</span>[] data = softRef.get();  <span class="hljs-comment">// è·å–å¯¹è±¡ï¼Œå¯èƒ½ä¸º null</span><br><span class="hljs-keyword">if</span> (data == <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// å¯¹è±¡å·²è¢«å›æ”¶ï¼Œéœ€è¦é‡æ–°åˆ›å»º</span><br>    data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ç¼“å­˜</strong></td><td>å›¾ç‰‡ç¼“å­˜ã€ç½‘é¡µç¼“å­˜</td></tr><tr><td><strong>å†…å­˜æ•æ„Ÿæ•°æ®</strong></td><td>å¯é‡å»ºçš„å¤§å¯¹è±¡</td></tr></tbody></table><h3 id="3-å¼±å¼•ç”¨ï¼ˆWeak-Referenceï¼‰"><a href="#3-å¼±å¼•ç”¨ï¼ˆWeak-Referenceï¼‰" class="headerlink" title="3. å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰"></a>3. å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</h3><p>åªè¦å‘ç”Ÿ GCï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šè¢«å›æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">WeakReference&lt;Object&gt; weakRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());<br><br><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> weakRef.get();  <span class="hljs-comment">// å¯èƒ½è¿”å› null</span><br><span class="hljs-keyword">if</span> (obj == <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// å¯¹è±¡å·²è¢« GC å›æ”¶</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¼±å¼•ç”¨è§£å†³çš„é—®é¢˜</strong>ï¼š</p><blockquote><p><strong>âš ï¸ é‡è¦: æ ¸å¿ƒä»·å€¼</strong><br>å¼±å¼•ç”¨å…è®¸å¯¹è±¡åœ¨æ²¡æœ‰å…¶ä»–å¼ºå¼•ç”¨æ—¶è¢« GC å›æ”¶ï¼Œ<strong>é¿å…å†…å­˜æ³„æ¼</strong>ã€‚</p></blockquote><p>ä»¥ ThreadLocal ä¸ºä¾‹ï¼š</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gauss">ThreadLocalMap.Entry çš„ <span class="hljs-built_in">key</span> ä½¿ç”¨å¼±å¼•ç”¨<br><br>åœºæ™¯ï¼šThreadLocal å˜é‡ä¸å†ä½¿ç”¨<br>â”œâ”€â”€ å¦‚æœ <span class="hljs-built_in">key</span> æ˜¯å¼ºå¼•ç”¨ â†’ ThreadLocal å¯¹è±¡æ— æ³•å›æ”¶ â†’ å†…å­˜æ³„æ¼<br>â””â”€â”€ å¦‚æœ <span class="hljs-built_in">key</span> æ˜¯å¼±å¼•ç”¨ â†’ ThreadLocal å¯¹è±¡å¯è¢« GC å›æ”¶ â†’ é¿å…æ³„æ¼<br></code></pre></td></tr></table></figure><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>ThreadLocalMap</strong></td><td>Entry çš„ key ä½¿ç”¨å¼±å¼•ç”¨</td></tr><tr><td><strong>WeakHashMap</strong></td><td>key è¢«å›æ”¶åè‡ªåŠ¨ç§»é™¤ entry</td></tr><tr><td><strong>ç›‘å¬å™¨&#x2F;å›è°ƒ</strong></td><td>é¿å…å› æ³¨å†Œç›‘å¬å™¨å¯¼è‡´å¯¹è±¡æ— æ³•å›æ”¶</td></tr></tbody></table><h3 id="4-è™šå¼•ç”¨ï¼ˆPhantom-Referenceï¼‰"><a href="#4-è™šå¼•ç”¨ï¼ˆPhantom-Referenceï¼‰" class="headerlink" title="4. è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰"></a>4. è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</h3><p>æœ€å¼±çš„å¼•ç”¨ï¼Œæ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–å¯¹è±¡ï¼Œä¸»è¦ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«å›æ”¶çš„çŠ¶æ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">ReferenceQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceQueue</span>&lt;&gt;();<br>PhantomReference&lt;Object&gt; phantomRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhantomReference</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>(), queue);<br><br><span class="hljs-comment">// get() æ°¸è¿œè¿”å› null</span><br><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> phantomRef.get();  <span class="hljs-comment">// null</span><br><br><span class="hljs-comment">// å¯¹è±¡è¢«å›æ”¶åï¼Œè™šå¼•ç”¨ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—</span><br>Reference&lt;?&gt; ref = queue.poll();<br><span class="hljs-keyword">if</span> (ref != <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// å¯¹è±¡å·²è¢«å›æ”¶ï¼Œæ‰§è¡Œæ¸…ç†æ“ä½œ</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>èµ„æºæ¸…ç†</strong></td><td>æ›¿ä»£ finalize() è¿›è¡Œèµ„æºé‡Šæ”¾</td></tr><tr><td><strong>å †å¤–å†…å­˜ç®¡ç†</strong></td><td>DirectByteBuffer çš„ Cleaner æœºåˆ¶</td></tr><tr><td><strong>å¯¹è±¡å›æ”¶ç›‘æ§</strong></td><td>è·Ÿè¸ªå¯¹è±¡ä½•æ—¶è¢« GC å›æ”¶</td></tr></tbody></table><h2 id="å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰"><a href="#å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰" class="headerlink" title="å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰"></a>å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰</h2><p>è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨éƒ½å¯ä»¥å…³è”å¼•ç”¨é˜Ÿåˆ—ï¼Œå½“å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œå¼•ç”¨å¯¹è±¡ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">ReferenceQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceQueue</span>&lt;&gt;();<br>WeakReference&lt;Object&gt; weakRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>(), queue);<br><br><span class="hljs-comment">// GC åæ£€æŸ¥é˜Ÿåˆ—</span><br>System.gc();<br>Reference&lt;?&gt; ref = queue.poll();<br><span class="hljs-keyword">if</span> (ref == weakRef) &#123;<br>    <span class="hljs-comment">// å¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡å·²è¢«å›æ”¶</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¯¹æ¯”æ€»ç»“"><a href="#å¯¹æ¯”æ€»ç»“" class="headerlink" title="å¯¹æ¯”æ€»ç»“"></a>å¯¹æ¯”æ€»ç»“</h2><table><thead><tr><th>ç‰¹æ€§</th><th>å¼ºå¼•ç”¨</th><th>è½¯å¼•ç”¨</th><th>å¼±å¼•ç”¨</th><th>è™šå¼•ç”¨</th></tr></thead><tbody><tr><td><strong>å›æ”¶æ—¶æœº</strong></td><td>ä¸å¯è¾¾æ—¶</td><td>å†…å­˜ä¸è¶³æ—¶</td><td>GC æ—¶</td><td>éšæ—¶</td></tr><tr><td><strong>get() è¿”å›</strong></td><td>å¯¹è±¡</td><td>å¯¹è±¡&#x2F;null</td><td>å¯¹è±¡&#x2F;null</td><td>null</td></tr><tr><td><strong>å…¸å‹ç”¨é€”</strong></td><td>æ™®é€šå¯¹è±¡</td><td>ç¼“å­˜</td><td>é¿å…å†…å­˜æ³„æ¼</td><td>å›æ”¶è·Ÿè¸ª</td></tr><tr><td><strong>æ˜¯å¦éœ€è¦é˜Ÿåˆ—</strong></td><td>-</td><td>å¯é€‰</td><td>å¯é€‰</td><td>å¿…é¡»</td></tr></tbody></table><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>Java&#x2F;å¹¶å‘ç¼–ç¨‹&#x2F;åŸºç¡€çŸ¥è¯†&#x2F;ThreadLocalåŸç† - è¡ç”Ÿæ¥æºï¼Œå¼±å¼•ç”¨çš„å…¸å‹åº”ç”¨</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>å¹¶å‘ç¼–ç¨‹</category>
      
      <category>åŸºç¡€çŸ¥è¯†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>å¼•ç”¨ç±»å‹</tag>
      
      <tag>GC</tag>
      
      <tag>å†…å­˜ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Project Reactorå®ç°</title>
    <link href="/2026/01/10/Project%20Reactor%E5%AE%9E%E7%8E%B0/"/>
    <url>/2026/01/10/Project%20Reactor%E5%AE%9E%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Project-Reactor-å®ç°"><a href="#Project-Reactor-å®ç°" class="headerlink" title="Project Reactor å®ç°"></a>Project Reactor å®ç°</h1><h2 id="Project-Reactor-ç®€ä»‹"><a href="#Project-Reactor-ç®€ä»‹" class="headerlink" title="Project Reactor ç®€ä»‹"></a>Project Reactor ç®€ä»‹</h2><p>Project Reactor æ˜¯ <strong>Spring å®˜æ–¹çš„ Reactive Streams å®ç°</strong>ï¼Œæ˜¯ Spring WebFlux çš„åŸºç¡€ã€‚</p><h3 id="æ ¸å¿ƒç‰¹ç‚¹"><a href="#æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="æ ¸å¿ƒç‰¹ç‚¹"></a>æ ¸å¿ƒç‰¹ç‚¹</h3><ul><li><strong>å®Œå…¨éé˜»å¡</strong>ï¼šåŸºäº JDK 8 å‡½æ•°å¼ API</li><li><strong>èƒŒå‹æ”¯æŒ</strong>ï¼šå®Œæ•´å®ç° Reactive Streams è§„èŒƒ</li><li><strong>ä¸°å¯Œçš„æ“ä½œç¬¦</strong>ï¼šæä¾› 100+ æ“ä½œç¬¦</li><li><strong>ä¸ Spring æ·±åº¦é›†æˆ</strong>ï¼šWebFluxã€Spring Data R2DBC ç­‰</li></ul><h2 id="Reactor-å¯¹-Reactive-Streams-çš„å®ç°"><a href="#Reactor-å¯¹-Reactive-Streams-çš„å®ç°" class="headerlink" title="Reactor å¯¹ Reactive Streams çš„å®ç°"></a>Reactor å¯¹ Reactive Streams çš„å®ç°</h2><h3 id="Publisher-çš„å®ç°"><a href="#Publisher-çš„å®ç°" class="headerlink" title="Publisher çš„å®ç°"></a>Publisher çš„å®ç°</h3><p>Reactor æä¾›äº†ä¸¤ä¸ª Publisher å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Mono - 0æˆ–1ä¸ªå…ƒç´ çš„ Publisher</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mono</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Publisher</span>&lt;T&gt; &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-comment">// Flux - 0åˆ°Nä¸ªå…ƒç´ çš„ Publisher  </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Flux</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Publisher</span>&lt;T&gt; &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¸ºä»€ä¹ˆåˆ†æˆ-Mono-å’Œ-Fluxï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåˆ†æˆ-Mono-å’Œ-Fluxï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåˆ†æˆ Mono å’Œ Fluxï¼Ÿ"></a>ä¸ºä»€ä¹ˆåˆ†æˆ Mono å’Œ Fluxï¼Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¯­ä¹‰æ›´æ¸…æ™°</span><br>Mono&lt;User&gt; <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span>;      <span class="hljs-comment">// æ˜ç¡®ï¼šæœ€å¤šè¿”å›1ä¸ª</span><br>Flux&lt;User&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span>;              <span class="hljs-comment">// æ˜ç¡®ï¼šå¯èƒ½è¿”å›å¤šä¸ª</span><br><br><span class="hljs-comment">// å¯¹æ¯”åŸå§‹ Publisher</span><br>Publisher&lt;User&gt; <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span>;  <span class="hljs-comment">// ä¸æ¸…æ¥šï¼š1ä¸ªè¿˜æ˜¯å¤šä¸ªï¼Ÿ</span><br></code></pre></td></tr></table></figure><h3 id="Subscriber-çš„å®ç°"><a href="#Subscriber-çš„å®ç°" class="headerlink" title="Subscriber çš„å®ç°"></a>Subscriber çš„å®ç°</h3><p>Reactor æä¾›äº† <code>BaseSubscriber</code> ä½œä¸ºåŸºç¡€å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br>    .subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseSubscriber</span>&lt;Integer&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookOnSubscribe</span><span class="hljs-params">(Subscription subscription)</span> &#123;<br>            <span class="hljs-comment">// è®¢é˜…æ—¶è¯·æ±‚ç¬¬ä¸€æ‰¹æ•°æ®</span><br>            request(<span class="hljs-number">3</span>);<br>        &#125;<br>        <br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookOnNext</span><span class="hljs-params">(Integer value)</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;æ”¶åˆ°: &quot;</span> + value);<br>            <span class="hljs-comment">// æ¯æ”¶åˆ°ä¸€ä¸ªï¼Œå†è¯·æ±‚ä¸€ä¸ªï¼ˆæ§åˆ¶èƒŒå‹ï¼‰</span><br>            request(<span class="hljs-number">1</span>);<br>        &#125;<br>        <br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookOnComplete</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;å®Œæˆ&quot;</span>);<br>        &#125;<br>        <br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookOnError</span><span class="hljs-params">(Throwable throwable)</span> &#123;<br>            System.err.println(<span class="hljs-string">&quot;é”™è¯¯: &quot;</span> + throwable);<br>        &#125;<br>    &#125;);<br></code></pre></td></tr></table></figure><h2 id="èƒŒå‹ç­–ç•¥å®ç°"><a href="#èƒŒå‹ç­–ç•¥å®ç°" class="headerlink" title="èƒŒå‹ç­–ç•¥å®ç°"></a>èƒŒå‹ç­–ç•¥å®ç°</h2><p>Reactor æä¾›äº†å¤šç§èƒŒå‹ç­–ç•¥ï¼š</p><h3 id="1-request-æ§åˆ¶ï¼ˆé»˜è®¤ï¼‰"><a href="#1-request-æ§åˆ¶ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="1. request æ§åˆ¶ï¼ˆé»˜è®¤ï¼‰"></a>1. request æ§åˆ¶ï¼ˆé»˜è®¤ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)<br>    .subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseSubscriber</span>&lt;Integer&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookOnSubscribe</span><span class="hljs-params">(Subscription s)</span> &#123;<br>            request(<span class="hljs-number">10</span>);  <span class="hljs-comment">// åªè¯·æ±‚10ä¸ª</span><br>        &#125;<br>        <br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookOnNext</span><span class="hljs-params">(Integer value)</span> &#123;<br>            <span class="hljs-comment">// å¤„ç†å®Œä¸€ä¸ªå†è¯·æ±‚ä¸€ä¸ª</span><br>            request(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;);<br></code></pre></td></tr></table></figure><h3 id="2-onBackpressureBuffer-ç¼“å†²"><a href="#2-onBackpressureBuffer-ç¼“å†²" class="headerlink" title="2. onBackpressureBuffer - ç¼“å†²"></a>2. onBackpressureBuffer - ç¼“å†²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)<br>    .onBackpressureBuffer(<span class="hljs-number">100</span>)  <span class="hljs-comment">// ç¼“å†²100ä¸ª</span><br>    .subscribe(value -&gt; &#123;<br>        Thread.sleep(<span class="hljs-number">100</span>);  <span class="hljs-comment">// æ…¢æ¶ˆè´¹</span><br>        System.out.println(value);<br>    &#125;);<br></code></pre></td></tr></table></figure><h3 id="3-onBackpressureDrop-ä¸¢å¼ƒ"><a href="#3-onBackpressureDrop-ä¸¢å¼ƒ" class="headerlink" title="3. onBackpressureDrop - ä¸¢å¼ƒ"></a>3. onBackpressureDrop - ä¸¢å¼ƒ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)<br>    .onBackpressureDrop(dropped -&gt; <br>        System.out.println(<span class="hljs-string">&quot;ä¸¢å¼ƒ: &quot;</span> + dropped))<br>    .subscribe(value -&gt; &#123;<br>        Thread.sleep(<span class="hljs-number">100</span>);<br>        System.out.println(value);<br>    &#125;);<br></code></pre></td></tr></table></figure><h3 id="4-onBackpressureLatest-åªä¿ç•™æœ€æ–°"><a href="#4-onBackpressureLatest-åªä¿ç•™æœ€æ–°" class="headerlink" title="4. onBackpressureLatest - åªä¿ç•™æœ€æ–°"></a>4. onBackpressureLatest - åªä¿ç•™æœ€æ–°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)<br>    .onBackpressureLatest()  <span class="hljs-comment">// åªä¿ç•™æœ€æ–°çš„</span><br>    .subscribe(value -&gt; &#123;<br>        Thread.sleep(<span class="hljs-number">100</span>);<br>        System.out.println(value);<br>    &#125;);<br></code></pre></td></tr></table></figure><h3 id="5-onBackpressureError-æŠ›å¼‚å¸¸"><a href="#5-onBackpressureError-æŠ›å¼‚å¸¸" class="headerlink" title="5. onBackpressureError - æŠ›å¼‚å¸¸"></a>5. onBackpressureError - æŠ›å¼‚å¸¸</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)<br>    .onBackpressureError()  <span class="hljs-comment">// èƒŒå‹æ—¶æŠ›å‡ºå¼‚å¸¸</span><br>    .subscribe(value -&gt; &#123;<br>        Thread.sleep(<span class="hljs-number">100</span>);<br>        System.out.println(value);<br>    &#125;);<br></code></pre></td></tr></table></figure><h2 id="Subscription-çš„å®ç°"><a href="#Subscription-çš„å®ç°" class="headerlink" title="Subscription çš„å®ç°"></a>Subscription çš„å®ç°</h2><p>Reactor å†…éƒ¨ä½¿ç”¨å¤šç§ Subscription å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æŸ¥çœ‹å®é™…çš„ Subscription ç±»å‹</span><br>Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br>    .subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseSubscriber</span>&lt;Integer&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hookOnSubscribe</span><span class="hljs-params">(Subscription subscription)</span> &#123;<br>            System.out.println(subscription.getClass());<br>            <span class="hljs-comment">// è¾“å‡º: reactor.core.publisher.FluxRange$RangeSubscription</span><br>            request(<span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;);<br></code></pre></td></tr></table></figure><h3 id="å¸¸è§çš„-Subscription-å®ç°"><a href="#å¸¸è§çš„-Subscription-å®ç°" class="headerlink" title="å¸¸è§çš„ Subscription å®ç°"></a>å¸¸è§çš„ Subscription å®ç°</h3><table><thead><tr><th>ç±»å</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>FluxRange$RangeSubscription</code></td><td>range() æ“ä½œçš„è®¢é˜…</td></tr><tr><td><code>FluxMap$MapSubscriber</code></td><td>map() æ“ä½œçš„è®¢é˜…</td></tr><tr><td><code>FluxFilter$FilterSubscriber</code></td><td>filter() æ“ä½œçš„è®¢é˜…</td></tr><tr><td><code>MonoJust$MonoJustSubscription</code></td><td>Mono.just() çš„è®¢é˜…</td></tr></tbody></table><h2 id="Processor-çš„å®ç°ï¼ˆå·²åºŸå¼ƒï¼‰"><a href="#Processor-çš„å®ç°ï¼ˆå·²åºŸå¼ƒï¼‰" class="headerlink" title="Processor çš„å®ç°ï¼ˆå·²åºŸå¼ƒï¼‰"></a>Processor çš„å®ç°ï¼ˆå·²åºŸå¼ƒï¼‰</h2><p>Reactor 3.4 ä¹‹å‰æä¾›äº† Processor å®ç°ï¼Œç°åœ¨æ¨èä½¿ç”¨ <strong>Sinks</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ—§æ–¹å¼ï¼ˆå·²åºŸå¼ƒï¼‰</span><br><span class="hljs-comment">// DirectProcessor&lt;String&gt; processor = DirectProcessor.create();</span><br><br><span class="hljs-comment">// æ–°æ–¹å¼ï¼šä½¿ç”¨ Sinks</span><br>Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// ä½œä¸º Publisher</span><br>Flux&lt;String&gt; flux = sink.asFlux();<br><br><span class="hljs-comment">// å‘é€æ•°æ®</span><br>sink.tryEmitNext(<span class="hljs-string">&quot;Hello&quot;</span>);<br>sink.tryEmitNext(<span class="hljs-string">&quot;World&quot;</span>);<br>sink.tryEmitComplete();<br></code></pre></td></tr></table></figure><h3 id="Sinks-çš„ç±»å‹"><a href="#Sinks-çš„ç±»å‹" class="headerlink" title="Sinks çš„ç±»å‹"></a>Sinks çš„ç±»å‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å•æ’­ï¼šåªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…</span><br>Sinks.Many&lt;String&gt; unicast = Sinks.many().unicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// å¤šæ’­ï¼šå¤šä¸ªè®¢é˜…è€…å…±äº«</span><br>Sinks.Many&lt;String&gt; multicast = Sinks.many().multicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// é‡æ”¾ï¼šæ–°è®¢é˜…è€…å¯ä»¥æ”¶åˆ°å†å²æ•°æ®</span><br>Sinks.Many&lt;String&gt; replay = Sinks.many().replay().all();<br><br><span class="hljs-comment">// å•å€¼</span><br>Sinks.One&lt;String&gt; one = Sinks.one();<br></code></pre></td></tr></table></figure><h2 id="æ“ä½œç¬¦é“¾çš„èƒŒå‹ä¼ é€’"><a href="#æ“ä½œç¬¦é“¾çš„èƒŒå‹ä¼ é€’" class="headerlink" title="æ“ä½œç¬¦é“¾çš„èƒŒå‹ä¼ é€’"></a>æ“ä½œç¬¦é“¾çš„èƒŒå‹ä¼ é€’</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)           <span class="hljs-comment">// æº Publisher</span><br>    .map(i -&gt; i * <span class="hljs-number">2</span>)          <span class="hljs-comment">// ä¸­é—´æ“ä½œç¬¦</span><br>    .filter(i -&gt; i % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>)  <span class="hljs-comment">// ä¸­é—´æ“ä½œç¬¦</span><br>    .take(<span class="hljs-number">10</span>)                 <span class="hljs-comment">// ä¸­é—´æ“ä½œç¬¦</span><br>    .subscribe(System.out::println);  <span class="hljs-comment">// æœ€ç»ˆ Subscriber</span><br></code></pre></td></tr></table></figure><p>èƒŒå‹ä¿¡å·<strong>ä»ä¸‹æ¸¸å‘ä¸Šæ¸¸ä¼ é€’</strong>ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">Subscriber<span class="hljs-selector-class">.request</span>(<span class="hljs-number">10</span>)<br>    â†“<br>take å‘ä¸Š <span class="hljs-built_in">request</span>(<span class="hljs-number">10</span>)<br>    â†“<br><span class="hljs-attribute">filter</span> å‘ä¸Š <span class="hljs-built_in">request</span>(<span class="hljs-number">10</span>)  <span class="hljs-comment">// å¯èƒ½è¯·æ±‚æ›´å¤šï¼Œå› ä¸ºæœ‰è¿‡æ»¤</span><br>    â†“<br>map å‘ä¸Š <span class="hljs-built_in">request</span>(<span class="hljs-number">10</span>)<br>    â†“<br>range å¼€å§‹ç”Ÿäº§æ•°æ®<br></code></pre></td></tr></table></figure><h2 id="è°ƒè¯•èƒŒå‹"><a href="#è°ƒè¯•èƒŒå‹" class="headerlink" title="è°ƒè¯•èƒŒå‹"></a>è°ƒè¯•èƒŒå‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>)<br>    .log()  <span class="hljs-comment">// æ‰“å°æ‰€æœ‰ä¿¡å·ï¼ŒåŒ…æ‹¬ request</span><br>    .map(i -&gt; i * <span class="hljs-number">2</span>)<br>    .subscribe(System.out::println);<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç¤ºä¾‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">INFO</span>  - | onSubscribe([Synchronous Fuseable] FluxRange.RangeSubscription)<br><span class="hljs-built_in">INFO</span>  - | request(unbounded)<br><span class="hljs-built_in">INFO</span>  - | onNext(1)<br><span class="hljs-built_in">INFO</span>  - | onNext(2)<br><span class="hljs-built_in">..</span>.<br><span class="hljs-built_in">INFO</span>  - | onComplete()<br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸Šä¸€ç¯‡ï¼šReactive Streams è§„èŒƒ</li><li>ä¸‹ä¸€ç¯‡ï¼šæºç è§£æ</li><li>WebFlux - Reactoræ ¸å¿ƒAPI</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Reactive Streams</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>ReactiveStreams</tag>
      
      <tag>Reactor</tag>
      
      <tag>Flux</tag>
      
      <tag>Mono</tag>
      
      <tag>èƒŒå‹ç­–ç•¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Reactive Streamsè§„èŒƒ</title>
    <link href="/2026/01/10/Reactive%20Streams%E8%A7%84%E8%8C%83/"/>
    <url>/2026/01/10/Reactive%20Streams%E8%A7%84%E8%8C%83/</url>
    
    <content type="html"><![CDATA[<h1 id="Reactive-Streams-è§„èŒƒ"><a href="#Reactive-Streams-è§„èŒƒ" class="headerlink" title="Reactive Streams è§„èŒƒ"></a>Reactive Streams è§„èŒƒ</h1><h2 id="ä»€ä¹ˆæ˜¯-Reactive-Streams"><a href="#ä»€ä¹ˆæ˜¯-Reactive-Streams" class="headerlink" title="ä»€ä¹ˆæ˜¯ Reactive Streams"></a>ä»€ä¹ˆæ˜¯ Reactive Streams</h2><p>Reactive Streams æ˜¯ JVM ä¸Š<strong>å“åº”å¼ç¼–ç¨‹çš„æ ‡å‡†è§„èŒƒ</strong>ï¼Œå®šä¹‰äº†å¼‚æ­¥æµå¤„ç†çš„æ¥å£å’Œåè®®ã€‚</p><ul><li><strong>å‘èµ·è€…</strong>ï¼šNetflixã€Pivotalã€Lightbendã€Twitter ç­‰å…¬å¸è”åˆåˆ¶å®š</li><li><strong>ç›®æ ‡</strong>ï¼šè§£å†³å¼‚æ­¥æ•°æ®æµå¤„ç†ä¸­çš„èƒŒå‹é—®é¢˜</li><li><strong>Java 9</strong>ï¼šå·²çº³å…¥ JDKï¼Œä½äº <code>java.util.concurrent.Flow</code></li></ul><h2 id="å››ä¸ªæ ¸å¿ƒæ¥å£"><a href="#å››ä¸ªæ ¸å¿ƒæ¥å£" class="headerlink" title="å››ä¸ªæ ¸å¿ƒæ¥å£"></a>å››ä¸ªæ ¸å¿ƒæ¥å£</h2><p>Reactive Streams åªå®šä¹‰äº† 4 ä¸ªæ¥å£ï¼Œéå¸¸ç®€æ´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1. å‘å¸ƒè€… - æ•°æ®çš„ç”Ÿäº§è€…</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Publisher</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">(Subscriber&lt;? <span class="hljs-built_in">super</span> T&gt; s)</span>;<br>&#125;<br><br><span class="hljs-comment">// 2. è®¢é˜…è€… - æ•°æ®çš„æ¶ˆè´¹è€…</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Subscriber</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSubscribe</span><span class="hljs-params">(Subscription s)</span>;  <span class="hljs-comment">// è®¢é˜…æˆåŠŸ</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNext</span><span class="hljs-params">(T t)</span>;                   <span class="hljs-comment">// æ¥æ”¶æ•°æ®</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable t)</span>;          <span class="hljs-comment">// å‘ç”Ÿé”™è¯¯</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">()</span>;                  <span class="hljs-comment">// æ•°æ®æµç»“æŸ</span><br>&#125;<br><br><span class="hljs-comment">// 3. è®¢é˜…å…³ç³» - è¿æ¥å‘å¸ƒè€…å’Œè®¢é˜…è€…</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Subscription</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">request</span><span class="hljs-params">(<span class="hljs-type">long</span> n)</span>;  <span class="hljs-comment">// è¯·æ±‚ n ä¸ªæ•°æ®ï¼ˆèƒŒå‹æ ¸å¿ƒï¼‰</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">()</span>;         <span class="hljs-comment">// å–æ¶ˆè®¢é˜…</span><br>&#125;<br><br><span class="hljs-comment">// 4. å¤„ç†å™¨ - æ—¢æ˜¯è®¢é˜…è€…åˆæ˜¯å‘å¸ƒè€…</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Processor</span>&lt;T, R&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Subscriber</span>&lt;T&gt;, Publisher&lt;R&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="äº¤äº’æµç¨‹"><a href="#äº¤äº’æµç¨‹" class="headerlink" title="äº¤äº’æµç¨‹"></a>äº¤äº’æµç¨‹</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚   Publisher  â”‚                      â”‚  Subscriber  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>       â”‚                                     â”‚<br>       â”‚  <span class="hljs-number">1</span>. <span class="hljs-built_in">subscribe</span>(subscriber)           â”‚<br>       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚<br>       â”‚                                     â”‚<br>       â”‚  <span class="hljs-number">2</span>. <span class="hljs-built_in">onSubscribe</span>(subscription)       â”‚<br>       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚<br>       â”‚                                     â”‚<br>       â”‚  <span class="hljs-number">3</span>. <span class="hljs-built_in">request</span>(n) è¯·æ±‚nä¸ªæ•°æ®          â”‚<br>       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚<br>       â”‚                                     â”‚<br>       â”‚  <span class="hljs-number">4</span>. <span class="hljs-built_in">onNext</span>(data) å‘é€æ•°æ®ï¼ˆæœ€å¤šnä¸ªï¼‰â”‚<br>       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚<br>       â”‚         ... é‡å¤ <span class="hljs-number">3</span>-<span class="hljs-number">4</span> ...            â”‚<br>       â”‚                                     â”‚<br>       â”‚  <span class="hljs-number">5</span>. <span class="hljs-built_in">onComplete</span>() æˆ– <span class="hljs-built_in">onError</span>()       â”‚<br>       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚<br>       â–¼                                     â–¼<br></code></pre></td></tr></table></figure><h2 id="èƒŒå‹ï¼ˆBackpressureï¼‰"><a href="#èƒŒå‹ï¼ˆBackpressureï¼‰" class="headerlink" title="èƒŒå‹ï¼ˆBackpressureï¼‰"></a>èƒŒå‹ï¼ˆBackpressureï¼‰</h2><p>èƒŒå‹æ˜¯ Reactive Streams çš„<strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼Œè§£å†³ç”Ÿäº§è€…é€Ÿåº¦å¿«äºæ¶ˆè´¹è€…çš„é—®é¢˜ã€‚</p><h3 id="æ²¡æœ‰èƒŒå‹çš„é—®é¢˜"><a href="#æ²¡æœ‰èƒŒå‹çš„é—®é¢˜" class="headerlink" title="æ²¡æœ‰èƒŒå‹çš„é—®é¢˜"></a>æ²¡æœ‰èƒŒå‹çš„é—®é¢˜</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">ç”Ÿäº§è€…ï¼š<span class="hljs-number">1000</span>æ¡<span class="hljs-regexp">/ç§’  â”€â”€â”€â”€â”€â”€â–¶  æ¶ˆè´¹è€…ï¼š100æ¡/</span>ç§’<br>                              â†“<br>                         å†…å­˜æº¢å‡ºï¼<br></code></pre></td></tr></table></figure><h3 id="æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ"><a href="#æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ"></a>æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ¶ˆè´¹è€…æ§åˆ¶é€Ÿåº¦</span><br>subscription.request(<span class="hljs-number">10</span>);  <span class="hljs-comment">// æˆ‘åªè¦10æ¡</span><br><span class="hljs-comment">// ç”Ÿäº§è€…æœ€å¤šå‘10æ¡ï¼Œç„¶åç­‰å¾…ä¸‹ä¸€æ¬¡ request</span><br></code></pre></td></tr></table></figure><h3 id="èƒŒå‹åè®®è§„åˆ™"><a href="#èƒŒå‹åè®®è§„åˆ™" class="headerlink" title="èƒŒå‹åè®®è§„åˆ™"></a>èƒŒå‹åè®®è§„åˆ™</h3><ol><li><strong>Subscriber ä¸»åŠ¨è¯·æ±‚</strong>ï¼šé€šè¿‡ <code>request(n)</code> å‘Šè¯‰ Publisher éœ€è¦å¤šå°‘æ•°æ®</li><li><strong>Publisher éµå®ˆçº¦å®š</strong>ï¼šæœ€å¤šå‘é€ n ä¸ªæ•°æ®ï¼Œä¸èƒ½è¶…å‘</li><li><strong>ç´¯ç§¯è¯·æ±‚</strong>ï¼šå¤šæ¬¡ <code>request()</code> çš„æ•°é‡ä¼šç´¯åŠ </li><li><strong>æ— é™è¯·æ±‚</strong>ï¼š<code>request(Long.MAX_VALUE)</code> è¡¨ç¤ºä¸é™åˆ¶</li></ol><h2 id="è§„èŒƒçš„å®ç°"><a href="#è§„èŒƒçš„å®ç°" class="headerlink" title="è§„èŒƒçš„å®ç°"></a>è§„èŒƒçš„å®ç°</h2><table><thead><tr><th>å®ç°</th><th>è¯´æ˜</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Project Reactor</strong></td><td>Spring é»˜è®¤å®ç°</td><td>Spring WebFlux</td></tr><tr><td><strong>RxJava</strong></td><td>Netflix å¼€æº</td><td>Androidã€é€šç”¨</td></tr><tr><td><strong>Akka Streams</strong></td><td>Lightbend å¼€æº</td><td>Scala ç”Ÿæ€</td></tr><tr><td><strong>Java 9 Flow</strong></td><td>JDK å†…ç½®</td><td>æ ‡å‡†åº“</td></tr></tbody></table><p>Spring ç”Ÿæ€ä½¿ç”¨çš„æ˜¯ <strong>Project Reactor</strong>ï¼Œä¸‹ä¸€ç¯‡è¯¦ç»†ä»‹ç»ã€‚</p><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸‹ä¸€ç¯‡ï¼šProject Reactor å®ç°</li><li>WebFlux - å“åº”å¼ç¼–ç¨‹åŸºç¡€</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Reactive Streams</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>ReactiveStreams</tag>
      
      <tag>èƒŒå‹</tag>
      
      <tag>Publisher</tag>
      
      <tag>Subscriber</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Reactoræ ¸å¿ƒAPI</title>
    <link href="/2026/01/10/Reactor%E6%A0%B8%E5%BF%83API/"/>
    <url>/2026/01/10/Reactor%E6%A0%B8%E5%BF%83API/</url>
    
    <content type="html"><![CDATA[<h1 id="Reactor-æ ¸å¿ƒ-API"><a href="#Reactor-æ ¸å¿ƒ-API" class="headerlink" title="Reactor æ ¸å¿ƒ API"></a>Reactor æ ¸å¿ƒ API</h1><h2 id="ä»€ä¹ˆæ˜¯-Project-Reactor"><a href="#ä»€ä¹ˆæ˜¯-Project-Reactor" class="headerlink" title="ä»€ä¹ˆæ˜¯ Project Reactor"></a>ä»€ä¹ˆæ˜¯ Project Reactor</h2><p>Project Reactor æ˜¯ Spring WebFlux é»˜è®¤ä½¿ç”¨çš„å“åº”å¼åº“ï¼Œå®ƒå®ç°äº† Reactive Streams è§„èŒƒï¼Œæä¾›äº†ä¸¤ä¸ªæ ¸å¿ƒç±»å‹ï¼š<strong>Mono</strong> å’Œ <strong>Flux</strong>ã€‚</p><h2 id="Mono-å•å€¼å®¹å™¨"><a href="#Mono-å•å€¼å®¹å™¨" class="headerlink" title="Mono - å•å€¼å®¹å™¨"></a>Mono - å•å€¼å®¹å™¨</h2><p><code>Mono&lt;T&gt;</code> è¡¨ç¤º<strong>0ä¸ªæˆ–1ä¸ª</strong>å…ƒç´ çš„å¼‚æ­¥åºåˆ—ã€‚</p><h3 id="åˆ›å»º-Mono"><a href="#åˆ›å»º-Mono" class="headerlink" title="åˆ›å»º Mono"></a>åˆ›å»º Mono</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆ›å»ºåŒ…å«å€¼çš„ Mono</span><br>Mono&lt;String&gt; mono1 = Mono.just(<span class="hljs-string">&quot;Hello&quot;</span>);<br><br><span class="hljs-comment">// åˆ›å»ºç©ºçš„ Mono</span><br>Mono&lt;String&gt; mono2 = Mono.empty();<br><br><span class="hljs-comment">// åˆ›å»ºé”™è¯¯çš„ Mono</span><br>Mono&lt;String&gt; mono3 = Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Error&quot;</span>));<br><br><span class="hljs-comment">// å»¶è¿Ÿåˆ›å»º</span><br>Mono&lt;String&gt; mono4 = Mono.fromSupplier(() -&gt; <span class="hljs-string">&quot;Lazy Value&quot;</span>);<br><br><span class="hljs-comment">// ä» Callable åˆ›å»º</span><br>Mono&lt;String&gt; mono5 = Mono.fromCallable(() -&gt; blockingCall());<br><br><span class="hljs-comment">// ä» Future åˆ›å»º</span><br>Mono&lt;String&gt; mono6 = Mono.fromFuture(completableFuture);<br></code></pre></td></tr></table></figure><h3 id="Mono-å¸¸ç”¨æ“ä½œ"><a href="#Mono-å¸¸ç”¨æ“ä½œ" class="headerlink" title="Mono å¸¸ç”¨æ“ä½œ"></a>Mono å¸¸ç”¨æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">Mono.just(<span class="hljs-string">&quot;Hello&quot;</span>)<br>    .map(s -&gt; s + <span class="hljs-string">&quot; World&quot;</span>)           <span class="hljs-comment">// è½¬æ¢</span><br>    .flatMap(s -&gt; anotherMono(s))     <span class="hljs-comment">// å¼‚æ­¥è½¬æ¢</span><br>    .filter(s -&gt; s.length() &gt; <span class="hljs-number">5</span>)      <span class="hljs-comment">// è¿‡æ»¤</span><br>    .defaultIfEmpty(<span class="hljs-string">&quot;Default&quot;</span>)         <span class="hljs-comment">// é»˜è®¤å€¼</span><br>    .switchIfEmpty(anotherMono)        <span class="hljs-comment">// ç©ºæ—¶åˆ‡æ¢</span><br>    .doOnNext(s -&gt; log.info(s))        <span class="hljs-comment">// å‰¯ä½œç”¨</span><br>    .doOnError(e -&gt; log.error(e))      <span class="hljs-comment">// é”™è¯¯å¤„ç†</span><br>    .subscribe();                       <span class="hljs-comment">// è®¢é˜…è§¦å‘æ‰§è¡Œ</span><br></code></pre></td></tr></table></figure><h2 id="Flux-å¤šå€¼å®¹å™¨"><a href="#Flux-å¤šå€¼å®¹å™¨" class="headerlink" title="Flux - å¤šå€¼å®¹å™¨"></a>Flux - å¤šå€¼å®¹å™¨</h2><p><code>Flux&lt;T&gt;</code> è¡¨ç¤º<strong>0åˆ°Nä¸ª</strong>å…ƒç´ çš„å¼‚æ­¥åºåˆ—ã€‚</p><h3 id="åˆ›å»º-Flux"><a href="#åˆ›å»º-Flux" class="headerlink" title="åˆ›å»º Flux"></a>åˆ›å»º Flux</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä»å¤šä¸ªå€¼åˆ›å»º</span><br>Flux&lt;String&gt; flux1 = Flux.just(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>);<br><br><span class="hljs-comment">// ä»æ•°ç»„åˆ›å»º</span><br>Flux&lt;String&gt; flux2 = Flux.fromArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>&#125;);<br><br><span class="hljs-comment">// ä»é›†åˆåˆ›å»º</span><br>Flux&lt;String&gt; flux3 = Flux.fromIterable(Arrays.asList(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>));<br><br><span class="hljs-comment">// åˆ›å»ºèŒƒå›´</span><br>Flux&lt;Integer&gt; flux4 = Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);  <span class="hljs-comment">// 1åˆ°10</span><br><br><span class="hljs-comment">// åˆ›å»ºç©º Flux</span><br>Flux&lt;String&gt; flux5 = Flux.empty();<br><br><span class="hljs-comment">// å®šæ—¶å‘å°„</span><br>Flux&lt;Long&gt; flux6 = Flux.interval(Duration.ofSeconds(<span class="hljs-number">1</span>));<br><br><span class="hljs-comment">// ä» Stream åˆ›å»º</span><br>Flux&lt;String&gt; flux7 = Flux.fromStream(Stream.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>));<br></code></pre></td></tr></table></figure><h3 id="Flux-å¸¸ç”¨æ“ä½œ"><a href="#Flux-å¸¸ç”¨æ“ä½œ" class="headerlink" title="Flux å¸¸ç”¨æ“ä½œ"></a>Flux å¸¸ç”¨æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br>    .map(i -&gt; i * <span class="hljs-number">2</span>)                   <span class="hljs-comment">// è½¬æ¢æ¯ä¸ªå…ƒç´ </span><br>    .filter(i -&gt; i &gt; <span class="hljs-number">5</span>)                <span class="hljs-comment">// è¿‡æ»¤</span><br>    .take(<span class="hljs-number">5</span>)                           <span class="hljs-comment">// åªå–å‰5ä¸ª</span><br>    .skip(<span class="hljs-number">2</span>)                           <span class="hljs-comment">// è·³è¿‡å‰2ä¸ª</span><br>    .distinct()                        <span class="hljs-comment">// å»é‡</span><br>    .sort()                            <span class="hljs-comment">// æ’åº</span><br>    .collectList()                     <span class="hljs-comment">// æ”¶é›†ä¸º Mono&lt;List&gt;</span><br>    .subscribe();<br></code></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒæ“ä½œç¬¦åˆ†ç±»"><a href="#æ ¸å¿ƒæ“ä½œç¬¦åˆ†ç±»" class="headerlink" title="æ ¸å¿ƒæ“ä½œç¬¦åˆ†ç±»"></a>æ ¸å¿ƒæ“ä½œç¬¦åˆ†ç±»</h2><h3 id="è½¬æ¢æ“ä½œç¬¦"><a href="#è½¬æ¢æ“ä½œç¬¦" class="headerlink" title="è½¬æ¢æ“ä½œç¬¦"></a>è½¬æ¢æ“ä½œç¬¦</h3><table><thead><tr><th>æ“ä½œç¬¦</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>map</code></td><td>åŒæ­¥è½¬æ¢</td><td><code>flux.map(i -&gt; i * 2)</code></td></tr><tr><td><code>flatMap</code></td><td>å¼‚æ­¥è½¬æ¢ï¼ˆä¸ä¿åºï¼‰</td><td><code>flux.flatMap(i -&gt; getMono(i))</code></td></tr><tr><td><code>flatMapSequential</code></td><td>å¼‚æ­¥è½¬æ¢ï¼ˆä¿åºï¼‰</td><td><code>flux.flatMapSequential(...)</code></td></tr><tr><td><code>concatMap</code></td><td>é¡ºåºå¼‚æ­¥è½¬æ¢</td><td><code>flux.concatMap(...)</code></td></tr><tr><td><code>switchMap</code></td><td>åˆ‡æ¢åˆ°æ–°æµ</td><td><code>flux.switchMap(...)</code></td></tr></tbody></table><h3 id="è¿‡æ»¤æ“ä½œç¬¦"><a href="#è¿‡æ»¤æ“ä½œç¬¦" class="headerlink" title="è¿‡æ»¤æ“ä½œç¬¦"></a>è¿‡æ»¤æ“ä½œç¬¦</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>)<br>    .filter(i -&gt; i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)      <span class="hljs-comment">// è¿‡æ»¤å¶æ•°</span><br>    .take(<span class="hljs-number">10</span>)                      <span class="hljs-comment">// å–å‰10ä¸ª</span><br>    .takeLast(<span class="hljs-number">5</span>)                   <span class="hljs-comment">// å–å5ä¸ª</span><br>    .takeWhile(i -&gt; i &lt; <span class="hljs-number">50</span>)        <span class="hljs-comment">// æ»¡è¶³æ¡ä»¶æ—¶å–</span><br>    .skip(<span class="hljs-number">5</span>)                       <span class="hljs-comment">// è·³è¿‡å‰5ä¸ª</span><br>    .skipWhile(i -&gt; i &lt; <span class="hljs-number">10</span>)        <span class="hljs-comment">// æ»¡è¶³æ¡ä»¶æ—¶è·³è¿‡</span><br>    .distinct()                    <span class="hljs-comment">// å»é‡</span><br>    .distinctUntilChanged()        <span class="hljs-comment">// ç›¸é‚»å»é‡</span><br>    .elementAt(<span class="hljs-number">5</span>)                  <span class="hljs-comment">// å–ç¬¬5ä¸ªå…ƒç´ </span><br>    .single()                      <span class="hljs-comment">// ç¡®ä¿åªæœ‰ä¸€ä¸ªå…ƒç´ </span><br>    .subscribe();<br></code></pre></td></tr></table></figure><h3 id="ç»„åˆæ“ä½œç¬¦"><a href="#ç»„åˆæ“ä½œç¬¦" class="headerlink" title="ç»„åˆæ“ä½œç¬¦"></a>ç»„åˆæ“ä½œç¬¦</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆå¹¶å¤šä¸ª Fluxï¼ˆäº¤é”™ï¼‰</span><br>Flux.merge(flux1, flux2, flux3);<br><br><span class="hljs-comment">// è¿æ¥å¤šä¸ª Fluxï¼ˆé¡ºåºï¼‰</span><br>Flux.concat(flux1, flux2, flux3);<br><br><span class="hljs-comment">// é…å¯¹ç»„åˆ</span><br>Flux.zip(flux1, flux2, (a, b) -&gt; a + b);<br><br><span class="hljs-comment">// åˆå¹¶æœ€æ–°å€¼</span><br>Flux.combineLatest(flux1, flux2, (a, b) -&gt; a + b);<br></code></pre></td></tr></table></figure><h3 id="é”™è¯¯å¤„ç†æ“ä½œç¬¦"><a href="#é”™è¯¯å¤„ç†æ“ä½œç¬¦" class="headerlink" title="é”™è¯¯å¤„ç†æ“ä½œç¬¦"></a>é”™è¯¯å¤„ç†æ“ä½œç¬¦</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>    .map(i -&gt; &#123;<br>        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">2</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Error&quot;</span>);<br>        <span class="hljs-keyword">return</span> i;<br>    &#125;)<br>    .onErrorReturn(-<span class="hljs-number">1</span>)                    <span class="hljs-comment">// é”™è¯¯æ—¶è¿”å›é»˜è®¤å€¼</span><br>    .onErrorResume(e -&gt; Flux.just(<span class="hljs-number">0</span>))     <span class="hljs-comment">// é”™è¯¯æ—¶åˆ‡æ¢åˆ°å¤‡ç”¨æµ</span><br>    .onErrorMap(e -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomException</span>()) <span class="hljs-comment">// è½¬æ¢å¼‚å¸¸</span><br>    .retry(<span class="hljs-number">3</span>)                              <span class="hljs-comment">// é‡è¯•3æ¬¡</span><br>    .retryWhen(Retry.backoff(<span class="hljs-number">3</span>, Duration.ofSeconds(<span class="hljs-number">1</span>))) <span class="hljs-comment">// é€€é¿é‡è¯•</span><br>    .subscribe();<br></code></pre></td></tr></table></figure><h2 id="è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰"><a href="#è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰" class="headerlink" title="è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰"></a>è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰</h2><p>è°ƒåº¦å™¨ç”¨äºæ§åˆ¶æ“ä½œåœ¨å“ªä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œã€‚</p><h3 id="å¸¸ç”¨è°ƒåº¦å™¨"><a href="#å¸¸ç”¨è°ƒåº¦å™¨" class="headerlink" title="å¸¸ç”¨è°ƒåº¦å™¨"></a>å¸¸ç”¨è°ƒåº¦å™¨</h3><table><thead><tr><th>è°ƒåº¦å™¨</th><th>è¯´æ˜</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>Schedulers.immediate()</code></td><td>å½“å‰çº¿ç¨‹</td><td>é»˜è®¤</td></tr><tr><td><code>Schedulers.single()</code></td><td>å•ä¸€çº¿ç¨‹</td><td>é¡ºåºæ‰§è¡Œ</td></tr><tr><td><code>Schedulers.parallel()</code></td><td>å¹¶è¡Œçº¿ç¨‹æ± </td><td>CPU å¯†é›†å‹</td></tr><tr><td><code>Schedulers.boundedElastic()</code></td><td>å¼¹æ€§çº¿ç¨‹æ± </td><td>I&#x2F;O å¯†é›†å‹</td></tr></tbody></table><h3 id="åˆ‡æ¢çº¿ç¨‹"><a href="#åˆ‡æ¢çº¿ç¨‹" class="headerlink" title="åˆ‡æ¢çº¿ç¨‹"></a>åˆ‡æ¢çº¿ç¨‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br>    .publishOn(Schedulers.parallel())    <span class="hljs-comment">// åç»­æ“ä½œåœ¨ parallel çº¿ç¨‹</span><br>    .map(i -&gt; i * <span class="hljs-number">2</span>)<br>    .subscribeOn(Schedulers.boundedElastic()) <span class="hljs-comment">// è®¢é˜…åœ¨ elastic çº¿ç¨‹</span><br>    .subscribe();<br></code></pre></td></tr></table></figure><ul><li><strong><code>subscribeOn</code></strong>ï¼šå½±å“è®¢é˜…å’Œæ•°æ®æºçš„æ‰§è¡Œçº¿ç¨‹</li><li><strong><code>publishOn</code></strong>ï¼šå½±å“åç»­æ“ä½œç¬¦çš„æ‰§è¡Œçº¿ç¨‹</li></ul><h2 id="å†·æµä¸çƒ­æµ"><a href="#å†·æµä¸çƒ­æµ" class="headerlink" title="å†·æµä¸çƒ­æµ"></a>å†·æµä¸çƒ­æµ</h2><h3 id="å†·æµï¼ˆColdï¼‰"><a href="#å†·æµï¼ˆColdï¼‰" class="headerlink" title="å†·æµï¼ˆColdï¼‰"></a>å†·æµï¼ˆColdï¼‰</h3><ul><li>æ¯ä¸ªè®¢é˜…è€…éƒ½ä¼šä»å¤´å¼€å§‹æ¥æ”¶æ•°æ®</li><li>æ•°æ®æ˜¯æƒ°æ€§ç”Ÿæˆçš„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux&lt;Integer&gt; cold = Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>);<br>cold.subscribe(i -&gt; System.out.println(<span class="hljs-string">&quot;Subscriber 1: &quot;</span> + i));<br>cold.subscribe(i -&gt; System.out.println(<span class="hljs-string">&quot;Subscriber 2: &quot;</span> + i));<br><span class="hljs-comment">// ä¸¤ä¸ªè®¢é˜…è€…éƒ½ä¼šæ”¶åˆ° 1, 2, 3, 4, 5</span><br></code></pre></td></tr></table></figure><h3 id="çƒ­æµï¼ˆHotï¼‰"><a href="#çƒ­æµï¼ˆHotï¼‰" class="headerlink" title="çƒ­æµï¼ˆHotï¼‰"></a>çƒ­æµï¼ˆHotï¼‰</h3><ul><li>æ‰€æœ‰è®¢é˜…è€…å…±äº«åŒä¸€ä¸ªæ•°æ®æµ</li><li>è®¢é˜…ååªèƒ½æ”¶åˆ°ä¹‹åå‘å‡ºçš„æ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">Sinks.Many&lt;Integer&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br>Flux&lt;Integer&gt; hot = sink.asFlux();<br><br>hot.subscribe(i -&gt; System.out.println(<span class="hljs-string">&quot;Subscriber 1: &quot;</span> + i));<br>sink.tryEmitNext(<span class="hljs-number">1</span>);<br>sink.tryEmitNext(<span class="hljs-number">2</span>);<br><br>hot.subscribe(i -&gt; System.out.println(<span class="hljs-string">&quot;Subscriber 2: &quot;</span> + i));<br>sink.tryEmitNext(<span class="hljs-number">3</span>);<br><span class="hljs-comment">// Subscriber 1 æ”¶åˆ°: 1, 2, 3</span><br><span class="hljs-comment">// Subscriber 2 æ”¶åˆ°: 3</span><br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸Šä¸€ç¯‡ï¼šå“åº”å¼ç¼–ç¨‹åŸºç¡€</li><li>ä¸‹ä¸€ç¯‡ï¼šWebFluxæ ¸å¿ƒç»„ä»¶</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Webflux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>Reactor</tag>
      
      <tag>Flux</tag>
      
      <tag>Mono</tag>
      
      <tag>WebFlux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ThreadLocalåŸç†</title>
    <link href="/2026/01/10/ThreadLocal%E5%8E%9F%E7%90%86/"/>
    <url>/2026/01/10/ThreadLocal%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="ThreadLocal-åŸç†"><a href="#ThreadLocal-åŸç†" class="headerlink" title="ThreadLocal åŸç†"></a>ThreadLocal åŸç†</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><code>ThreadLocal</code> æä¾›<strong>çº¿ç¨‹æœ¬åœ°å˜é‡</strong>ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œå®ç°çº¿ç¨‹é—´æ•°æ®éš”ç¦»ã€‚</p><h2 id="æ ¸å¿ƒæ•°æ®ç»“æ„"><a href="#æ ¸å¿ƒæ•°æ®ç»“æ„" class="headerlink" title="æ ¸å¿ƒæ•°æ®ç»“æ„"></a>æ ¸å¿ƒæ•°æ®ç»“æ„</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">Thread<br>  â””â”€â”€ ThreadLocalMap threadLocals<br>        â””â”€â”€ Entry<span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">table</span><br>              â””â”€â”€ Entry(ThreadLocal&lt;?&gt; key, <span class="hljs-selector-tag">Object</span> value)<br></code></pre></td></tr></table></figure><table><thead><tr><th>ç»„ä»¶</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>Thread.threadLocals</code></td><td>æ¯ä¸ªçº¿ç¨‹æŒæœ‰çš„ ThreadLocalMap å®ä¾‹</td></tr><tr><td><code>ThreadLocalMap</code></td><td>è‡ªå®šä¹‰å“ˆå¸Œè¡¨ï¼Œå­˜å‚¨çº¿ç¨‹æœ¬åœ°å˜é‡</td></tr><tr><td><code>Entry</code></td><td>ç»§æ‰¿ <code>WeakReference&lt;ThreadLocal&lt;?&gt;&gt;</code> çš„é”®å€¼å¯¹</td></tr></tbody></table><h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><h3 id="1-set-æ–¹æ³•"><a href="#1-set-æ–¹æ³•" class="headerlink" title="1. set() æ–¹æ³•"></a>1. set() æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);  <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹çš„ ThreadLocalMap</span><br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>        map.set(<span class="hljs-built_in">this</span>, value);        <span class="hljs-comment">// this æ˜¯ ThreadLocal å®ä¾‹ä½œä¸º key</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        createMap(t, value);         <span class="hljs-comment">// é¦–æ¬¡ä½¿ç”¨ï¼Œåˆ›å»º map</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-get-æ–¹æ³•"><a href="#2-get-æ–¹æ³•" class="headerlink" title="2. get() æ–¹æ³•"></a>2. get() æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> (T) e.value;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> setInitialValue();  <span class="hljs-comment">// è¿”å›åˆå§‹å€¼</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-æ•°æ®å­˜å‚¨ä½ç½®"><a href="#3-æ•°æ®å­˜å‚¨ä½ç½®" class="headerlink" title="3. æ•°æ®å­˜å‚¨ä½ç½®"></a>3. æ•°æ®å­˜å‚¨ä½ç½®</h3><pre><code class=" mermaid">graph LR    A[ThreadLocal.get/set] --&gt; B[Thread.currentThread]    B --&gt; C[thread.threadLocals]    C --&gt; D[ThreadLocalMap]    D --&gt; E[Entryæ•°ç»„]    E --&gt; F[&quot;key=ThreadLocalå®ä¾‹&lt;br/&gt;value=çº¿ç¨‹æœ¬åœ°å€¼&quot;]</code></pre><h2 id="å…³é”®è®¾è®¡"><a href="#å…³é”®è®¾è®¡" class="headerlink" title="å…³é”®è®¾è®¡"></a>å…³é”®è®¾è®¡</h2><h3 id="Entry-ä½¿ç”¨å¼±å¼•ç”¨"><a href="#Entry-ä½¿ç”¨å¼±å¼•ç”¨" class="headerlink" title="Entry ä½¿ç”¨å¼±å¼•ç”¨"></a>Entry ä½¿ç”¨å¼±å¼•ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;<br>    Object value;<br>    Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;<br>        <span class="hljs-built_in">super</span>(k);  <span class="hljs-comment">// key æ˜¯å¼±å¼•ç”¨</span><br>        value = v; <span class="hljs-comment">// value æ˜¯å¼ºå¼•ç”¨</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆ key ç”¨å¼±å¼•ç”¨ï¼Ÿ</strong> ğŸ‘‰Javaå¼•ç”¨ç±»å‹è¯¦è§£ ^weak-ref-design</p><ul><li>å½“å¤–éƒ¨ä¸å†æŒæœ‰ ThreadLocal å¼•ç”¨æ—¶ï¼ŒGC å¯ä»¥å›æ”¶ ThreadLocal å¯¹è±¡</li><li>é¿å… ThreadLocal å¯¹è±¡æœ¬èº«çš„å†…å­˜æ³„æ¼</li></ul><h3 id="å“ˆå¸Œå†²çªå¤„ç†"><a href="#å“ˆå¸Œå†²çªå¤„ç†" class="headerlink" title="å“ˆå¸Œå†²çªå¤„ç†"></a>å“ˆå¸Œå†²çªå¤„ç†</h3><p>ThreadLocalMap ä½¿ç”¨<strong>çº¿æ€§æ¢æµ‹æ³•</strong>è§£å†³å“ˆå¸Œå†²çªï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(ThreadLocal&lt;?&gt; key, Object value)</span> &#123;<br>    Entry[] tab = table;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> tab.length;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> key.threadLocalHashCode &amp; (len - <span class="hljs-number">1</span>);  <span class="hljs-comment">// è®¡ç®—ä¸‹æ ‡</span><br>    <br>    <span class="hljs-comment">// çº¿æ€§æ¢æµ‹</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> tab[i]; e != <span class="hljs-literal">null</span>; e = tab[i = nextIndex(i, len)]) &#123;<br>        <span class="hljs-comment">// æ‰¾åˆ°ç›¸åŒ key æˆ–ç©ºæ§½ä½</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å†…å­˜æ³„æ¼é—®é¢˜"><a href="#å†…å­˜æ³„æ¼é—®é¢˜" class="headerlink" title="å†…å­˜æ³„æ¼é—®é¢˜"></a>å†…å­˜æ³„æ¼é—®é¢˜</h2><h3 id="æ³„æ¼åœºæ™¯"><a href="#æ³„æ¼åœºæ™¯" class="headerlink" title="æ³„æ¼åœºæ™¯"></a>æ³„æ¼åœºæ™¯</h3><table><thead><tr><th>æ¡ä»¶</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>ThreadLocal è¢«å›æ”¶ï¼ˆå¼±å¼•ç”¨ï¼‰</td><td>Entry.key &#x3D; null</td></tr><tr><td>çº¿ç¨‹ä»å­˜æ´»ï¼ˆå¦‚çº¿ç¨‹æ± ï¼‰</td><td>Entry.value æ— æ³•å›æ”¶</td></tr></tbody></table><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p><strong>å§‹ç»ˆåœ¨ä½¿ç”¨åè°ƒç”¨ <code>remove()</code></strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadLocal&lt;User&gt; userContext = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br><br><span class="hljs-keyword">try</span> &#123;<br>    userContext.set(currentUser);<br>    <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span><br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>    userContext.remove();  <span class="hljs-comment">// å¿…é¡»æ¸…ç†ï¼</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…¸å‹åº”ç”¨åœºæ™¯"><a href="#å…¸å‹åº”ç”¨åœºæ™¯" class="headerlink" title="å…¸å‹åº”ç”¨åœºæ™¯"></a>å…¸å‹åº”ç”¨åœºæ™¯</h2><table><thead><tr><th>åœºæ™¯</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>ç”¨æˆ·ä¸Šä¸‹æ–‡</td><td>å­˜å‚¨å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</td></tr><tr><td>æ•°æ®åº“è¿æ¥</td><td>ä¿è¯åŒä¸€çº¿ç¨‹ä½¿ç”¨åŒä¸€è¿æ¥</td></tr><tr><td>äº‹åŠ¡ç®¡ç†</td><td>Spring çš„äº‹åŠ¡åŒæ­¥</td></tr><tr><td>æ—¥æœŸæ ¼å¼åŒ–</td><td>SimpleDateFormat çº¿ç¨‹å®‰å…¨ä½¿ç”¨</td></tr><tr><td>é“¾è·¯è¿½è¸ª</td><td>TraceId åœ¨çº¿ç¨‹å†…ä¼ é€’</td></tr></tbody></table><h2 id="ä¸åŒæ­¥æœºåˆ¶å¯¹æ¯”"><a href="#ä¸åŒæ­¥æœºåˆ¶å¯¹æ¯”" class="headerlink" title="ä¸åŒæ­¥æœºåˆ¶å¯¹æ¯”"></a>ä¸åŒæ­¥æœºåˆ¶å¯¹æ¯”</h2><table><thead><tr><th>ç‰¹æ€§</th><th>ThreadLocal</th><th>synchronized&#x2F;Lock</th></tr></thead><tbody><tr><td>åŸç†</td><td>ç©ºé—´æ¢æ—¶é—´ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä»½å‰¯æœ¬</td><td>æ—¶é—´æ¢ç©ºé—´ï¼Œæ’é˜Ÿè®¿é—®</td></tr><tr><td>æ€§èƒ½</td><td>æ— ç«äº‰ï¼Œæ€§èƒ½é«˜</td><td>æœ‰é”ç«äº‰å¼€é”€</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>çº¿ç¨‹ç‹¬äº«æ•°æ®</td><td>çº¿ç¨‹å…±äº«æ•°æ®</td></tr></tbody></table><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šæ•°æ®å­˜åœ¨æ¯ä¸ªçº¿ç¨‹çš„ <code>threadLocals</code> å­—æ®µä¸­</li><li><strong>æ•°æ®ç»“æ„</strong>ï¼šThreadLocalMap æ˜¯è‡ªå®šä¹‰å“ˆå¸Œè¡¨ï¼ŒEntry çš„ key æ˜¯å¼±å¼•ç”¨</li><li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šç”¨ç©ºé—´æ¢æ—¶é—´ï¼Œé¿å…åŒæ­¥å¼€é”€</li><li><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šä½¿ç”¨åå¿…é¡»è°ƒç”¨ <code>remove()</code> é˜²æ­¢å†…å­˜æ³„æ¼</li></ol>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>å¹¶å‘ç¼–ç¨‹</category>
      
      <category>åŸºç¡€çŸ¥è¯†</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>å¹¶å‘ç¼–ç¨‹</tag>
      
      <tag>ThreadLocal</tag>
      
      <tag>çº¿ç¨‹å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Sinksè¯¦è§£</title>
    <link href="/2026/01/10/Sinks%E8%AF%A6%E8%A7%A3/"/>
    <url>/2026/01/10/Sinks%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Sinks-è¯¦è§£"><a href="#Sinks-è¯¦è§£" class="headerlink" title="Sinks è¯¦è§£"></a>Sinks è¯¦è§£</h1><h2 id="ä»€ä¹ˆæ˜¯-Sinks"><a href="#ä»€ä¹ˆæ˜¯-Sinks" class="headerlink" title="ä»€ä¹ˆæ˜¯ Sinks"></a>ä»€ä¹ˆæ˜¯ Sinks</h2><p><strong>Sinks æ˜¯ Reactor æä¾›çš„â€æ‰‹åŠ¨å‘é€æ•°æ®â€çš„å·¥å…·</strong>ï¼Œè®©ä½ å¯ä»¥åœ¨ä»£ç ä¸­ä¸»åŠ¨ push æ•°æ®åˆ°å“åº”å¼æµä¸­ã€‚</p><h3 id="æ ¸å¿ƒé—®é¢˜ï¼šMono-Flux-çš„å±€é™"><a href="#æ ¸å¿ƒé—®é¢˜ï¼šMono-Flux-çš„å±€é™" class="headerlink" title="æ ¸å¿ƒé—®é¢˜ï¼šMono&#x2F;Flux çš„å±€é™"></a>æ ¸å¿ƒé—®é¢˜ï¼šMono&#x2F;Flux çš„å±€é™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Mono/Flux é€šå¸¸æ˜¯&quot;è¢«åŠ¨&quot;çš„ - æ•°æ®åœ¨åˆ›å»ºæ—¶å°±ç¡®å®šäº†</span><br>Mono.just(<span class="hljs-string">&quot;hello&quot;</span>);           <span class="hljs-comment">// æ•°æ®å·²ç¡®å®š</span><br>Flux.fromIterable(list);      <span class="hljs-comment">// æ•°æ®å·²ç¡®å®š</span><br>Flux.interval(Duration.ofSeconds(<span class="hljs-number">1</span>));  <span class="hljs-comment">// æ•°æ®æŒ‰è§„åˆ™ç”Ÿæˆ</span><br></code></pre></td></tr></table></figure><p><strong>ä½†æœ‰äº›åœºæ™¯éœ€è¦â€ä¸»åŠ¨â€å‘é€æ•°æ®</strong>ï¼š</p><ul><li>æ¥æ”¶å¤–éƒ¨äº‹ä»¶ï¼ˆWebSocketã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰</li><li>ç”¨æˆ·äº¤äº’è§¦å‘</li><li>å¼‚æ­¥å›è°ƒç»“æœ</li><li>å¤šä¸ªåœ°æ–¹äº§ç”Ÿæ•°æ®ï¼Œæ±‡èšåˆ°ä¸€ä¸ªæµ</li></ul><h3 id="Sinks-çš„ä½œç”¨"><a href="#Sinks-çš„ä½œç”¨" class="headerlink" title="Sinks çš„ä½œç”¨"></a>Sinks çš„ä½œç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Sinks è®©ä½ å¯ä»¥&quot;ä¸»åŠ¨&quot;å‘é€æ•°æ®</span><br>Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// åœ¨ä»»ä½•åœ°æ–¹ã€ä»»ä½•æ—¶å€™å‘é€æ•°æ®</span><br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯1&quot;</span>);<br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯2&quot;</span>);<br><br><span class="hljs-comment">// è®¢é˜…è€…å¯ä»¥æ”¶åˆ°è¿™äº›æ•°æ®</span><br>sink.asFlux().subscribe(System.out::println);<br></code></pre></td></tr></table></figure><hr><h2 id="Sinks-ä¸-Mono-Flux-çš„å…³ç³»"><a href="#Sinks-ä¸-Mono-Flux-çš„å…³ç³»" class="headerlink" title="Sinks ä¸ Mono&#x2F;Flux çš„å…³ç³»"></a>Sinks ä¸ Mono&#x2F;Flux çš„å…³ç³»</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                        æ•°æ®ç”Ÿäº§æ–¹å¼                          â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚                                                             â”‚<br>â”‚   Mono/Flux (è¢«åŠ¨)              Sinks (ä¸»åŠ¨)                â”‚<br>â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚<br>â”‚   æ•°æ®åœ¨åˆ›å»ºæ—¶ç¡®å®š              æ•°æ®å¯ä»¥éšæ—¶å‘é€              â”‚<br>â”‚   <span class="hljs-built_in">just</span>(), <span class="hljs-built_in">fromIterable</span>()       <span class="hljs-built_in">tryEmitNext</span>()               â”‚<br>â”‚   <span class="hljs-built_in">interval</span>(), <span class="hljs-built_in">range</span>()          <span class="hljs-built_in">tryEmitComplete</span>()           â”‚<br>â”‚                                                             â”‚<br>â”‚                    â†“ è½¬æ¢ â†“                                 â”‚<br>â”‚                                                             â”‚<br>â”‚              sink<span class="hljs-selector-class">.asFlux</span>() â†’ Flux&lt;T&gt;                        â”‚<br>â”‚              sink<span class="hljs-selector-class">.asMono</span>() â†’ Mono&lt;T&gt;                        â”‚<br>â”‚                                                             â”‚<br>â”‚   æœ€ç»ˆéƒ½æ˜¯ Flux/Monoï¼Œè®¢é˜…è€…æ— æ„ŸçŸ¥å·®å¼‚                        â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><p>æœ¬è´¨ï¼šSinks æ˜¯ Flux&#x2F;Mono çš„æ•°æ®æºï¼Œå®ƒç”Ÿäº§æ•°æ®ï¼ŒFlux&#x2F;Mono ä¼ é€’æ•°æ®ã€‚</p><hr><h2 id="Sinks-çš„ä¸‰ç§ç±»å‹"><a href="#Sinks-çš„ä¸‰ç§ç±»å‹" class="headerlink" title="Sinks çš„ä¸‰ç§ç±»å‹"></a>Sinks çš„ä¸‰ç§ç±»å‹</h2><h3 id="1-Sinks-One-å•å€¼ï¼ˆå¯¹åº”-Monoï¼‰"><a href="#1-Sinks-One-å•å€¼ï¼ˆå¯¹åº”-Monoï¼‰" class="headerlink" title="1. Sinks.One - å•å€¼ï¼ˆå¯¹åº” Monoï¼‰"></a>1. Sinks.One - å•å€¼ï¼ˆå¯¹åº” Monoï¼‰</h3><p>åªèƒ½å‘é€ 0 æˆ– 1 ä¸ªå€¼ï¼Œç„¶åå®Œæˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">Sinks.One&lt;String&gt; sink = Sinks.one();<br><br><span class="hljs-comment">// å‘é€ä¸€ä¸ªå€¼</span><br>sink.tryEmitValue(<span class="hljs-string">&quot;ç»“æœ&quot;</span>);<br><br><span class="hljs-comment">// è½¬ä¸º Mono</span><br>Mono&lt;String&gt; mono = sink.asMono();<br>mono.subscribe(System.out::println);  <span class="hljs-comment">// è¾“å‡º: ç»“æœ</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨åœºæ™¯ï¼šå¼‚æ­¥æ“ä½œçš„å•ä¸ªç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç¤ºä¾‹ï¼šå°è£…å¼‚æ­¥å›è°ƒ</span><br><span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">fetchUserAsync</span><span class="hljs-params">(Long id)</span> &#123;<br>    Sinks.One&lt;User&gt; sink = Sinks.one();<br>    <br>    <span class="hljs-comment">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªå›è°ƒå¼çš„ API</span><br>    asyncClient.getUser(id, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>&lt;User&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(User user)</span> &#123;<br>            sink.tryEmitValue(user);  <span class="hljs-comment">// æˆåŠŸæ—¶å‘é€å€¼</span><br>        &#125;<br>        <br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Exception e)</span> &#123;<br>            sink.tryEmitError(e);     <span class="hljs-comment">// å¤±è´¥æ—¶å‘é€é”™è¯¯</span><br>        &#125;<br>    &#125;);<br>    <br>    <span class="hljs-keyword">return</span> sink.asMono();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-Sinks-Empty-æ— å€¼ï¼ˆå¯¹åº”-Monoï¼‰"><a href="#2-Sinks-Empty-æ— å€¼ï¼ˆå¯¹åº”-Monoï¼‰" class="headerlink" title="2. Sinks.Empty - æ— å€¼ï¼ˆå¯¹åº” Monoï¼‰"></a>2. Sinks.Empty - æ— å€¼ï¼ˆå¯¹åº” Mono<Void>ï¼‰</h3><p>åªå‘é€å®Œæˆæˆ–é”™è¯¯ä¿¡å·ï¼Œä¸å‘é€å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">Sinks.Empty&lt;Void&gt; sink = Sinks.empty();<br><br><span class="hljs-comment">// å‘é€å®Œæˆä¿¡å·</span><br>sink.tryEmitEmpty();<br><br><span class="hljs-comment">// è½¬ä¸º Mono&lt;Void&gt;</span><br>Mono&lt;Void&gt; mono = sink.asMono();<br>mono.subscribe(<br>    v -&gt; &#123;&#125;,<br>    e -&gt; &#123;&#125;,<br>    () -&gt; System.out.println(<span class="hljs-string">&quot;å®Œæˆäº†&quot;</span>)  <span class="hljs-comment">// è¾“å‡º: å®Œæˆäº†</span><br>);<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨åœºæ™¯ï¼šåªå…³å¿ƒæ“ä½œæ˜¯å¦å®Œæˆï¼Œä¸å…³å¿ƒè¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç¤ºä¾‹ï¼šç­‰å¾…åˆå§‹åŒ–å®Œæˆ</span><br><span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">waitForInit</span><span class="hljs-params">()</span> &#123;<br>    Sinks.Empty&lt;Void&gt; sink = Sinks.empty();<br>    <br>    initService.onReady(() -&gt; sink.tryEmitEmpty());<br>    <br>    <span class="hljs-keyword">return</span> sink.asMono();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-Sinks-Many-å¤šå€¼ï¼ˆå¯¹åº”-Fluxï¼‰"><a href="#3-Sinks-Many-å¤šå€¼ï¼ˆå¯¹åº”-Fluxï¼‰" class="headerlink" title="3. Sinks.Many - å¤šå€¼ï¼ˆå¯¹åº” Fluxï¼‰"></a>3. Sinks.Many - å¤šå€¼ï¼ˆå¯¹åº” Fluxï¼‰</h3><p>å¯ä»¥å‘é€ 0 åˆ° N ä¸ªå€¼ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// å‘é€å¤šä¸ªå€¼</span><br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯1&quot;</span>);<br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯2&quot;</span>);<br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯3&quot;</span>);<br>sink.tryEmitComplete();<br><br><span class="hljs-comment">// è½¬ä¸º Flux</span><br>Flux&lt;String&gt; flux = sink.asFlux();<br>flux.subscribe(System.out::println);<br><span class="hljs-comment">// è¾“å‡º: æ¶ˆæ¯1, æ¶ˆæ¯2, æ¶ˆæ¯3</span><br></code></pre></td></tr></table></figure><hr><h2 id="Sinks-Many-çš„ä¸‰ç§æ¨¡å¼"><a href="#Sinks-Many-çš„ä¸‰ç§æ¨¡å¼" class="headerlink" title="Sinks.Many çš„ä¸‰ç§æ¨¡å¼"></a>Sinks.Many çš„ä¸‰ç§æ¨¡å¼</h2><h3 id="1-Unicastï¼ˆå•æ’­ï¼‰-åªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…"><a href="#1-Unicastï¼ˆå•æ’­ï¼‰-åªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…" class="headerlink" title="1. Unicastï¼ˆå•æ’­ï¼‰- åªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…"></a>1. Unicastï¼ˆå•æ’­ï¼‰- åªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">Sinks.Many&lt;String&gt; sink = Sinks.many().unicast().onBackpressureBuffer();<br><br>Flux&lt;String&gt; flux = sink.asFlux();<br><br><span class="hljs-comment">// ç¬¬ä¸€ä¸ªè®¢é˜…è€… </span><br>flux.subscribe(v -&gt; System.out.println(<span class="hljs-string">&quot;è®¢é˜…è€…1: &quot;</span> + v));<br><br><span class="hljs-comment">// ç¬¬äºŒä¸ªè®¢é˜…è€…  ä¼šæŠ¥é”™ï¼</span><br>flux.subscribe(v -&gt; System.out.println(<span class="hljs-string">&quot;è®¢é˜…è€…2: &quot;</span> + v));<br><span class="hljs-comment">// æŠ›å‡º IllegalStateException</span><br></code></pre></td></tr></table></figure><p>ç‰¹ç‚¹ï¼š</p><ul><li>åªå…è®¸ä¸€ä¸ªè®¢é˜…è€…</li><li>å†…å­˜æ•ˆç‡é«˜ï¼ˆä¸éœ€è¦ç»´æŠ¤å¤šä¸ªè®¢é˜…è€…çŠ¶æ€ï¼‰</li><li>é€‚åˆç‚¹å¯¹ç‚¹é€šä¿¡</li></ul><h3 id="2-Multicastï¼ˆå¤šæ’­ï¼‰-å¤šä¸ªè®¢é˜…è€…å…±äº«"><a href="#2-Multicastï¼ˆå¤šæ’­ï¼‰-å¤šä¸ªè®¢é˜…è€…å…±äº«" class="headerlink" title="2. Multicastï¼ˆå¤šæ’­ï¼‰- å¤šä¸ªè®¢é˜…è€…å…±äº«"></a>2. Multicastï¼ˆå¤šæ’­ï¼‰- å¤šä¸ªè®¢é˜…è€…å…±äº«</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br><br>Flux&lt;String&gt; flux = sink.asFlux();<br><br><span class="hljs-comment">// å¤šä¸ªè®¢é˜…è€…éƒ½å¯ä»¥æ”¶åˆ°æ•°æ® </span><br>flux.subscribe(v -&gt; System.out.println(<span class="hljs-string">&quot;è®¢é˜…è€…1: &quot;</span> + v));<br>flux.subscribe(v -&gt; System.out.println(<span class="hljs-string">&quot;è®¢é˜…è€…2: &quot;</span> + v));<br><br>sink.tryEmitNext(<span class="hljs-string">&quot;Hello&quot;</span>);<br><span class="hljs-comment">// è¾“å‡º:</span><br><span class="hljs-comment">// è®¢é˜…è€…1: Hello</span><br><span class="hljs-comment">// è®¢é˜…è€…2: Hello</span><br></code></pre></td></tr></table></figure><p>ç‰¹ç‚¹ï¼š</p><ul><li>å…è®¸å¤šä¸ªè®¢é˜…è€…</li><li>çƒ­æµï¼šæ–°è®¢é˜…è€…åªèƒ½æ”¶åˆ°è®¢é˜…åçš„æ•°æ®</li><li>é€‚åˆå¹¿æ’­åœºæ™¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// çƒ­æµç‰¹æ€§æ¼”ç¤º</span><br>Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br><br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯1&quot;</span>);  <span class="hljs-comment">// æ­¤æ—¶æ²¡æœ‰è®¢é˜…è€…ï¼Œæ¶ˆæ¯ä¸¢å¤±</span><br><br>Flux&lt;String&gt; flux = sink.asFlux();<br>flux.subscribe(v -&gt; System.out.println(<span class="hljs-string">&quot;æ”¶åˆ°: &quot;</span> + v));<br><br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯2&quot;</span>);  <span class="hljs-comment">// è®¢é˜…è€…æ”¶åˆ°</span><br><span class="hljs-comment">// è¾“å‡º: æ”¶åˆ°: æ¶ˆæ¯2</span><br></code></pre></td></tr></table></figure><h3 id="3-Replayï¼ˆé‡æ”¾ï¼‰-æ–°è®¢é˜…è€…å¯æ”¶åˆ°å†å²æ•°æ®"><a href="#3-Replayï¼ˆé‡æ”¾ï¼‰-æ–°è®¢é˜…è€…å¯æ”¶åˆ°å†å²æ•°æ®" class="headerlink" title="3. Replayï¼ˆé‡æ”¾ï¼‰- æ–°è®¢é˜…è€…å¯æ”¶åˆ°å†å²æ•°æ®"></a>3. Replayï¼ˆé‡æ”¾ï¼‰- æ–°è®¢é˜…è€…å¯æ”¶åˆ°å†å²æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é‡æ”¾æ‰€æœ‰å†å²æ•°æ®</span><br>Sinks.Many&lt;String&gt; sink = Sinks.many().replay().all();<br><br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯1&quot;</span>);<br>sink.tryEmitNext(<span class="hljs-string">&quot;æ¶ˆæ¯2&quot;</span>);<br><br><span class="hljs-comment">// æ–°è®¢é˜…è€…å¯ä»¥æ”¶åˆ°ä¹‹å‰çš„æ•°æ®ï¼</span><br>sink.asFlux().subscribe(v -&gt; System.out.println(<span class="hljs-string">&quot;æ”¶åˆ°: &quot;</span> + v));<br><span class="hljs-comment">// è¾“å‡º:</span><br><span class="hljs-comment">// æ”¶åˆ°: æ¶ˆæ¯1</span><br><span class="hljs-comment">// æ”¶åˆ°: æ¶ˆæ¯2</span><br></code></pre></td></tr></table></figure><p>Replay çš„å˜ä½“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é‡æ”¾æ‰€æœ‰</span><br>Sinks.many().replay().all();<br><br><span class="hljs-comment">// é‡æ”¾æœ€è¿‘ N æ¡</span><br>Sinks.many().replay().limit(<span class="hljs-number">10</span>);<br><br><span class="hljs-comment">// åªé‡æ”¾æœ€æ–°ä¸€æ¡</span><br>Sinks.many().replay().latest();<br><br><span class="hljs-comment">// é‡æ”¾æŒ‡å®šæ—¶é—´å†…çš„æ•°æ®</span><br>Sinks.many().replay().limit(Duration.ofMinutes(<span class="hljs-number">5</span>));<br></code></pre></td></tr></table></figure><hr><h2 id="ä¸‰ç§æ¨¡å¼å¯¹æ¯”"><a href="#ä¸‰ç§æ¨¡å¼å¯¹æ¯”" class="headerlink" title="ä¸‰ç§æ¨¡å¼å¯¹æ¯”"></a>ä¸‰ç§æ¨¡å¼å¯¹æ¯”</h2><table><thead><tr><th>æ¨¡å¼</th><th>è®¢é˜…è€…æ•°é‡</th><th>å†å²æ•°æ®</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Unicast</strong></td><td>1ä¸ª</td><td>æ— </td><td>ç‚¹å¯¹ç‚¹ã€é˜Ÿåˆ—æ¶ˆè´¹</td></tr><tr><td><strong>Multicast</strong></td><td>å¤šä¸ª</td><td>æ— ï¼ˆçƒ­æµï¼‰</td><td>äº‹ä»¶å¹¿æ’­ã€å®æ—¶æ¨é€</td></tr><tr><td><strong>Replay</strong></td><td>å¤šä¸ª</td><td>æœ‰ï¼ˆå¯é…ç½®ï¼‰</td><td>çŠ¶æ€å…±äº«ã€ç¼“å­˜</td></tr></tbody></table><hr><h2 id="å‘é€æ•°æ®çš„æ–¹æ³•"><a href="#å‘é€æ•°æ®çš„æ–¹æ³•" class="headerlink" title="å‘é€æ•°æ®çš„æ–¹æ³•"></a>å‘é€æ•°æ®çš„æ–¹æ³•</h2><h3 id="tryEmitXxx-vs-emitXxx"><a href="#tryEmitXxx-vs-emitXxx" class="headerlink" title="tryEmitXxx vs emitXxx"></a>tryEmitXxx vs emitXxx</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// æ–¹å¼1: tryEmitXxx - è¿”å›ç»“æœï¼Œä¸æŠ›å¼‚å¸¸</span><br>Sinks.<span class="hljs-type">EmitResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> sink.tryEmitNext(<span class="hljs-string">&quot;data&quot;</span>);<br><span class="hljs-keyword">if</span> (result.isFailure()) &#123;<br>    <span class="hljs-comment">// å¤„ç†å¤±è´¥</span><br>    System.out.println(<span class="hljs-string">&quot;å‘é€å¤±è´¥: &quot;</span> + result);<br>&#125;<br><br><span class="hljs-comment">// æ–¹å¼2: emitXxx - å¯è‡ªå®šä¹‰å¤±è´¥å¤„ç†</span><br>sink.emitNext(<span class="hljs-string">&quot;data&quot;</span>, (signalType, emitResult) -&gt; &#123;<br>    <span class="hljs-comment">// è¿”å› true è¡¨ç¤ºé‡è¯•ï¼Œfalse è¡¨ç¤ºæ”¾å¼ƒ</span><br>    <span class="hljs-keyword">return</span> emitResult == Sinks.EmitResult.FAIL_NON_SERIALIZED;<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="EmitResult-çš„ç±»å‹"><a href="#EmitResult-çš„ç±»å‹" class="headerlink" title="EmitResult çš„ç±»å‹"></a>EmitResult çš„ç±»å‹</h3><table><thead><tr><th>ç»“æœ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>OK</code></td><td>å‘é€æˆåŠŸ</td></tr><tr><td><code>FAIL_TERMINATED</code></td><td>Sink å·²ç»ˆæ­¢</td></tr><tr><td><code>FAIL_OVERFLOW</code></td><td>èƒŒå‹æº¢å‡º</td></tr><tr><td><code>FAIL_CANCELLED</code></td><td>å·²å–æ¶ˆ</td></tr><tr><td><code>FAIL_NON_SERIALIZED</code></td><td>å¹¶å‘å†²çªï¼ˆå¤šçº¿ç¨‹åŒæ—¶å‘é€ï¼‰</td></tr><tr><td><code>FAIL_ZERO_SUBSCRIBER</code></td><td>æ²¡æœ‰è®¢é˜…è€…ï¼ˆunicastï¼‰</td></tr></tbody></table><h3 id="å¸¸ç”¨çš„-EmitFailureHandler"><a href="#å¸¸ç”¨çš„-EmitFailureHandler" class="headerlink" title="å¸¸ç”¨çš„ EmitFailureHandler"></a>å¸¸ç”¨çš„ EmitFailureHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¿«é€Ÿå¤±è´¥ - å¤±è´¥å°±æ”¾å¼ƒ</span><br>Sinks.EmitFailureHandler.FAIL_FAST<br><br><span class="hljs-comment">// å¿™ç­‰å¾…é‡è¯• - é€‚åˆå¹¶å‘åœºæ™¯</span><br>Sinks.EmitFailureHandler.busyLooping(Duration.ofMillis(<span class="hljs-number">100</span>))<br></code></pre></td></tr></table></figure><hr><h2 id="å®æˆ˜ç¤ºä¾‹"><a href="#å®æˆ˜ç¤ºä¾‹" class="headerlink" title="å®æˆ˜ç¤ºä¾‹"></a>å®æˆ˜ç¤ºä¾‹</h2><h3 id="ç¤ºä¾‹1ï¼šWebSocket-æ¶ˆæ¯æ¨é€"><a href="#ç¤ºä¾‹1ï¼šWebSocket-æ¶ˆæ¯æ¨é€" class="headerlink" title="ç¤ºä¾‹1ï¼šWebSocket æ¶ˆæ¯æ¨é€"></a>ç¤ºä¾‹1ï¼šWebSocket æ¶ˆæ¯æ¨é€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketHandler</span> &#123;<br>    <br>    <span class="hljs-comment">// ç”¨äºå‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å¹¿æ’­æ¶ˆæ¯</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sinks.Many&lt;String&gt; messageSink = <br>        Sinks.many().multicast().onBackpressureBuffer();<br>    <br>    <span class="hljs-comment">// è·å–æ¶ˆæ¯æµï¼Œä¾› WebSocket è®¢é˜…</span><br>    <span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">getMessageStream</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> messageSink.asFlux();<br>    &#125;<br>    <br>    <span class="hljs-comment">// å‘é€æ¶ˆæ¯ç»™æ‰€æœ‰å®¢æˆ·ç«¯</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">broadcast</span><span class="hljs-params">(String message)</span> &#123;<br>        messageSink.tryEmitNext(message);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// WebSocket é…ç½®</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> HandlerMapping <span class="hljs-title function_">webSocketMapping</span><span class="hljs-params">(WebSocketHandler handler)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleUrlHandlerMapping</span>(Map.of(<br>        <span class="hljs-string">&quot;/ws&quot;</span>, session -&gt; session.send(<br>            handler.getMessageStream()<br>                .map(session::textMessage)<br>        )<br>    ), -<span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹2ï¼šäº‹ä»¶æ€»çº¿"><a href="#ç¤ºä¾‹2ï¼šäº‹ä»¶æ€»çº¿" class="headerlink" title="ç¤ºä¾‹2ï¼šäº‹ä»¶æ€»çº¿"></a>ç¤ºä¾‹2ï¼šäº‹ä»¶æ€»çº¿</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventBus</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sinks.Many&lt;Event&gt; eventSink = <br>        Sinks.many().multicast().onBackpressureBuffer();<br>    <br>    <span class="hljs-comment">// å‘å¸ƒäº‹ä»¶</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">(Event event)</span> &#123;<br>        eventSink.tryEmitNext(event);<br>    &#125;<br>    <br>    <span class="hljs-comment">// è®¢é˜…ç‰¹å®šç±»å‹çš„äº‹ä»¶</span><br>    <span class="hljs-keyword">public</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Event</span>&gt; Flux&lt;T&gt; <span class="hljs-title function_">subscribe</span><span class="hljs-params">(Class&lt;T&gt; eventType)</span> &#123;<br>        <span class="hljs-keyword">return</span> eventSink.asFlux()<br>            .filter(eventType::isInstance)<br>            .cast(eventType);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ä½¿ç”¨</span><br>eventBus.subscribe(UserCreatedEvent.class)<br>    .subscribe(event -&gt; System.out.println(<span class="hljs-string">&quot;ç”¨æˆ·åˆ›å»º: &quot;</span> + event.getUserId()));<br><br>eventBus.publish(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserCreatedEvent</span>(<span class="hljs-number">123L</span>));<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹3ï¼šå¼‚æ­¥ä»»åŠ¡ç»“æœæ”¶é›†"><a href="#ç¤ºä¾‹3ï¼šå¼‚æ­¥ä»»åŠ¡ç»“æœæ”¶é›†" class="headerlink" title="ç¤ºä¾‹3ï¼šå¼‚æ­¥ä»»åŠ¡ç»“æœæ”¶é›†"></a>ç¤ºä¾‹3ï¼šå¼‚æ­¥ä»»åŠ¡ç»“æœæ”¶é›†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Flux&lt;Result&gt; <span class="hljs-title function_">executeTasksAsync</span><span class="hljs-params">(List&lt;Task&gt; tasks)</span> &#123;<br>    Sinks.Many&lt;Result&gt; sink = Sinks.many().unicast().onBackpressureBuffer();<br>    <br>    <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">remaining</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(tasks.size());<br>    <br>    <span class="hljs-keyword">for</span> (Task task : tasks) &#123;<br>        CompletableFuture.runAsync(() -&gt; &#123;<br>            <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> task.execute();<br>            sink.tryEmitNext(result);<br>            <br>            <span class="hljs-keyword">if</span> (remaining.decrementAndGet() == <span class="hljs-number">0</span>) &#123;<br>                sink.tryEmitComplete();<br>            &#125;<br>        &#125;);<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> sink.asFlux();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹4ï¼šç¼“å­˜æœ€æ–°çŠ¶æ€"><a href="#ç¤ºä¾‹4ï¼šç¼“å­˜æœ€æ–°çŠ¶æ€" class="headerlink" title="ç¤ºä¾‹4ï¼šç¼“å­˜æœ€æ–°çŠ¶æ€"></a>ç¤ºä¾‹4ï¼šç¼“å­˜æœ€æ–°çŠ¶æ€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StatusCache</span> &#123;<br>    <br>    <span class="hljs-comment">// ä½¿ç”¨ replay().latest() ç¼“å­˜æœ€æ–°çŠ¶æ€</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sinks.Many&lt;SystemStatus&gt; statusSink = <br>        Sinks.many().replay().latest();<br>    <br>    <span class="hljs-comment">// æ›´æ–°çŠ¶æ€</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateStatus</span><span class="hljs-params">(SystemStatus status)</span> &#123;<br>        statusSink.tryEmitNext(status);<br>    &#125;<br>    <br>    <span class="hljs-comment">// è·å–å½“å‰çŠ¶æ€ï¼ˆæ–°è®¢é˜…è€…ç«‹å³æ”¶åˆ°æœ€æ–°çŠ¶æ€ï¼‰</span><br>    <span class="hljs-keyword">public</span> Mono&lt;SystemStatus&gt; <span class="hljs-title function_">getCurrentStatus</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> statusSink.asFlux().next();<br>    &#125;<br>    <br>    <span class="hljs-comment">// ç›‘å¬çŠ¶æ€å˜åŒ–</span><br>    <span class="hljs-keyword">public</span> Flux&lt;SystemStatus&gt; <span class="hljs-title function_">watchStatus</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> statusSink.asFlux();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="Sinks-vs-æ—§ç‰ˆ-Processor"><a href="#Sinks-vs-æ—§ç‰ˆ-Processor" class="headerlink" title="Sinks vs æ—§ç‰ˆ Processor"></a>Sinks vs æ—§ç‰ˆ Processor</h2><p>Reactor 3.4 ä¹‹å‰ä½¿ç”¨ <code>Processor</code>ï¼Œç°åœ¨å·²åºŸå¼ƒï¼š</p><table><thead><tr><th>æ—§ç‰ˆ Processor</th><th>æ–°ç‰ˆ Sinks</th></tr></thead><tbody><tr><td><code>DirectProcessor</code></td><td><code>Sinks.many().multicast().directBestEffort()</code></td></tr><tr><td><code>UnicastProcessor</code></td><td><code>Sinks.many().unicast()</code></td></tr><tr><td><code>ReplayProcessor</code></td><td><code>Sinks.many().replay()</code></td></tr><tr><td><code>EmitterProcessor</code></td><td><code>Sinks.many().multicast()</code></td></tr></tbody></table><p>ä¸ºä»€ä¹ˆåºŸå¼ƒ Processorï¼Ÿ</p><ul><li>Processor åŒæ—¶æ˜¯ Publisher å’Œ Subscriberï¼ŒèŒè´£ä¸æ¸…</li><li>çº¿ç¨‹å®‰å…¨é—®é¢˜éš¾ä»¥å¤„ç†</li><li>Sinks æä¾›æ›´æ¸…æ™°çš„ API å’Œæ›´å¥½çš„çº¿ç¨‹å®‰å…¨ä¿è¯</li></ul><hr><h2 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h2><p>Sinks é»˜è®¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æœ‰æ€§èƒ½å¼€é”€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é»˜è®¤ï¼šçº¿ç¨‹å®‰å…¨</span><br>Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// å¦‚æœç¡®å®šå•çº¿ç¨‹ä½¿ç”¨ï¼Œå¯ä»¥ç”¨ unsafe ç‰ˆæœ¬æå‡æ€§èƒ½</span><br>Sinks.Many&lt;String&gt; unsafeSink = Sinks.unsafe().many().multicast().onBackpressureBuffer();<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š<code>unsafe</code> ç‰ˆæœ¬åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šå‡ºé—®é¢˜ï¼Œåªåœ¨ç¡®å®šå•çº¿ç¨‹æ—¶ä½¿ç”¨ã€‚</p><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table><thead><tr><th>æ¦‚å¿µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Sinks æ˜¯ä»€ä¹ˆ</strong></td><td>æ‰‹åŠ¨å‘é€æ•°æ®åˆ°å“åº”å¼æµçš„å·¥å…·</td></tr><tr><td><strong>ä¸ Mono&#x2F;Flux å…³ç³»</strong></td><td>Sinks æ˜¯æ•°æ®æºï¼Œé€šè¿‡ <code>asFlux()</code>&#x2F;<code>asMono()</code> è½¬æ¢</td></tr><tr><td><strong>Sinks.One</strong></td><td>å‘é€ 0-1 ä¸ªå€¼ï¼Œå¯¹åº” Mono</td></tr><tr><td><strong>Sinks.Empty</strong></td><td>åªå‘é€å®Œæˆ&#x2F;é”™è¯¯ä¿¡å·ï¼Œå¯¹åº” Mono<Void></td></tr><tr><td><strong>Sinks.Many</strong></td><td>å‘é€ 0-N ä¸ªå€¼ï¼Œå¯¹åº” Flux</td></tr><tr><td><strong>Unicast</strong></td><td>å•è®¢é˜…è€…</td></tr><tr><td><strong>Multicast</strong></td><td>å¤šè®¢é˜…è€…ï¼Œçƒ­æµ</td></tr><tr><td><strong>Replay</strong></td><td>å¤šè®¢é˜…è€…ï¼Œå¯é‡æ”¾å†å²</td></tr></tbody></table><hr><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>Reactor API å‚è€ƒ</li><li>Project Reactor å®ç°</li><li>WebFlux æ ¸å¿ƒç»„ä»¶</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Reactive Streams</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>ReactiveStreams</tag>
      
      <tag>Reactor</tag>
      
      <tag>Sinks</tag>
      
      <tag>çƒ­æµ</tag>
      
      <tag>å¤šæ’­</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Webfluxç®€ä»‹</title>
    <link href="/2026/01/10/Webflux%E7%AE%80%E4%BB%8B/"/>
    <url>/2026/01/10/Webflux%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Webflux-ç®€ä»‹"><a href="#Webflux-ç®€ä»‹" class="headerlink" title="Webflux ç®€ä»‹"></a>Webflux ç®€ä»‹</h1><h2 id="ä»€ä¹ˆæ˜¯-Spring-WebFlux"><a href="#ä»€ä¹ˆæ˜¯-Spring-WebFlux" class="headerlink" title="ä»€ä¹ˆæ˜¯ Spring WebFlux"></a>ä»€ä¹ˆæ˜¯ Spring WebFlux</h2><p>Spring WebFlux æ˜¯ Spring Framework 5.0 å¼•å…¥çš„<strong>å“åº”å¼ Web æ¡†æ¶</strong>ï¼Œå®ƒæ˜¯ Spring MVC çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä¸“ä¸ºæ„å»º<strong>éé˜»å¡ã€å¼‚æ­¥</strong>çš„ Web åº”ç”¨ç¨‹åºè€Œè®¾è®¡ã€‚</p><h3 id="æ ¸å¿ƒç‰¹ç‚¹"><a href="#æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="æ ¸å¿ƒç‰¹ç‚¹"></a>æ ¸å¿ƒç‰¹ç‚¹</h3><ul><li><strong>éé˜»å¡ I&#x2F;O</strong>ï¼šåŸºäºäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ç­‰å¾… I&#x2F;O æ“ä½œå®Œæˆ</li><li><strong>å“åº”å¼ç¼–ç¨‹</strong>ï¼šåŸºäº Reactive Streams è§„èŒƒï¼Œä½¿ç”¨ Project Reactor ä½œä¸ºé»˜è®¤å®ç°</li><li><strong>èƒŒå‹æ”¯æŒ</strong>ï¼šæ”¯æŒèƒŒå‹ï¼ˆBackpressureï¼‰æœºåˆ¶ï¼Œé˜²æ­¢ç”Ÿäº§è€…å‹å®æ¶ˆè´¹è€…</li><li><strong>å‡½æ•°å¼ç¼–ç¨‹</strong>ï¼šæ”¯æŒå‡½æ•°å¼ç«¯ç‚¹å®šä¹‰ï¼Œæä¾›æ›´çµæ´»çš„è·¯ç”±æ–¹å¼</li></ul><h2 id="WebFlux-vs-Spring-MVC"><a href="#WebFlux-vs-Spring-MVC" class="headerlink" title="WebFlux vs Spring MVC"></a>WebFlux vs Spring MVC</h2><table><thead><tr><th>ç‰¹æ€§</th><th>Spring MVC</th><th>Spring WebFlux</th></tr></thead><tbody><tr><td>ç¼–ç¨‹æ¨¡å‹</td><td>å‘½ä»¤å¼ï¼ˆImperativeï¼‰</td><td>å“åº”å¼ï¼ˆReactiveï¼‰</td></tr><tr><td>çº¿ç¨‹æ¨¡å‹</td><td>æ¯è¯·æ±‚ä¸€çº¿ç¨‹</td><td>äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰</td></tr><tr><td>I&#x2F;O æ¨¡å‹</td><td>é˜»å¡ I&#x2F;O</td><td>éé˜»å¡ I&#x2F;O</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ä¼ ç»Ÿ Web åº”ç”¨</td><td>é«˜å¹¶å‘ã€æµå¼æ•°æ®</td></tr><tr><td>Servlet ä¾èµ–</td><td>ä¾èµ– Servlet API</td><td>å¯é€‰ï¼ˆæ”¯æŒ Nettyï¼‰</td></tr><tr><td>æ•°æ®åº“æ”¯æŒ</td><td>JDBCï¼ˆé˜»å¡ï¼‰</td><td>R2DBCï¼ˆå“åº”å¼ï¼‰</td></tr></tbody></table><h2 id="ä½•æ—¶ä½¿ç”¨-WebFlux"><a href="#ä½•æ—¶ä½¿ç”¨-WebFlux" class="headerlink" title="ä½•æ—¶ä½¿ç”¨ WebFlux"></a>ä½•æ—¶ä½¿ç”¨ WebFlux</h2><h3 id="é€‚åˆä½¿ç”¨çš„åœºæ™¯"><a href="#é€‚åˆä½¿ç”¨çš„åœºæ™¯" class="headerlink" title="é€‚åˆä½¿ç”¨çš„åœºæ™¯"></a>é€‚åˆä½¿ç”¨çš„åœºæ™¯</h3><ol><li><strong>é«˜å¹¶å‘åº”ç”¨</strong>ï¼šéœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼ˆå¦‚èŠå¤©åº”ç”¨ã€å®æ—¶æ¨é€ï¼‰</li><li><strong>æµå¼æ•°æ®å¤„ç†</strong>ï¼šå¤„ç†å®æ—¶æ•°æ®æµï¼ˆå¦‚è‚¡ç¥¨è¡Œæƒ…ã€IoT æ•°æ®ï¼‰</li><li><strong>å¾®æœåŠ¡ç½‘å…³</strong>ï¼šä½œä¸º API ç½‘å…³å¤„ç†å¤§é‡è¯·æ±‚è½¬å‘</li><li><strong>æœåŠ¡é—´è°ƒç”¨å¯†é›†</strong>ï¼šéœ€è¦å¤§é‡è°ƒç”¨å¤–éƒ¨æœåŠ¡çš„åº”ç”¨</li></ol><h3 id="ä¸é€‚åˆçš„åœºæ™¯"><a href="#ä¸é€‚åˆçš„åœºæ™¯" class="headerlink" title="ä¸é€‚åˆçš„åœºæ™¯"></a>ä¸é€‚åˆçš„åœºæ™¯</h3><ol><li><strong>CPU å¯†é›†å‹ä»»åŠ¡</strong>ï¼šå“åº”å¼ç¼–ç¨‹å¯¹ CPU å¯†é›†å‹ä»»åŠ¡æ²¡æœ‰ä¼˜åŠ¿</li><li><strong>é˜»å¡ä¾èµ–</strong>ï¼šå¦‚æœä¾èµ–çš„åº“æ˜¯é˜»å¡çš„ï¼ˆå¦‚ä¼ ç»Ÿ JDBCï¼‰ï¼Œåˆ™æ— æ³•å‘æŒ¥ä¼˜åŠ¿</li><li><strong>å›¢é˜Ÿä¸ç†Ÿæ‚‰å“åº”å¼ç¼–ç¨‹</strong>ï¼šå­¦ä¹ æ›²çº¿è¾ƒé™¡</li></ol><h2 id="æŠ€æœ¯æ ˆå¯¹æ¯”"><a href="#æŠ€æœ¯æ ˆå¯¹æ¯”" class="headerlink" title="æŠ€æœ¯æ ˆå¯¹æ¯”"></a>æŠ€æœ¯æ ˆå¯¹æ¯”</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                    Spring Boot                          â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚     Spring MVC         â”‚        Spring WebFlux          â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚     Servlet API        â”‚     Reactive Streams API       â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚  Tomcat<span class="hljs-regexp">/Jetty/</span>Undertow â”‚      Netty<span class="hljs-regexp">/Undertow/</span>Servlet    â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><h3 id="Maven-ä¾èµ–"><a href="#Maven-ä¾èµ–" class="headerlink" title="Maven ä¾èµ–"></a>Maven ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br>    <br>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;String&gt; <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-string">&quot;Hello, WebFlux!&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@GetMapping(&quot;/users&quot;)</span><br>    <span class="hljs-keyword">public</span> Flux&lt;User&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.findAll();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸‹ä¸€ç¯‡ï¼šå“åº”å¼ç¼–ç¨‹åŸºç¡€</li><li>Reactoræ ¸å¿ƒAPI</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Webflux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>WebFlux</tag>
      
      <tag>å…¥é—¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‡½æ•°å¼ç«¯ç‚¹</title>
    <link href="/2026/01/10/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%AB%AF%E7%82%B9/"/>
    <url>/2026/01/10/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%AB%AF%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h1 id="å‡½æ•°å¼ç«¯ç‚¹"><a href="#å‡½æ•°å¼ç«¯ç‚¹" class="headerlink" title="å‡½æ•°å¼ç«¯ç‚¹"></a>å‡½æ•°å¼ç«¯ç‚¹</h1><h2 id="ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç«¯ç‚¹"><a href="#ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç«¯ç‚¹" class="headerlink" title="ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç«¯ç‚¹"></a>ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç«¯ç‚¹</h2><p>å‡½æ•°å¼ç«¯ç‚¹ï¼ˆFunctional Endpointsï¼‰æ˜¯ WebFlux æä¾›çš„å¦ä¸€ç§ç¼–ç¨‹æ¨¡å‹ï¼Œä½¿ç”¨<strong>å‡½æ•°å¼é£æ ¼</strong>å®šä¹‰è·¯ç”±å’Œå¤„ç†å™¨ï¼Œç›¸æ¯”æ³¨è§£å¼æ›´åŠ çµæ´»ã€‚</p><h3 id="æ ¸å¿ƒç»„ä»¶"><a href="#æ ¸å¿ƒç»„ä»¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶"></a>æ ¸å¿ƒç»„ä»¶</h3><ul><li><strong>HandlerFunction</strong>ï¼šå¤„ç†è¯·æ±‚çš„å‡½æ•°ï¼Œç±»ä¼¼äº <code>@RequestMapping</code> æ–¹æ³•</li><li><strong>RouterFunction</strong>ï¼šè·¯ç”±å‡½æ•°ï¼Œå°†è¯·æ±‚æ˜ å°„åˆ° HandlerFunction</li></ul><h2 id="HandlerFunction"><a href="#HandlerFunction" class="headerlink" title="HandlerFunction"></a>HandlerFunction</h2><p><code>HandlerFunction&lt;T extends ServerResponse&gt;</code> æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HandlerFunction</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServerResponse</span>&gt; &#123;<br>    Mono&lt;T&gt; <span class="hljs-title function_">handle</span><span class="hljs-params">(ServerRequest request)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å®šä¹‰-Handler"><a href="#å®šä¹‰-Handler" class="headerlink" title="å®šä¹‰ Handler"></a>å®šä¹‰ Handler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserHandler</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService userService;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserHandler</span><span class="hljs-params">(UserService userService)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userService = userService;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;ServerResponse&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">(ServerRequest request)</span> &#123;<br>        <span class="hljs-keyword">return</span> ServerResponse.ok()<br>            .contentType(MediaType.APPLICATION_JSON)<br>            .body(userService.findAll(), User.class);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;ServerResponse&gt; <span class="hljs-title function_">getUserById</span><span class="hljs-params">(ServerRequest request)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> request.pathVariable(<span class="hljs-string">&quot;id&quot;</span>);<br>        <span class="hljs-keyword">return</span> userService.findById(id)<br>            .flatMap(user -&gt; ServerResponse.ok()<br>                .contentType(MediaType.APPLICATION_JSON)<br>                .bodyValue(user))<br>            .switchIfEmpty(ServerResponse.notFound().build());<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;ServerResponse&gt; <span class="hljs-title function_">createUser</span><span class="hljs-params">(ServerRequest request)</span> &#123;<br>        <span class="hljs-keyword">return</span> request.bodyToMono(User.class)<br>            .flatMap(userService::save)<br>            .flatMap(user -&gt; ServerResponse<br>                .created(URI.create(<span class="hljs-string">&quot;/api/users/&quot;</span> + user.getId()))<br>                .contentType(MediaType.APPLICATION_JSON)<br>                .bodyValue(user));<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;ServerResponse&gt; <span class="hljs-title function_">updateUser</span><span class="hljs-params">(ServerRequest request)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> request.pathVariable(<span class="hljs-string">&quot;id&quot;</span>);<br>        <span class="hljs-keyword">return</span> request.bodyToMono(User.class)<br>            .flatMap(user -&gt; userService.update(id, user))<br>            .flatMap(user -&gt; ServerResponse.ok()<br>                .contentType(MediaType.APPLICATION_JSON)<br>                .bodyValue(user))<br>            .switchIfEmpty(ServerResponse.notFound().build());<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;ServerResponse&gt; <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(ServerRequest request)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> request.pathVariable(<span class="hljs-string">&quot;id&quot;</span>);<br>        <span class="hljs-keyword">return</span> userService.deleteById(id)<br>            .then(ServerResponse.noContent().build());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="RouterFunction"><a href="#RouterFunction" class="headerlink" title="RouterFunction"></a>RouterFunction</h2><p><code>RouterFunction&lt;T extends ServerResponse&gt;</code> ç”¨äºå®šä¹‰è·¯ç”±è§„åˆ™ã€‚</p><h3 id="åŸºæœ¬è·¯ç”±å®šä¹‰"><a href="#åŸºæœ¬è·¯ç”±å®šä¹‰" class="headerlink" title="åŸºæœ¬è·¯ç”±å®šä¹‰"></a>åŸºæœ¬è·¯ç”±å®šä¹‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouterConfig</span> &#123;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="hljs-title function_">userRoutes</span><span class="hljs-params">(UserHandler handler)</span> &#123;<br>        <span class="hljs-keyword">return</span> RouterFunctions.route()<br>            .GET(<span class="hljs-string">&quot;/api/users&quot;</span>, handler::getAllUsers)<br>            .GET(<span class="hljs-string">&quot;/api/users/&#123;id&#125;&quot;</span>, handler::getUserById)<br>            .POST(<span class="hljs-string">&quot;/api/users&quot;</span>, handler::createUser)<br>            .PUT(<span class="hljs-string">&quot;/api/users/&#123;id&#125;&quot;</span>, handler::updateUser)<br>            .DELETE(<span class="hljs-string">&quot;/api/users/&#123;id&#125;&quot;</span>, handler::deleteUser)<br>            .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-nest-ç»„ç»‡è·¯ç”±"><a href="#ä½¿ç”¨-nest-ç»„ç»‡è·¯ç”±" class="headerlink" title="ä½¿ç”¨ nest ç»„ç»‡è·¯ç”±"></a>ä½¿ç”¨ nest ç»„ç»‡è·¯ç”±</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="hljs-title function_">routes</span><span class="hljs-params">(UserHandler userHandler, </span><br><span class="hljs-params">                                              OrderHandler orderHandler)</span> &#123;<br>    <span class="hljs-keyword">return</span> RouterFunctions.route()<br>        .nest(path(<span class="hljs-string">&quot;/api/users&quot;</span>), builder -&gt; builder<br>            .GET(<span class="hljs-string">&quot;&quot;</span>, userHandler::getAllUsers)<br>            .GET(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>, userHandler::getUserById)<br>            .POST(<span class="hljs-string">&quot;&quot;</span>, userHandler::createUser)<br>            .PUT(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>, userHandler::updateUser)<br>            .DELETE(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>, userHandler::deleteUser)<br>        )<br>        .nest(path(<span class="hljs-string">&quot;/api/orders&quot;</span>), builder -&gt; builder<br>            .GET(<span class="hljs-string">&quot;&quot;</span>, orderHandler::getAllOrders)<br>            .GET(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>, orderHandler::getOrderById)<br>            .POST(<span class="hljs-string">&quot;&quot;</span>, orderHandler::createOrder)<br>        )<br>        .build();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ·»åŠ è¿‡æ»¤å™¨"><a href="#æ·»åŠ è¿‡æ»¤å™¨" class="headerlink" title="æ·»åŠ è¿‡æ»¤å™¨"></a>æ·»åŠ è¿‡æ»¤å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="hljs-title function_">routes</span><span class="hljs-params">(UserHandler handler)</span> &#123;<br>    <span class="hljs-keyword">return</span> RouterFunctions.route()<br>        .GET(<span class="hljs-string">&quot;/api/users&quot;</span>, handler::getAllUsers)<br>        .GET(<span class="hljs-string">&quot;/api/users/&#123;id&#125;&quot;</span>, handler::getUserById)<br>        .filter((request, next) -&gt; &#123;<br>            <span class="hljs-comment">// å‰ç½®å¤„ç†</span><br>            log.info(<span class="hljs-string">&quot;Request: &#123;&#125; &#123;&#125;&quot;</span>, request.method(), request.path());<br>            <br>            <span class="hljs-keyword">return</span> next.handle(request)<br>                .doOnNext(response -&gt; &#123;<br>                    <span class="hljs-comment">// åç½®å¤„ç†</span><br>                    log.info(<span class="hljs-string">&quot;Response status: &#123;&#125;&quot;</span>, response.statusCode());<br>                &#125;);<br>        &#125;)<br>        .build();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ¡ä»¶è·¯ç”±"><a href="#æ¡ä»¶è·¯ç”±" class="headerlink" title="æ¡ä»¶è·¯ç”±"></a>æ¡ä»¶è·¯ç”±</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="hljs-title function_">routes</span><span class="hljs-params">(UserHandler handler)</span> &#123;<br>    <span class="hljs-keyword">return</span> RouterFunctions.route()<br>        <span class="hljs-comment">// ä½¿ç”¨ RequestPredicate è¿›è¡Œæ¡ä»¶åŒ¹é…</span><br>        .route(GET(<span class="hljs-string">&quot;/api/users&quot;</span>).and(accept(MediaType.APPLICATION_JSON)), <br>               handler::getAllUsers)<br>        .route(GET(<span class="hljs-string">&quot;/api/users&quot;</span>).and(accept(MediaType.TEXT_EVENT_STREAM)), <br>               handler::streamUsers)<br>        .build();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="RequestPredicate"><a href="#RequestPredicate" class="headerlink" title="RequestPredicate"></a>RequestPredicate</h2><p><code>RequestPredicate</code> ç”¨äºå®šä¹‰è¯·æ±‚åŒ¹é…æ¡ä»¶ã€‚</p><h3 id="å¸¸ç”¨è°“è¯"><a href="#å¸¸ç”¨è°“è¯" class="headerlink" title="å¸¸ç”¨è°“è¯"></a>å¸¸ç”¨è°“è¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.springframework.web.reactive.function.server.RequestPredicates.*;<br><br><span class="hljs-comment">// HTTP æ–¹æ³•</span><br>GET(<span class="hljs-string">&quot;/path&quot;</span>)<br>POST(<span class="hljs-string">&quot;/path&quot;</span>)<br>PUT(<span class="hljs-string">&quot;/path&quot;</span>)<br>DELETE(<span class="hljs-string">&quot;/path&quot;</span>)<br><br><span class="hljs-comment">// å†…å®¹ç±»å‹</span><br>accept(MediaType.APPLICATION_JSON)<br>contentType(MediaType.APPLICATION_JSON)<br><br><span class="hljs-comment">// è·¯å¾„åŒ¹é…</span><br>path(<span class="hljs-string">&quot;/api/**&quot;</span>)<br>pathExtension(<span class="hljs-string">&quot;json&quot;</span>)<br><br><span class="hljs-comment">// æŸ¥è¯¢å‚æ•°</span><br>queryParam(<span class="hljs-string">&quot;name&quot;</span>, value -&gt; value.length() &gt; <span class="hljs-number">0</span>)<br><br><span class="hljs-comment">// è¯·æ±‚å¤´</span><br>headers(headers -&gt; headers.header(<span class="hljs-string">&quot;X-Custom&quot;</span>).isPresent())<br><br><span class="hljs-comment">// ç»„åˆæ¡ä»¶</span><br>GET(<span class="hljs-string">&quot;/api/users&quot;</span>).and(accept(MediaType.APPLICATION_JSON))<br>GET(<span class="hljs-string">&quot;/api/users&quot;</span>).or(GET(<span class="hljs-string">&quot;/users&quot;</span>))<br></code></pre></td></tr></table></figure><h2 id="è¯·æ±‚éªŒè¯"><a href="#è¯·æ±‚éªŒè¯" class="headerlink" title="è¯·æ±‚éªŒè¯"></a>è¯·æ±‚éªŒè¯</h2><h3 id="æ‰‹åŠ¨éªŒè¯"><a href="#æ‰‹åŠ¨éªŒè¯" class="headerlink" title="æ‰‹åŠ¨éªŒè¯"></a>æ‰‹åŠ¨éªŒè¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Mono&lt;ServerResponse&gt; <span class="hljs-title function_">createUser</span><span class="hljs-params">(ServerRequest request)</span> &#123;<br>    <span class="hljs-keyword">return</span> request.bodyToMono(User.class)<br>        .flatMap(user -&gt; &#123;<br>            <span class="hljs-comment">// éªŒè¯</span><br>            List&lt;String&gt; errors = validate(user);<br>            <span class="hljs-keyword">if</span> (!errors.isEmpty()) &#123;<br>                <span class="hljs-keyword">return</span> ServerResponse.badRequest()<br>                    .bodyValue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValidationError</span>(errors));<br>            &#125;<br>            <span class="hljs-keyword">return</span> userService.save(user)<br>                .flatMap(saved -&gt; ServerResponse.created(<br>                    URI.create(<span class="hljs-string">&quot;/api/users/&quot;</span> + saved.getId()))<br>                    .bodyValue(saved));<br>        &#125;);<br>&#125;<br><br><span class="hljs-keyword">private</span> List&lt;String&gt; <span class="hljs-title function_">validate</span><span class="hljs-params">(User user)</span> &#123;<br>    List&lt;String&gt; errors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">if</span> (user.getName() == <span class="hljs-literal">null</span> || user.getName().isBlank()) &#123;<br>        errors.add(<span class="hljs-string">&quot;Name is required&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (user.getEmail() == <span class="hljs-literal">null</span> || !user.getEmail().contains(<span class="hljs-string">&quot;@&quot;</span>)) &#123;<br>        errors.add(<span class="hljs-string">&quot;Valid email is required&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> errors;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-Validator"><a href="#ä½¿ç”¨-Validator" class="headerlink" title="ä½¿ç”¨ Validator"></a>ä½¿ç”¨ Validator</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserHandler</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Validator validator;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService userService;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;ServerResponse&gt; <span class="hljs-title function_">createUser</span><span class="hljs-params">(ServerRequest request)</span> &#123;<br>        <span class="hljs-keyword">return</span> request.bodyToMono(User.class)<br>            .flatMap(user -&gt; &#123;<br>                <span class="hljs-type">Errors</span> <span class="hljs-variable">errors</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanPropertyBindingResult</span>(user, <span class="hljs-string">&quot;user&quot;</span>);<br>                validator.validate(user, errors);<br>                <br>                <span class="hljs-keyword">if</span> (errors.hasErrors()) &#123;<br>                    <span class="hljs-keyword">return</span> ServerResponse.badRequest()<br>                        .bodyValue(errors.getAllErrors());<br>                &#125;<br>                <br>                <span class="hljs-keyword">return</span> userService.save(user)<br>                    .flatMap(saved -&gt; ServerResponse.created(<br>                        URI.create(<span class="hljs-string">&quot;/api/users/&quot;</span> + saved.getId()))<br>                        .bodyValue(saved));<br>            &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="hljs-title function_">routes</span><span class="hljs-params">(UserHandler handler)</span> &#123;<br>    <span class="hljs-keyword">return</span> RouterFunctions.route()<br>        .GET(<span class="hljs-string">&quot;/api/users/&#123;id&#125;&quot;</span>, handler::getUserById)<br>        .onError(NotFoundException.class, (e, request) -&gt; <br>            ServerResponse.notFound().build())<br>        .onError(ValidationException.class, (e, request) -&gt; <br>            ServerResponse.badRequest().bodyValue(e.getMessage()))<br>        .onError(Exception.class, (e, request) -&gt; <br>            ServerResponse.status(HttpStatus.INTERNAL_SERVER_ERROR)<br>                .bodyValue(<span class="hljs-string">&quot;Internal server error&quot;</span>))<br>        .build();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‡½æ•°å¼-vs-æ³¨è§£å¼"><a href="#å‡½æ•°å¼-vs-æ³¨è§£å¼" class="headerlink" title="å‡½æ•°å¼ vs æ³¨è§£å¼"></a>å‡½æ•°å¼ vs æ³¨è§£å¼</h2><table><thead><tr><th>ç‰¹æ€§</th><th>æ³¨è§£å¼</th><th>å‡½æ•°å¼</th></tr></thead><tbody><tr><td>ä»£ç é£æ ¼</td><td>å£°æ˜å¼</td><td>å‡½æ•°å¼</td></tr><tr><td>è·¯ç”±å®šä¹‰</td><td>åˆ†æ•£åœ¨å„ä¸ªæ–¹æ³•</td><td>é›†ä¸­åœ¨ä¸€å¤„</td></tr><tr><td>çµæ´»æ€§</td><td>è¾ƒä½</td><td>è¾ƒé«˜</td></tr><tr><td>å­¦ä¹ æ›²çº¿</td><td>è¾ƒä½</td><td>è¾ƒé«˜</td></tr><tr><td>æµ‹è¯•</td><td>éœ€è¦ Spring ä¸Šä¸‹æ–‡</td><td>å¯ä»¥å•å…ƒæµ‹è¯•</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ä¼ ç»Ÿ CRUD</td><td>å¤æ‚è·¯ç”±é€»è¾‘</td></tr></tbody></table><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸Šä¸€ç¯‡ï¼šWebFluxæ ¸å¿ƒç»„ä»¶</li><li>ä¸‹ä¸€ç¯‡ï¼šå®æˆ˜æ¡ˆä¾‹</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Webflux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>WebFlux</tag>
      
      <tag>å‡½æ•°å¼ç¼–ç¨‹</tag>
      
      <tag>RouterFunction</tag>
      
      <tag>HandlerFunction</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WebFluxæ ¸å¿ƒç»„ä»¶</title>
    <link href="/2026/01/10/WebFlux%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/"/>
    <url>/2026/01/10/WebFlux%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="WebFlux-æ ¸å¿ƒç»„ä»¶"><a href="#WebFlux-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="WebFlux æ ¸å¿ƒç»„ä»¶"></a>WebFlux æ ¸å¿ƒç»„ä»¶</h1><h2 id="æ³¨è§£å¼ç¼–ç¨‹æ¨¡å‹"><a href="#æ³¨è§£å¼ç¼–ç¨‹æ¨¡å‹" class="headerlink" title="æ³¨è§£å¼ç¼–ç¨‹æ¨¡å‹"></a>æ³¨è§£å¼ç¼–ç¨‹æ¨¡å‹</h2><p>WebFlux æ”¯æŒä¸ Spring MVC ç±»ä¼¼çš„æ³¨è§£å¼ç¼–ç¨‹ï¼Œä½¿ç”¨ <code>@Controller</code> å’Œ <code>@RestController</code>ã€‚</p><h3 id="åŸºæœ¬æ§åˆ¶å™¨"><a href="#åŸºæœ¬æ§åˆ¶å™¨" class="headerlink" title="åŸºæœ¬æ§åˆ¶å™¨"></a>åŸºæœ¬æ§åˆ¶å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/api/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService userService;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserController</span><span class="hljs-params">(UserService userService)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userService = userService;<br>    &#125;<br>    <br>    <span class="hljs-meta">@GetMapping</span><br>    <span class="hljs-keyword">public</span> Flux&lt;User&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.findAll();<br>    &#125;<br>    <br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.findById(id);<br>    &#125;<br>    <br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.CREATED)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.save(user);<br>    &#125;<br>    <br>    <span class="hljs-meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id, <span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.update(id, user);<br>    &#125;<br>    <br>    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.NO_CONTENT)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.deleteById(id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å“åº”å¼è¿”å›ç±»å‹"><a href="#å“åº”å¼è¿”å›ç±»å‹" class="headerlink" title="å“åº”å¼è¿”å›ç±»å‹"></a>å“åº”å¼è¿”å›ç±»å‹</h3><table><thead><tr><th>è¿”å›ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>Mono&lt;T&gt;</code></td><td>è¿”å›å•ä¸ªå¯¹è±¡</td></tr><tr><td><code>Flux&lt;T&gt;</code></td><td>è¿”å›å¤šä¸ªå¯¹è±¡ï¼ˆæµå¼ï¼‰</td></tr><tr><td><code>Mono&lt;Void&gt;</code></td><td>æ— è¿”å›å€¼</td></tr><tr><td><code>Mono&lt;ResponseEntity&lt;T&gt;&gt;</code></td><td>è‡ªå®šä¹‰å“åº”</td></tr></tbody></table><h2 id="WebClient-å“åº”å¼-HTTP-å®¢æˆ·ç«¯"><a href="#WebClient-å“åº”å¼-HTTP-å®¢æˆ·ç«¯" class="headerlink" title="WebClient - å“åº”å¼ HTTP å®¢æˆ·ç«¯"></a>WebClient - å“åº”å¼ HTTP å®¢æˆ·ç«¯</h2><p><code>WebClient</code> æ˜¯ WebFlux æä¾›çš„éé˜»å¡ HTTP å®¢æˆ·ç«¯ï¼Œç”¨äºæ›¿ä»£ <code>RestTemplate</code>ã€‚</p><h3 id="åˆ›å»º-WebClient"><a href="#åˆ›å»º-WebClient" class="headerlink" title="åˆ›å»º WebClient"></a>åˆ›å»º WebClient</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŸºæœ¬åˆ›å»º</span><br><span class="hljs-type">WebClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> WebClient.create();<br><br><span class="hljs-comment">// å¸¦åŸºç¡€ URL</span><br><span class="hljs-type">WebClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> WebClient.create(<span class="hljs-string">&quot;http://localhost:8080&quot;</span>);<br><br><span class="hljs-comment">// ä½¿ç”¨ Builder è‡ªå®šä¹‰</span><br><span class="hljs-type">WebClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> WebClient.builder()<br>    .baseUrl(<span class="hljs-string">&quot;http://localhost:8080&quot;</span>)<br>    .defaultHeader(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)<br>    .defaultHeader(HttpHeaders.AUTHORIZATION, <span class="hljs-string">&quot;Bearer token&quot;</span>)<br>    .filter(ExchangeFilterFunction.ofRequestProcessor(<br>        request -&gt; &#123;<br>            log.info(<span class="hljs-string">&quot;Request: &#123;&#125; &#123;&#125;&quot;</span>, request.method(), request.url());<br>            <span class="hljs-keyword">return</span> Mono.just(request);<br>        &#125;<br>    ))<br>    .build();<br></code></pre></td></tr></table></figure><h3 id="GET-è¯·æ±‚"><a href="#GET-è¯·æ±‚" class="headerlink" title="GET è¯·æ±‚"></a>GET è¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å–å•ä¸ªå¯¹è±¡</span><br>Mono&lt;User&gt; user = webClient.get()<br>    .uri(<span class="hljs-string">&quot;/api/users/&#123;id&#125;&quot;</span>, userId)<br>    .retrieve()<br>    .bodyToMono(User.class);<br><br><span class="hljs-comment">// è·å–åˆ—è¡¨</span><br>Flux&lt;User&gt; users = webClient.get()<br>    .uri(<span class="hljs-string">&quot;/api/users&quot;</span>)<br>    .retrieve()<br>    .bodyToFlux(User.class);<br><br><span class="hljs-comment">// å¸¦æŸ¥è¯¢å‚æ•°</span><br>Flux&lt;User&gt; users = webClient.get()<br>    .uri(uriBuilder -&gt; uriBuilder<br>        .path(<span class="hljs-string">&quot;/api/users&quot;</span>)<br>        .queryParam(<span class="hljs-string">&quot;page&quot;</span>, <span class="hljs-number">0</span>)<br>        .queryParam(<span class="hljs-string">&quot;size&quot;</span>, <span class="hljs-number">10</span>)<br>        .build())<br>    .retrieve()<br>    .bodyToFlux(User.class);<br></code></pre></td></tr></table></figure><h3 id="POST-è¯·æ±‚"><a href="#POST-è¯·æ±‚" class="headerlink" title="POST è¯·æ±‚"></a>POST è¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">Mono&lt;User&gt; createdUser = webClient.post()<br>    .uri(<span class="hljs-string">&quot;/api/users&quot;</span>)<br>    .contentType(MediaType.APPLICATION_JSON)<br>    .bodyValue(newUser)<br>    .retrieve()<br>    .bodyToMono(User.class);<br><br><span class="hljs-comment">// ä½¿ç”¨ Mono ä½œä¸ºè¯·æ±‚ä½“</span><br>Mono&lt;User&gt; createdUser = webClient.post()<br>    .uri(<span class="hljs-string">&quot;/api/users&quot;</span>)<br>    .body(userMono, User.class)<br>    .retrieve()<br>    .bodyToMono(User.class);<br></code></pre></td></tr></table></figure><h3 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">Mono&lt;User&gt; user = webClient.get()<br>    .uri(<span class="hljs-string">&quot;/api/users/&#123;id&#125;&quot;</span>, userId)<br>    .retrieve()<br>    .onStatus(HttpStatusCode::is4xxClientError, response -&gt; <br>        Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NotFoundException</span>(<span class="hljs-string">&quot;User not found&quot;</span>)))<br>    .onStatus(HttpStatusCode::is5xxServerError, response -&gt; <br>        Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerException</span>(<span class="hljs-string">&quot;Server error&quot;</span>)))<br>    .bodyToMono(User.class);<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-exchange-è·å–å®Œæ•´å“åº”"><a href="#ä½¿ç”¨-exchange-è·å–å®Œæ•´å“åº”" class="headerlink" title="ä½¿ç”¨ exchange() è·å–å®Œæ•´å“åº”"></a>ä½¿ç”¨ exchange() è·å–å®Œæ•´å“åº”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">Mono&lt;ResponseEntity&lt;User&gt;&gt; response = webClient.get()<br>    .uri(<span class="hljs-string">&quot;/api/users/&#123;id&#125;&quot;</span>, userId)<br>    .exchangeToMono(clientResponse -&gt; &#123;<br>        <span class="hljs-keyword">if</span> (clientResponse.statusCode().is2xxSuccessful()) &#123;<br>            <span class="hljs-keyword">return</span> clientResponse.toEntity(User.class);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> clientResponse.createException().flatMap(Mono::error);<br>        &#125;<br>    &#125;);<br></code></pre></td></tr></table></figure><h2 id="ServerRequest-å’Œ-ServerResponse"><a href="#ServerRequest-å’Œ-ServerResponse" class="headerlink" title="ServerRequest å’Œ ServerResponse"></a>ServerRequest å’Œ ServerResponse</h2><p>è¿™ä¸¤ä¸ªç±»ç”¨äºå‡½æ•°å¼ç«¯ç‚¹ç¼–ç¨‹ã€‚</p><h3 id="ServerRequest"><a href="#ServerRequest" class="headerlink" title="ServerRequest"></a>ServerRequest</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å–è·¯å¾„å˜é‡</span><br><span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> request.pathVariable(<span class="hljs-string">&quot;id&quot;</span>);<br><br><span class="hljs-comment">// è·å–æŸ¥è¯¢å‚æ•°</span><br>Optional&lt;String&gt; name = request.queryParam(<span class="hljs-string">&quot;name&quot;</span>);<br><br><span class="hljs-comment">// è·å–è¯·æ±‚å¤´</span><br><span class="hljs-type">String</span> <span class="hljs-variable">contentType</span> <span class="hljs-operator">=</span> request.headers().contentType()<br>    .map(MediaType::toString)<br>    .orElse(<span class="hljs-string">&quot;unknown&quot;</span>);<br><br><span class="hljs-comment">// è·å–è¯·æ±‚ä½“</span><br>Mono&lt;User&gt; user = request.bodyToMono(User.class);<br>Flux&lt;User&gt; users = request.bodyToFlux(User.class);<br></code></pre></td></tr></table></figure><h3 id="ServerResponse"><a href="#ServerResponse" class="headerlink" title="ServerResponse"></a>ServerResponse</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æˆåŠŸå“åº”</span><br>ServerResponse.ok()<br>    .contentType(MediaType.APPLICATION_JSON)<br>    .bodyValue(user);<br><br><span class="hljs-comment">// è¿”å› Mono</span><br>ServerResponse.ok().body(userMono, User.class);<br><br><span class="hljs-comment">// è¿”å› Flux</span><br>ServerResponse.ok().body(userFlux, User.class);<br><br><span class="hljs-comment">// åˆ›å»ºå“åº”</span><br>ServerResponse.created(URI.create(<span class="hljs-string">&quot;/api/users/&quot;</span> + id))<br>    .bodyValue(user);<br><br><span class="hljs-comment">// æ— å†…å®¹å“åº”</span><br>ServerResponse.noContent().build();<br><br><span class="hljs-comment">// é”™è¯¯å“åº”</span><br>ServerResponse.notFound().build();<br>ServerResponse.badRequest().bodyValue(<span class="hljs-string">&quot;Invalid request&quot;</span>);<br></code></pre></td></tr></table></figure><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><h3 id="ä½¿ç”¨-ExceptionHandler"><a href="#ä½¿ç”¨-ExceptionHandler" class="headerlink" title="ä½¿ç”¨ @ExceptionHandler"></a>ä½¿ç”¨ @ExceptionHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestControllerAdvice</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> &#123;<br>    <br>    <span class="hljs-meta">@ExceptionHandler(NotFoundException.class)</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;ErrorResponse&gt; <span class="hljs-title function_">handleNotFound</span><span class="hljs-params">(NotFoundException ex)</span> &#123;<br>        <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorResponse</span>(ex.getMessage()));<br>    &#125;<br>    <br>    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;ErrorResponse&gt; <span class="hljs-title function_">handleException</span><span class="hljs-params">(Exception ex)</span> &#123;<br>        <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorResponse</span>(<span class="hljs-string">&quot;Internal server error&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-WebExceptionHandler"><a href="#ä½¿ç”¨-WebExceptionHandler" class="headerlink" title="ä½¿ç”¨ WebExceptionHandler"></a>ä½¿ç”¨ WebExceptionHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@Order(-2)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalWebExceptionHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebExceptionHandler</span> &#123;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">handle</span><span class="hljs-params">(ServerWebExchange exchange, Throwable ex)</span> &#123;<br>        <span class="hljs-keyword">if</span> (ex <span class="hljs-keyword">instanceof</span> NotFoundException) &#123;<br>            exchange.getResponse().setStatusCode(HttpStatus.NOT_FOUND);<br>            <span class="hljs-comment">// å†™å…¥å“åº”ä½“...</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> Mono.error(ex);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è¿‡æ»¤å™¨ï¼ˆWebFilterï¼‰"><a href="#è¿‡æ»¤å™¨ï¼ˆWebFilterï¼‰" class="headerlink" title="è¿‡æ»¤å™¨ï¼ˆWebFilterï¼‰"></a>è¿‡æ»¤å™¨ï¼ˆWebFilterï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebFilter</span> &#123;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">filter</span><span class="hljs-params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <br>        <span class="hljs-keyword">return</span> chain.filter(exchange)<br>            .doFinally(signalType -&gt; &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;<br>                log.info(<span class="hljs-string">&quot;Request &#123;&#125; &#123;&#125; completed in &#123;&#125;ms&quot;</span>,<br>                    exchange.getRequest().getMethod(),<br>                    exchange.getRequest().getPath(),<br>                    duration);<br>            &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸Šä¸€ç¯‡ï¼šReactoræ ¸å¿ƒAPI</li><li>ä¸‹ä¸€ç¯‡ï¼šå‡½æ•°å¼ç«¯ç‚¹</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Webflux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>WebFlux</tag>
      
      <tag>Controller</tag>
      
      <tag>WebClient</tag>
      
      <tag>WebFilter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Reactor APIå‚è€ƒ</title>
    <link href="/2026/01/10/Reactor%20API%E5%8F%82%E8%80%83/"/>
    <url>/2026/01/10/Reactor%20API%E5%8F%82%E8%80%83/</url>
    
    <content type="html"><![CDATA[<h1 id="Reactor-API-å‚è€ƒ"><a href="#Reactor-API-å‚è€ƒ" class="headerlink" title="Reactor API å‚è€ƒ"></a>Reactor API å‚è€ƒ</h1><p>Project Reactor æä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦ï¼Œæœ¬æ–‡æŒ‰åŠŸèƒ½åˆ†ç±»æ•´ç†ã€‚</p><hr><h2 id="ä¸€ã€åˆ›å»ºæ“ä½œç¬¦"><a href="#ä¸€ã€åˆ›å»ºæ“ä½œç¬¦" class="headerlink" title="ä¸€ã€åˆ›å»ºæ“ä½œç¬¦"></a>ä¸€ã€åˆ›å»ºæ“ä½œç¬¦</h2><h3 id="Mono-åˆ›å»º"><a href="#Mono-åˆ›å»º" class="headerlink" title="Mono åˆ›å»º"></a>Mono åˆ›å»º</h3><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>Mono.just(T)</code></td><td>åˆ›å»ºåŒ…å«å•ä¸ªå€¼çš„ Mono</td><td><code>Mono.just(&quot;hello&quot;)</code></td></tr><tr><td><code>Mono.empty()</code></td><td>åˆ›å»ºç©ºçš„ Mono</td><td><code>Mono.empty()</code></td></tr><tr><td><code>Mono.error(Throwable)</code></td><td>åˆ›å»ºé”™è¯¯ Mono</td><td><code>Mono.error(new RuntimeException())</code></td></tr><tr><td><code>Mono.never()</code></td><td>æ°¸ä¸å‘å‡ºä¿¡å·çš„ Mono</td><td><code>Mono.never()</code></td></tr><tr><td><code>Mono.defer(Supplier)</code></td><td>å»¶è¿Ÿåˆ›å»ºï¼Œæ¯æ¬¡è®¢é˜…éƒ½æ‰§è¡Œ</td><td><code>Mono.defer(() -&gt; Mono.just(getValue()))</code></td></tr><tr><td><code>Mono.fromCallable(Callable)</code></td><td>ä» Callable åˆ›å»º</td><td><code>Mono.fromCallable(() -&gt; compute())</code></td></tr><tr><td><code>Mono.fromSupplier(Supplier)</code></td><td>ä» Supplier åˆ›å»º</td><td><code>Mono.fromSupplier(() -&gt; getValue())</code></td></tr><tr><td><code>Mono.fromFuture(CompletableFuture)</code></td><td>ä» Future åˆ›å»º</td><td><code>Mono.fromFuture(future)</code></td></tr><tr><td><code>Mono.fromRunnable(Runnable)</code></td><td>ä» Runnable åˆ›å»ºï¼ˆæ— è¿”å›å€¼ï¼‰</td><td><code>Mono.fromRunnable(() -&gt; doSomething())</code></td></tr><tr><td><code>Mono.delay(Duration)</code></td><td>å»¶è¿Ÿåå‘å‡º 0L</td><td><code>Mono.delay(Duration.ofSeconds(1))</code></td></tr><tr><td><code>Mono.create(Consumer&lt;MonoSink&gt;)</code></td><td>ç¼–ç¨‹å¼åˆ›å»º</td><td>è§ä¸‹æ–¹ç¤ºä¾‹</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Mono.create ç¤ºä¾‹</span><br>Mono.create(sink -&gt; &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> doAsyncWork();<br>    <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) &#123;<br>        sink.success(result);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        sink.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;å¤±è´¥&quot;</span>));<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="Flux-åˆ›å»º"><a href="#Flux-åˆ›å»º" class="headerlink" title="Flux åˆ›å»º"></a>Flux åˆ›å»º</h3><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>Flux.just(T...)</code></td><td>ä»å¤šä¸ªå€¼åˆ›å»º</td><td><code>Flux.just(1, 2, 3)</code></td></tr><tr><td><code>Flux.fromIterable(Iterable)</code></td><td>ä»é›†åˆåˆ›å»º</td><td><code>Flux.fromIterable(list)</code></td></tr><tr><td><code>Flux.fromArray(T[])</code></td><td>ä»æ•°ç»„åˆ›å»º</td><td><code>Flux.fromArray(array)</code></td></tr><tr><td><code>Flux.fromStream(Stream)</code></td><td>ä» Stream åˆ›å»º</td><td><code>Flux.fromStream(stream)</code></td></tr><tr><td><code>Flux.range(int, int)</code></td><td>åˆ›å»ºæ•´æ•°åºåˆ—</td><td><code>Flux.range(1, 10)</code></td></tr><tr><td><code>Flux.interval(Duration)</code></td><td>å®šæ—¶å‘å‡ºé€’å¢æ•°å­—</td><td><code>Flux.interval(Duration.ofSeconds(1))</code></td></tr><tr><td><code>Flux.empty()</code></td><td>åˆ›å»ºç©º Flux</td><td><code>Flux.empty()</code></td></tr><tr><td><code>Flux.error(Throwable)</code></td><td>åˆ›å»ºé”™è¯¯ Flux</td><td><code>Flux.error(new Exception())</code></td></tr><tr><td><code>Flux.never()</code></td><td>æ°¸ä¸å‘å‡ºä¿¡å·</td><td><code>Flux.never()</code></td></tr><tr><td><code>Flux.defer(Supplier)</code></td><td>å»¶è¿Ÿåˆ›å»º</td><td><code>Flux.defer(() -&gt; Flux.just(getData()))</code></td></tr><tr><td><code>Flux.generate(Consumer)</code></td><td>åŒæ­¥ç”Ÿæˆï¼ˆä¸€æ¬¡ä¸€ä¸ªï¼‰</td><td>è§ä¸‹æ–¹ç¤ºä¾‹</td></tr><tr><td><code>Flux.create(Consumer)</code></td><td>å¼‚æ­¥ç”Ÿæˆï¼ˆå¯å¤šä¸ªï¼‰</td><td>è§ä¸‹æ–¹ç¤ºä¾‹</td></tr><tr><td><code>Flux.push(Consumer)</code></td><td>å•çº¿ç¨‹å¼‚æ­¥ç”Ÿæˆ</td><td>ç±»ä¼¼ create</td></tr><tr><td><code>Flux.using(Callable, Function, Consumer)</code></td><td>èµ„æºç®¡ç†</td><td>è§ä¸‹æ–¹ç¤ºä¾‹</td></tr><tr><td><code>Flux.concat(Publisher...)</code></td><td>é¡ºåºè¿æ¥å¤šä¸ªæµ</td><td><code>Flux.concat(flux1, flux2)</code></td></tr><tr><td><code>Flux.merge(Publisher...)</code></td><td>å¹¶è¡Œåˆå¹¶å¤šä¸ªæµ</td><td><code>Flux.merge(flux1, flux2)</code></td></tr><tr><td><code>Flux.zip(Publisher...)</code></td><td>ç»„åˆå¤šä¸ªæµ</td><td><code>Flux.zip(flux1, flux2)</code></td></tr><tr><td><code>Flux.combineLatest(Publisher...)</code></td><td>ç»„åˆæœ€æ–°å€¼</td><td>è§ä¸‹æ–¹ç¤ºä¾‹</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Flux.generate ç¤ºä¾‹ - åŒæ­¥ç”Ÿæˆ</span><br>Flux.generate(<br>    () -&gt; <span class="hljs-number">0</span>,  <span class="hljs-comment">// åˆå§‹çŠ¶æ€</span><br>    (state, sink) -&gt; &#123;<br>        sink.next(<span class="hljs-string">&quot;å€¼: &quot;</span> + state);<br>        <span class="hljs-keyword">if</span> (state == <span class="hljs-number">10</span>) sink.complete();<br>        <span class="hljs-keyword">return</span> state + <span class="hljs-number">1</span>;<br>    &#125;<br>);<br><br><span class="hljs-comment">// Flux.create ç¤ºä¾‹ - å¼‚æ­¥ç”Ÿæˆ</span><br>Flux.create(sink -&gt; &#123;<br>    eventSource.onData(data -&gt; sink.next(data));<br>    eventSource.onError(e -&gt; sink.error(e));<br>    eventSource.onComplete(() -&gt; sink.complete());<br>&#125;);<br><br><span class="hljs-comment">// Flux.using ç¤ºä¾‹ - èµ„æºç®¡ç†</span><br>Flux.using(<br>    () -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;file.txt&quot;</span>),  <span class="hljs-comment">// åˆ›å»ºèµ„æº</span><br>    inputStream -&gt; Flux.just(readData(inputStream)),  <span class="hljs-comment">// ä½¿ç”¨èµ„æº</span><br>    inputStream -&gt; inputStream.close()  <span class="hljs-comment">// å…³é—­èµ„æº</span><br>);<br></code></pre></td></tr></table></figure><hr><h2 id="äºŒã€è½¬æ¢æ“ä½œç¬¦"><a href="#äºŒã€è½¬æ¢æ“ä½œç¬¦" class="headerlink" title="äºŒã€è½¬æ¢æ“ä½œç¬¦"></a>äºŒã€è½¬æ¢æ“ä½œç¬¦</h2><h3 id="åŸºæœ¬è½¬æ¢"><a href="#åŸºæœ¬è½¬æ¢" class="headerlink" title="åŸºæœ¬è½¬æ¢"></a>åŸºæœ¬è½¬æ¢</h3><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>map(Function)</code></td><td>åŒæ­¥è½¬æ¢æ¯ä¸ªå…ƒç´ </td><td><code>flux.map(i -&gt; i * 2)</code></td></tr><tr><td><code>flatMap(Function)</code></td><td>å¼‚æ­¥è½¬æ¢ï¼Œç»“æœåˆå¹¶ï¼ˆæ— åºï¼‰</td><td><code>flux.flatMap(id -&gt; fetchUser(id))</code></td></tr><tr><td><code>flatMapSequential(Function)</code></td><td>å¼‚æ­¥è½¬æ¢ï¼Œä¿æŒé¡ºåº</td><td><code>flux.flatMapSequential(id -&gt; fetchUser(id))</code></td></tr><tr><td><code>concatMap(Function)</code></td><td>å¼‚æ­¥è½¬æ¢ï¼Œé¡ºåºæ‰§è¡Œ</td><td><code>flux.concatMap(id -&gt; fetchUser(id))</code></td></tr><tr><td><code>switchMap(Function)</code></td><td>åˆ‡æ¢åˆ°æ–°æµï¼Œå–æ¶ˆæ—§æµ</td><td><code>flux.switchMap(id -&gt; fetchUser(id))</code></td></tr><tr><td><code>cast(Class)</code></td><td>ç±»å‹è½¬æ¢</td><td><code>flux.cast(String.class)</code></td></tr><tr><td><code>ofType(Class)</code></td><td>è¿‡æ»¤å¹¶è½¬æ¢ç±»å‹</td><td><code>flux.ofType(String.class)</code></td></tr><tr><td><code>index()</code></td><td>æ·»åŠ ç´¢å¼•</td><td><code>flux.index()</code> â†’ <code>Tuple2&lt;Long, T&gt;</code></td></tr><tr><td><code>timestamp()</code></td><td>æ·»åŠ æ—¶é—´æˆ³</td><td><code>flux.timestamp()</code> â†’ <code>Tuple2&lt;Long, T&gt;</code></td></tr><tr><td><code>elapsed()</code></td><td>æ·»åŠ æ—¶é—´é—´éš”</td><td><code>flux.elapsed()</code></td></tr></tbody></table><h3 id="flatMap-å˜ä½“å¯¹æ¯”"><a href="#flatMap-å˜ä½“å¯¹æ¯”" class="headerlink" title="flatMap å˜ä½“å¯¹æ¯”"></a>flatMap å˜ä½“å¯¹æ¯”</h3><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">flatMap:</span>           å¹¶è¡Œæ‰§è¡Œï¼Œç»“æœæ— åº<br><span class="hljs-symbol">flatMapSequential:</span> å¹¶è¡Œæ‰§è¡Œï¼Œç»“æœæœ‰åº<br><span class="hljs-symbol">concatMap:</span>         é¡ºåºæ‰§è¡Œï¼Œç»“æœæœ‰åº<br><span class="hljs-symbol">switchMap:</span>         åˆ‡æ¢æ–°æµï¼Œå–æ¶ˆæ—§æµ<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// flatMap vs concatMap</span><br>Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)<br>    .flatMap(i -&gt; Mono.just(i).delayElement(Duration.ofMillis(<span class="hljs-number">100</span> - i * <span class="hljs-number">30</span>)))<br>    .subscribe(System.out::println);  <span class="hljs-comment">// å¯èƒ½è¾“å‡º: 3, 2, 1</span><br><br>Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)<br>    .concatMap(i -&gt; Mono.just(i).delayElement(Duration.ofMillis(<span class="hljs-number">100</span>)))<br>    .subscribe(System.out::println);  <span class="hljs-comment">// è¾“å‡º: 1, 2, 3</span><br></code></pre></td></tr></table></figure><hr><h2 id="ä¸‰ã€è¿‡æ»¤æ“ä½œç¬¦"><a href="#ä¸‰ã€è¿‡æ»¤æ“ä½œç¬¦" class="headerlink" title="ä¸‰ã€è¿‡æ»¤æ“ä½œç¬¦"></a>ä¸‰ã€è¿‡æ»¤æ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>filter(Predicate)</code></td><td>è¿‡æ»¤å…ƒç´ </td><td><code>flux.filter(i -&gt; i &gt; 5)</code></td></tr><tr><td><code>filterWhen(Function)</code></td><td>å¼‚æ­¥è¿‡æ»¤</td><td><code>flux.filterWhen(i -&gt; checkAsync(i))</code></td></tr><tr><td><code>distinct()</code></td><td>å»é‡</td><td><code>flux.distinct()</code></td></tr><tr><td><code>distinctUntilChanged()</code></td><td>è¿ç»­å»é‡</td><td><code>flux.distinctUntilChanged()</code></td></tr><tr><td><code>take(long)</code></td><td>å–å‰ n ä¸ª</td><td><code>flux.take(5)</code></td></tr><tr><td><code>takeLast(int)</code></td><td>å–æœ€å n ä¸ª</td><td><code>flux.takeLast(3)</code></td></tr><tr><td><code>takeUntil(Predicate)</code></td><td>å–ç›´åˆ°æ¡ä»¶æ»¡è¶³</td><td><code>flux.takeUntil(i -&gt; i &gt; 10)</code></td></tr><tr><td><code>takeWhile(Predicate)</code></td><td>å–å½“æ¡ä»¶æ»¡è¶³æ—¶</td><td><code>flux.takeWhile(i -&gt; i &lt; 10)</code></td></tr><tr><td><code>skip(long)</code></td><td>è·³è¿‡å‰ n ä¸ª</td><td><code>flux.skip(5)</code></td></tr><tr><td><code>skipLast(int)</code></td><td>è·³è¿‡æœ€å n ä¸ª</td><td><code>flux.skipLast(3)</code></td></tr><tr><td><code>skipUntil(Predicate)</code></td><td>è·³è¿‡ç›´åˆ°æ¡ä»¶æ»¡è¶³</td><td><code>flux.skipUntil(i -&gt; i &gt; 5)</code></td></tr><tr><td><code>skipWhile(Predicate)</code></td><td>è·³è¿‡å½“æ¡ä»¶æ»¡è¶³æ—¶</td><td><code>flux.skipWhile(i -&gt; i &lt; 5)</code></td></tr><tr><td><code>first()</code></td><td>å–ç¬¬ä¸€ä¸ªï¼ˆå·²åºŸå¼ƒï¼‰</td><td>ä½¿ç”¨ <code>next()</code></td></tr><tr><td><code>next()</code></td><td>å–ç¬¬ä¸€ä¸ªï¼Œè¿”å› Mono</td><td><code>flux.next()</code></td></tr><tr><td><code>last()</code></td><td>å–æœ€åä¸€ä¸ª</td><td><code>flux.last()</code></td></tr><tr><td><code>last(T)</code></td><td>å–æœ€åä¸€ä¸ªï¼Œæœ‰é»˜è®¤å€¼</td><td><code>flux.last(defaultValue)</code></td></tr><tr><td><code>single()</code></td><td>æœŸæœ›åªæœ‰ä¸€ä¸ªå…ƒç´ </td><td><code>flux.single()</code></td></tr><tr><td><code>singleOrEmpty()</code></td><td>æœŸæœ› 0 æˆ– 1 ä¸ªå…ƒç´ </td><td><code>flux.singleOrEmpty()</code></td></tr><tr><td><code>elementAt(int)</code></td><td>å–æŒ‡å®šä½ç½®å…ƒç´ </td><td><code>flux.elementAt(5)</code></td></tr><tr><td><code>ignoreElements()</code></td><td>å¿½ç•¥æ‰€æœ‰å…ƒç´ </td><td><code>flux.ignoreElements()</code></td></tr></tbody></table><hr><h2 id="å››ã€ç»„åˆæ“ä½œç¬¦"><a href="#å››ã€ç»„åˆæ“ä½œç¬¦" class="headerlink" title="å››ã€ç»„åˆæ“ä½œç¬¦"></a>å››ã€ç»„åˆæ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>concat(Publisher...)</code></td><td>é¡ºåºè¿æ¥</td><td><code>Flux.concat(flux1, flux2)</code></td></tr><tr><td><code>concatWith(Publisher)</code></td><td>ä¸å¦ä¸€ä¸ªæµè¿æ¥</td><td><code>flux1.concatWith(flux2)</code></td></tr><tr><td><code>merge(Publisher...)</code></td><td>å¹¶è¡Œåˆå¹¶</td><td><code>Flux.merge(flux1, flux2)</code></td></tr><tr><td><code>mergeWith(Publisher)</code></td><td>ä¸å¦ä¸€ä¸ªæµåˆå¹¶</td><td><code>flux1.mergeWith(flux2)</code></td></tr><tr><td><code>mergeSequential(Publisher...)</code></td><td>å¹¶è¡Œæ‰§è¡Œï¼Œé¡ºåºè¾“å‡º</td><td><code>Flux.mergeSequential(flux1, flux2)</code></td></tr><tr><td><code>zip(Publisher...)</code></td><td>ä¸€å¯¹ä¸€ç»„åˆ</td><td><code>Flux.zip(flux1, flux2)</code></td></tr><tr><td><code>zipWith(Publisher)</code></td><td>ä¸å¦ä¸€ä¸ªæµç»„åˆ</td><td><code>flux1.zipWith(flux2)</code></td></tr><tr><td><code>zipWith(Publisher, BiFunction)</code></td><td>ç»„åˆå¹¶è½¬æ¢</td><td><code>flux1.zipWith(flux2, (a, b) -&gt; a + b)</code></td></tr><tr><td><code>combineLatest(Publisher...)</code></td><td>ç»„åˆæœ€æ–°å€¼</td><td><code>Flux.combineLatest(flux1, flux2, combiner)</code></td></tr><tr><td><code>startWith(T...)</code></td><td>åœ¨å¼€å¤´æ·»åŠ å…ƒç´ </td><td><code>flux.startWith(0)</code></td></tr><tr><td><code>and(Publisher)</code></td><td>ç­‰å¾…ä¸¤ä¸ªéƒ½å®Œæˆ</td><td><code>mono1.and(mono2)</code></td></tr><tr><td><code>when(Publisher...)</code></td><td>ç­‰å¾…æ‰€æœ‰å®Œæˆ</td><td><code>Mono.when(mono1, mono2)</code></td></tr><tr><td><code>then()</code></td><td>å¿½ç•¥å…ƒç´ ï¼Œåªå…³å¿ƒå®Œæˆ</td><td><code>flux.then()</code></td></tr><tr><td><code>thenMany(Publisher)</code></td><td>å®Œæˆååˆ‡æ¢åˆ°å¦ä¸€ä¸ªæµ</td><td><code>mono.thenMany(flux)</code></td></tr><tr><td><code>thenReturn(T)</code></td><td>å®Œæˆåè¿”å›å›ºå®šå€¼</td><td><code>mono.thenReturn(&quot;done&quot;)</code></td></tr></tbody></table><h3 id="ç»„åˆæ“ä½œç¬¦å¯¹æ¯”"><a href="#ç»„åˆæ“ä½œç¬¦å¯¹æ¯”" class="headerlink" title="ç»„åˆæ“ä½œç¬¦å¯¹æ¯”"></a>ç»„åˆæ“ä½œç¬¦å¯¹æ¯”</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-symbol">concat:</span>  Aå®Œæˆ â†’ <span class="hljs-keyword">Bå¼€å§‹ï¼Œé¡ºåºæ‰§è¡Œ</span><br><span class="hljs-keyword"></span><span class="hljs-symbol">merge:</span>   Aå’Œ<span class="hljs-keyword">BåŒæ—¶æ‰§è¡Œï¼Œè°å¿«è°å…ˆè¾“å‡º</span><br><span class="hljs-keyword"></span><span class="hljs-symbol">zip:</span>     Aå’Œ<span class="hljs-keyword">Bä¸€å¯¹ä¸€é…å¯¹ï¼Œ(a1,b1), </span>(<span class="hljs-built_in">a2</span>,<span class="hljs-keyword">b2)...</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// zip ç¤ºä¾‹</span><br>Flux&lt;String&gt; names = Flux.just(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, <span class="hljs-string">&quot;æå››&quot;</span>);<br>Flux&lt;Integer&gt; ages = Flux.just(<span class="hljs-number">25</span>, <span class="hljs-number">30</span>);<br><br>Flux.zip(names, ages, (name, age) -&gt; name + <span class="hljs-string">&quot;: &quot;</span> + age)<br>    .subscribe(System.out::println);<br><span class="hljs-comment">// è¾“å‡º: å¼ ä¸‰: 25, æå››: 30</span><br></code></pre></td></tr></table></figure><hr><h2 id="äº”ã€é”™è¯¯å¤„ç†æ“ä½œç¬¦"><a href="#äº”ã€é”™è¯¯å¤„ç†æ“ä½œç¬¦" class="headerlink" title="äº”ã€é”™è¯¯å¤„ç†æ“ä½œç¬¦"></a>äº”ã€é”™è¯¯å¤„ç†æ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>onErrorReturn(T)</code></td><td>é”™è¯¯æ—¶è¿”å›é»˜è®¤å€¼</td><td><code>flux.onErrorReturn(defaultValue)</code></td></tr><tr><td><code>onErrorReturn(Predicate, T)</code></td><td>ç‰¹å®šé”™è¯¯è¿”å›é»˜è®¤å€¼</td><td><code>flux.onErrorReturn(e -&gt; e instanceof IOException, default)</code></td></tr><tr><td><code>onErrorResume(Function)</code></td><td>é”™è¯¯æ—¶åˆ‡æ¢åˆ°å¤‡ç”¨æµ</td><td><code>flux.onErrorResume(e -&gt; backupFlux)</code></td></tr><tr><td><code>onErrorMap(Function)</code></td><td>è½¬æ¢é”™è¯¯ç±»å‹</td><td><code>flux.onErrorMap(e -&gt; new CustomException(e))</code></td></tr><tr><td><code>onErrorContinue(BiConsumer)</code></td><td>é”™è¯¯æ—¶è·³è¿‡ç»§ç»­</td><td><code>flux.onErrorContinue((e, v) -&gt; log.error(e))</code></td></tr><tr><td><code>onErrorStop()</code></td><td>é”™è¯¯æ—¶åœæ­¢</td><td><code>flux.onErrorStop()</code></td></tr><tr><td><code>doOnError(Consumer)</code></td><td>é”™è¯¯æ—¶æ‰§è¡Œå‰¯ä½œç”¨</td><td><code>flux.doOnError(e -&gt; log.error(e))</code></td></tr><tr><td><code>retry()</code></td><td>æ— é™é‡è¯•</td><td><code>flux.retry()</code></td></tr><tr><td><code>retry(long)</code></td><td>é‡è¯• n æ¬¡</td><td><code>flux.retry(3)</code></td></tr><tr><td><code>retryWhen(Retry)</code></td><td>è‡ªå®šä¹‰é‡è¯•ç­–ç•¥</td><td>è§ä¸‹æ–¹ç¤ºä¾‹</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// retryWhen ç¤ºä¾‹</span><br>flux.retryWhen(Retry.backoff(<span class="hljs-number">3</span>, Duration.ofSeconds(<span class="hljs-number">1</span>))<br>    .maxBackoff(Duration.ofSeconds(<span class="hljs-number">10</span>))<br>    .filter(e -&gt; e <span class="hljs-keyword">instanceof</span> IOException)<br>    .onRetryExhaustedThrow((spec, signal) -&gt; signal.failure())<br>);<br><br><span class="hljs-comment">// æŒ‡æ•°é€€é¿é‡è¯•</span><br>flux.retryWhen(Retry.backoff(<span class="hljs-number">5</span>, Duration.ofMillis(<span class="hljs-number">100</span>)));<br><br><span class="hljs-comment">// å›ºå®šé—´éš”é‡è¯•</span><br>flux.retryWhen(Retry.fixedDelay(<span class="hljs-number">3</span>, Duration.ofSeconds(<span class="hljs-number">1</span>)));<br></code></pre></td></tr></table></figure><hr><h2 id="å…­ã€å‰¯ä½œç”¨æ“ä½œç¬¦ï¼ˆdoOn-ç³»åˆ—ï¼‰"><a href="#å…­ã€å‰¯ä½œç”¨æ“ä½œç¬¦ï¼ˆdoOn-ç³»åˆ—ï¼‰" class="headerlink" title="å…­ã€å‰¯ä½œç”¨æ“ä½œç¬¦ï¼ˆdoOn ç³»åˆ—ï¼‰"></a>å…­ã€å‰¯ä½œç”¨æ“ä½œç¬¦ï¼ˆdoOn ç³»åˆ—ï¼‰</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>è§¦å‘æ—¶æœº</th></tr></thead><tbody><tr><td><code>doOnNext(Consumer)</code></td><td>æ¯ä¸ªå…ƒç´ </td><td>onNext ä¿¡å·</td></tr><tr><td><code>doOnError(Consumer)</code></td><td>å‘ç”Ÿé”™è¯¯</td><td>onError ä¿¡å·</td></tr><tr><td><code>doOnComplete(Runnable)</code></td><td>å®Œæˆæ—¶</td><td>onComplete ä¿¡å·</td></tr><tr><td><code>doOnSubscribe(Consumer)</code></td><td>è®¢é˜…æ—¶</td><td>onSubscribe ä¿¡å·</td></tr><tr><td><code>doOnRequest(LongConsumer)</code></td><td>è¯·æ±‚æ•°æ®æ—¶</td><td>request ä¿¡å·</td></tr><tr><td><code>doOnCancel(Runnable)</code></td><td>å–æ¶ˆæ—¶</td><td>cancel ä¿¡å·</td></tr><tr><td><code>doOnTerminate(Runnable)</code></td><td>ç»ˆæ­¢æ—¶ï¼ˆå®Œæˆæˆ–é”™è¯¯ï¼‰</td><td>onComplete æˆ– onError</td></tr><tr><td><code>doAfterTerminate(Runnable)</code></td><td>ç»ˆæ­¢å</td><td>ç»ˆæ­¢ä¿¡å·å‘é€å</td></tr><tr><td><code>doOnEach(Consumer&lt;Signal&gt;)</code></td><td>æ¯ä¸ªä¿¡å·</td><td>æ‰€æœ‰ä¿¡å·</td></tr><tr><td><code>doFirst(Runnable)</code></td><td>è®¢é˜…å‰</td><td>è®¢é˜…é“¾å»ºç«‹å‰</td></tr><tr><td><code>doFinally(Consumer&lt;SignalType&gt;)</code></td><td>æœ€ç»ˆæ‰§è¡Œ</td><td>ä»»ä½•ç»ˆæ­¢æƒ…å†µ</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç›‘æ§</span><br>flux<br>    .doFirst(() -&gt; log.info(<span class="hljs-string">&quot;å¼€å§‹&quot;</span>))<br>    .doOnSubscribe(s -&gt; log.info(<span class="hljs-string">&quot;è®¢é˜…&quot;</span>))<br>    .doOnRequest(n -&gt; log.info(<span class="hljs-string">&quot;è¯·æ±‚: &quot;</span> + n))<br>    .doOnNext(v -&gt; log.info(<span class="hljs-string">&quot;æ”¶åˆ°: &quot;</span> + v))<br>    .doOnError(e -&gt; log.error(<span class="hljs-string">&quot;é”™è¯¯&quot;</span>, e))<br>    .doOnComplete(() -&gt; log.info(<span class="hljs-string">&quot;å®Œæˆ&quot;</span>))<br>    .doOnCancel(() -&gt; log.info(<span class="hljs-string">&quot;å–æ¶ˆ&quot;</span>))<br>    .doOnTerminate(() -&gt; log.info(<span class="hljs-string">&quot;ç»ˆæ­¢&quot;</span>))<br>    .doAfterTerminate(() -&gt; log.info(<span class="hljs-string">&quot;ç»ˆæ­¢å&quot;</span>))<br>    .doFinally(type -&gt; log.info(<span class="hljs-string">&quot;æœ€ç»ˆ: &quot;</span> + type))<br>    .subscribe();<br></code></pre></td></tr></table></figure><hr><h2 id="ä¸ƒã€è°ƒåº¦å™¨æ“ä½œç¬¦"><a href="#ä¸ƒã€è°ƒåº¦å™¨æ“ä½œç¬¦" class="headerlink" title="ä¸ƒã€è°ƒåº¦å™¨æ“ä½œç¬¦"></a>ä¸ƒã€è°ƒåº¦å™¨æ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>subscribeOn(Scheduler)</code></td><td>æŒ‡å®šè®¢é˜…çº¿ç¨‹</td><td><code>flux.subscribeOn(Schedulers.boundedElastic())</code></td></tr><tr><td><code>publishOn(Scheduler)</code></td><td>æŒ‡å®šå‘å¸ƒçº¿ç¨‹</td><td><code>flux.publishOn(Schedulers.parallel())</code></td></tr></tbody></table><h3 id="è°ƒåº¦å™¨ç±»å‹"><a href="#è°ƒåº¦å™¨ç±»å‹" class="headerlink" title="è°ƒåº¦å™¨ç±»å‹"></a>è°ƒåº¦å™¨ç±»å‹</h3><table><thead><tr><th>Scheduler</th><th>è¯´æ˜</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>Schedulers.immediate()</code></td><td>å½“å‰çº¿ç¨‹</td><td>æµ‹è¯•ã€ç®€å•åœºæ™¯</td></tr><tr><td><code>Schedulers.single()</code></td><td>å•çº¿ç¨‹</td><td>é¡ºåºæ‰§è¡Œ</td></tr><tr><td><code>Schedulers.parallel()</code></td><td>å¹¶è¡Œçº¿ç¨‹æ± ï¼ˆCPUæ ¸å¿ƒæ•°ï¼‰</td><td>CPU å¯†é›†å‹</td></tr><tr><td><code>Schedulers.boundedElastic()</code></td><td>å¼¹æ€§çº¿ç¨‹æ± ï¼ˆæœ‰ä¸Šé™ï¼‰</td><td>I&#x2F;O å¯†é›†å‹ã€é˜»å¡æ“ä½œ</td></tr><tr><td><code>Schedulers.fromExecutor(Executor)</code></td><td>è‡ªå®šä¹‰çº¿ç¨‹æ± </td><td>ç‰¹æ®Šéœ€æ±‚</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// subscribeOn vs publishOn</span><br>Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)<br>    .doOnNext(i -&gt; log.info(<span class="hljs-string">&quot;ç”Ÿæˆ: &quot;</span> + i))  <span class="hljs-comment">// boundedElastic çº¿ç¨‹</span><br>    .subscribeOn(Schedulers.boundedElastic())<br>    .publishOn(Schedulers.parallel())<br>    .doOnNext(i -&gt; log.info(<span class="hljs-string">&quot;å¤„ç†: &quot;</span> + i))  <span class="hljs-comment">// parallel çº¿ç¨‹</span><br>    .subscribe();<br></code></pre></td></tr></table></figure><hr><h2 id="å…«ã€ç¼“å†²ä¸çª—å£æ“ä½œç¬¦"><a href="#å…«ã€ç¼“å†²ä¸çª—å£æ“ä½œç¬¦" class="headerlink" title="å…«ã€ç¼“å†²ä¸çª—å£æ“ä½œç¬¦"></a>å…«ã€ç¼“å†²ä¸çª—å£æ“ä½œç¬¦</h2><h3 id="ç¼“å†²ï¼ˆæ”¶é›†ä¸º-Listï¼‰"><a href="#ç¼“å†²ï¼ˆæ”¶é›†ä¸º-Listï¼‰" class="headerlink" title="ç¼“å†²ï¼ˆæ”¶é›†ä¸º Listï¼‰"></a>ç¼“å†²ï¼ˆæ”¶é›†ä¸º Listï¼‰</h3><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>buffer()</code></td><td>æ”¶é›†æ‰€æœ‰å…ƒç´ </td><td><code>flux.buffer()</code> â†’ <code>Flux&lt;List&lt;T&gt;&gt;</code></td></tr><tr><td><code>buffer(int)</code></td><td>æŒ‰æ•°é‡ç¼“å†²</td><td><code>flux.buffer(10)</code></td></tr><tr><td><code>buffer(Duration)</code></td><td>æŒ‰æ—¶é—´ç¼“å†²</td><td><code>flux.buffer(Duration.ofSeconds(1))</code></td></tr><tr><td><code>buffer(int, int)</code></td><td>æ»‘åŠ¨çª—å£ç¼“å†²</td><td><code>flux.buffer(3, 1)</code></td></tr><tr><td><code>bufferUntil(Predicate)</code></td><td>ç¼“å†²ç›´åˆ°æ¡ä»¶æ»¡è¶³</td><td><code>flux.bufferUntil(i -&gt; i % 10 == 0)</code></td></tr><tr><td><code>bufferWhile(Predicate)</code></td><td>ç¼“å†²å½“æ¡ä»¶æ»¡è¶³æ—¶</td><td><code>flux.bufferWhile(i -&gt; i &lt; 10)</code></td></tr><tr><td><code>bufferTimeout(int, Duration)</code></td><td>æ•°é‡æˆ–æ—¶é—´è§¦å‘</td><td><code>flux.bufferTimeout(100, Duration.ofSeconds(1))</code></td></tr></tbody></table><h3 id="çª—å£ï¼ˆæ”¶é›†ä¸º-Fluxï¼‰"><a href="#çª—å£ï¼ˆæ”¶é›†ä¸º-Fluxï¼‰" class="headerlink" title="çª—å£ï¼ˆæ”¶é›†ä¸º Fluxï¼‰"></a>çª—å£ï¼ˆæ”¶é›†ä¸º Fluxï¼‰</h3><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>window(int)</code></td><td>æŒ‰æ•°é‡åˆ†çª—å£</td><td><code>flux.window(10)</code> â†’ <code>Flux&lt;Flux&lt;T&gt;&gt;</code></td></tr><tr><td><code>window(Duration)</code></td><td>æŒ‰æ—¶é—´åˆ†çª—å£</td><td><code>flux.window(Duration.ofSeconds(1))</code></td></tr><tr><td><code>windowUntil(Predicate)</code></td><td>åˆ†çª—å£ç›´åˆ°æ¡ä»¶æ»¡è¶³</td><td><code>flux.windowUntil(i -&gt; i % 10 == 0)</code></td></tr></tbody></table><h3 id="åˆ†ç»„"><a href="#åˆ†ç»„" class="headerlink" title="åˆ†ç»„"></a>åˆ†ç»„</h3><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>groupBy(Function)</code></td><td>æŒ‰ key åˆ†ç»„</td><td><code>flux.groupBy(User::getType)</code></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// groupBy ç¤ºä¾‹</span><br>flux.groupBy(user -&gt; user.getType())<br>    .flatMap(group -&gt; group<br>        .collectList()<br>        .map(list -&gt; group.key() + <span class="hljs-string">&quot;: &quot;</span> + list.size())<br>    )<br>    .subscribe(System.out::println);<br></code></pre></td></tr></table></figure><hr><h2 id="ä¹ã€èšåˆæ“ä½œç¬¦"><a href="#ä¹ã€èšåˆæ“ä½œç¬¦" class="headerlink" title="ä¹ã€èšåˆæ“ä½œç¬¦"></a>ä¹ã€èšåˆæ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>è¿”å›ç±»å‹</th></tr></thead><tbody><tr><td><code>count()</code></td><td>è®¡æ•°</td><td><code>Mono&lt;Long&gt;</code></td></tr><tr><td><code>reduce(BiFunction)</code></td><td>å½’çº¦</td><td><code>Mono&lt;T&gt;</code></td></tr><tr><td><code>reduce(T, BiFunction)</code></td><td>å¸¦åˆå§‹å€¼å½’çº¦</td><td><code>Mono&lt;T&gt;</code></td></tr><tr><td><code>reduceWith(Supplier, BiFunction)</code></td><td>å»¶è¿Ÿåˆå§‹å€¼å½’çº¦</td><td><code>Mono&lt;T&gt;</code></td></tr><tr><td><code>scan(BiFunction)</code></td><td>ç´¯ç§¯ï¼ˆå‘å‡ºä¸­é—´ç»“æœï¼‰</td><td><code>Flux&lt;T&gt;</code></td></tr><tr><td><code>scan(T, BiFunction)</code></td><td>å¸¦åˆå§‹å€¼ç´¯ç§¯</td><td><code>Flux&lt;T&gt;</code></td></tr><tr><td><code>collect(Collector)</code></td><td>æ”¶é›†åˆ°é›†åˆ</td><td><code>Mono&lt;R&gt;</code></td></tr><tr><td><code>collectList()</code></td><td>æ”¶é›†ä¸º List</td><td><code>Mono&lt;List&lt;T&gt;&gt;</code></td></tr><tr><td><code>collectMap(Function)</code></td><td>æ”¶é›†ä¸º Map</td><td><code>Mono&lt;Map&lt;K, T&gt;&gt;</code></td></tr><tr><td><code>collectMap(Function, Function)</code></td><td>æ”¶é›†ä¸º Mapï¼ˆæŒ‡å®š valueï¼‰</td><td><code>Mono&lt;Map&lt;K, V&gt;&gt;</code></td></tr><tr><td><code>collectMultimap(Function)</code></td><td>æ”¶é›†ä¸º Multimap</td><td><code>Mono&lt;Map&lt;K, Collection&lt;T&gt;&gt;&gt;</code></td></tr><tr><td><code>collectSortedList()</code></td><td>æ”¶é›†ä¸ºæ’åº List</td><td><code>Mono&lt;List&lt;T&gt;&gt;</code></td></tr><tr><td><code>all(Predicate)</code></td><td>æ˜¯å¦å…¨éƒ¨æ»¡è¶³</td><td><code>Mono&lt;Boolean&gt;</code></td></tr><tr><td><code>any(Predicate)</code></td><td>æ˜¯å¦æœ‰æ»¡è¶³çš„</td><td><code>Mono&lt;Boolean&gt;</code></td></tr><tr><td><code>hasElements()</code></td><td>æ˜¯å¦æœ‰å…ƒç´ </td><td><code>Mono&lt;Boolean&gt;</code></td></tr><tr><td><code>hasElement(T)</code></td><td>æ˜¯å¦åŒ…å«å…ƒç´ </td><td><code>Mono&lt;Boolean&gt;</code></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// reduce ç¤ºä¾‹</span><br>Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)<br>    .reduce((a, b) -&gt; a + b)<br>    .subscribe(System.out::println);  <span class="hljs-comment">// 15</span><br><br><span class="hljs-comment">// scan ç¤ºä¾‹ï¼ˆå‘å‡ºä¸­é—´ç»“æœï¼‰</span><br>Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)<br>    .scan((a, b) -&gt; a + b)<br>    .subscribe(System.out::println);  <span class="hljs-comment">// 1, 3, 6, 10, 15</span><br></code></pre></td></tr></table></figure><hr><h2 id="åã€æ—¶é—´æ“ä½œç¬¦"><a href="#åã€æ—¶é—´æ“ä½œç¬¦" class="headerlink" title="åã€æ—¶é—´æ“ä½œç¬¦"></a>åã€æ—¶é—´æ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>delayElements(Duration)</code></td><td>å»¶è¿Ÿæ¯ä¸ªå…ƒç´ </td><td><code>flux.delayElements(Duration.ofMillis(100))</code></td></tr><tr><td><code>delaySequence(Duration)</code></td><td>å»¶è¿Ÿæ•´ä¸ªåºåˆ—</td><td><code>flux.delaySequence(Duration.ofSeconds(1))</code></td></tr><tr><td><code>delaySubscription(Duration)</code></td><td>å»¶è¿Ÿè®¢é˜…</td><td><code>flux.delaySubscription(Duration.ofSeconds(1))</code></td></tr><tr><td><code>timeout(Duration)</code></td><td>è¶…æ—¶</td><td><code>flux.timeout(Duration.ofSeconds(5))</code></td></tr><tr><td><code>timeout(Duration, Publisher)</code></td><td>è¶…æ—¶ååˆ‡æ¢</td><td><code>flux.timeout(Duration.ofSeconds(5), backupFlux)</code></td></tr><tr><td><code>sample(Duration)</code></td><td>é‡‡æ ·</td><td><code>flux.sample(Duration.ofSeconds(1))</code></td></tr><tr><td><code>sampleFirst(Duration)</code></td><td>é‡‡æ ·ç¬¬ä¸€ä¸ª</td><td><code>flux.sampleFirst(Duration.ofSeconds(1))</code></td></tr><tr><td><code>throttleFirst(Duration)</code></td><td>èŠ‚æµï¼ˆå–ç¬¬ä¸€ä¸ªï¼‰</td><td><code>flux.throttleFirst(Duration.ofSeconds(1))</code></td></tr><tr><td><code>throttleLast(Duration)</code></td><td>èŠ‚æµï¼ˆå–æœ€åä¸€ä¸ªï¼‰</td><td><code>flux.throttleLast(Duration.ofSeconds(1))</code></td></tr><tr><td><code>elapsed()</code></td><td>æ·»åŠ æ—¶é—´é—´éš”</td><td><code>flux.elapsed()</code></td></tr><tr><td><code>timed()</code></td><td>æ·»åŠ æ—¶é—´ä¿¡æ¯</td><td><code>flux.timed()</code></td></tr></tbody></table><hr><h2 id="åä¸€ã€èƒŒå‹æ“ä½œç¬¦"><a href="#åä¸€ã€èƒŒå‹æ“ä½œç¬¦" class="headerlink" title="åä¸€ã€èƒŒå‹æ“ä½œç¬¦"></a>åä¸€ã€èƒŒå‹æ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>onBackpressureBuffer()</code></td><td>æ— é™ç¼“å†²</td><td><code>flux.onBackpressureBuffer()</code></td></tr><tr><td><code>onBackpressureBuffer(int)</code></td><td>æœ‰é™ç¼“å†²</td><td><code>flux.onBackpressureBuffer(100)</code></td></tr><tr><td><code>onBackpressureBuffer(int, Consumer)</code></td><td>ç¼“å†²æ»¡æ—¶å›è°ƒ</td><td><code>flux.onBackpressureBuffer(100, v -&gt; log.warn(&quot;æº¢å‡º&quot;))</code></td></tr><tr><td><code>onBackpressureDrop()</code></td><td>ä¸¢å¼ƒ</td><td><code>flux.onBackpressureDrop()</code></td></tr><tr><td><code>onBackpressureDrop(Consumer)</code></td><td>ä¸¢å¼ƒå¹¶å›è°ƒ</td><td><code>flux.onBackpressureDrop(v -&gt; log.warn(&quot;ä¸¢å¼ƒ: &quot; + v))</code></td></tr><tr><td><code>onBackpressureLatest()</code></td><td>åªä¿ç•™æœ€æ–°</td><td><code>flux.onBackpressureLatest()</code></td></tr><tr><td><code>onBackpressureError()</code></td><td>æŠ›å‡ºå¼‚å¸¸</td><td><code>flux.onBackpressureError()</code></td></tr><tr><td><code>limitRate(int)</code></td><td>é™åˆ¶è¯·æ±‚é€Ÿç‡</td><td><code>flux.limitRate(100)</code></td></tr><tr><td><code>limitRequest(long)</code></td><td>é™åˆ¶æ€»è¯·æ±‚æ•°</td><td><code>flux.limitRequest(1000)</code></td></tr></tbody></table><hr><h2 id="åäºŒã€æ¡ä»¶æ“ä½œç¬¦"><a href="#åäºŒã€æ¡ä»¶æ“ä½œç¬¦" class="headerlink" title="åäºŒã€æ¡ä»¶æ“ä½œç¬¦"></a>åäºŒã€æ¡ä»¶æ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>defaultIfEmpty(T)</code></td><td>ç©ºæ—¶è¿”å›é»˜è®¤å€¼</td><td><code>flux.defaultIfEmpty(defaultValue)</code></td></tr><tr><td><code>switchIfEmpty(Publisher)</code></td><td>ç©ºæ—¶åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæµ</td><td><code>flux.switchIfEmpty(backupFlux)</code></td></tr><tr><td><code>repeatWhen(Function)</code></td><td>æ¡ä»¶é‡å¤</td><td><code>flux.repeatWhen(companion -&gt; companion.take(3))</code></td></tr><tr><td><code>repeat()</code></td><td>æ— é™é‡å¤</td><td><code>flux.repeat()</code></td></tr><tr><td><code>repeat(long)</code></td><td>é‡å¤ n æ¬¡</td><td><code>flux.repeat(3)</code></td></tr></tbody></table><hr><h2 id="åä¸‰ã€è°ƒè¯•æ“ä½œç¬¦"><a href="#åä¸‰ã€è°ƒè¯•æ“ä½œç¬¦" class="headerlink" title="åä¸‰ã€è°ƒè¯•æ“ä½œç¬¦"></a>åä¸‰ã€è°ƒè¯•æ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>log()</code></td><td>æ‰“å°æ‰€æœ‰ä¿¡å·</td><td><code>flux.log()</code></td></tr><tr><td><code>log(String)</code></td><td>å¸¦å‰ç¼€æ‰“å°</td><td><code>flux.log(&quot;MyFlux&quot;)</code></td></tr><tr><td><code>log(String, Level)</code></td><td>æŒ‡å®šæ—¥å¿—çº§åˆ«</td><td><code>flux.log(&quot;MyFlux&quot;, Level.FINE)</code></td></tr><tr><td><code>checkpoint()</code></td><td>æ·»åŠ æ£€æŸ¥ç‚¹ï¼ˆè°ƒè¯•ç”¨ï¼‰</td><td><code>flux.checkpoint(&quot;after filter&quot;)</code></td></tr><tr><td><code>checkpoint(String)</code></td><td>å¸¦æè¿°çš„æ£€æŸ¥ç‚¹</td><td><code>flux.checkpoint(&quot;å¤„ç†å&quot;)</code></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è°ƒè¯•ç¤ºä¾‹</span><br>Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)<br>    .log(<span class="hljs-string">&quot;æºæ•°æ®&quot;</span>)<br>    .filter(i -&gt; i &gt; <span class="hljs-number">2</span>)<br>    .log(<span class="hljs-string">&quot;è¿‡æ»¤å&quot;</span>)<br>    .map(i -&gt; i * <span class="hljs-number">2</span>)<br>    .log(<span class="hljs-string">&quot;è½¬æ¢å&quot;</span>)<br>    .subscribe();<br></code></pre></td></tr></table></figure><hr><h2 id="åå››ã€ä¸Šä¸‹æ–‡æ“ä½œç¬¦"><a href="#åå››ã€ä¸Šä¸‹æ–‡æ“ä½œç¬¦" class="headerlink" title="åå››ã€ä¸Šä¸‹æ–‡æ“ä½œç¬¦"></a>åå››ã€ä¸Šä¸‹æ–‡æ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>contextWrite(Context)</code></td><td>å†™å…¥ä¸Šä¸‹æ–‡</td><td><code>flux.contextWrite(Context.of(&quot;key&quot;, &quot;value&quot;))</code></td></tr><tr><td><code>contextWrite(Function)</code></td><td>ä¿®æ”¹ä¸Šä¸‹æ–‡</td><td><code>flux.contextWrite(ctx -&gt; ctx.put(&quot;key&quot;, &quot;value&quot;))</code></td></tr><tr><td><code>deferContextual(Function)</code></td><td>è¯»å–ä¸Šä¸‹æ–‡åˆ›å»ºæµ</td><td>è§ä¸‹æ–¹ç¤ºä¾‹</td></tr><tr><td><code>transformDeferredContextual(BiFunction)</code></td><td>è½¬æ¢æ—¶è¯»å–ä¸Šä¸‹æ–‡</td><td>è§ä¸‹æ–¹ç¤ºä¾‹</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Context ç¤ºä¾‹ - ä¼ é€’è¯·æ±‚ ID</span><br>Mono.deferContextual(ctx -&gt; &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> ctx.get(<span class="hljs-string">&quot;requestId&quot;</span>);<br>    <span class="hljs-keyword">return</span> callService(requestId);<br>&#125;)<br>.contextWrite(Context.of(<span class="hljs-string">&quot;requestId&quot;</span>, UUID.randomUUID().toString()))<br>.subscribe();<br></code></pre></td></tr></table></figure><hr><h2 id="åäº”ã€Mono-ç‰¹æœ‰æ“ä½œç¬¦"><a href="#åäº”ã€Mono-ç‰¹æœ‰æ“ä½œç¬¦" class="headerlink" title="åäº”ã€Mono ç‰¹æœ‰æ“ä½œç¬¦"></a>åäº”ã€Mono ç‰¹æœ‰æ“ä½œç¬¦</h2><table><thead><tr><th>API</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>block()</code></td><td>é˜»å¡è·å–ç»“æœ</td><td><code>mono.block()</code></td></tr><tr><td><code>block(Duration)</code></td><td>å¸¦è¶…æ—¶é˜»å¡</td><td><code>mono.block(Duration.ofSeconds(5))</code></td></tr><tr><td><code>toFuture()</code></td><td>è½¬ä¸º CompletableFuture</td><td><code>mono.toFuture()</code></td></tr><tr><td><code>cache()</code></td><td>ç¼“å­˜ç»“æœ</td><td><code>mono.cache()</code></td></tr><tr><td><code>cache(Duration)</code></td><td>å¸¦è¿‡æœŸæ—¶é—´ç¼“å­˜</td><td><code>mono.cache(Duration.ofMinutes(5))</code></td></tr><tr><td><code>flux()</code></td><td>è½¬ä¸º Flux</td><td><code>mono.flux()</code></td></tr><tr><td><code>zipWhen(Function)</code></td><td>ä¸ä¾èµ–ç»“æœç»„åˆ</td><td><code>mono.zipWhen(v -&gt; fetchRelated(v))</code></td></tr><tr><td><code>delayUntil(Function)</code></td><td>å»¶è¿Ÿç›´åˆ°å¦ä¸€ä¸ªå®Œæˆ</td><td><code>mono.delayUntil(v -&gt; saveAsync(v))</code></td></tr></tbody></table><hr><h2 id="åå…­ã€Sinksï¼ˆæ‰‹åŠ¨å‘é€æ•°æ®ï¼‰"><a href="#åå…­ã€Sinksï¼ˆæ‰‹åŠ¨å‘é€æ•°æ®ï¼‰" class="headerlink" title="åå…­ã€Sinksï¼ˆæ‰‹åŠ¨å‘é€æ•°æ®ï¼‰"></a>åå…­ã€Sinksï¼ˆæ‰‹åŠ¨å‘é€æ•°æ®ï¼‰</h2><h3 id="Sinks-Manyï¼ˆå¤šå€¼ï¼‰"><a href="#Sinks-Manyï¼ˆå¤šå€¼ï¼‰" class="headerlink" title="Sinks.Manyï¼ˆå¤šå€¼ï¼‰"></a>Sinks.Manyï¼ˆå¤šå€¼ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å•æ’­ - åªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…</span><br>Sinks.Many&lt;String&gt; unicast = Sinks.many().unicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// å¤šæ’­ - å¤šä¸ªè®¢é˜…è€…</span><br>Sinks.Many&lt;String&gt; multicast = Sinks.many().multicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// é‡æ”¾ - æ–°è®¢é˜…è€…å¯æ”¶åˆ°å†å²æ•°æ®</span><br>Sinks.Many&lt;String&gt; replay = Sinks.many().replay().all();<br>Sinks.Many&lt;String&gt; replayLimit = Sinks.many().replay().limit(<span class="hljs-number">10</span>);<br>Sinks.Many&lt;String&gt; replayLatest = Sinks.many().replay().latest();<br><br><span class="hljs-comment">// å‘é€æ•°æ®</span><br>sink.tryEmitNext(<span class="hljs-string">&quot;data&quot;</span>);<br>sink.emitNext(<span class="hljs-string">&quot;data&quot;</span>, Sinks.EmitFailureHandler.FAIL_FAST);<br>sink.tryEmitComplete();<br>sink.tryEmitError(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>());<br><br><span class="hljs-comment">// ä½œä¸º Flux ä½¿ç”¨</span><br>Flux&lt;String&gt; flux = sink.asFlux();<br></code></pre></td></tr></table></figure><h3 id="Sinks-Oneï¼ˆå•å€¼ï¼‰"><a href="#Sinks-Oneï¼ˆå•å€¼ï¼‰" class="headerlink" title="Sinks.Oneï¼ˆå•å€¼ï¼‰"></a>Sinks.Oneï¼ˆå•å€¼ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Sinks.One&lt;String&gt; one = Sinks.one();<br>one.tryEmitValue(<span class="hljs-string">&quot;result&quot;</span>);<br>Mono&lt;String&gt; mono = one.asMono();<br></code></pre></td></tr></table></figure><h3 id="Sinks-Emptyï¼ˆæ— å€¼ï¼‰"><a href="#Sinks-Emptyï¼ˆæ— å€¼ï¼‰" class="headerlink" title="Sinks.Emptyï¼ˆæ— å€¼ï¼‰"></a>Sinks.Emptyï¼ˆæ— å€¼ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Sinks.Empty&lt;Void&gt; empty = Sinks.empty();<br>empty.tryEmitEmpty();<br>Mono&lt;Void&gt; mono = empty.asMono();<br></code></pre></td></tr></table></figure><hr><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>Project Reactor å®ç°</li><li>æºç è§£æ</li><li>WebFlux - Reactoræ ¸å¿ƒAPI</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Reactive Streams</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>ReactiveStreams</tag>
      
      <tag>Reactor</tag>
      
      <tag>API</tag>
      
      <tag>æ“ä½œç¬¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å“åº”å¼ç¼–ç¨‹åŸºç¡€</title>
    <link href="/2026/01/10/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/"/>
    <url>/2026/01/10/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="å“åº”å¼ç¼–ç¨‹åŸºç¡€"><a href="#å“åº”å¼ç¼–ç¨‹åŸºç¡€" class="headerlink" title="å“åº”å¼ç¼–ç¨‹åŸºç¡€"></a>å“åº”å¼ç¼–ç¨‹åŸºç¡€</h1><h2 id="ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹"><a href="#ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹" class="headerlink" title="ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹"></a>ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹</h2><p>å“åº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰æ˜¯ä¸€ç§<strong>é¢å‘æ•°æ®æµå’Œå˜åŒ–ä¼ æ’­</strong>çš„ç¼–ç¨‹èŒƒå¼ã€‚å®ƒå…³æ³¨çš„æ˜¯æ•°æ®æµçš„å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨ã€‚</p><h3 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h3><ul><li><strong>æ•°æ®æµï¼ˆStreamï¼‰</strong>ï¼šæ•°æ®ä»¥æµçš„å½¢å¼ä¼ é€’ï¼Œè€Œéä¸€æ¬¡æ€§è¿”å›</li><li><strong>å¼‚æ­¥ï¼ˆAsynchronousï¼‰</strong>ï¼šæ“ä½œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹</li><li><strong>éé˜»å¡ï¼ˆNon-blockingï¼‰</strong>ï¼šçº¿ç¨‹ä¸ä¼šç­‰å¾… I&#x2F;O æ“ä½œå®Œæˆ</li><li><strong>èƒŒå‹ï¼ˆBackpressureï¼‰</strong>ï¼šæ¶ˆè´¹è€…å¯ä»¥æ§åˆ¶ç”Ÿäº§è€…çš„æ•°æ®å‘é€é€Ÿç‡</li></ul><h2 id="Reactive-Streams-è§„èŒƒ"><a href="#Reactive-Streams-è§„èŒƒ" class="headerlink" title="Reactive Streams è§„èŒƒ"></a>Reactive Streams è§„èŒƒ</h2><p>Reactive Streams æ˜¯ JVM ä¸Šå“åº”å¼ç¼–ç¨‹çš„æ ‡å‡†è§„èŒƒï¼Œå®šä¹‰äº†å››ä¸ªæ ¸å¿ƒæ¥å£ï¼š</p><h3 id="1-Publisherï¼ˆå‘å¸ƒè€…ï¼‰"><a href="#1-Publisherï¼ˆå‘å¸ƒè€…ï¼‰" class="headerlink" title="1. Publisherï¼ˆå‘å¸ƒè€…ï¼‰"></a>1. Publisherï¼ˆå‘å¸ƒè€…ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Publisher</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">(Subscriber&lt;? <span class="hljs-built_in">super</span> T&gt; s)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®çš„ç”Ÿäº§è€…</li><li>å¯ä»¥å‘å¸ƒæ— é™æˆ–æœ‰é™æ•°é‡çš„å…ƒç´ </li></ul><h3 id="2-Subscriberï¼ˆè®¢é˜…è€…ï¼‰"><a href="#2-Subscriberï¼ˆè®¢é˜…è€…ï¼‰" class="headerlink" title="2. Subscriberï¼ˆè®¢é˜…è€…ï¼‰"></a>2. Subscriberï¼ˆè®¢é˜…è€…ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Subscriber</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSubscribe</span><span class="hljs-params">(Subscription s)</span>;  <span class="hljs-comment">// è®¢é˜…æˆåŠŸæ—¶è°ƒç”¨</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNext</span><span class="hljs-params">(T t)</span>;                   <span class="hljs-comment">// æ¥æ”¶åˆ°æ–°å…ƒç´ æ—¶è°ƒç”¨</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable t)</span>;          <span class="hljs-comment">// å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">()</span>;                  <span class="hljs-comment">// æ•°æ®æµç»“æŸæ—¶è°ƒç”¨</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ•°æ®çš„æ¶ˆè´¹è€…</li><li>é€šè¿‡å›è°ƒæ–¹æ³•æ¥æ”¶æ•°æ®å’Œäº‹ä»¶</li></ul><h3 id="3-Subscriptionï¼ˆè®¢é˜…å…³ç³»ï¼‰"><a href="#3-Subscriptionï¼ˆè®¢é˜…å…³ç³»ï¼‰" class="headerlink" title="3. Subscriptionï¼ˆè®¢é˜…å…³ç³»ï¼‰"></a>3. Subscriptionï¼ˆè®¢é˜…å…³ç³»ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Subscription</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">request</span><span class="hljs-params">(<span class="hljs-type">long</span> n)</span>;  <span class="hljs-comment">// è¯·æ±‚ n ä¸ªå…ƒç´ </span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">()</span>;         <span class="hljs-comment">// å–æ¶ˆè®¢é˜…</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>è¡¨ç¤º Publisher å’Œ Subscriber ä¹‹é—´çš„è®¢é˜…å…³ç³»</li><li><strong>èƒŒå‹çš„æ ¸å¿ƒ</strong>ï¼šé€šè¿‡ <code>request(n)</code> æ§åˆ¶æ•°æ®æµé€Ÿ</li></ul><h3 id="4-Processorï¼ˆå¤„ç†å™¨ï¼‰"><a href="#4-Processorï¼ˆå¤„ç†å™¨ï¼‰" class="headerlink" title="4. Processorï¼ˆå¤„ç†å™¨ï¼‰"></a>4. Processorï¼ˆå¤„ç†å™¨ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Processor</span>&lt;T, R&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Subscriber</span>&lt;T&gt;, Publisher&lt;R&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ—¢æ˜¯è®¢é˜…è€…åˆæ˜¯å‘å¸ƒè€…</li><li>ç”¨äºæ•°æ®è½¬æ¢å’Œå¤„ç†</li></ul><h2 id="æ•°æ®æµç”Ÿå‘½å‘¨æœŸ"><a href="#æ•°æ®æµç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ•°æ®æµç”Ÿå‘½å‘¨æœŸ"></a>æ•°æ®æµç”Ÿå‘½å‘¨æœŸ</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs isbl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     <span class="hljs-function"><span class="hljs-title">subscribe</span>()      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="hljs-function">â”‚   <span class="hljs-variable">Publisher</span>  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  <span class="hljs-variable">Subscriber</span>  â”‚</span><br><span class="hljs-function">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="hljs-function">       â”‚                                     â”‚</span><br><span class="hljs-function">       â”‚         <span class="hljs-title">onSubscribe</span>(<span class="hljs-variable">subscription</span>)   â”‚</span><br><span class="hljs-function">       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚</span><br><span class="hljs-function">       â”‚                                     â”‚</span><br><span class="hljs-function">       â”‚         <span class="hljs-title">request</span>(<span class="hljs-variable">n</span>)                  â”‚</span><br><span class="hljs-function">       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚</span><br><span class="hljs-function">       â”‚                                     â”‚</span><br><span class="hljs-function">       â”‚         <span class="hljs-title">onNext</span>(<span class="hljs-variable">data</span>) Ã— <span class="hljs-variable">n</span>            â”‚</span><br><span class="hljs-function">       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="hljs-function">       â”‚                                     â”‚</span><br><span class="hljs-function">       â”‚         <span class="hljs-title">onComplete</span>() / <span class="hljs-title">onError</span>()    â”‚</span><br><span class="hljs-function">       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="hljs-function">       â–¼                                     â–¼</span><br></code></pre></td></tr></table></figure><h2 id="èƒŒå‹ï¼ˆBackpressureï¼‰"><a href="#èƒŒå‹ï¼ˆBackpressureï¼‰" class="headerlink" title="èƒŒå‹ï¼ˆBackpressureï¼‰"></a>èƒŒå‹ï¼ˆBackpressureï¼‰</h2><p>èƒŒå‹æ˜¯å“åº”å¼ç¼–ç¨‹ä¸­çš„é‡è¦æ¦‚å¿µï¼Œç”¨äºè§£å†³<strong>ç”Ÿäº§è€…é€Ÿåº¦å¿«äºæ¶ˆè´¹è€…</strong>çš„é—®é¢˜ã€‚</p><h3 id="èƒŒå‹ç­–ç•¥"><a href="#èƒŒå‹ç­–ç•¥" class="headerlink" title="èƒŒå‹ç­–ç•¥"></a>èƒŒå‹ç­–ç•¥</h3><table><thead><tr><th>ç­–ç•¥</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Buffer</strong></td><td>ç¼“å­˜æ‰€æœ‰å…ƒç´ ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º</td></tr><tr><td><strong>Drop</strong></td><td>ä¸¢å¼ƒæ— æ³•å¤„ç†çš„å…ƒç´ </td></tr><tr><td><strong>Latest</strong></td><td>åªä¿ç•™æœ€æ–°çš„å…ƒç´ </td></tr><tr><td><strong>Error</strong></td><td>æŠ›å‡ºå¼‚å¸¸</td></tr></tbody></table><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)<br>    .onBackpressureBuffer(<span class="hljs-number">100</span>)      <span class="hljs-comment">// ç¼“å­˜100ä¸ªå…ƒç´ </span><br>    .onBackpressureDrop()           <span class="hljs-comment">// ä¸¢å¼ƒå¤šä½™å…ƒç´ </span><br>    .onBackpressureLatest()         <span class="hljs-comment">// åªä¿ç•™æœ€æ–°</span><br>    .subscribe(data -&gt; &#123;<br>        <span class="hljs-comment">// å¤„ç†æ•°æ®</span><br>    &#125;);<br></code></pre></td></tr></table></figure><h2 id="å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿"><a href="#å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿" class="headerlink" title="å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿"></a>å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿</h2><ol><li><strong>èµ„æºåˆ©ç”¨ç‡é«˜</strong>ï¼šå°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡è¯·æ±‚</li><li><strong>å“åº”æ€§å¥½</strong>ï¼šä¸ä¼šå› ä¸ºæŸä¸ªæ“ä½œé˜»å¡æ•´ä¸ªç³»ç»Ÿ</li><li><strong>å¼¹æ€§</strong>ï¼šæ›´å®¹æ˜“å¤„ç†é”™è¯¯å’Œæ•…éšœ</li><li><strong>å¯ç»„åˆæ€§</strong>ï¼šæ“ä½œç¬¦å¯ä»¥çµæ´»ç»„åˆ</li></ol><h2 id="å“åº”å¼ç¼–ç¨‹çš„æŒ‘æˆ˜"><a href="#å“åº”å¼ç¼–ç¨‹çš„æŒ‘æˆ˜" class="headerlink" title="å“åº”å¼ç¼–ç¨‹çš„æŒ‘æˆ˜"></a>å“åº”å¼ç¼–ç¨‹çš„æŒ‘æˆ˜</h2><ol><li><strong>è°ƒè¯•å›°éš¾</strong>ï¼šå¼‚æ­¥ä»£ç çš„å †æ ˆè·Ÿè¸ªä¸ç›´è§‚</li><li><strong>å­¦ä¹ æ›²çº¿</strong>ï¼šéœ€è¦è½¬å˜æ€ç»´æ–¹å¼</li><li><strong>ç”Ÿæ€é™åˆ¶</strong>ï¼šéœ€è¦æ•´ä¸ªè°ƒç”¨é“¾éƒ½æ˜¯å“åº”å¼çš„</li></ol><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸Šä¸€ç¯‡ï¼šWebfluxç®€ä»‹</li><li>ä¸‹ä¸€ç¯‡ï¼šReactoræ ¸å¿ƒAPI</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Webflux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>ReactiveStreams</tag>
      
      <tag>WebFlux</tag>
      
      <tag>å“åº”å¼ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æµåˆå¹¶ä¸æ“ä½œç¬¦é“¾</title>
    <link href="/2026/01/10/%E6%B5%81%E5%90%88%E5%B9%B6%E4%B8%8E%E6%93%8D%E4%BD%9C%E7%AC%A6%E9%93%BE/"/>
    <url>/2026/01/10/%E6%B5%81%E5%90%88%E5%B9%B6%E4%B8%8E%E6%93%8D%E4%BD%9C%E7%AC%A6%E9%93%BE/</url>
    
    <content type="html"><![CDATA[<h1 id="æµåˆå¹¶ä¸æ“ä½œç¬¦é“¾"><a href="#æµåˆå¹¶ä¸æ“ä½œç¬¦é“¾" class="headerlink" title="æµåˆå¹¶ä¸æ“ä½œç¬¦é“¾"></a>æµåˆå¹¶ä¸æ“ä½œç¬¦é“¾</h1><h2 id="æ°´åˆ©ç³»ç»Ÿæ¯”å–»"><a href="#æ°´åˆ©ç³»ç»Ÿæ¯”å–»" class="headerlink" title="æ°´åˆ©ç³»ç»Ÿæ¯”å–»"></a>æ°´åˆ©ç³»ç»Ÿæ¯”å–»</h2><p>åœ¨å­¦ä¹  Reactor æ—¶ï¼Œå¯ä»¥ç”¨æ°´åˆ©ç³»ç»Ÿæ¥ç†è§£ï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs nix">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                     Reactor æ°´åˆ©ç³»ç»Ÿ                          â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚                                                              â”‚<br>â”‚  æ°´æºç±»å‹ï¼š                                                   â”‚<br>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚<br>â”‚  â”‚ just()   â”‚  â”‚ interval â”‚  â”‚  HTTP    â”‚  â”‚  Sinks   â”‚     â”‚<br>â”‚  â”‚ çŸ¿æ³‰æ°´ç“¶  â”‚  â”‚ å®šæ—¶æ»´æ°´  â”‚  â”‚ å¤–éƒ¨æ°´ç®¡  â”‚  â”‚ ä½ çš„æ°´é¾™å¤´â”‚     â”‚<br>â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚<br>â”‚       â”‚             â”‚             â”‚             â”‚            â”‚<br>â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚<br>â”‚              â”‚             â”‚             â”‚                   â”‚<br>â”‚              â–¼             â–¼             â–¼                   â”‚<br>â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚<br>â”‚         â”‚  merge <span class="hljs-symbol">/</span> concat <span class="hljs-symbol">/</span> zip (åˆå¹¶æ°´ç®¡)     â”‚              â”‚<br>â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚<br>â”‚                           â”‚                                  â”‚<br>â”‚                           â–¼                                  â”‚<br>â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚<br>â”‚         â”‚  filter <span class="hljs-symbol">/</span> <span class="hljs-built_in">map</span> <span class="hljs-symbol">/</span> take (å¤„ç†æ°´ç®¡)      â”‚              â”‚<br>â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚<br>â”‚                           â”‚                                  â”‚<br>â”‚                           â–¼                                  â”‚<br>â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚<br>â”‚         â”‚         subscribe (æ°´æ± )            â”‚              â”‚<br>â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚<br>â”‚                                                              â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><table><thead><tr><th>æ¦‚å¿µ</th><th>æ¯”å–»</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Sinks</strong></td><td>æ°´é¾™å¤´</td><td>ä½ æ§åˆ¶å¼€å…³ï¼Œå†³å®šä»€ä¹ˆæ—¶å€™æ”¾æ°´</td></tr><tr><td><strong>Flux</strong></td><td>æ°´ç®¡</td><td>åªè´Ÿè´£ä¼ è¾“ï¼Œä¸ç®¡æ°´ä»å“ªæ¥ã€æœ‰å¤šå°‘</td></tr><tr><td><strong>æ“ä½œç¬¦</strong></td><td>å¤„ç†æ°´ç®¡</td><td>filter&#x3D;è¿‡æ»¤å™¨ï¼Œmap&#x3D;è½¬æ¢å™¨ï¼Œtake&#x3D;é™æµé˜€</td></tr><tr><td><strong>subscribe</strong></td><td>æ°´æ± </td><td>æ¥æ”¶æœ€ç»ˆçš„æ°´</td></tr></tbody></table><hr><h2 id="ä¸€ã€æ“ä½œç¬¦é“¾ï¼ˆæ°´ç®¡æ¥æ°´ç®¡ï¼‰"><a href="#ä¸€ã€æ“ä½œç¬¦é“¾ï¼ˆæ°´ç®¡æ¥æ°´ç®¡ï¼‰" class="headerlink" title="ä¸€ã€æ“ä½œç¬¦é“¾ï¼ˆæ°´ç®¡æ¥æ°´ç®¡ï¼‰"></a>ä¸€ã€æ“ä½œç¬¦é“¾ï¼ˆæ°´ç®¡æ¥æ°´ç®¡ï¼‰</h2><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>æ¯ä¸ªæ“ä½œç¬¦éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Fluxï¼Œå½¢æˆé“¾å¼è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)       <span class="hljs-comment">// æ°´æºï¼š1åˆ°10</span><br>    .filter(i -&gt; i &gt; <span class="hljs-number">5</span>)  <span class="hljs-comment">// è¿‡æ»¤ï¼šåªç•™å¤§äº5çš„</span><br>    .map(i -&gt; i * <span class="hljs-number">2</span>)     <span class="hljs-comment">// è½¬æ¢ï¼šæ¯ä¸ªä¹˜2</span><br>    .take(<span class="hljs-number">3</span>)             <span class="hljs-comment">// é™æµï¼šåªå–3ä¸ª</span><br>    .subscribe();        <span class="hljs-comment">// æ°´æ± ï¼šæ¥æ”¶</span><br></code></pre></td></tr></table></figure><h3 id="æ•°æ®æµåŠ¨è¿‡ç¨‹"><a href="#æ•°æ®æµåŠ¨è¿‡ç¨‹" class="headerlink" title="æ•°æ®æµåŠ¨è¿‡ç¨‹"></a>æ•°æ®æµåŠ¨è¿‡ç¨‹</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ range  â”‚â”€â”€â”€â–¶â”‚ <span class="hljs-attribute">filter</span> â”‚â”€â”€â”€â–¶â”‚  map   â”‚â”€â”€â”€â–¶â”‚  take  â”‚â”€â”€â”€â–¶â”‚ è®¢é˜…è€… â”‚<br>â”‚<span class="hljs-number">1</span>,<span class="hljs-number">2</span>..<span class="hljs-selector-class">.10</span>â”‚    â”‚  &gt;<span class="hljs-number">5</span>    â”‚    â”‚  *<span class="hljs-number">2</span>    â”‚    â”‚  <span class="hljs-number">3</span>ä¸ª   â”‚    â”‚        â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>   <span class="hljs-number">10</span>ä¸ª    â†’    <span class="hljs-number">5</span>ä¸ª     â†’     <span class="hljs-number">5</span>ä¸ª     â†’     <span class="hljs-number">3</span>ä¸ª     â†’    æ”¶åˆ°<span class="hljs-number">3</span>ä¸ª<br>  (<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>) (<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>)  (<span class="hljs-number">12</span>,<span class="hljs-number">14</span>,<span class="hljs-number">16</span>,<span class="hljs-number">18</span>,<span class="hljs-number">20</span>) (<span class="hljs-number">12</span>,<span class="hljs-number">14</span>,<span class="hljs-number">16</span>)<br></code></pre></td></tr></table></figure><h3 id="å¸¸ç”¨æ“ä½œç¬¦åˆ†ç±»"><a href="#å¸¸ç”¨æ“ä½œç¬¦åˆ†ç±»" class="headerlink" title="å¸¸ç”¨æ“ä½œç¬¦åˆ†ç±»"></a>å¸¸ç”¨æ“ä½œç¬¦åˆ†ç±»</h3><table><thead><tr><th>ç±»å‹</th><th>æ“ä½œç¬¦</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>è¿‡æ»¤</strong></td><td><code>filter</code>, <code>take</code>, <code>skip</code>, <code>distinct</code></td><td>ç­›é€‰æ•°æ®</td></tr><tr><td><strong>è½¬æ¢</strong></td><td><code>map</code>, <code>flatMap</code>, <code>concatMap</code></td><td>è½¬æ¢æ•°æ®</td></tr><tr><td><strong>ç»„åˆ</strong></td><td><code>merge</code>, <code>concat</code>, <code>zip</code></td><td>åˆå¹¶å¤šä¸ªæµ</td></tr><tr><td><strong>é”™è¯¯å¤„ç†</strong></td><td><code>onErrorReturn</code>, <code>retry</code></td><td>å¤„ç†å¼‚å¸¸</td></tr><tr><td><strong>å‰¯ä½œç”¨</strong></td><td><code>doOnNext</code>, <code>doOnError</code>, <code>doOnComplete</code></td><td>æ‰§è¡Œé¢å¤–æ“ä½œ</td></tr></tbody></table><hr><h2 id="äºŒã€æµåˆå¹¶ï¼ˆå¤šä¸ªæ°´é¾™å¤´åˆå¹¶ï¼‰"><a href="#äºŒã€æµåˆå¹¶ï¼ˆå¤šä¸ªæ°´é¾™å¤´åˆå¹¶ï¼‰" class="headerlink" title="äºŒã€æµåˆå¹¶ï¼ˆå¤šä¸ªæ°´é¾™å¤´åˆå¹¶ï¼‰"></a>äºŒã€æµåˆå¹¶ï¼ˆå¤šä¸ªæ°´é¾™å¤´åˆå¹¶ï¼‰</h2><h3 id="1-merge-å®æ—¶æ··åˆ"><a href="#1-merge-å®æ—¶æ··åˆ" class="headerlink" title="1. merge - å®æ—¶æ··åˆ"></a>1. merge - å®æ—¶æ··åˆ</h3><p><strong>ç‰¹ç‚¹</strong>ï¼šè°æœ‰æ•°æ®è°å…ˆè¾“å‡ºï¼Œä¸ä¿è¯é¡ºåº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux&lt;String&gt; flux1 = Flux.just(<span class="hljs-string">&quot;A1&quot;</span>, <span class="hljs-string">&quot;A2&quot;</span>).delayElements(Duration.ofMillis(<span class="hljs-number">100</span>));<br>Flux&lt;String&gt; flux2 = Flux.just(<span class="hljs-string">&quot;B1&quot;</span>, <span class="hljs-string">&quot;B2&quot;</span>).delayElements(Duration.ofMillis(<span class="hljs-number">80</span>));<br><br>Flux.merge(flux1, flux2).subscribe(System.out::println);<br><span class="hljs-comment">// å¯èƒ½è¾“å‡º: B1, A1, B2, A2ï¼ˆè°å¿«è°å…ˆï¼‰</span><br></code></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">flux1 â”€â”€<span class="hljs-built_in">A1</span>â”€â”€â”€â”€<span class="hljs-built_in">A2</span>â”€â”€â”€â”€â”<br>                    â”œâ”€â”€â–¶ merge â”€â”€â–¶ <span class="hljs-keyword">B1, </span><span class="hljs-built_in">A1</span>, <span class="hljs-keyword">B2, </span><span class="hljs-built_in">A2</span><br>flux2 â”€â”€<span class="hljs-keyword">B1â”€â”€B2â”€â”€â”€â”€â”€â”€â”˜</span><br></code></pre></td></tr></table></figure><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå®æ—¶æ•°æ®æ··åˆã€ä¸å…³å¿ƒé¡ºåº</p><h3 id="2-concat-é¡ºåºè¿æ¥"><a href="#2-concat-é¡ºåºè¿æ¥" class="headerlink" title="2. concat - é¡ºåºè¿æ¥"></a>2. concat - é¡ºåºè¿æ¥</h3><p><strong>ç‰¹ç‚¹</strong>ï¼šç¬¬ä¸€ä¸ªæµå®Œæˆåï¼Œæ‰å¼€å§‹ç¬¬äºŒä¸ªæµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.concat(flux1, flux2).subscribe(System.out::println);<br><span class="hljs-comment">// è¾“å‡º: A1, A2, B1, B2ï¼ˆå…ˆAå…¨éƒ¨ï¼Œå†Bå…¨éƒ¨ï¼‰</span><br></code></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">flux1 â”€â”€<span class="hljs-built_in">A1</span>â”€â”€<span class="hljs-built_in">A2</span>â”€â”€â”<br>                â”œâ”€â”€â–¶ concat â”€â”€â–¶ <span class="hljs-built_in">A1</span>, <span class="hljs-built_in">A2</span>, <span class="hljs-keyword">B1, </span><span class="hljs-keyword">B2</span><br><span class="hljs-keyword"></span>flux2 â”€â”€<span class="hljs-keyword">B1â”€â”€B2â”€â”€â”˜ï¼ˆç­‰Aå®Œæˆå†å¼€å§‹ï¼‰</span><br></code></pre></td></tr></table></figure><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéœ€è¦ä¿è¯é¡ºåºã€åˆ†é¡µåŠ è½½</p><h3 id="3-zip-ä¸€å¯¹ä¸€é…å¯¹"><a href="#3-zip-ä¸€å¯¹ä¸€é…å¯¹" class="headerlink" title="3. zip - ä¸€å¯¹ä¸€é…å¯¹"></a>3. zip - ä¸€å¯¹ä¸€é…å¯¹</h3><p><strong>ç‰¹ç‚¹</strong>ï¼šä»æ¯ä¸ªæµå„å–ä¸€ä¸ªå…ƒç´ ï¼Œç»„åˆæˆä¸€å¯¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux&lt;String&gt; names = Flux.just(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>, <span class="hljs-string">&quot;æå››&quot;</span>, <span class="hljs-string">&quot;ç‹äº”&quot;</span>);<br>Flux&lt;Integer&gt; ages = Flux.just(<span class="hljs-number">25</span>, <span class="hljs-number">30</span>, <span class="hljs-number">28</span>);<br><br>Flux.zip(names, ages, (name, age) -&gt; name + <span class="hljs-string">&quot;: &quot;</span> + age)<br>    .subscribe(System.out::println);<br><span class="hljs-comment">// è¾“å‡º: å¼ ä¸‰: 25, æå››: 30, ç‹äº”: 28</span><br></code></pre></td></tr></table></figure><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs scss">names â”€â”€å¼ ä¸‰â”€â”€â”€â”€æå››â”€â”€â”€â”€ç‹äº”â”€â”€â”€â”€â”<br>                               â”œâ”€â”€â–¶ zip â”€â”€â–¶ (å¼ ä¸‰:<span class="hljs-number">25</span>), (æå››:<span class="hljs-number">30</span>), (ç‹äº”:<span class="hljs-number">28</span>)<br>ages  â”€â”€<span class="hljs-number">25</span>â”€â”€â”€â”€â”€â”€<span class="hljs-number">30</span>â”€â”€â”€â”€â”€â”€<span class="hljs-number">28</span>â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ•°æ®é…å¯¹ã€å¹¶è¡Œè¯·æ±‚ç»“æœç»„åˆ</p><h3 id="4-combineLatest-ç»„åˆæœ€æ–°å€¼"><a href="#4-combineLatest-ç»„åˆæœ€æ–°å€¼" class="headerlink" title="4. combineLatest - ç»„åˆæœ€æ–°å€¼"></a>4. combineLatest - ç»„åˆæœ€æ–°å€¼</h3><p><strong>ç‰¹ç‚¹</strong>ï¼šä»»ä¸€æµæœ‰æ–°å€¼æ—¶ï¼Œä¸å…¶ä»–æµçš„æœ€æ–°å€¼ç»„åˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux&lt;String&gt; flux1 = Flux.interval(Duration.ofMillis(<span class="hljs-number">100</span>)).map(i -&gt; <span class="hljs-string">&quot;A&quot;</span> + i);<br>Flux&lt;String&gt; flux2 = Flux.interval(Duration.ofMillis(<span class="hljs-number">150</span>)).map(i -&gt; <span class="hljs-string">&quot;B&quot;</span> + i);<br><br>Flux.combineLatest(flux1, flux2, (a, b) -&gt; a + <span class="hljs-string">&quot;+&quot;</span> + b)<br>    .take(<span class="hljs-number">5</span>)<br>    .subscribe(System.out::println);<br><span class="hljs-comment">// è¾“å‡º: A0+B0, A1+B0, A1+B1, A2+B1, A3+B1...</span><br></code></pre></td></tr></table></figure><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå®æ—¶æ•°æ®ç»„åˆã€è¡¨å•è”åŠ¨</p><h3 id="åˆå¹¶æ–¹å¼å¯¹æ¯”"><a href="#åˆå¹¶æ–¹å¼å¯¹æ¯”" class="headerlink" title="åˆå¹¶æ–¹å¼å¯¹æ¯”"></a>åˆå¹¶æ–¹å¼å¯¹æ¯”</h3><table><thead><tr><th>æ–¹å¼</th><th>æ‰§è¡Œé¡ºåº</th><th>è¾“å‡ºé¡ºåº</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>merge</code></td><td>å¹¶è¡Œ</td><td>è°å¿«è°å…ˆ</td><td>å®æ—¶æ··åˆ</td></tr><tr><td><code>concat</code></td><td>ä¸²è¡Œ</td><td>æŒ‰æµé¡ºåº</td><td>é¡ºåºå¤„ç†</td></tr><tr><td><code>zip</code></td><td>å¹¶è¡Œ</td><td>é…å¯¹è¾“å‡º</td><td>æ•°æ®ç»„åˆ</td></tr><tr><td><code>combineLatest</code></td><td>å¹¶è¡Œ</td><td>æœ€æ–°ç»„åˆ</td><td>å®æ—¶è”åŠ¨</td></tr></tbody></table><hr><h2 id="ä¸‰ã€å®æˆ˜ï¼šå¤–éƒ¨æµ-æœ¬åœ°æµåˆå¹¶"><a href="#ä¸‰ã€å®æˆ˜ï¼šå¤–éƒ¨æµ-æœ¬åœ°æµåˆå¹¶" class="headerlink" title="ä¸‰ã€å®æˆ˜ï¼šå¤–éƒ¨æµ + æœ¬åœ°æµåˆå¹¶"></a>ä¸‰ã€å®æˆ˜ï¼šå¤–éƒ¨æµ + æœ¬åœ°æµåˆå¹¶</h2><h3 id="åœºæ™¯æè¿°"><a href="#åœºæ™¯æè¿°" class="headerlink" title="åœºæ™¯æè¿°"></a>åœºæ™¯æè¿°</h3><p>è°ƒç”¨å¤–éƒ¨ APIï¼ˆå¦‚å¤§æ¨¡å‹ï¼‰ï¼ŒåŒæ—¶æœ¬åœ°ä¹Ÿèƒ½æ¨é€æ¶ˆæ¯ï¼Œä¸¤ä¸ªæµåˆå¹¶åè¿”å›ç»™å‰ç«¯ã€‚</p><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatService</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebClient webClient;<br>    <br>    <span class="hljs-comment">// ç³»ç»Ÿé€šçŸ¥çš„æ°´é¾™å¤´</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sinks.Many&lt;String&gt; notificationSink = <br>        Sinks.many().multicast().onBackpressureBuffer();<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–åˆå¹¶åçš„æ¶ˆæ¯æµ</span><br><span class="hljs-comment">     * ç”¨æˆ·æ—¢èƒ½æ”¶åˆ°å¤§æ¨¡å‹å›å¤ï¼Œä¹Ÿèƒ½æ”¶åˆ°ç³»ç»Ÿé€šçŸ¥</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Flux&lt;String&gt; <span class="hljs-title function_">getChatStream</span><span class="hljs-params">(String prompt)</span> &#123;<br>        <span class="hljs-comment">// 1. å¤–éƒ¨æµï¼šå¤§æ¨¡å‹å›å¤</span><br>        Flux&lt;String&gt; llmResponse = webClient.post()<br>            .uri(<span class="hljs-string">&quot;/v1/chat/completions&quot;</span>)<br>            .bodyValue(buildRequest(prompt))<br>            .retrieve()<br>            .bodyToFlux(String.class)<br>            .map(<span class="hljs-built_in">this</span>::extractContent)<br>            .filter(Objects::nonNull);<br>        <br>        <span class="hljs-comment">// 2. æœ¬åœ°æµï¼šç³»ç»Ÿé€šçŸ¥</span><br>        Flux&lt;String&gt; notifications = notificationSink.asFlux()<br>            .map(msg -&gt; <span class="hljs-string">&quot;[ç³»ç»Ÿ] &quot;</span> + msg);<br>        <br>        <span class="hljs-comment">// 3. åˆå¹¶ä¸¤ä¸ªæµ</span><br>        <span class="hljs-keyword">return</span> Flux.merge(llmResponse, notifications);<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‘é€ç³»ç»Ÿé€šçŸ¥ï¼ˆå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ï¼‰</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendNotification</span><span class="hljs-params">(String message)</span> &#123;<br>        notificationSink.tryEmitNext(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ•ˆæœæ¼”ç¤º"><a href="#æ•ˆæœæ¼”ç¤º" class="headerlink" title="æ•ˆæœæ¼”ç¤º"></a>æ•ˆæœæ¼”ç¤º</h3><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs isbl">ç”¨æˆ·è®¢é˜… <span class="hljs-function"><span class="hljs-title">getChatStream</span>(<span class="hljs-string">&quot;ä½ å¥½&quot;</span>)</span><br>    â”‚<br>    â”œâ”€â”€ å¤§æ¨¡å‹: <span class="hljs-string">&quot;ä½ &quot;</span><br>    â”œâ”€â”€ å¤§æ¨¡å‹: <span class="hljs-string">&quot;å¥½&quot;</span><br>    â”œâ”€â”€ ç³»ç»Ÿé€šçŸ¥: <span class="hljs-string">&quot;[ç³»ç»Ÿ] æœåŠ¡å™¨å°†åœ¨5åˆ†é’Ÿåç»´æŠ¤&quot;</span>  â† éšæ—¶æ’å…¥<br>    â”œâ”€â”€ å¤§æ¨¡å‹: <span class="hljs-string">&quot;ï¼Œæˆ‘æ˜¯AIåŠ©æ‰‹&quot;</span><br>    â”œâ”€â”€ ç³»ç»Ÿé€šçŸ¥: <span class="hljs-string">&quot;[ç³»ç»Ÿ] æ–°åŠŸèƒ½ä¸Šçº¿&quot;</span>  â† éšæ—¶æ’å…¥<br>    â””â”€â”€ å¤§æ¨¡å‹: <span class="hljs-string">&quot;...&quot;</span><br></code></pre></td></tr></table></figure><h3 id="å›¾ç¤º"><a href="#å›¾ç¤º" class="headerlink" title="å›¾ç¤º"></a>å›¾ç¤º</h3><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚   å¤–éƒ¨ API      â”‚<br>â”‚  (å¤§æ¨¡å‹è¿”å›)    â”‚â”€â”€â”€â”€ llmResponse â”€â”€â”€â”€â”€â”<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚<br>                                          â”œâ”€â”€â–¶ Flux<span class="hljs-selector-class">.merge</span>() â”€â”€â–¶ å‰ç«¯<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚<br>â”‚   æœ¬åœ° Sinks    â”‚                       â”‚<br>â”‚  (ç³»ç»Ÿé€šçŸ¥)      â”‚â”€â”€â”€â”€ notifications â”€â”€â”€â”˜<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>       â†‘<br>  <span class="hljs-built_in">sendNotification</span>(&quot;æ¶ˆæ¯&quot;)<br></code></pre></td></tr></table></figure><hr><h2 id="å››ã€ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹"><a href="#å››ã€ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹" class="headerlink" title="å››ã€ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹"></a>å››ã€ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹</h2><h3 id="1-èƒŒå‹å¤„ç†"><a href="#1-èƒŒå‹å¤„ç†" class="headerlink" title="1. èƒŒå‹å¤„ç†"></a>1. èƒŒå‹å¤„ç†</h3><p><strong>é—®é¢˜</strong>ï¼šä¸Šæ¸¸äº§ç”Ÿæ•°æ®å¤ªå¿«ï¼Œä¸‹æ¸¸å¤„ç†ä¸è¿‡æ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// [é”™è¯¯] å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º</span><br>Flux.interval(Duration.ofMillis(<span class="hljs-number">1</span>))  <span class="hljs-comment">// æ¯æ¯«ç§’ä¸€ä¸ª</span><br>    .subscribe(data -&gt; &#123;<br>        Thread.sleep(<span class="hljs-number">100</span>);  <span class="hljs-comment">// å¤„ç†å¾ˆæ…¢</span><br>    &#125;);<br><br><span class="hljs-comment">// [æ­£ç¡®] æ·»åŠ èƒŒå‹ç­–ç•¥</span><br>Flux.interval(Duration.ofMillis(<span class="hljs-number">1</span>))<br>    .onBackpressureDrop(dropped -&gt; log.warn(<span class="hljs-string">&quot;ä¸¢å¼ƒ: &#123;&#125;&quot;</span>, dropped))<br>    .subscribe(data -&gt; &#123;<br>        Thread.sleep(<span class="hljs-number">100</span>);<br>    &#125;);<br></code></pre></td></tr></table></figure><p><strong>èƒŒå‹ç­–ç•¥é€‰æ‹©</strong>ï¼š</p><table><thead><tr><th>ç­–ç•¥</th><th>è¯´æ˜</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>onBackpressureBuffer()</code></td><td>ç¼“å†²</td><td>æ•°æ®ä¸èƒ½ä¸¢ï¼Œå†…å­˜å¤Ÿç”¨</td></tr><tr><td><code>onBackpressureBuffer(100)</code></td><td>æœ‰é™ç¼“å†²</td><td>æ§åˆ¶å†…å­˜ä½¿ç”¨</td></tr><tr><td><code>onBackpressureDrop()</code></td><td>ä¸¢å¼ƒ</td><td>å®æ—¶æ•°æ®ï¼Œå¯ä»¥ä¸¢</td></tr><tr><td><code>onBackpressureLatest()</code></td><td>åªä¿ç•™æœ€æ–°</td><td>çŠ¶æ€æ›´æ–°</td></tr><tr><td><code>onBackpressureError()</code></td><td>æŠ›å¼‚å¸¸</td><td>ä¸å…è®¸èƒŒå‹</td></tr></tbody></table><h3 id="2-é”™è¯¯å¤„ç†"><a href="#2-é”™è¯¯å¤„ç†" class="headerlink" title="2. é”™è¯¯å¤„ç†"></a>2. é”™è¯¯å¤„ç†</h3><p><strong>é—®é¢˜</strong>ï¼šä¸€ä¸ªæµå‡ºé”™ä¼šå¯¼è‡´æ•´ä¸ªåˆå¹¶æµç»ˆæ­¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// [é”™è¯¯] llmResponse å‡ºé”™ä¼šå¯¼è‡´æ•´ä¸ªæµç»ˆæ­¢</span><br>Flux.merge(llmResponse, notifications);<br><br><span class="hljs-comment">// [æ­£ç¡®] å•ç‹¬å¤„ç†æ¯ä¸ªæµçš„é”™è¯¯</span><br>Flux&lt;String&gt; safeLlmResponse = llmResponse<br>    .onErrorResume(e -&gt; &#123;<br>        log.error(<span class="hljs-string">&quot;å¤§æ¨¡å‹è°ƒç”¨å¤±è´¥&quot;</span>, e);<br>        <span class="hljs-keyword">return</span> Flux.just(<span class="hljs-string">&quot;[é”™è¯¯] å¤§æ¨¡å‹æš‚æ—¶ä¸å¯ç”¨&quot;</span>);<br>    &#125;);<br><br>Flux.merge(safeLlmResponse, notifications);<br></code></pre></td></tr></table></figure><p><strong>é”™è¯¯å¤„ç†ç­–ç•¥</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¿”å›é»˜è®¤å€¼</span><br>.onErrorReturn(<span class="hljs-string">&quot;é»˜è®¤å€¼&quot;</span>)<br><br><span class="hljs-comment">// åˆ‡æ¢åˆ°å¤‡ç”¨æµ</span><br>.onErrorResume(e -&gt; backupFlux)<br><br><span class="hljs-comment">// é‡è¯•</span><br>.retry(<span class="hljs-number">3</span>)<br>.retryWhen(Retry.backoff(<span class="hljs-number">3</span>, Duration.ofSeconds(<span class="hljs-number">1</span>)))<br><br><span class="hljs-comment">// è®°å½•é”™è¯¯ä½†ç»§ç»­</span><br>.onErrorContinue((e, data) -&gt; log.error(<span class="hljs-string">&quot;å¤„ç†å¤±è´¥: &#123;&#125;&quot;</span>, data, e))<br></code></pre></td></tr></table></figure><h3 id="3-è¶…æ—¶å¤„ç†"><a href="#3-è¶…æ—¶å¤„ç†" class="headerlink" title="3. è¶…æ—¶å¤„ç†"></a>3. è¶…æ—¶å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// [é”™è¯¯] å¤–éƒ¨ API å¯èƒ½æ°¸è¿œä¸è¿”å›</span><br>Flux&lt;String&gt; response = webClient.get().retrieve().bodyToFlux(String.class);<br><br><span class="hljs-comment">// [æ­£ç¡®] è®¾ç½®è¶…æ—¶</span><br>Flux&lt;String&gt; response = webClient.get()<br>    .retrieve()<br>    .bodyToFlux(String.class)<br>    .timeout(Duration.ofSeconds(<span class="hljs-number">30</span>))<br>    .onErrorResume(TimeoutException.class, e -&gt; <br>        Flux.just(<span class="hljs-string">&quot;[è¶…æ—¶] è¯·æ±‚è¶…æ—¶ï¼Œè¯·é‡è¯•&quot;</span>));<br></code></pre></td></tr></table></figure><h3 id="4-èµ„æºæ¸…ç†"><a href="#4-èµ„æºæ¸…ç†" class="headerlink" title="4. èµ„æºæ¸…ç†"></a>4. èµ„æºæ¸…ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// [é”™è¯¯] Sinks æ²¡æœ‰æ­£ç¡®å…³é—­</span><br>Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br><span class="hljs-comment">// åº”ç”¨å…³é—­æ—¶ï¼Œsink è¿˜åœ¨è¿è¡Œ</span><br><br><span class="hljs-comment">// [æ­£ç¡®] åœ¨é€‚å½“æ—¶æœºå…³é—­</span><br><span class="hljs-meta">@PreDestroy</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanup</span><span class="hljs-params">()</span> &#123;<br>    sink.tryEmitComplete();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-çº¿ç¨‹å®‰å…¨"><a href="#5-çº¿ç¨‹å®‰å…¨" class="headerlink" title="5. çº¿ç¨‹å®‰å…¨"></a>5. çº¿ç¨‹å®‰å…¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Sinks é»˜è®¤æ˜¯çº¿ç¨‹å®‰å…¨çš„</span><br>Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();<br><br><span class="hljs-comment">// å¦‚æœç¡®å®šå•çº¿ç¨‹ï¼Œå¯ä»¥ç”¨ unsafe ç‰ˆæœ¬æå‡æ€§èƒ½</span><br>Sinks.Many&lt;String&gt; unsafeSink = Sinks.unsafe().many().multicast().onBackpressureBuffer();<br><span class="hljs-comment">// [æ³¨æ„] å¤šçº¿ç¨‹ä¸‹ä½¿ç”¨ unsafe ä¼šå‡ºé—®é¢˜ï¼</span><br></code></pre></td></tr></table></figure><h3 id="6-é¿å…é˜»å¡"><a href="#6-é¿å…é˜»å¡" class="headerlink" title="6. é¿å…é˜»å¡"></a>6. é¿å…é˜»å¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// [é”™è¯¯] åœ¨å“åº”å¼æµä¸­é˜»å¡</span><br>flux.map(data -&gt; &#123;<br>    Thread.sleep(<span class="hljs-number">1000</span>);  <span class="hljs-comment">// é˜»å¡ï¼</span><br>    <span class="hljs-keyword">return</span> process(data);<br>&#125;);<br><br><span class="hljs-comment">// [æ­£ç¡®] ä½¿ç”¨ boundedElastic è°ƒåº¦å™¨å¤„ç†é˜»å¡æ“ä½œ</span><br>flux.flatMap(data -&gt; <br>    Mono.fromCallable(() -&gt; blockingProcess(data))<br>        .subscribeOn(Schedulers.boundedElastic())<br>);<br></code></pre></td></tr></table></figure><hr><h2 id="äº”ã€æœ€ä½³å®è·µ"><a href="#äº”ã€æœ€ä½³å®è·µ" class="headerlink" title="äº”ã€æœ€ä½³å®è·µ"></a>äº”ã€æœ€ä½³å®è·µ</h2><h3 id="1-æ“ä½œç¬¦é“¾è®¾è®¡"><a href="#1-æ“ä½œç¬¦é“¾è®¾è®¡" class="headerlink" title="1. æ“ä½œç¬¦é“¾è®¾è®¡"></a>1. æ“ä½œç¬¦é“¾è®¾è®¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// [æ¨è] æ¸…æ™°çš„æ“ä½œç¬¦é“¾</span><br><span class="hljs-keyword">return</span> webClient.get()<br>    .uri(<span class="hljs-string">&quot;/api/users&quot;</span>)<br>    .retrieve()<br>    .bodyToFlux(User.class)<br>    .filter(user -&gt; user.isActive())           <span class="hljs-comment">// 1. å…ˆè¿‡æ»¤</span><br>    .map(user -&gt; user.getName())               <span class="hljs-comment">// 2. å†è½¬æ¢</span><br>    .distinct()                                 <span class="hljs-comment">// 3. å»é‡</span><br>    .take(<span class="hljs-number">10</span>)                                   <span class="hljs-comment">// 4. é™åˆ¶æ•°é‡</span><br>    .timeout(Duration.ofSeconds(<span class="hljs-number">5</span>))            <span class="hljs-comment">// 5. è¶…æ—¶æ§åˆ¶</span><br>    .onErrorResume(e -&gt; Flux.empty())          <span class="hljs-comment">// 6. é”™è¯¯å¤„ç†</span><br>    .doOnNext(name -&gt; log.debug(<span class="hljs-string">&quot;å¤„ç†: &#123;&#125;&quot;</span>, name))  <span class="hljs-comment">// 7. æ—¥å¿—</span><br>    .subscribeOn(Schedulers.boundedElastic()); <span class="hljs-comment">// 8. è°ƒåº¦å™¨</span><br></code></pre></td></tr></table></figure><h3 id="2-Sinks-ä½¿ç”¨è§„èŒƒ"><a href="#2-Sinks-ä½¿ç”¨è§„èŒƒ" class="headerlink" title="2. Sinks ä½¿ç”¨è§„èŒƒ"></a>2. Sinks ä½¿ç”¨è§„èŒƒ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventBus</span> &#123;<br>    <br>    <span class="hljs-comment">// [æ¨è] ä½¿ç”¨ multicast + onBackpressureBuffer</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sinks.Many&lt;Event&gt; eventSink = <br>        Sinks.many().multicast().onBackpressureBuffer();<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publish</span><span class="hljs-params">(Event event)</span> &#123;<br>        <span class="hljs-comment">// [æ¨è] æ£€æŸ¥å‘é€ç»“æœ</span><br>        Sinks.<span class="hljs-type">EmitResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> eventSink.tryEmitNext(event);<br>        <span class="hljs-keyword">if</span> (result.isFailure()) &#123;<br>            log.warn(<span class="hljs-string">&quot;äº‹ä»¶å‘é€å¤±è´¥: &#123;&#125;, åŸå› : &#123;&#125;&quot;</span>, event, result);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Flux&lt;Event&gt; <span class="hljs-title function_">subscribe</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> eventSink.asFlux();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-åˆå¹¶æµçš„é”™è¯¯éš”ç¦»"><a href="#3-åˆå¹¶æµçš„é”™è¯¯éš”ç¦»" class="headerlink" title="3. åˆå¹¶æµçš„é”™è¯¯éš”ç¦»"></a>3. åˆå¹¶æµçš„é”™è¯¯éš”ç¦»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// [æ¨è] æ¯ä¸ªæµç‹¬ç«‹å¤„ç†é”™è¯¯</span><br><span class="hljs-keyword">public</span> Flux&lt;Message&gt; <span class="hljs-title function_">getMergedStream</span><span class="hljs-params">()</span> &#123;<br>    Flux&lt;Message&gt; stream1 = getStream1()<br>        .onErrorResume(e -&gt; &#123;<br>            log.error(<span class="hljs-string">&quot;stream1 é”™è¯¯&quot;</span>, e);<br>            <span class="hljs-keyword">return</span> Flux.empty();<br>        &#125;);<br>    <br>    Flux&lt;Message&gt; stream2 = getStream2()<br>        .onErrorResume(e -&gt; &#123;<br>            log.error(<span class="hljs-string">&quot;stream2 é”™è¯¯&quot;</span>, e);<br>            <span class="hljs-keyword">return</span> Flux.empty();<br>        &#125;);<br>    <br>    <span class="hljs-keyword">return</span> Flux.merge(stream1, stream2);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-æ—¥å¿—ä¸ç›‘æ§"><a href="#4-æ—¥å¿—ä¸ç›‘æ§" class="headerlink" title="4. æ—¥å¿—ä¸ç›‘æ§"></a>4. æ—¥å¿—ä¸ç›‘æ§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">flux<br>    .doOnSubscribe(s -&gt; log.info(<span class="hljs-string">&quot;å¼€å§‹è®¢é˜…&quot;</span>))<br>    .doOnNext(data -&gt; log.debug(<span class="hljs-string">&quot;å¤„ç†æ•°æ®: &#123;&#125;&quot;</span>, data))<br>    .doOnError(e -&gt; log.error(<span class="hljs-string">&quot;å‘ç”Ÿé”™è¯¯&quot;</span>, e))<br>    .doOnComplete(() -&gt; log.info(<span class="hljs-string">&quot;å¤„ç†å®Œæˆ&quot;</span>))<br>    .doOnCancel(() -&gt; log.warn(<span class="hljs-string">&quot;è®¢é˜…è¢«å–æ¶ˆ&quot;</span>))<br>    .doFinally(signal -&gt; &#123;<br>        <span class="hljs-comment">// è®°å½•æŒ‡æ ‡</span><br>        metrics.recordStreamEnd(signal);<br>    &#125;);<br></code></pre></td></tr></table></figure><h3 id="5-æµ‹è¯•"><a href="#5-æµ‹è¯•" class="headerlink" title="5. æµ‹è¯•"></a>5. æµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testMergedStream</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ StepVerifier æµ‹è¯•</span><br>    Flux&lt;String&gt; merged = Flux.merge(<br>        Flux.just(<span class="hljs-string">&quot;A&quot;</span>),<br>        Flux.just(<span class="hljs-string">&quot;B&quot;</span>)<br>    );<br>    <br>    StepVerifier.create(merged)<br>        .expectNextCount(<span class="hljs-number">2</span>)<br>        .verifyComplete();<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testWithVirtualTime</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// æµ‹è¯•æ—¶é—´ç›¸å…³çš„æµ</span><br>    StepVerifier.withVirtualTime(() -&gt; <br>        Flux.interval(Duration.ofSeconds(<span class="hljs-number">1</span>)).take(<span class="hljs-number">3</span>)<br>    )<br>    .thenAwait(Duration.ofSeconds(<span class="hljs-number">3</span>))<br>    .expectNext(<span class="hljs-number">0L</span>, <span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>)<br>    .verifyComplete();<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="å…­ã€å¸¸è§é—®é¢˜"><a href="#å…­ã€å¸¸è§é—®é¢˜" class="headerlink" title="å…­ã€å¸¸è§é—®é¢˜"></a>å…­ã€å¸¸è§é—®é¢˜</h2><h3 id="Q1-merge-å’Œ-concat-æ€ä¹ˆé€‰ï¼Ÿ"><a href="#Q1-merge-å’Œ-concat-æ€ä¹ˆé€‰ï¼Ÿ" class="headerlink" title="Q1: merge å’Œ concat æ€ä¹ˆé€‰ï¼Ÿ"></a>Q1: merge å’Œ concat æ€ä¹ˆé€‰ï¼Ÿ</h3><ul><li><strong>merge</strong>ï¼šéœ€è¦å®æ—¶æ··åˆï¼Œä¸å…³å¿ƒé¡ºåº</li><li><strong>concat</strong>ï¼šéœ€è¦ä¿è¯é¡ºåºï¼Œä¸€ä¸ªå®Œæˆå†å¤„ç†ä¸‹ä¸€ä¸ª</li></ul><h3 id="Q2-ä¸ºä»€ä¹ˆæˆ‘çš„-Sinks-å‘é€çš„æ•°æ®æ²¡äººæ”¶åˆ°ï¼Ÿ"><a href="#Q2-ä¸ºä»€ä¹ˆæˆ‘çš„-Sinks-å‘é€çš„æ•°æ®æ²¡äººæ”¶åˆ°ï¼Ÿ" class="headerlink" title="Q2: ä¸ºä»€ä¹ˆæˆ‘çš„ Sinks å‘é€çš„æ•°æ®æ²¡äººæ”¶åˆ°ï¼Ÿ"></a>Q2: ä¸ºä»€ä¹ˆæˆ‘çš„ Sinks å‘é€çš„æ•°æ®æ²¡äººæ”¶åˆ°ï¼Ÿ</h3><p>æ£€æŸ¥ï¼š</p><ol><li>æ˜¯å¦æœ‰è®¢é˜…è€…ï¼Ÿï¼ˆmulticast æ¨¡å¼ä¸‹ï¼Œæ²¡è®¢é˜…è€…æ•°æ®ä¼šä¸¢å¤±ï¼‰</li><li>æ˜¯å¦åœ¨è®¢é˜…ä¹‹å‰å°±å‘é€äº†ï¼Ÿï¼ˆçƒ­æµç‰¹æ€§ï¼‰</li><li>è€ƒè™‘ä½¿ç”¨ <code>replay()</code> æ¨¡å¼</li></ol><h3 id="Q3-æµåˆå¹¶åï¼Œä¸€ä¸ªå‡ºé”™æ•´ä¸ªéƒ½åœäº†ï¼Ÿ"><a href="#Q3-æµåˆå¹¶åï¼Œä¸€ä¸ªå‡ºé”™æ•´ä¸ªéƒ½åœäº†ï¼Ÿ" class="headerlink" title="Q3: æµåˆå¹¶åï¼Œä¸€ä¸ªå‡ºé”™æ•´ä¸ªéƒ½åœäº†ï¼Ÿ"></a>Q3: æµåˆå¹¶åï¼Œä¸€ä¸ªå‡ºé”™æ•´ä¸ªéƒ½åœäº†ï¼Ÿ</h3><p>æ¯ä¸ªæµå•ç‹¬æ·»åŠ é”™è¯¯å¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.merge(<br>    stream1.onErrorResume(e -&gt; Flux.empty()),<br>    stream2.onErrorResume(e -&gt; Flux.empty())<br>);<br></code></pre></td></tr></table></figure><h3 id="Q4-å†…å­˜ä¸€ç›´æ¶¨ï¼Ÿ"><a href="#Q4-å†…å­˜ä¸€ç›´æ¶¨ï¼Ÿ" class="headerlink" title="Q4: å†…å­˜ä¸€ç›´æ¶¨ï¼Ÿ"></a>Q4: å†…å­˜ä¸€ç›´æ¶¨ï¼Ÿ</h3><p>æ£€æŸ¥ï¼š</p><ol><li>æ˜¯å¦æœ‰æ— é™æµæ²¡æœ‰ <code>take()</code> é™åˆ¶ï¼Ÿ</li><li>æ˜¯å¦èƒŒå‹å¤„ç†ä¸å½“ï¼Ÿæ·»åŠ  <code>onBackpressureXxx()</code></li><li>æ˜¯å¦æœ‰æµæ²¡æœ‰æ­£ç¡®å®Œæˆï¼Ÿæ£€æŸ¥ <code>tryEmitComplete()</code></li></ol><hr><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>Flux æ˜¯ç®¡é“ä¸æ˜¯å®¹å™¨</li><li>Sinks è¯¦è§£</li><li>Reactor API å‚è€ƒ</li><li>WebFlux - Reactoræ ¸å¿ƒAPI</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Reactive Streams</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>ReactiveStreams</tag>
      
      <tag>Reactor</tag>
      
      <tag>æ“ä½œç¬¦</tag>
      
      <tag>merge</tag>
      
      <tag>concat</tag>
      
      <tag>zip</tag>
      
      <tag>æœ€ä½³å®è·µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¿ç¨‹æ¨¡å‹ä¸Netty</title>
    <link href="/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%E4%B8%8ENetty/"/>
    <url>/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%E4%B8%8ENetty/</url>
    
    <content type="html"><![CDATA[<h1 id="çº¿ç¨‹æ¨¡å‹ä¸-Netty"><a href="#çº¿ç¨‹æ¨¡å‹ä¸-Netty" class="headerlink" title="çº¿ç¨‹æ¨¡å‹ä¸ Netty"></a>çº¿ç¨‹æ¨¡å‹ä¸ Netty</h1><h2 id="ä¼ ç»Ÿ-Servlet-çº¿ç¨‹æ¨¡å‹"><a href="#ä¼ ç»Ÿ-Servlet-çº¿ç¨‹æ¨¡å‹" class="headerlink" title="ä¼ ç»Ÿ Servlet çº¿ç¨‹æ¨¡å‹"></a>ä¼ ç»Ÿ Servlet çº¿ç¨‹æ¨¡å‹</h2><p>ä¼ ç»Ÿ Spring MVC åŸºäº Servlet å®¹å™¨ï¼Œé‡‡ç”¨<strong>æ¯è¯·æ±‚ä¸€çº¿ç¨‹</strong>æ¨¡å‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css">è¯·æ±‚<span class="hljs-number">1</span> â”€â”€â†’ çº¿ç¨‹<span class="hljs-number">1</span> â”€â”€â†’ <span class="hljs-selector-attr">[æ¥æ”¶è¯·æ±‚ â†’ å¤„ç†ä¸šåŠ¡ â†’ ç­‰å¾…DB â†’ è¿”å›å“åº”]</span> â”€â”€â†’ é‡Šæ”¾<br>è¯·æ±‚<span class="hljs-number">2</span> â”€â”€â†’ çº¿ç¨‹<span class="hljs-number">2</span> â”€â”€â†’ <span class="hljs-selector-attr">[æ¥æ”¶è¯·æ±‚ â†’ å¤„ç†ä¸šåŠ¡ â†’ ç­‰å¾…DB â†’ è¿”å›å“åº”]</span> â”€â”€â†’ é‡Šæ”¾<br>è¯·æ±‚<span class="hljs-number">3</span> â”€â”€â†’ çº¿ç¨‹<span class="hljs-number">3</span> â”€â”€â†’ <span class="hljs-selector-attr">[æ¥æ”¶è¯·æ±‚ â†’ å¤„ç†ä¸šåŠ¡ â†’ ç­‰å¾…DB â†’ è¿”å›å“åº”]</span> â”€â”€â†’ é‡Šæ”¾<br></code></pre></td></tr></table></figure><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>ä¸€ä¸ªè¯·æ±‚<strong>ç‹¬å </strong>ä¸€ä¸ªçº¿ç¨‹ï¼Œä»å¤´åˆ°å°¾</li><li>çº¿ç¨‹åœ¨ç­‰å¾… I&#x2F;Oï¼ˆæ•°æ®åº“ã€ç½‘ç»œè°ƒç”¨ï¼‰æ—¶<strong>é˜»å¡</strong>ï¼Œä»€ä¹ˆéƒ½ä¸åš</li><li>é«˜å¹¶å‘æ—¶éœ€è¦å¤§é‡çº¿ç¨‹ï¼ˆTomcat é»˜è®¤ 200 ä¸ªï¼‰</li><li>çº¿ç¨‹åˆ‡æ¢å¼€é”€å¤§ï¼Œå†…å­˜å ç”¨é«˜ï¼ˆæ¯çº¿ç¨‹çº¦ 1MB æ ˆç©ºé—´ï¼‰</li></ul><h2 id="WebFlux-äº‹ä»¶å¾ªç¯æ¨¡å‹"><a href="#WebFlux-äº‹ä»¶å¾ªç¯æ¨¡å‹" class="headerlink" title="WebFlux äº‹ä»¶å¾ªç¯æ¨¡å‹"></a>WebFlux äº‹ä»¶å¾ªç¯æ¨¡å‹</h2><p>WebFlux åŸºäº Nettyï¼Œé‡‡ç”¨<strong>äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰</strong> æ¨¡å‹ï¼š</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mathematica">                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                 â”‚         <span class="hljs-variable">Event</span> <span class="hljs-variable">Loop</span> çº¿ç¨‹æ±            â”‚<br>                 â”‚     <span class="hljs-punctuation">(</span>å°‘é‡çº¿ç¨‹ï¼Œå¦‚ <span class="hljs-variable">CPU</span> æ ¸å¿ƒæ•°<span class="hljs-punctuation">)</span>        â”‚<br>                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                                 â”‚<br>     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>     â†“                           â†“                           â†“<br>æ¥æ”¶è¯·æ±‚<span class="hljs-number">1</span>                    æ¥æ”¶è¯·æ±‚<span class="hljs-number">2</span>                    æ¥æ”¶è¯·æ±‚<span class="hljs-number">3</span><br>     â”‚                           â”‚                           â”‚<br>     â†“                           â†“                           â†“<br>æäº¤<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>ä»»åŠ¡                 æäº¤<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>ä»»åŠ¡                 æäº¤<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>ä»»åŠ¡<br><span class="hljs-punctuation">(</span>éé˜»å¡è¿”å›<span class="hljs-punctuation">)</span>                <span class="hljs-punctuation">(</span>éé˜»å¡è¿”å›<span class="hljs-punctuation">)</span>                <span class="hljs-punctuation">(</span>éé˜»å¡è¿”å›<span class="hljs-punctuation">)</span><br>     â”‚                           â”‚                           â”‚<br>     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                                 â†“<br>                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                 â”‚      <span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span> å®Œæˆåè§¦å‘å›è°ƒ              â”‚<br>                 â”‚      <span class="hljs-variable">Event</span> <span class="hljs-variable">Loop</span> ç»§ç»­å¤„ç†            â”‚<br>                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h3><ul><li>çº¿ç¨‹<strong>ä¸ç­‰å¾…</strong> I&#x2F;O å®Œæˆï¼Œç«‹å³å»å¤„ç†å…¶ä»–è¯·æ±‚</li><li>I&#x2F;O å®Œæˆåé€šè¿‡<strong>å›è°ƒ&#x2F;äº‹ä»¶</strong>é€šçŸ¥</li><li>å°‘é‡çº¿ç¨‹å°±èƒ½å¤„ç†å¤§é‡å¹¶å‘è¿æ¥</li></ul><h2 id="WebFlux-ä¸­çš„çº¿ç¨‹æ± "><a href="#WebFlux-ä¸­çš„çº¿ç¨‹æ± " class="headerlink" title="WebFlux ä¸­çš„çº¿ç¨‹æ± "></a>WebFlux ä¸­çš„çº¿ç¨‹æ± </h2><p>WebFlux ä½¿ç”¨å¤šä¸ªçº¿ç¨‹æ± ï¼Œå„å¸å…¶èŒï¼š</p><h3 id="1-Event-Loop-çº¿ç¨‹æ± "><a href="#1-Event-Loop-çº¿ç¨‹æ± " class="headerlink" title="1. Event Loop çº¿ç¨‹æ± "></a>1. Event Loop çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Netty çš„ NioEventLoopGroup</span><br><span class="hljs-comment">// çº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•°</span><br></code></pre></td></tr></table></figure><ul><li>å¤„ç†è¿æ¥å»ºç«‹ã€è¯»å†™äº‹ä»¶</li><li><strong>ç»å¯¹ä¸èƒ½é˜»å¡</strong>ï¼Œå¦åˆ™å½±å“æ‰€æœ‰è¯·æ±‚</li></ul><h3 id="2-boundedElastic-çº¿ç¨‹æ± "><a href="#2-boundedElastic-çº¿ç¨‹æ± " class="headerlink" title="2. boundedElastic çº¿ç¨‹æ± "></a>2. boundedElastic çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Mono.fromCallable(() -&gt; blockingCall())<br>    .subscribeOn(Schedulers.boundedElastic())<br></code></pre></td></tr></table></figure><ul><li>å¤„ç†<strong>å¿…é¡»é˜»å¡</strong>çš„æ“ä½œï¼ˆå¦‚è°ƒç”¨é˜»å¡ APIï¼‰</li><li>å¼¹æ€§ä¼¸ç¼©ï¼Œæœ‰ä¸Šé™ä¿æŠ¤</li><li>é€‚åˆ I&#x2F;O å¯†é›†å‹é˜»å¡æ“ä½œ</li></ul><h3 id="3-parallel-çº¿ç¨‹æ± "><a href="#3-parallel-çº¿ç¨‹æ± " class="headerlink" title="3. parallel çº¿ç¨‹æ± "></a>3. parallel çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>)<br>    .parallel()<br>    .runOn(Schedulers.parallel())<br></code></pre></td></tr></table></figure><ul><li>çº¿ç¨‹æ•° &#x3D; CPU æ ¸å¿ƒæ•°</li><li>é€‚åˆ <strong>CPU å¯†é›†å‹</strong>ä»»åŠ¡</li></ul><h2 id="çº¿ç¨‹æ¨¡å‹å¯¹æ¯”"><a href="#çº¿ç¨‹æ¨¡å‹å¯¹æ¯”" class="headerlink" title="çº¿ç¨‹æ¨¡å‹å¯¹æ¯”"></a>çº¿ç¨‹æ¨¡å‹å¯¹æ¯”</h2><table><thead><tr><th>æ–¹é¢</th><th>ä¼ ç»Ÿ MVC</th><th>WebFlux</th></tr></thead><tbody><tr><td>çº¿ç¨‹æ•°é‡</td><td>å¤§é‡ï¼ˆé»˜è®¤ 200+ï¼‰</td><td>å°‘é‡ï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰</td></tr><tr><td>ç­‰å¾… I&#x2F;O æ—¶</td><td>çº¿ç¨‹é˜»å¡ç­‰å¾…</td><td>çº¿ç¨‹å»å¤„ç†å…¶ä»–è¯·æ±‚</td></tr><tr><td>çº¿ç¨‹åˆ©ç”¨ç‡</td><td>ä½ï¼ˆå¤§é‡æ—¶é—´åœ¨ç­‰å¾…ï¼‰</td><td>é«˜ï¼ˆå‡ ä¹ä¸ç­‰å¾…ï¼‰</td></tr><tr><td>å†…å­˜å ç”¨</td><td>é«˜ï¼ˆæ¯çº¿ç¨‹ ~1MBï¼‰</td><td>ä½</td></tr><tr><td>ä¸Šä¸‹æ–‡åˆ‡æ¢</td><td>é¢‘ç¹</td><td>å¾ˆå°‘</td></tr><tr><td>ç¼–ç¨‹æ¨¡å‹</td><td>åŒæ­¥é˜»å¡</td><td>å¼‚æ­¥éé˜»å¡</td></tr></tbody></table><h2 id="WebFlux-ä¸-Netty-çš„å…³ç³»"><a href="#WebFlux-ä¸-Netty-çš„å…³ç³»" class="headerlink" title="WebFlux ä¸ Netty çš„å…³ç³»"></a>WebFlux ä¸ Netty çš„å…³ç³»</h2><h3 id="Netty-æ˜¯ä»€ä¹ˆ"><a href="#Netty-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Netty æ˜¯ä»€ä¹ˆ"></a>Netty æ˜¯ä»€ä¹ˆ</h3><p>Netty æ˜¯ä¸€ä¸ª<strong>é«˜æ€§èƒ½ç½‘ç»œé€šä¿¡æ¡†æ¶</strong>ï¼Œæä¾›ï¼š</p><ul><li>éé˜»å¡ I&#x2F;Oï¼ˆNIOï¼‰</li><li>äº‹ä»¶é©±åŠ¨æ¨¡å‹</li><li>é«˜æ•ˆçš„å†…å­˜ç®¡ç†</li><li>åè®®ç¼–è§£ç æ”¯æŒ</li></ul><h3 id="ç›´æ¥ç”¨-Netty"><a href="#ç›´æ¥ç”¨-Netty" class="headerlink" title="ç›´æ¥ç”¨ Netty"></a>ç›´æ¥ç”¨ Netty</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Netty åŸç”Ÿä»£ç  - å¤„ç†ä¸€ä¸ªç®€å•çš„ HTTP è¯·æ±‚</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ChannelInboundHandlerAdapter</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> &#123;<br>        <span class="hljs-keyword">if</span> (msg <span class="hljs-keyword">instanceof</span> HttpRequest) &#123;<br>            <span class="hljs-type">HttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> (HttpRequest) msg;<br>            <br>            <span class="hljs-comment">// æ‰‹åŠ¨è§£æè·¯å¾„</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> request.uri();<br>            <br>            <span class="hljs-comment">// æ‰‹åŠ¨æ„å»ºå“åº”</span><br>            <span class="hljs-type">FullHttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultFullHttpResponse</span>(<br>                HttpVersion.HTTP_1_1, <br>                HttpResponseStatus.OK,<br>                Unpooled.copiedBuffer(<span class="hljs-string">&quot;Hello&quot;</span>, CharsetUtil.UTF_8)<br>            );<br>            response.headers().set(HttpHeaderNames.CONTENT_TYPE, <span class="hljs-string">&quot;text/plain&quot;</span>);<br>            response.headers().set(HttpHeaderNames.CONTENT_LENGTH, <br>                response.content().readableBytes());<br>            <br>            ctx.writeAndFlush(response);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>éœ€è¦è‡ªå·±å¤„ç†ï¼šè·¯ç”±ã€å‚æ•°è§£æã€JSON åºåˆ—åŒ–ã€å¼‚å¸¸å¤„ç†ã€è¿æ¥ç®¡ç†â€¦</p><h3 id="ç”¨-WebFlux"><a href="#ç”¨-WebFlux" class="headerlink" title="ç”¨ WebFlux"></a>ç”¨ WebFlux</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloController</span> &#123;<br>    <br>    <span class="hljs-meta">@GetMapping(&quot;/hello/&#123;name&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">hello</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String name)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.findByName(name);  <span class="hljs-comment">// è‡ªåŠ¨ JSON åºåˆ—åŒ–</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="WebFlux-åœ¨-Netty-ä¹‹ä¸Šæä¾›äº†ä»€ä¹ˆ"><a href="#WebFlux-åœ¨-Netty-ä¹‹ä¸Šæä¾›äº†ä»€ä¹ˆ" class="headerlink" title="WebFlux åœ¨ Netty ä¹‹ä¸Šæä¾›äº†ä»€ä¹ˆ"></a>WebFlux åœ¨ Netty ä¹‹ä¸Šæä¾›äº†ä»€ä¹ˆ</h3><table><thead><tr><th>åŠŸèƒ½</th><th>Netty</th><th>WebFlux</th></tr></thead><tbody><tr><td>è·¯ç”±</td><td>æ‰‹åŠ¨è§£æ URI</td><td><code>@GetMapping</code>ã€<code>RouterFunction</code></td></tr><tr><td>å‚æ•°ç»‘å®š</td><td>æ‰‹åŠ¨è§£æ</td><td><code>@PathVariable</code>ã€<code>@RequestBody</code></td></tr><tr><td>JSON åºåˆ—åŒ–</td><td>æ‰‹åŠ¨å¤„ç†</td><td>è‡ªåŠ¨ï¼ˆJacksonï¼‰</td></tr><tr><td>å¼‚å¸¸å¤„ç†</td><td>æ‰‹åŠ¨ try-catch</td><td><code>@ExceptionHandler</code></td></tr><tr><td>ä¾èµ–æ³¨å…¥</td><td>æ— </td><td>Spring IoC</td></tr><tr><td>é…ç½®ç®¡ç†</td><td>æ— </td><td><code>application.yml</code></td></tr><tr><td>å®‰å…¨è®¤è¯</td><td>æ‰‹åŠ¨å®ç°</td><td>Spring Security</td></tr><tr><td>æ•°æ®è®¿é—®</td><td>æ‰‹åŠ¨å®ç°</td><td>Spring Data R2DBC</td></tr><tr><td>æµ‹è¯•æ”¯æŒ</td><td>æ‰‹åŠ¨</td><td><code>WebTestClient</code></td></tr></tbody></table><h3 id="ç±»æ¯”ç†è§£"><a href="#ç±»æ¯”ç†è§£" class="headerlink" title="ç±»æ¯”ç†è§£"></a>ç±»æ¯”ç†è§£</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">Netty</span>      â‰ˆ  TCP/HTTP åè®®å¼•æ“ï¼ˆåº•å±‚ï¼‰<br>WebFlux    â‰ˆ  Web å¼€å‘æ¡†æ¶ï¼ˆä¸Šå±‚ï¼‰<br><br>å°±åƒï¼š<br>JDBC       â‰ˆ  æ•°æ®åº“è¿æ¥ï¼ˆåº•å±‚ï¼‰<br>MyBatis    â‰ˆ  ORM æ¡†æ¶ï¼ˆä¸Šå±‚ï¼‰<br></code></pre></td></tr></table></figure><p><strong>Netty æ˜¯å¼•æ“ï¼ŒWebFlux æ˜¯æ±½è½¦ã€‚</strong> ä½ å¯ä»¥ç›´æ¥ç”¨å¼•æ“ï¼Œä½†å¤§å¤šæ•°äººæ›´æ„¿æ„å¼€æ±½è½¦ã€‚</p><h2 id="ä»€ä¹ˆæ—¶å€™ç›´æ¥ç”¨-Netty"><a href="#ä»€ä¹ˆæ—¶å€™ç›´æ¥ç”¨-Netty" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ç›´æ¥ç”¨ Netty"></a>ä»€ä¹ˆæ—¶å€™ç›´æ¥ç”¨ Netty</h2><ul><li>è‡ªå®šä¹‰åè®®ï¼ˆé HTTPï¼‰</li><li>æè‡´æ€§èƒ½ä¼˜åŒ–</li><li>ä¸éœ€è¦ Spring ç”Ÿæ€</li><li>æ„å»ºåŸºç¡€è®¾æ–½ï¼ˆå¦‚ç½‘å…³ã€ä»£ç†æœåŠ¡å™¨ï¼‰</li></ul><h2 id="ä¸ºä»€ä¹ˆ-WebFlux-é€‚åˆé«˜å¹¶å‘"><a href="#ä¸ºä»€ä¹ˆ-WebFlux-é€‚åˆé«˜å¹¶å‘" class="headerlink" title="ä¸ºä»€ä¹ˆ WebFlux é€‚åˆé«˜å¹¶å‘"></a>ä¸ºä»€ä¹ˆ WebFlux é€‚åˆé«˜å¹¶å‘</h2><ol><li><strong>å°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡è¿æ¥</strong>ï¼šä¸éœ€è¦ä¸ºæ¯ä¸ªè¿æ¥åˆ†é…çº¿ç¨‹</li><li><strong>çº¿ç¨‹ä¸é˜»å¡</strong>ï¼šI&#x2F;O ç­‰å¾…æ—¶å»å¤„ç†å…¶ä»–è¯·æ±‚</li><li><strong>å†…å­˜æ•ˆç‡é«˜</strong>ï¼šçº¿ç¨‹å°‘ï¼Œå†…å­˜å ç”¨ä½</li><li><strong>æ— çº¿ç¨‹åˆ‡æ¢å¼€é”€</strong>ï¼šäº‹ä»¶é©±åŠ¨ï¼Œä¸éœ€è¦é¢‘ç¹åˆ‡æ¢</li></ol><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>Webfluxç®€ä»‹</li><li>å“åº”å¼ç¼–ç¨‹åŸºç¡€</li><li>Reactoræ ¸å¿ƒAPI</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Webflux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>WebFlux</tag>
      
      <tag>Netty</tag>
      
      <tag>çº¿ç¨‹æ¨¡å‹</tag>
      
      <tag>EventLoop</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æºç è§£æ</title>
    <link href="/2026/01/10/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <url>/2026/01/10/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h1><h2 id="Mono-just-æºç åˆ†æ"><a href="#Mono-just-æºç åˆ†æ" class="headerlink" title="Mono.just() æºç åˆ†æ"></a>Mono.just() æºç åˆ†æ</h2><p>ä»æœ€ç®€å•çš„ <code>Mono.just()</code> å¼€å§‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Mono.just(<span class="hljs-string">&quot;Hello&quot;</span>)<br>    .subscribe(System.out::println);<br></code></pre></td></tr></table></figure><h3 id="1-åˆ›å»º-Mono"><a href="#1-åˆ›å»º-Mono" class="headerlink" title="1. åˆ›å»º Mono"></a>1. åˆ›å»º Mono</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Mono.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Mono&lt;T&gt; <span class="hljs-title function_">just</span><span class="hljs-params">(T data)</span> &#123;<br>    <span class="hljs-keyword">return</span> onAssembly(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MonoJust</span>&lt;&gt;(data));<br>&#125;<br><br><span class="hljs-comment">// MonoJust.java - æŒæœ‰æ•°æ®çš„ Mono</span><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonoJust</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Mono</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">final</span> T value;<br>    <br>    MonoJust(T value) &#123;<br>        <span class="hljs-built_in">this</span>.value = Objects.requireNonNull(value);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-è®¢é˜…æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ"><a href="#2-è®¢é˜…æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ" class="headerlink" title="2. è®¢é˜…æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ"></a>2. è®¢é˜…æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Mono.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">(Consumer&lt;? <span class="hljs-built_in">super</span> T&gt; consumer)</span> &#123;<br>    <span class="hljs-comment">// åˆ›å»º LambdaMonoSubscriber åŒ…è£… consumer</span><br>    subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaMonoSubscriber</span>&lt;&gt;(consumer, ...));<br>&#125;<br><br><span class="hljs-comment">// MonoJust.java</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">(CoreSubscriber&lt;? <span class="hljs-built_in">super</span> T&gt; actual)</span> &#123;<br>    <span class="hljs-comment">// ç›´æ¥è°ƒç”¨ onSubscribe å’Œ onNext</span><br>    actual.onSubscribe(Operators.scalarSubscription(actual, value));<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-æ•°æ®ä¼ é€’"><a href="#3-æ•°æ®ä¼ é€’" class="headerlink" title="3. æ•°æ®ä¼ é€’"></a>3. æ•°æ®ä¼ é€’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Operators.java - ScalarSubscription</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScalarSubscription</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Subscription</span> &#123;<br>    <span class="hljs-keyword">final</span> CoreSubscriber&lt;? <span class="hljs-built_in">super</span> T&gt; actual;<br>    <span class="hljs-keyword">final</span> T value;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> once;  <span class="hljs-comment">// ç¡®ä¿åªå‘é€ä¸€æ¬¡</span><br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">request</span><span class="hljs-params">(<span class="hljs-type">long</span> n)</span> &#123;<br>        <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span> &amp;&amp; ONCE.compareAndSet(<span class="hljs-built_in">this</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>            actual.onNext(value);    <span class="hljs-comment">// å‘é€æ•°æ®</span><br>            actual.onComplete();      <span class="hljs-comment">// å®Œæˆ</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æµç¨‹æ€»ç»“</strong>ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Mono<span class="hljs-selector-class">.just</span>(<span class="hljs-string">&quot;Hello&quot;</span>)<br>    â†“<br>new <span class="hljs-built_in">MonoJust</span>(<span class="hljs-string">&quot;Hello&quot;</span>)<br>    â†“<br><span class="hljs-function"><span class="hljs-title">subscribe</span><span class="hljs-params">(consumer)</span></span><br>    â†“<br><span class="hljs-function"><span class="hljs-title">onSubscribe</span><span class="hljs-params">(ScalarSubscription)</span></span><br>    â†“<br><span class="hljs-function"><span class="hljs-title">request</span><span class="hljs-params">(Long.MAX_VALUE)</span></span>  <span class="hljs-comment">// LambdaSubscriber é»˜è®¤è¯·æ±‚æ— é™</span><br>    â†“<br><span class="hljs-function"><span class="hljs-title">onNext</span><span class="hljs-params">(<span class="hljs-string">&quot;Hello&quot;</span>)</span></span><br>    â†“<br><span class="hljs-function"><span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></table></figure><h2 id="Flux-map-æºç åˆ†æ"><a href="#Flux-map-æºç åˆ†æ" class="headerlink" title="Flux.map() æºç åˆ†æ"></a>Flux.map() æºç åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>    .map(i -&gt; i * <span class="hljs-number">2</span>)<br>    .subscribe(System.out::println);<br></code></pre></td></tr></table></figure><h3 id="1-åˆ›å»º-FluxMap"><a href="#1-åˆ›å»º-FluxMap" class="headerlink" title="1. åˆ›å»º FluxMap"></a>1. åˆ›å»º FluxMap</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Flux.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> &lt;V&gt; Flux&lt;V&gt; <span class="hljs-title function_">map</span><span class="hljs-params">(Function&lt;? <span class="hljs-built_in">super</span> T, ? extends V&gt; mapper)</span> &#123;<br>    <span class="hljs-keyword">return</span> onAssembly(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FluxMap</span>&lt;&gt;(<span class="hljs-built_in">this</span>, mapper));<br>&#125;<br><br><span class="hljs-comment">// FluxMap.java</span><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FluxMap</span>&lt;T, R&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FluxOperator</span>&lt;T, R&gt; &#123;<br>    <span class="hljs-keyword">final</span> Function&lt;? <span class="hljs-built_in">super</span> T, ? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">R</span>&gt; mapper;<br>    <br>    FluxMap(Flux&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">T</span>&gt; source, Function&lt;? <span class="hljs-built_in">super</span> T, ? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">R</span>&gt; mapper) &#123;<br>        <span class="hljs-built_in">super</span>(source);<br>        <span class="hljs-built_in">this</span>.mapper = mapper;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-è®¢é˜…æ—¶çš„åŒ…è£…"><a href="#2-è®¢é˜…æ—¶çš„åŒ…è£…" class="headerlink" title="2. è®¢é˜…æ—¶çš„åŒ…è£…"></a>2. è®¢é˜…æ—¶çš„åŒ…è£…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// FluxMap.java</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">subscribe</span><span class="hljs-params">(CoreSubscriber&lt;? <span class="hljs-built_in">super</span> R&gt; actual)</span> &#123;<br>    <span class="hljs-comment">// ç”¨ MapSubscriber åŒ…è£…ä¸‹æ¸¸è®¢é˜…è€…</span><br>    source.subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapSubscriber</span>&lt;&gt;(actual, mapper));<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-æ•°æ®è½¬æ¢"><a href="#3-æ•°æ®è½¬æ¢" class="headerlink" title="3. æ•°æ®è½¬æ¢"></a>3. æ•°æ®è½¬æ¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// FluxMap.java - MapSubscriber</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapSubscriber</span>&lt;T, R&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Subscriber</span>&lt;T&gt;, Subscription &#123;<br>    <span class="hljs-keyword">final</span> CoreSubscriber&lt;? <span class="hljs-built_in">super</span> R&gt; actual;  <span class="hljs-comment">// ä¸‹æ¸¸</span><br>    <span class="hljs-keyword">final</span> Function&lt;? <span class="hljs-built_in">super</span> T, ? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">R</span>&gt; mapper;<br>    Subscription s;  <span class="hljs-comment">// ä¸Šæ¸¸çš„ Subscription</span><br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNext</span><span class="hljs-params">(T t)</span> &#123;<br>        <span class="hljs-type">R</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> mapper.apply(t);  <span class="hljs-comment">// è½¬æ¢æ•°æ®</span><br>        actual.onNext(v);        <span class="hljs-comment">// ä¼ ç»™ä¸‹æ¸¸</span><br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">request</span><span class="hljs-params">(<span class="hljs-type">long</span> n)</span> &#123;<br>        s.request(n);  <span class="hljs-comment">// èƒŒå‹ä¿¡å·å‘ä¸Šä¼ é€’</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è®¢é˜…é“¾ç»“æ„</strong>ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">FluxArray</span> <span class="hljs-selector-attr">[1,2,3]</span><br>    â†“ <span class="hljs-selector-tag">subscribe</span><br><span class="hljs-selector-tag">MapSubscriber</span> (<span class="hljs-attribute">mapper</span>: i -&gt; i*<span class="hljs-number">2</span>)<br>    â†“ <span class="hljs-selector-tag">subscribe</span>  <br><span class="hljs-selector-tag">LambdaSubscriber</span> (<span class="hljs-attribute">consumer</span>: println)<br></code></pre></td></tr></table></figure><p><strong>æ•°æ®æµå‘</strong>ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">FluxArray<span class="hljs-selector-class">.onNext</span>(<span class="hljs-number">1</span>)<br>    â†“<br>MapSubscriber<span class="hljs-selector-class">.onNext</span>(<span class="hljs-number">1</span>) â†’ mapper<span class="hljs-selector-class">.apply</span>(<span class="hljs-number">1</span>) = <span class="hljs-number">2</span><br>    â†“<br>LambdaSubscriber<span class="hljs-selector-class">.onNext</span>(<span class="hljs-number">2</span>) â†’ <span class="hljs-built_in">println</span>(<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><h2 id="èƒŒå‹ä¼ é€’æºç "><a href="#èƒŒå‹ä¼ é€’æºç " class="headerlink" title="èƒŒå‹ä¼ é€’æºç "></a>èƒŒå‹ä¼ é€’æºç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>)<br>    .filter(i -&gt; i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>)<br>    .take(<span class="hljs-number">5</span>)<br>    .subscribe(System.out::println);<br></code></pre></td></tr></table></figure><h3 id="request-çš„ä¼ é€’"><a href="#request-çš„ä¼ é€’" class="headerlink" title="request çš„ä¼ é€’"></a>request çš„ä¼ é€’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// FluxTake.java - TakeSubscriber</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">request</span><span class="hljs-params">(<span class="hljs-type">long</span> n)</span> &#123;<br>    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// å‘ä¸Šæ¸¸è¯·æ±‚ï¼Œä½†ä¸è¶…è¿‡å‰©ä½™éœ€è¦çš„æ•°é‡</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">toRequest</span> <span class="hljs-operator">=</span> Math.min(n, remaining);<br>        s.request(toRequest);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// FluxFilter.java - FilterSubscriber  </span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">request</span><span class="hljs-params">(<span class="hljs-type">long</span> n)</span> &#123;<br>    <span class="hljs-comment">// filter å¯èƒ½éœ€è¦è¯·æ±‚æ›´å¤šï¼Œå› ä¸ºæœ‰äº›ä¼šè¢«è¿‡æ»¤æ‰</span><br>    s.request(n);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å®Œæ•´çš„èƒŒå‹æµç¨‹"><a href="#å®Œæ•´çš„èƒŒå‹æµç¨‹" class="headerlink" title="å®Œæ•´çš„èƒŒå‹æµç¨‹"></a>å®Œæ•´çš„èƒŒå‹æµç¨‹</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus">LambdaSubscriber<span class="hljs-selector-class">.request</span>(Long.MAX_VALUE)<br>    â†“<br>TakeSubscriber<span class="hljs-selector-class">.request</span>(Long.MAX_VALUE) <br>    â†’ å®é™…è¯·æ±‚ <span class="hljs-built_in">min</span>(MAX_VALUE, <span class="hljs-number">5</span>) = <span class="hljs-number">5</span><br>    â†“<br>FilterSubscriber<span class="hljs-selector-class">.request</span>(<span class="hljs-number">5</span>)<br>    â†’ ç›´æ¥ä¼ é€’ï¼ˆ<span class="hljs-attribute">filter</span> ä¸çŸ¥é“ä¼šè¿‡æ»¤å¤šå°‘ï¼‰<br>    â†“<br>RangeSubscription<span class="hljs-selector-class">.request</span>(<span class="hljs-number">5</span>)<br>    â†’ å¼€å§‹ç”Ÿäº§ <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><h2 id="å¼‚æ­¥è¾¹ç•Œä¸è°ƒåº¦å™¨"><a href="#å¼‚æ­¥è¾¹ç•Œä¸è°ƒåº¦å™¨" class="headerlink" title="å¼‚æ­¥è¾¹ç•Œä¸è°ƒåº¦å™¨"></a>å¼‚æ­¥è¾¹ç•Œä¸è°ƒåº¦å™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br>    .publishOn(Schedulers.parallel())<br>    .map(i -&gt; i * <span class="hljs-number">2</span>)<br>    .subscribe(System.out::println);<br></code></pre></td></tr></table></figure><h3 id="publishOn-çš„å®ç°"><a href="#publishOn-çš„å®ç°" class="headerlink" title="publishOn çš„å®ç°"></a>publishOn çš„å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// FluxPublishOn.java</span><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FluxPublishOn</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FluxOperator</span>&lt;T, T&gt; &#123;<br>    <span class="hljs-keyword">final</span> Scheduler scheduler;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> prefetch;  <span class="hljs-comment">// é¢„å–æ•°é‡</span><br>    <br>    <span class="hljs-comment">// PublishOnSubscriber å†…éƒ¨æœ‰é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PublishOnSubscriber</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Subscriber</span>&lt;T&gt;, Runnable &#123;<br>        <span class="hljs-keyword">final</span> Queue&lt;T&gt; queue;  <span class="hljs-comment">// ç¼“å†²é˜Ÿåˆ—</span><br>        <span class="hljs-keyword">final</span> Worker worker;   <span class="hljs-comment">// è°ƒåº¦å™¨å·¥ä½œçº¿ç¨‹</span><br>        <br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNext</span><span class="hljs-params">(T t)</span> &#123;<br>            queue.offer(t);     <span class="hljs-comment">// æ”¾å…¥é˜Ÿåˆ—</span><br>            trySchedule();      <span class="hljs-comment">// è°ƒåº¦æ‰§è¡Œ</span><br>        &#125;<br>        <br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">trySchedule</span><span class="hljs-params">()</span> &#123;<br>            worker.schedule(<span class="hljs-built_in">this</span>);  <span class="hljs-comment">// åœ¨å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ run()</span><br>        &#125;<br>        <br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-comment">// åœ¨è°ƒåº¦å™¨çº¿ç¨‹ä¸­æ‰§è¡Œ</span><br>            <span class="hljs-type">T</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> queue.poll();<br>            actual.onNext(v);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>çº¿ç¨‹åˆ‡æ¢ç‚¹</strong>ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">main çº¿ç¨‹: range â†’ publishOn çš„ queue<br>    â†“ (çº¿ç¨‹åˆ‡æ¢)<br>parallel çº¿ç¨‹: queue â†’ map â†’ subscribe<br></code></pre></td></tr></table></figure><h2 id="å…³é”®è®¾è®¡æ¨¡å¼"><a href="#å…³é”®è®¾è®¡æ¨¡å¼" class="headerlink" title="å…³é”®è®¾è®¡æ¨¡å¼"></a>å…³é”®è®¾è®¡æ¨¡å¼</h2><h3 id="1-è£…é¥°å™¨æ¨¡å¼"><a href="#1-è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="1. è£…é¥°å™¨æ¨¡å¼"></a>1. è£…é¥°å™¨æ¨¡å¼</h3><p>æ¯ä¸ªæ“ä½œç¬¦éƒ½æ˜¯å¯¹ä¸Šæ¸¸çš„è£…é¥°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Flux&lt;Integer&gt; source = Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);<br>Flux&lt;Integer&gt; mapped = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FluxMap</span>&lt;&gt;(source, i -&gt; i * <span class="hljs-number">2</span>);<br>Flux&lt;Integer&gt; filtered = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FluxFilter</span>&lt;&gt;(mapped, i -&gt; i &gt; <span class="hljs-number">5</span>);<br></code></pre></td></tr></table></figure><h3 id="2-è´£ä»»é“¾æ¨¡å¼"><a href="#2-è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="2. è´£ä»»é“¾æ¨¡å¼"></a>2. è´£ä»»é“¾æ¨¡å¼</h3><p>è®¢é˜…æ—¶å½¢æˆ Subscriber é“¾ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">source.subscribe(<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapSubscriber</span>(<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">FilterSubscriber</span>(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaSubscriber</span>(consumer)<br>        )<br>    )<br>);<br></code></pre></td></tr></table></figure><h3 id="3-è§‚å¯Ÿè€…æ¨¡å¼"><a href="#3-è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="3. è§‚å¯Ÿè€…æ¨¡å¼"></a>3. è§‚å¯Ÿè€…æ¨¡å¼</h3><p>Publisher-Subscriber æœ¬èº«å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„å˜ä½“ã€‚</p><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸Šä¸€ç¯‡ï¼šProject Reactor å®ç°</li><li>Reactive Streams è§„èŒƒ</li><li>WebFlux - çº¿ç¨‹æ¨¡å‹ä¸Netty</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Reactive Streams</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>ReactiveStreams</tag>
      
      <tag>Reactor</tag>
      
      <tag>æºç </tag>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¿ç¨‹æ± åŸç†</title>
    <link href="/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86/"/>
    <url>/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="çº¿ç¨‹æ± åŸç†"><a href="#çº¿ç¨‹æ± åŸç†" class="headerlink" title="çº¿ç¨‹æ± åŸç†"></a>çº¿ç¨‹æ± åŸç†</h1><h2 id="æ ¸å¿ƒå‚æ•°ï¼ˆ7å¤§å‚æ•°ï¼‰"><a href="#æ ¸å¿ƒå‚æ•°ï¼ˆ7å¤§å‚æ•°ï¼‰" class="headerlink" title="æ ¸å¿ƒå‚æ•°ï¼ˆ7å¤§å‚æ•°ï¼‰"></a>æ ¸å¿ƒå‚æ•°ï¼ˆ7å¤§å‚æ•°ï¼‰</h2><p><code>ThreadPoolExecutor</code> æ˜¯çº¿ç¨‹æ± çš„æ ¸å¿ƒå®ç°ç±»ï¼Œå…¶æ„é€ å‡½æ•°åŒ…å« 7 ä¸ªå…³é”®å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(</span><br><span class="hljs-params">    <span class="hljs-type">int</span> corePoolSize,           // æ ¸å¿ƒçº¿ç¨‹æ•°</span><br><span class="hljs-params">    <span class="hljs-type">int</span> maximumPoolSize,        // æœ€å¤§çº¿ç¨‹æ•°</span><br><span class="hljs-params">    <span class="hljs-type">long</span> keepAliveTime,         // ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´</span><br><span class="hljs-params">    TimeUnit unit,              // æ—¶é—´å•ä½</span><br><span class="hljs-params">    BlockingQueue&lt;Runnable&gt; workQueue,  // ä»»åŠ¡é˜Ÿåˆ—</span><br><span class="hljs-params">    ThreadFactory threadFactory,        // çº¿ç¨‹å·¥å‚</span><br><span class="hljs-params">    RejectedExecutionHandler handler    // æ‹’ç»ç­–ç•¥</span><br><span class="hljs-params">)</span><br></code></pre></td></tr></table></figure><h3 id="å‚æ•°è¯¦è§£"><a href="#å‚æ•°è¯¦è§£" class="headerlink" title="å‚æ•°è¯¦è§£"></a>å‚æ•°è¯¦è§£</h3><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>å»ºè®®</th></tr></thead><tbody><tr><td><strong>corePoolSize</strong></td><td>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³ä½¿ç©ºé—²ä¹Ÿä¸ä¼šè¢«å›æ”¶</td><td>CPUå¯†é›†å‹ï¼šN+1ï¼ŒIOå¯†é›†å‹ï¼š2N ğŸ‘‰è¯¦è§£</td></tr><tr><td><strong>maximumPoolSize</strong></td><td>çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°</td><td>æ ¹æ®ä¸šåŠ¡å³°å€¼è®¾ç½®</td></tr><tr><td><strong>keepAliveTime</strong></td><td>éæ ¸å¿ƒçº¿ç¨‹ç©ºé—²å­˜æ´»æ—¶é—´</td><td>ä¸€èˆ¬ 60s</td></tr><tr><td><strong>unit</strong></td><td>keepAliveTime çš„æ—¶é—´å•ä½</td><td>TimeUnit.SECONDS</td></tr><tr><td><strong>workQueue</strong></td><td>ä»»åŠ¡ç­‰å¾…é˜Ÿåˆ—</td><td>æœ‰ç•Œé˜Ÿåˆ—æ›´å®‰å…¨</td></tr><tr><td><strong>threadFactory</strong></td><td>åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œå¯è‡ªå®šä¹‰çº¿ç¨‹å</td><td>å»ºè®®è‡ªå®šä¹‰ä¾¿äºæ’æŸ¥</td></tr><tr><td><strong>handler</strong></td><td>é˜Ÿåˆ—æ»¡ä¸”çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§æ—¶çš„æ‹’ç»ç­–ç•¥</td><td>æ ¹æ®ä¸šåŠ¡é€‰æ‹©</td></tr></tbody></table><hr><h2 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a>å·¥ä½œæµç¨‹</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs gams">      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>      â”‚   æäº¤ä»»åŠ¡       â”‚<br>      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>               â”‚<br>               â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚  æ ¸å¿ƒçº¿ç¨‹æ•° &lt; corePoolSize?   â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>      <span class="hljs-keyword">YES</span> â”‚          â”‚ <span class="hljs-keyword">NO</span><br>          â–¼          â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ â”‚  â”‚ ä»»åŠ¡é˜Ÿåˆ—æœªæ»¡?    â”‚<br>â”‚ æ‰§è¡Œä»»åŠ¡     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      <span class="hljs-keyword">YES</span> â”‚     â”‚ <span class="hljs-keyword">NO</span><br>                        â–¼     â–¼<br>                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                â”‚ å…¥é˜Ÿç­‰å¾… â”‚ â”‚ çº¿ç¨‹æ•° &lt; maxSize? â”‚<br>                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                              <span class="hljs-keyword">YES</span> â”‚      â”‚ <span class="hljs-keyword">NO</span><br>                                  â–¼      â–¼<br>                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>                          â”‚åˆ›å»ºéæ ¸å¿ƒâ”‚ â”‚ æ‹’ç»ç­–ç•¥ â”‚<br>                          â”‚çº¿ç¨‹æ‰§è¡Œ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br>                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="æµç¨‹æ€»ç»“"><a href="#æµç¨‹æ€»ç»“" class="headerlink" title="æµç¨‹æ€»ç»“"></a>æµç¨‹æ€»ç»“</h3><ol><li><strong>æ ¸å¿ƒçº¿ç¨‹ä¼˜å…ˆ</strong>ï¼šä»»åŠ¡æ¥äº†å…ˆçœ‹æ ¸å¿ƒçº¿ç¨‹æ˜¯å¦å·²æ»¡</li><li><strong>é˜Ÿåˆ—ç¼“å†²</strong>ï¼šæ ¸å¿ƒçº¿ç¨‹æ»¡äº†ï¼Œä»»åŠ¡è¿›å…¥é˜Ÿåˆ—ç­‰å¾…</li><li><strong>æ‰©å®¹çº¿ç¨‹</strong>ï¼šé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤„ç† ğŸ‘‰è¯¦è§£ ^expand-thread</li><li><strong>æ‹’ç»ä»»åŠ¡</strong>ï¼šçº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§ä¸”é˜Ÿåˆ—æ»¡ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥</li></ol><blockquote><p><strong>æ³¨æ„</strong>ï¼šä¸æ˜¯å…ˆæ‰©å®¹çº¿ç¨‹å†å…¥é˜Ÿï¼Œè€Œæ˜¯<strong>å…ˆå…¥é˜Ÿå†æ‰©å®¹</strong>ï¼</p></blockquote><hr><h2 id="ä»»åŠ¡é˜Ÿåˆ—ç±»å‹"><a href="#ä»»åŠ¡é˜Ÿåˆ—ç±»å‹" class="headerlink" title="ä»»åŠ¡é˜Ÿåˆ—ç±»å‹"></a>ä»»åŠ¡é˜Ÿåˆ—ç±»å‹</h2><table><thead><tr><th>é˜Ÿåˆ—ç±»å‹</th><th>ç‰¹ç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>ArrayBlockingQueue</strong></td><td>æœ‰ç•Œæ•°ç»„é˜Ÿåˆ—ï¼ŒFIFO</td><td>æ§åˆ¶èµ„æºæ¶ˆè€—ï¼Œæ¨èä½¿ç”¨</td></tr><tr><td><strong>LinkedBlockingQueue</strong></td><td>å¯é€‰æœ‰ç•Œé“¾è¡¨é˜Ÿåˆ—ï¼Œé»˜è®¤æ— ç•Œ</td><td>ä»»åŠ¡é‡å¯æ§æ—¶ä½¿ç”¨</td></tr><tr><td><strong>SynchronousQueue</strong></td><td>ä¸å­˜å‚¨å…ƒç´ ï¼Œç›´æ¥ä¼ é€’</td><td>CachedThreadPool ä½¿ç”¨</td></tr><tr><td><strong>PriorityBlockingQueue</strong></td><td>ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ— ç•Œ</td><td>éœ€è¦ä»»åŠ¡ä¼˜å…ˆçº§æ—¶</td></tr><tr><td><strong>DelayQueue</strong></td><td>å»¶è¿Ÿé˜Ÿåˆ—</td><td>å®šæ—¶ä»»åŠ¡åœºæ™¯</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ¨èï¼šä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—</span><br>BlockingQueue&lt;Runnable&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">100</span>);<br></code></pre></td></tr></table></figure><hr><h2 id="å››ç§æ‹’ç»ç­–ç•¥"><a href="#å››ç§æ‹’ç»ç­–ç•¥" class="headerlink" title="å››ç§æ‹’ç»ç­–ç•¥"></a>å››ç§æ‹’ç»ç­–ç•¥</h2><p>å½“ä»»åŠ¡æ— æ³•è¢«æ‰§è¡Œæ—¶ï¼ˆé˜Ÿåˆ—æ»¡ + çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§ï¼‰ï¼Œè§¦å‘æ‹’ç»ç­–ç•¥ï¼š</p><table><thead><tr><th>ç­–ç•¥</th><th>è¡Œä¸º</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>AbortPolicy</strong></td><td>æŠ›å‡º RejectedExecutionException</td><td>é»˜è®¤ç­–ç•¥ï¼Œå¿«é€Ÿå¤±è´¥</td></tr><tr><td><strong>CallerRunsPolicy</strong></td><td>ç”±æäº¤ä»»åŠ¡çš„çº¿ç¨‹æ‰§è¡Œ</td><td>ä¸ä¸¢å¼ƒä»»åŠ¡ï¼Œé™çº§å¤„ç†</td></tr><tr><td><strong>DiscardPolicy</strong></td><td>é™é»˜ä¸¢å¼ƒä»»åŠ¡</td><td>å…è®¸ä¸¢å¤±çš„åœºæ™¯</td></tr><tr><td><strong>DiscardOldestPolicy</strong></td><td>ä¸¢å¼ƒé˜Ÿåˆ—æœ€è€çš„ä»»åŠ¡ï¼Œé‡æ–°æäº¤</td><td>æ–°ä»»åŠ¡ä¼˜å…ˆçº§æ›´é«˜</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ç¤ºä¾‹</span><br><span class="hljs-type">RejectedExecutionHandler</span> <span class="hljs-variable">customHandler</span> <span class="hljs-operator">=</span> (r, executor) -&gt; &#123;<br>    <span class="hljs-comment">// è®°å½•æ—¥å¿—</span><br>    log.warn(<span class="hljs-string">&quot;ä»»åŠ¡è¢«æ‹’ç»: &#123;&#125;&quot;</span>, r.toString());<br>    <span class="hljs-comment">// å¯é€‰ï¼šæŒä¹…åŒ–åˆ°æ•°æ®åº“/MQï¼Œåç»­é‡è¯•</span><br>    saveToDatabase(r);<br>&#125;;<br></code></pre></td></tr></table></figure><hr><h2 id="çº¿ç¨‹æ± çŠ¶æ€ï¼ˆ5ç§çŠ¶æ€ï¼‰"><a href="#çº¿ç¨‹æ± çŠ¶æ€ï¼ˆ5ç§çŠ¶æ€ï¼‰" class="headerlink" title="çº¿ç¨‹æ± çŠ¶æ€ï¼ˆ5ç§çŠ¶æ€ï¼‰"></a>çº¿ç¨‹æ± çŠ¶æ€ï¼ˆ5ç§çŠ¶æ€ï¼‰</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ RUNNING  â”‚ â† åˆå§‹çŠ¶æ€ï¼Œæ¥æ”¶æ–°ä»»åŠ¡ï¼Œå¤„ç†é˜Ÿåˆ—ä»»åŠ¡<br>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<br>     â”‚ <span class="hljs-built_in">shutdown</span>()<br>     â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ SHUTDOWN â”‚ â† ä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œç»§ç»­å¤„ç†é˜Ÿåˆ—ä»»åŠ¡<br>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<br>     â”‚ é˜Ÿåˆ—ä¸ºç©º &amp;&amp; å·¥ä½œçº¿ç¨‹ä¸º<span class="hljs-number">0</span><br>     â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ TIDYING  â”‚ â† æ‰€æœ‰ä»»åŠ¡ç»ˆæ­¢ï¼Œå·¥ä½œçº¿ç¨‹ä¸º<span class="hljs-number">0</span><br>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<br>     â”‚ <span class="hljs-built_in">terminated</span>() æ‰§è¡Œå®Œæˆ<br>     â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ TERMINATED   â”‚ â† çº¿ç¨‹æ± å½»åº•ç»ˆæ­¢<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br><br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ RUNNING  â”‚<br>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<br>     â”‚ <span class="hljs-built_in">shutdownNow</span>()<br>     â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚   <span class="hljs-selector-tag">STOP</span>   â”‚ â† ä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ¸…ç©ºé˜Ÿåˆ—<br>â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜<br>     â”‚ å·¥ä½œçº¿ç¨‹ä¸º<span class="hljs-number">0</span><br>     â–¼<br>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ TIDYING  â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><h3 id="çŠ¶æ€è½¬æ¢æ–¹æ³•"><a href="#çŠ¶æ€è½¬æ¢æ–¹æ³•" class="headerlink" title="çŠ¶æ€è½¬æ¢æ–¹æ³•"></a>çŠ¶æ€è½¬æ¢æ–¹æ³•</h3><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>shutdown()</code></td><td>æ¸©å’Œå…³é—­ï¼Œç­‰å¾…å·²æäº¤ä»»åŠ¡å®Œæˆ</td></tr><tr><td><code>shutdownNow()</code></td><td>ç«‹å³å…³é—­ï¼Œå°è¯•ä¸­æ–­æ‰§è¡Œä¸­çš„ä»»åŠ¡ï¼Œè¿”å›æœªæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨</td></tr><tr><td><code>awaitTermination()</code></td><td>é˜»å¡ç­‰å¾…çº¿ç¨‹æ± ç»ˆæ­¢</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¼˜é›…å…³é—­çº¿ç¨‹æ± </span><br>executor.shutdown();<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">if</span> (!executor.awaitTermination(<span class="hljs-number">60</span>, TimeUnit.SECONDS)) &#123;<br>        executor.shutdownNow();<br>    &#125;<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>    executor.shutdownNow();<br>    Thread.currentThread().interrupt();<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="çº¿ç¨‹æ± ç›‘æ§"><a href="#çº¿ç¨‹æ± ç›‘æ§" class="headerlink" title="çº¿ç¨‹æ± ç›‘æ§"></a>çº¿ç¨‹æ± ç›‘æ§</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> (ThreadPoolExecutor) Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br><br><span class="hljs-comment">// ç›‘æ§æŒ‡æ ‡</span><br>System.out.println(<span class="hljs-string">&quot;æ ¸å¿ƒçº¿ç¨‹æ•°: &quot;</span> + executor.getCorePoolSize());<br>System.out.println(<span class="hljs-string">&quot;æœ€å¤§çº¿ç¨‹æ•°: &quot;</span> + executor.getMaximumPoolSize());<br>System.out.println(<span class="hljs-string">&quot;å½“å‰çº¿ç¨‹æ•°: &quot;</span> + executor.getPoolSize());<br>System.out.println(<span class="hljs-string">&quot;æ´»è·ƒçº¿ç¨‹æ•°: &quot;</span> + executor.getActiveCount());<br>System.out.println(<span class="hljs-string">&quot;é˜Ÿåˆ—ä»»åŠ¡æ•°: &quot;</span> + executor.getQueue().size());<br>System.out.println(<span class="hljs-string">&quot;å·²å®Œæˆä»»åŠ¡: &quot;</span> + executor.getCompletedTaskCount());<br>System.out.println(<span class="hljs-string">&quot;æ€»ä»»åŠ¡æ•°: &quot;</span> + executor.getTaskCount());<br></code></pre></td></tr></table></figure><hr><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li><strong>ä¸Šä¸€ç¯‡</strong>ï¼š01-çº¿ç¨‹æ± ç®€ä»‹</li><li><strong>ä¸‹ä¸€ç¯‡</strong>ï¼š03-çº¿ç¨‹æ± ç±»å‹</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>å¹¶å‘ç¼–ç¨‹</category>
      
      <category>çº¿ç¨‹æ± </category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>å¹¶å‘ç¼–ç¨‹</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
      <tag>ThreadPoolExecutor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¿ç¨‹æ± ç±»å‹</title>
    <link href="/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%B1%BB%E5%9E%8B/"/>
    <url>/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="çº¿ç¨‹æ± ç±»å‹"><a href="#çº¿ç¨‹æ± ç±»å‹" class="headerlink" title="çº¿ç¨‹æ± ç±»å‹"></a>çº¿ç¨‹æ± ç±»å‹</h1><h2 id="Executors-å·¥å‚ç±»"><a href="#Executors-å·¥å‚ç±»" class="headerlink" title="Executors å·¥å‚ç±»"></a>Executors å·¥å‚ç±»</h2><p>Java é€šè¿‡ <code>Executors</code> å·¥å‚ç±»æä¾›äº†å‡ ç§å¸¸ç”¨çš„çº¿ç¨‹æ± å®ç°ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                        Executors                                â”‚<br>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚  <span class="hljs-built_in">newFixedThreadPool</span>()      â†’ å›ºå®šå¤§å°çº¿ç¨‹æ±                       â”‚<br>â”‚  <span class="hljs-built_in">newCachedThreadPool</span>()     â†’ ç¼“å­˜çº¿ç¨‹æ±                           â”‚<br>â”‚  <span class="hljs-built_in">newSingleThreadExecutor</span>() â†’ å•çº¿ç¨‹æ±                             â”‚<br>â”‚  <span class="hljs-built_in">newScheduledThreadPool</span>()  â†’ å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ±                       â”‚<br>â”‚  <span class="hljs-built_in">newWorkStealingPool</span>()     â†’ å·¥ä½œçªƒå–çº¿ç¨‹æ±  (Java <span class="hljs-number">8</span>+)            â”‚<br>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure><hr><h2 id="1-FixedThreadPoolï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰"><a href="#1-FixedThreadPoolï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰" class="headerlink" title="1. FixedThreadPoolï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰"></a>1. FixedThreadPoolï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰</h2><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•° &#x3D; æœ€å¤§çº¿ç¨‹æ•° &#x3D; å›ºå®šå€¼</li><li>ä½¿ç”¨<strong>æ— ç•Œé˜Ÿåˆ—</strong> <code>LinkedBlockingQueue</code></li><li>çº¿ç¨‹ä¸ä¼šè¢«å›æ”¶</li></ul><h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newFixedThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> nThreads)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>        nThreads,                           <span class="hljs-comment">// corePoolSize</span><br>        nThreads,                           <span class="hljs-comment">// maximumPoolSizeï¼ˆç›¸åŒï¼‰</span><br>        <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,          <span class="hljs-comment">// ä¸å›æ”¶</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;() <span class="hljs-comment">// æ— ç•Œé˜Ÿåˆ—</span><br>    );<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>CPU å¯†é›†å‹ä»»åŠ¡</strong></td><td>çº¿ç¨‹æ•° &#x3D; CPU æ ¸å¿ƒæ•° + 1</td></tr><tr><td><strong>è´Ÿè½½ç¨³å®šçš„æœåŠ¡</strong></td><td>å·²çŸ¥å¹¶å‘é‡ï¼Œå›ºå®šçº¿ç¨‹æ•°</td></tr></tbody></table><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆ›å»ºå›ºå®š 4 ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </span><br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">4</span>);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>    executor.submit(() -&gt; &#123;<br>        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; æ‰§è¡Œä»»åŠ¡&quot;</span>);<br>    &#125;);<br>&#125;<br>executor.shutdown();<br></code></pre></td></tr></table></figure><h3 id="é£é™©æç¤º"><a href="#é£é™©æç¤º" class="headerlink" title="é£é™©æç¤º"></a>é£é™©æç¤º</h3><blockquote><p><strong>OOM é£é™©</strong>ï¼šä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼Œä»»åŠ¡å †ç§¯å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º</p></blockquote><hr><h2 id="2-CachedThreadPoolï¼ˆç¼“å­˜çº¿ç¨‹æ± ï¼‰"><a href="#2-CachedThreadPoolï¼ˆç¼“å­˜çº¿ç¨‹æ± ï¼‰" class="headerlink" title="2. CachedThreadPoolï¼ˆç¼“å­˜çº¿ç¨‹æ± ï¼‰"></a>2. CachedThreadPoolï¼ˆç¼“å­˜çº¿ç¨‹æ± ï¼‰</h2><h3 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•° &#x3D; 0</li><li>æœ€å¤§çº¿ç¨‹æ•° &#x3D; <code>Integer.MAX_VALUE</code>ï¼ˆå‡ ä¹æ— é™ï¼‰</li><li>ä½¿ç”¨ <code>SynchronousQueue</code>ï¼ˆä¸å­˜å‚¨ä»»åŠ¡ï¼Œç›´æ¥ä¼ é€’ï¼‰</li><li>ç©ºé—²çº¿ç¨‹ 60 ç§’åå›æ”¶</li></ul><h3 id="æºç åˆ†æ-1"><a href="#æºç åˆ†æ-1" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newCachedThreadPool</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>        <span class="hljs-number">0</span>,                                  <span class="hljs-comment">// corePoolSize = 0</span><br>        Integer.MAX_VALUE,                  <span class="hljs-comment">// maximumPoolSize = æ— é™</span><br>        <span class="hljs-number">60L</span>, TimeUnit.SECONDS,              <span class="hljs-comment">// 60ç§’å›æ”¶</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;Runnable&gt;()    <span class="hljs-comment">// ç›´æ¥ä¼ é€’</span><br>    );<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åœºæ™¯-1"><a href="#ä½¿ç”¨åœºæ™¯-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>çŸ­æ—¶å¼‚æ­¥ä»»åŠ¡</strong></td><td>æ‰§è¡Œæ—¶é—´çŸ­ï¼Œä»»åŠ¡é‡æ³¢åŠ¨å¤§</td></tr><tr><td><strong>IO å¯†é›†å‹ä»»åŠ¡</strong></td><td>å¤§é‡ç­‰å¾…ï¼Œéœ€è¦æ›´å¤šçº¿ç¨‹</td></tr></tbody></table><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();<br><br><span class="hljs-comment">// æ¨¡æ‹Ÿçªå‘å¤§é‡çŸ­ä»»åŠ¡</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>    executor.submit(() -&gt; &#123;<br>        System.out.println(Thread.currentThread().getName());<br>        <span class="hljs-keyword">try</span> &#123; Thread.sleep(<span class="hljs-number">100</span>); &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;&#125;<br>    &#125;);<br>&#125;<br>executor.shutdown();<br></code></pre></td></tr></table></figure><h3 id="é£é™©æç¤º-1"><a href="#é£é™©æç¤º-1" class="headerlink" title="é£é™©æç¤º"></a>é£é™©æç¤º</h3><blockquote><p><strong>çº¿ç¨‹çˆ†ç‚¸</strong>ï¼šä»»åŠ¡æäº¤é€Ÿåº¦ &gt; å¤„ç†é€Ÿåº¦æ—¶ï¼Œä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ</p></blockquote><hr><h2 id="3-SingleThreadExecutorï¼ˆå•çº¿ç¨‹æ± ï¼‰"><a href="#3-SingleThreadExecutorï¼ˆå•çº¿ç¨‹æ± ï¼‰" class="headerlink" title="3. SingleThreadExecutorï¼ˆå•çº¿ç¨‹æ± ï¼‰"></a>3. SingleThreadExecutorï¼ˆå•çº¿ç¨‹æ± ï¼‰</h2><h3 id="ç‰¹ç‚¹-2"><a href="#ç‰¹ç‚¹-2" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>åªæœ‰ 1 ä¸ªçº¿ç¨‹</li><li>ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—</li><li>ä¿è¯ä»»åŠ¡<strong>é¡ºåºæ‰§è¡Œ</strong></li><li>çº¿ç¨‹å¼‚å¸¸ç»ˆæ­¢åä¼šåˆ›å»ºæ–°çº¿ç¨‹</li></ul><h3 id="æºç åˆ†æ-2"><a href="#æºç åˆ†æ-2" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newSingleThreadExecutor</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FinalizableDelegatedExecutorService</span>(<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>            <span class="hljs-number">1</span>, <span class="hljs-number">1</span>,                               <span class="hljs-comment">// åªæœ‰1ä¸ªçº¿ç¨‹</span><br>            <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()<br>        )<br>    );<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åœºæ™¯-2"><a href="#ä½¿ç”¨åœºæ™¯-2" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é¡ºåºæ‰§è¡Œä»»åŠ¡</strong></td><td>æ—¥å¿—å†™å…¥ã€æ¶ˆæ¯å¤„ç†</td></tr><tr><td><strong>å•çº¿ç¨‹å®‰å…¨</strong></td><td>é¿å…å¹¶å‘é—®é¢˜</td></tr></tbody></table><h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor();<br><br><span class="hljs-comment">// ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œ</span><br>executor.submit(() -&gt; System.out.println(<span class="hljs-string">&quot;ä»»åŠ¡1&quot;</span>));<br>executor.submit(() -&gt; System.out.println(<span class="hljs-string">&quot;ä»»åŠ¡2&quot;</span>));<br>executor.submit(() -&gt; System.out.println(<span class="hljs-string">&quot;ä»»åŠ¡3&quot;</span>));<br><span class="hljs-comment">// è¾“å‡ºé¡ºåºä¸€å®šæ˜¯ï¼šä»»åŠ¡1 â†’ ä»»åŠ¡2 â†’ ä»»åŠ¡3</span><br><br>executor.shutdown();<br></code></pre></td></tr></table></figure><h3 id="é£é™©æç¤º-2"><a href="#é£é™©æç¤º-2" class="headerlink" title="é£é™©æç¤º"></a>é£é™©æç¤º</h3><blockquote><p><strong>OOM é£é™©</strong>ï¼šåŒ FixedThreadPoolï¼Œæ— ç•Œé˜Ÿåˆ—å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º</p></blockquote><hr><h2 id="4-ScheduledThreadPoolï¼ˆå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼‰"><a href="#4-ScheduledThreadPoolï¼ˆå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼‰" class="headerlink" title="4. ScheduledThreadPoolï¼ˆå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼‰"></a>4. ScheduledThreadPoolï¼ˆå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼‰</h2><h3 id="ç‰¹ç‚¹-3"><a href="#ç‰¹ç‚¹-3" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul><li>æ”¯æŒ<strong>å®šæ—¶æ‰§è¡Œ</strong>å’Œ<strong>å‘¨æœŸæ‰§è¡Œ</strong></li><li>ä½¿ç”¨ <code>DelayedWorkQueue</code>ï¼ˆå»¶è¿Ÿé˜Ÿåˆ—ï¼‰</li></ul><h3 id="æºç åˆ†æ-3"><a href="#æºç åˆ†æ-3" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ScheduledExecutorService <span class="hljs-title function_">newScheduledThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledThreadPoolExecutor</span>(corePoolSize);<br>&#125;<br><br><span class="hljs-comment">// ScheduledThreadPoolExecutor ç»§æ‰¿è‡ª ThreadPoolExecutor</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ScheduledThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize)</span> &#123;<br>    <span class="hljs-built_in">super</span>(corePoolSize, Integer.MAX_VALUE,<br>          DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS,<br>          <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayedWorkQueue</span>());<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ ¸å¿ƒæ–¹æ³•"><a href="#æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•"></a>æ ¸å¿ƒæ–¹æ³•</h3><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>schedule()</code></td><td>å»¶è¿Ÿæ‰§è¡Œä¸€æ¬¡</td></tr><tr><td><code>scheduleAtFixedRate()</code></td><td>å›ºå®šé¢‘ç‡æ‰§è¡Œï¼ˆä¸è€ƒè™‘ä»»åŠ¡è€—æ—¶ï¼‰</td></tr><tr><td><code>scheduleWithFixedDelay()</code></td><td>å›ºå®šå»¶è¿Ÿæ‰§è¡Œï¼ˆä»»åŠ¡ç»“æŸåå»¶è¿Ÿï¼‰</td></tr></tbody></table><h3 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">2</span>);<br><br><span class="hljs-comment">// 1. å»¶è¿Ÿ 3 ç§’æ‰§è¡Œ</span><br>scheduler.schedule(() -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;å»¶è¿Ÿ3ç§’æ‰§è¡Œ&quot;</span>);<br>&#125;, <span class="hljs-number">3</span>, TimeUnit.SECONDS);<br><br><span class="hljs-comment">// 2. å›ºå®šé¢‘ç‡ï¼šæ¯ 2 ç§’æ‰§è¡Œä¸€æ¬¡ï¼ˆä»ä¸Šæ¬¡å¼€å§‹æ—¶é—´ç®—ï¼‰</span><br>scheduler.scheduleAtFixedRate(() -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;å›ºå®šé¢‘ç‡æ‰§è¡Œ: &quot;</span> + System.currentTimeMillis());<br>&#125;, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, TimeUnit.SECONDS);<br><br><span class="hljs-comment">// 3. å›ºå®šå»¶è¿Ÿï¼šæ¯æ¬¡æ‰§è¡Œå®Œåç­‰ 2 ç§’å†æ‰§è¡Œ</span><br>scheduler.scheduleWithFixedDelay(() -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;å›ºå®šå»¶è¿Ÿæ‰§è¡Œ&quot;</span>);<br>    <span class="hljs-keyword">try</span> &#123; Thread.sleep(<span class="hljs-number">1000</span>); &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;&#125;<br>&#125;, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, TimeUnit.SECONDS);<br></code></pre></td></tr></table></figure><h3 id="scheduleAtFixedRate-vs-scheduleWithFixedDelay"><a href="#scheduleAtFixedRate-vs-scheduleWithFixedDelay" class="headerlink" title="scheduleAtFixedRate vs scheduleWithFixedDelay"></a>scheduleAtFixedRate vs scheduleWithFixedDelay</h3><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">scheduleAtFixedRate (period=2s</span><span class="hljs-string">,</span> <span class="hljs-comment">ä»»åŠ¡è€—æ—¶1s):</span><br><span class="hljs-comment">|</span><span class="hljs-literal">--</span><span class="hljs-comment">ä»»åŠ¡</span><span class="hljs-literal">--</span><span class="hljs-comment">|     |</span><span class="hljs-literal">--</span><span class="hljs-comment">ä»»åŠ¡</span><span class="hljs-literal">--</span><span class="hljs-comment">|     |</span><span class="hljs-literal">--</span><span class="hljs-comment">ä»»åŠ¡</span><span class="hljs-literal">--</span><span class="hljs-comment">|</span><br><span class="hljs-comment">0        1     2        3     4        5  (ç§’)</span><br><br><span class="hljs-comment">scheduleWithFixedDelay (delay=2s</span><span class="hljs-string">,</span> <span class="hljs-comment">ä»»åŠ¡è€—æ—¶1s):</span><br><span class="hljs-comment">|</span><span class="hljs-literal">--</span><span class="hljs-comment">ä»»åŠ¡</span><span class="hljs-literal">--</span><span class="hljs-comment">|           |</span><span class="hljs-literal">--</span><span class="hljs-comment">ä»»åŠ¡</span><span class="hljs-literal">--</span><span class="hljs-comment">|           |</span><span class="hljs-literal">--</span><span class="hljs-comment">ä»»åŠ¡</span><span class="hljs-literal">--</span><span class="hljs-comment">|</span><br><span class="hljs-comment">0        1     2     3        4     5     6        7  (ç§’)</span><br>         <span class="hljs-comment">â””â”€â”€2så»¶è¿Ÿâ”€â”€â”˜         â””â”€â”€2så»¶è¿Ÿâ”€â”€â”˜</span><br></code></pre></td></tr></table></figure><hr><h2 id="5-WorkStealingPoolï¼ˆå·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼‰"><a href="#5-WorkStealingPoolï¼ˆå·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼‰" class="headerlink" title="5. WorkStealingPoolï¼ˆå·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼‰"></a>5. WorkStealingPoolï¼ˆå·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼‰</h2><h3 id="ç‰¹ç‚¹ï¼ˆJava-8-ï¼‰"><a href="#ç‰¹ç‚¹ï¼ˆJava-8-ï¼‰" class="headerlink" title="ç‰¹ç‚¹ï¼ˆJava 8+ï¼‰"></a>ç‰¹ç‚¹ï¼ˆJava 8+ï¼‰</h3><ul><li>åŸºäº ForkJoinPool å®ç° ^forkjoinpool</li><li>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„<strong>åŒç«¯é˜Ÿåˆ—</strong></li><li>ç©ºé—²çº¿ç¨‹ä¼š<strong>çªƒå–</strong>å…¶ä»–çº¿ç¨‹é˜Ÿåˆ—çš„ä»»åŠ¡</li><li>é»˜è®¤çº¿ç¨‹æ•° &#x3D; CPU æ ¸å¿ƒæ•°</li></ul><h3 id="æºç åˆ†æ-4"><a href="#æºç åˆ†æ-4" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newWorkStealingPool</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>(<br>        Runtime.getRuntime().availableProcessors(),  <span class="hljs-comment">// CPUæ ¸å¿ƒæ•°</span><br>        ForkJoinPool.defaultForkJoinWorkerThreadFactory,<br>        <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span><br>    );<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å·¥ä½œçªƒå–åŸç†"><a href="#å·¥ä½œçªƒå–åŸç†" class="headerlink" title="å·¥ä½œçªƒå–åŸç†"></a>å·¥ä½œçªƒå–åŸç†</h3><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs inform7">çº¿ç¨‹1çš„é˜Ÿåˆ—:  <span class="hljs-comment">[ä»»åŠ¡A]</span> <span class="hljs-comment">[ä»»åŠ¡B]</span> <span class="hljs-comment">[ä»»åŠ¡C]</span> <span class="hljs-comment">[ä»»åŠ¡D]</span><br>                â†‘ ä»å¤´éƒ¨å–ä»»åŠ¡æ‰§è¡Œ<br>                <br>çº¿ç¨‹2çš„é˜Ÿåˆ—:  <span class="hljs-comment">[ç©º]</span><br>                â†‘ è‡ªå·±é˜Ÿåˆ—ç©ºäº†ï¼Œä»çº¿ç¨‹1é˜Ÿåˆ—å°¾éƒ¨çªƒå–<br>                <br>ç»“æœ: çº¿ç¨‹2çªƒå–ä»»åŠ¡Dæ‰§è¡Œ<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨åœºæ™¯-3"><a href="#ä½¿ç”¨åœºæ™¯-3" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é€’å½’ä»»åŠ¡</strong></td><td>åˆ†æ²»ç®—æ³•ã€æ ‘éå†</td></tr><tr><td><strong>å¹¶è¡Œè®¡ç®—</strong></td><td>å¤§æ•°æ®å¤„ç†ã€å¹¶è¡Œæµ</td></tr></tbody></table><h3 id="ç¤ºä¾‹-4"><a href="#ç¤ºä¾‹-4" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newWorkStealingPool();<br><br>List&lt;Callable&lt;Integer&gt;&gt; tasks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> i;<br>    tasks.add(() -&gt; &#123;<br>        Thread.sleep(<span class="hljs-number">100</span>);<br>        <span class="hljs-keyword">return</span> num * num;<br>    &#125;);<br>&#125;<br><br><span class="hljs-comment">// å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡</span><br>List&lt;Future&lt;Integer&gt;&gt; results = executor.invokeAll(tasks);<br></code></pre></td></tr></table></figure><hr><h2 id="çº¿ç¨‹æ± å¯¹æ¯”æ€»ç»“"><a href="#çº¿ç¨‹æ± å¯¹æ¯”æ€»ç»“" class="headerlink" title="çº¿ç¨‹æ± å¯¹æ¯”æ€»ç»“"></a>çº¿ç¨‹æ± å¯¹æ¯”æ€»ç»“</h2><table><thead><tr><th>ç±»å‹</th><th>æ ¸å¿ƒçº¿ç¨‹</th><th>æœ€å¤§çº¿ç¨‹</th><th>é˜Ÿåˆ—</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Fixed</strong></td><td>n</td><td>n</td><td>æ— ç•Œ LinkedBlockingQueue</td><td>CPUå¯†é›†ã€è´Ÿè½½ç¨³å®š</td></tr><tr><td><strong>Cached</strong></td><td>0</td><td>MAX</td><td>SynchronousQueue</td><td>çŸ­ä»»åŠ¡ã€IOå¯†é›†</td></tr><tr><td><strong>Single</strong></td><td>1</td><td>1</td><td>æ— ç•Œ LinkedBlockingQueue</td><td>é¡ºåºæ‰§è¡Œ</td></tr><tr><td><strong>Scheduled</strong></td><td>n</td><td>MAX</td><td>DelayedWorkQueue</td><td>å®šæ—¶&#x2F;å‘¨æœŸä»»åŠ¡</td></tr><tr><td><strong>WorkStealing</strong></td><td>CPUæ ¸å¿ƒæ•°</td><td>-</td><td>åŒç«¯é˜Ÿåˆ—</td><td>é€’å½’&#x2F;å¹¶è¡Œè®¡ç®—</td></tr></tbody></table><hr><h2 id="æœ€ä½³å®è·µï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#æœ€ä½³å®è·µï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="æœ€ä½³å®è·µï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± "></a>æœ€ä½³å®è·µï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± </h2><blockquote><p><strong>é˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œ</strong>ï¼šç¦æ­¢ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± ï¼Œåº”é€šè¿‡ ThreadPoolExecutor æ‰‹åŠ¨åˆ›å»º</p></blockquote><h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h3><table><thead><tr><th>å·¥å‚æ–¹æ³•</th><th>é£é™©</th></tr></thead><tbody><tr><td>FixedThreadPool</td><td>æ— ç•Œé˜Ÿåˆ—å¯èƒ½ OOM</td></tr><tr><td>SingleThreadExecutor</td><td>æ— ç•Œé˜Ÿåˆ—å¯èƒ½ OOM</td></tr><tr><td>CachedThreadPool</td><td>æœ€å¤§çº¿ç¨‹æ•°æ— é™ï¼Œå¯èƒ½åˆ›å»ºè¿‡å¤šçº¿ç¨‹</td></tr><tr><td>ScheduledThreadPool</td><td>æœ€å¤§çº¿ç¨‹æ•°æ— é™</td></tr></tbody></table><h3 id="æ¨èå†™æ³•"><a href="#æ¨èå†™æ³•" class="headerlink" title="æ¨èå†™æ³•"></a>æ¨èå†™æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// âœ… æ¨èï¼šæ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span><br><span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>    <span class="hljs-number">10</span>,                                     <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span><br>    <span class="hljs-number">20</span>,                                     <span class="hljs-comment">// æœ€å¤§çº¿ç¨‹æ•°</span><br>    <span class="hljs-number">60L</span>, TimeUnit.SECONDS,                  <span class="hljs-comment">// ç©ºé—²å­˜æ´»æ—¶é—´</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">100</span>),          <span class="hljs-comment">// æœ‰ç•Œé˜Ÿåˆ—</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadFactoryBuilder</span>()              <span class="hljs-comment">// è‡ªå®šä¹‰çº¿ç¨‹åï¼ˆGuavaï¼‰</span><br>        .setNameFormat(<span class="hljs-string">&quot;ä¸šåŠ¡çº¿ç¨‹-%d&quot;</span>)<br>        .build(),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()  <span class="hljs-comment">// æ‹’ç»ç­–ç•¥</span><br>);<br></code></pre></td></tr></table></figure><h3 id="çº¿ç¨‹æ•°è®¾ç½®å»ºè®®"><a href="#çº¿ç¨‹æ•°è®¾ç½®å»ºè®®" class="headerlink" title="çº¿ç¨‹æ•°è®¾ç½®å»ºè®®"></a>çº¿ç¨‹æ•°è®¾ç½®å»ºè®®</h3><table><thead><tr><th>ä»»åŠ¡ç±»å‹</th><th>çº¿ç¨‹æ•°å…¬å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>CPU å¯†é›†å‹</strong></td><td>N + 1</td><td>N &#x3D; CPU æ ¸å¿ƒæ•°</td></tr><tr><td><strong>IO å¯†é›†å‹</strong></td><td>2N æˆ– N * (1 + W&#x2F;C)</td><td>W&#x3D;ç­‰å¾…æ—¶é—´ï¼ŒC&#x3D;è®¡ç®—æ—¶é—´</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å– CPU æ ¸å¿ƒæ•°</span><br><span class="hljs-type">int</span> <span class="hljs-variable">cpuCores</span> <span class="hljs-operator">=</span> Runtime.getRuntime().availableProcessors();<br></code></pre></td></tr></table></figure><hr><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li><strong>ä¸Šä¸€ç¯‡</strong>ï¼š02-çº¿ç¨‹æ± åŸç†</li><li><strong>ä¸‹ä¸€ç¯‡</strong>ï¼š04-ForkJoinPool</li><li><strong>çº¿ç¨‹æ± ç®€ä»‹</strong>ï¼š01-çº¿ç¨‹æ± ç®€ä»‹</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>å¹¶å‘ç¼–ç¨‹</category>
      
      <category>çº¿ç¨‹æ± </category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>å¹¶å‘ç¼–ç¨‹</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
      <tag>Executors</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®æˆ˜æ¡ˆä¾‹</title>
    <link href="/2026/01/10/%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/"/>
    <url>/2026/01/10/%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="å®æˆ˜æ¡ˆä¾‹"><a href="#å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="å®æˆ˜æ¡ˆä¾‹"></a>å®æˆ˜æ¡ˆä¾‹</h1><h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs stylus">webflux-demo/<br>â”œâ”€â”€ <span class="hljs-attribute">src</span>/main/java/com/example/demo/<br>â”‚   â”œâ”€â”€ DemoApplication<span class="hljs-selector-class">.java</span><br>â”‚   â”œâ”€â”€ config/<br>â”‚   â”‚   â””â”€â”€ RouterConfig<span class="hljs-selector-class">.java</span><br>â”‚   â”œâ”€â”€ controller/<br>â”‚   â”‚   â””â”€â”€ UserController<span class="hljs-selector-class">.java</span><br>â”‚   â”œâ”€â”€ handler/<br>â”‚   â”‚   â””â”€â”€ UserHandler<span class="hljs-selector-class">.java</span><br>â”‚   â”œâ”€â”€ model/<br>â”‚   â”‚   â””â”€â”€ User<span class="hljs-selector-class">.java</span><br>â”‚   â”œâ”€â”€ repository/<br>â”‚   â”‚   â””â”€â”€ UserRepository<span class="hljs-selector-class">.java</span><br>â”‚   â””â”€â”€ service/<br>â”‚       â””â”€â”€ UserService<span class="hljs-selector-class">.java</span><br>â”œâ”€â”€ <span class="hljs-attribute">src</span>/main/resources/<br>â”‚   â””â”€â”€ application<span class="hljs-selector-class">.yml</span><br>â””â”€â”€ pom.xml<br></code></pre></td></tr></table></figure><h2 id="Maven-ä¾èµ–"><a href="#Maven-ä¾èµ–" class="headerlink" title="Maven ä¾èµ–"></a>Maven ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 </span></span><br><span class="hljs-string"><span class="hljs-tag">         http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>webflux-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- WebFlux --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- R2DBC (å“åº”å¼æ•°æ®åº“) --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-r2dbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- H2 æ•°æ®åº“ (å¼€å‘æµ‹è¯•ç”¨) --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.r2dbc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>r2dbc-h2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- Lombok --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!-- æµ‹è¯• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.projectreactor<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>reactor-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo.model;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;<br><span class="hljs-keyword">import</span> org.springframework.data.relational.core.mapping.Table;<br><br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@Table(&quot;users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> String email;<br>    <span class="hljs-keyword">private</span> LocalDateTime createdAt;<br>    <span class="hljs-keyword">private</span> LocalDateTime updatedAt;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo.repository;<br><br><span class="hljs-keyword">import</span> com.example.demo.model.User;<br><span class="hljs-keyword">import</span> org.springframework.data.r2dbc.repository.Query;<br><span class="hljs-keyword">import</span> org.springframework.data.repository.reactive.ReactiveCrudRepository;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Flux;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReactiveCrudRepository</span>&lt;User, Long&gt; &#123;<br>    <br>    Mono&lt;User&gt; <span class="hljs-title function_">findByEmail</span><span class="hljs-params">(String email)</span>;<br>    <br>    Flux&lt;User&gt; <span class="hljs-title function_">findByNameContaining</span><span class="hljs-params">(String name)</span>;<br>    <br>    <span class="hljs-meta">@Query(&quot;SELECT * FROM users WHERE created_at &gt; :since&quot;)</span><br>    Flux&lt;User&gt; <span class="hljs-title function_">findRecentUsers</span><span class="hljs-params">(LocalDateTime since)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo.service;<br><br><span class="hljs-keyword">import</span> com.example.demo.model.User;<br><span class="hljs-keyword">import</span> com.example.demo.repository.UserRepository;<br><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Flux;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;<br><br><span class="hljs-keyword">import</span> java.time.LocalDateTime;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@RequiredArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserRepository userRepository;<br>    <br>    <span class="hljs-keyword">public</span> Flux&lt;User&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userRepository.findAll();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userRepository.findById(id);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">findByEmail</span><span class="hljs-params">(String email)</span> &#123;<br>        <span class="hljs-keyword">return</span> userRepository.findByEmail(email);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span> &#123;<br>        user.setCreatedAt(LocalDateTime.now());<br>        user.setUpdatedAt(LocalDateTime.now());<br>        <span class="hljs-keyword">return</span> userRepository.save(user);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">update</span><span class="hljs-params">(Long id, User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> userRepository.findById(id)<br>            .flatMap(existingUser -&gt; &#123;<br>                existingUser.setName(user.getName());<br>                existingUser.setEmail(user.getEmail());<br>                existingUser.setUpdatedAt(LocalDateTime.now());<br>                <span class="hljs-keyword">return</span> userRepository.save(existingUser);<br>            &#125;);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">deleteById</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userRepository.deleteById(id);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Controllerï¼ˆæ³¨è§£å¼ï¼‰"><a href="#Controllerï¼ˆæ³¨è§£å¼ï¼‰" class="headerlink" title="Controllerï¼ˆæ³¨è§£å¼ï¼‰"></a>Controllerï¼ˆæ³¨è§£å¼ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo.controller;<br><br><span class="hljs-keyword">import</span> com.example.demo.model.User;<br><span class="hljs-keyword">import</span> com.example.demo.service.UserService;<br><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;<br><span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;<br><span class="hljs-keyword">import</span> org.springframework.http.MediaType;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Flux;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;<br><br><span class="hljs-keyword">import</span> java.time.Duration;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/api/users&quot;)</span><br><span class="hljs-meta">@RequiredArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService userService;<br>    <br>    <span class="hljs-meta">@GetMapping</span><br>    <span class="hljs-keyword">public</span> Flux&lt;User&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.findAll();<br>    &#125;<br>    <br>    <span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.findById(id);<br>    &#125;<br>    <br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.CREATED)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.save(user);<br>    &#125;<br>    <br>    <span class="hljs-meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id, <span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.update(id, user);<br>    &#125;<br>    <br>    <span class="hljs-meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br>    <span class="hljs-meta">@ResponseStatus(HttpStatus.NO_CONTENT)</span><br>    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.deleteById(id);<br>    &#125;<br>    <br>    <span class="hljs-comment">// SSE æµå¼å“åº”ç¤ºä¾‹</span><br>    <span class="hljs-meta">@GetMapping(value = &quot;/stream&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span><br>    <span class="hljs-keyword">public</span> Flux&lt;User&gt; <span class="hljs-title function_">streamUsers</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userService.findAll()<br>            .delayElements(Duration.ofSeconds(<span class="hljs-number">1</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># application.yml</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">r2dbc:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">r2dbc:h2:mem:///testdb</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">sa</span><br>    <span class="hljs-attr">password:</span><br>  <br>  <span class="hljs-attr">sql:</span><br>    <span class="hljs-attr">init:</span><br>      <span class="hljs-attr">mode:</span> <span class="hljs-string">always</span><br>      <span class="hljs-attr">schema-locations:</span> <span class="hljs-string">classpath:schema.sql</span><br><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-attr">org.springframework.r2dbc:</span> <span class="hljs-string">DEBUG</span><br></code></pre></td></tr></table></figure><h2 id="æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬"><a href="#æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬" class="headerlink" title="æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬"></a>æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- schema.sql</span><br><span class="hljs-keyword">CREATE TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> users (<br>    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY KEY</span>,<br>    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT NULL</span>,<br>    email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT NULL</span>,<br>    created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,<br>    updated_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span><br>);<br><br><span class="hljs-keyword">INSERT INTO</span> users (name, email) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="hljs-string">&#x27;zhangsan@example.com&#x27;</span>);<br><span class="hljs-keyword">INSERT INTO</span> users (name, email) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">&#x27;æå››&#x27;</span>, <span class="hljs-string">&#x27;lisi@example.com&#x27;</span>);<br></code></pre></td></tr></table></figure><h2 id="WebClient-è°ƒç”¨ç¤ºä¾‹"><a href="#WebClient-è°ƒç”¨ç¤ºä¾‹" class="headerlink" title="WebClient è°ƒç”¨ç¤ºä¾‹"></a>WebClient è°ƒç”¨ç¤ºä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo.client;<br><br><span class="hljs-keyword">import</span> com.example.demo.model.User;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.reactive.function.client.WebClient;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Flux;<br><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserClient</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebClient webClient;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserClient</span><span class="hljs-params">(WebClient.Builder builder)</span> &#123;<br>        <span class="hljs-built_in">this</span>.webClient = builder<br>            .baseUrl(<span class="hljs-string">&quot;http://localhost:8080/api&quot;</span>)<br>            .build();<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Flux&lt;User&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> webClient.get()<br>            .uri(<span class="hljs-string">&quot;/users&quot;</span>)<br>            .retrieve()<br>            .bodyToFlux(User.class);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-keyword">return</span> webClient.get()<br>            .uri(<span class="hljs-string">&quot;/users/&#123;id&#125;&quot;</span>, id)<br>            .retrieve()<br>            .bodyToMono(User.class);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">createUser</span><span class="hljs-params">(User user)</span> &#123;<br>        <span class="hljs-keyword">return</span> webClient.post()<br>            .uri(<span class="hljs-string">&quot;/users&quot;</span>)<br>            .bodyValue(user)<br>            .retrieve()<br>            .bodyToMono(User.class);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.demo;<br><br><span class="hljs-keyword">import</span> com.example.demo.model.User;<br><span class="hljs-keyword">import</span> com.example.demo.service.UserService;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.autoconfigure.web.reactive.AutoConfigureWebTestClient;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.http.MediaType;<br><span class="hljs-keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;<br><span class="hljs-keyword">import</span> reactor.test.StepVerifier;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@AutoConfigureWebTestClient</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserControllerTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> WebTestClient webTestClient;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> &#123;<br>        webTestClient.get()<br>            .uri(<span class="hljs-string">&quot;/api/users&quot;</span>)<br>            .accept(MediaType.APPLICATION_JSON)<br>            .exchange()<br>            .expectStatus().isOk()<br>            .expectBodyList(User.class)<br>            .hasSize(<span class="hljs-number">2</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getUserById</span><span class="hljs-params">()</span> &#123;<br>        webTestClient.get()<br>            .uri(<span class="hljs-string">&quot;/api/users/1&quot;</span>)<br>            .accept(MediaType.APPLICATION_JSON)<br>            .exchange()<br>            .expectStatus().isOk()<br>            .expectBody()<br>            .jsonPath(<span class="hljs-string">&quot;$.name&quot;</span>).isEqualTo(<span class="hljs-string">&quot;å¼ ä¸‰&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">createUser</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">newUser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        newUser.setName(<span class="hljs-string">&quot;ç‹äº”&quot;</span>);<br>        newUser.setEmail(<span class="hljs-string">&quot;wangwu@example.com&quot;</span>);<br>        <br>        webTestClient.post()<br>            .uri(<span class="hljs-string">&quot;/api/users&quot;</span>)<br>            .contentType(MediaType.APPLICATION_JSON)<br>            .bodyValue(newUser)<br>            .exchange()<br>            .expectStatus().isCreated()<br>            .expectBody()<br>            .jsonPath(<span class="hljs-string">&quot;$.name&quot;</span>).isEqualTo(<span class="hljs-string">&quot;ç‹äº”&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testServiceWithStepVerifier</span><span class="hljs-params">()</span> &#123;<br>        StepVerifier.create(userService.findAll())<br>            .expectNextCount(<span class="hljs-number">2</span>)<br>            .verifyComplete();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2><ol><li><strong>åˆç†ä½¿ç”¨è°ƒåº¦å™¨</strong>ï¼šI&#x2F;O æ“ä½œä½¿ç”¨ <code>boundedElastic</code>ï¼ŒCPU å¯†é›†å‹ä½¿ç”¨ <code>parallel</code></li><li><strong>é¿å…é˜»å¡è°ƒç”¨</strong>ï¼šç¡®ä¿æ•´ä¸ªè°ƒç”¨é“¾éƒ½æ˜¯éé˜»å¡çš„</li><li><strong>ä½¿ç”¨è¿æ¥æ± </strong>ï¼šé…ç½®åˆé€‚çš„æ•°æ®åº“è¿æ¥æ± å¤§å°</li><li><strong>å¯ç”¨å‹ç¼©</strong>ï¼šå¯¹å“åº”æ•°æ®å¯ç”¨ Gzip å‹ç¼©</li><li><strong>ç›‘æ§æŒ‡æ ‡</strong>ï¼šé›†æˆ Micrometer ç›‘æ§å“åº”æ—¶é—´å’Œååé‡</li></ol><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li>ä¸Šä¸€ç¯‡ï¼šå‡½æ•°å¼ç«¯ç‚¹</li><li>è¿”å›ï¼šWebfluxç®€ä»‹</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Spring</category>
      
      <category>Webflux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>WebFlux</tag>
      
      <tag>å®æˆ˜</tag>
      
      <tag>R2DBC</tag>
      
      <tag>æµ‹è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¿ç¨‹æ± ç®€ä»‹</title>
    <link href="/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%AE%80%E4%BB%8B/"/>
    <url>/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="çº¿ç¨‹æ± ç®€ä»‹"><a href="#çº¿ç¨‹æ± ç®€ä»‹" class="headerlink" title="çº¿ç¨‹æ± ç®€ä»‹"></a>çº¿ç¨‹æ± ç®€ä»‹</h1><h2 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± "><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± " class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± "></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </h2><p>çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰æ˜¯ä¸€ç§<strong>çº¿ç¨‹å¤ç”¨</strong>çš„æŠ€æœ¯ï¼Œé¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„çº¿ç¨‹æ”¾å…¥æ± ä¸­ï¼Œå½“æœ‰ä»»åŠ¡éœ€è¦æ‰§è¡Œæ—¶ï¼Œä»æ± ä¸­è·å–ç©ºé—²çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä»»åŠ¡å®Œæˆåçº¿ç¨‹ä¸é”€æ¯ï¼Œè€Œæ˜¯è¿”å›æ± ä¸­ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æœ€ç®€å•çš„çº¿ç¨‹æ± ä½¿ç”¨ç¤ºä¾‹</span><br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);<br>executor.submit(() -&gt; &#123;<br>    System.out.println(<span class="hljs-string">&quot;ä»»åŠ¡æ‰§è¡Œä¸­...&quot;</span>);<br>&#125;);<br>executor.shutdown();<br></code></pre></td></tr></table></figure><hr><h2 id="ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹æ± "><a href="#ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹æ± " class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹æ± "></a>ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹æ± </h2><h3 id="é—®é¢˜ï¼šç›´æ¥åˆ›å»ºçº¿ç¨‹çš„å¼Šç«¯"><a href="#é—®é¢˜ï¼šç›´æ¥åˆ›å»ºçº¿ç¨‹çš„å¼Šç«¯" class="headerlink" title="é—®é¢˜ï¼šç›´æ¥åˆ›å»ºçº¿ç¨‹çš„å¼Šç«¯"></a>é—®é¢˜ï¼šç›´æ¥åˆ›å»ºçº¿ç¨‹çš„å¼Šç«¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸æ¨èï¼šæ¯æ¬¡ä»»åŠ¡éƒ½åˆ›å»ºæ–°çº¿ç¨‹</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; doTask()).start();<br>&#125;<br></code></pre></td></tr></table></figure><table><thead><tr><th>é—®é¢˜</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åˆ›å»ºå¼€é”€å¤§</td><td>çº¿ç¨‹åˆ›å»ºéœ€è¦åˆ†é…æ ˆå†…å­˜ï¼ˆé»˜è®¤1MBï¼‰ã€åˆå§‹åŒ– TCB ç­‰</td></tr><tr><td>é”€æ¯å¼€é”€å¤§</td><td>çº¿ç¨‹é”€æ¯éœ€è¦å›æ”¶èµ„æºã€GC å¤„ç†</td></tr><tr><td>èµ„æºè€—å°½</td><td>æ— é™åˆ¶åˆ›å»ºçº¿ç¨‹å¯èƒ½å¯¼è‡´ OOM æˆ–ç³»ç»Ÿå´©æºƒ</td></tr><tr><td>ä¸Šä¸‹æ–‡åˆ‡æ¢</td><td>çº¿ç¨‹è¿‡å¤šå¯¼è‡´ CPU é¢‘ç¹åˆ‡æ¢ï¼Œæ€§èƒ½ä¸‹é™</td></tr><tr><td>éš¾ä»¥ç®¡ç†</td><td>æ— æ³•ç»Ÿä¸€ç›‘æ§ã€è°ƒåº¦ã€é™æµ</td></tr></tbody></table><h3 id="è§£å†³ï¼šçº¿ç¨‹æ± çš„ä¼˜åŠ¿"><a href="#è§£å†³ï¼šçº¿ç¨‹æ± çš„ä¼˜åŠ¿" class="headerlink" title="è§£å†³ï¼šçº¿ç¨‹æ± çš„ä¼˜åŠ¿"></a>è§£å†³ï¼šçº¿ç¨‹æ± çš„ä¼˜åŠ¿</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ¨èï¼šä½¿ç”¨çº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹</span><br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>    executor.submit(() -&gt; doTask());<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="çº¿ç¨‹æ± çš„æ ¸å¿ƒä¼˜åŠ¿"><a href="#çº¿ç¨‹æ± çš„æ ¸å¿ƒä¼˜åŠ¿" class="headerlink" title="çº¿ç¨‹æ± çš„æ ¸å¿ƒä¼˜åŠ¿"></a>çº¿ç¨‹æ± çš„æ ¸å¿ƒä¼˜åŠ¿</h2><table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é™ä½èµ„æºæ¶ˆè€—</strong></td><td>å¤ç”¨çº¿ç¨‹ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¼€é”€</td></tr><tr><td><strong>æé«˜å“åº”é€Ÿåº¦</strong></td><td>ä»»åŠ¡åˆ°è¾¾æ—¶æ— éœ€ç­‰å¾…çº¿ç¨‹åˆ›å»ºï¼Œç›´æ¥æ‰§è¡Œ</td></tr><tr><td><strong>æé«˜å¯ç®¡ç†æ€§</strong></td><td>ç»Ÿä¸€åˆ†é…ã€è°ƒä¼˜ã€ç›‘æ§çº¿ç¨‹èµ„æº</td></tr><tr><td><strong>æä¾›æ›´å¤šåŠŸèƒ½</strong></td><td>å®šæ—¶æ‰§è¡Œã€å‘¨æœŸæ‰§è¡Œã€ä»»åŠ¡é˜Ÿåˆ—ã€æ‹’ç»ç­–ç•¥ç­‰</td></tr></tbody></table><hr><h2 id="çº¿ç¨‹æ± æ ¸å¿ƒæ¥å£"><a href="#çº¿ç¨‹æ± æ ¸å¿ƒæ¥å£" class="headerlink" title="çº¿ç¨‹æ± æ ¸å¿ƒæ¥å£"></a>çº¿ç¨‹æ± æ ¸å¿ƒæ¥å£</h2><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs isbl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚                      <span class="hljs-variable">Executor</span>                           â”‚<br>â”‚                   (é¡¶å±‚æ¥å£)                             â”‚<br>â”‚              <span class="hljs-variable">void</span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-built_in">execute</span></span>(<span class="hljs-variable">Runnable</span>)                     â”‚</span><br><span class="hljs-function">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="hljs-function">                      â”‚</span><br><span class="hljs-function">                      â–¼</span><br><span class="hljs-function">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="hljs-function">â”‚                  <span class="hljs-variable">ExecutorService</span>                        â”‚</span><br><span class="hljs-function">â”‚                 (æ‰©å±•ç”Ÿå‘½å‘¨æœŸç®¡ç†)                        â”‚</span><br><span class="hljs-function">â”‚     <span class="hljs-title">submit</span>() / <span class="hljs-title">shutdown</span>() / <span class="hljs-title">invokeAll</span>() / ...          â”‚</span><br><span class="hljs-function">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="hljs-function">                      â”‚</span><br><span class="hljs-function">                      â–¼</span><br><span class="hljs-function">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="hljs-function">â”‚              <span class="hljs-variable">ThreadPoolExecutor</span>                         â”‚</span><br><span class="hljs-function">â”‚                (æ ¸å¿ƒå®ç°ç±»)                              â”‚</span><br><span class="hljs-function">â”‚         <span class="hljs-number">7</span>å¤§å‚æ•° / <span class="hljs-number">4</span>ç§æ‹’ç»ç­–ç•¥ / <span class="hljs-number">5</span>ç§çŠ¶æ€                   â”‚</span><br><span class="hljs-function">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></code></pre></td></tr></table></figure><hr><h2 id="å¿«é€Ÿå…¥é—¨ç¤ºä¾‹"><a href="#å¿«é€Ÿå…¥é—¨ç¤ºä¾‹" class="headerlink" title="å¿«é€Ÿå…¥é—¨ç¤ºä¾‹"></a>å¿«é€Ÿå…¥é—¨ç¤ºä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.concurrent.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 1. åˆ›å»ºçº¿ç¨‹æ± </span><br>        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">3</span>);<br>        <br>        <span class="hljs-comment">// 2. æäº¤ä»»åŠ¡</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">taskId</span> <span class="hljs-operator">=</span> i;<br>            executor.submit(() -&gt; &#123;<br>                System.out.println(<span class="hljs-string">&quot;ä»»åŠ¡&quot;</span> + taskId + <span class="hljs-string">&quot; ç”± &quot;</span> + <br>                    Thread.currentThread().getName() + <span class="hljs-string">&quot; æ‰§è¡Œ&quot;</span>);<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">1000</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    Thread.currentThread().interrupt();<br>                &#125;<br>            &#125;);<br>        &#125;<br>        <br>        <span class="hljs-comment">// 3. å…³é—­çº¿ç¨‹æ± </span><br>        executor.shutdown();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>è¾“å‡ºç¤ºä¾‹ï¼š</strong></p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs subunit">ä»»åŠ¡1 ç”± pool<span class="hljs-string">-1</span>-thread<span class="hljs-string">-1</span> æ‰§è¡Œ<br>ä»»åŠ¡2 ç”± pool<span class="hljs-string">-1</span>-thread<span class="hljs-string">-2</span> æ‰§è¡Œ<br>ä»»åŠ¡3 ç”± pool<span class="hljs-string">-1</span>-thread<span class="hljs-string">-3</span> æ‰§è¡Œ<br>ä»»åŠ¡4 ç”± pool<span class="hljs-string">-1</span>-thread<span class="hljs-string">-1</span> æ‰§è¡Œ  â† çº¿ç¨‹å¤ç”¨<br>ä»»åŠ¡5 ç”± pool<span class="hljs-string">-1</span>-thread<span class="hljs-string">-2</span> æ‰§è¡Œ  â† çº¿ç¨‹å¤ç”¨<br></code></pre></td></tr></table></figure><hr><h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul><li><strong>ä¸‹ä¸€ç¯‡</strong>ï¼š02-çº¿ç¨‹æ± åŸç†</li><li><strong>çº¿ç¨‹æ± ç±»å‹</strong>ï¼š03-çº¿ç¨‹æ± ç±»å‹</li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>å¹¶å‘ç¼–ç¨‹</category>
      
      <category>çº¿ç¨‹æ± </category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>å¹¶å‘ç¼–ç¨‹</tag>
      
      <tag>çº¿ç¨‹æ± </tag>
      
      <tag>ExecutorService</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
