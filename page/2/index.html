<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zmmmmy.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":"auto","version":"8.27.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="一个来自于 AI+Obsidian 的知识库">
<meta property="og:type" content="website">
<meta property="og:title" content="Zmmmmy&#39;s Blog">
<meta property="og:url" content="https://zmmmmy.github.io/page/2/index.html">
<meta property="og:site_name" content="Zmmmmy&#39;s Blog">
<meta property="og:description" content="一个来自于 AI+Obsidian 的知识库">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ZhiMy">
<meta property="article:tag" content="技术博客">
<meta property="article:tag" content="编程">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zmmmmy.github.io/page/2/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zmmmmy's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zmmmmy's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">今天想和 AI 聊点什么？</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ZhiMy"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ZhiMy</p>
  <div class="site-description" itemprop="description">一个来自于 AI+Obsidian 的知识库</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">100</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Zmmmmy" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Zmmmmy" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/13/RAG%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="一个来自于 AI+Obsidian 的知识库">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/13/RAG%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">RAG技术详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-13 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-13T00:00:00+08:00">2026-01-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">大模型</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="RAG-技术详解"><a href="#RAG-技术详解" class="headerlink" title="RAG 技术详解"></a>RAG 技术详解</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>RAG（Retrieval-Augmented Generation，检索增强生成）</strong> 是一种结合信息检索与大语言模型生成能力的技术架构，通过从外部知识库检索相关信息来增强 LLM 的回答质量。</p>
<h3 id="为什么需要-RAG？"><a href="#为什么需要-RAG？" class="headerlink" title="为什么需要 RAG？"></a>为什么需要 RAG？</h3><table>
<thead>
<tr>
<th>问题</th>
<th>说明</th>
<th>RAG 解决方案</th>
</tr>
</thead>
<tbody><tr>
<td>知识时效性</td>
<td>LLM 训练数据有截止日期</td>
<td>实时检索最新文档</td>
</tr>
<tr>
<td>幻觉问题</td>
<td>LLM 可能编造事实</td>
<td>基于真实文档生成</td>
</tr>
<tr>
<td>私有知识</td>
<td>LLM 不了解企业内部数据</td>
<td>接入私有知识库</td>
</tr>
<tr>
<td>可追溯性</td>
<td>无法验证答案来源</td>
<td>提供引用来源</td>
</tr>
</tbody></table>
<h2 id="RAG-学习路线"><a href="#RAG-学习路线" class="headerlink" title="RAG 学习路线"></a>RAG 学习路线</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[RAG基础概念] --&gt; B[文档处理]</span><br><span class="line">    A --&gt; C[Embedding原理]</span><br><span class="line">    B --&gt; D[文本分割策略]</span><br><span class="line">    C --&gt; E[向量数据库]</span><br><span class="line">    D --&gt; F[检索策略]</span><br><span class="line">    E --&gt; F</span><br><span class="line">    F --&gt; G[Naive RAG]</span><br><span class="line">    G --&gt; H[Advanced RAG]</span><br><span class="line">    H --&gt; I[Modular RAG]</span><br><span class="line">    I --&gt; J[企业级RAG]</span><br><span class="line">    </span><br><span class="line">    style G fill:#e1f5fe</span><br><span class="line">    style H fill:#fff3e0</span><br><span class="line">    style I fill:#f3e5f5</span><br></pre></td></tr></table></figure>

<h3 id="阶段一：基础概念（3-5天）"><a href="#阶段一：基础概念（3-5天）" class="headerlink" title="阶段一：基础概念（3-5天）"></a>阶段一：基础概念（3-5天）</h3><table>
<thead>
<tr>
<th>学习内容</th>
<th>时间</th>
<th>优先级</th>
<th>产出</th>
</tr>
</thead>
<tbody><tr>
<td>RAG 核心原理</td>
<td>1天</td>
<td>⭐⭐⭐</td>
<td>理解检索+生成流程</td>
</tr>
<tr>
<td>Embedding 模型选型</td>
<td>1天</td>
<td>⭐⭐⭐</td>
<td>掌握主流模型差异</td>
</tr>
<tr>
<td>向量相似度计算</td>
<td>1天</td>
<td>⭐⭐</td>
<td>余弦相似度、欧氏距离</td>
</tr>
<tr>
<td>向量数据库入门</td>
<td>2天</td>
<td>⭐⭐⭐</td>
<td>完成 Milvus&#x2F;Chroma 部署</td>
</tr>
</tbody></table>
<h3 id="阶段二：核心流程实现（1-2周）"><a href="#阶段二：核心流程实现（1-2周）" class="headerlink" title="阶段二：核心流程实现（1-2周）"></a>阶段二：核心流程实现（1-2周）</h3><table>
<thead>
<tr>
<th>学习内容</th>
<th>时间</th>
<th>优先级</th>
<th>产出</th>
</tr>
</thead>
<tbody><tr>
<td>文档加载器</td>
<td>2天</td>
<td>⭐⭐⭐</td>
<td>PDF&#x2F;Word&#x2F;网页解析</td>
</tr>
<tr>
<td>文本分割策略</td>
<td>2天</td>
<td>⭐⭐⭐</td>
<td>理解 Chunk 策略</td>
</tr>
<tr>
<td>索引构建</td>
<td>2天</td>
<td>⭐⭐⭐</td>
<td>完成文档向量化</td>
</tr>
<tr>
<td>检索实现</td>
<td>2天</td>
<td>⭐⭐⭐</td>
<td>实现相似度搜索</td>
</tr>
<tr>
<td>Prompt 模板设计</td>
<td>1天</td>
<td>⭐⭐</td>
<td>设计 RAG 专用模板</td>
</tr>
</tbody></table>
<h3 id="阶段三：进阶优化（2-3周）"><a href="#阶段三：进阶优化（2-3周）" class="headerlink" title="阶段三：进阶优化（2-3周）"></a>阶段三：进阶优化（2-3周）</h3><table>
<thead>
<tr>
<th>学习内容</th>
<th>时间</th>
<th>优先级</th>
<th>产出</th>
</tr>
</thead>
<tbody><tr>
<td>混合检索</td>
<td>3天</td>
<td>⭐⭐⭐</td>
<td>向量+关键词检索</td>
</tr>
<tr>
<td>重排序（Rerank）</td>
<td>2天</td>
<td>⭐⭐⭐</td>
<td>提升检索精度</td>
</tr>
<tr>
<td>查询改写</td>
<td>2天</td>
<td>⭐⭐</td>
<td>HyDE、Query Expansion</td>
</tr>
<tr>
<td>多轮对话管理</td>
<td>2天</td>
<td>⭐⭐</td>
<td>对话历史处理</td>
</tr>
<tr>
<td>评估指标</td>
<td>2天</td>
<td>⭐⭐⭐</td>
<td>Recall、MRR、RAGAS</td>
</tr>
</tbody></table>
<h3 id="阶段四：生产级实践（持续）"><a href="#阶段四：生产级实践（持续）" class="headerlink" title="阶段四：生产级实践（持续）"></a>阶段四：生产级实践（持续）</h3><ul>
<li>分布式向量存储</li>
<li>增量索引更新</li>
<li>多租户隔离</li>
<li>缓存策略</li>
<li>监控与可观测性</li>
</ul>
<h2 id="RAG-核心架构"><a href="#RAG-核心架构" class="headerlink" title="RAG 核心架构"></a>RAG 核心架构</h2><h3 id="标准流程"><a href="#标准流程" class="headerlink" title="标准流程"></a>标准流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    subgraph 离线索引</span><br><span class="line">        A[原始文档] --&gt; B[文档加载]</span><br><span class="line">        B --&gt; C[文本分割]</span><br><span class="line">        C --&gt; D[Embedding]</span><br><span class="line">        D --&gt; E[(向量数据库)]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph 在线查询</span><br><span class="line">        F[用户问题] --&gt; G[Query Embedding]</span><br><span class="line">        G --&gt; H[向量检索]</span><br><span class="line">        E --&gt; H</span><br><span class="line">        H --&gt; I[相关文档]</span><br><span class="line">        I --&gt; J[Prompt构建]</span><br><span class="line">        F --&gt; J</span><br><span class="line">        J --&gt; K[LLM生成]</span><br><span class="line">        K --&gt; L[回答]</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>

<h3 id="核心组件说明"><a href="#核心组件说明" class="headerlink" title="核心组件说明"></a>核心组件说明</h3><table>
<thead>
<tr>
<th>组件</th>
<th>作用</th>
<th>常用工具</th>
</tr>
</thead>
<tbody><tr>
<td>Document Loader</td>
<td>加载多种格式文档</td>
<td>LangChain Loaders, Unstructured</td>
</tr>
<tr>
<td>Text Splitter</td>
<td>文本分块</td>
<td>RecursiveCharacterTextSplitter</td>
</tr>
<tr>
<td>Embedding Model</td>
<td>文本向量化</td>
<td>OpenAI Ada, BGE, M3E</td>
</tr>
<tr>
<td>Vector Store</td>
<td>向量存储与检索</td>
<td>Milvus, Pinecone, Chroma</td>
</tr>
<tr>
<td>Retriever</td>
<td>检索策略封装</td>
<td>MultiQueryRetriever, SelfQueryRetriever</td>
</tr>
<tr>
<td>LLM</td>
<td>答案生成</td>
<td>GPT-4, Claude, 通义千问</td>
</tr>
</tbody></table>
<h2 id="RAG-技术演进对比"><a href="#RAG-技术演进对比" class="headerlink" title="RAG 技术演进对比"></a>RAG 技术演进对比</h2><h3 id="三代-RAG-架构对比"><a href="#三代-RAG-架构对比" class="headerlink" title="三代 RAG 架构对比"></a>三代 RAG 架构对比</h3><table>
<thead>
<tr>
<th>维度</th>
<th>Naive RAG</th>
<th>Advanced RAG</th>
<th>Modular RAG</th>
</tr>
</thead>
<tbody><tr>
<td><strong>架构</strong></td>
<td>线性流水线</td>
<td>优化流水线</td>
<td>模块化组合</td>
</tr>
<tr>
<td><strong>索引</strong></td>
<td>简单分块</td>
<td>层次索引、父子块</td>
<td>多种索引策略</td>
</tr>
<tr>
<td><strong>检索</strong></td>
<td>单次向量检索</td>
<td>混合检索 + 重排</td>
<td>多路召回 + 融合</td>
</tr>
<tr>
<td><strong>生成</strong></td>
<td>直接拼接上下文</td>
<td>压缩&#x2F;筛选上下文</td>
<td>自适应生成</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>原型验证</td>
<td>生产环境</td>
<td>复杂企业场景</td>
</tr>
</tbody></table>
<h3 id="Naive-RAG"><a href="#Naive-RAG" class="headerlink" title="Naive RAG"></a>Naive RAG</h3><p>最基础的 RAG 实现，流程简单但存在明显缺陷：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用户问题 → Embedding → 向量检索 → Top-K 文档 → 拼接 Prompt → LLM 回答</span><br></pre></td></tr></table></figure>

<p><strong>优点</strong>：实现简单、快速上手<br><strong>缺点</strong>：</p>
<ul>
<li>检索质量依赖分块策略</li>
<li>无法处理复杂查询</li>
<li>上下文利用率低</li>
</ul>
<h3 id="Advanced-RAG"><a href="#Advanced-RAG" class="headerlink" title="Advanced RAG"></a>Advanced RAG</h3><p>在 Naive RAG 基础上增加预处理和后处理优化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    subgraph 预检索优化</span><br><span class="line">        A[用户问题] --&gt; B[查询改写]</span><br><span class="line">        B --&gt; C[查询扩展]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph 检索优化</span><br><span class="line">        C --&gt; D[多路召回]</span><br><span class="line">        D --&gt; E[重排序Rerank]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph 后处理优化</span><br><span class="line">        E --&gt; F[上下文压缩]</span><br><span class="line">        F --&gt; G[LLM生成]</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>

<p><strong>核心优化点</strong>：</p>
<table>
<thead>
<tr>
<th>优化阶段</th>
<th>技术</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>预检索</td>
<td>Query Rewriting</td>
<td>重写用户问题提升检索效果</td>
</tr>
<tr>
<td>预检索</td>
<td>HyDE</td>
<td>生成假设文档进行检索</td>
</tr>
<tr>
<td>检索</td>
<td>Hybrid Search</td>
<td>向量 + BM25 混合检索</td>
</tr>
<tr>
<td>检索</td>
<td>Reranking</td>
<td>使用交叉编码器重排</td>
</tr>
<tr>
<td>后检索</td>
<td>Context Compression</td>
<td>压缩冗余上下文</td>
</tr>
<tr>
<td>后检索</td>
<td>Self-RAG</td>
<td>自我反思与校验</td>
</tr>
</tbody></table>
<h3 id="Modular-RAG"><a href="#Modular-RAG" class="headerlink" title="Modular RAG"></a>Modular RAG</h3><p>将 RAG 拆解为可插拔模块，支持灵活组合：</p>
<table>
<thead>
<tr>
<th>模块类型</th>
<th>可选组件</th>
</tr>
</thead>
<tbody><tr>
<td>索引模块</td>
<td>层次索引、知识图谱索引、摘要索引</td>
</tr>
<tr>
<td>检索模块</td>
<td>稀疏检索、稠密检索、混合检索</td>
</tr>
<tr>
<td>重排模块</td>
<td>Cross-Encoder、ColBERT、LLM Rerank</td>
</tr>
<tr>
<td>生成模块</td>
<td>单次生成、迭代优化、多步推理</td>
</tr>
</tbody></table>
<h2 id="主流-RAG-框架对比"><a href="#主流-RAG-框架对比" class="headerlink" title="主流 RAG 框架对比"></a>主流 RAG 框架对比</h2><h3 id="Python-生态"><a href="#Python-生态" class="headerlink" title="Python 生态"></a>Python 生态</h3><table>
<thead>
<tr>
<th>框架</th>
<th>特点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td><strong>LangChain</strong></td>
<td>功能全面、生态丰富</td>
<td>通用 RAG 开发</td>
</tr>
<tr>
<td><strong>LlamaIndex</strong></td>
<td>专注数据索引与检索</td>
<td>复杂文档场景</td>
</tr>
<tr>
<td><strong>Haystack</strong></td>
<td>模块化设计、企业级</td>
<td>生产环境</td>
</tr>
<tr>
<td><strong>RAGFlow</strong></td>
<td>开箱即用、可视化</td>
<td>快速部署</td>
</tr>
</tbody></table>
<h3 id="Java-生态"><a href="#Java-生态" class="headerlink" title="Java 生态"></a>Java 生态</h3><table>
<thead>
<tr>
<th>框架</th>
<th>特点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Spring AI</strong></td>
<td>Spring 生态集成</td>
<td>Spring Boot 项目</td>
</tr>
<tr>
<td><strong>LangChain4j</strong></td>
<td>功能对标 LangChain</td>
<td>Java 全栈开发</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Spring AI RAG 示例</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RagService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VectorStore vectorStore;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">query</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 向量检索</span></span><br><span class="line">        List&lt;Document&gt; docs = vectorStore.similaritySearch(</span><br><span class="line">            SearchRequest.query(question).withTopK(<span class="number">5</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 构建上下文</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">context</span> <span class="operator">=</span> docs.stream()</span><br><span class="line">            .map(Document::getContent)</span><br><span class="line">            .collect(Collectors.joining(<span class="string">&quot;\n\n&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 调用 LLM</span></span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .system(<span class="string">&quot;基于以下上下文回答问题：\n&quot;</span> + context)</span><br><span class="line">            .user(question)</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Embedding-模型对比"><a href="#Embedding-模型对比" class="headerlink" title="Embedding 模型对比"></a>Embedding 模型对比</h2><table>
<thead>
<tr>
<th>模型</th>
<th>厂商</th>
<th>维度</th>
<th>中文支持</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>text-embedding-3-large</td>
<td>OpenAI</td>
<td>3072</td>
<td>一般</td>
<td>综合能力强</td>
</tr>
<tr>
<td>text-embedding-3-small</td>
<td>OpenAI</td>
<td>1536</td>
<td>一般</td>
<td>性价比高</td>
</tr>
<tr>
<td>BGE-large-zh</td>
<td>BAAI</td>
<td>1024</td>
<td>⭐⭐⭐</td>
<td>中文首选</td>
</tr>
<tr>
<td>M3E-base</td>
<td>Moka</td>
<td>768</td>
<td>⭐⭐⭐</td>
<td>轻量中文模型</td>
</tr>
<tr>
<td>bge-m3</td>
<td>BAAI</td>
<td>1024</td>
<td>⭐⭐⭐</td>
<td>多语言、多粒度</td>
</tr>
<tr>
<td>jina-embeddings-v2</td>
<td>Jina AI</td>
<td>768</td>
<td>⭐⭐</td>
<td>长文本支持</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>💡 提示: 选型建议</strong></p>
<ul>
<li>中文场景优先使用 <strong>BGE</strong> 或 <strong>M3E</strong></li>
<li>多语言场景使用 <strong>bge-m3</strong></li>
<li>追求效果使用 <strong>OpenAI text-embedding-3-large</strong></li>
</ul>
</blockquote>
<h2 id="向量数据库对比"><a href="#向量数据库对比" class="headerlink" title="向量数据库对比"></a>向量数据库对比</h2><table>
<thead>
<tr>
<th>数据库</th>
<th>类型</th>
<th>特点</th>
<th>推荐场景</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Milvus</strong></td>
<td>开源</td>
<td>高性能、分布式、功能全面</td>
<td>生产环境首选</td>
</tr>
<tr>
<td><strong>Pinecone</strong></td>
<td>托管</td>
<td>零运维、简单易用</td>
<td>快速原型、小团队</td>
</tr>
<tr>
<td><strong>Chroma</strong></td>
<td>开源</td>
<td>轻量嵌入式、开发友好</td>
<td>本地开发、测试</td>
</tr>
<tr>
<td><strong>Weaviate</strong></td>
<td>开源</td>
<td>GraphQL、模块化</td>
<td>复杂查询场景</td>
</tr>
<tr>
<td><strong>Qdrant</strong></td>
<td>开源</td>
<td>Rust 实现、高性能</td>
<td>高并发场景</td>
</tr>
<tr>
<td><strong>pgvector</strong></td>
<td>插件</td>
<td>PostgreSQL 扩展</td>
<td>已有 PG 环境</td>
</tr>
</tbody></table>
<h2 id="检索策略对比"><a href="#检索策略对比" class="headerlink" title="检索策略对比"></a>检索策略对比</h2><table>
<thead>
<tr>
<th>策略</th>
<th>原理</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td><strong>稀疏检索（BM25）</strong></td>
<td>词频统计</td>
<td>精确匹配、可解释</td>
<td>语义理解弱</td>
</tr>
<tr>
<td><strong>稠密检索（向量）</strong></td>
<td>语义相似度</td>
<td>语义理解强</td>
<td>可能丢失关键词</td>
</tr>
<tr>
<td><strong>混合检索</strong></td>
<td>两者融合</td>
<td>兼顾精确与语义</td>
<td>需要调权重</td>
</tr>
<tr>
<td><strong>多向量检索</strong></td>
<td>段落+摘要多向量</td>
<td>多粒度匹配</td>
<td>索引膨胀</td>
</tr>
</tbody></table>
<h3 id="混合检索示例"><a href="#混合检索示例" class="headerlink" title="混合检索示例"></a>混合检索示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.retrievers <span class="keyword">import</span> EnsembleRetriever</span><br><span class="line"><span class="keyword">from</span> langchain_community.retrievers <span class="keyword">import</span> BM25Retriever</span><br><span class="line"></span><br><span class="line"><span class="comment"># BM25 稀疏检索</span></span><br><span class="line">bm25_retriever = BM25Retriever.from_documents(documents)</span><br><span class="line">bm25_retriever.k = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量稠密检索</span></span><br><span class="line">vector_retriever = vectorstore.as_retriever(search_kwargs=&#123;<span class="string">&quot;k&quot;</span>: <span class="number">5</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 混合检索（权重 0.5:0.5）</span></span><br><span class="line">ensemble_retriever = EnsembleRetriever(</span><br><span class="line">    retrievers=[bm25_retriever, vector_retriever],</span><br><span class="line">    weights=[<span class="number">0.5</span>, <span class="number">0.5</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="文本分割策略"><a href="#文本分割策略" class="headerlink" title="文本分割策略"></a>文本分割策略</h2><table>
<thead>
<tr>
<th>策略</th>
<th>说明</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>固定长度分割</td>
<td>按字符数切分</td>
<td>简单文本</td>
</tr>
<tr>
<td>递归字符分割</td>
<td>按分隔符层次切分</td>
<td>通用文档</td>
</tr>
<tr>
<td>语义分割</td>
<td>按语义边界切分</td>
<td>高质量要求</td>
</tr>
<tr>
<td>文档结构分割</td>
<td>按标题&#x2F;章节切分</td>
<td>结构化文档</td>
</tr>
<tr>
<td>父子块策略</td>
<td>小块检索、大块返回</td>
<td>上下文完整性</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>⚠️ 重要: 分块要点</strong></p>
<ul>
<li><strong>Chunk Size</strong>：通常 500-1000 字符</li>
<li><strong>Overlap</strong>：建议 10%-20% 重叠</li>
<li><strong>保持语义完整</strong>：避免句子被切断</li>
</ul>
</blockquote>
<h2 id="评估指标"><a href="#评估指标" class="headerlink" title="评估指标"></a>评估指标</h2><h3 id="检索质量"><a href="#检索质量" class="headerlink" title="检索质量"></a>检索质量</h3><table>
<thead>
<tr>
<th>指标</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Recall@K</td>
<td>Top-K 中包含正确文档的比例</td>
</tr>
<tr>
<td>MRR</td>
<td>正确文档排名的倒数均值</td>
</tr>
<tr>
<td>NDCG</td>
<td>归一化折损累积增益</td>
</tr>
</tbody></table>
<h3 id="生成质量"><a href="#生成质量" class="headerlink" title="生成质量"></a>生成质量</h3><table>
<thead>
<tr>
<th>指标</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Faithfulness</td>
<td>答案是否忠于检索内容</td>
</tr>
<tr>
<td>Answer Relevancy</td>
<td>答案与问题的相关性</td>
</tr>
<tr>
<td>Context Precision</td>
<td>上下文的精确率</td>
</tr>
<tr>
<td>Context Recall</td>
<td>上下文的召回率</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>📝 注意: RAGAS 框架</strong><br>推荐使用 <strong>RAGAS</strong> 进行端到端 RAG 评估，支持自动化评估上述指标</p>
</blockquote>
<h2 id="常见问题与优化"><a href="#常见问题与优化" class="headerlink" title="常见问题与优化"></a>常见问题与优化</h2><table>
<thead>
<tr>
<th>问题</th>
<th>原因</th>
<th>解决方案</th>
</tr>
</thead>
<tbody><tr>
<td>检索不到相关文档</td>
<td>查询与文档语义差距大</td>
<td>查询改写、HyDE</td>
</tr>
<tr>
<td>检索到但排名低</td>
<td>向量相似度不准</td>
<td>添加 Reranker</td>
</tr>
<tr>
<td>上下文超长</td>
<td>检索文档过多</td>
<td>上下文压缩、摘要</td>
</tr>
<tr>
<td>回答不准确</td>
<td>噪声文档干扰</td>
<td>提高检索阈值、过滤</td>
</tr>
<tr>
<td>无法回答最新问题</td>
<td>知识库未更新</td>
<td>增量索引更新</td>
</tr>
</tbody></table>
<h2 id="相关笔记"><a href="#相关笔记" class="headerlink" title="相关笔记"></a>相关笔记</h2><ul>
<li>大模型学习路线</li>
<li>LLM应用开发</li>
<li>Prompt Engineering详解</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/Agent%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="一个来自于 AI+Obsidian 的知识库">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/Agent%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Agent架构模式详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">大模型</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Agent-架构模式详解"><a href="#Agent-架构模式详解" class="headerlink" title="Agent 架构模式详解"></a>Agent 架构模式详解</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>AI Agent（智能体）</strong> 是能够自主感知环境、做出决策并执行行动的 AI 系统。与普通的 LLM 对话不同，Agent 能够调用外部工具、访问数据库、执行代码，真正完成任务。</p>
<blockquote>
<p><strong>💡 提示: 核心区别</strong><br><strong>普通 LLM</strong>：只能生成文本<br><strong>Agent</strong>：能思考 + 行动 + 获取反馈 + 继续思考</p>
</blockquote>
<h2 id="Agent-核心组件"><a href="#Agent-核心组件" class="headerlink" title="Agent 核心组件"></a>Agent 核心组件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    subgraph Agent</span><br><span class="line">        A[LLM 大脑] --&gt; B[规划模块]</span><br><span class="line">        A --&gt; C[记忆模块]</span><br><span class="line">        A --&gt; D[工具模块]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    D --&gt; E[搜索工具]</span><br><span class="line">    D --&gt; F[代码执行]</span><br><span class="line">    D --&gt; G[数据库]</span><br><span class="line">    D --&gt; H[API调用]</span><br><span class="line">    </span><br><span class="line">    C --&gt; I[短期记忆]</span><br><span class="line">    C --&gt; J[长期记忆]</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>组件</th>
<th>功能</th>
<th>技术实现</th>
</tr>
</thead>
<tbody><tr>
<td><strong>LLM 大脑</strong></td>
<td>理解、推理、决策</td>
<td>GPT-4、Claude、通义千问</td>
</tr>
<tr>
<td><strong>规划模块</strong></td>
<td>任务分解、执行策略</td>
<td>ReAct、Plan-and-Execute</td>
</tr>
<tr>
<td><strong>记忆模块</strong></td>
<td>存储上下文、历史经验</td>
<td>向量数据库、Redis</td>
</tr>
<tr>
<td><strong>工具模块</strong></td>
<td>与外部世界交互</td>
<td>Function Calling</td>
</tr>
</tbody></table>
<hr>
<h2 id="一、ReAct-模式"><a href="#一、ReAct-模式" class="headerlink" title="一、ReAct 模式"></a>一、ReAct 模式</h2><h3 id="1-1-核心思想"><a href="#1-1-核心思想" class="headerlink" title="1.1 核心思想"></a>1.1 核心思想</h3><p><strong>ReAct &#x3D; Reasoning（推理） + Acting（行动）</strong></p>
<p>交替进行思考和行动，每一步都根据上一步的结果决定下一步。</p>
<h3 id="1-2-执行流程"><a href="#1-2-执行流程" class="headerlink" title="1.2 执行流程"></a>1.2 执行流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[用户问题] --&gt; B[Thought: 我需要做什么?]</span><br><span class="line">    B --&gt; C[Action: 调用工具]</span><br><span class="line">    C --&gt; D[Observation: 观察结果]</span><br><span class="line">    D --&gt; E&#123;任务完成?&#125;</span><br><span class="line">    E --&gt;|否| B</span><br><span class="line">    E --&gt;|是| F[Final Answer: 最终回答]</span><br></pre></td></tr></table></figure>

<h3 id="1-3-Prompt-模板"><a href="#1-3-Prompt-模板" class="headerlink" title="1.3 Prompt 模板"></a>1.3 Prompt 模板</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">你是一个能使用工具的 AI 助手。</span><br><span class="line"></span><br><span class="line">可用工具：</span><br><span class="line">1. search(query) - 搜索网络信息</span><br><span class="line">2. calculator(expression) - 计算数学表达式</span><br><span class="line">3. get_weather(city) - 获取城市天气</span><br><span class="line">4. run_code(code) - 执行 Python 代码</span><br><span class="line"></span><br><span class="line">请严格按照以下格式回答：</span><br><span class="line"></span><br><span class="line">Thought: 思考当前应该做什么</span><br><span class="line">Action: 工具名称</span><br><span class="line">Action Input: 工具参数（JSON格式）</span><br><span class="line">Observation: [系统返回工具执行结果]</span><br><span class="line"></span><br><span class="line">...（重复 Thought/Action/Observation 直到任务完成）</span><br><span class="line"></span><br><span class="line">Thought: 我已经获得了足够的信息</span><br><span class="line">Final Answer: 最终答案</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">- 每次只能调用一个工具</span><br><span class="line">- 必须等待 Observation 后再继续思考</span><br><span class="line">- 不要编造 Observation，等待系统返回</span><br><span class="line"></span><br><span class="line">用户问题：&#123;question&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-执行示例"><a href="#1-4-执行示例" class="headerlink" title="1.4 执行示例"></a>1.4 执行示例</h3><p><strong>用户问</strong>：”帮我查一下上海今天的天气，如果气温超过30度，帮我计算需要喝多少水（体重70kg，每公斤40ml）”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Thought: 我需要先查询上海的天气，获取温度信息</span><br><span class="line">Action: get_weather</span><br><span class="line">Action Input: &#123;&quot;city&quot;: &quot;上海&quot;&#125;</span><br><span class="line">Observation: &#123;&quot;city&quot;: &quot;上海&quot;, &quot;temperature&quot;: 35, &quot;humidity&quot;: 75, &quot;condition&quot;: &quot;晴&quot;&#125;</span><br><span class="line"></span><br><span class="line">Thought: 上海气温35度，超过30度了。现在我需要计算喝水量：70kg × 40ml = 2800ml</span><br><span class="line">Action: calculator</span><br><span class="line">Action Input: &#123;&quot;expression&quot;: &quot;70 * 40&quot;&#125;</span><br><span class="line">Observation: 2800</span><br><span class="line"></span><br><span class="line">Thought: 我已经获得了所有需要的信息</span><br><span class="line">Final Answer: 上海今天天气晴朗，气温35°C，湿度75%。由于气温超过30度，建议您多补充水分。按照您的体重70kg计算，今天建议饮水量为2800ml（约2.8升）。</span><br></pre></td></tr></table></figure>

<h3 id="1-5-Spring-AI-实现"><a href="#1-5-Spring-AI-实现" class="headerlink" title="1.5 Spring AI 实现"></a>1.5 Spring AI 实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AgentConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatClient <span class="title function_">chatClient</span><span class="params">(ChatClient.Builder builder,</span></span><br><span class="line"><span class="params">                                  WeatherTool weatherTool,</span></span><br><span class="line"><span class="params">                                  CalculatorTool calculatorTool)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> builder</span><br><span class="line">            .defaultSystem(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                你是一个智能助手，可以使用工具来帮助用户。</span></span><br><span class="line"><span class="string">                请仔细分析用户的问题，选择合适的工具来获取信息。</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>)</span><br><span class="line">            .defaultTools(weatherTool, calculatorTool)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherTool</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;获取指定城市的天气信息，返回温度、湿度等&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> WeatherInfo <span class="title function_">getWeather</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@ToolParam(description = &quot;城市名称，如：北京、上海&quot;)</span> String city</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        <span class="comment">// 调用天气 API</span></span><br><span class="line">        <span class="keyword">return</span> weatherApi.query(city);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorTool</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;计算数学表达式，支持加减乘除&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">calculator</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@ToolParam(description = &quot;数学表达式，如：70 * 40&quot;)</span> String expression</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        <span class="type">ScriptEngine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>()</span><br><span class="line">            .getEngineByName(<span class="string">&quot;JavaScript&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ((Number) engine.eval(expression)).doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AgentController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/agent/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestBody</span> String question)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .user(question)</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-6-ReAct-优缺点"><a href="#1-6-ReAct-优缺点" class="headerlink" title="1.6 ReAct 优缺点"></a>1.6 ReAct 优缺点</h3><table>
<thead>
<tr>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>实现简单直观</td>
<td>可能走弯路，效率不高</td>
</tr>
<tr>
<td>灵活性高，可随时调整</td>
<td>复杂任务容易迷失方向</td>
</tr>
<tr>
<td>适合探索性任务</td>
<td>Token 消耗较多</td>
</tr>
<tr>
<td>中间过程可观察</td>
<td>长任务容易超出上下文</td>
</tr>
</tbody></table>
<hr>
<h2 id="二、Plan-and-Execute-模式"><a href="#二、Plan-and-Execute-模式" class="headerlink" title="二、Plan-and-Execute 模式"></a>二、Plan-and-Execute 模式</h2><h3 id="2-1-核心思想"><a href="#2-1-核心思想" class="headerlink" title="2.1 核心思想"></a>2.1 核心思想</h3><p><strong>先规划，后执行</strong>。将复杂任务分解为多个子任务，然后按计划逐步执行。</p>
<h3 id="2-2-执行流程"><a href="#2-2-执行流程" class="headerlink" title="2.2 执行流程"></a>2.2 执行流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[用户问题] --&gt; B[Planner: 分析任务]</span><br><span class="line">    B --&gt; C[生成执行计划]</span><br><span class="line">    C --&gt; D[Executor: 执行步骤1]</span><br><span class="line">    D --&gt; E[Executor: 执行步骤2]</span><br><span class="line">    E --&gt; F[Executor: 执行步骤N]</span><br><span class="line">    F --&gt; G&#123;执行结果符合预期?&#125;</span><br><span class="line">    G --&gt;|否| H[Replanner: 调整计划]</span><br><span class="line">    H --&gt; C</span><br><span class="line">    G --&gt;|是| I[汇总结果]</span><br><span class="line">    I --&gt; J[Final Answer]</span><br></pre></td></tr></table></figure>

<h3 id="2-3-双-Agent-架构"><a href="#2-3-双-Agent-架构" class="headerlink" title="2.3 双 Agent 架构"></a>2.3 双 Agent 架构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    subgraph Planner Agent</span><br><span class="line">        A[任务分析] --&gt; B[计划生成]</span><br><span class="line">        B --&gt; C[计划优化]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph Executor Agent</span><br><span class="line">        D[接收步骤] --&gt; E[执行工具]</span><br><span class="line">        E --&gt; F[返回结果]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    C --&gt; D</span><br><span class="line">    F --&gt; G&#123;需要重新规划?&#125;</span><br><span class="line">    G --&gt;|是| A</span><br><span class="line">    G --&gt;|否| H[完成]</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Planner-Prompt-模板"><a href="#2-4-Planner-Prompt-模板" class="headerlink" title="2.4 Planner Prompt 模板"></a>2.4 Planner Prompt 模板</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">你是一个任务规划专家。请根据用户的问题，制定详细的执行计划。</span><br><span class="line"></span><br><span class="line">## 规划原则</span><br><span class="line">1. 将复杂任务分解为简单的子步骤</span><br><span class="line">2. 每个步骤应该是原子性的、可执行的</span><br><span class="line">3. 步骤之间要有清晰的依赖关系</span><br><span class="line">4. 考虑可能的失败情况和备选方案</span><br><span class="line"></span><br><span class="line">## 可用工具</span><br><span class="line">- search(query): 搜索网络信息</span><br><span class="line">- read_file(path): 读取文件内容</span><br><span class="line">- write_file(path, content): 写入文件</span><br><span class="line">- run_code(language, code): 执行代码</span><br><span class="line">- api_call(url, method, data): 调用 API</span><br><span class="line"></span><br><span class="line">## 输出格式</span><br><span class="line">请以 JSON 格式输出计划：</span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;goal&quot;: &quot;任务目标描述&quot;,</span><br><span class="line">  &quot;steps&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;id&quot;: 1,</span><br><span class="line">      &quot;description&quot;: &quot;步骤描述&quot;,</span><br><span class="line">      &quot;tool&quot;: &quot;工具名称&quot;,</span><br><span class="line">      &quot;params&quot;: &#123;&quot;参数&quot;: &quot;值&quot;&#125;,</span><br><span class="line">      &quot;depends_on&quot;: [],</span><br><span class="line">      &quot;expected_output&quot;: &quot;预期输出&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;success_criteria&quot;: &quot;成功标准&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用户问题：{question}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 2.5 执行示例</span><br><span class="line"></span><br><span class="line">**用户问**：&quot;帮我调研 Spring AI 框架，写一份技术选型报告&quot;</span><br><span class="line"></span><br><span class="line">#### Planner 输出</span><br><span class="line"></span><br><span class="line">```json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;goal&quot;: &quot;完成 Spring AI 框架技术选型报告&quot;,</span><br><span class="line">  &quot;steps&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;id&quot;: 1,</span><br><span class="line">      &quot;description&quot;: &quot;搜索 Spring AI 官方文档和基本介绍&quot;,</span><br><span class="line">      &quot;tool&quot;: &quot;search&quot;,</span><br><span class="line">      &quot;params&quot;: &#123;&quot;query&quot;: &quot;Spring AI official documentation introduction&quot;&#125;,</span><br><span class="line">      &quot;depends_on&quot;: [],</span><br><span class="line">      &quot;expected_output&quot;: &quot;Spring AI 基本概念和特性&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;id&quot;: 2,</span><br><span class="line">      &quot;description&quot;: &quot;搜索 Spring AI 最新版本和更新内容&quot;,</span><br><span class="line">      &quot;tool&quot;: &quot;search&quot;,</span><br><span class="line">      &quot;params&quot;: &#123;&quot;query&quot;: &quot;Spring AI latest version features 2024&quot;&#125;,</span><br><span class="line">      &quot;depends_on&quot;: [],</span><br><span class="line">      &quot;expected_output&quot;: &quot;版本信息和新特性&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;id&quot;: 3,</span><br><span class="line">      &quot;description&quot;: &quot;搜索 Spring AI 与 LangChain4j 对比&quot;,</span><br><span class="line">      &quot;tool&quot;: &quot;search&quot;,</span><br><span class="line">      &quot;params&quot;: &#123;&quot;query&quot;: &quot;Spring AI vs LangChain4j comparison&quot;&#125;,</span><br><span class="line">      &quot;depends_on&quot;: [],</span><br><span class="line">      &quot;expected_output&quot;: &quot;框架对比分析&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;id&quot;: 4,</span><br><span class="line">      &quot;description&quot;: &quot;搜索 Spring AI 实际应用案例&quot;,</span><br><span class="line">      &quot;tool&quot;: &quot;search&quot;,</span><br><span class="line">      &quot;params&quot;: &#123;&quot;query&quot;: &quot;Spring AI production use cases&quot;&#125;,</span><br><span class="line">      &quot;depends_on&quot;: [],</span><br><span class="line">      &quot;expected_output&quot;: &quot;企业应用案例&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;id&quot;: 5,</span><br><span class="line">      &quot;description&quot;: &quot;整合所有信息，生成技术选型报告&quot;,</span><br><span class="line">      &quot;tool&quot;: &quot;generate_report&quot;,</span><br><span class="line">      &quot;params&quot;: &#123;&quot;template&quot;: &quot;tech_selection&quot;&#125;,</span><br><span class="line">      &quot;depends_on&quot;: [1, 2, 3, 4],</span><br><span class="line">      &quot;expected_output&quot;: &quot;完整的技术选型报告&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;success_criteria&quot;: &quot;报告包含框架介绍、特性分析、对比评估、应用建议&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Executor-执行"><a href="#Executor-执行" class="headerlink" title="Executor 执行"></a>Executor 执行</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">=== 执行步骤 1-4（可并行）===</span><br><span class="line">Step 1 结果: Spring AI 是 Spring 官方的 AI 集成框架...</span><br><span class="line">Step 2 结果: 最新版本 1.0.0，支持多种模型提供商...</span><br><span class="line">Step 3 结果: Spring AI 更注重 Spring 生态集成...</span><br><span class="line">Step 4 结果: 某电商公司使用 Spring AI 构建智能客服...</span><br><span class="line"></span><br><span class="line">=== 执行步骤 5 ===</span><br><span class="line">[生成完整报告]</span><br></pre></td></tr></table></figure>

<h3 id="2-6-Java-实现框架"><a href="#2-6-Java-实现框架" class="headerlink" title="2.6 Java 实现框架"></a>2.6 Java 实现框架</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PlanAndExecuteAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient plannerClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient executorClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ToolRegistry toolRegistry;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">execute</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 生成计划</span></span><br><span class="line">        <span class="type">Plan</span> <span class="variable">plan</span> <span class="operator">=</span> generatePlan(question);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 执行计划</span></span><br><span class="line">        Map&lt;Integer, StepResult&gt; results = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Step step : plan.getSteps()) &#123;</span><br><span class="line">            <span class="comment">// 检查依赖是否完成</span></span><br><span class="line">            <span class="keyword">if</span> (!checkDependencies(step, results)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 执行步骤</span></span><br><span class="line">            <span class="type">StepResult</span> <span class="variable">result</span> <span class="operator">=</span> executeStep(step, results);</span><br><span class="line">            results.put(step.getId(), result);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 检查是否需要重新规划</span></span><br><span class="line">            <span class="keyword">if</span> (result.needsReplan()) &#123;</span><br><span class="line">                plan = replan(question, plan, results);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 汇总结果</span></span><br><span class="line">        <span class="keyword">return</span> summarize(question, results);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Plan <span class="title function_">generatePlan</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> plannerClient.prompt()</span><br><span class="line">            .system(PLANNER_PROMPT)</span><br><span class="line">            .user(question)</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">        <span class="keyword">return</span> parseJson(response, Plan.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> StepResult <span class="title function_">executeStep</span><span class="params">(Step step, Map&lt;Integer, StepResult&gt; context)</span> &#123;</span><br><span class="line">        <span class="type">Tool</span> <span class="variable">tool</span> <span class="operator">=</span> toolRegistry.get(step.getTool());</span><br><span class="line">        <span class="keyword">return</span> tool.execute(step.getParams(), context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Plan</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String goal;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Step&gt; steps;</span><br><span class="line">    <span class="keyword">private</span> String successCriteria;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Step</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> String tool;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; params;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; dependsOn;</span><br><span class="line">    <span class="keyword">private</span> String expectedOutput;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-7-Plan-and-Execute-优缺点"><a href="#2-7-Plan-and-Execute-优缺点" class="headerlink" title="2.7 Plan-and-Execute 优缺点"></a>2.7 Plan-and-Execute 优缺点</h3><table>
<thead>
<tr>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>全局视角，不易迷失</td>
<td>初始规划可能不够准确</td>
</tr>
<tr>
<td>可并行执行独立步骤</td>
<td>需要额外的规划开销</td>
</tr>
<tr>
<td>复杂任务效率高</td>
<td>灵活性相对较低</td>
</tr>
<tr>
<td>易于追踪和调试</td>
<td>实现复杂度较高</td>
</tr>
</tbody></table>
<hr>
<h2 id="三、其他-Agent-模式"><a href="#三、其他-Agent-模式" class="headerlink" title="三、其他 Agent 模式"></a>三、其他 Agent 模式</h2><h3 id="3-1-Reflexion（反思模式）"><a href="#3-1-Reflexion（反思模式）" class="headerlink" title="3.1 Reflexion（反思模式）"></a>3.1 Reflexion（反思模式）</h3><p><strong>核心思想</strong>：执行后进行自我反思，从错误中学习。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[执行任务] --&gt; B[评估结果]</span><br><span class="line">    B --&gt; C&#123;成功?&#125;</span><br><span class="line">    C --&gt;|是| D[完成]</span><br><span class="line">    C --&gt;|否| E[反思: 为什么失败?]</span><br><span class="line">    E --&gt; F[总结经验教训]</span><br><span class="line">    F --&gt; G[改进策略]</span><br><span class="line">    G --&gt; A</span><br></pre></td></tr></table></figure>

<p><strong>Prompt 示例</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">## 任务</span><br><span class="line">&#123;task&#125;</span><br><span class="line"></span><br><span class="line">## 上次尝试</span><br><span class="line">&#123;previous_attempt&#125;</span><br><span class="line"></span><br><span class="line">## 执行结果</span><br><span class="line">&#123;result&#125;</span><br><span class="line"></span><br><span class="line">## 反思</span><br><span class="line">请分析上次尝试为什么没有达到预期效果：</span><br><span class="line">1. 哪些步骤是正确的？</span><br><span class="line">2. 哪些步骤需要改进？</span><br><span class="line">3. 有什么遗漏的信息？</span><br><span class="line"></span><br><span class="line">## 改进计划</span><br><span class="line">基于反思，制定新的执行计划：</span><br></pre></td></tr></table></figure>

<h3 id="3-2-LATS（Language-Agent-Tree-Search）"><a href="#3-2-LATS（Language-Agent-Tree-Search）" class="headerlink" title="3.2 LATS（Language Agent Tree Search）"></a>3.2 LATS（Language Agent Tree Search）</h3><p><strong>核心思想</strong>：结合蒙特卡洛树搜索（MCTS），探索多个执行路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[根节点: 问题] --&gt; B[方案A]</span><br><span class="line">    A --&gt; C[方案B]</span><br><span class="line">    A --&gt; D[方案C]</span><br><span class="line">    B --&gt; E[A1]</span><br><span class="line">    B --&gt; F[A2]</span><br><span class="line">    C --&gt; G[B1]</span><br><span class="line">    C --&gt; H[B2]</span><br><span class="line">    </span><br><span class="line">    style E fill:#90EE90</span><br><span class="line">    style H fill:#90EE90</span><br></pre></td></tr></table></figure>

<p><strong>执行流程</strong>：</p>
<ol>
<li><strong>选择</strong>：选择最有希望的节点</li>
<li><strong>扩展</strong>：生成可能的下一步</li>
<li><strong>模拟</strong>：模拟执行到结束</li>
<li><strong>回溯</strong>：更新路径上节点的评分</li>
</ol>
<h3 id="3-3-Multi-Agent（多智能体）"><a href="#3-3-Multi-Agent（多智能体）" class="headerlink" title="3.3 Multi-Agent（多智能体）"></a>3.3 Multi-Agent（多智能体）</h3><p><strong>核心思想</strong>：多个专业 Agent 协作完成任务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    A[用户问题] --&gt; B[Orchestrator]</span><br><span class="line">    B --&gt; C[Research Agent]</span><br><span class="line">    B --&gt; D[Coding Agent]</span><br><span class="line">    B --&gt; E[Review Agent]</span><br><span class="line">    C --&gt; F[搜索/阅读]</span><br><span class="line">    D --&gt; G[编写代码]</span><br><span class="line">    E --&gt; H[代码审查]</span><br><span class="line">    F --&gt; B</span><br><span class="line">    G --&gt; B</span><br><span class="line">    H --&gt; B</span><br><span class="line">    B --&gt; I[最终结果]</span><br></pre></td></tr></table></figure>

<p><strong>角色分工示例</strong>：</p>
<table>
<thead>
<tr>
<th>Agent</th>
<th>职责</th>
<th>工具</th>
</tr>
</thead>
<tbody><tr>
<td>Orchestrator</td>
<td>任务分发、结果汇总</td>
<td>无</td>
</tr>
<tr>
<td>Research Agent</td>
<td>信息收集、调研</td>
<td>search、read_url</td>
</tr>
<tr>
<td>Coding Agent</td>
<td>代码编写</td>
<td>code_interpreter</td>
</tr>
<tr>
<td>Review Agent</td>
<td>代码审查、质量检查</td>
<td>static_analysis</td>
</tr>
<tr>
<td>Test Agent</td>
<td>编写和运行测试</td>
<td>test_runner</td>
</tr>
</tbody></table>
<p><strong>Spring AI 多 Agent 实现</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiAgentOrchestrator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Agent&gt; agents;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">orchestrate</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 分析任务，确定需要哪些 Agent</span></span><br><span class="line">        List&lt;AgentTask&gt; agentTasks = analyzeTask(task);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 分发任务给各 Agent</span></span><br><span class="line">        Map&lt;String, CompletableFuture&lt;String&gt;&gt; futures = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (AgentTask agentTask : agentTasks) &#123;</span><br><span class="line">            <span class="type">Agent</span> <span class="variable">agent</span> <span class="operator">=</span> agents.get(agentTask.getAgentType());</span><br><span class="line">            futures.put(agentTask.getId(), </span><br><span class="line">                CompletableFuture.supplyAsync(() -&gt; </span><br><span class="line">                    agent.execute(agentTask.getPrompt())</span><br><span class="line">                )</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 收集结果</span></span><br><span class="line">        Map&lt;String, String&gt; results = futures.entrySet().stream()</span><br><span class="line">            .collect(Collectors.toMap(</span><br><span class="line">                Map.Entry::getKey,</span><br><span class="line">                e -&gt; e.getValue().join()</span><br><span class="line">            ));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 汇总生成最终答案</span></span><br><span class="line">        <span class="keyword">return</span> synthesize(task, results);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Agent</span> &#123;</span><br><span class="line">    String <span class="title function_">execute</span><span class="params">(String prompt)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(&quot;research&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResearchAgent</span> <span class="keyword">implements</span> <span class="title class_">Agent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SearchTool searchTool;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">execute</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .system(<span class="string">&quot;你是一个研究专家，善于收集和整理信息&quot;</span>)</span><br><span class="line">            .user(prompt)</span><br><span class="line">            .tools(searchTool)</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-AutoGPT-模式"><a href="#3-4-AutoGPT-模式" class="headerlink" title="3.4 AutoGPT 模式"></a>3.4 AutoGPT 模式</h3><p><strong>核心思想</strong>：全自动任务执行，最少人工干预。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">目标：&#123;goal&#125;</span><br><span class="line"></span><br><span class="line">约束：</span><br><span class="line">1. 每次只能执行一个动作</span><br><span class="line">2. 必须在 10 步内完成</span><br><span class="line">3. 遇到不确定时询问用户</span><br><span class="line"></span><br><span class="line">当前状态：&#123;current_state&#125;</span><br><span class="line">已完成步骤：&#123;completed_steps&#125;</span><br><span class="line">可用工具：&#123;tools&#125;</span><br><span class="line"></span><br><span class="line">请决定下一步动作：</span><br><span class="line">1. 思考当前进度</span><br><span class="line">2. 选择下一个动作</span><br><span class="line">3. 执行并观察结果</span><br><span class="line">4. 判断是否完成目标</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四、模式选择指南"><a href="#四、模式选择指南" class="headerlink" title="四、模式选择指南"></a>四、模式选择指南</h2><h3 id="4-1-场景匹配"><a href="#4-1-场景匹配" class="headerlink" title="4.1 场景匹配"></a>4.1 场景匹配</h3><table>
<thead>
<tr>
<th>场景</th>
<th>推荐模式</th>
<th>原因</th>
</tr>
</thead>
<tbody><tr>
<td>简单问答 + 单工具</td>
<td>ReAct</td>
<td>直接高效</td>
</tr>
<tr>
<td>多步骤复杂任务</td>
<td>Plan-and-Execute</td>
<td>需要全局规划</td>
</tr>
<tr>
<td>需要试错的任务</td>
<td>Reflexion</td>
<td>从错误中学习</td>
</tr>
<tr>
<td>有多种解决方案</td>
<td>LATS</td>
<td>探索最优路径</td>
</tr>
<tr>
<td>大型复杂项目</td>
<td>Multi-Agent</td>
<td>专业分工协作</td>
</tr>
</tbody></table>
<h3 id="4-2-决策流程图"><a href="#4-2-决策流程图" class="headerlink" title="4.2 决策流程图"></a>4.2 决策流程图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[任务类型?] --&gt; B&#123;单步骤?&#125;</span><br><span class="line">    B --&gt;|是| C[直接调用 LLM]</span><br><span class="line">    B --&gt;|否| D&#123;步骤数量?&#125;</span><br><span class="line">    D --&gt;|2-5步| E[ReAct]</span><br><span class="line">    D --&gt;|5+步| F&#123;需要并行?&#125;</span><br><span class="line">    F --&gt;|是| G[Plan-and-Execute]</span><br><span class="line">    F --&gt;|否| H&#123;可能失败?&#125;</span><br><span class="line">    H --&gt;|是| I[Reflexion]</span><br><span class="line">    H --&gt;|否| E</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五、最佳实践"><a href="#五、最佳实践" class="headerlink" title="五、最佳实践"></a>五、最佳实践</h2><h3 id="5-1-工具设计原则"><a href="#5-1-工具设计原则" class="headerlink" title="5.1 工具设计原则"></a>5.1 工具设计原则</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 好的工具设计</span></span><br><span class="line"><span class="meta">@Tool(description = &quot;搜索指定城市的天气信息，返回温度（摄氏度）、湿度、天气状况&quot;)</span></span><br><span class="line"><span class="keyword">public</span> WeatherInfo <span class="title function_">getWeather</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@ToolParam(description = &quot;城市名称，支持中文，如：北京、上海&quot;)</span> </span></span><br><span class="line"><span class="params">    String city</span></span><br><span class="line"><span class="params">)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 不好的工具设计</span></span><br><span class="line"><span class="meta">@Tool(description = &quot;获取天气&quot;)</span>  <span class="comment">// 描述太模糊</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">weather</span><span class="params">(String c)</span> &#123; ... &#125;  <span class="comment">// 参数名不清晰</span></span><br></pre></td></tr></table></figure>

<p><strong>工具设计要点</strong>：</p>
<ul>
<li>描述清晰，包含输入输出说明</li>
<li>参数命名有意义</li>
<li>返回类型明确</li>
<li>单一职责</li>
</ul>
<h3 id="5-2-记忆管理"><a href="#5-2-记忆管理" class="headerlink" title="5.2 记忆管理"></a>5.2 记忆管理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AgentMemory</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VectorStore vectorStore;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Message&gt; shortTermMemory = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 短期记忆：当前对话</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addToShortTerm</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">        shortTermMemory.add(message);</span><br><span class="line">        <span class="comment">// 保持最近 N 条</span></span><br><span class="line">        <span class="keyword">if</span> (shortTermMemory.size() &gt; MAX_SHORT_TERM) &#123;</span><br><span class="line">            summarizeAndArchive();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 长期记忆：向量存储</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addToLongTerm</span><span class="params">(String content, Map&lt;String, Object&gt; metadata)</span> &#123;</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>(content, metadata);</span><br><span class="line">        vectorStore.add(List.of(doc));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检索相关记忆</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">recall</span><span class="params">(String query, <span class="type">int</span> topK)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vectorStore.similaritySearch(</span><br><span class="line">            SearchRequest.query(query).withTopK(topK)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-错误处理"><a href="#5-3-错误处理" class="headerlink" title="5.3 错误处理"></a>5.3 错误处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Tool(description = &quot;执行网络搜索&quot;)</span></span><br><span class="line"><span class="keyword">public</span> SearchResult <span class="title function_">search</span><span class="params">(String query)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> searchApi.search(query);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RateLimitException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> SearchResult.error(<span class="string">&quot;搜索服务繁忙，请稍后重试&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NetworkException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> SearchResult.error(<span class="string">&quot;网络连接失败，请检查网络&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;搜索异常&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> SearchResult.error(<span class="string">&quot;搜索失败：&quot;</span> + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-监控与追踪"><a href="#5-4-监控与追踪" class="headerlink" title="5.4 监控与追踪"></a>5.4 监控与追踪</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AgentTracingAspect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(Tool)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">traceToolCall</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">toolName</span> <span class="operator">=</span> pjp.getSignature().getName();</span><br><span class="line">        Object[] args = pjp.getArgs();</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">            log.info(<span class="string">&quot;Tool: &#123;&#125;, Args: &#123;&#125;, Result: &#123;&#125;, Time: &#123;&#125;ms&quot;</span>,</span><br><span class="line">                toolName, args, result, System.currentTimeMillis() - start);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Tool: &#123;&#125; failed&quot;</span>, toolName, e);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="六、实战项目"><a href="#六、实战项目" class="headerlink" title="六、实战项目"></a>六、实战项目</h2><h3 id="6-1-智能代码助手"><a href="#6-1-智能代码助手" class="headerlink" title="6.1 智能代码助手"></a>6.1 智能代码助手</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeAssistantAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;读取项目中的源代码文件&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">readCode</span><span class="params">(String filePath)</span> &#123; ... &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;在项目中搜索代码&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;SearchHit&gt; <span class="title function_">searchCode</span><span class="params">(String query)</span> &#123; ... &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;执行单元测试&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> TestResult <span class="title function_">runTests</span><span class="params">(String testClass)</span> &#123; ... &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;静态代码分析&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Issue&gt; <span class="title function_">analyzeCode</span><span class="params">(String filePath)</span> &#123; ... &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">assist</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .system(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                你是一个专业的代码助手，可以：</span></span><br><span class="line"><span class="string">                1. 阅读和理解代码</span></span><br><span class="line"><span class="string">                2. 搜索相关代码片段</span></span><br><span class="line"><span class="string">                3. 运行测试验证</span></span><br><span class="line"><span class="string">                4. 分析代码质量</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                请根据用户问题，合理使用工具来提供帮助。</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>)</span><br><span class="line">            .user(question)</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-自动化运维-Agent"><a href="#6-2-自动化运维-Agent" class="headerlink" title="6.2 自动化运维 Agent"></a>6.2 自动化运维 Agent</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OpsAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;查询服务器指标：CPU、内存、磁盘使用率&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ServerMetrics <span class="title function_">getMetrics</span><span class="params">(String serverIp)</span> &#123; ... &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;查看应用日志，支持时间范围和关键字过滤&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;LogEntry&gt; <span class="title function_">getLogs</span><span class="params">(String app, String keyword, <span class="type">int</span> minutes)</span> &#123; ... &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;重启指定服务&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RestartResult <span class="title function_">restartService</span><span class="params">(String serviceName)</span> &#123; ... &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;执行 SQL 查询（只读）&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> QueryResult <span class="title function_">queryDatabase</span><span class="params">(String sql)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="相关笔记"><a href="#相关笔记" class="headerlink" title="相关笔记"></a>相关笔记</h2><ul>
<li>大模型学习路线</li>
<li>Prompt Engineering详解</li>
<li>RAG技术详解</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/AQS%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="一个来自于 AI+Obsidian 的知识库">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/AQS%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">AQS原理详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">并发编程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">同步工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="AQS-原理详解"><a href="#AQS-原理详解" class="headerlink" title="AQS 原理详解"></a>AQS 原理详解</h1><blockquote>
<p><strong>💡 提示: 知识图谱</strong><br>查看 AQS知识图谱 获取可视化知识结构</p>
</blockquote>
<h2 id="什么是-AQS？"><a href="#什么是-AQS？" class="headerlink" title="什么是 AQS？"></a>什么是 AQS？</h2><p><strong>AQS</strong>（AbstractQueuedSynchronizer，抽象队列同步器）是 Java 并发包 <code>java.util.concurrent.locks</code> 中的核心基础框架。</p>
<h3 id="一句话理解"><a href="#一句话理解" class="headerlink" title="一句话理解"></a>一句话理解</h3><blockquote>
<p>AQS 就像一个<strong>排队系统</strong>：想要获取资源的线程，如果资源被占用，就乖乖排队等待；资源释放后，排在最前面的线程被唤醒去获取资源。</p>
</blockquote>
<h3 id="为什么需要-AQS？"><a href="#为什么需要-AQS？" class="headerlink" title="为什么需要 AQS？"></a>为什么需要 AQS？</h3><p>在 AQS 出现之前，如果我们想实现一个锁或者同步器，需要自己处理：</p>
<ul>
<li>线程的阻塞与唤醒</li>
<li>等待队列的维护</li>
<li>状态的管理</li>
</ul>
<p>AQS 把这些<strong>通用逻辑</strong>抽取出来，我们只需要关注<strong>资源的获取和释放规则</strong>即可。</p>
<hr>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><h3 id="1-State（同步状态）"><a href="#1-State（同步状态）" class="headerlink" title="1. State（同步状态）"></a>1. State（同步状态）</h3><p>AQS 使用一个 <code>int</code> 类型的变量 <code>state</code> 来表示同步状态：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> state;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>同步器类型</th>
<th>state 含义</th>
</tr>
</thead>
<tbody><tr>
<td>ReentrantLock</td>
<td>0 表示未锁定，&gt;0 表示锁定次数（可重入）</td>
</tr>
<tr>
<td>Semaphore</td>
<td>表示可用的许可数量</td>
</tr>
<tr>
<td>CountDownLatch</td>
<td>表示需要等待的计数</td>
</tr>
</tbody></table>
<h3 id="2-CLH-队列（等待队列）"><a href="#2-CLH-队列（等待队列）" class="headerlink" title="2. CLH 队列（等待队列）"></a>2. CLH 队列（等待队列）</h3><p>当线程获取资源失败时，会被包装成一个 <strong>Node 节点</strong>，加入到一个 <strong>FIFO 双向队列</strong> 中等待。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     +------+  prev +------+  prev +------+</span><br><span class="line">head |      | &lt;---- |      | &lt;---- |      |  tail</span><br><span class="line">     | Node |       | Node |       | Node |</span><br><span class="line">     |      | ----&gt; |      | ----&gt; |      |</span><br><span class="line">     +------+  next +------+  next +------+</span><br></pre></td></tr></table></figure>

<h3 id="3-Node-节点"><a href="#3-Node-节点" class="headerlink" title="3. Node 节点"></a>3. Node 节点</h3><p>每个等待的线程都被封装成一个 Node：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="comment">// 等待状态</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> waitStatus;</span><br><span class="line">    <span class="comment">// 前驱节点</span></span><br><span class="line">    <span class="keyword">volatile</span> Node prev;</span><br><span class="line">    <span class="comment">// 后继节点</span></span><br><span class="line">    <span class="keyword">volatile</span> Node next;</span><br><span class="line">    <span class="comment">// 等待的线程</span></span><br><span class="line">    <span class="keyword">volatile</span> Thread thread;</span><br><span class="line">    <span class="comment">// 共享模式 or 独占模式</span></span><br><span class="line">    Node nextWaiter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>waitStatus 的取值：</strong></p>
<table>
<thead>
<tr>
<th>值</th>
<th>常量名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>-</td>
<td>初始状态</td>
</tr>
<tr>
<td>1</td>
<td>CANCELLED</td>
<td>线程已取消</td>
</tr>
<tr>
<td>-1</td>
<td>SIGNAL</td>
<td>后继节点需要被唤醒</td>
</tr>
<tr>
<td>-2</td>
<td>CONDITION</td>
<td>在条件队列中等待</td>
</tr>
<tr>
<td>-3</td>
<td>PROPAGATE</td>
<td>共享模式下传播唤醒</td>
</tr>
</tbody></table>
<hr>
<h2 id="两种资源共享模式"><a href="#两种资源共享模式" class="headerlink" title="两种资源共享模式"></a>两种资源共享模式</h2><h3 id="独占模式（Exclusive）"><a href="#独占模式（Exclusive）" class="headerlink" title="独占模式（Exclusive）"></a>独占模式（Exclusive）</h3><p><strong>同一时刻只有一个线程能获取资源</strong></p>
<p>典型实现：<code>ReentrantLock</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">线程A获取锁 → 成功，执行业务</span><br><span class="line">线程B获取锁 → 失败，进入队列等待</span><br><span class="line">线程C获取锁 → 失败，进入队列等待</span><br><span class="line">线程A释放锁 → 唤醒线程B</span><br></pre></td></tr></table></figure>

<h3 id="共享模式（Shared）"><a href="#共享模式（Shared）" class="headerlink" title="共享模式（Shared）"></a>共享模式（Shared）</h3><p><strong>同一时刻可以有多个线程获取资源</strong></p>
<p>典型实现：<code>Semaphore</code>、<code>CountDownLatch</code>、<code>ReadWriteLock</code>（读锁）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Semaphore(3) - 允许3个线程同时访问</span><br><span class="line">线程A获取 → 成功，剩余2个许可</span><br><span class="line">线程B获取 → 成功，剩余1个许可</span><br><span class="line">线程C获取 → 成功，剩余0个许可</span><br><span class="line">线程D获取 → 失败，进入队列等待</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="核心方法解析"><a href="#核心方法解析" class="headerlink" title="核心方法解析"></a>核心方法解析</h2><h3 id="需要子类实现的方法"><a href="#需要子类实现的方法" class="headerlink" title="需要子类实现的方法"></a>需要子类实现的方法</h3><p>AQS 采用<strong>模板方法模式</strong>，子类需要实现以下方法：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>模式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>tryAcquire(int)</code></td>
<td>独占</td>
<td>尝试获取资源</td>
</tr>
<tr>
<td><code>tryRelease(int)</code></td>
<td>独占</td>
<td>尝试释放资源</td>
</tr>
<tr>
<td><code>tryAcquireShared(int)</code></td>
<td>共享</td>
<td>尝试获取共享资源</td>
</tr>
<tr>
<td><code>tryReleaseShared(int)</code></td>
<td>共享</td>
<td>尝试释放共享资源</td>
</tr>
<tr>
<td><code>isHeldExclusively()</code></td>
<td>-</td>
<td>是否独占持有</td>
</tr>
</tbody></table>
<h3 id="AQS-提供的模板方法"><a href="#AQS-提供的模板方法" class="headerlink" title="AQS 提供的模板方法"></a>AQS 提供的模板方法</h3><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>acquire(int)</code></td>
<td>独占式获取（会阻塞）</td>
</tr>
<tr>
<td><code>acquireInterruptibly(int)</code></td>
<td>独占式获取（可中断）</td>
</tr>
<tr>
<td><code>tryAcquireNanos(int, long)</code></td>
<td>独占式获取（带超时）</td>
</tr>
<tr>
<td><code>release(int)</code></td>
<td>独占式释放</td>
</tr>
<tr>
<td><code>acquireShared(int)</code></td>
<td>共享式获取</td>
</tr>
<tr>
<td><code>releaseShared(int)</code></td>
<td>共享式释放</td>
</tr>
</tbody></table>
<hr>
<h2 id="独占模式源码分析"><a href="#独占模式源码分析" class="headerlink" title="独占模式源码分析"></a>独占模式源码分析</h2><h3 id="acquire-获取资源"><a href="#acquire-获取资源" class="headerlink" title="acquire() - 获取资源"></a>acquire() - 获取资源</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">acquire</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">        selfInterrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>执行流程：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[调用 acquire] --&gt; B&#123;tryAcquire 尝试获取&#125;</span><br><span class="line">    B --&gt;|成功| C[直接返回，获取到资源]</span><br><span class="line">    B --&gt;|失败| D[addWaiter 创建节点加入队列]</span><br><span class="line">    D --&gt; E[acquireQueued 在队列中自旋等待]</span><br><span class="line">    E --&gt; F&#123;是否被中断过&#125;</span><br><span class="line">    F --&gt;|是| G[selfInterrupt 补上中断]</span><br><span class="line">    F --&gt;|否| H[返回]</span><br></pre></td></tr></table></figure>

<h3 id="addWaiter-加入等待队列"><a href="#addWaiter-加入等待队列" class="headerlink" title="addWaiter() - 加入等待队列"></a>addWaiter() - 加入等待队列</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Node <span class="title function_">addWaiter</span><span class="params">(Node mode)</span> &#123;</span><br><span class="line">    <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(Thread.currentThread(), mode);</span><br><span class="line">    <span class="comment">// 快速尝试在尾部添加</span></span><br><span class="line">    <span class="type">Node</span> <span class="variable">pred</span> <span class="operator">=</span> tail;</span><br><span class="line">    <span class="keyword">if</span> (pred != <span class="literal">null</span>) &#123;</span><br><span class="line">        node.prev = pred;</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class="line">            pred.next = node;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 快速添加失败，进入完整入队流程</span></span><br><span class="line">    enq(node);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="acquireQueued-队列中等待获取"><a href="#acquireQueued-队列中等待获取" class="headerlink" title="acquireQueued() - 队列中等待获取"></a>acquireQueued() - 队列中等待获取</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="type">int</span> arg)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">failed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">interrupted</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;  <span class="comment">// 自旋</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> node.predecessor();</span><br><span class="line">            <span class="comment">// 只有前驱是head才有资格尝试获取</span></span><br><span class="line">            <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) &#123;</span><br><span class="line">                setHead(node);</span><br><span class="line">                p.next = <span class="literal">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                failed = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">return</span> interrupted;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 判断是否需要阻塞</span></span><br><span class="line">            <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                parkAndCheckInterrupt())</span><br><span class="line">                interrupted = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (failed)</span><br><span class="line">            cancelAcquire(node);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>关键点：</strong></p>
<ol>
<li>只有<strong>前驱节点是 head</strong> 的节点才有资格尝试获取资源</li>
<li>获取失败后会调用 <code>LockSupport.park()</code> 阻塞线程</li>
<li>被唤醒后继续自旋尝试获取</li>
</ol>
<h3 id="release-释放资源"><a href="#release-释放资源" class="headerlink" title="release() - 释放资源"></a>release() - 释放资源</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">release</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (tryRelease(arg)) &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">h</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">if</span> (h != <span class="literal">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">            unparkSuccessor(h);  <span class="comment">// 唤醒后继节点</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="图解：完整的获取-释放流程"><a href="#图解：完整的获取-释放流程" class="headerlink" title="图解：完整的获取-释放流程"></a>图解：完整的获取-释放流程</h2><h3 id="场景：三个线程竞争一把锁"><a href="#场景：三个线程竞争一把锁" class="headerlink" title="场景：三个线程竞争一把锁"></a>场景：三个线程竞争一把锁</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">初始状态：state = 0，队列为空</span><br><span class="line"></span><br><span class="line">=== 线程A 获取锁 ===</span><br><span class="line">1. tryAcquire(1) → CAS(0, 1) 成功</span><br><span class="line">2. state = 1，线程A持有锁</span><br><span class="line">3. 队列仍为空</span><br><span class="line"></span><br><span class="line">=== 线程B 获取锁 ===</span><br><span class="line">1. tryAcquire(1) → 失败（state=1）</span><br><span class="line">2. addWaiter() → 创建Node(B)，初始化队列</span><br><span class="line">   </span><br><span class="line">   +------+      +------+</span><br><span class="line">   | head | ---&gt; | B    |</span><br><span class="line">   | 空   |      | 等待 |</span><br><span class="line">   +------+      +------+</span><br><span class="line">   </span><br><span class="line">3. acquireQueued() → park阻塞</span><br><span class="line"></span><br><span class="line">=== 线程C 获取锁 ===</span><br><span class="line">1. tryAcquire(1) → 失败</span><br><span class="line">2. addWaiter() → 创建Node(C)加入队尾</span><br><span class="line">   </span><br><span class="line">   +------+      +------+      +------+</span><br><span class="line">   | head | ---&gt; | B    | ---&gt; | C    |</span><br><span class="line">   | 空   |      | 等待 |      | 等待 |</span><br><span class="line">   +------+      +------+      +------+</span><br><span class="line">   </span><br><span class="line">3. acquireQueued() → park阻塞</span><br><span class="line"></span><br><span class="line">=== 线程A 释放锁 ===</span><br><span class="line">1. tryRelease(1) → state = 0</span><br><span class="line">2. unparkSuccessor(head) → 唤醒线程B</span><br><span class="line">3. 线程B被唤醒，tryAcquire成功</span><br><span class="line">4. 线程B成为新的head</span><br><span class="line">   </span><br><span class="line">   +------+      +------+</span><br><span class="line">   | B    | ---&gt; | C    |</span><br><span class="line">   | head |      | 等待 |</span><br><span class="line">   +------+      +------+</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="实战：手写一个简单的互斥锁"><a href="#实战：手写一个简单的互斥锁" class="headerlink" title="实战：手写一个简单的互斥锁"></a>实战：手写一个简单的互斥锁</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleLock</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Sync</span> <span class="variable">sync</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sync</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 继承AQS</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Sync</span> <span class="keyword">extends</span> <span class="title class_">AbstractQueuedSynchronizer</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 尝试获取锁</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">            <span class="comment">// CAS 将 state 从 0 改为 1</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="comment">// 设置当前线程为独占线程</span></span><br><span class="line">                setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 尝试释放锁</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">tryRelease</span><span class="params">(<span class="type">int</span> arg)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (getState() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalMonitorStateException</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 清除独占线程</span></span><br><span class="line">            setExclusiveOwnerThread(<span class="literal">null</span>);</span><br><span class="line">            <span class="comment">// 释放锁</span></span><br><span class="line">            setState(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 是否独占持有</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isHeldExclusively</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getExclusiveOwnerThread() == Thread.currentThread();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span> &#123;</span><br><span class="line">        sync.acquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">        sync.release(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sync.tryAcquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用示例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SimpleLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleLock</span>();</span><br><span class="line"></span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 临界区代码</span></span><br><span class="line">    System.out.println(<span class="string">&quot;获取到锁，执行业务逻辑&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="AQS-的经典实现类"><a href="#AQS-的经典实现类" class="headerlink" title="AQS 的经典实现类"></a>AQS 的经典实现类</h2><table>
<thead>
<tr>
<th>实现类</th>
<th>模式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>ReentrantLock</td>
<td>独占</td>
<td>可重入互斥锁</td>
</tr>
<tr>
<td>ReentrantReadWriteLock</td>
<td>共享+独占</td>
<td>读写锁</td>
</tr>
<tr>
<td>CountDownLatch</td>
<td>共享</td>
<td>倒计时门闩</td>
</tr>
<tr>
<td>Semaphore</td>
<td>共享</td>
<td>信号量</td>
</tr>
<tr>
<td>CyclicBarrier</td>
<td>-</td>
<td>循环栅栏（内部用ReentrantLock）</td>
</tr>
</tbody></table>
<hr>
<h2 id="核心要点总结"><a href="#核心要点总结" class="headerlink" title="核心要点总结"></a>核心要点总结</h2><h3 id="AQS-的设计精髓"><a href="#AQS-的设计精髓" class="headerlink" title="AQS 的设计精髓"></a>AQS 的设计精髓</h3><ol>
<li><strong>模板方法模式</strong>：AQS 定义算法骨架，子类实现具体逻辑</li>
<li><strong>CLH 队列变体</strong>：高效的 FIFO 等待队列</li>
<li><strong>CAS + volatile</strong>：保证线程安全的无锁操作</li>
<li><strong>LockSupport</strong>：精确的线程阻塞&#x2F;唤醒控制</li>
</ol>
<h3 id="记忆口诀"><a href="#记忆口诀" class="headerlink" title="记忆口诀"></a>记忆口诀</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">AQS三要素：状态、队列、CAS</span><br><span class="line">独占看tryAcquire，共享看tryAcquireShared</span><br><span class="line">获取失败进队列，前驱是head才能抢</span><br><span class="line">释放资源唤后继，FIFO保公平</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="常见面试题"><a href="#常见面试题" class="headerlink" title="常见面试题"></a>常见面试题</h2><h3 id="Q1：AQS-为什么使用双向链表？"><a href="#Q1：AQS-为什么使用双向链表？" class="headerlink" title="Q1：AQS 为什么使用双向链表？"></a>Q1：AQS 为什么使用双向链表？</h3><ul>
<li><strong>方便取消操作</strong>：取消节点时需要修改前驱的 next 指针</li>
<li><strong>方便判断前驱状态</strong>：只有前驱是 head 才能尝试获取资源</li>
<li><strong>方便从尾部遍历</strong>：某些场景需要从后向前遍历</li>
</ul>
<h3 id="Q2：为什么-head-节点是虚节点？"><a href="#Q2：为什么-head-节点是虚节点？" class="headerlink" title="Q2：为什么 head 节点是虚节点？"></a>Q2：为什么 head 节点是虚节点？</h3><ul>
<li>head 代表<strong>当前持有资源的线程</strong>（或初始空节点）</li>
<li>真正等待的线程从 head.next 开始</li>
<li>这样设计简化了边界条件处理</li>
</ul>
<h3 id="Q3：公平锁和非公平锁的区别？"><a href="#Q3：公平锁和非公平锁的区别？" class="headerlink" title="Q3：公平锁和非公平锁的区别？"></a>Q3：公平锁和非公平锁的区别？</h3><table>
<thead>
<tr>
<th>类型</th>
<th>实现方式</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>公平锁</td>
<td>tryAcquire 时先检查队列</td>
<td>严格 FIFO，吞吐量较低</td>
</tr>
<tr>
<td>非公平锁</td>
<td>tryAcquire 时直接 CAS 抢锁</td>
<td>可能插队，吞吐量较高</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非公平锁的 tryAcquire（简化版）</span></span><br><span class="line"><span class="keyword">if</span> (state == <span class="number">0</span> &amp;&amp; CAS(<span class="number">0</span>, <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 公平锁的 tryAcquire（简化版）</span></span><br><span class="line"><span class="keyword">if</span> (state == <span class="number">0</span> &amp;&amp; !hasQueuedPredecessors() &amp;&amp; CAS(<span class="number">0</span>, <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="延伸阅读"><a href="#延伸阅读" class="headerlink" title="延伸阅读"></a>延伸阅读</h2><ul>
<li>ReentrantLock 原理 - AQS 的典型独占实现</li>
<li>CountDownLatch 原理 - AQS 的典型共享实现</li>
<li>CAS 原理 - AQS 的底层原子操作</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/Prompt%20Engineering%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="一个来自于 AI+Obsidian 的知识库">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/Prompt%20Engineering%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Prompt Engineering详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">大模型</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Prompt-Engineering-详解"><a href="#Prompt-Engineering-详解" class="headerlink" title="Prompt Engineering 详解"></a>Prompt Engineering 详解</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>Prompt Engineering（提示词工程）</strong> 是设计和优化输入给大语言模型（LLM）的提示词，以获得更准确、更符合预期输出的技术。</p>
<blockquote>
<p><strong>💡 提示: 核心思想</strong><br>大模型的输出质量很大程度上取决于输入的质量。好的 Prompt &#x3D; 好的结果。</p>
</blockquote>
<h2 id="为什么需要-Prompt-Engineering"><a href="#为什么需要-Prompt-Engineering" class="headerlink" title="为什么需要 Prompt Engineering"></a>为什么需要 Prompt Engineering</h2><table>
<thead>
<tr>
<th>问题</th>
<th>原因</th>
<th>解决方案</th>
</tr>
</thead>
<tbody><tr>
<td>输出不准确</td>
<td>问题描述模糊</td>
<td>明确任务目标</td>
</tr>
<tr>
<td>格式混乱</td>
<td>缺少格式约束</td>
<td>指定输出格式</td>
</tr>
<tr>
<td>缺少深度</td>
<td>上下文不足</td>
<td>提供背景信息</td>
</tr>
<tr>
<td>推理错误</td>
<td>一步到位太难</td>
<td>引导逐步思考</td>
</tr>
</tbody></table>
<hr>
<h2 id="一、基础提示技术"><a href="#一、基础提示技术" class="headerlink" title="一、基础提示技术"></a>一、基础提示技术</h2><h3 id="1-1-Zero-shot-Prompting"><a href="#1-1-Zero-shot-Prompting" class="headerlink" title="1.1 Zero-shot Prompting"></a>1.1 Zero-shot Prompting</h3><p><strong>定义</strong>：不提供任何示例，直接向模型提问。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">将以下文本翻译成英文：</span><br><span class="line">今天天气真好，适合出去散步。</span><br></pre></td></tr></table></figure>

<p><strong>适用场景</strong>：简单任务、模型已经训练过的常见任务。</p>
<p><strong>优点</strong>：简单直接<br><strong>缺点</strong>：复杂任务效果差</p>
<hr>
<h3 id="1-2-One-shot-Prompting"><a href="#1-2-One-shot-Prompting" class="headerlink" title="1.2 One-shot Prompting"></a>1.2 One-shot Prompting</h3><p><strong>定义</strong>：提供 1 个示例，引导模型理解任务格式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">请将中文翻译成英文：</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">中文：苹果</span><br><span class="line">英文：Apple</span><br><span class="line"></span><br><span class="line">请翻译：</span><br><span class="line">中文：香蕉</span><br><span class="line">英文：</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="1-3-Few-shot-Prompting"><a href="#1-3-Few-shot-Prompting" class="headerlink" title="1.3 Few-shot Prompting"></a>1.3 Few-shot Prompting</h3><p><strong>定义</strong>：提供多个（通常 3-5 个）示例，让模型学习模式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">请根据以下示例，对用户评论进行情感分类：</span><br><span class="line"></span><br><span class="line">评论：这个产品太棒了，物超所值！</span><br><span class="line">情感：正面</span><br><span class="line"></span><br><span class="line">评论：质量一般，不推荐购买。</span><br><span class="line">情感：负面</span><br><span class="line"></span><br><span class="line">评论：还行吧，中规中矩。</span><br><span class="line">情感：中性</span><br><span class="line"></span><br><span class="line">评论：快递超快，包装也很好，非常满意！</span><br><span class="line">情感：</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>📝 注意: 最佳实践</strong></p>
<ul>
<li>示例要多样化，覆盖不同情况</li>
<li>示例格式要与期望输出一致</li>
<li>3-5 个示例通常足够，太多可能造成干扰</li>
</ul>
</blockquote>
<hr>
<h2 id="二、推理增强技术"><a href="#二、推理增强技术" class="headerlink" title="二、推理增强技术"></a>二、推理增强技术</h2><h3 id="2-1-Chain-of-Thought-CoT-思维链"><a href="#2-1-Chain-of-Thought-CoT-思维链" class="headerlink" title="2.1 Chain of Thought (CoT) - 思维链"></a>2.1 Chain of Thought (CoT) - 思维链</h3><p><strong>定义</strong>：引导模型展示推理过程，逐步得出答案。</p>
<h4 id="基础-CoT"><a href="#基础-CoT" class="headerlink" title="基础 CoT"></a>基础 CoT</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">问题：一个商店有 23 个苹果，卖掉了 7 个，又进货了 12 个，现在有多少个苹果？</span><br><span class="line"></span><br><span class="line">请一步一步思考：</span><br></pre></td></tr></table></figure>

<p><strong>模型输出</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">让我一步一步计算：</span><br><span class="line">1. 初始苹果数量：23 个</span><br><span class="line">2. 卖掉后：23 - 7 = 16 个</span><br><span class="line">3. 进货后：16 + 12 = 28 个</span><br><span class="line"></span><br><span class="line">答案：现在有 28 个苹果。</span><br></pre></td></tr></table></figure>

<h4 id="Few-shot-CoT"><a href="#Few-shot-CoT" class="headerlink" title="Few-shot CoT"></a>Few-shot CoT</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">问题：小明有 5 个苹果，小红给了他 3 个，他又吃了 2 个，还剩几个？</span><br><span class="line">思考过程：</span><br><span class="line">- 初始：5 个</span><br><span class="line">- 小红给了 3 个：5 + 3 = 8 个</span><br><span class="line">- 吃了 2 个：8 - 2 = 6 个</span><br><span class="line">答案：6 个</span><br><span class="line"></span><br><span class="line">问题：一个农场有 15 只鸡，卖掉了 6 只，又买了 8 只，现在有多少只？</span><br><span class="line">思考过程：</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>⚠️ 重要: CoT 适用场景</strong></p>
<ul>
<li>数学计算</li>
<li>逻辑推理</li>
<li>多步骤问题</li>
<li>需要解释过程的任务</li>
</ul>
</blockquote>
<hr>
<h3 id="2-2-Zero-shot-CoT"><a href="#2-2-Zero-shot-CoT" class="headerlink" title="2.2 Zero-shot CoT"></a>2.2 Zero-shot CoT</h3><p><strong>定义</strong>：不提供示例，仅通过魔法短语触发推理。</p>
<p><strong>魔法短语</strong>：</p>
<ul>
<li>“Let’s think step by step”（让我们一步一步思考）</li>
<li>“请逐步分析”</li>
<li>“让我们仔细推理”</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">问题：一列火车从 A 站出发，每小时行驶 60 公里，2 小时后到达 B 站。</span><br><span class="line">另一列火车同时从 B 站出发，每小时 80 公里。两车何时相遇？</span><br><span class="line"></span><br><span class="line">Let&#x27;s think step by step.</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-3-Tree-of-Thought-ToT-思维树"><a href="#2-3-Tree-of-Thought-ToT-思维树" class="headerlink" title="2.3 Tree of Thought (ToT) - 思维树"></a>2.3 Tree of Thought (ToT) - 思维树</h3><p><strong>定义</strong>：探索多个推理路径，自我评估选择最优解。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[问题] --&gt; B[思路1]</span><br><span class="line">    A --&gt; C[思路2]</span><br><span class="line">    A --&gt; D[思路3]</span><br><span class="line">    B --&gt; E[评估: 可行]</span><br><span class="line">    C --&gt; F[评估: 不可行]</span><br><span class="line">    D --&gt; G[评估: 可行但复杂]</span><br><span class="line">    E --&gt; H[深入探索]</span><br><span class="line">    H --&gt; I[最终答案]</span><br></pre></td></tr></table></figure>

<p><strong>Prompt 示例</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">问题：如何设计一个高并发的秒杀系统？</span><br><span class="line"></span><br><span class="line">请用以下思维框架分析：</span><br><span class="line"></span><br><span class="line">## 思路探索</span><br><span class="line">1. 思路 A：[描述方案]</span><br><span class="line">   - 优点：</span><br><span class="line">   - 缺点：</span><br><span class="line">   - 可行性评分：1-10</span><br><span class="line"></span><br><span class="line">2. 思路 B：[描述方案]</span><br><span class="line">   - 优点：</span><br><span class="line">   - 缺点：</span><br><span class="line">   - 可行性评分：1-10</span><br><span class="line"></span><br><span class="line">3. 思路 C：[描述方案]</span><br><span class="line">   - 优点：</span><br><span class="line">   - 缺点：</span><br><span class="line">   - 可行性评分：1-10</span><br><span class="line"></span><br><span class="line">## 最优方案选择</span><br><span class="line">基于以上分析，选择并详细阐述最佳方案。</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-4-Self-Consistency（自一致性）"><a href="#2-4-Self-Consistency（自一致性）" class="headerlink" title="2.4 Self-Consistency（自一致性）"></a>2.4 Self-Consistency（自一致性）</h3><p><strong>定义</strong>：多次采样答案，选择出现频率最高的结果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">请对以下问题给出 3 个独立的推理过程和答案：</span><br><span class="line"></span><br><span class="line">问题：[复杂问题]</span><br><span class="line"></span><br><span class="line">推理 1：</span><br><span class="line">推理 2：</span><br><span class="line">推理 3：</span><br><span class="line"></span><br><span class="line">最终答案（选择出现最多的答案）：</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三、角色与上下文设定"><a href="#三、角色与上下文设定" class="headerlink" title="三、角色与上下文设定"></a>三、角色与上下文设定</h2><h3 id="3-1-角色设定（Role-Prompting）"><a href="#3-1-角色设定（Role-Prompting）" class="headerlink" title="3.1 角色设定（Role Prompting）"></a>3.1 角色设定（Role Prompting）</h3><p><strong>定义</strong>：指定 AI 扮演特定角色，影响其回答风格和专业度。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">你是一位拥有 15 年经验的 Java 架构师，精通分布式系统设计、微服务架构和性能优化。</span><br><span class="line"></span><br><span class="line">请以你的专业视角，分析以下代码的潜在问题：</span><br><span class="line"></span><br><span class="line">[代码内容]</span><br></pre></td></tr></table></figure>

<p><strong>常用角色模板</strong>：</p>
<table>
<thead>
<tr>
<th>角色</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>技术专家</td>
<td>“你是一位资深的 [领域] 专家”</td>
</tr>
<tr>
<td>代码审查员</td>
<td>“你是一位严格的代码审查员”</td>
</tr>
<tr>
<td>产品经理</td>
<td>“你是一位用户导向的产品经理”</td>
</tr>
<tr>
<td>教师</td>
<td>“你是一位耐心的编程教师”</td>
</tr>
</tbody></table>
<hr>
<h3 id="3-2-系统提示（System-Prompt）"><a href="#3-2-系统提示（System-Prompt）" class="headerlink" title="3.2 系统提示（System Prompt）"></a>3.2 系统提示（System Prompt）</h3><p><strong>定义</strong>：设置模型的行为准则和约束条件（API 调用时的 system 角色）。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;messages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你是一个专业的技术文档助手。规则：1. 只回答技术相关问题 2. 使用 Markdown 格式 3. 代码示例使用 Java&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;如何实现线程安全的单例模式？&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-3-上下文注入"><a href="#3-3-上下文注入" class="headerlink" title="3.3 上下文注入"></a>3.3 上下文注入</h3><p><strong>定义</strong>：在 Prompt 中提供相关背景知识（RAG 场景的核心）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">## 背景知识</span><br><span class="line">以下是关于 Spring AI 的官方文档摘要：</span><br><span class="line">---</span><br><span class="line">[检索到的文档内容]</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">## 用户问题</span><br><span class="line">如何在 Spring AI 中配置 OpenAI 的 API Key？</span><br><span class="line"></span><br><span class="line">## 要求</span><br><span class="line">请根据背景知识回答问题，如果背景知识中没有相关信息，请明确说明。</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四、输出控制技术"><a href="#四、输出控制技术" class="headerlink" title="四、输出控制技术"></a>四、输出控制技术</h2><h3 id="4-1-格式约束"><a href="#4-1-格式约束" class="headerlink" title="4.1 格式约束"></a>4.1 格式约束</h3><h4 id="JSON-格式"><a href="#JSON-格式" class="headerlink" title="JSON 格式"></a>JSON 格式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">请分析以下用户评论，以 JSON 格式输出结果：</span><br><span class="line"></span><br><span class="line">评论：这款手机拍照效果很好，但电池续航太差了。</span><br><span class="line"></span><br><span class="line">输出格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;sentiment&quot;: &quot;正面/负面/中性&quot;,</span><br><span class="line">  &quot;aspects&quot;: [</span><br><span class="line">    &#123;&quot;aspect&quot;: &quot;方面名&quot;, &quot;sentiment&quot;: &quot;正面/负面&quot;, &quot;comment&quot;: &quot;具体评价&quot;&#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;summary&quot;: &quot;一句话总结&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Markdown-格式"><a href="#Markdown-格式" class="headerlink" title="Markdown 格式"></a>Markdown 格式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">请用 Markdown 格式输出技术方案文档：</span><br><span class="line"></span><br><span class="line">## 要求</span><br><span class="line">- 使用多级标题组织内容</span><br><span class="line">- 代码块使用正确的语言标识</span><br><span class="line">- 重点内容使用粗体</span><br><span class="line">- 包含流程图（Mermaid）</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-2-长度控制"><a href="#4-2-长度控制" class="headerlink" title="4.2 长度控制"></a>4.2 长度控制</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">请用不超过 100 字总结这篇文章的核心观点。</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">请详细解释这个概念，包括：</span><br><span class="line">1. 定义（50字）</span><br><span class="line">2. 工作原理（200字）</span><br><span class="line">3. 应用场景（100字）</span><br><span class="line">4. 代码示例（完整可运行）</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-3-分隔符使用"><a href="#4-3-分隔符使用" class="headerlink" title="4.3 分隔符使用"></a>4.3 分隔符使用</h3><p>使用明确的分隔符避免 Prompt 注入和内容混淆：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">请翻译以下文本，文本用 ### 包裹：</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">用户输入的内容</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">翻译结果：</span><br></pre></td></tr></table></figure>

<p>常用分隔符：</p>
<ul>
<li><code>###</code></li>
<li><code>---</code></li>
<li><code>&quot;&quot;&quot;</code> </li>
<li><code>&lt;text&gt;&lt;/text&gt;</code></li>
<li><code>[START][END]</code></li>
</ul>
<hr>
<h2 id="五、高级技术"><a href="#五、高级技术" class="headerlink" title="五、高级技术"></a>五、高级技术</h2><h3 id="5-1-ReAct（Reasoning-Acting）"><a href="#5-1-ReAct（Reasoning-Acting）" class="headerlink" title="5.1 ReAct（Reasoning + Acting）"></a>5.1 ReAct（Reasoning + Acting）</h3><p><strong>定义</strong>：推理与行动交替进行，适合 Agent 场景。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">你是一个能够使用工具的 AI 助手。</span><br><span class="line"></span><br><span class="line">可用工具：</span><br><span class="line">1. search(query) - 搜索信息</span><br><span class="line">2. calculator(expression) - 计算数学表达式</span><br><span class="line">3. get_weather(city) - 获取天气</span><br><span class="line"></span><br><span class="line">请用以下格式回答问题：</span><br><span class="line"></span><br><span class="line">Thought: 思考下一步该做什么</span><br><span class="line">Action: 工具名称</span><br><span class="line">Action Input: 工具输入</span><br><span class="line">Observation: 工具返回结果</span><br><span class="line">... (重复直到得出答案)</span><br><span class="line">Thought: 我现在知道最终答案了</span><br><span class="line">Final Answer: 最终答案</span><br><span class="line"></span><br><span class="line">问题：北京今天的气温是多少摄氏度？换算成华氏度是多少？</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-2-Generated-Knowledge-Prompting"><a href="#5-2-Generated-Knowledge-Prompting" class="headerlink" title="5.2 Generated Knowledge Prompting"></a>5.2 Generated Knowledge Prompting</h3><p><strong>定义</strong>：让模型先生成相关知识，再基于知识回答问题。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## 第一步：生成知识</span><br><span class="line">请列出关于 Java 线程池的 5 个关键知识点。</span><br><span class="line"></span><br><span class="line">## 第二步：回答问题</span><br><span class="line">基于以上知识，解释为什么不建议使用 Executors.newFixedThreadPool()？</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-3-Directional-Stimulus-Prompting"><a href="#5-3-Directional-Stimulus-Prompting" class="headerlink" title="5.3 Directional Stimulus Prompting"></a>5.3 Directional Stimulus Prompting</h3><p><strong>定义</strong>：提供提示词暗示，引导模型输出方向。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">请写一首关于春天的诗。</span><br><span class="line"></span><br><span class="line">提示词：花开、暖风、希望、新生</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="六、Prompt-模板库"><a href="#六、Prompt-模板库" class="headerlink" title="六、Prompt 模板库"></a>六、Prompt 模板库</h2><h3 id="6-1-代码审查模板"><a href="#6-1-代码审查模板" class="headerlink" title="6.1 代码审查模板"></a>6.1 代码审查模板</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">你是一位资深的 Java 代码审查专家。</span><br><span class="line"></span><br><span class="line">请审查以下代码，从以下维度分析：</span><br><span class="line">1. **代码规范**：命名、格式、注释</span><br><span class="line">2. **潜在 Bug**：空指针、并发问题、资源泄露</span><br><span class="line">3. **性能问题**：时间复杂度、内存使用</span><br><span class="line">4. **安全风险**：SQL 注入、XSS 等</span><br><span class="line">5. **可维护性**：代码复杂度、可测试性</span><br><span class="line"></span><br><span class="line">代码：</span><br><span class="line">```java</span><br><span class="line">[代码内容]</span><br></pre></td></tr></table></figure>

<p>输出格式：</p>
<table>
<thead>
<tr>
<th>问题</th>
<th>严重程度</th>
<th>位置</th>
<th>修改建议</th>
</tr>
</thead>
</table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">### 6.2 技术方案模板</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>请设计一个技术方案，要求：</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>[问题描述]</p>
<h2 id="输出要求"><a href="#输出要求" class="headerlink" title="输出要求"></a>输出要求</h2><ol>
<li><strong>需求分析</strong>：明确功能和非功能需求</li>
<li><strong>架构设计</strong>：整体架构图（Mermaid）</li>
<li><strong>技术选型</strong>：框架、中间件选择及理由</li>
<li><strong>核心流程</strong>：关键流程时序图</li>
<li><strong>数据设计</strong>：核心表结构</li>
<li><strong>风险评估</strong>：潜在风险及应对策略</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">### 6.3 Debug 助手模板</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>你是一位经验丰富的 Debug 专家。</p>
<h2 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a>错误信息</h2><p>[错误日志]</p>
<h2 id="相关代码"><a href="#相关代码" class="headerlink" title="相关代码"></a>相关代码</h2><p>[代码片段]</p>
<h2 id="请分析"><a href="#请分析" class="headerlink" title="请分析"></a>请分析</h2><ol>
<li>错误的直接原因</li>
<li>根本原因分析</li>
<li>解决方案（给出具体代码）</li>
<li>如何避免类似问题</li>
</ol>
<pre><code>
---

## 七、最佳实践

### 7.1 Prompt 设计原则

| 原则 | 说明 |
|------|------|
| **明确具体** | 避免模糊表述，明确任务目标 |
| **结构清晰** | 使用分隔符、编号组织内容 |
| **提供示例** | 复杂任务用 Few-shot 引导 |
| **迭代优化** | 根据输出效果不断调整 |
| **控制长度** | 避免过长导致信息丢失 |

### 7.2 常见错误

| 错误 | 示例 | 改进 |
|------|------|------|
| 过于模糊 | &quot;帮我写代码&quot; | &quot;用 Java 实现一个线程安全的 LRU 缓存&quot; |
| 缺少上下文 | &quot;这个报错怎么解决&quot; | &quot;Spring Boot 3.x 启动报错：[具体错误]&quot; |
| 期望过高 | &quot;写一个完整的电商系统&quot; | 拆分为多个小任务逐步实现 |

### 7.3 调试技巧

1. **打印思考过程**：加入 &quot;请展示你的推理过程&quot;
2. **要求自我检查**：加入 &quot;请检查答案是否正确&quot;
3. **分步验证**：复杂任务拆分为多轮对话

---

## 八、工具与资源

### 在线工具

| 工具 | 用途 |
|------|------|
| [PromptPerfect](https://promptperfect.jina.ai/) | Prompt 优化 |
| [OpenAI Playground](https://platform.openai.com/playground) | 在线测试 |
| [LangSmith](https://smith.langchain.com/) | Prompt 管理与追踪 |

### 学习资源

- [Prompt Engineering Guide](https://www.promptingguide.ai/)
- [OpenAI Prompt Engineering](https://platform.openai.com/docs/guides/prompt-engineering)
- [Learn Prompting](https://learnprompting.org/)

---

## 相关笔记

- 大模型学习路线
- LLM应用开发
- RAG技术详解
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/RDF%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="一个来自于 AI+Obsidian 的知识库">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/RDF%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">RDF规范</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">图数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="RDF-规范"><a href="#RDF-规范" class="headerlink" title="RDF 规范"></a>RDF 规范</h1><blockquote>
<p><strong>ℹ️ 信息: 衍生来源</strong><br>本笔记衍生自 三元组详解</p>
</blockquote>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>RDF（Resource Description Framework）</strong> 是 W3C 制定的资源描述框架，用于描述 Web 资源的标准模型。RDF 基于三元组模型，是语义网和知识图谱的基础技术。</p>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><h3 id="资源（Resource）"><a href="#资源（Resource）" class="headerlink" title="资源（Resource）"></a>资源（Resource）</h3><ul>
<li>一切可被描述的事物都是资源</li>
<li>使用 <strong>URI（统一资源标识符）</strong> 唯一标识</li>
<li>示例：<code>http://example.org/person/张三</code></li>
</ul>
<h3 id="属性（Property）"><a href="#属性（Property）" class="headerlink" title="属性（Property）"></a>属性（Property）</h3><ul>
<li>描述资源特征或关系的谓语</li>
<li>也使用 URI 标识</li>
<li>示例：<code>http://xmlns.com/foaf/0.1/name</code></li>
</ul>
<h3 id="字面量（Literal）"><a href="#字面量（Literal）" class="headerlink" title="字面量（Literal）"></a>字面量（Literal）</h3><ul>
<li>属性的具体值</li>
<li>可带数据类型或语言标签</li>
<li>示例：<code>&quot;25&quot;^^xsd:integer</code>、<code>&quot;北京&quot;@zh</code></li>
</ul>
<h2 id="RDF-序列化格式"><a href="#RDF-序列化格式" class="headerlink" title="RDF 序列化格式"></a>RDF 序列化格式</h2><table>
<thead>
<tr>
<th>格式</th>
<th>扩展名</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td><strong>N-Triples</strong></td>
<td><code>.nt</code></td>
<td>最简单，每行一个三元组</td>
</tr>
<tr>
<td><strong>Turtle</strong></td>
<td><code>.ttl</code></td>
<td>可读性强，支持前缀</td>
</tr>
<tr>
<td><strong>RDF&#x2F;XML</strong></td>
<td><code>.rdf</code></td>
<td>XML 格式，较冗长</td>
</tr>
<tr>
<td><strong>JSON-LD</strong></td>
<td><code>.jsonld</code></td>
<td>JSON 兼容，Web 友好</td>
</tr>
<tr>
<td><strong>N-Quads</strong></td>
<td><code>.nq</code></td>
<td>四元组，支持命名图</td>
</tr>
</tbody></table>
<h2 id="N-Triples-格式"><a href="#N-Triples-格式" class="headerlink" title="N-Triples 格式"></a>N-Triples 格式</h2><p>最简单的 RDF 序列化格式，每行一个三元组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;http://example.org/张三&gt; &lt;http://example.org/认识&gt; &lt;http://example.org/李四&gt; .</span><br><span class="line">&lt;http://example.org/张三&gt; &lt;http://example.org/年龄&gt; &quot;25&quot;^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .</span><br><span class="line">&lt;http://example.org/张三&gt; &lt;http://xmlns.com/foaf/0.1/name&gt; &quot;张三&quot;@zh .</span><br></pre></td></tr></table></figure>

<h3 id="语法规则"><a href="#语法规则" class="headerlink" title="语法规则"></a>语法规则</h3><ul>
<li>URI 用 <code>&lt; &gt;</code> 包围</li>
<li>字面量用 <code>&quot; &quot;</code> 包围</li>
<li>数据类型用 <code>^^&lt;type&gt;</code> 标注</li>
<li>语言标签用 <code>@lang</code> 标注</li>
<li>每个三元组以 <code>.</code> 结尾</li>
</ul>
<h2 id="Turtle-格式"><a href="#Turtle-格式" class="headerlink" title="Turtle 格式"></a>Turtle 格式</h2><p>更易读的格式，支持前缀和简写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@prefix ex: &lt;http://example.org/&gt; .</span><br><span class="line">@prefix foaf: &lt;http://xmlns.com/foaf/0.1/&gt; .</span><br><span class="line">@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .</span><br><span class="line"></span><br><span class="line">ex:张三 </span><br><span class="line">    foaf:name &quot;张三&quot;@zh ;</span><br><span class="line">    ex:年龄 &quot;25&quot;^^xsd:integer ;</span><br><span class="line">    ex:认识 ex:李四 .</span><br><span class="line"></span><br><span class="line">ex:李四</span><br><span class="line">    foaf:name &quot;李四&quot;@zh ;</span><br><span class="line">    ex:工作于 ex:腾讯 .</span><br></pre></td></tr></table></figure>

<h3 id="Turtle-语法特点"><a href="#Turtle-语法特点" class="headerlink" title="Turtle 语法特点"></a>Turtle 语法特点</h3><table>
<thead>
<tr>
<th>符号</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>@prefix</code></td>
<td>定义命名空间前缀</td>
</tr>
<tr>
<td><code>;</code></td>
<td>同一主语的多个谓语-宾语</td>
</tr>
<tr>
<td><code>,</code></td>
<td>同一谓语的多个宾语</td>
</tr>
<tr>
<td><code>.</code></td>
<td>三元组结束</td>
</tr>
<tr>
<td><code>a</code></td>
<td><code>rdf:type</code> 的简写</td>
</tr>
</tbody></table>
<h2 id="JSON-LD-格式"><a href="#JSON-LD-格式" class="headerlink" title="JSON-LD 格式"></a>JSON-LD 格式</h2><p>JSON 兼容格式，适合 Web 开发：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;@context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;ex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://example.org/&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;foaf&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://xmlns.com/foaf/0.1/&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;foaf:name&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;knows&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;@id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ex:认识&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@id&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;@id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ex:张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;knows&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ex:李四&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="常用词汇表"><a href="#常用词汇表" class="headerlink" title="常用词汇表"></a>常用词汇表</h2><table>
<thead>
<tr>
<th>词汇表</th>
<th>前缀</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>RDF</td>
<td><code>rdf:</code></td>
<td>基础 RDF 词汇</td>
</tr>
<tr>
<td>RDFS</td>
<td><code>rdfs:</code></td>
<td>RDF Schema，类和属性定义</td>
</tr>
<tr>
<td>OWL</td>
<td><code>owl:</code></td>
<td>本体描述语言</td>
</tr>
<tr>
<td>FOAF</td>
<td><code>foaf:</code></td>
<td>人物关系描述</td>
</tr>
<tr>
<td>DC</td>
<td><code>dc:</code></td>
<td>都柏林核心元数据</td>
</tr>
<tr>
<td>SKOS</td>
<td><code>skos:</code></td>
<td>概念和分类体系</td>
</tr>
</tbody></table>
<h2 id="RDF-Schema（RDFS）"><a href="#RDF-Schema（RDFS）" class="headerlink" title="RDF Schema（RDFS）"></a>RDF Schema（RDFS）</h2><p>RDFS 提供了定义类和属性的机制：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .</span><br><span class="line">@prefix ex: &lt;http://example.org/&gt; .</span><br><span class="line"></span><br><span class="line"># 定义类</span><br><span class="line">ex:Person a rdfs:Class ;</span><br><span class="line">    rdfs:label &quot;人&quot;@zh .</span><br><span class="line"></span><br><span class="line"># 定义属性</span><br><span class="line">ex:认识 a rdf:Property ;</span><br><span class="line">    rdfs:domain ex:Person ;</span><br><span class="line">    rdfs:range ex:Person ;</span><br><span class="line">    rdfs:label &quot;认识&quot;@zh .</span><br><span class="line"></span><br><span class="line"># 定义实例</span><br><span class="line">ex:张三 a ex:Person ;</span><br><span class="line">    ex:认识 ex:李四 .</span><br></pre></td></tr></table></figure>

<h2 id="空白节点（Blank-Node）"><a href="#空白节点（Blank-Node）" class="headerlink" title="空白节点（Blank Node）"></a>空白节点（Blank Node）</h2><p>表示匿名资源：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ex:张三 ex:住址 [</span><br><span class="line">    ex:城市 &quot;北京&quot; ;</span><br><span class="line">    ex:区 &quot;海淀区&quot; ;</span><br><span class="line">    ex:街道 &quot;中关村大街&quot;</span><br><span class="line">] .</span><br></pre></td></tr></table></figure>

<h2 id="RDF-验证"><a href="#RDF-验证" class="headerlink" title="RDF 验证"></a>RDF 验证</h2><p>使用 <strong>SHACL（Shapes Constraint Language）</strong> 验证 RDF 数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@prefix sh: &lt;http://www.w3.org/ns/shacl#&gt; .</span><br><span class="line"></span><br><span class="line">ex:PersonShape a sh:NodeShape ;</span><br><span class="line">    sh:targetClass ex:Person ;</span><br><span class="line">    sh:property [</span><br><span class="line">        sh:path foaf:name ;</span><br><span class="line">        sh:minCount 1 ;</span><br><span class="line">        sh:datatype xsd:string</span><br><span class="line">    ] .</span><br></pre></td></tr></table></figure>

<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ul>
<li>三元组详解 - 衍生来源</li>
<li>SPARQL详解 - RDF 查询语言</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/Reflexion%E8%87%AA%E5%8F%8D%E6%80%9DAgent%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="一个来自于 AI+Obsidian 的知识库">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/Reflexion%E8%87%AA%E5%8F%8D%E6%80%9DAgent%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Reflexion自反思Agent详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">大模型</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Reflexion-自反思-Agent-详解"><a href="#Reflexion-自反思-Agent-详解" class="headerlink" title="Reflexion 自反思 Agent 详解"></a>Reflexion 自反思 Agent 详解</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>Reflexion</strong> 是一种让 Agent 具备”从错误中学习”能力的架构模式。核心思想是：执行任务后进行自我评估和反思，将经验教训存入记忆，在后续尝试中避免重复错误。</p>
<blockquote>
<p><strong>💡 提示: 核心价值</strong><br>传统 Agent 每次都是”从零开始”，而 Reflexion Agent 能够<strong>积累经验、持续改进</strong>。</p>
</blockquote>
<h2 id="与传统-Agent-的对比"><a href="#与传统-Agent-的对比" class="headerlink" title="与传统 Agent 的对比"></a>与传统 Agent 的对比</h2><table>
<thead>
<tr>
<th>维度</th>
<th>传统 Agent</th>
<th>Reflexion Agent</th>
</tr>
</thead>
<tbody><tr>
<td>失败处理</td>
<td>简单重试</td>
<td>反思后改进再试</td>
</tr>
<tr>
<td>经验积累</td>
<td>无</td>
<td>有（记忆模块）</td>
</tr>
<tr>
<td>学习能力</td>
<td>无</td>
<td>从错误中学习</td>
</tr>
<tr>
<td>成功率</td>
<td>随机</td>
<td>逐次提升</td>
</tr>
</tbody></table>
<hr>
<h2 id="一、核心架构"><a href="#一、核心架构" class="headerlink" title="一、核心架构"></a>一、核心架构</h2><h3 id="1-1-三大组件"><a href="#1-1-三大组件" class="headerlink" title="1.1 三大组件"></a>1.1 三大组件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    subgraph Reflexion Agent</span><br><span class="line">        A[Actor&lt;br/&gt;执行者] --&gt; B[Evaluator&lt;br/&gt;评估者]</span><br><span class="line">        B --&gt; C&#123;成功?&#125;</span><br><span class="line">        C --&gt;|是| D[返回结果]</span><br><span class="line">        C --&gt;|否| E[Self-Reflection&lt;br/&gt;自反思]</span><br><span class="line">        E --&gt; F[Memory&lt;br/&gt;经验记忆]</span><br><span class="line">        F --&gt; A</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>组件</th>
<th>职责</th>
<th>输入</th>
<th>输出</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Actor</strong></td>
<td>执行任务</td>
<td>任务 + 历史经验</td>
<td>执行结果</td>
</tr>
<tr>
<td><strong>Evaluator</strong></td>
<td>评估结果质量</td>
<td>任务 + 结果</td>
<td>成功&#x2F;失败 + 反馈</td>
</tr>
<tr>
<td><strong>Self-Reflection</strong></td>
<td>分析失败原因</td>
<td>执行历史 + 评估反馈</td>
<td>经验教训</td>
</tr>
<tr>
<td><strong>Memory</strong></td>
<td>存储经验</td>
<td>反思结果</td>
<td>历史经验列表</td>
</tr>
</tbody></table>
<h3 id="1-2-执行流程"><a href="#1-2-执行流程" class="headerlink" title="1.2 执行流程"></a>1.2 执行流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    participant U as 用户</span><br><span class="line">    participant A as Actor</span><br><span class="line">    participant E as Evaluator</span><br><span class="line">    participant R as Self-Reflection</span><br><span class="line">    participant M as Memory</span><br><span class="line">    </span><br><span class="line">    U-&gt;&gt;A: 任务</span><br><span class="line">    M-&gt;&gt;A: 历史经验</span><br><span class="line">    A-&gt;&gt;E: 执行结果</span><br><span class="line">    E-&gt;&gt;E: 评估</span><br><span class="line">    </span><br><span class="line">    alt 成功</span><br><span class="line">        E-&gt;&gt;U: 返回结果</span><br><span class="line">    else 失败</span><br><span class="line">        E-&gt;&gt;R: 评估反馈</span><br><span class="line">        R-&gt;&gt;R: 反思分析</span><br><span class="line">        R-&gt;&gt;M: 存储经验</span><br><span class="line">        M-&gt;&gt;A: 更新经验</span><br><span class="line">        Note over A: 重新尝试</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="二、各组件详解"><a href="#二、各组件详解" class="headerlink" title="二、各组件详解"></a>二、各组件详解</h2><h3 id="2-1-Actor（执行者）"><a href="#2-1-Actor（执行者）" class="headerlink" title="2.1 Actor（执行者）"></a>2.1 Actor（执行者）</h3><p>Actor 负责实际执行任务，但会参考历史经验避免重复错误。</p>
<h4 id="Prompt-模板"><a href="#Prompt-模板" class="headerlink" title="Prompt 模板"></a>Prompt 模板</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">你是一个智能助手，负责完成用户任务。</span><br><span class="line"></span><br><span class="line">## 任务</span><br><span class="line">&#123;task&#125;</span><br><span class="line"></span><br><span class="line">## 历史经验教训（请务必参考，避免重复错误）</span><br><span class="line">&#123;experiences&#125;</span><br><span class="line"></span><br><span class="line">## 要求</span><br><span class="line">1. 仔细阅读历史经验，避免犯同样的错误</span><br><span class="line">2. 如果历史经验提到某种方法不可行，请尝试其他方法</span><br><span class="line">3. 输出你的思考过程和最终结果</span><br><span class="line"></span><br><span class="line">## 输出格式</span><br><span class="line">### 思考</span><br><span class="line">[分析任务，参考经验，规划方案]</span><br><span class="line"></span><br><span class="line">### 执行</span><br><span class="line">[具体执行步骤和结果]</span><br></pre></td></tr></table></figure>

<h4 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Actor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ActorResult <span class="title function_">execute</span><span class="params">(String task, List&lt;String&gt; experiences)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">experienceText</span> <span class="operator">=</span> experiences.isEmpty() </span><br><span class="line">            ? <span class="string">&quot;暂无历史经验&quot;</span></span><br><span class="line">            : experiences.stream()</span><br><span class="line">                .map(e -&gt; <span class="string">&quot;- &quot;</span> + e)</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">            .system(ACTOR_PROMPT)</span><br><span class="line">            .user(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                ## 任务</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                ## 历史经验教训</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>.formatted(task, experienceText))</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parseActorResult(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActorResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String thinking;      <span class="comment">// 思考过程</span></span><br><span class="line">    <span class="keyword">private</span> String execution;     <span class="comment">// 执行结果</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; actions; <span class="comment">// 执行的动作列表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-2-Evaluator（评估者）"><a href="#2-2-Evaluator（评估者）" class="headerlink" title="2.2 Evaluator（评估者）"></a>2.2 Evaluator（评估者）</h3><p>Evaluator 负责判断执行结果是否达标，可以用 LLM 评估、规则评估或测试用例评估。</p>
<h4 id="评估方式对比"><a href="#评估方式对比" class="headerlink" title="评估方式对比"></a>评估方式对比</h4><table>
<thead>
<tr>
<th>评估方式</th>
<th>适用场景</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td><strong>LLM 评估</strong></td>
<td>开放性任务</td>
<td>灵活</td>
<td>可能不准确</td>
</tr>
<tr>
<td><strong>规则评估</strong></td>
<td>有明确标准的任务</td>
<td>准确</td>
<td>不够灵活</td>
</tr>
<tr>
<td><strong>测试用例</strong></td>
<td>代码生成任务</td>
<td>客观准确</td>
<td>需要预先准备</td>
</tr>
<tr>
<td><strong>人工评估</strong></td>
<td>高风险决策</td>
<td>最准确</td>
<td>成本高</td>
</tr>
</tbody></table>
<h4 id="LLM-评估-Prompt"><a href="#LLM-评估-Prompt" class="headerlink" title="LLM 评估 Prompt"></a>LLM 评估 Prompt</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">你是一个严格的任务评估专家。</span><br><span class="line"></span><br><span class="line">## 原始任务</span><br><span class="line">&#123;task&#125;</span><br><span class="line"></span><br><span class="line">## 执行结果</span><br><span class="line">&#123;result&#125;</span><br><span class="line"></span><br><span class="line">## 评估维度</span><br><span class="line">1. **正确性**：结果是否正确完成了任务要求</span><br><span class="line">2. **完整性**：是否覆盖了所有要求</span><br><span class="line">3. **质量**：结果的质量如何</span><br><span class="line"></span><br><span class="line">## 输出格式（JSON）</span><br><span class="line">&#123;</span><br><span class="line">  &quot;success&quot;: true/false,</span><br><span class="line">  &quot;score&quot;: 0-100,</span><br><span class="line">  &quot;dimensions&quot;: &#123;</span><br><span class="line">    &quot;correctness&quot;: &#123;&quot;score&quot;: 0-100, &quot;feedback&quot;: &quot;...&quot;&#125;,</span><br><span class="line">    &quot;completeness&quot;: &#123;&quot;score&quot;: 0-100, &quot;feedback&quot;: &quot;...&quot;&#125;,</span><br><span class="line">    &quot;quality&quot;: &#123;&quot;score&quot;: 0-100, &quot;feedback&quot;: &quot;...&quot;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;overall_feedback&quot;: &quot;总体评价&quot;,</span><br><span class="line">  &quot;specific_issues&quot;: [&quot;问题1&quot;, &quot;问题2&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Java-实现-1"><a href="#Java-实现-1" class="headerlink" title="Java 实现"></a>Java 实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Evaluator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// LLM 评估</span></span><br><span class="line">    <span class="keyword">public</span> EvaluationResult <span class="title function_">evaluateWithLLM</span><span class="params">(String task, String result)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">            .system(EVALUATOR_PROMPT)</span><br><span class="line">            .user(<span class="string">&quot;任务：%s\n\n结果：%s&quot;</span>.formatted(task, result))</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parseJson(response, EvaluationResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 代码任务：测试用例评估</span></span><br><span class="line">    <span class="keyword">public</span> EvaluationResult <span class="title function_">evaluateCode</span><span class="params">(String code, List&lt;TestCase&gt; testCases)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">passed</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        List&lt;String&gt; failures = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (TestCase tc : testCases) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> executeCode(code, tc.getInput());</span><br><span class="line">                <span class="keyword">if</span> (tc.getExpected().equals(result)) &#123;</span><br><span class="line">                    passed++;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    failures.add(<span class="string">&quot;输入 %s 期望 %s 实际 %s&quot;</span></span><br><span class="line">                        .formatted(tc.getInput(), tc.getExpected(), result));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                failures.add(<span class="string">&quot;输入 %s 执行异常：%s&quot;</span></span><br><span class="line">                    .formatted(tc.getInput(), e.getMessage()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">score</span> <span class="operator">=</span> passed * <span class="number">100</span> / testCases.size();</span><br><span class="line">        <span class="keyword">return</span> EvaluationResult.builder()</span><br><span class="line">            .success(score &gt;= <span class="number">100</span>)</span><br><span class="line">            .score(score)</span><br><span class="line">            .specificIssues(failures)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvaluationResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> success;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> score;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, DimensionScore&gt; dimensions;</span><br><span class="line">    <span class="keyword">private</span> String overallFeedback;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; specificIssues;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-3-Self-Reflection（自反思）"><a href="#2-3-Self-Reflection（自反思）" class="headerlink" title="2.3 Self-Reflection（自反思）"></a>2.3 Self-Reflection（自反思）</h3><p>Self-Reflection 是 Reflexion 的核心，负责深度分析失败原因并总结经验。</p>
<h4 id="反思-Prompt"><a href="#反思-Prompt" class="headerlink" title="反思 Prompt"></a>反思 Prompt</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">你是一个善于反思和总结的分析专家。</span><br><span class="line"></span><br><span class="line">## 任务目标</span><br><span class="line">&#123;task&#125;</span><br><span class="line"></span><br><span class="line">## 执行过程</span><br><span class="line">&#123;execution_trace&#125;</span><br><span class="line"></span><br><span class="line">## 执行结果</span><br><span class="line">&#123;result&#125;</span><br><span class="line"></span><br><span class="line">## 评估反馈</span><br><span class="line">&#123;evaluation_feedback&#125;</span><br><span class="line"></span><br><span class="line">## 请进行深度反思</span><br><span class="line"></span><br><span class="line">### 1. 问题诊断</span><br><span class="line">- 这次尝试具体哪里出了问题？</span><br><span class="line">- 是理解错误、方法错误还是执行错误？</span><br><span class="line"></span><br><span class="line">### 2. 根因分析</span><br><span class="line">- 问题的根本原因是什么？</span><br><span class="line">- 是否有错误的假设？</span><br><span class="line"></span><br><span class="line">### 3. 经验总结</span><br><span class="line">- 从这次失败中学到了什么？</span><br><span class="line">- 下次遇到类似问题应该如何处理？</span><br><span class="line"></span><br><span class="line">### 4. 改进方案</span><br><span class="line">- 具体的改进措施是什么？</span><br><span class="line">- 下一次尝试应该怎么做？</span><br><span class="line"></span><br><span class="line">## 输出格式（JSON）</span><br><span class="line">&#123;</span><br><span class="line">  &quot;problem_diagnosis&quot;: &quot;问题诊断&quot;,</span><br><span class="line">  &quot;root_cause&quot;: &quot;根本原因&quot;,</span><br><span class="line">  &quot;lessons_learned&quot;: [</span><br><span class="line">    &quot;经验1：...&quot;,</span><br><span class="line">    &quot;经验2：...&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;improvement_plan&quot;: &quot;改进方案&quot;,</span><br><span class="line">  &quot;confidence&quot;: 0-100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Java-实现-2"><a href="#Java-实现-2" class="headerlink" title="Java 实现"></a>Java 实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelfReflection</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflectionResult <span class="title function_">reflect</span><span class="params">(ReflectionInput input)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">            .system(REFLECTION_PROMPT)</span><br><span class="line">            .user(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                ## 任务目标</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                ## 执行过程</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                ## 执行结果</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                ## 评估反馈</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>.formatted(</span><br><span class="line">                    input.getTask(),</span><br><span class="line">                    input.getExecutionTrace(),</span><br><span class="line">                    input.getResult(),</span><br><span class="line">                    input.getEvaluationFeedback()</span><br><span class="line">                ))</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parseJson(response, ReflectionResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionInput</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String task;</span><br><span class="line">    <span class="keyword">private</span> String executionTrace;</span><br><span class="line">    <span class="keyword">private</span> String result;</span><br><span class="line">    <span class="keyword">private</span> String evaluationFeedback;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String problemDiagnosis;</span><br><span class="line">    <span class="keyword">private</span> String rootCause;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; lessonsLearned;</span><br><span class="line">    <span class="keyword">private</span> String improvementPlan;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> confidence;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 转换为可存储的经验文本</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toExperienceText</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            问题：%s</span></span><br><span class="line"><span class="string">            原因：%s</span></span><br><span class="line"><span class="string">            教训：%s</span></span><br><span class="line"><span class="string">            改进：%s</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>.formatted(</span><br><span class="line">                problemDiagnosis,</span><br><span class="line">                rootCause,</span><br><span class="line">                String.join(<span class="string">&quot;；&quot;</span>, lessonsLearned),</span><br><span class="line">                improvementPlan</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-4-Memory（记忆模块）"><a href="#2-4-Memory（记忆模块）" class="headerlink" title="2.4 Memory（记忆模块）"></a>2.4 Memory（记忆模块）</h3><p>Memory 负责存储和检索经验，支持短期记忆（当前任务）和长期记忆（跨任务）。</p>
<h4 id="记忆架构"><a href="#记忆架构" class="headerlink" title="记忆架构"></a>记忆架构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    subgraph Memory</span><br><span class="line">        A[短期记忆] --&gt; C[经验检索]</span><br><span class="line">        B[长期记忆] --&gt; C</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    D[当前任务经验] --&gt; A</span><br><span class="line">    E[历史任务经验] --&gt; B</span><br><span class="line">    C --&gt; F[相关经验]</span><br></pre></td></tr></table></figure>

<h4 id="Java-实现-3"><a href="#Java-实现-3" class="headerlink" title="Java 实现"></a>Java 实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflexionMemory</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 短期记忆：当前任务的尝试历史</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;String&gt; shortTermMemory = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 长期记忆：向量数据库</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VectorStore vectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加短期记忆</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addShortTerm</span><span class="params">(String experience)</span> &#123;</span><br><span class="line">        shortTermMemory.add(experience);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清空短期记忆（任务完成后）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clearShortTerm</span><span class="params">()</span> &#123;</span><br><span class="line">        shortTermMemory.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加长期记忆</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLongTerm</span><span class="params">(String experience, String taskType)</span> &#123;</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>(</span><br><span class="line">            experience,</span><br><span class="line">            Map.of(</span><br><span class="line">                <span class="string">&quot;task_type&quot;</span>, taskType,</span><br><span class="line">                <span class="string">&quot;timestamp&quot;</span>, System.currentTimeMillis(),</span><br><span class="line">                <span class="string">&quot;source&quot;</span>, <span class="string">&quot;reflexion&quot;</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">        vectorStore.add(List.of(doc));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检索相关经验</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">recall</span><span class="params">(String task, <span class="type">int</span> topK)</span> &#123;</span><br><span class="line">        List&lt;String&gt; experiences = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. 添加短期记忆（当前任务的所有尝试）</span></span><br><span class="line">        experiences.addAll(shortTermMemory);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 检索长期记忆中的相关经验</span></span><br><span class="line">        List&lt;Document&gt; docs = vectorStore.similaritySearch(</span><br><span class="line">            SearchRequest.query(task).withTopK(topK)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Document doc : docs) &#123;</span><br><span class="line">            experiences.add(doc.getContent());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> experiences;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取短期记忆</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getShortTermMemory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(shortTermMemory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三、完整实现"><a href="#三、完整实现" class="headerlink" title="三、完整实现"></a>三、完整实现</h2><h3 id="3-1-Reflexion-Agent-主类"><a href="#3-1-Reflexion-Agent-主类" class="headerlink" title="3.1 Reflexion Agent 主类"></a>3.1 Reflexion Agent 主类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Actor actor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Evaluator evaluator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SelfReflection selfReflection;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReflexionMemory memory;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">80</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;开始执行任务: &#123;&#125;&quot;</span>, task);</span><br><span class="line">        </span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;=== 第 &#123;&#125; 次尝试 ===&quot;</span>, attempt);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 1. 检索相关经验</span></span><br><span class="line">            List&lt;String&gt; experiences = memory.recall(task, <span class="number">5</span>);</span><br><span class="line">            log.info(<span class="string">&quot;检索到 &#123;&#125; 条相关经验&quot;</span>, experiences.size());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. Actor 执行</span></span><br><span class="line">            <span class="type">ActorResult</span> <span class="variable">actorResult</span> <span class="operator">=</span> actor.execute(task, experiences);</span><br><span class="line">            log.info(<span class="string">&quot;执行完成&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. Evaluator 评估</span></span><br><span class="line">            <span class="type">EvaluationResult</span> <span class="variable">evalResult</span> <span class="operator">=</span> evaluator.evaluateWithLLM(</span><br><span class="line">                task, actorResult.getExecution()</span><br><span class="line">            );</span><br><span class="line">            log.info(<span class="string">&quot;评估得分: &#123;&#125;&quot;</span>, evalResult.getScore());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 记录本次尝试</span></span><br><span class="line">            attempts.add(<span class="keyword">new</span> <span class="title class_">AttemptRecord</span>(attempt, actorResult, evalResult));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. 检查是否成功</span></span><br><span class="line">            <span class="keyword">if</span> (evalResult.isSuccess() || evalResult.getScore() &gt;= SUCCESS_THRESHOLD) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;✅ 任务成功完成&quot;</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 成功也可以总结经验（可选）</span></span><br><span class="line">                <span class="keyword">if</span> (evalResult.getScore() == <span class="number">100</span>) &#123;</span><br><span class="line">                    saveSuccessExperience(task, actorResult);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                memory.clearShortTerm();</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.success(</span><br><span class="line">                    actorResult.getExecution(), attempts</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. Self-Reflection 反思</span></span><br><span class="line">            log.info(<span class="string">&quot;开始反思...&quot;</span>);</span><br><span class="line">            <span class="type">ReflectionResult</span> <span class="variable">reflection</span> <span class="operator">=</span> selfReflection.reflect(</span><br><span class="line">                ReflectionInput.builder()</span><br><span class="line">                    .task(task)</span><br><span class="line">                    .executionTrace(actorResult.getThinking())</span><br><span class="line">                    .result(actorResult.getExecution())</span><br><span class="line">                    .evaluationFeedback(evalResult.getOverallFeedback())</span><br><span class="line">                    .build()</span><br><span class="line">            );</span><br><span class="line">            </span><br><span class="line">            log.info(<span class="string">&quot;反思结果: &#123;&#125;&quot;</span>, reflection.getLessonsLearned());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 6. 存储经验</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">experience</span> <span class="operator">=</span> reflection.toExperienceText();</span><br><span class="line">            memory.addShortTerm(experience);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 如果是有价值的经验，存入长期记忆</span></span><br><span class="line">            <span class="keyword">if</span> (reflection.getConfidence() &gt; <span class="number">70</span>) &#123;</span><br><span class="line">                memory.addLongTerm(experience, classifyTask(task));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        log.warn(<span class="string">&quot;❌ 达到最大重试次数，任务未能成功完成&quot;</span>);</span><br><span class="line">        memory.clearShortTerm();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ReflexionResponse.failure(</span><br><span class="line">            attempts.get(attempts.size() - <span class="number">1</span>).getActorResult().getExecution(),</span><br><span class="line">            attempts</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">classifyTask</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        <span class="comment">// 简单的任务分类逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (task.contains(<span class="string">&quot;代码&quot;</span>) || task.contains(<span class="string">&quot;实现&quot;</span>) || task.contains(<span class="string">&quot;函数&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;coding&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (task.contains(<span class="string">&quot;分析&quot;</span>) || task.contains(<span class="string">&quot;解释&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;analysis&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;general&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveSuccessExperience</span><span class="params">(String task, ActorResult result)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">experience</span> <span class="operator">=</span> <span class="string">&quot;成功经验：任务「%s」的有效解决方案是：%s&quot;</span></span><br><span class="line">            .formatted(task, result.getThinking());</span><br><span class="line">        memory.addLongTerm(experience, classifyTask(task));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttemptRecord</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> attemptNumber;</span><br><span class="line">    <span class="keyword">private</span> ActorResult actorResult;</span><br><span class="line">    <span class="keyword">private</span> EvaluationResult evaluationResult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflexionResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> success;</span><br><span class="line">    <span class="keyword">private</span> String result;</span><br><span class="line">    <span class="keyword">private</span> List&lt;AttemptRecord&gt; attempts;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> totalAttempts;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ReflexionResponse <span class="title function_">success</span><span class="params">(String result, List&lt;AttemptRecord&gt; attempts)</span> &#123;</span><br><span class="line">        <span class="type">ReflexionResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReflexionResponse</span>();</span><br><span class="line">        response.success = <span class="literal">true</span>;</span><br><span class="line">        response.result = result;</span><br><span class="line">        response.attempts = attempts;</span><br><span class="line">        response.totalAttempts = attempts.size();</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ReflexionResponse <span class="title function_">failure</span><span class="params">(String result, List&lt;AttemptRecord&gt; attempts)</span> &#123;</span><br><span class="line">        <span class="type">ReflexionResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReflexionResponse</span>();</span><br><span class="line">        response.success = <span class="literal">false</span>;</span><br><span class="line">        response.result = result;</span><br><span class="line">        response.attempts = attempts;</span><br><span class="line">        response.totalAttempts = attempts.size();</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-Controller-层"><a href="#3-2-Controller-层" class="headerlink" title="3.2 Controller 层"></a>3.2 Controller 层</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/reflexion&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflexionController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReflexionAgent reflexionAgent;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/execute&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(<span class="meta">@RequestBody</span> TaskRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reflexionAgent.execute(request.getTask());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/memory/stats&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getMemoryStats</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 返回记忆统计信息</span></span><br><span class="line">        <span class="keyword">return</span> Map.of(</span><br><span class="line">            <span class="string">&quot;shortTermCount&quot;</span>, memory.getShortTermMemory().size(),</span><br><span class="line">            <span class="string">&quot;longTermCount&quot;</span>, memory.getLongTermCount()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaskRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String task;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四、实战案例"><a href="#四、实战案例" class="headerlink" title="四、实战案例"></a>四、实战案例</h2><h3 id="4-1-代码生成任务"><a href="#4-1-代码生成任务" class="headerlink" title="4.1 代码生成任务"></a>4.1 代码生成任务</h3><p><strong>任务</strong>：”用 Java 实现一个 LRU 缓存，支持 get 和 put 操作，时间复杂度 O(1)”</p>
<h4 id="第-1-次尝试"><a href="#第-1-次尝试" class="headerlink" title="第 1 次尝试"></a>第 1 次尝试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Actor 输出:</span><br><span class="line">public class LRUCache &#123;</span><br><span class="line">    private Map&lt;Integer, Integer&gt; cache;</span><br><span class="line">    private int capacity;</span><br><span class="line">    </span><br><span class="line">    public LRUCache(int capacity) &#123;</span><br><span class="line">        this.cache = new HashMap&lt;&gt;();</span><br><span class="line">        this.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public int get(int key) &#123;</span><br><span class="line">        return cache.getOrDefault(key, -1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void put(int key, int value) &#123;</span><br><span class="line">        if (cache.size() &gt;= capacity) &#123;</span><br><span class="line">            // 删除最旧的？但 HashMap 无序...</span><br><span class="line">            cache.remove(cache.keySet().iterator().next());</span><br><span class="line">        &#125;</span><br><span class="line">        cache.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Evaluator 反馈:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;success&quot;: false,</span><br><span class="line">  &quot;score&quot;: 40,</span><br><span class="line">  &quot;specific_issues&quot;: [</span><br><span class="line">    &quot;HashMap 无法保证 LRU 顺序&quot;,</span><br><span class="line">    &quot;删除的不一定是最久未使用的元素&quot;,</span><br><span class="line">    &quot;get 操作没有更新访问顺序&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Self-Reflection:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;problem_diagnosis&quot;: &quot;使用了普通 HashMap，无法维护访问顺序&quot;,</span><br><span class="line">  &quot;root_cause&quot;: &quot;没有考虑 LRU 需要记录访问顺序的特性&quot;,</span><br><span class="line">  &quot;lessons_learned&quot;: [</span><br><span class="line">    &quot;LRU 缓存需要能记录访问顺序的数据结构&quot;,</span><br><span class="line">    &quot;可以使用 LinkedHashMap 或自己实现双向链表 + HashMap&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;improvement_plan&quot;: &quot;使用 LinkedHashMap 并重写 removeEldestEntry 方法&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第-2-次尝试"><a href="#第-2-次尝试" class="headerlink" title="第 2 次尝试"></a>第 2 次尝试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Actor 输出（带经验）:</span><br><span class="line">public class LRUCache extends LinkedHashMap&lt;Integer, Integer&gt; &#123;</span><br><span class="line">    private int capacity;</span><br><span class="line">    </span><br><span class="line">    public LRUCache(int capacity) &#123;</span><br><span class="line">        super(capacity, 0.75f, true); // true 表示按访问顺序</span><br><span class="line">        this.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public int get(int key) &#123;</span><br><span class="line">        return super.getOrDefault(key, -1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void put(int key, int value) &#123;</span><br><span class="line">        super.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    protected boolean removeEldestEntry(Map.Entry eldest) &#123;</span><br><span class="line">        return size() &gt; capacity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Evaluator 反馈:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;success&quot;: true,</span><br><span class="line">  &quot;score&quot;: 95,</span><br><span class="line">  &quot;overall_feedback&quot;: &quot;正确实现了 LRU 缓存，使用 LinkedHashMap 简洁高效&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">✅ 成功完成</span><br></pre></td></tr></table></figure>

<h3 id="4-2-数据分析任务"><a href="#4-2-数据分析任务" class="headerlink" title="4.2 数据分析任务"></a>4.2 数据分析任务</h3><p><strong>任务</strong>：”分析这段 SQL 的性能问题并给出优化建议”</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> users u <span class="keyword">ON</span> o.user_id <span class="operator">=</span> u.id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> products p <span class="keyword">ON</span> o.product_id <span class="operator">=</span> p.id</span><br><span class="line"><span class="keyword">WHERE</span> o.created_at <span class="operator">&gt;</span> <span class="string">&#x27;2024-01-01&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.created_at <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h4 id="反思改进过程"><a href="#反思改进过程" class="headerlink" title="反思改进过程"></a>反思改进过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">第 1 次：只关注了索引问题</span><br><span class="line">经验：SQL 优化要全面考虑索引、查询字段、连接方式等</span><br><span class="line"></span><br><span class="line">第 2 次：增加了字段选择建议</span><br><span class="line">经验：SELECT * 是常见性能问题，应明确指出</span><br><span class="line"></span><br><span class="line">第 3 次：完整分析</span><br><span class="line">- 索引建议：created_at, user_id, product_id</span><br><span class="line">- 查询优化：避免 SELECT *</span><br><span class="line">- 连接优化：考虑是否需要 LEFT JOIN</span><br><span class="line">- 分页建议：大数据量需要分页</span><br><span class="line"></span><br><span class="line">✅ 成功</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五、进阶优化"><a href="#五、进阶优化" class="headerlink" title="五、进阶优化"></a>五、进阶优化</h2><h3 id="5-1-分层反思"><a href="#5-1-分层反思" class="headerlink" title="5.1 分层反思"></a>5.1 分层反思</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HierarchicalReflection</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 浅层反思：快速修复</span></span><br><span class="line">    <span class="keyword">public</span> QuickFix <span class="title function_">shallowReflect</span><span class="params">(EvaluationResult eval)</span> &#123;</span><br><span class="line">        <span class="comment">// 针对具体错误的快速修复建议</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 深层反思：根因分析</span></span><br><span class="line">    <span class="keyword">public</span> DeepAnalysis <span class="title function_">deepReflect</span><span class="params">(List&lt;AttemptRecord&gt; attempts)</span> &#123;</span><br><span class="line">        <span class="comment">// 多次失败后的深度分析</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 元反思：反思策略本身</span></span><br><span class="line">    <span class="keyword">public</span> MetaReflection <span class="title function_">metaReflect</span><span class="params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;</span><br><span class="line">        <span class="comment">// 反思的反思：反思策略是否有效</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-经验蒸馏"><a href="#5-2-经验蒸馏" class="headerlink" title="5.2 经验蒸馏"></a>5.2 经验蒸馏</h3><p>定期将碎片化经验整合为结构化知识：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(cron = &quot;0 0 2 * * ?&quot;)</span> <span class="comment">// 每天凌晨2点</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">distillExperiences</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 获取最近的经验</span></span><br><span class="line">    List&lt;Document&gt; recentExperiences = memory.getRecentExperiences(<span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 聚类相似经验</span></span><br><span class="line">    Map&lt;String, List&lt;Document&gt;&gt; clusters = clusterExperiences(recentExperiences);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 为每个聚类生成总结</span></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;Document&gt;&gt; entry : clusters.entrySet()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">summary</span> <span class="operator">=</span> llm.summarize(entry.getValue());</span><br><span class="line">        memory.addDistilledKnowledge(entry.getKey(), summary);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-经验迁移"><a href="#5-3-经验迁移" class="headerlink" title="5.3 经验迁移"></a>5.3 经验迁移</h3><p>跨任务类型迁移通用经验：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">transferExperiences</span><span class="params">(String newTask)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">taskType</span> <span class="operator">=</span> classifyTask(newTask);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取同类型任务经验</span></span><br><span class="line">    List&lt;String&gt; sameTypeExp = memory.getByTaskType(taskType);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取通用经验（适用于所有任务）</span></span><br><span class="line">    List&lt;String&gt; universalExp = memory.getUniversalExperiences();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 智能筛选可迁移的经验</span></span><br><span class="line">    <span class="keyword">return</span> filterTransferableExperiences(newTask, sameTypeExp, universalExp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="六、最佳实践"><a href="#六、最佳实践" class="headerlink" title="六、最佳实践"></a>六、最佳实践</h2><h3 id="6-1-评估器设计"><a href="#6-1-评估器设计" class="headerlink" title="6.1 评估器设计"></a>6.1 评估器设计</h3><table>
<thead>
<tr>
<th>任务类型</th>
<th>推荐评估方式</th>
</tr>
</thead>
<tbody><tr>
<td>代码生成</td>
<td>测试用例 + 静态分析</td>
</tr>
<tr>
<td>文本写作</td>
<td>LLM 评估 + 规则检查</td>
</tr>
<tr>
<td>数学计算</td>
<td>结果验证</td>
</tr>
<tr>
<td>信息检索</td>
<td>人工抽检 + LLM 评估</td>
</tr>
</tbody></table>
<h3 id="6-2-反思深度控制"><a href="#6-2-反思深度控制" class="headerlink" title="6.2 反思深度控制"></a>6.2 反思深度控制</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据失败次数调整反思深度</span></span><br><span class="line"><span class="keyword">public</span> ReflectionResult <span class="title function_">adaptiveReflect</span><span class="params">(<span class="type">int</span> attemptCount, ...)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (attemptCount == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> quickReflect(...);  <span class="comment">// 快速反思</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (attemptCount == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> normalReflect(...); <span class="comment">// 标准反思</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> deepReflect(...);   <span class="comment">// 深度反思</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-避免过度反思"><a href="#6-3-避免过度反思" class="headerlink" title="6.3 避免过度反思"></a>6.3 避免过度反思</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检测是否陷入无效循环</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isStuck</span><span class="params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (reflections.size() &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查最近两次反思是否相似度过高</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">1</span>).toExperienceText();</span><br><span class="line">    <span class="type">String</span> <span class="variable">prev</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">2</span>).toExperienceText();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> calculateSimilarity(last, prev) &gt; <span class="number">0.8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="七、迭代控制与循环避免"><a href="#七、迭代控制与循环避免" class="headerlink" title="七、迭代控制与循环避免"></a>七、迭代控制与循环避免</h2><h3 id="7-1-迭代次数控制机制"><a href="#7-1-迭代次数控制机制" class="headerlink" title="7.1 迭代次数控制机制"></a>7.1 迭代次数控制机制</h3><h4 id="基础控制：最大重试次数"><a href="#基础控制：最大重试次数" class="headerlink" title="基础控制：最大重试次数"></a>基础控制：最大重试次数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 核心控制参数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">3</span>;           <span class="comment">// 最多重试 3 次</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">80</span>;    <span class="comment">// 成功阈值 80 分</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 关键：for 循环限制迭代次数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;=== 第 &#123;&#125; 次尝试 ===&quot;</span>, attempt);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ... 执行逻辑 ...</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 成功则立即返回，不继续迭代</span></span><br><span class="line">            <span class="keyword">if</span> (evalResult.isSuccess() || evalResult.getScore() &gt;= SUCCESS_THRESHOLD) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;✅ 任务成功完成&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.success(result, attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 失败则继续下一次迭代</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 达到最大次数后返回失败</span></span><br><span class="line">        log.warn(<span class="string">&quot;❌ 达到最大重试次数，任务未能成功完成&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ReflexionResponse.failure(lastResult, attempts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间复杂度：O(MAX_RETRIES)</span></span><br><span class="line"><span class="comment">// 空间复杂度：O(MAX_RETRIES)</span></span><br></pre></td></tr></table></figure>

<p><strong>思路分析</strong>：</p>
<ul>
<li>使用 <code>for</code> 循环而不是 <code>while</code>，明确限制迭代次数</li>
<li>成功时立即返回，不浪费资源</li>
<li>达到最大次数自动停止，不会无限循环</li>
</ul>
<h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>建议值</th>
<th>影响</th>
</tr>
</thead>
<tbody><tr>
<td><strong>MAX_RETRIES</strong></td>
<td>最大重试次数</td>
<td>3-5</td>
<td>次数越多，成功率越高但成本越高</td>
</tr>
<tr>
<td><strong>SUCCESS_THRESHOLD</strong></td>
<td>成功评分阈值</td>
<td>80-90</td>
<td>阈值越高，要求越严格</td>
</tr>
<tr>
<td><strong>MAX_REFLECTION_DEPTH</strong></td>
<td>最大反思深度</td>
<td>2-3</td>
<td>控制反思的详细程度</td>
</tr>
</tbody></table>
<h3 id="7-2-多层次的循环控制"><a href="#7-2-多层次的循环控制" class="headerlink" title="7.2 多层次的循环控制"></a>7.2 多层次的循环控制</h3><h4 id="方式1：基于成功率的动态控制"><a href="#方式1：基于成功率的动态控制" class="headerlink" title="方式1：基于成功率的动态控制"></a>方式1：基于成功率的动态控制</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdaptiveReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">80</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">MIN_IMPROVEMENT_RATE</span> <span class="operator">=</span> <span class="number">0.05</span>;  <span class="comment">// 最小改进率 5%</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastScore</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">            <span class="comment">// ... 执行逻辑 ...</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">currentScore</span> <span class="operator">=</span> evalResult.getScore();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 1. 成功则返回</span></span><br><span class="line">            <span class="keyword">if</span> (currentScore &gt;= SUCCESS_THRESHOLD) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;✅ 任务成功&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.success(result, attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. 检查是否有改进</span></span><br><span class="line">            <span class="type">double</span> <span class="variable">improvementRate</span> <span class="operator">=</span> (<span class="type">double</span>)(currentScore - lastScore) / lastScore;</span><br><span class="line">            <span class="keyword">if</span> (attempt &gt; <span class="number">2</span> &amp;&amp; improvementRate &lt; MIN_IMPROVEMENT_RATE) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;⚠️ 改进不足 &#123;&#125;%，停止迭代&quot;</span>, MIN_IMPROVEMENT_RATE * <span class="number">100</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.failure(result, attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            lastScore = currentScore;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        log.warn(<span class="string">&quot;❌ 达到最大重试次数&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ReflexionResponse.failure(lastResult, attempts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 思路：</span></span><br><span class="line"><span class="comment">// 第1次：得分 40</span></span><br><span class="line"><span class="comment">// 第2次：得分 60（改进 50%，继续）</span></span><br><span class="line"><span class="comment">// 第3次：得分 65（改进 8%，继续）</span></span><br><span class="line"><span class="comment">// 第4次：得分 66（改进 1.5% &lt; 5%，停止）</span></span><br></pre></td></tr></table></figure>

<p><strong>思路分析</strong>：</p>
<ul>
<li>不仅限制次数，还检查改进幅度</li>
<li>如果连续改进不足，提前停止</li>
<li>避免在无效循环中浪费资源</li>
</ul>
<h4 id="方式2：基于反思相似度的控制"><a href="#方式2：基于反思相似度的控制" class="headerlink" title="方式2：基于反思相似度的控制"></a>方式2：基于反思相似度的控制</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">SIMILARITY_THRESHOLD</span> <span class="operator">=</span> <span class="number">0.8</span>;  <span class="comment">// 相似度阈值</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;ReflectionResult&gt; reflections = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">            <span class="comment">// ... 执行逻辑 ...</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (evalResult.isSuccess()) &#123;</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.success(result, attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 反思</span></span><br><span class="line">            <span class="type">ReflectionResult</span> <span class="variable">reflection</span> <span class="operator">=</span> selfReflection.reflect(input);</span><br><span class="line">            reflections.add(reflection);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 检测是否陷入循环</span></span><br><span class="line">            <span class="keyword">if</span> (isStuckInLoop(reflections)) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;⚠️ 检测到无效循环，停止迭代&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.failure(result, attempts);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ReflexionResponse.failure(lastResult, attempts);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检测是否陷入循环</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isStuckInLoop</span><span class="params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (reflections.size() &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取最近两次反思</span></span><br><span class="line">        <span class="type">ReflectionResult</span> <span class="variable">last</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">1</span>);</span><br><span class="line">        <span class="type">ReflectionResult</span> <span class="variable">prev</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 计算相似度</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> calculateSimilarity(</span><br><span class="line">            last.toExperienceText(),</span><br><span class="line">            prev.toExperienceText()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;反思相似度: &#123;&#125;&quot;</span>, similarity);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果相似度过高，说明陷入循环</span></span><br><span class="line">        <span class="keyword">return</span> similarity &gt; SIMILARITY_THRESHOLD;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateSimilarity</span><span class="params">(String text1, String text2)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用余弦相似度或编辑距离</span></span><br><span class="line">        <span class="comment">// 这里简化处理</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">commonChars</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxLen</span> <span class="operator">=</span> Math.max(text1.length(), text2.length());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : text1.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (text2.contains(String.valueOf(c))) &#123;</span><br><span class="line">                commonChars++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>) commonChars / maxLen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 思路：</span></span><br><span class="line"><span class="comment">// 第1次反思：问题是&quot;没有考虑边界情况&quot;</span></span><br><span class="line"><span class="comment">// 第2次反思：问题是&quot;没有考虑边界情况&quot;（相似度 95%）</span></span><br><span class="line"><span class="comment">// → 检测到循环，停止迭代</span></span><br></pre></td></tr></table></figure>

<p><strong>思路分析</strong>：</p>
<ul>
<li>监测反思内容的相似度</li>
<li>如果反思重复，说明陷入死循环</li>
<li>提前停止避免浪费资源</li>
</ul>
<h3 id="7-3-循环风险识别"><a href="#7-3-循环风险识别" class="headerlink" title="7.3 循环风险识别"></a>7.3 循环风险识别</h3><h4 id="常见的无限循环场景"><a href="#常见的无限循环场景" class="headerlink" title="常见的无限循环场景"></a>常见的无限循环场景</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 场景1：评估标准过高</span></span><br><span class="line"><span class="comment">// 问题：SUCCESS_THRESHOLD = 100（完美）</span></span><br><span class="line"><span class="comment">// 结果：永远无法满足，陷入循环</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">100</span>;  <span class="comment">// 不现实</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决：设置合理的阈值</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">80</span>;   <span class="comment">// 80% 就认为成功</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 场景2：反思没有产生新的改进方案</span></span><br><span class="line"><span class="comment">// 问题：每次反思都说&quot;需要更仔细&quot;，但没有具体改进</span></span><br><span class="line"><span class="comment">// 结果：Actor 重复同样的错误</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">reflect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 反思结果：需要更仔细地处理</span></span><br><span class="line">    <span class="comment">// 改进方案：无（空）</span></span><br><span class="line">    <span class="comment">// → 下次还是同样的错误</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决：要求反思必须产生具体的改进方案</span></span><br><span class="line"><span class="type">ReflectionResult</span> <span class="variable">reflection</span> <span class="operator">=</span> selfReflection.reflect(input);</span><br><span class="line"><span class="keyword">if</span> (reflection.getImprovementPlan() == <span class="literal">null</span> || </span><br><span class="line">    reflection.getImprovementPlan().isEmpty()) &#123;</span><br><span class="line">    log.warn(<span class="string">&quot;反思未产生改进方案，停止迭代&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ReflexionResponse.failure(result, attempts);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 场景3：经验没有被正确应用</span></span><br><span class="line"><span class="comment">// 问题：Actor 收到经验但没有真正应用</span></span><br><span class="line"><span class="comment">// 结果：每次都犯同样的错误</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(String task, List&lt;String&gt; experiences)</span> &#123;</span><br><span class="line">    <span class="comment">// 虽然收到了经验，但在 Prompt 中没有强调</span></span><br><span class="line">    <span class="comment">// → Actor 忽视了经验</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 解决：在 Prompt 中强调经验的重要性</span></span><br><span class="line"><span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ## 历史经验教训（必须参考！）</span></span><br><span class="line"><span class="string">    %s</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ## 重要提示</span></span><br><span class="line"><span class="string">    上次失败的原因是：%s</span></span><br><span class="line"><span class="string">    请务必避免重复这个错误！</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.formatted(experiences, lastFailureReason);</span><br></pre></td></tr></table></figure>

<p><strong>思路分析</strong>：</p>
<ul>
<li>识别循环的根本原因</li>
<li>在设计阶段就预防循环</li>
<li>不是简单地增加重试次数</li>
</ul>
<h3 id="7-4-完整的循环控制实现"><a href="#7-4-完整的循环控制实现" class="headerlink" title="7.4 完整的循环控制实现"></a>7.4 完整的循环控制实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobustReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 多层次的控制参数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">80</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">MIN_IMPROVEMENT_RATE</span> <span class="operator">=</span> <span class="number">0.05</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">SIMILARITY_THRESHOLD</span> <span class="operator">=</span> <span class="number">0.8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_CONSECUTIVE_FAILURES</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;ReflectionResult&gt; reflections = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastScore</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">consecutiveFailures</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;=== 第 &#123;&#125; 次尝试 ===&quot;</span>, attempt);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 1. 执行</span></span><br><span class="line">            <span class="type">ActorResult</span> <span class="variable">actorResult</span> <span class="operator">=</span> actor.execute(task, memory.recall(task, <span class="number">5</span>));</span><br><span class="line">            <span class="type">EvaluationResult</span> <span class="variable">evalResult</span> <span class="operator">=</span> evaluator.evaluateWithLLM(task, actorResult.getExecution());</span><br><span class="line">            <span class="type">int</span> <span class="variable">currentScore</span> <span class="operator">=</span> evalResult.getScore();</span><br><span class="line">            </span><br><span class="line">            attempts.add(<span class="keyword">new</span> <span class="title class_">AttemptRecord</span>(attempt, actorResult, evalResult));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. 检查成功</span></span><br><span class="line">            <span class="keyword">if</span> (currentScore &gt;= SUCCESS_THRESHOLD) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;✅ 任务成功完成&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.success(actorResult.getExecution(), attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. 检查改进率（从第2次开始）</span></span><br><span class="line">            <span class="keyword">if</span> (attempt &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">double</span> <span class="variable">improvementRate</span> <span class="operator">=</span> (<span class="type">double</span>)(currentScore - lastScore) / Math.max(lastScore, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (improvementRate &lt; MIN_IMPROVEMENT_RATE) &#123;</span><br><span class="line">                    consecutiveFailures++;</span><br><span class="line">                    log.warn(<span class="string">&quot;改进不足: &#123;&#125;%&quot;</span>, improvementRate * <span class="number">100</span>);</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> (consecutiveFailures &gt;= MAX_CONSECUTIVE_FAILURES) &#123;</span><br><span class="line">                        log.warn(<span class="string">&quot;⚠️ 连续 &#123;&#125; 次改进不足，停止迭代&quot;</span>, MAX_CONSECUTIVE_FAILURES);</span><br><span class="line">                        <span class="keyword">return</span> ReflexionResponse.failure(actorResult.getExecution(), attempts);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    consecutiveFailures = <span class="number">0</span>;  <span class="comment">// 重置计数器</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. 反思</span></span><br><span class="line">            <span class="type">ReflectionResult</span> <span class="variable">reflection</span> <span class="operator">=</span> selfReflection.reflect(</span><br><span class="line">                ReflectionInput.builder()</span><br><span class="line">                    .task(task)</span><br><span class="line">                    .executionTrace(actorResult.getThinking())</span><br><span class="line">                    .result(actorResult.getExecution())</span><br><span class="line">                    .evaluationFeedback(evalResult.getOverallFeedback())</span><br><span class="line">                    .build()</span><br><span class="line">            );</span><br><span class="line">            reflections.add(reflection);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. 检查是否陷入循环</span></span><br><span class="line">            <span class="keyword">if</span> (isStuckInLoop(reflections)) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;⚠️ 检测到无效循环，停止迭代&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.failure(actorResult.getExecution(), attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 6. 检查反思质量</span></span><br><span class="line">            <span class="keyword">if</span> (reflection.getImprovementPlan() == <span class="literal">null</span> || </span><br><span class="line">                reflection.getImprovementPlan().isEmpty()) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;⚠️ 反思未产生改进方案，停止迭代&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.failure(actorResult.getExecution(), attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 7. 存储经验</span></span><br><span class="line">            memory.addShortTerm(reflection.toExperienceText());</span><br><span class="line">            <span class="keyword">if</span> (reflection.getConfidence() &gt; <span class="number">70</span>) &#123;</span><br><span class="line">                memory.addLongTerm(reflection.toExperienceText(), classifyTask(task));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            lastScore = currentScore;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        log.warn(<span class="string">&quot;❌ 达到最大重试次数&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ReflexionResponse.failure(attempts.get(attempts.size() - <span class="number">1</span>).getActorResult().getExecution(), attempts);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isStuckInLoop</span><span class="params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (reflections.size() &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">1</span>).toExperienceText();</span><br><span class="line">        <span class="type">String</span> <span class="variable">prev</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">2</span>).toExperienceText();</span><br><span class="line">        </span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> calculateSimilarity(last, prev);</span><br><span class="line">        <span class="keyword">return</span> similarity &gt; SIMILARITY_THRESHOLD;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateSimilarity</span><span class="params">(String text1, String text2)</span> &#123;</span><br><span class="line">        <span class="comment">// 实现相似度计算</span></span><br><span class="line">        <span class="comment">// 可以使用 Levenshtein 距离、余弦相似度等</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 控制流程：</span></span><br><span class="line"><span class="comment">// 第1次：得分 40 → 继续</span></span><br><span class="line"><span class="comment">// 第2次：得分 60（改进 50%）→ 继续</span></span><br><span class="line"><span class="comment">// 第3次：得分 62（改进 3% &lt; 5%）→ 计数器 +1</span></span><br><span class="line"><span class="comment">// 第4次：得分 63（改进 1.6% &lt; 5%）→ 计数器 +1（达到 2）→ 停止</span></span><br></pre></td></tr></table></figure>

<p><strong>思路分析</strong>：</p>
<ul>
<li><strong>多层次防护</strong>：次数限制 + 改进率检查 + 循环检测 + 反思质量检查</li>
<li><strong>连续失败计数</strong>：允许偶尔的改进不足，但连续多次就停止</li>
<li><strong>综合判断</strong>：不依赖单一指标，多个条件共同决定是否继续</li>
</ul>
<h3 id="7-5-监控和日志"><a href="#7-5-监控和日志" class="headerlink" title="7.5 监控和日志"></a>7.5 监控和日志</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonitoredReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">attemptStart</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// ... 执行逻辑 ...</span></span><br><span class="line">                </span><br><span class="line">                <span class="type">long</span> <span class="variable">attemptDuration</span> <span class="operator">=</span> System.currentTimeMillis() - attemptStart;</span><br><span class="line">                log.info(<span class="string">&quot;第 &#123;&#125; 次尝试耗时: &#123;&#125;ms，得分: &#123;&#125;&quot;</span>, </span><br><span class="line">                    attempt, attemptDuration, evalResult.getScore());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">totalDuration</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">            log.info(<span class="string">&quot;任务总耗时: &#123;&#125;ms，总尝试次数: &#123;&#125;&quot;</span>, totalDuration, attempts.size());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 记录统计信息</span></span><br><span class="line">            logStatistics(attempts);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">logStatistics</span><span class="params">(List&lt;AttemptRecord&gt; attempts)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (attempts.isEmpty()) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">maxScore</span> <span class="operator">=</span> attempts.stream()</span><br><span class="line">            .mapToInt(a -&gt; a.getEvaluationResult().getScore())</span><br><span class="line">            .max()</span><br><span class="line">            .orElse(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">double</span> <span class="variable">avgScore</span> <span class="operator">=</span> attempts.stream()</span><br><span class="line">            .mapToInt(a -&gt; a.getEvaluationResult().getScore())</span><br><span class="line">            .average()</span><br><span class="line">            .orElse(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;统计信息 - 最高分: &#123;&#125;，平均分: &#123;:.2f&#125;，总次数: &#123;&#125;&quot;</span>, </span><br><span class="line">            maxScore, avgScore, attempts.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 日志输出示例：</span></span><br><span class="line"><span class="comment">// === 第 1 次尝试 ===</span></span><br><span class="line"><span class="comment">// 第 1 次尝试耗时: 2341ms，得分: 40</span></span><br><span class="line"><span class="comment">// === 第 2 次尝试 ===</span></span><br><span class="line"><span class="comment">// 第 2 次尝试耗时: 2156ms，得分: 65</span></span><br><span class="line"><span class="comment">// === 第 3 次尝试 ===</span></span><br><span class="line"><span class="comment">// 第 3 次尝试耗时: 2089ms，得分: 68</span></span><br><span class="line"><span class="comment">// ⚠️ 改进不足: 4.6%，停止迭代</span></span><br><span class="line"><span class="comment">// 统计信息 - 最高分: 68，平均分: 57.67，总次数: 3</span></span><br></pre></td></tr></table></figure>

<p><strong>思路分析</strong>：</p>
<ul>
<li>记录每次尝试的耗时和得分</li>
<li>便于分析性能和改进效果</li>
<li>帮助调整控制参数</li>
</ul>
<hr>
<h2 id="相关笔记"><a href="#相关笔记" class="headerlink" title="相关笔记"></a>相关笔记</h2><ul>
<li>Agent架构模式详解</li>
<li>Prompt Engineering详解</li>
<li>大模型学习路线</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/SPARQL%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="一个来自于 AI+Obsidian 的知识库">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/SPARQL%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">SPARQL详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">图数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="SPARQL-详解"><a href="#SPARQL-详解" class="headerlink" title="SPARQL 详解"></a>SPARQL 详解</h1><blockquote>
<p><strong>ℹ️ 信息: 衍生来源</strong><br>本笔记衍生自 三元组详解</p>
</blockquote>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>SPARQL（SPARQL Protocol and RDF Query Language）</strong> 是 W3C 标准的 RDF 查询语言，类似于关系数据库的 SQL，用于查询和操作 RDF 数据。</p>
<h2 id="查询类型"><a href="#查询类型" class="headerlink" title="查询类型"></a>查询类型</h2><table>
<thead>
<tr>
<th>类型</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td><code>SELECT</code></td>
<td>返回匹配的变量绑定</td>
</tr>
<tr>
<td><code>CONSTRUCT</code></td>
<td>构造新的 RDF 图</td>
</tr>
<tr>
<td><code>ASK</code></td>
<td>返回布尔值（是否存在匹配）</td>
</tr>
<tr>
<td><code>DESCRIBE</code></td>
<td>返回资源的描述信息</td>
</tr>
</tbody></table>
<h2 id="基本语法结构"><a href="#基本语法结构" class="headerlink" title="基本语法结构"></a>基本语法结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PREFIX ex: &lt;http://example.org/&gt;</span><br><span class="line">PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;</span><br><span class="line"></span><br><span class="line">SELECT ?name ?age</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ?person foaf:name ?name .</span><br><span class="line">    ?person ex:年龄 ?age .</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="语法要素"><a href="#语法要素" class="headerlink" title="语法要素"></a>语法要素</h3><table>
<thead>
<tr>
<th>要素</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>PREFIX</code></td>
<td>定义命名空间前缀</td>
</tr>
<tr>
<td><code>SELECT</code></td>
<td>指定返回的变量</td>
</tr>
<tr>
<td><code>WHERE</code></td>
<td>定义图模式（匹配条件）</td>
</tr>
<tr>
<td><code>?var</code></td>
<td>变量，以 <code>?</code> 或 <code>$</code> 开头</td>
</tr>
<tr>
<td><code>.</code></td>
<td>三元组模式分隔符</td>
</tr>
</tbody></table>
<h2 id="基础查询示例"><a href="#基础查询示例" class="headerlink" title="基础查询示例"></a>基础查询示例</h2><h3 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有人的名字</span><br><span class="line">SELECT ?name</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ?person a ex:Person .</span><br><span class="line">    ?person foaf:name ?name .</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="可选匹配（OPTIONAL）"><a href="#可选匹配（OPTIONAL）" class="headerlink" title="可选匹配（OPTIONAL）"></a>可选匹配（OPTIONAL）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查询人名，年龄可选</span><br><span class="line">SELECT ?name ?age</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ?person foaf:name ?name .</span><br><span class="line">    OPTIONAL &#123; ?person ex:年龄 ?age &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="过滤条件（FILTER）"><a href="#过滤条件（FILTER）" class="headerlink" title="过滤条件（FILTER）"></a>过滤条件（FILTER）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查询年龄大于 20 的人</span><br><span class="line">SELECT ?name ?age</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ?person foaf:name ?name .</span><br><span class="line">    ?person ex:年龄 ?age .</span><br><span class="line">    FILTER (?age &gt; 20)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="常用过滤函数"><a href="#常用过滤函数" class="headerlink" title="常用过滤函数"></a>常用过滤函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>FILTER</code></td>
<td>条件过滤</td>
<td><code>FILTER (?age &gt; 20)</code></td>
</tr>
<tr>
<td><code>REGEX</code></td>
<td>正则匹配</td>
<td><code>FILTER REGEX(?name, &quot;^张&quot;)</code></td>
</tr>
<tr>
<td><code>BOUND</code></td>
<td>检查变量是否绑定</td>
<td><code>FILTER BOUND(?age)</code></td>
</tr>
<tr>
<td><code>LANG</code></td>
<td>获取语言标签</td>
<td><code>FILTER (LANG(?name) = &quot;zh&quot;)</code></td>
</tr>
<tr>
<td><code>STR</code></td>
<td>转换为字符串</td>
<td><code>STR(?uri)</code></td>
</tr>
</tbody></table>
<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 统计每个城市的人数</span><br><span class="line">SELECT ?city (COUNT(?person) AS ?count)</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ?person ex:居住于 ?city .</span><br><span class="line">&#125;</span><br><span class="line">GROUP BY ?city</span><br><span class="line">HAVING (COUNT(?person) &gt; 10)</span><br><span class="line">ORDER BY DESC(?count)</span><br><span class="line">LIMIT 10</span><br></pre></td></tr></table></figure>

<h3 id="聚合函数列表"><a href="#聚合函数列表" class="headerlink" title="聚合函数列表"></a>聚合函数列表</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>COUNT</code></td>
<td>计数</td>
</tr>
<tr>
<td><code>SUM</code></td>
<td>求和</td>
</tr>
<tr>
<td><code>AVG</code></td>
<td>平均值</td>
</tr>
<tr>
<td><code>MIN</code> &#x2F; <code>MAX</code></td>
<td>最小&#x2F;最大值</td>
</tr>
<tr>
<td><code>GROUP_CONCAT</code></td>
<td>字符串连接</td>
</tr>
<tr>
<td><code>SAMPLE</code></td>
<td>随机取样</td>
</tr>
</tbody></table>
<h2 id="高级查询"><a href="#高级查询" class="headerlink" title="高级查询"></a>高级查询</h2><h3 id="UNION（联合查询）"><a href="#UNION（联合查询）" class="headerlink" title="UNION（联合查询）"></a>UNION（联合查询）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查询认识或喜欢李四的人</span><br><span class="line">SELECT ?person</span><br><span class="line">WHERE &#123;</span><br><span class="line">    &#123; ?person ex:认识 ex:李四 &#125;</span><br><span class="line">    UNION</span><br><span class="line">    &#123; ?person ex:喜欢 ex:李四 &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MINUS（差集）"><a href="#MINUS（差集）" class="headerlink" title="MINUS（差集）"></a>MINUS（差集）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查询没有年龄信息的人</span><br><span class="line">SELECT ?person</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ?person a ex:Person .</span><br><span class="line">    MINUS &#123; ?person ex:年龄 ?age &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 查询好友数最多的人</span><br><span class="line">SELECT ?person ?friendCount</span><br><span class="line">WHERE &#123;</span><br><span class="line">    &#123;</span><br><span class="line">        SELECT ?person (COUNT(?friend) AS ?friendCount)</span><br><span class="line">        WHERE &#123;</span><br><span class="line">            ?person ex:认识 ?friend .</span><br><span class="line">        &#125;</span><br><span class="line">        GROUP BY ?person</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ORDER BY DESC(?friendCount)</span><br><span class="line">LIMIT 1</span><br></pre></td></tr></table></figure>

<h2 id="属性路径"><a href="#属性路径" class="headerlink" title="属性路径"></a>属性路径</h2><p>SPARQL 1.1 支持属性路径表达式：</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>ex:a/ex:b</code></td>
<td>路径连接（a 然后 b）</td>
</tr>
<tr>
<td><code>ex:a|ex:b</code></td>
<td>路径选择（a 或 b）</td>
</tr>
<tr>
<td><code>ex:a*</code></td>
<td>零或多次</td>
</tr>
<tr>
<td><code>ex:a+</code></td>
<td>一或多次</td>
</tr>
<tr>
<td><code>ex:a?</code></td>
<td>零或一次</td>
</tr>
<tr>
<td><code>^ex:a</code></td>
<td>反向路径</td>
</tr>
</tbody></table>
<h3 id="属性路径示例"><a href="#属性路径示例" class="headerlink" title="属性路径示例"></a>属性路径示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查询张三直接或间接认识的人（传递闭包）</span><br><span class="line">SELECT ?person</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ex:张三 ex:认识+ ?person .</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 查询张三的朋友的朋友</span><br><span class="line">SELECT ?fof</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ex:张三 ex:认识/ex:认识 ?fof .</span><br><span class="line">    FILTER (?fof != ex:张三)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CONSTRUCT-构造查询"><a href="#CONSTRUCT-构造查询" class="headerlink" title="CONSTRUCT 构造查询"></a>CONSTRUCT 构造查询</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 构造新的 RDF 图</span><br><span class="line">CONSTRUCT &#123;</span><br><span class="line">    ?person ex:is_adult true .</span><br><span class="line">&#125;</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ?person ex:年龄 ?age .</span><br><span class="line">    FILTER (?age &gt;= 18)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="更新操作（SPARQL-Update）"><a href="#更新操作（SPARQL-Update）" class="headerlink" title="更新操作（SPARQL Update）"></a>更新操作（SPARQL Update）</h2><h3 id="INSERT-DATA"><a href="#INSERT-DATA" class="headerlink" title="INSERT DATA"></a>INSERT DATA</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INSERT DATA &#123;</span><br><span class="line">    ex:王五 a ex:Person ;</span><br><span class="line">           foaf:name &quot;王五&quot; ;</span><br><span class="line">           ex:年龄 30 .</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DELETE-DATA"><a href="#DELETE-DATA" class="headerlink" title="DELETE DATA"></a>DELETE DATA</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DELETE DATA &#123;</span><br><span class="line">    ex:张三 ex:年龄 25 .</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DELETE-INSERT"><a href="#DELETE-INSERT" class="headerlink" title="DELETE&#x2F;INSERT"></a>DELETE&#x2F;INSERT</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DELETE &#123; ?person ex:年龄 ?oldAge &#125;</span><br><span class="line">INSERT &#123; ?person ex:年龄 ?newAge &#125;</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ?person ex:年龄 ?oldAge .</span><br><span class="line">    BIND (?oldAge + 1 AS ?newAge)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="常用-SPARQL-端点"><a href="#常用-SPARQL-端点" class="headerlink" title="常用 SPARQL 端点"></a>常用 SPARQL 端点</h2><table>
<thead>
<tr>
<th>端点</th>
<th>URL</th>
</tr>
</thead>
<tbody><tr>
<td>DBpedia</td>
<td><code>https://dbpedia.org/sparql</code></td>
</tr>
<tr>
<td>Wikidata</td>
<td><code>https://query.wikidata.org/sparql</code></td>
</tr>
<tr>
<td>UniProt</td>
<td><code>https://sparql.uniprot.org/sparql</code></td>
</tr>
</tbody></table>
<h2 id="查询示例：Wikidata"><a href="#查询示例：Wikidata" class="headerlink" title="查询示例：Wikidata"></a>查询示例：Wikidata</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有中国城市</span><br><span class="line">SELECT ?city ?cityLabel ?population</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ?city wdt:P31 wd:Q515 .        # 实例类型：城市</span><br><span class="line">    ?city wdt:P17 wd:Q148 .        # 所属国家：中国</span><br><span class="line">    OPTIONAL &#123; ?city wdt:P1082 ?population &#125;</span><br><span class="line">    SERVICE wikibase:label &#123; bd:serviceParam wikibase:language &quot;zh,en&quot; &#125;</span><br><span class="line">&#125;</span><br><span class="line">ORDER BY DESC(?population)</span><br><span class="line">LIMIT 20</span><br></pre></td></tr></table></figure>

<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ul>
<li>三元组详解 - 衍生来源</li>
<li>RDF规范 - SPARQL 查询的数据格式</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/%E4%B8%89%E5%85%83%E7%BB%84%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="一个来自于 AI+Obsidian 的知识库">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/%E4%B8%89%E5%85%83%E7%BB%84%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">三元组详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">图数据库</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="三元组详解"><a href="#三元组详解" class="headerlink" title="三元组详解"></a>三元组详解</h1><h2 id="什么是三元组"><a href="#什么是三元组" class="headerlink" title="什么是三元组"></a>什么是三元组</h2><p>三元组（Triple）是 <strong>RDF 图数据库</strong> 中的基本数据存储单元，用于表达一个完整的事实陈述。</p>
<h3 id="三元组组成"><a href="#三元组组成" class="headerlink" title="三元组组成"></a>三元组组成</h3><table>
<thead>
<tr>
<th>组成部分</th>
<th>英文</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>主语</strong></td>
<td>Subject</td>
<td>被描述的实体或资源</td>
</tr>
<tr>
<td><strong>谓语</strong></td>
<td>Predicate</td>
<td>关系或属性</td>
</tr>
<tr>
<td><strong>宾语</strong></td>
<td>Object</td>
<td>属性值或关联的另一个实体</td>
</tr>
</tbody></table>
<h3 id="基本形式"><a href="#基本形式" class="headerlink" title="基本形式"></a>基本形式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Subject, Predicate, Object)</span><br></pre></td></tr></table></figure>

<h2 id="三元组示例"><a href="#三元组示例" class="headerlink" title="三元组示例"></a>三元组示例</h2><h3 id="表示关系"><a href="#表示关系" class="headerlink" title="表示关系"></a>表示关系</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(张三, 认识, 李四)</span><br><span class="line">(北京, 是首都, 中国)</span><br><span class="line">(Java, 属于, 编程语言)</span><br></pre></td></tr></table></figure>

<h3 id="表示属性"><a href="#表示属性" class="headerlink" title="表示属性"></a>表示属性</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(张三, 年龄, 25)</span><br><span class="line">(张三, 职业, &quot;软件工程师&quot;)</span><br><span class="line">(北京, 人口, 21540000)</span><br></pre></td></tr></table></figure>

<h2 id="核心特点"><a href="#核心特点" class="headerlink" title="核心特点"></a>核心特点</h2><ul>
<li><strong>原子性</strong>：每个三元组表达一个独立、不可分割的事实</li>
<li><strong>可组合</strong>：多个三元组通过共享节点形成复杂的知识图谱</li>
<li><strong>语义明确</strong>：谓语精确定义了主语和宾语之间的关系</li>
<li><strong>标准化</strong>：遵循 W3C RDF 标准，具有良好的互操作性</li>
</ul>
<h2 id="三元组-vs-属性图"><a href="#三元组-vs-属性图" class="headerlink" title="三元组 vs 属性图"></a>三元组 vs 属性图</h2><p>图数据库分为两大流派：<strong>RDF 图数据库</strong>和<strong>属性图数据库</strong>，虽然都是图数据库，但数据模型不同。👉详解 ^model-comparison</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>三元组模型（RDF）</th>
<th>属性图模型</th>
</tr>
</thead>
<tbody><tr>
<td>代表数据库</td>
<td>Apache Jena、Stardog</td>
<td>Neo4j、JanusGraph</td>
</tr>
<tr>
<td>边的属性</td>
<td>需要额外三元组表示（具体化）</td>
<td>边可直接附加属性</td>
</tr>
<tr>
<td>查询语言</td>
<td>SPARQL</td>
<td>Cypher、Gremlin</td>
</tr>
<tr>
<td>标准化程度</td>
<td>W3C 标准</td>
<td>无统一标准</td>
</tr>
<tr>
<td>适用场景</td>
<td>语义网、本体建模</td>
<td>社交网络、推荐系统</td>
</tr>
</tbody></table>
<h2 id="RDF-三元组表示法"><a href="#RDF-三元组表示法" class="headerlink" title="RDF 三元组表示法"></a>RDF 三元组表示法</h2><h3 id="N-Triples-格式"><a href="#N-Triples-格式" class="headerlink" title="N-Triples 格式"></a>N-Triples 格式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;http://example.org/张三&gt; &lt;http://example.org/认识&gt; &lt;http://example.org/李四&gt; .</span><br><span class="line">&lt;http://example.org/张三&gt; &lt;http://example.org/年龄&gt; &quot;25&quot;^^&lt;http://www.w3.org/2001/XMLSchema#integer&gt; .</span><br></pre></td></tr></table></figure>

<h3 id="Turtle-格式"><a href="#Turtle-格式" class="headerlink" title="Turtle 格式"></a>Turtle 格式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@prefix ex: &lt;http://example.org/&gt; .</span><br><span class="line">@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .</span><br><span class="line"></span><br><span class="line">ex:张三 ex:认识 ex:李四 ;</span><br><span class="line">        ex:年龄 &quot;25&quot;^^xsd:integer .</span><br></pre></td></tr></table></figure>

<h2 id="SPARQL-查询示例"><a href="#SPARQL-查询示例" class="headerlink" title="SPARQL 查询示例"></a>SPARQL 查询示例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查询张三认识的所有人</span><br><span class="line">SELECT ?person</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ex:张三 ex:认识 ?person .</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 查询所有年龄大于20的人</span><br><span class="line">SELECT ?person ?age</span><br><span class="line">WHERE &#123;</span><br><span class="line">    ?person ex:年龄 ?age .</span><br><span class="line">    FILTER (?age &gt; 20)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三元组在知识图谱中的应用"><a href="#三元组在知识图谱中的应用" class="headerlink" title="三元组在知识图谱中的应用"></a>三元组在知识图谱中的应用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[张三] --&gt;|认识| B[李四]</span><br><span class="line">    A --&gt;|工作于| C[阿里巴巴]</span><br><span class="line">    B --&gt;|工作于| D[腾讯]</span><br><span class="line">    C --&gt;|位于| E[杭州]</span><br><span class="line">    D --&gt;|位于| F[深圳]</span><br></pre></td></tr></table></figure>

<h2 id="实际应用场景"><a href="#实际应用场景" class="headerlink" title="实际应用场景"></a>实际应用场景</h2><ul>
<li><strong>知识图谱</strong>：Google Knowledge Graph、百度知识图谱</li>
<li><strong>语义网</strong>：Linked Open Data</li>
<li><strong>本体建模</strong>：OWL 本体描述</li>
<li><strong>智能问答</strong>：基于知识图谱的问答系统</li>
<li><strong>推荐系统</strong>：基于知识图谱的推荐</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>三元组是图数据库的基础数据结构，通过 <code>(主语, 谓语, 宾语)</code> 的形式表达事实。它是构建知识图谱的基石，广泛应用于语义网、智能问答等领域。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/%E5%88%86%E6%A8%A1%E5%9D%97%E6%89%93%E5%8C%85%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="一个来自于 AI+Obsidian 的知识库">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/%E5%88%86%E6%A8%A1%E5%9D%97%E6%89%93%E5%8C%85%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">分模块打包实战</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Maven/" itemprop="url" rel="index"><span itemprop="name">Maven</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Maven-分模块打包实战"><a href="#Maven-分模块打包实战" class="headerlink" title="Maven 分模块打包实战"></a>Maven 分模块打包实战</h1><h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><p>在多模块项目中，不同模块的打包方式和目标不同：</p>
<ul>
<li><strong>父模块</strong>：不打包，仅用于聚合</li>
<li><strong>公共模块</strong>：打包成普通 JAR，供其他模块依赖</li>
<li><strong>服务模块</strong>：打包成普通 JAR 或可执行 JAR</li>
<li><strong>启动模块</strong>：打包成可执行 JAR，包含所有依赖</li>
</ul>
<hr>
<h2 id="打包类型对比"><a href="#打包类型对比" class="headerlink" title="打包类型对比"></a>打包类型对比</h2><table>
<thead>
<tr>
<th>打包类型</th>
<th>packaging</th>
<th>产物</th>
<th>适用场景</th>
<th>大小</th>
</tr>
</thead>
<tbody><tr>
<td><strong>POM</strong></td>
<td><code>pom</code></td>
<td>无 JAR</td>
<td>父模块、聚合模块</td>
<td>-</td>
</tr>
<tr>
<td><strong>普通 JAR</strong></td>
<td><code>jar</code></td>
<td>仅包含本模块代码</td>
<td>公共模块、被依赖模块</td>
<td>小（几十 KB - 几 MB）</td>
</tr>
<tr>
<td><strong>可执行 JAR</strong></td>
<td><code>jar</code></td>
<td>包含所有依赖</td>
<td>启动模块、独立应用</td>
<td>大（几十 MB - 几百 MB）</td>
</tr>
<tr>
<td><strong>WAR</strong></td>
<td><code>war</code></td>
<td>Web 应用包</td>
<td>部署到 Tomcat 等容器</td>
<td>中等</td>
</tr>
</tbody></table>
<hr>
<h2 id="父模块打包配置"><a href="#父模块打包配置" class="headerlink" title="父模块打包配置"></a>父模块打包配置</h2><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父模块 pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span>  <span class="comment">&lt;!-- 必须是 pom --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>my-common<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>my-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>my-app<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>特点</strong>：</p>
<ul>
<li><code>packaging</code> 必须是 <code>pom</code></li>
<li>不会生成 JAR 文件</li>
<li>执行 <code>mvn package</code> 时会构建所有子模块</li>
</ul>
<hr>
<h2 id="公共模块打包配置"><a href="#公共模块打包配置" class="headerlink" title="公共模块打包配置"></a>公共模块打包配置</h2><p>公共模块（如 common、domain、repository）被其他模块依赖，只需打包成普通 JAR。</p>
<h3 id="基本配置-1"><a href="#基本配置-1" class="headerlink" title="基本配置"></a>基本配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- my-common/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span>  <span class="comment">&lt;!-- 默认就是 jar，可省略 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Maven JAR 插件（默认已配置） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">addDefaultImplementationEntries</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addDefaultImplementationEntries</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="打包产物"><a href="#打包产物" class="headerlink" title="打包产物"></a>打包产物</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my-common/target/</span><br><span class="line">└── my-common-1.0.0.jar      <span class="comment"># 只包含本模块编译的 class 文件</span></span><br></pre></td></tr></table></figure>

<p><strong>使用方式</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打包并安装到本地仓库</span></span><br><span class="line">mvn clean install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他模块通过依赖引用</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.example&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;my-common&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="启动模块打包配置"><a href="#启动模块打包配置" class="headerlink" title="启动模块打包配置"></a>启动模块打包配置</h2><p>启动模块需要打包成<strong>可执行 JAR</strong>，包含所有依赖，可独立运行。</p>
<h3 id="方式一：Spring-Boot-Maven-Plugin（推荐）"><a href="#方式一：Spring-Boot-Maven-Plugin（推荐）" class="headerlink" title="方式一：Spring Boot Maven Plugin（推荐）"></a>方式一：Spring Boot Maven Plugin（推荐）</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- my-app/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-app<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 依赖其他模块 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Spring Boot --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Spring Boot 打包插件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 指定主类（可选，自动检测） --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.example.MyApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 排除某些依赖（可选） --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>关键配置</strong>：</p>
<ul>
<li><code>repackage</code> goal：将依赖打包到 JAR 中</li>
<li>自动配置 MANIFEST.MF 中的 Main-Class</li>
<li>使用 Spring Boot 的类加载器</li>
</ul>
<p><strong>打包产物</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my-app/target/</span><br><span class="line">├── my-app-1.0.0.jar          <span class="comment"># 可执行 JAR（50-100 MB）</span></span><br><span class="line">└── my-app-1.0.0.jar.original <span class="comment"># 原始 JAR（只有本模块代码）</span></span><br></pre></td></tr></table></figure>

<p><strong>运行</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar target/my-app-1.0.0.jar</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="方式二：Maven-Assembly-Plugin（自定义打包）"><a href="#方式二：Maven-Assembly-Plugin（自定义打包）" class="headerlink" title="方式二：Maven Assembly Plugin（自定义打包）"></a>方式二：Maven Assembly Plugin（自定义打包）</h3><p>适用于非 Spring Boot 项目或需要自定义打包结构。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Assembly 插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.example.Main<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 预定义的打包方式 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>打包产物</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target/my-app-1.0.0-jar-with-dependencies.jar</span><br></pre></td></tr></table></figure>

<p><strong>运行</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar target/my-app-1.0.0-jar-with-dependencies.jar</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="方式三：Maven-Shade-Plugin（合并依赖）"><a href="#方式三：Maven-Shade-Plugin（合并依赖）" class="headerlink" title="方式三：Maven Shade Plugin（合并依赖）"></a>方式三：Maven Shade Plugin（合并依赖）</h3><p>适用于需要解决依赖冲突或重命名包的场景。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Shade 插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">transformers</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 指定主类 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">transformer</span> <span class="attr">implementation</span>=<span class="string">&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.example.Main<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 合并 Spring 配置文件 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">transformer</span> <span class="attr">implementation</span>=<span class="string">&quot;org.apache.maven.plugins.shade.resource.AppendingTransformer&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">resource</span>&gt;</span>META-INF/spring.handlers<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">transformer</span> <span class="attr">implementation</span>=<span class="string">&quot;org.apache.maven.plugins.shade.resource.AppendingTransformer&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">resource</span>&gt;</span>META-INF/spring.schemas<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">transformers</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 排除签名文件 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filters</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifact</span>&gt;</span>*:*<span class="tag">&lt;/<span class="name">artifact</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>META-INF/*.SF<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>META-INF/*.DSA<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>META-INF/*.RSA<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">filters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>特点</strong>：</p>
<ul>
<li>可以重命名包（relocate）避免冲突</li>
<li>可以合并 META-INF 下的配置文件</li>
<li>生成的 JAR 替换原始 JAR</li>
</ul>
<hr>
<h2 id="瘦-JAR-lib-目录方式"><a href="#瘦-JAR-lib-目录方式" class="headerlink" title="瘦 JAR + lib 目录方式"></a>瘦 JAR + lib 目录方式</h2><p>有些场景下不希望所有依赖打包到一个 JAR 中，可以采用瘦 JAR + lib 目录的方式。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 复制依赖到 lib 目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">includeScope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">includeScope</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- JAR 插件配置 classpath --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">classpathPrefix</span>&gt;</span>lib/<span class="tag">&lt;/<span class="name">classpathPrefix</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.example.Main<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="打包产物-1"><a href="#打包产物-1" class="headerlink" title="打包产物"></a>打包产物</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">target/</span><br><span class="line">├── my-app-1.0.0.jar          <span class="comment"># 瘦 JAR（只有本模块代码，几百 KB）</span></span><br><span class="line">└── lib/                      <span class="comment"># 依赖目录</span></span><br><span class="line">    ├── my-common-1.0.0.jar</span><br><span class="line">    ├── my-service-1.0.0.jar</span><br><span class="line">    ├── spring-boot-3.2.0.jar</span><br><span class="line">    └── ...</span><br></pre></td></tr></table></figure>

<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式 1：直接运行（MANIFEST.MF 已配置 classpath）</span></span><br><span class="line">java -jar target/my-app-1.0.0.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式 2：手动指定 classpath</span></span><br><span class="line">java -<span class="built_in">cp</span> <span class="string">&quot;target/my-app-1.0.0.jar:target/lib/*&quot;</span> com.example.Main</span><br></pre></td></tr></table></figure>

<p><strong>优点</strong>：</p>
<ul>
<li>更新单个模块时，只需替换对应的 JAR</li>
<li>依赖可复用，多个应用共享</li>
<li>JAR 文件小，传输快</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>部署时需要保持目录结构</li>
<li>不如单 JAR 方便</li>
</ul>
<hr>
<h2 id="常用打包命令"><a href="#常用打包命令" class="headerlink" title="常用打包命令"></a>常用打包命令</h2><h3 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清理 + 打包（跳过测试）</span></span><br><span class="line">mvn clean package -DskipTests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理 + 打包 + 安装到本地仓库</span></span><br><span class="line">mvn clean install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只打包特定模块</span></span><br><span class="line">mvn clean package -pl my-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包模块及其依赖</span></span><br><span class="line">mvn clean package -pl my-app -am</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包多个模块</span></span><br><span class="line">mvn clean package -pl my-common,my-service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过某个模块</span></span><br><span class="line">mvn clean package -pl !my-test</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并行构建（加速）</span></span><br><span class="line">mvn clean package -T 4</span><br></pre></td></tr></table></figure>

<h3 id="多环境打包"><a href="#多环境打包" class="headerlink" title="多环境打包"></a>多环境打包</h3><p>使用 Maven Profile 实现多环境打包：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父 POM 中定义 profiles --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开发环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">env</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">env</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 测试环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">env</span>&gt;</span>test<span class="tag">&lt;/<span class="name">env</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>test<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 生产环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">env</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">env</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">spring.profiles.active</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">spring.profiles.active</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>打包命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开发环境（默认）</span></span><br><span class="line">mvn clean package</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试环境</span></span><br><span class="line">mvn clean package -Ptest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生产环境</span></span><br><span class="line">mvn clean package -Pprod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同时激活多个 profile</span></span><br><span class="line">mvn clean package -Ptest,docker</span><br></pre></td></tr></table></figure>

<p><strong>资源过滤</strong>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>application.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>application-$&#123;env&#125;.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="打包优化"><a href="#打包优化" class="headerlink" title="打包优化"></a>打包优化</h2><h3 id="1-排除不必要的依赖"><a href="#1-排除不必要的依赖" class="headerlink" title="1. 排除不必要的依赖"></a>1. 排除不必要的依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 排除 provided scope 的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>  <span class="comment">&lt;!-- 编译时需要，运行时不需要 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 排除传递依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-依赖分析"><a href="#2-依赖分析" class="headerlink" title="2. 依赖分析"></a>2. 依赖分析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看依赖树</span></span><br><span class="line">mvn dependency:tree</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分析依赖冲突</span></span><br><span class="line">mvn dependency:tree -Dverbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看直接依赖</span></span><br><span class="line">mvn dependency:list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分析未使用的依赖</span></span><br><span class="line">mvn dependency:analyze</span><br></pre></td></tr></table></figure>

<h3 id="3-压缩-JAR-包"><a href="#3-压缩-JAR-包" class="headerlink" title="3. 压缩 JAR 包"></a>3. 压缩 JAR 包</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">compress</span>&gt;</span>true<span class="tag">&lt;/<span class="name">compress</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">index</span>&gt;</span>true<span class="tag">&lt;/<span class="name">index</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-跳过不必要的步骤"><a href="#4-跳过不必要的步骤" class="headerlink" title="4. 跳过不必要的步骤"></a>4. 跳过不必要的步骤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 跳过测试</span></span><br><span class="line">mvn clean package -DskipTests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过测试编译和执行</span></span><br><span class="line">mvn clean package -Dmaven.test.skip=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过 Javadoc 生成</span></span><br><span class="line">mvn clean package -Dmaven.javadoc.skip=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Docker-镜像打包"><a href="#Docker-镜像打包" class="headerlink" title="Docker 镜像打包"></a>Docker 镜像打包</h2><h3 id="方式一：Dockerfile-Maven-打包"><a href="#方式一：Dockerfile-Maven-打包" class="headerlink" title="方式一：Dockerfile + Maven 打包"></a>方式一：Dockerfile + Maven 打包</h3><h4 id="1-Maven-打包可执行-JAR"><a href="#1-Maven-打包可执行-JAR" class="headerlink" title="1. Maven 打包可执行 JAR"></a>1. Maven 打包可执行 JAR</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -DskipTests</span><br></pre></td></tr></table></figure>

<h4 id="2-编写-Dockerfile"><a href="#2-编写-Dockerfile" class="headerlink" title="2. 编写 Dockerfile"></a>2. 编写 Dockerfile</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多阶段构建（推荐）</span></span><br><span class="line"><span class="keyword">FROM</span> eclipse-temurin:<span class="number">17</span>-jdk-alpine AS builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制 Maven 配置和源码</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> pom.xml .</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> my-common ./my-common</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> my-service ./my-service</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> my-app ./my-app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Maven 打包</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> ./mvnw clean package -DskipTests</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行阶段</span></span><br><span class="line"><span class="keyword">FROM</span> eclipse-temurin:<span class="number">17</span>-jre-alpine</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制构建产物</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/my-app/target/my-app-1.0.0.jar app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动命令</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p><strong>简化版（本地已打包）</strong>：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> eclipse-temurin:<span class="number">17</span>-jre-alpine</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> my-app/target/my-app-1.0.0.jar app.jar</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h4 id="3-构建镜像"><a href="#3-构建镜像" class="headerlink" title="3. 构建镜像"></a>3. 构建镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建镜像</span></span><br><span class="line">docker build -t my-app:1.0.0 .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行容器</span></span><br><span class="line">docker run -d -p 8080:8080 my-app:1.0.0</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="方式二：Jib-Maven-Plugin（无需-Dockerfile）"><a href="#方式二：Jib-Maven-Plugin（无需-Dockerfile）" class="headerlink" title="方式二：Jib Maven Plugin（无需 Dockerfile）"></a>方式二：Jib Maven Plugin（无需 Dockerfile）</h3><p>Jib 是 Google 开源的 Maven&#x2F;Gradle 插件，无需 Dockerfile 即可构建 Docker 镜像。</p>
<h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Jib 插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.cloud.tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jib-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 基础镜像 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">from</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span>&gt;</span>eclipse-temurin:17-jre-alpine<span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 目标镜像 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">to</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">image</span>&gt;</span>my-app<span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">tags</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">tag</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">tag</span>&gt;</span>latest<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">tags</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 容器配置 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">container</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">jvmFlags</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">jvmFlag</span>&gt;</span>-Xms512m<span class="tag">&lt;/<span class="name">jvmFlag</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">jvmFlag</span>&gt;</span>-Xmx1024m<span class="tag">&lt;/<span class="name">jvmFlag</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">jvmFlags</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ports</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ports</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.example.MyApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">creationTime</span>&gt;</span>USE_CURRENT_TIMESTAMP<span class="tag">&lt;/<span class="name">creationTime</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">container</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="构建命令"><a href="#构建命令" class="headerlink" title="构建命令"></a>构建命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建到本地 Docker</span></span><br><span class="line">mvn compile jib:dockerBuild</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建并推送到 Docker Hub</span></span><br><span class="line">mvn compile jib:build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建到 tar 文件</span></span><br><span class="line">mvn compile jib:buildTar</span><br></pre></td></tr></table></figure>

<p><strong>优点</strong>：</p>
<ul>
<li>无需安装 Docker</li>
<li>无需编写 Dockerfile</li>
<li>构建速度快（增量构建）</li>
<li>自动优化镜像分层</li>
</ul>
<hr>
<h3 id="方式三：Spring-Boot-Maven-Plugin-构建镜像"><a href="#方式三：Spring-Boot-Maven-Plugin-构建镜像" class="headerlink" title="方式三：Spring Boot Maven Plugin 构建镜像"></a>方式三：Spring Boot Maven Plugin 构建镜像</h3><p>Spring Boot 2.3+ 内置了镜像构建功能（使用 Cloud Native Buildpacks）。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">image</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">name</span>&gt;</span>my-app:$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">env</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">BP_JVM_VERSION</span>&gt;</span>17<span class="tag">&lt;/<span class="name">BP_JVM_VERSION</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">env</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>构建命令</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建镜像</span></span><br><span class="line">mvn spring-boot:build-image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送镜像</span></span><br><span class="line">mvn spring-boot:build-image -Dspring-boot.build-image.publish=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="实战案例"><a href="#实战案例" class="headerlink" title="实战案例"></a>实战案例</h2><h3 id="场景-1：微服务项目打包"><a href="#场景-1：微服务项目打包" class="headerlink" title="场景 1：微服务项目打包"></a>场景 1：微服务项目打包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">microservices-project/</span><br><span class="line">├── pom.xml                    # 父 POM</span><br><span class="line">├── common/                    # 公共模块（普通 JAR）</span><br><span class="line">├── user-service/              # 用户服务（可执行 JAR）</span><br><span class="line">├── order-service/             # 订单服务（可执行 JAR）</span><br><span class="line">└── gateway/                   # 网关（可执行 JAR）</span><br></pre></td></tr></table></figure>

<h4 id="父-POM"><a href="#父-POM" class="headerlink" title="父 POM"></a>父 POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 统一配置 Spring Boot 插件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="公共模块-POM（common）"><a href="#公共模块-POM（common）" class="headerlink" title="公共模块 POM（common）"></a>公共模块 POM（common）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 不需要任何打包插件，默认打包成普通 JAR --&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="服务模块-POM（user-service）"><a href="#服务模块-POM（user-service）" class="headerlink" title="服务模块 POM（user-service）"></a>服务模块 POM（user-service）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>user-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用父 POM 中配置的 Spring Boot 插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="打包命令"><a href="#打包命令" class="headerlink" title="打包命令"></a>打包命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打包所有服务</span></span><br><span class="line">mvn clean package -DskipTests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只打包用户服务</span></span><br><span class="line">mvn clean package -pl user-service -am -DskipTests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生产环境打包</span></span><br><span class="line">mvn clean package -Pprod -DskipTests</span><br></pre></td></tr></table></figure>

<h4 id="产物"><a href="#产物" class="headerlink" title="产物"></a>产物</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">common/target/common-1.0.0.jar                     <span class="comment"># 普通 JAR</span></span><br><span class="line">user-service/target/user-service-1.0.0.jar         <span class="comment"># 可执行 JAR</span></span><br><span class="line">order-service/target/order-service-1.0.0.jar       <span class="comment"># 可执行 JAR</span></span><br><span class="line">gateway/target/gateway-1.0.0.jar                   <span class="comment"># 可执行 JAR</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="场景-2：框架项目打包（供第三方使用）"><a href="#场景-2：框架项目打包（供第三方使用）" class="headerlink" title="场景 2：框架项目打包（供第三方使用）"></a>场景 2：框架项目打包（供第三方使用）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rag-framework/</span><br><span class="line">├── pom.xml                    # 父 POM</span><br><span class="line">├── rag-core/                  # 核心模块（普通 JAR）</span><br><span class="line">├── rag-store-pgvector/        # 实现模块（普通 JAR）</span><br><span class="line">├── rag-spring-boot-starter/   # Starter（普通 JAR）</span><br><span class="line">└── rag-app/                   # 示例应用（可执行 JAR）</span><br></pre></td></tr></table></figure>

<h4 id="核心模块和实现模块"><a href="#核心模块和实现模块" class="headerlink" title="核心模块和实现模块"></a>核心模块和实现模块</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag-core/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 不需要特殊配置，打包成普通 JAR --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- rag-store-pgvector/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-store-pgvector<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 打包成普通 JAR，供用户按需引入 --&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="发布到-Maven-仓库"><a href="#发布到-Maven-仓库" class="headerlink" title="发布到 Maven 仓库"></a>发布到 Maven 仓库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建并安装到本地</span></span><br><span class="line">mvn clean install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署到私有仓库（需配置 distributionManagement）</span></span><br><span class="line">mvn clean deploy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布到 Maven 中央仓库（需配置 GPG 签名等）</span></span><br><span class="line">mvn clean deploy -P release</span><br></pre></td></tr></table></figure>

<h4 id="用户使用"><a href="#用户使用" class="headerlink" title="用户使用"></a>用户使用</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 用户项目 pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入核心 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 按需引入实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-store-pgvector<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="Q1-Spring-Boot-打包后-JAR-很大怎么办？"><a href="#Q1-Spring-Boot-打包后-JAR-很大怎么办？" class="headerlink" title="Q1: Spring Boot 打包后 JAR 很大怎么办？"></a>Q1: Spring Boot 打包后 JAR 很大怎么办？</h3><p><strong>A</strong>: 几种优化方式：</p>
<ol>
<li><p><strong>排除不必要的依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用瘦 JAR + lib 目录</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span>&gt;</span>ZIP<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用 Docker 分层构建</strong></p>
<ul>
<li>依赖层单独缓存，不需要每次都打包</li>
</ul>
</li>
</ol>
<hr>
<h3 id="Q2-多模块打包时出现-“Could-not-resolve-dependencies”-错误？"><a href="#Q2-多模块打包时出现-“Could-not-resolve-dependencies”-错误？" class="headerlink" title="Q2: 多模块打包时出现 “Could not resolve dependencies” 错误？"></a>Q2: 多模块打包时出现 “Could not resolve dependencies” 错误？</h3><p><strong>A</strong>: 原因和解决方法：</p>
<ol>
<li><p><strong>模块未安装到本地仓库</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先 install 依赖的模块</span></span><br><span class="line">mvn clean install -pl common -am</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>版本不一致</strong></p>
<ul>
<li>检查子模块版本是否与父 POM 一致</li>
<li>使用 <code>${project.version}</code> 引用</li>
</ul>
</li>
<li><p><strong>构建顺序错误</strong></p>
<ul>
<li>Maven 会自动计算依赖顺序</li>
<li>使用 <code>-am</code> 参数构建依赖模块</li>
</ul>
</li>
</ol>
<hr>
<h3 id="Q3-如何在打包时指定不同的配置文件？"><a href="#Q3-如何在打包时指定不同的配置文件？" class="headerlink" title="Q3: 如何在打包时指定不同的配置文件？"></a>Q3: 如何在打包时指定不同的配置文件？</h3><p><strong>A</strong>: 使用 Maven Profile + 资源过滤：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">config.file</span>&gt;</span>application-dev.yml<span class="tag">&lt;/<span class="name">config.file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">config.file</span>&gt;</span>application-prod.yml<span class="tag">&lt;/<span class="name">config.file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>打包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -Pprod</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Q4-如何生成源码-JAR-和-Javadoc-JAR？"><a href="#Q4-如何生成源码-JAR-和-Javadoc-JAR？" class="headerlink" title="Q4: 如何生成源码 JAR 和 Javadoc JAR？"></a>Q4: 如何生成源码 JAR 和 Javadoc JAR？</h3><p><strong>A</strong>: 用于发布到 Maven 仓库：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 源码 JAR --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Javadoc JAR --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-javadocs<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Q5-打包时如何跳过某些模块？"><a href="#Q5-打包时如何跳过某些模块？" class="headerlink" title="Q5: 打包时如何跳过某些模块？"></a>Q5: 打包时如何跳过某些模块？</h3><p><strong>A</strong>: 使用 <code>-pl</code> 和 <code>!</code> 排除：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 跳过测试模块</span></span><br><span class="line">mvn clean package -pl !test-module</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只打包指定模块</span></span><br><span class="line">mvn clean package -pl user-service,order-service</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="打包最佳实践"><a href="#打包最佳实践" class="headerlink" title="打包最佳实践"></a>打包最佳实践</h2><h3 id="1-模块职责清晰"><a href="#1-模块职责清晰" class="headerlink" title="1. 模块职责清晰"></a>1. 模块职责清晰</h3><table>
<thead>
<tr>
<th>模块类型</th>
<th>打包方式</th>
<th>发布</th>
</tr>
</thead>
<tbody><tr>
<td><strong>公共模块</strong></td>
<td>普通 JAR</td>
<td>install 到本地仓库</td>
</tr>
<tr>
<td><strong>服务模块</strong></td>
<td>普通 JAR 或可执行 JAR</td>
<td>看是否独立运行</td>
</tr>
<tr>
<td><strong>启动模块</strong></td>
<td>可执行 JAR</td>
<td>部署</td>
</tr>
</tbody></table>
<h3 id="2-统一管理插件版本"><a href="#2-统一管理插件版本" class="headerlink" title="2. 统一管理插件版本"></a>2. 统一管理插件版本</h3><p>在父 POM 的 <code>pluginManagement</code> 中统一配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-使用-Profile-管理多环境"><a href="#3-使用-Profile-管理多环境" class="headerlink" title="3. 使用 Profile 管理多环境"></a>3. 使用 Profile 管理多环境</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-优化构建速度"><a href="#4-优化构建速度" class="headerlink" title="4. 优化构建速度"></a>4. 优化构建速度</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 并行构建</span></span><br><span class="line">mvn clean package -T 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过测试</span></span><br><span class="line">mvn clean package -DskipTests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 离线模式（使用本地缓存）</span></span><br><span class="line">mvn clean package -o</span><br></pre></td></tr></table></figure>

<h3 id="5-依赖管理"><a href="#5-依赖管理" class="headerlink" title="5. 依赖管理"></a>5. 依赖管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定期分析依赖</span></span><br><span class="line">mvn dependency:analyze</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查版本冲突</span></span><br><span class="line">mvn dependency:tree -Dverbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理未使用的依赖</span></span><br><span class="line">mvn dependency:purge-local-repository</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><table>
<thead>
<tr>
<th>打包方式</th>
<th>适用场景</th>
<th>命令</th>
<th>产物大小</th>
</tr>
</thead>
<tbody><tr>
<td><strong>普通 JAR</strong></td>
<td>公共模块、被依赖模块</td>
<td><code>mvn package</code></td>
<td>小</td>
</tr>
<tr>
<td><strong>可执行 JAR（Spring Boot）</strong></td>
<td>启动模块、微服务</td>
<td><code>mvn package</code></td>
<td>大</td>
</tr>
<tr>
<td><strong>瘦 JAR + lib</strong></td>
<td>需要分离依赖的场景</td>
<td><code>mvn package</code></td>
<td>小 + lib 目录</td>
</tr>
<tr>
<td><strong>Docker 镜像</strong></td>
<td>容器化部署</td>
<td><code>mvn jib:dockerBuild</code></td>
<td>镜像</td>
</tr>
</tbody></table>
<p><strong>关键点</strong>：</p>
<ul>
<li>父模块 <code>packaging=pom</code>，不打包</li>
<li>公共模块打包成普通 JAR，<code>install</code> 到本地仓库</li>
<li>启动模块使用 Spring Boot Maven Plugin 打包成可执行 JAR</li>
<li>使用 Profile 管理多环境配置</li>
<li>使用 <code>-pl</code> 和 <code>-am</code> 精确控制打包范围</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="一个来自于 AI+Obsidian 的知识库">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" class="post-title-link" itemprop="url">大模型学习路线</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">大模型</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="大模型学习路线（Java工程师版）"><a href="#大模型学习路线（Java工程师版）" class="headerlink" title="大模型学习路线（Java工程师版）"></a>大模型学习路线（Java工程师版）</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本笔记专为 <strong>Java 工程师转型 AI&#x2F;大模型方向</strong> 设计，充分利用已有的编程基础，以最高效的路径切入大模型领域。</p>
<h2 id="学习路线总览"><a href="#学习路线总览" class="headerlink" title="学习路线总览"></a>学习路线总览</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[Java工程师] --&gt; B[Python基础]</span><br><span class="line">    A --&gt; C[Java生态AI工具]</span><br><span class="line">    B --&gt; D[LLM应用开发]</span><br><span class="line">    C --&gt; D</span><br><span class="line">    D --&gt; E[RAG技术]</span><br><span class="line">    D --&gt; F[Prompt Engineering]</span><br><span class="line">    E --&gt; G[向量数据库]</span><br><span class="line">    F --&gt; H[Agent开发]</span><br><span class="line">    G --&gt; I[企业级应用]</span><br><span class="line">    H --&gt; I</span><br><span class="line">    I --&gt; J[模型微调]</span><br></pre></td></tr></table></figure>

<h2 id="阶段一：基础准备（1-2周）"><a href="#阶段一：基础准备（1-2周）" class="headerlink" title="阶段一：基础准备（1-2周）"></a>阶段一：基础准备（1-2周）</h2><h3 id="1-1-Python-快速入门"><a href="#1-1-Python-快速入门" class="headerlink" title="1.1 Python 快速入门"></a>1.1 Python 快速入门</h3><table>
<thead>
<tr>
<th>学习内容</th>
<th>时间</th>
<th>优先级</th>
</tr>
</thead>
<tbody><tr>
<td>基础语法（变量、函数、类）</td>
<td>3天</td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td>常用库（requests, json）</td>
<td>2天</td>
<td>⭐⭐⭐</td>
</tr>
<tr>
<td>异步编程（asyncio）</td>
<td>2天</td>
<td>⭐⭐</td>
</tr>
<tr>
<td>虚拟环境与包管理</td>
<td>1天</td>
<td>⭐⭐⭐</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>💡 提示: Java 工程师优势</strong><br>Python 语法比 Java 简单很多，有 Java 基础 2-3 周可熟练使用</p>
</blockquote>
<h3 id="1-2-数学基础（按需补充）"><a href="#1-2-数学基础（按需补充）" class="headerlink" title="1.2 数学基础（按需补充）"></a>1.2 数学基础（按需补充）</h3><ul>
<li><strong>线性代数</strong> — 向量、矩阵运算（理解 Embedding 原理）</li>
<li><strong>概率统计</strong> — 概率分布、贝叶斯定理</li>
<li><strong>微积分</strong> — 梯度、导数（理解模型训练原理）</li>
</ul>
<blockquote>
<p><strong>📝 注意: 建议</strong><br>先跳过深入数学，遇到不懂的概念再回来补充</p>
</blockquote>
<h2 id="阶段二：LLM-应用开发（2-4周）"><a href="#阶段二：LLM-应用开发（2-4周）" class="headerlink" title="阶段二：LLM 应用开发（2-4周）"></a>阶段二：LLM 应用开发（2-4周）</h2><h3 id="2-1-核心概念"><a href="#2-1-核心概念" class="headerlink" title="2.1 核心概念"></a>2.1 核心概念</h3><table>
<thead>
<tr>
<th>概念</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Token</td>
<td>文本的最小处理单位</td>
</tr>
<tr>
<td>Embedding</td>
<td>文本的向量表示</td>
</tr>
<tr>
<td>Prompt</td>
<td>给模型的输入指令</td>
</tr>
<tr>
<td>Context Window</td>
<td>模型能处理的最大上下文长度</td>
</tr>
<tr>
<td>Temperature</td>
<td>控制输出随机性的参数</td>
</tr>
</tbody></table>
<h3 id="2-2-主流大模型-API"><a href="#2-2-主流大模型-API" class="headerlink" title="2.2 主流大模型 API"></a>2.2 主流大模型 API</h3><table>
<thead>
<tr>
<th>模型</th>
<th>厂商</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>GPT-4 &#x2F; GPT-4o</td>
<td>OpenAI</td>
<td>综合能力最强</td>
</tr>
<tr>
<td>Claude 3.5</td>
<td>Anthropic</td>
<td>长文本、代码能力强</td>
</tr>
<tr>
<td>通义千问</td>
<td>阿里巴巴</td>
<td>国内首选，中文能力好</td>
</tr>
<tr>
<td>文心一言</td>
<td>百度</td>
<td>国内主流</td>
</tr>
<tr>
<td>GLM-4</td>
<td>智谱AI</td>
<td>开源友好</td>
</tr>
</tbody></table>
<h3 id="2-3-开发框架选择"><a href="#2-3-开发框架选择" class="headerlink" title="2.3 开发框架选择"></a>2.3 开发框架选择</h3><h4 id="Python-生态"><a href="#Python-生态" class="headerlink" title="Python 生态"></a>Python 生态</h4><ul>
<li><strong>LangChain</strong> — 最流行的 LLM 应用框架</li>
<li><strong>LlamaIndex</strong> — 专注于 RAG 场景</li>
</ul>
<h4 id="Java-生态（推荐优先掌握）"><a href="#Java-生态（推荐优先掌握）" class="headerlink" title="Java 生态（推荐优先掌握）"></a>Java 生态（推荐优先掌握）</h4><ul>
<li><strong>Spring AI</strong> — Spring 官方 AI 框架，与 Spring Boot 无缝集成</li>
<li><strong>LangChain4j</strong> — LangChain 的 Java 版本</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Spring AI 示例</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatController</span><span class="params">(ChatClient.Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestParam</span> String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .user(message)</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="阶段三：RAG-技术（2-3周）"><a href="#阶段三：RAG-技术（2-3周）" class="headerlink" title="阶段三：RAG 技术（2-3周）"></a>阶段三：RAG 技术（2-3周）</h2><h3 id="3-1-RAG-原理"><a href="#3-1-RAG-原理" class="headerlink" title="3.1 RAG 原理"></a>3.1 RAG 原理</h3><p><strong>RAG（Retrieval-Augmented Generation）</strong> &#x3D; 检索 + 生成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[用户问题] --&gt; B[Embedding]</span><br><span class="line">    B --&gt; C[向量检索]</span><br><span class="line">    C --&gt; D[相关文档]</span><br><span class="line">    D --&gt; E[构建Prompt]</span><br><span class="line">    A --&gt; E</span><br><span class="line">    E --&gt; F[LLM生成]</span><br><span class="line">    F --&gt; G[回答]</span><br></pre></td></tr></table></figure>

<h3 id="3-2-向量数据库"><a href="#3-2-向量数据库" class="headerlink" title="3.2 向量数据库"></a>3.2 向量数据库</h3><table>
<thead>
<tr>
<th>数据库</th>
<th>特点</th>
<th>推荐场景</th>
</tr>
</thead>
<tbody><tr>
<td>Milvus</td>
<td>开源、高性能</td>
<td>生产环境首选</td>
</tr>
<tr>
<td>Pinecone</td>
<td>托管服务、易用</td>
<td>快速原型</td>
</tr>
<tr>
<td>Chroma</td>
<td>轻量、嵌入式</td>
<td>本地开发</td>
</tr>
<tr>
<td>Weaviate</td>
<td>GraphQL 支持</td>
<td>复杂查询</td>
</tr>
<tr>
<td>pgvector</td>
<td>PostgreSQL 插件</td>
<td>已有 PG 环境</td>
</tr>
</tbody></table>
<h3 id="3-3-核心流程"><a href="#3-3-核心流程" class="headerlink" title="3.3 核心流程"></a>3.3 核心流程</h3><ol>
<li><strong>文档加载</strong> — 读取 PDF、Word、网页等</li>
<li><strong>文本分割</strong> — 按 chunk 切分文档</li>
<li><strong>向量化</strong> — 调用 Embedding 模型</li>
<li><strong>存储</strong> — 写入向量数据库</li>
<li><strong>检索</strong> — 相似度搜索</li>
<li><strong>生成</strong> — 构建 Prompt 调用 LLM</li>
</ol>
<h2 id="阶段四：Prompt-Engineering（1-2周）"><a href="#阶段四：Prompt-Engineering（1-2周）" class="headerlink" title="阶段四：Prompt Engineering（1-2周）"></a>阶段四：Prompt Engineering（1-2周）</h2><h3 id="4-1-核心技巧"><a href="#4-1-核心技巧" class="headerlink" title="4.1 核心技巧"></a>4.1 核心技巧</h3><ul>
<li><strong>角色设定</strong> — 指定 AI 扮演的角色</li>
<li><strong>Few-shot</strong> — 提供示例引导输出格式</li>
<li><strong>Chain of Thought</strong> — 引导逐步推理</li>
<li><strong>结构化输出</strong> — 要求 JSON&#x2F;Markdown 格式</li>
</ul>
<h3 id="4-2-示例模板"><a href="#4-2-示例模板" class="headerlink" title="4.2 示例模板"></a>4.2 示例模板</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">你是一位资深的 Java 架构师。请根据以下代码分析潜在问题：</span><br><span class="line"></span><br><span class="line">## 代码</span><br><span class="line">&#123;code&#125;</span><br><span class="line"></span><br><span class="line">## 输出要求</span><br><span class="line">1. 问题列表（严重程度：高/中/低）</span><br><span class="line">2. 修改建议</span><br><span class="line">3. 最佳实践参考</span><br></pre></td></tr></table></figure>

<h2 id="阶段五：进阶方向"><a href="#阶段五：进阶方向" class="headerlink" title="阶段五：进阶方向"></a>阶段五：进阶方向</h2><h3 id="5-1-Agent-开发"><a href="#5-1-Agent-开发" class="headerlink" title="5.1 Agent 开发"></a>5.1 Agent 开发</h3><ul>
<li><strong>Function Calling</strong> — 让 LLM 调用外部工具</li>
<li><strong>ReAct 模式</strong> — 推理 + 行动循环</li>
<li><strong>Multi-Agent</strong> — 多智能体协作</li>
</ul>
<h3 id="5-2-模型微调"><a href="#5-2-模型微调" class="headerlink" title="5.2 模型微调"></a>5.2 模型微调</h3><table>
<thead>
<tr>
<th>技术</th>
<th>说明</th>
<th>资源需求</th>
</tr>
</thead>
<tbody><tr>
<td>Full Fine-tuning</td>
<td>全参数微调</td>
<td>极高（多卡A100）</td>
</tr>
<tr>
<td>LoRA</td>
<td>低秩适应</td>
<td>中等（单卡可行）</td>
</tr>
<tr>
<td>QLoRA</td>
<td>量化 + LoRA</td>
<td>低（消费级显卡）</td>
</tr>
<tr>
<td>Prompt Tuning</td>
<td>软提示微调</td>
<td>低</td>
</tr>
</tbody></table>
<h3 id="5-3-开源模型部署"><a href="#5-3-开源模型部署" class="headerlink" title="5.3 开源模型部署"></a>5.3 开源模型部署</h3><ul>
<li><strong>Ollama</strong> — 本地运行开源模型</li>
<li><strong>vLLM</strong> — 高性能推理引擎</li>
<li><strong>Text Generation Inference</strong> — HuggingFace 官方方案</li>
</ul>
<h2 id="推荐学习资源"><a href="#推荐学习资源" class="headerlink" title="推荐学习资源"></a>推荐学习资源</h2><h3 id="课程"><a href="#课程" class="headerlink" title="课程"></a>课程</h3><table>
<thead>
<tr>
<th>资源</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>吴恩达《Generative AI for Everyone》</td>
<td>入门概念</td>
</tr>
<tr>
<td>DeepLearning.AI 短课程系列</td>
<td>LangChain、RAG 等专题</td>
</tr>
<tr>
<td>李沐《动手学深度学习》</td>
<td>深入原理</td>
</tr>
</tbody></table>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><ul>
<li><a target="_blank" rel="noopener" href="https://python.langchain.com/">LangChain 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-ai/reference/">Spring AI 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://huggingface.co/learn">HuggingFace 教程</a></li>
</ul>
<h3 id="实践平台"><a href="#实践平台" class="headerlink" title="实践平台"></a>实践平台</h3><ul>
<li><strong>Colab</strong> — 免费 GPU 环境</li>
<li><strong>Kaggle</strong> — 数据集 + GPU</li>
<li><strong>魔搭社区</strong> — 国内模型平台</li>
</ul>
<h2 id="实战项目建议"><a href="#实战项目建议" class="headerlink" title="实战项目建议"></a>实战项目建议</h2><h3 id="入门项目"><a href="#入门项目" class="headerlink" title="入门项目"></a>入门项目</h3><ol>
<li><strong>智能客服</strong> — 基于 RAG 的问答系统</li>
<li><strong>文档助手</strong> — PDF&#x2F;文档智能问答</li>
<li><strong>代码助手</strong> — 代码解释、Review 工具</li>
</ol>
<h3 id="进阶项目"><a href="#进阶项目" class="headerlink" title="进阶项目"></a>进阶项目</h3><ol>
<li><strong>企业知识库</strong> — 多数据源、权限控制</li>
<li><strong>AI Agent</strong> — 自动化任务执行</li>
<li><strong>垂直领域模型</strong> — 行业微调模型</li>
</ol>
<h2 id="时间规划建议"><a href="#时间规划建议" class="headerlink" title="时间规划建议"></a>时间规划建议</h2><table>
<thead>
<tr>
<th>阶段</th>
<th>时间</th>
<th>产出</th>
</tr>
</thead>
<tbody><tr>
<td>基础准备</td>
<td>2周</td>
<td>Python 熟练使用</td>
</tr>
<tr>
<td>LLM 应用</td>
<td>3周</td>
<td>完成第一个 AI 应用</td>
</tr>
<tr>
<td>RAG 技术</td>
<td>3周</td>
<td>构建知识库问答系统</td>
</tr>
<tr>
<td>进阶方向</td>
<td>持续</td>
<td>根据兴趣深入</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>⚠️ 重要: 核心建议</strong><br>从 <strong>Spring AI + 大模型 API</strong> 切入最快见效，边做项目边学习理论</p>
</blockquote>
<h2 id="相关笔记"><a href="#相关笔记" class="headerlink" title="相关笔记"></a>相关笔记</h2><ul>
<li>Python快速入门</li>
<li>LLM应用开发</li>
<li>RAG技术详解</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ZhiMy</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

<style>
.theme-toggle {
  position: fixed;
  right: 20px;
  bottom: 100px;
  z-index: 9999;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  transition: all 0.3s ease;
  background: var(--content-bg-color);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}
.theme-toggle:hover {
  transform: scale(1.1);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}
.theme-toggle .icon-sun,
.theme-toggle .icon-moon {
  position: absolute;
  transition: opacity 0.3s ease, transform 0.3s ease;
}
[data-theme="dark"] .theme-toggle .icon-sun {
  opacity: 1;
  transform: rotate(0deg);
}
[data-theme="dark"] .theme-toggle .icon-moon {
  opacity: 0;
  transform: rotate(-90deg);
}
[data-theme="light"] .theme-toggle .icon-sun {
  opacity: 0;
  transform: rotate(90deg);
}
[data-theme="light"] .theme-toggle .icon-moon {
  opacity: 1;
  transform: rotate(0deg);
}
/* 默认状态（跟随系统） */
.theme-toggle .icon-sun {
  opacity: 0;
}
.theme-toggle .icon-moon {
  opacity: 1;
}
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) .theme-toggle .icon-sun {
    opacity: 1;
    transform: rotate(0deg);
  }
  :root:not([data-theme="light"]) .theme-toggle .icon-moon {
    opacity: 0;
    transform: rotate(-90deg);
  }
}
</style>

<button class="theme-toggle" id="theme-toggle" aria-label="切换明暗模式">
  <span class="icon-sun">☀️</span>
  <span class="icon-moon">🌙</span>
</button>

<script>
(function() {
  const toggle = document.getElementById('theme-toggle');
  const root = document.documentElement;

  // 获取保存的主题或系统偏好
  function getPreferredTheme() {
    const saved = localStorage.getItem('theme');
    if (saved) return saved;
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }

  // 应用主题
  function applyTheme(theme) {
    root.setAttribute('data-theme', theme);
    root.style.colorScheme = theme;
  }

  // 初始化
  const currentTheme = localStorage.getItem('theme');
  if (currentTheme) {
    applyTheme(currentTheme);
  }

  // 切换主题
  toggle.addEventListener('click', function() {
    const current = root.getAttribute('data-theme') || getPreferredTheme();
    const next = current === 'dark' ? 'light' : 'dark';
    applyTheme(next);
    localStorage.setItem('theme', next);
  });

  // 监听系统主题变化（仅在用户未手动设置时生效）
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
    if (!localStorage.getItem('theme')) {
      applyTheme(e.matches ? 'dark' : 'light');
    }
  });
})();
</script>

</body>
</html>
