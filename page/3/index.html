<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zmmmmy.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.27.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
<meta property="og:type" content="website">
<meta property="og:title" content="Zmmmmy&#39;s Blog">
<meta property="og:url" content="https://zmmmmy.github.io/page/3/index.html">
<meta property="og:site_name" content="Zmmmmy&#39;s Blog">
<meta property="og:description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ZhiMy">
<meta property="article:tag" content="æŠ€æœ¯åšå®¢">
<meta property="article:tag" content="ç¼–ç¨‹">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zmmmmy.github.io/page/3/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zmmmmy's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zmmmmy's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">ä»Šå¤©æƒ³å’Œ AI èŠç‚¹ä»€ä¹ˆï¼Ÿ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ZhiMy"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ZhiMy</p>
  <div class="site-description" itemprop="description">ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">åˆ†ç±»</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">100</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Zmmmmy" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Zmmmmy" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/Reflexion%E8%87%AA%E5%8F%8D%E6%80%9DAgent%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/Reflexion%E8%87%AA%E5%8F%8D%E6%80%9DAgent%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Reflexionè‡ªåæ€Agentè¯¦è§£</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/%E5%A4%A7%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">å¤§æ¨¡å‹</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Reflexion-è‡ªåæ€-Agent-è¯¦è§£"><a href="#Reflexion-è‡ªåæ€-Agent-è¯¦è§£" class="headerlink" title="Reflexion è‡ªåæ€ Agent è¯¦è§£"></a>Reflexion è‡ªåæ€ Agent è¯¦è§£</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>Reflexion</strong> æ˜¯ä¸€ç§è®© Agent å…·å¤‡â€ä»é”™è¯¯ä¸­å­¦ä¹ â€èƒ½åŠ›çš„æ¶æ„æ¨¡å¼ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæ‰§è¡Œä»»åŠ¡åè¿›è¡Œè‡ªæˆ‘è¯„ä¼°å’Œåæ€ï¼Œå°†ç»éªŒæ•™è®­å­˜å…¥è®°å¿†ï¼Œåœ¨åç»­å°è¯•ä¸­é¿å…é‡å¤é”™è¯¯ã€‚</p>
<blockquote>
<p><strong>ğŸ’¡ æç¤º: æ ¸å¿ƒä»·å€¼</strong><br>ä¼ ç»Ÿ Agent æ¯æ¬¡éƒ½æ˜¯â€ä»é›¶å¼€å§‹â€ï¼Œè€Œ Reflexion Agent èƒ½å¤Ÿ<strong>ç§¯ç´¯ç»éªŒã€æŒç»­æ”¹è¿›</strong>ã€‚</p>
</blockquote>
<h2 id="ä¸ä¼ ç»Ÿ-Agent-çš„å¯¹æ¯”"><a href="#ä¸ä¼ ç»Ÿ-Agent-çš„å¯¹æ¯”" class="headerlink" title="ä¸ä¼ ç»Ÿ Agent çš„å¯¹æ¯”"></a>ä¸ä¼ ç»Ÿ Agent çš„å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>ä¼ ç»Ÿ Agent</th>
<th>Reflexion Agent</th>
</tr>
</thead>
<tbody><tr>
<td>å¤±è´¥å¤„ç†</td>
<td>ç®€å•é‡è¯•</td>
<td>åæ€åæ”¹è¿›å†è¯•</td>
</tr>
<tr>
<td>ç»éªŒç§¯ç´¯</td>
<td>æ— </td>
<td>æœ‰ï¼ˆè®°å¿†æ¨¡å—ï¼‰</td>
</tr>
<tr>
<td>å­¦ä¹ èƒ½åŠ›</td>
<td>æ— </td>
<td>ä»é”™è¯¯ä¸­å­¦ä¹ </td>
</tr>
<tr>
<td>æˆåŠŸç‡</td>
<td>éšæœº</td>
<td>é€æ¬¡æå‡</td>
</tr>
</tbody></table>
<hr>
<h2 id="ä¸€ã€æ ¸å¿ƒæ¶æ„"><a href="#ä¸€ã€æ ¸å¿ƒæ¶æ„" class="headerlink" title="ä¸€ã€æ ¸å¿ƒæ¶æ„"></a>ä¸€ã€æ ¸å¿ƒæ¶æ„</h2><h3 id="1-1-ä¸‰å¤§ç»„ä»¶"><a href="#1-1-ä¸‰å¤§ç»„ä»¶" class="headerlink" title="1.1 ä¸‰å¤§ç»„ä»¶"></a>1.1 ä¸‰å¤§ç»„ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    subgraph Reflexion Agent</span><br><span class="line">        A[Actor&lt;br/&gt;æ‰§è¡Œè€…] --&gt; B[Evaluator&lt;br/&gt;è¯„ä¼°è€…]</span><br><span class="line">        B --&gt; C&#123;æˆåŠŸ?&#125;</span><br><span class="line">        C --&gt;|æ˜¯| D[è¿”å›ç»“æœ]</span><br><span class="line">        C --&gt;|å¦| E[Self-Reflection&lt;br/&gt;è‡ªåæ€]</span><br><span class="line">        E --&gt; F[Memory&lt;br/&gt;ç»éªŒè®°å¿†]</span><br><span class="line">        F --&gt; A</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>èŒè´£</th>
<th>è¾“å…¥</th>
<th>è¾“å‡º</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Actor</strong></td>
<td>æ‰§è¡Œä»»åŠ¡</td>
<td>ä»»åŠ¡ + å†å²ç»éªŒ</td>
<td>æ‰§è¡Œç»“æœ</td>
</tr>
<tr>
<td><strong>Evaluator</strong></td>
<td>è¯„ä¼°ç»“æœè´¨é‡</td>
<td>ä»»åŠ¡ + ç»“æœ</td>
<td>æˆåŠŸ&#x2F;å¤±è´¥ + åé¦ˆ</td>
</tr>
<tr>
<td><strong>Self-Reflection</strong></td>
<td>åˆ†æå¤±è´¥åŸå› </td>
<td>æ‰§è¡Œå†å² + è¯„ä¼°åé¦ˆ</td>
<td>ç»éªŒæ•™è®­</td>
</tr>
<tr>
<td><strong>Memory</strong></td>
<td>å­˜å‚¨ç»éªŒ</td>
<td>åæ€ç»“æœ</td>
<td>å†å²ç»éªŒåˆ—è¡¨</td>
</tr>
</tbody></table>
<h3 id="1-2-æ‰§è¡Œæµç¨‹"><a href="#1-2-æ‰§è¡Œæµç¨‹" class="headerlink" title="1.2 æ‰§è¡Œæµç¨‹"></a>1.2 æ‰§è¡Œæµç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">    participant U as ç”¨æˆ·</span><br><span class="line">    participant A as Actor</span><br><span class="line">    participant E as Evaluator</span><br><span class="line">    participant R as Self-Reflection</span><br><span class="line">    participant M as Memory</span><br><span class="line">    </span><br><span class="line">    U-&gt;&gt;A: ä»»åŠ¡</span><br><span class="line">    M-&gt;&gt;A: å†å²ç»éªŒ</span><br><span class="line">    A-&gt;&gt;E: æ‰§è¡Œç»“æœ</span><br><span class="line">    E-&gt;&gt;E: è¯„ä¼°</span><br><span class="line">    </span><br><span class="line">    alt æˆåŠŸ</span><br><span class="line">        E-&gt;&gt;U: è¿”å›ç»“æœ</span><br><span class="line">    else å¤±è´¥</span><br><span class="line">        E-&gt;&gt;R: è¯„ä¼°åé¦ˆ</span><br><span class="line">        R-&gt;&gt;R: åæ€åˆ†æ</span><br><span class="line">        R-&gt;&gt;M: å­˜å‚¨ç»éªŒ</span><br><span class="line">        M-&gt;&gt;A: æ›´æ–°ç»éªŒ</span><br><span class="line">        Note over A: é‡æ–°å°è¯•</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="äºŒã€å„ç»„ä»¶è¯¦è§£"><a href="#äºŒã€å„ç»„ä»¶è¯¦è§£" class="headerlink" title="äºŒã€å„ç»„ä»¶è¯¦è§£"></a>äºŒã€å„ç»„ä»¶è¯¦è§£</h2><h3 id="2-1-Actorï¼ˆæ‰§è¡Œè€…ï¼‰"><a href="#2-1-Actorï¼ˆæ‰§è¡Œè€…ï¼‰" class="headerlink" title="2.1 Actorï¼ˆæ‰§è¡Œè€…ï¼‰"></a>2.1 Actorï¼ˆæ‰§è¡Œè€…ï¼‰</h3><p>Actor è´Ÿè´£å®é™…æ‰§è¡Œä»»åŠ¡ï¼Œä½†ä¼šå‚è€ƒå†å²ç»éªŒé¿å…é‡å¤é”™è¯¯ã€‚</p>
<h4 id="Prompt-æ¨¡æ¿"><a href="#Prompt-æ¨¡æ¿" class="headerlink" title="Prompt æ¨¡æ¿"></a>Prompt æ¨¡æ¿</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œè´Ÿè´£å®Œæˆç”¨æˆ·ä»»åŠ¡ã€‚</span><br><span class="line"></span><br><span class="line">## ä»»åŠ¡</span><br><span class="line">&#123;task&#125;</span><br><span class="line"></span><br><span class="line">## å†å²ç»éªŒæ•™è®­ï¼ˆè¯·åŠ¡å¿…å‚è€ƒï¼Œé¿å…é‡å¤é”™è¯¯ï¼‰</span><br><span class="line">&#123;experiences&#125;</span><br><span class="line"></span><br><span class="line">## è¦æ±‚</span><br><span class="line">1. ä»”ç»†é˜…è¯»å†å²ç»éªŒï¼Œé¿å…çŠ¯åŒæ ·çš„é”™è¯¯</span><br><span class="line">2. å¦‚æœå†å²ç»éªŒæåˆ°æŸç§æ–¹æ³•ä¸å¯è¡Œï¼Œè¯·å°è¯•å…¶ä»–æ–¹æ³•</span><br><span class="line">3. è¾“å‡ºä½ çš„æ€è€ƒè¿‡ç¨‹å’Œæœ€ç»ˆç»“æœ</span><br><span class="line"></span><br><span class="line">## è¾“å‡ºæ ¼å¼</span><br><span class="line">### æ€è€ƒ</span><br><span class="line">[åˆ†æä»»åŠ¡ï¼Œå‚è€ƒç»éªŒï¼Œè§„åˆ’æ–¹æ¡ˆ]</span><br><span class="line"></span><br><span class="line">### æ‰§è¡Œ</span><br><span class="line">[å…·ä½“æ‰§è¡Œæ­¥éª¤å’Œç»“æœ]</span><br></pre></td></tr></table></figure>

<h4 id="Java-å®ç°"><a href="#Java-å®ç°" class="headerlink" title="Java å®ç°"></a>Java å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Actor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ActorResult <span class="title function_">execute</span><span class="params">(String task, List&lt;String&gt; experiences)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">experienceText</span> <span class="operator">=</span> experiences.isEmpty() </span><br><span class="line">            ? <span class="string">&quot;æš‚æ— å†å²ç»éªŒ&quot;</span></span><br><span class="line">            : experiences.stream()</span><br><span class="line">                .map(e -&gt; <span class="string">&quot;- &quot;</span> + e)</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">            .system(ACTOR_PROMPT)</span><br><span class="line">            .user(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                ## ä»»åŠ¡</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                ## å†å²ç»éªŒæ•™è®­</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>.formatted(task, experienceText))</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parseActorResult(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActorResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String thinking;      <span class="comment">// æ€è€ƒè¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">private</span> String execution;     <span class="comment">// æ‰§è¡Œç»“æœ</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; actions; <span class="comment">// æ‰§è¡Œçš„åŠ¨ä½œåˆ—è¡¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-2-Evaluatorï¼ˆè¯„ä¼°è€…ï¼‰"><a href="#2-2-Evaluatorï¼ˆè¯„ä¼°è€…ï¼‰" class="headerlink" title="2.2 Evaluatorï¼ˆè¯„ä¼°è€…ï¼‰"></a>2.2 Evaluatorï¼ˆè¯„ä¼°è€…ï¼‰</h3><p>Evaluator è´Ÿè´£åˆ¤æ–­æ‰§è¡Œç»“æœæ˜¯å¦è¾¾æ ‡ï¼Œå¯ä»¥ç”¨ LLM è¯„ä¼°ã€è§„åˆ™è¯„ä¼°æˆ–æµ‹è¯•ç”¨ä¾‹è¯„ä¼°ã€‚</p>
<h4 id="è¯„ä¼°æ–¹å¼å¯¹æ¯”"><a href="#è¯„ä¼°æ–¹å¼å¯¹æ¯”" class="headerlink" title="è¯„ä¼°æ–¹å¼å¯¹æ¯”"></a>è¯„ä¼°æ–¹å¼å¯¹æ¯”</h4><table>
<thead>
<tr>
<th>è¯„ä¼°æ–¹å¼</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td><strong>LLM è¯„ä¼°</strong></td>
<td>å¼€æ”¾æ€§ä»»åŠ¡</td>
<td>çµæ´»</td>
<td>å¯èƒ½ä¸å‡†ç¡®</td>
</tr>
<tr>
<td><strong>è§„åˆ™è¯„ä¼°</strong></td>
<td>æœ‰æ˜ç¡®æ ‡å‡†çš„ä»»åŠ¡</td>
<td>å‡†ç¡®</td>
<td>ä¸å¤Ÿçµæ´»</td>
</tr>
<tr>
<td><strong>æµ‹è¯•ç”¨ä¾‹</strong></td>
<td>ä»£ç ç”Ÿæˆä»»åŠ¡</td>
<td>å®¢è§‚å‡†ç¡®</td>
<td>éœ€è¦é¢„å…ˆå‡†å¤‡</td>
</tr>
<tr>
<td><strong>äººå·¥è¯„ä¼°</strong></td>
<td>é«˜é£é™©å†³ç­–</td>
<td>æœ€å‡†ç¡®</td>
<td>æˆæœ¬é«˜</td>
</tr>
</tbody></table>
<h4 id="LLM-è¯„ä¼°-Prompt"><a href="#LLM-è¯„ä¼°-Prompt" class="headerlink" title="LLM è¯„ä¼° Prompt"></a>LLM è¯„ä¼° Prompt</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„ä»»åŠ¡è¯„ä¼°ä¸“å®¶ã€‚</span><br><span class="line"></span><br><span class="line">## åŸå§‹ä»»åŠ¡</span><br><span class="line">&#123;task&#125;</span><br><span class="line"></span><br><span class="line">## æ‰§è¡Œç»“æœ</span><br><span class="line">&#123;result&#125;</span><br><span class="line"></span><br><span class="line">## è¯„ä¼°ç»´åº¦</span><br><span class="line">1. **æ­£ç¡®æ€§**ï¼šç»“æœæ˜¯å¦æ­£ç¡®å®Œæˆäº†ä»»åŠ¡è¦æ±‚</span><br><span class="line">2. **å®Œæ•´æ€§**ï¼šæ˜¯å¦è¦†ç›–äº†æ‰€æœ‰è¦æ±‚</span><br><span class="line">3. **è´¨é‡**ï¼šç»“æœçš„è´¨é‡å¦‚ä½•</span><br><span class="line"></span><br><span class="line">## è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰</span><br><span class="line">&#123;</span><br><span class="line">  &quot;success&quot;: true/false,</span><br><span class="line">  &quot;score&quot;: 0-100,</span><br><span class="line">  &quot;dimensions&quot;: &#123;</span><br><span class="line">    &quot;correctness&quot;: &#123;&quot;score&quot;: 0-100, &quot;feedback&quot;: &quot;...&quot;&#125;,</span><br><span class="line">    &quot;completeness&quot;: &#123;&quot;score&quot;: 0-100, &quot;feedback&quot;: &quot;...&quot;&#125;,</span><br><span class="line">    &quot;quality&quot;: &#123;&quot;score&quot;: 0-100, &quot;feedback&quot;: &quot;...&quot;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;overall_feedback&quot;: &quot;æ€»ä½“è¯„ä»·&quot;,</span><br><span class="line">  &quot;specific_issues&quot;: [&quot;é—®é¢˜1&quot;, &quot;é—®é¢˜2&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Java-å®ç°-1"><a href="#Java-å®ç°-1" class="headerlink" title="Java å®ç°"></a>Java å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Evaluator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// LLM è¯„ä¼°</span></span><br><span class="line">    <span class="keyword">public</span> EvaluationResult <span class="title function_">evaluateWithLLM</span><span class="params">(String task, String result)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">            .system(EVALUATOR_PROMPT)</span><br><span class="line">            .user(<span class="string">&quot;ä»»åŠ¡ï¼š%s\n\nç»“æœï¼š%s&quot;</span>.formatted(task, result))</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parseJson(response, EvaluationResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»£ç ä»»åŠ¡ï¼šæµ‹è¯•ç”¨ä¾‹è¯„ä¼°</span></span><br><span class="line">    <span class="keyword">public</span> EvaluationResult <span class="title function_">evaluateCode</span><span class="params">(String code, List&lt;TestCase&gt; testCases)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">passed</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        List&lt;String&gt; failures = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (TestCase tc : testCases) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> executeCode(code, tc.getInput());</span><br><span class="line">                <span class="keyword">if</span> (tc.getExpected().equals(result)) &#123;</span><br><span class="line">                    passed++;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    failures.add(<span class="string">&quot;è¾“å…¥ %s æœŸæœ› %s å®é™… %s&quot;</span></span><br><span class="line">                        .formatted(tc.getInput(), tc.getExpected(), result));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                failures.add(<span class="string">&quot;è¾“å…¥ %s æ‰§è¡Œå¼‚å¸¸ï¼š%s&quot;</span></span><br><span class="line">                    .formatted(tc.getInput(), e.getMessage()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">score</span> <span class="operator">=</span> passed * <span class="number">100</span> / testCases.size();</span><br><span class="line">        <span class="keyword">return</span> EvaluationResult.builder()</span><br><span class="line">            .success(score &gt;= <span class="number">100</span>)</span><br><span class="line">            .score(score)</span><br><span class="line">            .specificIssues(failures)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EvaluationResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> success;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> score;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, DimensionScore&gt; dimensions;</span><br><span class="line">    <span class="keyword">private</span> String overallFeedback;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; specificIssues;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-3-Self-Reflectionï¼ˆè‡ªåæ€ï¼‰"><a href="#2-3-Self-Reflectionï¼ˆè‡ªåæ€ï¼‰" class="headerlink" title="2.3 Self-Reflectionï¼ˆè‡ªåæ€ï¼‰"></a>2.3 Self-Reflectionï¼ˆè‡ªåæ€ï¼‰</h3><p>Self-Reflection æ˜¯ Reflexion çš„æ ¸å¿ƒï¼Œè´Ÿè´£æ·±åº¦åˆ†æå¤±è´¥åŸå› å¹¶æ€»ç»“ç»éªŒã€‚</p>
<h4 id="åæ€-Prompt"><a href="#åæ€-Prompt" class="headerlink" title="åæ€ Prompt"></a>åæ€ Prompt</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">ä½ æ˜¯ä¸€ä¸ªå–„äºåæ€å’Œæ€»ç»“çš„åˆ†æä¸“å®¶ã€‚</span><br><span class="line"></span><br><span class="line">## ä»»åŠ¡ç›®æ ‡</span><br><span class="line">&#123;task&#125;</span><br><span class="line"></span><br><span class="line">## æ‰§è¡Œè¿‡ç¨‹</span><br><span class="line">&#123;execution_trace&#125;</span><br><span class="line"></span><br><span class="line">## æ‰§è¡Œç»“æœ</span><br><span class="line">&#123;result&#125;</span><br><span class="line"></span><br><span class="line">## è¯„ä¼°åé¦ˆ</span><br><span class="line">&#123;evaluation_feedback&#125;</span><br><span class="line"></span><br><span class="line">## è¯·è¿›è¡Œæ·±åº¦åæ€</span><br><span class="line"></span><br><span class="line">### 1. é—®é¢˜è¯Šæ–­</span><br><span class="line">- è¿™æ¬¡å°è¯•å…·ä½“å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Ÿ</span><br><span class="line">- æ˜¯ç†è§£é”™è¯¯ã€æ–¹æ³•é”™è¯¯è¿˜æ˜¯æ‰§è¡Œé”™è¯¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">### 2. æ ¹å› åˆ†æ</span><br><span class="line">- é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">- æ˜¯å¦æœ‰é”™è¯¯çš„å‡è®¾ï¼Ÿ</span><br><span class="line"></span><br><span class="line">### 3. ç»éªŒæ€»ç»“</span><br><span class="line">- ä»è¿™æ¬¡å¤±è´¥ä¸­å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ</span><br><span class="line">- ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜åº”è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</span><br><span class="line"></span><br><span class="line">### 4. æ”¹è¿›æ–¹æ¡ˆ</span><br><span class="line">- å…·ä½“çš„æ”¹è¿›æªæ–½æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">- ä¸‹ä¸€æ¬¡å°è¯•åº”è¯¥æ€ä¹ˆåšï¼Ÿ</span><br><span class="line"></span><br><span class="line">## è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰</span><br><span class="line">&#123;</span><br><span class="line">  &quot;problem_diagnosis&quot;: &quot;é—®é¢˜è¯Šæ–­&quot;,</span><br><span class="line">  &quot;root_cause&quot;: &quot;æ ¹æœ¬åŸå› &quot;,</span><br><span class="line">  &quot;lessons_learned&quot;: [</span><br><span class="line">    &quot;ç»éªŒ1ï¼š...&quot;,</span><br><span class="line">    &quot;ç»éªŒ2ï¼š...&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;improvement_plan&quot;: &quot;æ”¹è¿›æ–¹æ¡ˆ&quot;,</span><br><span class="line">  &quot;confidence&quot;: 0-100</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Java-å®ç°-2"><a href="#Java-å®ç°-2" class="headerlink" title="Java å®ç°"></a>Java å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelfReflection</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflectionResult <span class="title function_">reflect</span><span class="params">(ReflectionInput input)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">            .system(REFLECTION_PROMPT)</span><br><span class="line">            .user(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                ## ä»»åŠ¡ç›®æ ‡</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                ## æ‰§è¡Œè¿‡ç¨‹</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                ## æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                ## è¯„ä¼°åé¦ˆ</span></span><br><span class="line"><span class="string">                %s</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>.formatted(</span><br><span class="line">                    input.getTask(),</span><br><span class="line">                    input.getExecutionTrace(),</span><br><span class="line">                    input.getResult(),</span><br><span class="line">                    input.getEvaluationFeedback()</span><br><span class="line">                ))</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> parseJson(response, ReflectionResult.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionInput</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String task;</span><br><span class="line">    <span class="keyword">private</span> String executionTrace;</span><br><span class="line">    <span class="keyword">private</span> String result;</span><br><span class="line">    <span class="keyword">private</span> String evaluationFeedback;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String problemDiagnosis;</span><br><span class="line">    <span class="keyword">private</span> String rootCause;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; lessonsLearned;</span><br><span class="line">    <span class="keyword">private</span> String improvementPlan;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> confidence;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è½¬æ¢ä¸ºå¯å­˜å‚¨çš„ç»éªŒæ–‡æœ¬</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toExperienceText</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            é—®é¢˜ï¼š%s</span></span><br><span class="line"><span class="string">            åŸå› ï¼š%s</span></span><br><span class="line"><span class="string">            æ•™è®­ï¼š%s</span></span><br><span class="line"><span class="string">            æ”¹è¿›ï¼š%s</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>.formatted(</span><br><span class="line">                problemDiagnosis,</span><br><span class="line">                rootCause,</span><br><span class="line">                String.join(<span class="string">&quot;ï¼›&quot;</span>, lessonsLearned),</span><br><span class="line">                improvementPlan</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-4-Memoryï¼ˆè®°å¿†æ¨¡å—ï¼‰"><a href="#2-4-Memoryï¼ˆè®°å¿†æ¨¡å—ï¼‰" class="headerlink" title="2.4 Memoryï¼ˆè®°å¿†æ¨¡å—ï¼‰"></a>2.4 Memoryï¼ˆè®°å¿†æ¨¡å—ï¼‰</h3><p>Memory è´Ÿè´£å­˜å‚¨å’Œæ£€ç´¢ç»éªŒï¼Œæ”¯æŒçŸ­æœŸè®°å¿†ï¼ˆå½“å‰ä»»åŠ¡ï¼‰å’Œé•¿æœŸè®°å¿†ï¼ˆè·¨ä»»åŠ¡ï¼‰ã€‚</p>
<h4 id="è®°å¿†æ¶æ„"><a href="#è®°å¿†æ¶æ„" class="headerlink" title="è®°å¿†æ¶æ„"></a>è®°å¿†æ¶æ„</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    subgraph Memory</span><br><span class="line">        A[çŸ­æœŸè®°å¿†] --&gt; C[ç»éªŒæ£€ç´¢]</span><br><span class="line">        B[é•¿æœŸè®°å¿†] --&gt; C</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    D[å½“å‰ä»»åŠ¡ç»éªŒ] --&gt; A</span><br><span class="line">    E[å†å²ä»»åŠ¡ç»éªŒ] --&gt; B</span><br><span class="line">    C --&gt; F[ç›¸å…³ç»éªŒ]</span><br></pre></td></tr></table></figure>

<h4 id="Java-å®ç°-3"><a href="#Java-å®ç°-3" class="headerlink" title="Java å®ç°"></a>Java å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflexionMemory</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çŸ­æœŸè®°å¿†ï¼šå½“å‰ä»»åŠ¡çš„å°è¯•å†å²</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;String&gt; shortTermMemory = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é•¿æœŸè®°å¿†ï¼šå‘é‡æ•°æ®åº“</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VectorStore vectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·»åŠ çŸ­æœŸè®°å¿†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addShortTerm</span><span class="params">(String experience)</span> &#123;</span><br><span class="line">        shortTermMemory.add(experience);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¸…ç©ºçŸ­æœŸè®°å¿†ï¼ˆä»»åŠ¡å®Œæˆåï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clearShortTerm</span><span class="params">()</span> &#123;</span><br><span class="line">        shortTermMemory.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·»åŠ é•¿æœŸè®°å¿†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLongTerm</span><span class="params">(String experience, String taskType)</span> &#123;</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>(</span><br><span class="line">            experience,</span><br><span class="line">            Map.of(</span><br><span class="line">                <span class="string">&quot;task_type&quot;</span>, taskType,</span><br><span class="line">                <span class="string">&quot;timestamp&quot;</span>, System.currentTimeMillis(),</span><br><span class="line">                <span class="string">&quot;source&quot;</span>, <span class="string">&quot;reflexion&quot;</span></span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">        vectorStore.add(List.of(doc));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€ç´¢ç›¸å…³ç»éªŒ</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">recall</span><span class="params">(String task, <span class="type">int</span> topK)</span> &#123;</span><br><span class="line">        List&lt;String&gt; experiences = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 1. æ·»åŠ çŸ­æœŸè®°å¿†ï¼ˆå½“å‰ä»»åŠ¡çš„æ‰€æœ‰å°è¯•ï¼‰</span></span><br><span class="line">        experiences.addAll(shortTermMemory);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ£€ç´¢é•¿æœŸè®°å¿†ä¸­çš„ç›¸å…³ç»éªŒ</span></span><br><span class="line">        List&lt;Document&gt; docs = vectorStore.similaritySearch(</span><br><span class="line">            SearchRequest.query(task).withTopK(topK)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (Document doc : docs) &#123;</span><br><span class="line">            experiences.add(doc.getContent());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> experiences;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–çŸ­æœŸè®°å¿†</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getShortTermMemory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(shortTermMemory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸‰ã€å®Œæ•´å®ç°"><a href="#ä¸‰ã€å®Œæ•´å®ç°" class="headerlink" title="ä¸‰ã€å®Œæ•´å®ç°"></a>ä¸‰ã€å®Œæ•´å®ç°</h2><h3 id="3-1-Reflexion-Agent-ä¸»ç±»"><a href="#3-1-Reflexion-Agent-ä¸»ç±»" class="headerlink" title="3.1 Reflexion Agent ä¸»ç±»"></a>3.1 Reflexion Agent ä¸»ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Actor actor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Evaluator evaluator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SelfReflection selfReflection;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReflexionMemory memory;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">80</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¼€å§‹æ‰§è¡Œä»»åŠ¡: &#123;&#125;&quot;</span>, task);</span><br><span class="line">        </span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;=== ç¬¬ &#123;&#125; æ¬¡å°è¯• ===&quot;</span>, attempt);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 1. æ£€ç´¢ç›¸å…³ç»éªŒ</span></span><br><span class="line">            List&lt;String&gt; experiences = memory.recall(task, <span class="number">5</span>);</span><br><span class="line">            log.info(<span class="string">&quot;æ£€ç´¢åˆ° &#123;&#125; æ¡ç›¸å…³ç»éªŒ&quot;</span>, experiences.size());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. Actor æ‰§è¡Œ</span></span><br><span class="line">            <span class="type">ActorResult</span> <span class="variable">actorResult</span> <span class="operator">=</span> actor.execute(task, experiences);</span><br><span class="line">            log.info(<span class="string">&quot;æ‰§è¡Œå®Œæˆ&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. Evaluator è¯„ä¼°</span></span><br><span class="line">            <span class="type">EvaluationResult</span> <span class="variable">evalResult</span> <span class="operator">=</span> evaluator.evaluateWithLLM(</span><br><span class="line">                task, actorResult.getExecution()</span><br><span class="line">            );</span><br><span class="line">            log.info(<span class="string">&quot;è¯„ä¼°å¾—åˆ†: &#123;&#125;&quot;</span>, evalResult.getScore());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®°å½•æœ¬æ¬¡å°è¯•</span></span><br><span class="line">            attempts.add(<span class="keyword">new</span> <span class="title class_">AttemptRecord</span>(attempt, actorResult, evalResult));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. æ£€æŸ¥æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">if</span> (evalResult.isSuccess() || evalResult.getScore() &gt;= SUCCESS_THRESHOLD) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;âœ… ä»»åŠ¡æˆåŠŸå®Œæˆ&quot;</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æˆåŠŸä¹Ÿå¯ä»¥æ€»ç»“ç»éªŒï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> (evalResult.getScore() == <span class="number">100</span>) &#123;</span><br><span class="line">                    saveSuccessExperience(task, actorResult);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                memory.clearShortTerm();</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.success(</span><br><span class="line">                    actorResult.getExecution(), attempts</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. Self-Reflection åæ€</span></span><br><span class="line">            log.info(<span class="string">&quot;å¼€å§‹åæ€...&quot;</span>);</span><br><span class="line">            <span class="type">ReflectionResult</span> <span class="variable">reflection</span> <span class="operator">=</span> selfReflection.reflect(</span><br><span class="line">                ReflectionInput.builder()</span><br><span class="line">                    .task(task)</span><br><span class="line">                    .executionTrace(actorResult.getThinking())</span><br><span class="line">                    .result(actorResult.getExecution())</span><br><span class="line">                    .evaluationFeedback(evalResult.getOverallFeedback())</span><br><span class="line">                    .build()</span><br><span class="line">            );</span><br><span class="line">            </span><br><span class="line">            log.info(<span class="string">&quot;åæ€ç»“æœ: &#123;&#125;&quot;</span>, reflection.getLessonsLearned());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 6. å­˜å‚¨ç»éªŒ</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">experience</span> <span class="operator">=</span> reflection.toExperienceText();</span><br><span class="line">            memory.addShortTerm(experience);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯æœ‰ä»·å€¼çš„ç»éªŒï¼Œå­˜å…¥é•¿æœŸè®°å¿†</span></span><br><span class="line">            <span class="keyword">if</span> (reflection.getConfidence() &gt; <span class="number">70</span>) &#123;</span><br><span class="line">                memory.addLongTerm(experience, classifyTask(task));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        log.warn(<span class="string">&quot;âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä»»åŠ¡æœªèƒ½æˆåŠŸå®Œæˆ&quot;</span>);</span><br><span class="line">        memory.clearShortTerm();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ReflexionResponse.failure(</span><br><span class="line">            attempts.get(attempts.size() - <span class="number">1</span>).getActorResult().getExecution(),</span><br><span class="line">            attempts</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">classifyTask</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        <span class="comment">// ç®€å•çš„ä»»åŠ¡åˆ†ç±»é€»è¾‘</span></span><br><span class="line">        <span class="keyword">if</span> (task.contains(<span class="string">&quot;ä»£ç &quot;</span>) || task.contains(<span class="string">&quot;å®ç°&quot;</span>) || task.contains(<span class="string">&quot;å‡½æ•°&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;coding&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (task.contains(<span class="string">&quot;åˆ†æ&quot;</span>) || task.contains(<span class="string">&quot;è§£é‡Š&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;analysis&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;general&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveSuccessExperience</span><span class="params">(String task, ActorResult result)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">experience</span> <span class="operator">=</span> <span class="string">&quot;æˆåŠŸç»éªŒï¼šä»»åŠ¡ã€Œ%sã€çš„æœ‰æ•ˆè§£å†³æ–¹æ¡ˆæ˜¯ï¼š%s&quot;</span></span><br><span class="line">            .formatted(task, result.getThinking());</span><br><span class="line">        memory.addLongTerm(experience, classifyTask(task));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttemptRecord</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> attemptNumber;</span><br><span class="line">    <span class="keyword">private</span> ActorResult actorResult;</span><br><span class="line">    <span class="keyword">private</span> EvaluationResult evaluationResult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflexionResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> success;</span><br><span class="line">    <span class="keyword">private</span> String result;</span><br><span class="line">    <span class="keyword">private</span> List&lt;AttemptRecord&gt; attempts;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> totalAttempts;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ReflexionResponse <span class="title function_">success</span><span class="params">(String result, List&lt;AttemptRecord&gt; attempts)</span> &#123;</span><br><span class="line">        <span class="type">ReflexionResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReflexionResponse</span>();</span><br><span class="line">        response.success = <span class="literal">true</span>;</span><br><span class="line">        response.result = result;</span><br><span class="line">        response.attempts = attempts;</span><br><span class="line">        response.totalAttempts = attempts.size();</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ReflexionResponse <span class="title function_">failure</span><span class="params">(String result, List&lt;AttemptRecord&gt; attempts)</span> &#123;</span><br><span class="line">        <span class="type">ReflexionResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReflexionResponse</span>();</span><br><span class="line">        response.success = <span class="literal">false</span>;</span><br><span class="line">        response.result = result;</span><br><span class="line">        response.attempts = attempts;</span><br><span class="line">        response.totalAttempts = attempts.size();</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-Controller-å±‚"><a href="#3-2-Controller-å±‚" class="headerlink" title="3.2 Controller å±‚"></a>3.2 Controller å±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/reflexion&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflexionController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReflexionAgent reflexionAgent;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/execute&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(<span class="meta">@RequestBody</span> TaskRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reflexionAgent.execute(request.getTask());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/memory/stats&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getMemoryStats</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è¿”å›è®°å¿†ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> Map.of(</span><br><span class="line">            <span class="string">&quot;shortTermCount&quot;</span>, memory.getShortTermMemory().size(),</span><br><span class="line">            <span class="string">&quot;longTermCount&quot;</span>, memory.getLongTermCount()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaskRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String task;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å››ã€å®æˆ˜æ¡ˆä¾‹"><a href="#å››ã€å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="å››ã€å®æˆ˜æ¡ˆä¾‹"></a>å››ã€å®æˆ˜æ¡ˆä¾‹</h2><h3 id="4-1-ä»£ç ç”Ÿæˆä»»åŠ¡"><a href="#4-1-ä»£ç ç”Ÿæˆä»»åŠ¡" class="headerlink" title="4.1 ä»£ç ç”Ÿæˆä»»åŠ¡"></a>4.1 ä»£ç ç”Ÿæˆä»»åŠ¡</h3><p><strong>ä»»åŠ¡</strong>ï¼šâ€ç”¨ Java å®ç°ä¸€ä¸ª LRU ç¼“å­˜ï¼Œæ”¯æŒ get å’Œ put æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ O(1)â€</p>
<h4 id="ç¬¬-1-æ¬¡å°è¯•"><a href="#ç¬¬-1-æ¬¡å°è¯•" class="headerlink" title="ç¬¬ 1 æ¬¡å°è¯•"></a>ç¬¬ 1 æ¬¡å°è¯•</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Actor è¾“å‡º:</span><br><span class="line">public class LRUCache &#123;</span><br><span class="line">    private Map&lt;Integer, Integer&gt; cache;</span><br><span class="line">    private int capacity;</span><br><span class="line">    </span><br><span class="line">    public LRUCache(int capacity) &#123;</span><br><span class="line">        this.cache = new HashMap&lt;&gt;();</span><br><span class="line">        this.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public int get(int key) &#123;</span><br><span class="line">        return cache.getOrDefault(key, -1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void put(int key, int value) &#123;</span><br><span class="line">        if (cache.size() &gt;= capacity) &#123;</span><br><span class="line">            // åˆ é™¤æœ€æ—§çš„ï¼Ÿä½† HashMap æ— åº...</span><br><span class="line">            cache.remove(cache.keySet().iterator().next());</span><br><span class="line">        &#125;</span><br><span class="line">        cache.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Evaluator åé¦ˆ:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;success&quot;: false,</span><br><span class="line">  &quot;score&quot;: 40,</span><br><span class="line">  &quot;specific_issues&quot;: [</span><br><span class="line">    &quot;HashMap æ— æ³•ä¿è¯ LRU é¡ºåº&quot;,</span><br><span class="line">    &quot;åˆ é™¤çš„ä¸ä¸€å®šæ˜¯æœ€ä¹…æœªä½¿ç”¨çš„å…ƒç´ &quot;,</span><br><span class="line">    &quot;get æ“ä½œæ²¡æœ‰æ›´æ–°è®¿é—®é¡ºåº&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Self-Reflection:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;problem_diagnosis&quot;: &quot;ä½¿ç”¨äº†æ™®é€š HashMapï¼Œæ— æ³•ç»´æŠ¤è®¿é—®é¡ºåº&quot;,</span><br><span class="line">  &quot;root_cause&quot;: &quot;æ²¡æœ‰è€ƒè™‘ LRU éœ€è¦è®°å½•è®¿é—®é¡ºåºçš„ç‰¹æ€§&quot;,</span><br><span class="line">  &quot;lessons_learned&quot;: [</span><br><span class="line">    &quot;LRU ç¼“å­˜éœ€è¦èƒ½è®°å½•è®¿é—®é¡ºåºçš„æ•°æ®ç»“æ„&quot;,</span><br><span class="line">    &quot;å¯ä»¥ä½¿ç”¨ LinkedHashMap æˆ–è‡ªå·±å®ç°åŒå‘é“¾è¡¨ + HashMap&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;improvement_plan&quot;: &quot;ä½¿ç”¨ LinkedHashMap å¹¶é‡å†™ removeEldestEntry æ–¹æ³•&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¬¬-2-æ¬¡å°è¯•"><a href="#ç¬¬-2-æ¬¡å°è¯•" class="headerlink" title="ç¬¬ 2 æ¬¡å°è¯•"></a>ç¬¬ 2 æ¬¡å°è¯•</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Actor è¾“å‡ºï¼ˆå¸¦ç»éªŒï¼‰:</span><br><span class="line">public class LRUCache extends LinkedHashMap&lt;Integer, Integer&gt; &#123;</span><br><span class="line">    private int capacity;</span><br><span class="line">    </span><br><span class="line">    public LRUCache(int capacity) &#123;</span><br><span class="line">        super(capacity, 0.75f, true); // true è¡¨ç¤ºæŒ‰è®¿é—®é¡ºåº</span><br><span class="line">        this.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public int get(int key) &#123;</span><br><span class="line">        return super.getOrDefault(key, -1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void put(int key, int value) &#123;</span><br><span class="line">        super.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    protected boolean removeEldestEntry(Map.Entry eldest) &#123;</span><br><span class="line">        return size() &gt; capacity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Evaluator åé¦ˆ:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;success&quot;: true,</span><br><span class="line">  &quot;score&quot;: 95,</span><br><span class="line">  &quot;overall_feedback&quot;: &quot;æ­£ç¡®å®ç°äº† LRU ç¼“å­˜ï¼Œä½¿ç”¨ LinkedHashMap ç®€æ´é«˜æ•ˆ&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">âœ… æˆåŠŸå®Œæˆ</span><br></pre></td></tr></table></figure>

<h3 id="4-2-æ•°æ®åˆ†æä»»åŠ¡"><a href="#4-2-æ•°æ®åˆ†æä»»åŠ¡" class="headerlink" title="4.2 æ•°æ®åˆ†æä»»åŠ¡"></a>4.2 æ•°æ®åˆ†æä»»åŠ¡</h3><p><strong>ä»»åŠ¡</strong>ï¼šâ€åˆ†æè¿™æ®µ SQL çš„æ€§èƒ½é—®é¢˜å¹¶ç»™å‡ºä¼˜åŒ–å»ºè®®â€</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders o</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> users u <span class="keyword">ON</span> o.user_id <span class="operator">=</span> u.id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> products p <span class="keyword">ON</span> o.product_id <span class="operator">=</span> p.id</span><br><span class="line"><span class="keyword">WHERE</span> o.created_at <span class="operator">&gt;</span> <span class="string">&#x27;2024-01-01&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> o.created_at <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h4 id="åæ€æ”¹è¿›è¿‡ç¨‹"><a href="#åæ€æ”¹è¿›è¿‡ç¨‹" class="headerlink" title="åæ€æ”¹è¿›è¿‡ç¨‹"></a>åæ€æ”¹è¿›è¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ 1 æ¬¡ï¼šåªå…³æ³¨äº†ç´¢å¼•é—®é¢˜</span><br><span class="line">ç»éªŒï¼šSQL ä¼˜åŒ–è¦å…¨é¢è€ƒè™‘ç´¢å¼•ã€æŸ¥è¯¢å­—æ®µã€è¿æ¥æ–¹å¼ç­‰</span><br><span class="line"></span><br><span class="line">ç¬¬ 2 æ¬¡ï¼šå¢åŠ äº†å­—æ®µé€‰æ‹©å»ºè®®</span><br><span class="line">ç»éªŒï¼šSELECT * æ˜¯å¸¸è§æ€§èƒ½é—®é¢˜ï¼Œåº”æ˜ç¡®æŒ‡å‡º</span><br><span class="line"></span><br><span class="line">ç¬¬ 3 æ¬¡ï¼šå®Œæ•´åˆ†æ</span><br><span class="line">- ç´¢å¼•å»ºè®®ï¼šcreated_at, user_id, product_id</span><br><span class="line">- æŸ¥è¯¢ä¼˜åŒ–ï¼šé¿å… SELECT *</span><br><span class="line">- è¿æ¥ä¼˜åŒ–ï¼šè€ƒè™‘æ˜¯å¦éœ€è¦ LEFT JOIN</span><br><span class="line">- åˆ†é¡µå»ºè®®ï¼šå¤§æ•°æ®é‡éœ€è¦åˆ†é¡µ</span><br><span class="line"></span><br><span class="line">âœ… æˆåŠŸ</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="äº”ã€è¿›é˜¶ä¼˜åŒ–"><a href="#äº”ã€è¿›é˜¶ä¼˜åŒ–" class="headerlink" title="äº”ã€è¿›é˜¶ä¼˜åŒ–"></a>äº”ã€è¿›é˜¶ä¼˜åŒ–</h2><h3 id="5-1-åˆ†å±‚åæ€"><a href="#5-1-åˆ†å±‚åæ€" class="headerlink" title="5.1 åˆ†å±‚åæ€"></a>5.1 åˆ†å±‚åæ€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HierarchicalReflection</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æµ…å±‚åæ€ï¼šå¿«é€Ÿä¿®å¤</span></span><br><span class="line">    <span class="keyword">public</span> QuickFix <span class="title function_">shallowReflect</span><span class="params">(EvaluationResult eval)</span> &#123;</span><br><span class="line">        <span class="comment">// é’ˆå¯¹å…·ä½“é”™è¯¯çš„å¿«é€Ÿä¿®å¤å»ºè®®</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·±å±‚åæ€ï¼šæ ¹å› åˆ†æ</span></span><br><span class="line">    <span class="keyword">public</span> DeepAnalysis <span class="title function_">deepReflect</span><span class="params">(List&lt;AttemptRecord&gt; attempts)</span> &#123;</span><br><span class="line">        <span class="comment">// å¤šæ¬¡å¤±è´¥åçš„æ·±åº¦åˆ†æ</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…ƒåæ€ï¼šåæ€ç­–ç•¥æœ¬èº«</span></span><br><span class="line">    <span class="keyword">public</span> MetaReflection <span class="title function_">metaReflect</span><span class="params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;</span><br><span class="line">        <span class="comment">// åæ€çš„åæ€ï¼šåæ€ç­–ç•¥æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-ç»éªŒè’¸é¦"><a href="#5-2-ç»éªŒè’¸é¦" class="headerlink" title="5.2 ç»éªŒè’¸é¦"></a>5.2 ç»éªŒè’¸é¦</h3><p>å®šæœŸå°†ç¢ç‰‡åŒ–ç»éªŒæ•´åˆä¸ºç»“æ„åŒ–çŸ¥è¯†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(cron = &quot;0 0 2 * * ?&quot;)</span> <span class="comment">// æ¯å¤©å‡Œæ™¨2ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">distillExperiences</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1. è·å–æœ€è¿‘çš„ç»éªŒ</span></span><br><span class="line">    List&lt;Document&gt; recentExperiences = memory.getRecentExperiences(<span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. èšç±»ç›¸ä¼¼ç»éªŒ</span></span><br><span class="line">    Map&lt;String, List&lt;Document&gt;&gt; clusters = clusterExperiences(recentExperiences);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. ä¸ºæ¯ä¸ªèšç±»ç”Ÿæˆæ€»ç»“</span></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;Document&gt;&gt; entry : clusters.entrySet()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">summary</span> <span class="operator">=</span> llm.summarize(entry.getValue());</span><br><span class="line">        memory.addDistilledKnowledge(entry.getKey(), summary);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-ç»éªŒè¿ç§»"><a href="#5-3-ç»éªŒè¿ç§»" class="headerlink" title="5.3 ç»éªŒè¿ç§»"></a>5.3 ç»éªŒè¿ç§»</h3><p>è·¨ä»»åŠ¡ç±»å‹è¿ç§»é€šç”¨ç»éªŒï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">transferExperiences</span><span class="params">(String newTask)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">taskType</span> <span class="operator">=</span> classifyTask(newTask);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–åŒç±»å‹ä»»åŠ¡ç»éªŒ</span></span><br><span class="line">    List&lt;String&gt; sameTypeExp = memory.getByTaskType(taskType);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–é€šç”¨ç»éªŒï¼ˆé€‚ç”¨äºæ‰€æœ‰ä»»åŠ¡ï¼‰</span></span><br><span class="line">    List&lt;String&gt; universalExp = memory.getUniversalExperiences();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ™ºèƒ½ç­›é€‰å¯è¿ç§»çš„ç»éªŒ</span></span><br><span class="line">    <span class="keyword">return</span> filterTransferableExperiences(newTask, sameTypeExp, universalExp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å…­ã€æœ€ä½³å®è·µ"><a href="#å…­ã€æœ€ä½³å®è·µ" class="headerlink" title="å…­ã€æœ€ä½³å®è·µ"></a>å…­ã€æœ€ä½³å®è·µ</h2><h3 id="6-1-è¯„ä¼°å™¨è®¾è®¡"><a href="#6-1-è¯„ä¼°å™¨è®¾è®¡" class="headerlink" title="6.1 è¯„ä¼°å™¨è®¾è®¡"></a>6.1 è¯„ä¼°å™¨è®¾è®¡</h3><table>
<thead>
<tr>
<th>ä»»åŠ¡ç±»å‹</th>
<th>æ¨èè¯„ä¼°æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td>ä»£ç ç”Ÿæˆ</td>
<td>æµ‹è¯•ç”¨ä¾‹ + é™æ€åˆ†æ</td>
</tr>
<tr>
<td>æ–‡æœ¬å†™ä½œ</td>
<td>LLM è¯„ä¼° + è§„åˆ™æ£€æŸ¥</td>
</tr>
<tr>
<td>æ•°å­¦è®¡ç®—</td>
<td>ç»“æœéªŒè¯</td>
</tr>
<tr>
<td>ä¿¡æ¯æ£€ç´¢</td>
<td>äººå·¥æŠ½æ£€ + LLM è¯„ä¼°</td>
</tr>
</tbody></table>
<h3 id="6-2-åæ€æ·±åº¦æ§åˆ¶"><a href="#6-2-åæ€æ·±åº¦æ§åˆ¶" class="headerlink" title="6.2 åæ€æ·±åº¦æ§åˆ¶"></a>6.2 åæ€æ·±åº¦æ§åˆ¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®å¤±è´¥æ¬¡æ•°è°ƒæ•´åæ€æ·±åº¦</span></span><br><span class="line"><span class="keyword">public</span> ReflectionResult <span class="title function_">adaptiveReflect</span><span class="params">(<span class="type">int</span> attemptCount, ...)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (attemptCount == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> quickReflect(...);  <span class="comment">// å¿«é€Ÿåæ€</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (attemptCount == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> normalReflect(...); <span class="comment">// æ ‡å‡†åæ€</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> deepReflect(...);   <span class="comment">// æ·±åº¦åæ€</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-é¿å…è¿‡åº¦åæ€"><a href="#6-3-é¿å…è¿‡åº¦åæ€" class="headerlink" title="6.3 é¿å…è¿‡åº¦åæ€"></a>6.3 é¿å…è¿‡åº¦åæ€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ£€æµ‹æ˜¯å¦é™·å…¥æ— æ•ˆå¾ªç¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isStuck</span><span class="params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (reflections.size() &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æŸ¥æœ€è¿‘ä¸¤æ¬¡åæ€æ˜¯å¦ç›¸ä¼¼åº¦è¿‡é«˜</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">1</span>).toExperienceText();</span><br><span class="line">    <span class="type">String</span> <span class="variable">prev</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">2</span>).toExperienceText();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> calculateSimilarity(last, prev) &gt; <span class="number">0.8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸ƒã€è¿­ä»£æ§åˆ¶ä¸å¾ªç¯é¿å…"><a href="#ä¸ƒã€è¿­ä»£æ§åˆ¶ä¸å¾ªç¯é¿å…" class="headerlink" title="ä¸ƒã€è¿­ä»£æ§åˆ¶ä¸å¾ªç¯é¿å…"></a>ä¸ƒã€è¿­ä»£æ§åˆ¶ä¸å¾ªç¯é¿å…</h2><h3 id="7-1-è¿­ä»£æ¬¡æ•°æ§åˆ¶æœºåˆ¶"><a href="#7-1-è¿­ä»£æ¬¡æ•°æ§åˆ¶æœºåˆ¶" class="headerlink" title="7.1 è¿­ä»£æ¬¡æ•°æ§åˆ¶æœºåˆ¶"></a>7.1 è¿­ä»£æ¬¡æ•°æ§åˆ¶æœºåˆ¶</h3><h4 id="åŸºç¡€æ§åˆ¶ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°"><a href="#åŸºç¡€æ§åˆ¶ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°" class="headerlink" title="åŸºç¡€æ§åˆ¶ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°"></a>åŸºç¡€æ§åˆ¶ï¼šæœ€å¤§é‡è¯•æ¬¡æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ¸å¿ƒæ§åˆ¶å‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">3</span>;           <span class="comment">// æœ€å¤šé‡è¯• 3 æ¬¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">80</span>;    <span class="comment">// æˆåŠŸé˜ˆå€¼ 80 åˆ†</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…³é”®ï¼šfor å¾ªç¯é™åˆ¶è¿­ä»£æ¬¡æ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;=== ç¬¬ &#123;&#125; æ¬¡å°è¯• ===&quot;</span>, attempt);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ... æ‰§è¡Œé€»è¾‘ ...</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æˆåŠŸåˆ™ç«‹å³è¿”å›ï¼Œä¸ç»§ç»­è¿­ä»£</span></span><br><span class="line">            <span class="keyword">if</span> (evalResult.isSuccess() || evalResult.getScore() &gt;= SUCCESS_THRESHOLD) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;âœ… ä»»åŠ¡æˆåŠŸå®Œæˆ&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.success(result, attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¤±è´¥åˆ™ç»§ç»­ä¸‹ä¸€æ¬¡è¿­ä»£</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¾¾åˆ°æœ€å¤§æ¬¡æ•°åè¿”å›å¤±è´¥</span></span><br><span class="line">        log.warn(<span class="string">&quot;âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œä»»åŠ¡æœªèƒ½æˆåŠŸå®Œæˆ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ReflexionResponse.failure(lastResult, attempts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(MAX_RETRIES)</span></span><br><span class="line"><span class="comment">// ç©ºé—´å¤æ‚åº¦ï¼šO(MAX_RETRIES)</span></span><br></pre></td></tr></table></figure>

<p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>for</code> å¾ªç¯è€Œä¸æ˜¯ <code>while</code>ï¼Œæ˜ç¡®é™åˆ¶è¿­ä»£æ¬¡æ•°</li>
<li>æˆåŠŸæ—¶ç«‹å³è¿”å›ï¼Œä¸æµªè´¹èµ„æº</li>
<li>è¾¾åˆ°æœ€å¤§æ¬¡æ•°è‡ªåŠ¨åœæ­¢ï¼Œä¸ä¼šæ— é™å¾ªç¯</li>
</ul>
<h4 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h4><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>å»ºè®®å€¼</th>
<th>å½±å“</th>
</tr>
</thead>
<tbody><tr>
<td><strong>MAX_RETRIES</strong></td>
<td>æœ€å¤§é‡è¯•æ¬¡æ•°</td>
<td>3-5</td>
<td>æ¬¡æ•°è¶Šå¤šï¼ŒæˆåŠŸç‡è¶Šé«˜ä½†æˆæœ¬è¶Šé«˜</td>
</tr>
<tr>
<td><strong>SUCCESS_THRESHOLD</strong></td>
<td>æˆåŠŸè¯„åˆ†é˜ˆå€¼</td>
<td>80-90</td>
<td>é˜ˆå€¼è¶Šé«˜ï¼Œè¦æ±‚è¶Šä¸¥æ ¼</td>
</tr>
<tr>
<td><strong>MAX_REFLECTION_DEPTH</strong></td>
<td>æœ€å¤§åæ€æ·±åº¦</td>
<td>2-3</td>
<td>æ§åˆ¶åæ€çš„è¯¦ç»†ç¨‹åº¦</td>
</tr>
</tbody></table>
<h3 id="7-2-å¤šå±‚æ¬¡çš„å¾ªç¯æ§åˆ¶"><a href="#7-2-å¤šå±‚æ¬¡çš„å¾ªç¯æ§åˆ¶" class="headerlink" title="7.2 å¤šå±‚æ¬¡çš„å¾ªç¯æ§åˆ¶"></a>7.2 å¤šå±‚æ¬¡çš„å¾ªç¯æ§åˆ¶</h3><h4 id="æ–¹å¼1ï¼šåŸºäºæˆåŠŸç‡çš„åŠ¨æ€æ§åˆ¶"><a href="#æ–¹å¼1ï¼šåŸºäºæˆåŠŸç‡çš„åŠ¨æ€æ§åˆ¶" class="headerlink" title="æ–¹å¼1ï¼šåŸºäºæˆåŠŸç‡çš„åŠ¨æ€æ§åˆ¶"></a>æ–¹å¼1ï¼šåŸºäºæˆåŠŸç‡çš„åŠ¨æ€æ§åˆ¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdaptiveReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">80</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">MIN_IMPROVEMENT_RATE</span> <span class="operator">=</span> <span class="number">0.05</span>;  <span class="comment">// æœ€å°æ”¹è¿›ç‡ 5%</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastScore</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">            <span class="comment">// ... æ‰§è¡Œé€»è¾‘ ...</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">currentScore</span> <span class="operator">=</span> evalResult.getScore();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 1. æˆåŠŸåˆ™è¿”å›</span></span><br><span class="line">            <span class="keyword">if</span> (currentScore &gt;= SUCCESS_THRESHOLD) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;âœ… ä»»åŠ¡æˆåŠŸ&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.success(result, attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. æ£€æŸ¥æ˜¯å¦æœ‰æ”¹è¿›</span></span><br><span class="line">            <span class="type">double</span> <span class="variable">improvementRate</span> <span class="operator">=</span> (<span class="type">double</span>)(currentScore - lastScore) / lastScore;</span><br><span class="line">            <span class="keyword">if</span> (attempt &gt; <span class="number">2</span> &amp;&amp; improvementRate &lt; MIN_IMPROVEMENT_RATE) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;âš ï¸ æ”¹è¿›ä¸è¶³ &#123;&#125;%ï¼Œåœæ­¢è¿­ä»£&quot;</span>, MIN_IMPROVEMENT_RATE * <span class="number">100</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.failure(result, attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            lastScore = currentScore;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        log.warn(<span class="string">&quot;âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ReflexionResponse.failure(lastResult, attempts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">// ç¬¬1æ¬¡ï¼šå¾—åˆ† 40</span></span><br><span class="line"><span class="comment">// ç¬¬2æ¬¡ï¼šå¾—åˆ† 60ï¼ˆæ”¹è¿› 50%ï¼Œç»§ç»­ï¼‰</span></span><br><span class="line"><span class="comment">// ç¬¬3æ¬¡ï¼šå¾—åˆ† 65ï¼ˆæ”¹è¿› 8%ï¼Œç»§ç»­ï¼‰</span></span><br><span class="line"><span class="comment">// ç¬¬4æ¬¡ï¼šå¾—åˆ† 66ï¼ˆæ”¹è¿› 1.5% &lt; 5%ï¼Œåœæ­¢ï¼‰</span></span><br></pre></td></tr></table></figure>

<p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p>
<ul>
<li>ä¸ä»…é™åˆ¶æ¬¡æ•°ï¼Œè¿˜æ£€æŸ¥æ”¹è¿›å¹…åº¦</li>
<li>å¦‚æœè¿ç»­æ”¹è¿›ä¸è¶³ï¼Œæå‰åœæ­¢</li>
<li>é¿å…åœ¨æ— æ•ˆå¾ªç¯ä¸­æµªè´¹èµ„æº</li>
</ul>
<h4 id="æ–¹å¼2ï¼šåŸºäºåæ€ç›¸ä¼¼åº¦çš„æ§åˆ¶"><a href="#æ–¹å¼2ï¼šåŸºäºåæ€ç›¸ä¼¼åº¦çš„æ§åˆ¶" class="headerlink" title="æ–¹å¼2ï¼šåŸºäºåæ€ç›¸ä¼¼åº¦çš„æ§åˆ¶"></a>æ–¹å¼2ï¼šåŸºäºåæ€ç›¸ä¼¼åº¦çš„æ§åˆ¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmartReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">SIMILARITY_THRESHOLD</span> <span class="operator">=</span> <span class="number">0.8</span>;  <span class="comment">// ç›¸ä¼¼åº¦é˜ˆå€¼</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;ReflectionResult&gt; reflections = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">            <span class="comment">// ... æ‰§è¡Œé€»è¾‘ ...</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (evalResult.isSuccess()) &#123;</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.success(result, attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åæ€</span></span><br><span class="line">            <span class="type">ReflectionResult</span> <span class="variable">reflection</span> <span class="operator">=</span> selfReflection.reflect(input);</span><br><span class="line">            reflections.add(reflection);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ£€æµ‹æ˜¯å¦é™·å…¥å¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (isStuckInLoop(reflections)) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;âš ï¸ æ£€æµ‹åˆ°æ— æ•ˆå¾ªç¯ï¼Œåœæ­¢è¿­ä»£&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.failure(result, attempts);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ReflexionResponse.failure(lastResult, attempts);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ£€æµ‹æ˜¯å¦é™·å…¥å¾ªç¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isStuckInLoop</span><span class="params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (reflections.size() &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è·å–æœ€è¿‘ä¸¤æ¬¡åæ€</span></span><br><span class="line">        <span class="type">ReflectionResult</span> <span class="variable">last</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">1</span>);</span><br><span class="line">        <span class="type">ReflectionResult</span> <span class="variable">prev</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">2</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—ç›¸ä¼¼åº¦</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> calculateSimilarity(</span><br><span class="line">            last.toExperienceText(),</span><br><span class="line">            prev.toExperienceText()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;åæ€ç›¸ä¼¼åº¦: &#123;&#125;&quot;</span>, similarity);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœç›¸ä¼¼åº¦è¿‡é«˜ï¼Œè¯´æ˜é™·å…¥å¾ªç¯</span></span><br><span class="line">        <span class="keyword">return</span> similarity &gt; SIMILARITY_THRESHOLD;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateSimilarity</span><span class="params">(String text1, String text2)</span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æˆ–ç¼–è¾‘è·ç¦»</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œç®€åŒ–å¤„ç†</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">commonChars</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxLen</span> <span class="operator">=</span> Math.max(text1.length(), text2.length());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c : text1.toCharArray()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (text2.contains(String.valueOf(c))) &#123;</span><br><span class="line">                commonChars++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>) commonChars / maxLen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">// ç¬¬1æ¬¡åæ€ï¼šé—®é¢˜æ˜¯&quot;æ²¡æœ‰è€ƒè™‘è¾¹ç•Œæƒ…å†µ&quot;</span></span><br><span class="line"><span class="comment">// ç¬¬2æ¬¡åæ€ï¼šé—®é¢˜æ˜¯&quot;æ²¡æœ‰è€ƒè™‘è¾¹ç•Œæƒ…å†µ&quot;ï¼ˆç›¸ä¼¼åº¦ 95%ï¼‰</span></span><br><span class="line"><span class="comment">// â†’ æ£€æµ‹åˆ°å¾ªç¯ï¼Œåœæ­¢è¿­ä»£</span></span><br></pre></td></tr></table></figure>

<p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p>
<ul>
<li>ç›‘æµ‹åæ€å†…å®¹çš„ç›¸ä¼¼åº¦</li>
<li>å¦‚æœåæ€é‡å¤ï¼Œè¯´æ˜é™·å…¥æ­»å¾ªç¯</li>
<li>æå‰åœæ­¢é¿å…æµªè´¹èµ„æº</li>
</ul>
<h3 id="7-3-å¾ªç¯é£é™©è¯†åˆ«"><a href="#7-3-å¾ªç¯é£é™©è¯†åˆ«" class="headerlink" title="7.3 å¾ªç¯é£é™©è¯†åˆ«"></a>7.3 å¾ªç¯é£é™©è¯†åˆ«</h3><h4 id="å¸¸è§çš„æ— é™å¾ªç¯åœºæ™¯"><a href="#å¸¸è§çš„æ— é™å¾ªç¯åœºæ™¯" class="headerlink" title="å¸¸è§çš„æ— é™å¾ªç¯åœºæ™¯"></a>å¸¸è§çš„æ— é™å¾ªç¯åœºæ™¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ åœºæ™¯1ï¼šè¯„ä¼°æ ‡å‡†è¿‡é«˜</span></span><br><span class="line"><span class="comment">// é—®é¢˜ï¼šSUCCESS_THRESHOLD = 100ï¼ˆå®Œç¾ï¼‰</span></span><br><span class="line"><span class="comment">// ç»“æœï¼šæ°¸è¿œæ— æ³•æ»¡è¶³ï¼Œé™·å…¥å¾ªç¯</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">100</span>;  <span class="comment">// ä¸ç°å®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³ï¼šè®¾ç½®åˆç†çš„é˜ˆå€¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">80</span>;   <span class="comment">// 80% å°±è®¤ä¸ºæˆåŠŸ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ åœºæ™¯2ï¼šåæ€æ²¡æœ‰äº§ç”Ÿæ–°çš„æ”¹è¿›æ–¹æ¡ˆ</span></span><br><span class="line"><span class="comment">// é—®é¢˜ï¼šæ¯æ¬¡åæ€éƒ½è¯´&quot;éœ€è¦æ›´ä»”ç»†&quot;ï¼Œä½†æ²¡æœ‰å…·ä½“æ”¹è¿›</span></span><br><span class="line"><span class="comment">// ç»“æœï¼šActor é‡å¤åŒæ ·çš„é”™è¯¯</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">reflect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åæ€ç»“æœï¼šéœ€è¦æ›´ä»”ç»†åœ°å¤„ç†</span></span><br><span class="line">    <span class="comment">// æ”¹è¿›æ–¹æ¡ˆï¼šæ— ï¼ˆç©ºï¼‰</span></span><br><span class="line">    <span class="comment">// â†’ ä¸‹æ¬¡è¿˜æ˜¯åŒæ ·çš„é”™è¯¯</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³ï¼šè¦æ±‚åæ€å¿…é¡»äº§ç”Ÿå…·ä½“çš„æ”¹è¿›æ–¹æ¡ˆ</span></span><br><span class="line"><span class="type">ReflectionResult</span> <span class="variable">reflection</span> <span class="operator">=</span> selfReflection.reflect(input);</span><br><span class="line"><span class="keyword">if</span> (reflection.getImprovementPlan() == <span class="literal">null</span> || </span><br><span class="line">    reflection.getImprovementPlan().isEmpty()) &#123;</span><br><span class="line">    log.warn(<span class="string">&quot;åæ€æœªäº§ç”Ÿæ”¹è¿›æ–¹æ¡ˆï¼Œåœæ­¢è¿­ä»£&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ReflexionResponse.failure(result, attempts);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ åœºæ™¯3ï¼šç»éªŒæ²¡æœ‰è¢«æ­£ç¡®åº”ç”¨</span></span><br><span class="line"><span class="comment">// é—®é¢˜ï¼šActor æ”¶åˆ°ç»éªŒä½†æ²¡æœ‰çœŸæ­£åº”ç”¨</span></span><br><span class="line"><span class="comment">// ç»“æœï¼šæ¯æ¬¡éƒ½çŠ¯åŒæ ·çš„é”™è¯¯</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(String task, List&lt;String&gt; experiences)</span> &#123;</span><br><span class="line">    <span class="comment">// è™½ç„¶æ”¶åˆ°äº†ç»éªŒï¼Œä½†åœ¨ Prompt ä¸­æ²¡æœ‰å¼ºè°ƒ</span></span><br><span class="line">    <span class="comment">// â†’ Actor å¿½è§†äº†ç»éªŒ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³ï¼šåœ¨ Prompt ä¸­å¼ºè°ƒç»éªŒçš„é‡è¦æ€§</span></span><br><span class="line"><span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ## å†å²ç»éªŒæ•™è®­ï¼ˆå¿…é¡»å‚è€ƒï¼ï¼‰</span></span><br><span class="line"><span class="string">    %s</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    ## é‡è¦æç¤º</span></span><br><span class="line"><span class="string">    ä¸Šæ¬¡å¤±è´¥çš„åŸå› æ˜¯ï¼š%s</span></span><br><span class="line"><span class="string">    è¯·åŠ¡å¿…é¿å…é‡å¤è¿™ä¸ªé”™è¯¯ï¼</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.formatted(experiences, lastFailureReason);</span><br></pre></td></tr></table></figure>

<p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p>
<ul>
<li>è¯†åˆ«å¾ªç¯çš„æ ¹æœ¬åŸå› </li>
<li>åœ¨è®¾è®¡é˜¶æ®µå°±é¢„é˜²å¾ªç¯</li>
<li>ä¸æ˜¯ç®€å•åœ°å¢åŠ é‡è¯•æ¬¡æ•°</li>
</ul>
<h3 id="7-4-å®Œæ•´çš„å¾ªç¯æ§åˆ¶å®ç°"><a href="#7-4-å®Œæ•´çš„å¾ªç¯æ§åˆ¶å®ç°" class="headerlink" title="7.4 å®Œæ•´çš„å¾ªç¯æ§åˆ¶å®ç°"></a>7.4 å®Œæ•´çš„å¾ªç¯æ§åˆ¶å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobustReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¤šå±‚æ¬¡çš„æ§åˆ¶å‚æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_RETRIES</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS_THRESHOLD</span> <span class="operator">=</span> <span class="number">80</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">MIN_IMPROVEMENT_RATE</span> <span class="operator">=</span> <span class="number">0.05</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">double</span> <span class="variable">SIMILARITY_THRESHOLD</span> <span class="operator">=</span> <span class="number">0.8</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_CONSECUTIVE_FAILURES</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;ReflectionResult&gt; reflections = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastScore</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">consecutiveFailures</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;=== ç¬¬ &#123;&#125; æ¬¡å°è¯• ===&quot;</span>, attempt);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 1. æ‰§è¡Œ</span></span><br><span class="line">            <span class="type">ActorResult</span> <span class="variable">actorResult</span> <span class="operator">=</span> actor.execute(task, memory.recall(task, <span class="number">5</span>));</span><br><span class="line">            <span class="type">EvaluationResult</span> <span class="variable">evalResult</span> <span class="operator">=</span> evaluator.evaluateWithLLM(task, actorResult.getExecution());</span><br><span class="line">            <span class="type">int</span> <span class="variable">currentScore</span> <span class="operator">=</span> evalResult.getScore();</span><br><span class="line">            </span><br><span class="line">            attempts.add(<span class="keyword">new</span> <span class="title class_">AttemptRecord</span>(attempt, actorResult, evalResult));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. æ£€æŸ¥æˆåŠŸ</span></span><br><span class="line">            <span class="keyword">if</span> (currentScore &gt;= SUCCESS_THRESHOLD) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;âœ… ä»»åŠ¡æˆåŠŸå®Œæˆ&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.success(actorResult.getExecution(), attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. æ£€æŸ¥æ”¹è¿›ç‡ï¼ˆä»ç¬¬2æ¬¡å¼€å§‹ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (attempt &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">double</span> <span class="variable">improvementRate</span> <span class="operator">=</span> (<span class="type">double</span>)(currentScore - lastScore) / Math.max(lastScore, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (improvementRate &lt; MIN_IMPROVEMENT_RATE) &#123;</span><br><span class="line">                    consecutiveFailures++;</span><br><span class="line">                    log.warn(<span class="string">&quot;æ”¹è¿›ä¸è¶³: &#123;&#125;%&quot;</span>, improvementRate * <span class="number">100</span>);</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> (consecutiveFailures &gt;= MAX_CONSECUTIVE_FAILURES) &#123;</span><br><span class="line">                        log.warn(<span class="string">&quot;âš ï¸ è¿ç»­ &#123;&#125; æ¬¡æ”¹è¿›ä¸è¶³ï¼Œåœæ­¢è¿­ä»£&quot;</span>, MAX_CONSECUTIVE_FAILURES);</span><br><span class="line">                        <span class="keyword">return</span> ReflexionResponse.failure(actorResult.getExecution(), attempts);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    consecutiveFailures = <span class="number">0</span>;  <span class="comment">// é‡ç½®è®¡æ•°å™¨</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. åæ€</span></span><br><span class="line">            <span class="type">ReflectionResult</span> <span class="variable">reflection</span> <span class="operator">=</span> selfReflection.reflect(</span><br><span class="line">                ReflectionInput.builder()</span><br><span class="line">                    .task(task)</span><br><span class="line">                    .executionTrace(actorResult.getThinking())</span><br><span class="line">                    .result(actorResult.getExecution())</span><br><span class="line">                    .evaluationFeedback(evalResult.getOverallFeedback())</span><br><span class="line">                    .build()</span><br><span class="line">            );</span><br><span class="line">            reflections.add(reflection);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. æ£€æŸ¥æ˜¯å¦é™·å…¥å¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (isStuckInLoop(reflections)) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;âš ï¸ æ£€æµ‹åˆ°æ— æ•ˆå¾ªç¯ï¼Œåœæ­¢è¿­ä»£&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.failure(actorResult.getExecution(), attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 6. æ£€æŸ¥åæ€è´¨é‡</span></span><br><span class="line">            <span class="keyword">if</span> (reflection.getImprovementPlan() == <span class="literal">null</span> || </span><br><span class="line">                reflection.getImprovementPlan().isEmpty()) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;âš ï¸ åæ€æœªäº§ç”Ÿæ”¹è¿›æ–¹æ¡ˆï¼Œåœæ­¢è¿­ä»£&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> ReflexionResponse.failure(actorResult.getExecution(), attempts);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 7. å­˜å‚¨ç»éªŒ</span></span><br><span class="line">            memory.addShortTerm(reflection.toExperienceText());</span><br><span class="line">            <span class="keyword">if</span> (reflection.getConfidence() &gt; <span class="number">70</span>) &#123;</span><br><span class="line">                memory.addLongTerm(reflection.toExperienceText(), classifyTask(task));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            lastScore = currentScore;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        log.warn(<span class="string">&quot;âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ReflexionResponse.failure(attempts.get(attempts.size() - <span class="number">1</span>).getActorResult().getExecution(), attempts);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isStuckInLoop</span><span class="params">(List&lt;ReflectionResult&gt; reflections)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (reflections.size() &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">1</span>).toExperienceText();</span><br><span class="line">        <span class="type">String</span> <span class="variable">prev</span> <span class="operator">=</span> reflections.get(reflections.size() - <span class="number">2</span>).toExperienceText();</span><br><span class="line">        </span><br><span class="line">        <span class="type">double</span> <span class="variable">similarity</span> <span class="operator">=</span> calculateSimilarity(last, prev);</span><br><span class="line">        <span class="keyword">return</span> similarity &gt; SIMILARITY_THRESHOLD;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">calculateSimilarity</span><span class="params">(String text1, String text2)</span> &#123;</span><br><span class="line">        <span class="comment">// å®ç°ç›¸ä¼¼åº¦è®¡ç®—</span></span><br><span class="line">        <span class="comment">// å¯ä»¥ä½¿ç”¨ Levenshtein è·ç¦»ã€ä½™å¼¦ç›¸ä¼¼åº¦ç­‰</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ§åˆ¶æµç¨‹ï¼š</span></span><br><span class="line"><span class="comment">// ç¬¬1æ¬¡ï¼šå¾—åˆ† 40 â†’ ç»§ç»­</span></span><br><span class="line"><span class="comment">// ç¬¬2æ¬¡ï¼šå¾—åˆ† 60ï¼ˆæ”¹è¿› 50%ï¼‰â†’ ç»§ç»­</span></span><br><span class="line"><span class="comment">// ç¬¬3æ¬¡ï¼šå¾—åˆ† 62ï¼ˆæ”¹è¿› 3% &lt; 5%ï¼‰â†’ è®¡æ•°å™¨ +1</span></span><br><span class="line"><span class="comment">// ç¬¬4æ¬¡ï¼šå¾—åˆ† 63ï¼ˆæ”¹è¿› 1.6% &lt; 5%ï¼‰â†’ è®¡æ•°å™¨ +1ï¼ˆè¾¾åˆ° 2ï¼‰â†’ åœæ­¢</span></span><br></pre></td></tr></table></figure>

<p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p>
<ul>
<li><strong>å¤šå±‚æ¬¡é˜²æŠ¤</strong>ï¼šæ¬¡æ•°é™åˆ¶ + æ”¹è¿›ç‡æ£€æŸ¥ + å¾ªç¯æ£€æµ‹ + åæ€è´¨é‡æ£€æŸ¥</li>
<li><strong>è¿ç»­å¤±è´¥è®¡æ•°</strong>ï¼šå…è®¸å¶å°”çš„æ”¹è¿›ä¸è¶³ï¼Œä½†è¿ç»­å¤šæ¬¡å°±åœæ­¢</li>
<li><strong>ç»¼åˆåˆ¤æ–­</strong>ï¼šä¸ä¾èµ–å•ä¸€æŒ‡æ ‡ï¼Œå¤šä¸ªæ¡ä»¶å…±åŒå†³å®šæ˜¯å¦ç»§ç»­</li>
</ul>
<h3 id="7-5-ç›‘æ§å’Œæ—¥å¿—"><a href="#7-5-ç›‘æ§å’Œæ—¥å¿—" class="headerlink" title="7.5 ç›‘æ§å’Œæ—¥å¿—"></a>7.5 ç›‘æ§å’Œæ—¥å¿—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MonitoredReflexionAgent</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ReflexionResponse <span class="title function_">execute</span><span class="params">(String task)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        List&lt;AttemptRecord&gt; attempts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="number">1</span>; attempt &lt;= MAX_RETRIES; attempt++) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">attemptStart</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// ... æ‰§è¡Œé€»è¾‘ ...</span></span><br><span class="line">                </span><br><span class="line">                <span class="type">long</span> <span class="variable">attemptDuration</span> <span class="operator">=</span> System.currentTimeMillis() - attemptStart;</span><br><span class="line">                log.info(<span class="string">&quot;ç¬¬ &#123;&#125; æ¬¡å°è¯•è€—æ—¶: &#123;&#125;msï¼Œå¾—åˆ†: &#123;&#125;&quot;</span>, </span><br><span class="line">                    attempt, attemptDuration, evalResult.getScore());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">totalDuration</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">            log.info(<span class="string">&quot;ä»»åŠ¡æ€»è€—æ—¶: &#123;&#125;msï¼Œæ€»å°è¯•æ¬¡æ•°: &#123;&#125;&quot;</span>, totalDuration, attempts.size());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®°å½•ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">            logStatistics(attempts);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">logStatistics</span><span class="params">(List&lt;AttemptRecord&gt; attempts)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (attempts.isEmpty()) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">maxScore</span> <span class="operator">=</span> attempts.stream()</span><br><span class="line">            .mapToInt(a -&gt; a.getEvaluationResult().getScore())</span><br><span class="line">            .max()</span><br><span class="line">            .orElse(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">double</span> <span class="variable">avgScore</span> <span class="operator">=</span> attempts.stream()</span><br><span class="line">            .mapToInt(a -&gt; a.getEvaluationResult().getScore())</span><br><span class="line">            .average()</span><br><span class="line">            .orElse(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;ç»Ÿè®¡ä¿¡æ¯ - æœ€é«˜åˆ†: &#123;&#125;ï¼Œå¹³å‡åˆ†: &#123;:.2f&#125;ï¼Œæ€»æ¬¡æ•°: &#123;&#125;&quot;</span>, </span><br><span class="line">            maxScore, avgScore, attempts.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="comment">// === ç¬¬ 1 æ¬¡å°è¯• ===</span></span><br><span class="line"><span class="comment">// ç¬¬ 1 æ¬¡å°è¯•è€—æ—¶: 2341msï¼Œå¾—åˆ†: 40</span></span><br><span class="line"><span class="comment">// === ç¬¬ 2 æ¬¡å°è¯• ===</span></span><br><span class="line"><span class="comment">// ç¬¬ 2 æ¬¡å°è¯•è€—æ—¶: 2156msï¼Œå¾—åˆ†: 65</span></span><br><span class="line"><span class="comment">// === ç¬¬ 3 æ¬¡å°è¯• ===</span></span><br><span class="line"><span class="comment">// ç¬¬ 3 æ¬¡å°è¯•è€—æ—¶: 2089msï¼Œå¾—åˆ†: 68</span></span><br><span class="line"><span class="comment">// âš ï¸ æ”¹è¿›ä¸è¶³: 4.6%ï¼Œåœæ­¢è¿­ä»£</span></span><br><span class="line"><span class="comment">// ç»Ÿè®¡ä¿¡æ¯ - æœ€é«˜åˆ†: 68ï¼Œå¹³å‡åˆ†: 57.67ï¼Œæ€»æ¬¡æ•°: 3</span></span><br></pre></td></tr></table></figure>

<p><strong>æ€è·¯åˆ†æ</strong>ï¼š</p>
<ul>
<li>è®°å½•æ¯æ¬¡å°è¯•çš„è€—æ—¶å’Œå¾—åˆ†</li>
<li>ä¾¿äºåˆ†ææ€§èƒ½å’Œæ”¹è¿›æ•ˆæœ</li>
<li>å¸®åŠ©è°ƒæ•´æ§åˆ¶å‚æ•°</li>
</ul>
<hr>
<h2 id="ç›¸å…³ç¬”è®°"><a href="#ç›¸å…³ç¬”è®°" class="headerlink" title="ç›¸å…³ç¬”è®°"></a>ç›¸å…³ç¬”è®°</h2><ul>
<li>Agentæ¶æ„æ¨¡å¼è¯¦è§£</li>
<li>Prompt Engineeringè¯¦è§£</li>
<li>å¤§æ¨¡å‹å­¦ä¹ è·¯çº¿</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/%E9%80%92%E5%BD%92%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/%E9%80%92%E5%BD%92%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">é€’å½’è¯¦è§£ä¸åº”ç”¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index"><span itemprop="name">æ•°æ®ç»“æ„</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="é€’å½’è¯¦è§£ä¸åº”ç”¨"><a href="#é€’å½’è¯¦è§£ä¸åº”ç”¨" class="headerlink" title="é€’å½’è¯¦è§£ä¸åº”ç”¨"></a>é€’å½’è¯¦è§£ä¸åº”ç”¨</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><strong>é€’å½’</strong> æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€å·§ï¼Œå‡½æ•°è°ƒç”¨è‡ªèº«æ¥è§£å†³é—®é¢˜ã€‚é€’å½’çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å°†å¤§é—®é¢˜åˆ†è§£ä¸ºç›¸åŒçš„å°é—®é¢˜ï¼Œç›´åˆ°é—®é¢˜è¶³å¤Ÿå°å¯ä»¥ç›´æ¥æ±‚è§£</strong>ã€‚</p>
<blockquote>
<p><strong>ğŸ’¡ æç¤º: æ ¸å¿ƒæ€æƒ³</strong><br>é€’å½’ &#x3D; è‡ªæˆ‘è°ƒç”¨ + ç»ˆæ­¢æ¡ä»¶ + é—®é¢˜åˆ†è§£</p>
</blockquote>
<hr>
<h2 id="ä¸€ã€é€’å½’çš„ä¸‰ä¸ªè¦ç´ "><a href="#ä¸€ã€é€’å½’çš„ä¸‰ä¸ªè¦ç´ " class="headerlink" title="ä¸€ã€é€’å½’çš„ä¸‰ä¸ªè¦ç´ "></a>ä¸€ã€é€’å½’çš„ä¸‰ä¸ªè¦ç´ </h2><h3 id="1-1-é€’å½’çš„æœ¬è´¨"><a href="#1-1-é€’å½’çš„æœ¬è´¨" class="headerlink" title="1.1 é€’å½’çš„æœ¬è´¨"></a>1.1 é€’å½’çš„æœ¬è´¨</h3><p>é€’å½’å°±æ˜¯<strong>å‡½æ•°è°ƒç”¨è‡ªå·±</strong>ï¼Œä½†æ¯æ¬¡è°ƒç”¨éƒ½åœ¨å¤„ç†ä¸€ä¸ªæ›´å°çš„é—®é¢˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å¤§é—®é¢˜</span><br><span class="line">  â†“</span><br><span class="line">åˆ†è§£ä¸ºæ›´å°çš„é—®é¢˜ + è°ƒç”¨è‡ªå·±</span><br><span class="line">  â†“</span><br><span class="line">ç»§ç»­åˆ†è§£</span><br><span class="line">  â†“</span><br><span class="line">ç›´åˆ°é—®é¢˜è¶³å¤Ÿå°</span><br><span class="line">  â†“</span><br><span class="line">ç›´æ¥æ±‚è§£ï¼ˆè¿”å›ç»“æœï¼‰</span><br><span class="line">  â†“</span><br><span class="line">é€å±‚è¿”å›ç»“æœ</span><br></pre></td></tr></table></figure>

<h3 id="1-2-é€’å½’çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶"><a href="#1-2-é€’å½’çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶" class="headerlink" title="1.2 é€’å½’çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶"></a>1.2 é€’å½’çš„ä¸‰ä¸ªå¿…è¦æ¡ä»¶</h3><table>
<thead>
<tr>
<th>æ¡ä»¶</th>
<th>è¯´æ˜</th>
<th>é‡è¦æ€§</th>
</tr>
</thead>
<tbody><tr>
<td><strong>é€’å½’å…³ç³»</strong></td>
<td>å‡½æ•°è°ƒç”¨è‡ªèº«</td>
<td>å¿…é¡»</td>
</tr>
<tr>
<td><strong>ç»ˆæ­¢æ¡ä»¶</strong></td>
<td>ä½•æ—¶åœæ­¢é€’å½’</td>
<td><strong>å¿…é¡»</strong>ï¼ˆæ²¡æœ‰ä¼šæ— é™å¾ªç¯ï¼‰</td>
</tr>
<tr>
<td><strong>é—®é¢˜åˆ†è§£</strong></td>
<td>å¦‚ä½•å°†å¤§é—®é¢˜åˆ†è§£ä¸ºå°é—®é¢˜</td>
<td>å¿…é¡»</td>
</tr>
</tbody></table>
<h3 id="1-3-é€’å½’çš„é€šç”¨æ¨¡æ¿"><a href="#1-3-é€’å½’çš„é€šç”¨æ¨¡æ¿" class="headerlink" title="1.3 é€’å½’çš„é€šç”¨æ¨¡æ¿"></a>1.3 é€’å½’çš„é€šç”¨æ¨¡æ¿</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å‡½æ•°çš„æ ‡å‡†æ¨¡æ¿</span></span><br><span class="line">è¿”å›å€¼ç±»å‹ recursiveFunction(å‚æ•°) &#123;</span><br><span class="line">    <span class="comment">// 1. ç»ˆæ­¢æ¡ä»¶ï¼ˆåŸºç¡€æƒ…å†µï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (ç»ˆæ­¢æ¡ä»¶) &#123;</span><br><span class="line">        <span class="keyword">return</span> åŸºç¡€æƒ…å†µçš„ç»“æœ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. é€’å½’å…³ç³»ï¼ˆé€’å½’æƒ…å†µï¼‰</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨è‡ªèº«å¤„ç†æ›´å°çš„é—®é¢˜</span></span><br><span class="line">    è¿”å›å€¼ = recursiveFunction(æ›´å°çš„å‚æ•°);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. å¤„ç†ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> å¤„ç†åçš„ç»“æœ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="äºŒã€é€’å½’çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#äºŒã€é€’å½’çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="äºŒã€é€’å½’çš„æ‰§è¡Œè¿‡ç¨‹"></a>äºŒã€é€’å½’çš„æ‰§è¡Œè¿‡ç¨‹</h2><h3 id="2-1-é€’å½’æ ˆçš„æ¦‚å¿µ"><a href="#2-1-é€’å½’æ ˆçš„æ¦‚å¿µ" class="headerlink" title="2.1 é€’å½’æ ˆçš„æ¦‚å¿µ"></a>2.1 é€’å½’æ ˆçš„æ¦‚å¿µ</h3><p>å½“å‡½æ•°è°ƒç”¨è‡ªå·±æ—¶ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šåœ¨<strong>æ ˆ</strong>ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°æ‰§è¡Œç¯å¢ƒã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">é€’å½’è°ƒç”¨è¿‡ç¨‹ï¼š</span><br><span class="line">recursion(5)</span><br><span class="line">  â†“ è°ƒç”¨</span><br><span class="line">recursion(4)</span><br><span class="line">  â†“ è°ƒç”¨</span><br><span class="line">recursion(3)</span><br><span class="line">  â†“ è°ƒç”¨</span><br><span class="line">recursion(2)</span><br><span class="line">  â†“ è°ƒç”¨</span><br><span class="line">recursion(1)</span><br><span class="line">  â†“ åˆ°è¾¾ç»ˆæ­¢æ¡ä»¶</span><br><span class="line">return 1</span><br><span class="line">  â†‘ è¿”å›</span><br><span class="line">return 2 * 1 = 2</span><br><span class="line">  â†‘ è¿”å›</span><br><span class="line">return 3 * 2 = 6</span><br><span class="line">  â†‘ è¿”å›</span><br><span class="line">return 4 * 6 = 24</span><br><span class="line">  â†‘ è¿”å›</span><br><span class="line">return 5 * 24 = 120</span><br></pre></td></tr></table></figure>

<h3 id="2-2-é€’å½’æ ˆçš„å†…å­˜å ç”¨"><a href="#2-2-é€’å½’æ ˆçš„å†…å­˜å ç”¨" class="headerlink" title="2.2 é€’å½’æ ˆçš„å†…å­˜å ç”¨"></a>2.2 é€’å½’æ ˆçš„å†…å­˜å ç”¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">æ ˆå†…å­˜ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ recursion(1)    â”‚ â† æœ€åå…¥æ ˆ</span><br><span class="line">â”‚ å±€éƒ¨å˜é‡: n=1   â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ recursion(2)    â”‚</span><br><span class="line">â”‚ å±€éƒ¨å˜é‡: n=2   â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ recursion(3)    â”‚</span><br><span class="line">â”‚ å±€éƒ¨å˜é‡: n=3   â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ recursion(4)    â”‚</span><br><span class="line">â”‚ å±€éƒ¨å˜é‡: n=4   â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ recursion(5)    â”‚ â† æœ€å…ˆå…¥æ ˆ</span><br><span class="line">â”‚ å±€éƒ¨å˜é‡: n=5   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br><span class="line">é€’å½’æ·±åº¦ = 5</span><br><span class="line">æ ˆç©ºé—´ = 5 Ã— æ¯ä¸ªå‡½æ•°çš„ç©ºé—´</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡é€’å½’è°ƒç”¨éƒ½ä¼šå ç”¨æ ˆç©ºé—´</li>
<li>é€’å½’æ·±åº¦è¶Šæ·±ï¼Œå ç”¨çš„æ ˆç©ºé—´è¶Šå¤š</li>
<li>æ ˆç©ºé—´æœ‰é™ï¼Œè¿‡æ·±çš„é€’å½’ä¼šå¯¼è‡´æ ˆæº¢å‡º</li>
</ul>
<hr>
<h2 id="ä¸‰ã€é€’å½’çš„å®é™…ä¾‹å­"><a href="#ä¸‰ã€é€’å½’çš„å®é™…ä¾‹å­" class="headerlink" title="ä¸‰ã€é€’å½’çš„å®é™…ä¾‹å­"></a>ä¸‰ã€é€’å½’çš„å®é™…ä¾‹å­</h2><h3 id="3-1-ä¾‹å­1ï¼šè®¡ç®—é˜¶ä¹˜"><a href="#3-1-ä¾‹å­1ï¼šè®¡ç®—é˜¶ä¹˜" class="headerlink" title="3.1 ä¾‹å­1ï¼šè®¡ç®—é˜¶ä¹˜"></a>3.1 ä¾‹å­1ï¼šè®¡ç®—é˜¶ä¹˜</h3><h4 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5! = 5 Ã— 4!</span><br><span class="line">4! = 4 Ã— 3!</span><br><span class="line">3! = 3 Ã— 2!</span><br><span class="line">2! = 2 Ã— 1!</span><br><span class="line">1! = 1ï¼ˆåŸºç¡€æƒ…å†µï¼‰</span><br></pre></td></tr></table></figure>

<p><strong>é€’å½’å…³ç³»</strong>ï¼š<code>n! = n Ã— (n-1)!</code><br><strong>ç»ˆæ­¢æ¡ä»¶</strong>ï¼š<code>n == 1</code></p>
<h4 id="é€’å½’å®ç°"><a href="#é€’å½’å®ç°" class="headerlink" title="é€’å½’å®ç°"></a>é€’å½’å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’æ–¹å¼</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">factorial</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;  <span class="comment">// åŸºç¡€æƒ…å†µ</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. é€’å½’å…³ç³»</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨è‡ªèº«å¤„ç†æ›´å°çš„é—®é¢˜</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> n * factorial(n - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. è¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> factorial(<span class="number">5</span>);  <span class="comment">// è¿”å› 120</span></span><br></pre></td></tr></table></figure>

<h4 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">factorial(5)</span><br><span class="line">  â†“ 5 != 1ï¼Œç»§ç»­é€’å½’</span><br><span class="line">  â†“ è®¡ç®— 5 * factorial(4)</span><br><span class="line">    â†“ factorial(4)</span><br><span class="line">    â†“ 4 != 1ï¼Œç»§ç»­é€’å½’</span><br><span class="line">    â†“ è®¡ç®— 4 * factorial(3)</span><br><span class="line">      â†“ factorial(3)</span><br><span class="line">      â†“ 3 != 1ï¼Œç»§ç»­é€’å½’</span><br><span class="line">      â†“ è®¡ç®— 3 * factorial(2)</span><br><span class="line">        â†“ factorial(2)</span><br><span class="line">        â†“ 2 != 1ï¼Œç»§ç»­é€’å½’</span><br><span class="line">        â†“ è®¡ç®— 2 * factorial(1)</span><br><span class="line">          â†“ factorial(1)</span><br><span class="line">          â†“ 1 == 1ï¼Œåˆ°è¾¾ç»ˆæ­¢æ¡ä»¶</span><br><span class="line">          â†“ return 1</span><br><span class="line">        â†“ return 2 * 1 = 2</span><br><span class="line">      â†“ return 3 * 2 = 6</span><br><span class="line">    â†“ return 4 * 6 = 24</span><br><span class="line">  â†“ return 5 * 24 = 120</span><br></pre></td></tr></table></figure>

<p><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šO(n)<br><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šO(n)ï¼ˆé€’å½’æ ˆæ·±åº¦ï¼‰</p>
<h3 id="3-2-ä¾‹å­2ï¼šé“¾è¡¨éå†ï¼ˆæ ‘éå†çš„åŸºç¡€ï¼‰"><a href="#3-2-ä¾‹å­2ï¼šé“¾è¡¨éå†ï¼ˆæ ‘éå†çš„åŸºç¡€ï¼‰" class="headerlink" title="3.2 ä¾‹å­2ï¼šé“¾è¡¨éå†ï¼ˆæ ‘éå†çš„åŸºç¡€ï¼‰"></a>3.2 ä¾‹å­2ï¼šé“¾è¡¨éå†ï¼ˆæ ‘éå†çš„åŸºç¡€ï¼‰</h3><h4 id="é—®é¢˜åˆ†æ-1"><a href="#é—®é¢˜åˆ†æ-1" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">é“¾è¡¨ï¼š1 â†’ 2 â†’ 3 â†’ null</span><br><span class="line"></span><br><span class="line">éå†æ€è·¯ï¼š</span><br><span class="line">- è®¿é—®å½“å‰èŠ‚ç‚¹</span><br><span class="line">- é€’å½’éå†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line">- ç»ˆæ­¢æ¡ä»¶ï¼šèŠ‚ç‚¹ä¸º null</span><br></pre></td></tr></table></figure>

<h4 id="é€’å½’å®ç°-1"><a href="#é€’å½’å®ç°-1" class="headerlink" title="é€’å½’å®ç°"></a>é€’å½’å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    ListNode next;</span><br><span class="line">    </span><br><span class="line">    ListNode(<span class="type">int</span> val) &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’éå†é“¾è¡¨</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">traverse</span><span class="params">(ListNode node)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;  <span class="comment">// åˆ°è¾¾é“¾è¡¨æœ«å°¾</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. å¤„ç†å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    System.out.println(node.val);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. é€’å½’å¤„ç†ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    traverse(node.next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line"><span class="type">ListNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">1</span>);</span><br><span class="line">head.next = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">2</span>);</span><br><span class="line">head.next.next = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">traverse(head);  <span class="comment">// è¾“å‡ºï¼š1 2 3</span></span><br></pre></td></tr></table></figure>

<h4 id="æ‰§è¡Œè¿‡ç¨‹-1"><a href="#æ‰§è¡Œè¿‡ç¨‹-1" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">traverse(node1)  // node1.val = 1</span><br><span class="line">  â†“ node1 != null</span><br><span class="line">  â†“ æ‰“å° 1</span><br><span class="line">  â†“ è°ƒç”¨ traverse(node2)</span><br><span class="line">    â†“ traverse(node2)  // node2.val = 2</span><br><span class="line">    â†“ node2 != null</span><br><span class="line">    â†“ æ‰“å° 2</span><br><span class="line">    â†“ è°ƒç”¨ traverse(node3)</span><br><span class="line">      â†“ traverse(node3)  // node3.val = 3</span><br><span class="line">      â†“ node3 != null</span><br><span class="line">      â†“ æ‰“å° 3</span><br><span class="line">      â†“ è°ƒç”¨ traverse(null)</span><br><span class="line">        â†“ traverse(null)</span><br><span class="line">        â†“ null == nullï¼Œåˆ°è¾¾ç»ˆæ­¢æ¡ä»¶</span><br><span class="line">        â†“ return</span><br><span class="line">      â†“ return</span><br><span class="line">    â†“ return</span><br><span class="line">  â†“ return</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡é€’å½’éƒ½å¤„ç†ä¸€ä¸ªèŠ‚ç‚¹</li>
<li>é€šè¿‡ <code>node.next</code> å°†é—®é¢˜åˆ†è§£ä¸ºæ›´å°çš„é—®é¢˜</li>
<li>å½“ <code>node == null</code> æ—¶åœæ­¢é€’å½’</li>
</ul>
<h3 id="3-3-ä¾‹å­3ï¼šäºŒå‰æ ‘å‰åºéå†"><a href="#3-3-ä¾‹å­3ï¼šäºŒå‰æ ‘å‰åºéå†" class="headerlink" title="3.3 ä¾‹å­3ï¼šäºŒå‰æ ‘å‰åºéå†"></a>3.3 ä¾‹å­3ï¼šäºŒå‰æ ‘å‰åºéå†</h3><h4 id="é—®é¢˜åˆ†æ-2"><a href="#é—®é¢˜åˆ†æ-2" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">æ ‘ç»“æ„ï¼š</span><br><span class="line">      1</span><br><span class="line">     / \</span><br><span class="line">    2   3</span><br><span class="line"></span><br><span class="line">å‰åºéå†ï¼šæ ¹ â†’ å·¦å­æ ‘ â†’ å³å­æ ‘</span><br><span class="line">è¾“å‡ºï¼š1 2 3</span><br><span class="line"></span><br><span class="line">é€’å½’æ€è·¯ï¼š</span><br><span class="line">1. è®¿é—®æ ¹èŠ‚ç‚¹</span><br><span class="line">2. é€’å½’éå†å·¦å­æ ‘</span><br><span class="line">3. é€’å½’éå†å³å­æ ‘</span><br></pre></td></tr></table></figure>

<h4 id="é€’å½’å®ç°-2"><a href="#é€’å½’å®ç°-2" class="headerlink" title="é€’å½’å®ç°"></a>é€’å½’å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line">    </span><br><span class="line">    TreeNode(<span class="type">int</span> val) &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰åºéå†</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">preorder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. å¤„ç†æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    System.out.println(node.val);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. é€’å½’å¤„ç†å·¦å­æ ‘</span></span><br><span class="line">    preorder(node.left);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. é€’å½’å¤„ç†å³å­æ ‘</span></span><br><span class="line">    preorder(node.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨</span></span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">1</span>);</span><br><span class="line">root.left = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">2</span>);</span><br><span class="line">root.right = <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">preorder(root);  <span class="comment">// è¾“å‡ºï¼š1 2 3</span></span><br></pre></td></tr></table></figure>

<h4 id="æ‰§è¡Œè¿‡ç¨‹-2"><a href="#æ‰§è¡Œè¿‡ç¨‹-2" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">preorder(node1)  // node1.val = 1</span><br><span class="line">  â†“ node1 != null</span><br><span class="line">  â†“ æ‰“å° 1</span><br><span class="line">  â†“ è°ƒç”¨ preorder(node2)  // å¤„ç†å·¦å­æ ‘</span><br><span class="line">    â†“ preorder(node2)  // node2.val = 2</span><br><span class="line">    â†“ node2 != null</span><br><span class="line">    â†“ æ‰“å° 2</span><br><span class="line">    â†“ è°ƒç”¨ preorder(null)  // å·¦å­æ ‘ä¸º null</span><br><span class="line">      â†“ return</span><br><span class="line">    â†“ è°ƒç”¨ preorder(null)  // å³å­æ ‘ä¸º null</span><br><span class="line">      â†“ return</span><br><span class="line">    â†“ return</span><br><span class="line">  â†“ è°ƒç”¨ preorder(node3)  // å¤„ç†å³å­æ ‘</span><br><span class="line">    â†“ preorder(node3)  // node3.val = 3</span><br><span class="line">    â†“ node3 != null</span><br><span class="line">    â†“ æ‰“å° 3</span><br><span class="line">    â†“ è°ƒç”¨ preorder(null)  // å·¦å­æ ‘ä¸º null</span><br><span class="line">      â†“ return</span><br><span class="line">    â†“ è°ƒç”¨ preorder(null)  // å³å­æ ‘ä¸º null</span><br><span class="line">      â†“ return</span><br><span class="line">    â†“ return</span><br><span class="line">  â†“ return</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>é€’å½’å¤„ç†ä¸‰ä¸ªéƒ¨åˆ†ï¼šæ ¹ã€å·¦å­æ ‘ã€å³å­æ ‘</li>
<li>æ¯ä¸ªé€’å½’è°ƒç”¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¤„ç†ä¸€ä¸ªå­æ ‘</li>
<li>é€šè¿‡ <code>node == null</code> åˆ¤æ–­æ˜¯å¦ç»§ç»­é€’å½’</li>
</ul>
<hr>
<h2 id="å››ã€é€’å½’çš„ä¸‰ä¸ªå…³é”®æ¦‚å¿µ"><a href="#å››ã€é€’å½’çš„ä¸‰ä¸ªå…³é”®æ¦‚å¿µ" class="headerlink" title="å››ã€é€’å½’çš„ä¸‰ä¸ªå…³é”®æ¦‚å¿µ"></a>å››ã€é€’å½’çš„ä¸‰ä¸ªå…³é”®æ¦‚å¿µ</h2><h3 id="4-1-é€’å½’çš„â€ä¿¡ä»»â€"><a href="#4-1-é€’å½’çš„â€ä¿¡ä»»â€" class="headerlink" title="4.1 é€’å½’çš„â€ä¿¡ä»»â€"></a>4.1 é€’å½’çš„â€ä¿¡ä»»â€</h3><p><strong>å…³é”®æ€æƒ³</strong>ï¼šä¸è¦è¯•å›¾è¿½è¸ªæ•´ä¸ªé€’å½’è¿‡ç¨‹ï¼Œè€Œæ˜¯<strong>ç›¸ä¿¡é€’å½’å‡½æ•°èƒ½æ­£ç¡®å¤„ç†æ›´å°çš„é—®é¢˜</strong>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯çš„æ€ç»´æ–¹å¼</span></span><br><span class="line"><span class="comment">// è¯•å›¾è¿½è¸ªæ•´ä¸ªé€’å½’è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">preorder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    System.out.println(node.val);</span><br><span class="line">    preorder(node.left);   <span class="comment">// æˆ‘éœ€è¦çŸ¥é“è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ...</span></span><br><span class="line">    preorder(node.right);  <span class="comment">// è¿˜æœ‰è¿™é‡Œ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®çš„æ€ç»´æ–¹å¼</span></span><br><span class="line"><span class="comment">// ç›¸ä¿¡é€’å½’å‡½æ•°èƒ½æ­£ç¡®å¤„ç†å­æ ‘</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">preorder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. å¤„ç†å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">    System.out.println(node.val);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. ç›¸ä¿¡ preorder èƒ½æ­£ç¡®å¤„ç†å·¦å­æ ‘</span></span><br><span class="line">    preorder(node.left);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. ç›¸ä¿¡ preorder èƒ½æ­£ç¡®å¤„ç†å³å­æ ‘</span></span><br><span class="line">    preorder(node.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®</strong>ï¼š</p>
<ul>
<li>ä¸è¦è¯•å›¾åœ¨è„‘å­é‡Œæ¨¡æ‹Ÿæ•´ä¸ªé€’å½’è¿‡ç¨‹</li>
<li>åªéœ€è¦ç¡®ä¿ï¼šç»ˆæ­¢æ¡ä»¶æ­£ç¡® + é€’å½’å…³ç³»æ­£ç¡®</li>
<li>ç›¸ä¿¡é€’å½’å‡½æ•°èƒ½å¤„ç†æ›´å°çš„é—®é¢˜</li>
</ul>
<h3 id="4-2-é€’å½’çš„â€åˆ†æ²»â€"><a href="#4-2-é€’å½’çš„â€åˆ†æ²»â€" class="headerlink" title="4.2 é€’å½’çš„â€åˆ†æ²»â€"></a>4.2 é€’å½’çš„â€åˆ†æ²»â€</h3><p><strong>åˆ†æ²»æ€æƒ³</strong>ï¼šå°†å¤§é—®é¢˜åˆ†è§£ä¸ºç›¸åŒçš„å°é—®é¢˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å¤§é—®é¢˜ï¼šéå†æ•´ä¸ªæ ‘</span><br><span class="line">  â†“ åˆ†è§£</span><br><span class="line">å°é—®é¢˜1ï¼šå¤„ç†æ ¹èŠ‚ç‚¹</span><br><span class="line">å°é—®é¢˜2ï¼šéå†å·¦å­æ ‘ï¼ˆä¸å¤§é—®é¢˜ç›¸åŒï¼Œä½†è§„æ¨¡æ›´å°ï¼‰</span><br><span class="line">å°é—®é¢˜3ï¼šéå†å³å­æ ‘ï¼ˆä¸å¤§é—®é¢˜ç›¸åŒï¼Œä½†è§„æ¨¡æ›´å°ï¼‰</span><br><span class="line">  â†“ é€’å½’å¤„ç†å°é—®é¢˜</span><br><span class="line">  â†“ åˆå¹¶ç»“æœ</span><br><span class="line">å®Œæˆ</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®</strong>ï¼š</p>
<ul>
<li>æ¯æ¬¡é€’å½’éƒ½åœ¨å¤„ç†ä¸€ä¸ªæ›´å°çš„é—®é¢˜</li>
<li>é—®é¢˜çš„ç»“æ„ç›¸åŒï¼Œåªæ˜¯è§„æ¨¡ä¸åŒ</li>
<li>æœ€ç»ˆä¼šåˆ°è¾¾åŸºç¡€æƒ…å†µï¼ˆç»ˆæ­¢æ¡ä»¶ï¼‰</li>
</ul>
<h3 id="4-3-é€’å½’çš„â€å›æº¯â€"><a href="#4-3-é€’å½’çš„â€å›æº¯â€" class="headerlink" title="4.3 é€’å½’çš„â€å›æº¯â€"></a>4.3 é€’å½’çš„â€å›æº¯â€</h3><p><strong>å›æº¯æ€æƒ³</strong>ï¼šé€’å½’ä¼šè‡ªåŠ¨å›æº¯ï¼Œé€å±‚è¿”å›ç»“æœã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é€’å½’ä¸‹é™ï¼š</span><br><span class="line">level 1 â†’ level 2 â†’ level 3 â†’ ... â†’ åŸºç¡€æƒ…å†µ</span><br><span class="line">                                      â†“</span><br><span class="line">å›æº¯ä¸Šå‡ï¼š</span><br><span class="line">level 1 â† level 2 â† level 3 â† ... â† è¿”å›ç»“æœ</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ååºéå†ï¼ˆå›æº¯çš„å…¸å‹åº”ç”¨ï¼‰</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">postorder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    postorder(node.left);   <span class="comment">// å…ˆå¤„ç†å·¦å­æ ‘</span></span><br><span class="line">    postorder(node.right);  <span class="comment">// å†å¤„ç†å³å­æ ‘</span></span><br><span class="line">    System.out.println(node.val);  <span class="comment">// æœ€åå¤„ç†æ ¹èŠ‚ç‚¹ï¼ˆå›æº¯æ—¶ï¼‰</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œè¿‡ç¨‹ï¼š</span></span><br><span class="line"><span class="comment">// 1. é€’å½’ä¸‹é™åˆ°å¶å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">// 2. å›æº¯æ—¶å¤„ç†èŠ‚ç‚¹ï¼ˆååºï¼‰</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="äº”ã€é€’å½’-vs-è¿­ä»£"><a href="#äº”ã€é€’å½’-vs-è¿­ä»£" class="headerlink" title="äº”ã€é€’å½’ vs è¿­ä»£"></a>äº”ã€é€’å½’ vs è¿­ä»£</h2><h3 id="5-1-å¯¹æ¯”è¡¨"><a href="#5-1-å¯¹æ¯”è¡¨" class="headerlink" title="5.1 å¯¹æ¯”è¡¨"></a>5.1 å¯¹æ¯”è¡¨</h3><table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>é€’å½’</th>
<th>è¿­ä»£</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ä»£ç ç®€æ´æ€§</strong></td>
<td>ç®€æ´ã€æ˜“è¯»</td>
<td>å¤æ‚ã€éœ€è¦æ‰‹åŠ¨ç®¡ç†çŠ¶æ€</td>
</tr>
<tr>
<td><strong>ç©ºé—´å¤æ‚åº¦</strong></td>
<td>O(h)ï¼ˆé€’å½’æ ˆï¼‰</td>
<td>O(1)ï¼ˆé€šå¸¸ï¼‰</td>
</tr>
<tr>
<td><strong>æ—¶é—´å¤æ‚åº¦</strong></td>
<td>ç›¸åŒ</td>
<td>ç›¸åŒ</td>
</tr>
<tr>
<td><strong>æ ˆæº¢å‡ºé£é™©</strong></td>
<td>é«˜ï¼ˆæ·±åº¦å¤§æ—¶ï¼‰</td>
<td>æ— </td>
</tr>
<tr>
<td><strong>ç†è§£éš¾åº¦</strong></td>
<td>éœ€è¦ç†è§£é€’å½’æ€æƒ³</td>
<td>ç›¸å¯¹ç›´è§‚</td>
</tr>
<tr>
<td><strong>æ€§èƒ½</strong></td>
<td>ç•¥ä½ï¼ˆå‡½æ•°è°ƒç”¨å¼€é”€ï¼‰</td>
<td>ç•¥é«˜</td>
</tr>
</tbody></table>
<h3 id="5-2-é€’å½’-vs-è¿­ä»£ï¼šé“¾è¡¨éå†"><a href="#5-2-é€’å½’-vs-è¿­ä»£ï¼šé“¾è¡¨éå†" class="headerlink" title="5.2 é€’å½’ vs è¿­ä»£ï¼šé“¾è¡¨éå†"></a>5.2 é€’å½’ vs è¿­ä»£ï¼šé“¾è¡¨éå†</h3><h4 id="é€’å½’æ–¹å¼"><a href="#é€’å½’æ–¹å¼" class="headerlink" title="é€’å½’æ–¹å¼"></a>é€’å½’æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">traverse</span><span class="params">(ListNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    System.out.println(node.val);</span><br><span class="line">    traverse(node.next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜ç‚¹ï¼šç®€æ´ã€æ˜“è¯»</span></span><br><span class="line"><span class="comment">// ç¼ºç‚¹ï¼šå ç”¨æ ˆç©ºé—´ï¼Œé“¾è¡¨å¾ˆé•¿æ—¶å¯èƒ½æ ˆæº¢å‡º</span></span><br></pre></td></tr></table></figure>

<h4 id="è¿­ä»£æ–¹å¼"><a href="#è¿­ä»£æ–¹å¼" class="headerlink" title="è¿­ä»£æ–¹å¼"></a>è¿­ä»£æ–¹å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">traverse</span><span class="params">(ListNode node)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">current</span> <span class="operator">=</span> node;</span><br><span class="line">    <span class="keyword">while</span> (current != <span class="literal">null</span>) &#123;</span><br><span class="line">        System.out.println(current.val);</span><br><span class="line">        current = current.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜ç‚¹ï¼šä¸å ç”¨é¢å¤–æ ˆç©ºé—´ï¼Œæ•ˆç‡é«˜</span></span><br><span class="line"><span class="comment">// ç¼ºç‚¹ï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç†æŒ‡é’ˆ</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-é€’å½’-vs-è¿­ä»£ï¼šæ ‘éå†"><a href="#5-3-é€’å½’-vs-è¿­ä»£ï¼šæ ‘éå†" class="headerlink" title="5.3 é€’å½’ vs è¿­ä»£ï¼šæ ‘éå†"></a>5.3 é€’å½’ vs è¿­ä»£ï¼šæ ‘éå†</h3><h4 id="é€’å½’æ–¹å¼ï¼ˆå‰åºï¼‰"><a href="#é€’å½’æ–¹å¼ï¼ˆå‰åºï¼‰" class="headerlink" title="é€’å½’æ–¹å¼ï¼ˆå‰åºï¼‰"></a>é€’å½’æ–¹å¼ï¼ˆå‰åºï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">preorder</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    System.out.println(node.val);</span><br><span class="line">    preorder(node.left);</span><br><span class="line">    preorder(node.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»£ç ç®€æ´ï¼Œé€»è¾‘æ¸…æ™°</span></span><br></pre></td></tr></table></figure>

<h4 id="è¿­ä»£æ–¹å¼ï¼ˆå‰åºï¼‰"><a href="#è¿­ä»£æ–¹å¼ï¼ˆå‰åºï¼‰" class="headerlink" title="è¿­ä»£æ–¹å¼ï¼ˆå‰åºï¼‰"></a>è¿­ä»£æ–¹å¼ï¼ˆå‰åºï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">preorderIterative</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    stack.push(root);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">        System.out.println(node.val);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(node.right);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(node.left);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€è¦æ‰‹åŠ¨ç®¡ç†æ ˆï¼Œé€»è¾‘å¤æ‚</span></span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®è§‚å¯Ÿ</strong>ï¼š</p>
<ul>
<li>é€’å½’æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨ç³»ç»Ÿæ ˆ</li>
<li>è¿­ä»£æ˜¯æ‰‹åŠ¨ç®¡ç†æ ˆ</li>
<li>é€’å½’ç®€æ´ï¼Œè¿­ä»£é«˜æ•ˆ</li>
</ul>
<hr>
<h2 id="å…­ã€é€’å½’çš„å¸¸è§é™·é˜±"><a href="#å…­ã€é€’å½’çš„å¸¸è§é™·é˜±" class="headerlink" title="å…­ã€é€’å½’çš„å¸¸è§é™·é˜±"></a>å…­ã€é€’å½’çš„å¸¸è§é™·é˜±</h2><h3 id="6-1-é™·é˜±1ï¼šæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶"><a href="#6-1-é™·é˜±1ï¼šæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶" class="headerlink" title="6.1 é™·é˜±1ï¼šæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶"></a>6.1 é™·é˜±1ï¼šæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šæ— é™é€’å½’</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    System.out.println(n);</span><br><span class="line">    recursion(n + <span class="number">1</span>);  <span class="comment">// æ°¸è¿œä¸ä¼šåœæ­¢</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šæœ‰ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">10</span>) <span class="keyword">return</span>;  <span class="comment">// ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    System.out.println(n);</span><br><span class="line">    recursion(n + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-é™·é˜±2ï¼šç»ˆæ­¢æ¡ä»¶æ°¸è¿œä¸ä¼šåˆ°è¾¾"><a href="#6-2-é™·é˜±2ï¼šç»ˆæ­¢æ¡ä»¶æ°¸è¿œä¸ä¼šåˆ°è¾¾" class="headerlink" title="6.2 é™·é˜±2ï¼šç»ˆæ­¢æ¡ä»¶æ°¸è¿œä¸ä¼šåˆ°è¾¾"></a>6.2 é™·é˜±2ï¼šç»ˆæ­¢æ¡ä»¶æ°¸è¿œä¸ä¼šåˆ°è¾¾</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šç»ˆæ­¢æ¡ä»¶é”™è¯¯</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    System.out.println(n);</span><br><span class="line">    recursion(n - <span class="number">2</span>);  <span class="comment">// å¦‚æœ n æ˜¯å¥‡æ•°ï¼Œæ°¸è¿œä¸ä¼šç­‰äº 0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šç»ˆæ­¢æ¡ä»¶æ­£ç¡®</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">0</span>) <span class="keyword">return</span>;  <span class="comment">// åŒ…å«æ‰€æœ‰åœæ­¢æƒ…å†µ</span></span><br><span class="line">    System.out.println(n);</span><br><span class="line">    recursion(n - <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-é™·é˜±3ï¼šé—®é¢˜æ²¡æœ‰çœŸæ­£åˆ†è§£"><a href="#6-3-é™·é˜±3ï¼šé—®é¢˜æ²¡æœ‰çœŸæ­£åˆ†è§£" class="headerlink" title="6.3 é™·é˜±3ï¼šé—®é¢˜æ²¡æœ‰çœŸæ­£åˆ†è§£"></a>6.3 é™·é˜±3ï¼šé—®é¢˜æ²¡æœ‰çœŸæ­£åˆ†è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šé—®é¢˜æ²¡æœ‰å˜å°</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    System.out.println(n);</span><br><span class="line">    recursion(n);  <span class="comment">// é—®é¢˜å¤§å°æ²¡å˜ï¼Œæ— é™é€’å½’</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šé—®é¢˜é€æ­¥å˜å°</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    System.out.println(n);</span><br><span class="line">    recursion(n - <span class="number">1</span>);  <span class="comment">// é—®é¢˜é€æ­¥å˜å°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-é™·é˜±4ï¼šæ ˆæº¢å‡º"><a href="#6-4-é™·é˜±4ï¼šæ ˆæº¢å‡º" class="headerlink" title="6.4 é™·é˜±4ï¼šæ ˆæº¢å‡º"></a>6.4 é™·é˜±4ï¼šæ ˆæº¢å‡º</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å±é™©ï¼šé€’å½’æ·±åº¦å¤ªå¤§</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    recursion(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">recursion(<span class="number">100000</span>);  <span class="comment">// æ ˆæº¢å‡ºï¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… è§£å†³ï¼šä½¿ç”¨è¿­ä»£æˆ–å¢åŠ æ ˆå¤§å°</span></span><br><span class="line"><span class="comment">// æ–¹å¼1ï¼šä½¿ç”¨è¿­ä»£</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">100000</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2ï¼šå¢åŠ æ ˆå¤§å°ï¼ˆJVM å‚æ•°ï¼‰</span></span><br><span class="line"><span class="comment">// java -Xss10m MyProgram</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸ƒã€é€’å½’çš„åº”ç”¨åœºæ™¯"><a href="#ä¸ƒã€é€’å½’çš„åº”ç”¨åœºæ™¯" class="headerlink" title="ä¸ƒã€é€’å½’çš„åº”ç”¨åœºæ™¯"></a>ä¸ƒã€é€’å½’çš„åº”ç”¨åœºæ™¯</h2><h3 id="7-1-é€‚åˆç”¨é€’å½’çš„åœºæ™¯"><a href="#7-1-é€‚åˆç”¨é€’å½’çš„åœºæ™¯" class="headerlink" title="7.1 é€‚åˆç”¨é€’å½’çš„åœºæ™¯"></a>7.1 é€‚åˆç”¨é€’å½’çš„åœºæ™¯</h3><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>åŸå› </th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ ‘&#x2F;å›¾éå†</strong></td>
<td>å¤©ç„¶çš„é€’å½’ç»“æ„</td>
<td>å‰åºã€ä¸­åºã€ååºéå†</td>
</tr>
<tr>
<td><strong>åˆ†æ²»ç®—æ³•</strong></td>
<td>é—®é¢˜å¯åˆ†è§£</td>
<td>å¿«é€Ÿæ’åºã€å½’å¹¶æ’åº</td>
</tr>
<tr>
<td><strong>å›æº¯ç®—æ³•</strong></td>
<td>éœ€è¦å°è¯•æ‰€æœ‰å¯èƒ½</td>
<td>N çš‡åã€ç»„åˆé—®é¢˜</td>
</tr>
<tr>
<td><strong>åŠ¨æ€è§„åˆ’</strong></td>
<td>æœ‰é‡å å­é—®é¢˜</td>
<td>æ–æ³¢é‚£å¥‘æ•°åˆ—</td>
</tr>
</tbody></table>
<h3 id="7-2-ä¸é€‚åˆç”¨é€’å½’çš„åœºæ™¯"><a href="#7-2-ä¸é€‚åˆç”¨é€’å½’çš„åœºæ™¯" class="headerlink" title="7.2 ä¸é€‚åˆç”¨é€’å½’çš„åœºæ™¯"></a>7.2 ä¸é€‚åˆç”¨é€’å½’çš„åœºæ™¯</h3><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>åŸå› </th>
<th>æ›¿ä»£æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody><tr>
<td><strong>çº¿æ€§éå†</strong></td>
<td>è¿­ä»£æ›´é«˜æ•ˆ</td>
<td>ä½¿ç”¨ while å¾ªç¯</td>
</tr>
<tr>
<td><strong>æ·±åº¦å¾ˆå¤§</strong></td>
<td>å®¹æ˜“æ ˆæº¢å‡º</td>
<td>ä½¿ç”¨è¿­ä»£æˆ–å¢åŠ æ ˆå¤§å°</td>
</tr>
<tr>
<td><strong>æ€§èƒ½å…³é”®</strong></td>
<td>å‡½æ•°è°ƒç”¨å¼€é”€å¤§</td>
<td>ä½¿ç”¨è¿­ä»£</td>
</tr>
</tbody></table>
<hr>
<h2 id="å…«ã€é€’å½’çš„è°ƒè¯•æŠ€å·§"><a href="#å…«ã€é€’å½’çš„è°ƒè¯•æŠ€å·§" class="headerlink" title="å…«ã€é€’å½’çš„è°ƒè¯•æŠ€å·§"></a>å…«ã€é€’å½’çš„è°ƒè¯•æŠ€å·§</h2><h3 id="8-1-æ‰“å°é€’å½’æ ˆ"><a href="#8-1-æ‰“å°é€’å½’æ ˆ" class="headerlink" title="8.1 æ‰“å°é€’å½’æ ˆ"></a>8.1 æ‰“å°é€’å½’æ ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">preorder</span><span class="params">(TreeNode node, <span class="type">int</span> depth)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰“å°ç¼©è¿›è¡¨ç¤ºæ·±åº¦</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">indent</span> <span class="operator">=</span> <span class="string">&quot;  &quot;</span>.repeat(depth);</span><br><span class="line">    System.out.println(indent + <span class="string">&quot;è¿›å…¥: &quot;</span> + node.val);</span><br><span class="line">    </span><br><span class="line">    preorder(node.left, depth + <span class="number">1</span>);</span><br><span class="line">    preorder(node.right, depth + <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    System.out.println(indent + <span class="string">&quot;è¿”å›: &quot;</span> + node.val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">// è¿›å…¥: 1</span></span><br><span class="line"><span class="comment">//   è¿›å…¥: 2</span></span><br><span class="line"><span class="comment">//   è¿”å›: 2</span></span><br><span class="line"><span class="comment">//   è¿›å…¥: 3</span></span><br><span class="line"><span class="comment">//   è¿”å›: 3</span></span><br><span class="line"><span class="comment">// è¿”å›: 1</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-éªŒè¯ç»ˆæ­¢æ¡ä»¶"><a href="#8-2-éªŒè¯ç»ˆæ­¢æ¡ä»¶" class="headerlink" title="8.2 éªŒè¯ç»ˆæ­¢æ¡ä»¶"></a>8.2 éªŒè¯ç»ˆæ­¢æ¡ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ æ—¥å¿—éªŒè¯ç»ˆæ­¢æ¡ä»¶</span></span><br><span class="line">    System.out.println(<span class="string">&quot;é€’å½’è°ƒç”¨: n = &quot;</span> + n);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ°è¾¾ç»ˆæ­¢æ¡ä»¶&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    recursion(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-æ£€æŸ¥é—®é¢˜åˆ†è§£"><a href="#8-3-æ£€æŸ¥é—®é¢˜åˆ†è§£" class="headerlink" title="8.3 æ£€æŸ¥é—®é¢˜åˆ†è§£"></a>8.3 æ£€æŸ¥é—®é¢˜åˆ†è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">recursion</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;å¤„ç†é—®é¢˜å¤§å°: &quot;</span> + n);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éªŒè¯é—®é¢˜ç¡®å®åœ¨å˜å°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">nextSize</span> <span class="operator">=</span> n - <span class="number">1</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸‹ä¸€ä¸ªé—®é¢˜å¤§å°: &quot;</span> + nextSize);</span><br><span class="line">    </span><br><span class="line">    recursion(nextSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¹ã€é€’å½’æ€ç»´çš„åŸ¹å…»"><a href="#ä¹ã€é€’å½’æ€ç»´çš„åŸ¹å…»" class="headerlink" title="ä¹ã€é€’å½’æ€ç»´çš„åŸ¹å…»"></a>ä¹ã€é€’å½’æ€ç»´çš„åŸ¹å…»</h2><h3 id="9-1-ä¸‰æ­¥æ³•"><a href="#9-1-ä¸‰æ­¥æ³•" class="headerlink" title="9.1 ä¸‰æ­¥æ³•"></a>9.1 ä¸‰æ­¥æ³•</h3><p><strong>ç¬¬1æ­¥</strong>ï¼šæ˜ç¡®é€’å½’çš„ä¸‰ä¸ªè¦ç´ </p>
<ul>
<li>ç»ˆæ­¢æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>é€’å½’å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>å¦‚ä½•åˆ†è§£é—®é¢˜ï¼Ÿ</li>
</ul>
<p><strong>ç¬¬2æ­¥</strong>ï¼šç›¸ä¿¡é€’å½’</p>
<ul>
<li>ä¸è¦è¯•å›¾è¿½è¸ªæ•´ä¸ªè¿‡ç¨‹</li>
<li>åªéœ€ç¡®ä¿é€»è¾‘æ­£ç¡®</li>
<li>ç›¸ä¿¡é€’å½’èƒ½å¤„ç†æ›´å°çš„é—®é¢˜</li>
</ul>
<p><strong>ç¬¬3æ­¥</strong>ï¼šéªŒè¯</p>
<ul>
<li>æµ‹è¯•åŸºç¡€æƒ…å†µ</li>
<li>æµ‹è¯•ç®€å•æƒ…å†µï¼ˆn&#x3D;1, 2, 3ï¼‰</li>
<li>æµ‹è¯•å¤æ‚æƒ…å†µ</li>
</ul>
<h3 id="9-2-ç»ƒä¹ å»ºè®®"><a href="#9-2-ç»ƒä¹ å»ºè®®" class="headerlink" title="9.2 ç»ƒä¹ å»ºè®®"></a>9.2 ç»ƒä¹ å»ºè®®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»ç®€å•åˆ°å¤æ‚</span></span><br><span class="line"><span class="number">1.</span> é˜¶ä¹˜ï¼šfactorial(n)</span><br><span class="line"><span class="number">2.</span> æ–æ³¢é‚£å¥‘ï¼šfib(n)</span><br><span class="line"><span class="number">3.</span> é“¾è¡¨éå†ï¼štraverse(node)</span><br><span class="line"><span class="number">4.</span> æ ‘éå†ï¼špreorder(node)</span><br><span class="line"><span class="number">5.</span> äºŒåˆ†æŸ¥æ‰¾ï¼šbinarySearch(arr, target)</span><br><span class="line"><span class="number">6.</span> å¿«é€Ÿæ’åºï¼šquickSort(arr)</span><br><span class="line"><span class="number">7.</span> å›æº¯ï¼špermutation(arr)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ç›¸å…³ç¬”è®°"><a href="#ç›¸å…³ç¬”è®°" class="headerlink" title="ç›¸å…³ç¬”è®°"></a>ç›¸å…³ç¬”è®°</h2><ul>
<li>å±æ€§æ•°æ®ç»“æ„éå†è¯¦è§£</li>
<li>é“¾è¡¨æ“ä½œè¯¦è§£</li>
<li>æ ‘çš„æ“ä½œè¯¦è§£</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/12/%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/12/%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E8%AE%BE%E8%AE%A1/" class="post-title-link" itemprop="url">å¤šæ¨¡å—é¡¹ç›®è®¾è®¡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-12 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-12T00:00:00+08:00">2026-01-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Maven/" itemprop="url" rel="index"><span itemprop="name">Maven</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Maven-å¤šæ¨¡å—é¡¹ç›®è®¾è®¡"><a href="#Maven-å¤šæ¨¡å—é¡¹ç›®è®¾è®¡" class="headerlink" title="Maven å¤šæ¨¡å—é¡¹ç›®è®¾è®¡"></a>Maven å¤šæ¨¡å—é¡¹ç›®è®¾è®¡</h1><h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><p>Maven å¤šæ¨¡å—é¡¹ç›®æ˜¯ä¸€ä¸ª<strong>çˆ¶é¡¹ç›®</strong>åŒ…å«å¤šä¸ª<strong>å­æ¨¡å—</strong>çš„ç»“æ„ï¼Œé€šè¿‡ç»Ÿä¸€çš„ POM æ–‡ä»¶ç®¡ç†ä¾èµ–ç‰ˆæœ¬ã€ç¼–è¯‘é…ç½®ç­‰ï¼Œå®ç°ä»£ç å¤ç”¨å’Œé¡¹ç›®è§£è€¦ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨å¤šæ¨¡å—ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨å¤šæ¨¡å—ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨å¤šæ¨¡å—ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨å¤šæ¨¡å—ï¼Ÿ</h3><table>
<thead>
<tr>
<th>ä¼˜åŠ¿</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ä¾èµ–ç®¡ç†</strong></td>
<td>ç»Ÿä¸€ç®¡ç†ç‰ˆæœ¬å·ï¼Œé¿å…ç‰ˆæœ¬å†²çª</td>
</tr>
<tr>
<td><strong>ä»£ç å¤ç”¨</strong></td>
<td>å…¬å…±ä»£ç æå–åˆ°ç‹¬ç«‹æ¨¡å—</td>
</tr>
<tr>
<td><strong>æ¨¡å—è§£è€¦</strong></td>
<td>å„æ¨¡å—èŒè´£æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤</td>
</tr>
<tr>
<td><strong>æ„å»ºä¼˜åŒ–</strong></td>
<td>æ”¯æŒå¢é‡æ„å»ºï¼Œæé«˜æ•ˆç‡</td>
</tr>
<tr>
<td><strong>å›¢é˜Ÿåä½œ</strong></td>
<td>ä¸åŒå›¢é˜Ÿå¯ç‹¬ç«‹å¼€å‘ä¸åŒæ¨¡å—</td>
</tr>
</tbody></table>
<hr>
<h2 id="å…¸å‹çš„å¤šæ¨¡å—ç»“æ„"><a href="#å…¸å‹çš„å¤šæ¨¡å—ç»“æ„" class="headerlink" title="å…¸å‹çš„å¤šæ¨¡å—ç»“æ„"></a>å…¸å‹çš„å¤šæ¨¡å—ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">my-project/                    # çˆ¶é¡¹ç›®</span><br><span class="line">â”œâ”€â”€ pom.xml                    # çˆ¶ POMï¼ˆèšåˆå’Œä¾èµ–ç®¡ç†ï¼‰</span><br><span class="line">â”œâ”€â”€ my-common/                 # å…¬å…±æ¨¡å—</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â””â”€â”€ src/</span><br><span class="line">â”œâ”€â”€ my-service/                # ä¸šåŠ¡æœåŠ¡æ¨¡å—</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â””â”€â”€ src/</span><br><span class="line">â”œâ”€â”€ my-web/                    # Web æ¨¡å—</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â””â”€â”€ src/</span><br><span class="line">â””â”€â”€ my-app/                    # åº”ç”¨å¯åŠ¨æ¨¡å—</span><br><span class="line">    â”œâ”€â”€ pom.xml</span><br><span class="line">    â””â”€â”€ src/</span><br></pre></td></tr></table></figure>

<h3 id="æ¨¡å—åˆ†ç±»"><a href="#æ¨¡å—åˆ†ç±»" class="headerlink" title="æ¨¡å—åˆ†ç±»"></a>æ¨¡å—åˆ†ç±»</h3><ul>
<li><strong>çˆ¶æ¨¡å—</strong>ï¼šåªåŒ…å« POMï¼Œä¸å«æºä»£ç </li>
<li><strong>å…¬å…±æ¨¡å—</strong>ï¼šæä¾›é€šç”¨å·¥å…·ã€å¸¸é‡ã€åŸºç±»ç­‰</li>
<li><strong>ä¸šåŠ¡æ¨¡å—</strong>ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘</li>
<li><strong>Web&#x2F;API æ¨¡å—</strong>ï¼šå¯¹å¤–æ¥å£å±‚</li>
<li><strong>å¯åŠ¨æ¨¡å—</strong>ï¼šåº”ç”¨å…¥å£</li>
</ul>
<hr>
<h2 id="çˆ¶-POM-é…ç½®"><a href="#çˆ¶-POM-é…ç½®" class="headerlink" title="çˆ¶ POM é…ç½®"></a>çˆ¶ POM é…ç½®</h2><h3 id="1-èšåˆé…ç½®ï¼ˆAggregationï¼‰"><a href="#1-èšåˆé…ç½®ï¼ˆAggregationï¼‰" class="headerlink" title="1. èšåˆé…ç½®ï¼ˆAggregationï¼‰"></a>1. èšåˆé…ç½®ï¼ˆAggregationï¼‰</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span>  <span class="comment">&lt;!-- çˆ¶æ¨¡å—å¿…é¡»æ˜¯ pom --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- èšåˆå­æ¨¡å— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>my-common<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>my-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>my-web<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>my-app<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>ä½œç”¨</strong>ï¼šæ‰§è¡Œ <code>mvn clean install</code> æ—¶ï¼Œä¼šè‡ªåŠ¨æ„å»ºæ‰€æœ‰å­æ¨¡å—</p>
<h3 id="2-ä¾èµ–ç®¡ç†ï¼ˆDependency-Managementï¼‰"><a href="#2-ä¾èµ–ç®¡ç†ï¼ˆDependency-Managementï¼‰" class="headerlink" title="2. ä¾èµ–ç®¡ç†ï¼ˆDependency Managementï¼‰"></a>2. ä¾èµ–ç®¡ç†ï¼ˆDependency Managementï¼‰</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å®šä¹‰ç‰ˆæœ¬ï¼Œå­æ¨¡å—ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>åªå£°æ˜ç‰ˆæœ¬ï¼Œä¸å¼•å…¥ä¾èµ–</li>
<li>å­æ¨¡å—å¯é€‰æ‹©æ˜¯å¦ä½¿ç”¨</li>
<li>é¿å…ç‰ˆæœ¬å†²çª</li>
</ul>
<h3 id="3-æ’ä»¶ç®¡ç†ï¼ˆPlugin-Managementï¼‰"><a href="#3-æ’ä»¶ç®¡ç†ï¼ˆPlugin-Managementï¼‰" class="headerlink" title="3. æ’ä»¶ç®¡ç†ï¼ˆPlugin Managementï¼‰"></a>3. æ’ä»¶ç®¡ç†ï¼ˆPlugin Managementï¼‰</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å­æ¨¡å—-POM-é…ç½®"><a href="#å­æ¨¡å—-POM-é…ç½®" class="headerlink" title="å­æ¨¡å— POM é…ç½®"></a>å­æ¨¡å— POM é…ç½®</h2><h3 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- ç»§æ‰¿çˆ¶æ¨¡å— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Common Module<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- ä¾èµ–ï¼ˆç‰ˆæœ¬ä»çˆ¶ POM ç»§æ‰¿ï¼‰ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ¨¡å—é—´ä¾èµ–"><a href="#æ¨¡å—é—´ä¾èµ–" class="headerlink" title="æ¨¡å—é—´ä¾èµ–"></a>æ¨¡å—é—´ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- my-service æ¨¡å—ä¾èµ– my-common --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ç‰ˆæœ¬ä» dependencyManagement ç»§æ‰¿ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="è®¾è®¡æœ€ä½³å®è·µ"><a href="#è®¾è®¡æœ€ä½³å®è·µ" class="headerlink" title="è®¾è®¡æœ€ä½³å®è·µ"></a>è®¾è®¡æœ€ä½³å®è·µ</h2><h3 id="1-æ¨¡å—èŒè´£åˆ’åˆ†"><a href="#1-æ¨¡å—èŒè´£åˆ’åˆ†" class="headerlink" title="1. æ¨¡å—èŒè´£åˆ’åˆ†"></a>1. æ¨¡å—èŒè´£åˆ’åˆ†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">my-project/</span><br><span class="line">â”œâ”€â”€ my-common/           # å·¥å…·ç±»ã€å¸¸é‡ã€åŸºç±»</span><br><span class="line">â”œâ”€â”€ my-domain/           # é¢†åŸŸæ¨¡å‹ã€å®ä½“</span><br><span class="line">â”œâ”€â”€ my-repository/       # æ•°æ®è®¿é—®å±‚</span><br><span class="line">â”œâ”€â”€ my-service/          # ä¸šåŠ¡é€»è¾‘å±‚</span><br><span class="line">â”œâ”€â”€ my-controller/       # æ§åˆ¶å±‚</span><br><span class="line">â””â”€â”€ my-app/              # å¯åŠ¨æ¨¡å—</span><br></pre></td></tr></table></figure>

<p><strong>ä¾èµ–æµå‘</strong>ï¼š<code>app â†’ controller â†’ service â†’ repository â†’ domain â† common</code></p>
<h3 id="2-ç‰ˆæœ¬ç®¡ç†ç­–ç•¥"><a href="#2-ç‰ˆæœ¬ç®¡ç†ç­–ç•¥" class="headerlink" title="2. ç‰ˆæœ¬ç®¡ç†ç­–ç•¥"></a>2. ç‰ˆæœ¬ç®¡ç†ç­–ç•¥</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- çˆ¶ POM ä¸­å®šä¹‰ç‰ˆæœ¬å˜é‡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">project.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å­æ¨¡å—å¼•ç”¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-é¿å…å¾ªç¯ä¾èµ–"><a href="#3-é¿å…å¾ªç¯ä¾èµ–" class="headerlink" title="3. é¿å…å¾ªç¯ä¾èµ–"></a>3. é¿å…å¾ªç¯ä¾èµ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">âŒ é”™è¯¯ï¼šA â†’ B â†’ A</span><br><span class="line">âœ… æ­£ç¡®ï¼šA â†’ B â†’ Cï¼ˆå•å‘ä¾èµ–ï¼‰</span><br></pre></td></tr></table></figure>

<p><strong>æ£€æŸ¥å‘½ä»¤</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:tree</span><br></pre></td></tr></table></figure>

<h3 id="4-æ¨¡å—ç²’åº¦æ§åˆ¶"><a href="#4-æ¨¡å—ç²’åº¦æ§åˆ¶" class="headerlink" title="4. æ¨¡å—ç²’åº¦æ§åˆ¶"></a>4. æ¨¡å—ç²’åº¦æ§åˆ¶</h3><table>
<thead>
<tr>
<th>ç²’åº¦</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç²—ç²’åº¦</strong></td>
<td>æ„å»ºå¿«ï¼Œç®¡ç†ç®€å•</td>
<td>æ¨¡å—èŒè´£æ··ä¹±</td>
</tr>
<tr>
<td><strong>ç»†ç²’åº¦</strong></td>
<td>èŒè´£æ¸…æ™°ï¼Œå¤ç”¨æ€§å¥½</td>
<td>æ„å»ºå¤æ‚ï¼Œä¾èµ–ç®¡ç†å›°éš¾</td>
</tr>
</tbody></table>
<p><strong>å»ºè®®</strong>ï¼šæ ¹æ®å›¢é˜Ÿè§„æ¨¡å’Œé¡¹ç›®å¤æ‚åº¦å¹³è¡¡</p>
<hr>
<h2 id="å¸¸ç”¨-Maven-å‘½ä»¤"><a href="#å¸¸ç”¨-Maven-å‘½ä»¤" class="headerlink" title="å¸¸ç”¨ Maven å‘½ä»¤"></a>å¸¸ç”¨ Maven å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºæ‰€æœ‰æ¨¡å—</span></span><br><span class="line">mvn clean install</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºç‰¹å®šæ¨¡å—</span></span><br><span class="line">mvn clean install -pl my-common</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºæ¨¡å—åŠå…¶ä¾èµ–</span></span><br><span class="line">mvn clean install -pl my-service -am</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·³è¿‡æµ‹è¯•</span></span><br><span class="line">mvn clean install -DskipTests</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä¾èµ–æ ‘</span></span><br><span class="line">mvn dependency:tree</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å¾ªç¯ä¾èµ–</span></span><br><span class="line">mvn dependency:tree | grep <span class="string">&quot;CIRCULAR&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å®æˆ˜ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿ"><a href="#å®æˆ˜ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿ" class="headerlink" title="å®æˆ˜ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿ"></a>å®æˆ˜ç¤ºä¾‹ï¼šç”µå•†ç³»ç»Ÿ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ecommerce-platform/</span><br><span class="line">â”œâ”€â”€ pom.xml                    # çˆ¶ POM</span><br><span class="line">â”œâ”€â”€ ecommerce-common/          # é€šç”¨å·¥å…·ã€å¸¸é‡</span><br><span class="line">â”œâ”€â”€ ecommerce-domain/          # é¢†åŸŸæ¨¡å‹</span><br><span class="line">â”œâ”€â”€ ecommerce-repository/      # æ•°æ®è®¿é—®</span><br><span class="line">â”œâ”€â”€ ecommerce-service/         # ä¸šåŠ¡é€»è¾‘</span><br><span class="line">â”œâ”€â”€ ecommerce-api/             # REST API</span><br><span class="line">â””â”€â”€ ecommerce-app/             # Spring Boot å¯åŠ¨ç±»</span><br></pre></td></tr></table></figure>

<h3 id="ä¾èµ–å…³ç³»"><a href="#ä¾èµ–å…³ç³»" class="headerlink" title="ä¾èµ–å…³ç³»"></a>ä¾èµ–å…³ç³»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ecommerce-app</span><br><span class="line">  â”œâ”€â”€ ecommerce-api</span><br><span class="line">  â”‚   â”œâ”€â”€ ecommerce-service</span><br><span class="line">  â”‚   â”‚   â”œâ”€â”€ ecommerce-repository</span><br><span class="line">  â”‚   â”‚   â”‚   â””â”€â”€ ecommerce-domain</span><br><span class="line">  â”‚   â”‚   â””â”€â”€ ecommerce-common</span><br><span class="line">  â”‚   â””â”€â”€ ecommerce-common</span><br><span class="line">  â””â”€â”€ ...</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="Q1-å­æ¨¡å—å¦‚ä½•è®¿é—®å…¶ä»–å­æ¨¡å—çš„èµ„æºï¼Ÿ"><a href="#Q1-å­æ¨¡å—å¦‚ä½•è®¿é—®å…¶ä»–å­æ¨¡å—çš„èµ„æºï¼Ÿ" class="headerlink" title="Q1: å­æ¨¡å—å¦‚ä½•è®¿é—®å…¶ä»–å­æ¨¡å—çš„èµ„æºï¼Ÿ"></a>Q1: å­æ¨¡å—å¦‚ä½•è®¿é—®å…¶ä»–å­æ¨¡å—çš„èµ„æºï¼Ÿ</h3><p><strong>A</strong>: é€šè¿‡ä¾èµ–å£°æ˜ï¼Œä¸è¦ç›´æ¥å¼•ç”¨æ–‡ä»¶è·¯å¾„</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- âœ… æ­£ç¡® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- âŒ é”™è¯¯ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä¸è¦ä½¿ç”¨ç›¸å¯¹è·¯å¾„ --&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Q2-å¦‚ä½•åªæ„å»ºæŸä¸ªæ¨¡å—ï¼Ÿ"><a href="#Q2-å¦‚ä½•åªæ„å»ºæŸä¸ªæ¨¡å—ï¼Ÿ" class="headerlink" title="Q2: å¦‚ä½•åªæ„å»ºæŸä¸ªæ¨¡å—ï¼Ÿ"></a>Q2: å¦‚ä½•åªæ„å»ºæŸä¸ªæ¨¡å—ï¼Ÿ</h3><p><strong>A</strong>: ä½¿ç”¨ <code>-pl</code> å‚æ•°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean install -pl my-service</span><br></pre></td></tr></table></figure>

<h3 id="Q3-å­æ¨¡å—ç‰ˆæœ¬ä¸çˆ¶æ¨¡å—ä¸åŒå¯ä»¥å—ï¼Ÿ"><a href="#Q3-å­æ¨¡å—ç‰ˆæœ¬ä¸çˆ¶æ¨¡å—ä¸åŒå¯ä»¥å—ï¼Ÿ" class="headerlink" title="Q3: å­æ¨¡å—ç‰ˆæœ¬ä¸çˆ¶æ¨¡å—ä¸åŒå¯ä»¥å—ï¼Ÿ"></a>Q3: å­æ¨¡å—ç‰ˆæœ¬ä¸çˆ¶æ¨¡å—ä¸åŒå¯ä»¥å—ï¼Ÿ</h3><p><strong>A</strong>: ä¸å»ºè®®ã€‚åº”è¯¥ä¿æŒä¸€è‡´ï¼Œä½¿ç”¨ <code>${project.version}</code></p>
<h3 id="Q4-å¦‚ä½•å¤„ç†æ¨¡å—é—´çš„ç‰ˆæœ¬å†²çªï¼Ÿ"><a href="#Q4-å¦‚ä½•å¤„ç†æ¨¡å—é—´çš„ç‰ˆæœ¬å†²çªï¼Ÿ" class="headerlink" title="Q4: å¦‚ä½•å¤„ç†æ¨¡å—é—´çš„ç‰ˆæœ¬å†²çªï¼Ÿ"></a>Q4: å¦‚ä½•å¤„ç†æ¨¡å—é—´çš„ç‰ˆæœ¬å†²çªï¼Ÿ</h3><p><strong>A</strong>: åœ¨çˆ¶ POM çš„ <code>dependencyManagement</code> ä¸­ç»Ÿä¸€å®šä¹‰</p>
<hr>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table>
<thead>
<tr>
<th>è¦ç‚¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>èšåˆ</strong></td>
<td>çˆ¶ POM é€šè¿‡ <code>&lt;modules&gt;</code> ç»Ÿä¸€æ„å»º</td>
</tr>
<tr>
<td><strong>ç»§æ‰¿</strong></td>
<td>å­æ¨¡å—é€šè¿‡ <code>&lt;parent&gt;</code> ç»§æ‰¿é…ç½®</td>
</tr>
<tr>
<td><strong>ä¾èµ–ç®¡ç†</strong></td>
<td>ä½¿ç”¨ <code>&lt;dependencyManagement&gt;</code> ç»Ÿä¸€ç‰ˆæœ¬</td>
</tr>
<tr>
<td><strong>æ¨¡å—åˆ’åˆ†</strong></td>
<td>æŒ‰èŒè´£æ¸…æ™°åˆ’åˆ†ï¼Œé¿å…å¾ªç¯ä¾èµ–</td>
</tr>
<tr>
<td><strong>ç‰ˆæœ¬ç­–ç•¥</strong></td>
<td>ç»Ÿä¸€ç‰ˆæœ¬å·ï¼Œä¾¿äºç»´æŠ¤å’Œå‘å¸ƒ</td>
</tr>
</tbody></table>
<hr>
<h2 id="æ¡†æ¶ç±»å‹é¡¹ç›®è®¾è®¡ï¼ˆSPI-æ¨¡å¼ï¼‰"><a href="#æ¡†æ¶ç±»å‹é¡¹ç›®è®¾è®¡ï¼ˆSPI-æ¨¡å¼ï¼‰" class="headerlink" title="æ¡†æ¶ç±»å‹é¡¹ç›®è®¾è®¡ï¼ˆSPI æ¨¡å¼ï¼‰"></a>æ¡†æ¶ç±»å‹é¡¹ç›®è®¾è®¡ï¼ˆSPI æ¨¡å¼ï¼‰</h2><p>æ¡†æ¶ç±»å‹é¡¹ç›®ä¸æ™®é€šä¸šåŠ¡ç³»ç»Ÿä¸åŒï¼Œéœ€è¦æ”¯æŒ<strong>å¯æ’æ‹”</strong>å’Œ<strong>æ‰©å±•æ€§</strong>ã€‚å…¸å‹åœºæ™¯ï¼š</p>
<ul>
<li>RAG ç³»ç»Ÿï¼šå¤šç§å‘é‡æ•°æ®åº“ï¼ˆESã€PGã€Neo4jã€Milvusï¼‰</li>
<li>ORM æ¡†æ¶ï¼šå¤šç§æ•°æ®åº“æ–¹è¨€ï¼ˆMySQLã€PostgreSQLã€Oracleï¼‰</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¤šç§å®ç°ï¼ˆKafkaã€RabbitMQã€RocketMQï¼‰</li>
</ul>
<h3 id="æ ¸å¿ƒè®¾è®¡æ€æƒ³"><a href="#æ ¸å¿ƒè®¾è®¡æ€æƒ³" class="headerlink" title="æ ¸å¿ƒè®¾è®¡æ€æƒ³"></a>æ ¸å¿ƒè®¾è®¡æ€æƒ³</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                      ç”¨æˆ·åº”ç”¨å±‚                              â”‚</span><br><span class="line">â”‚                  (åªä¾èµ– API + éœ€è¦çš„å®ç°)                    â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                              â”‚</span><br><span class="line">                              â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                    rag-core (æ ¸å¿ƒæ¨¡å—)                       â”‚</span><br><span class="line">â”‚              å®šä¹‰æ¥å£ + é»˜è®¤å®ç° + SPI åŠ è½½æœºåˆ¶               â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                              â”‚</span><br><span class="line">          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">          â–¼                   â–¼                   â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  rag-store-es   â”‚ â”‚  rag-store-pg   â”‚ â”‚ rag-store-neo4j â”‚</span><br><span class="line">â”‚   (ES å®ç°)      â”‚ â”‚  (PgVector)     â”‚ â”‚   (Neo4j å®ç°)   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®åŸåˆ™</strong>ï¼š</p>
<ul>
<li><strong>ä¾èµ–å€’ç½®</strong>ï¼šæ ¸å¿ƒæ¨¡å—å®šä¹‰æ¥å£ï¼Œå®ç°æ¨¡å—ä¾èµ–æ ¸å¿ƒ</li>
<li><strong>æŒ‰éœ€å¼•å…¥</strong>ï¼šç”¨æˆ·åªå¼•å…¥éœ€è¦çš„å®ç°æ¨¡å—</li>
<li><strong>SPI å‘ç°</strong>ï¼šè¿è¡Œæ—¶è‡ªåŠ¨å‘ç°å¹¶åŠ è½½å®ç°</li>
</ul>
<hr>
<h3 id="å®æˆ˜ç¤ºä¾‹ï¼šRAG-ç³»ç»Ÿæ¨¡å—ç»“æ„"><a href="#å®æˆ˜ç¤ºä¾‹ï¼šRAG-ç³»ç»Ÿæ¨¡å—ç»“æ„" class="headerlink" title="å®æˆ˜ç¤ºä¾‹ï¼šRAG ç³»ç»Ÿæ¨¡å—ç»“æ„"></a>å®æˆ˜ç¤ºä¾‹ï¼šRAG ç³»ç»Ÿæ¨¡å—ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">rag-framework/</span><br><span class="line">â”œâ”€â”€ pom.xml                        # çˆ¶ POM</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-core/                      # æ ¸å¿ƒæ¨¡å—</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â””â”€â”€ src/main/java/</span><br><span class="line">â”‚       â””â”€â”€ com/example/rag/</span><br><span class="line">â”‚           â”œâ”€â”€ api/               # æ ¸å¿ƒæ¥å£å®šä¹‰</span><br><span class="line">â”‚           â”‚   â”œâ”€â”€ VectorStore.java</span><br><span class="line">â”‚           â”‚   â””â”€â”€ DocumentSplitter.java</span><br><span class="line">â”‚           â”œâ”€â”€ spi/               # SPI åŠ è½½æœºåˆ¶</span><br><span class="line">â”‚           â”‚   â””â”€â”€ SpiLoader.java</span><br><span class="line">â”‚           â””â”€â”€ model/             # é¢†åŸŸæ¨¡å‹</span><br><span class="line">â”‚               â””â”€â”€ Document.java</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-store-elasticsearch/       # ES å®ç°</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â””â”€â”€ src/main/</span><br><span class="line">â”‚       â”œâ”€â”€ java/.../ElasticsearchVectorStore.java</span><br><span class="line">â”‚       â””â”€â”€ resources/META-INF/services/</span><br><span class="line">â”‚           â””â”€â”€ com.example.rag.api.VectorStore</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-store-pgvector/            # PgVector å®ç°</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â””â”€â”€ src/main/</span><br><span class="line">â”‚       â”œâ”€â”€ java/.../PgVectorStore.java</span><br><span class="line">â”‚       â””â”€â”€ resources/META-INF/services/</span><br><span class="line">â”‚           â””â”€â”€ com.example.rag.api.VectorStore</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-store-neo4j/               # Neo4j å®ç°</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-splitter-fixed/            # å›ºå®šé•¿åº¦åˆ‡ç‰‡</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-splitter-sentence/         # æŒ‰å¥å­åˆ‡ç‰‡</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-splitter-semantic/         # è¯­ä¹‰åˆ‡ç‰‡</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚</span><br><span class="line">â””â”€â”€ rag-spring-boot-starter/       # Spring Boot è‡ªåŠ¨é…ç½®</span><br><span class="line">    â””â”€â”€ ...</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="æ ¸å¿ƒæ¨¡å—è®¾è®¡ï¼ˆrag-coreï¼‰"><a href="#æ ¸å¿ƒæ¨¡å—è®¾è®¡ï¼ˆrag-coreï¼‰" class="headerlink" title="æ ¸å¿ƒæ¨¡å—è®¾è®¡ï¼ˆrag-coreï¼‰"></a>æ ¸å¿ƒæ¨¡å—è®¾è®¡ï¼ˆrag-coreï¼‰</h3><h4 id="1-å®šä¹‰-SPI-æ¥å£"><a href="#1-å®šä¹‰-SPI-æ¥å£" class="headerlink" title="1. å®šä¹‰ SPI æ¥å£"></a>1. å®šä¹‰ SPI æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VectorStore.java - å‘é‡å­˜å‚¨æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VectorStore</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** SPI æ‰©å±•ç‚¹æ ‡è¯† */</span></span><br><span class="line">    String <span class="title function_">getType</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">store</span><span class="params">(List&lt;Document&gt; documents)</span>;</span><br><span class="line">    </span><br><span class="line">    List&lt;Document&gt; <span class="title function_">search</span><span class="params">(String query, <span class="type">int</span> topK)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DocumentSplitter.java - æ–‡æ¡£åˆ‡ç‰‡æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DocumentSplitter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    String <span class="title function_">getType</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    List&lt;Document&gt; <span class="title function_">split</span><span class="params">(Document document)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-SPI-åŠ è½½å™¨"><a href="#2-SPI-åŠ è½½å™¨" class="headerlink" title="2. SPI åŠ è½½å™¨"></a>2. SPI åŠ è½½å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpiLoader</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, Map&lt;String, Object&gt;&gt; CACHE = </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">load</span><span class="params">(Class&lt;T&gt; clazz, String type)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; implementations = CACHE.computeIfAbsent(</span><br><span class="line">            clazz, </span><br><span class="line">            k -&gt; loadImplementations(clazz)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="type">T</span> <span class="variable">impl</span> <span class="operator">=</span> (T) implementations.get(type);</span><br><span class="line">        <span class="keyword">if</span> (impl == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                <span class="string">&quot;No implementation found for type: &quot;</span> + type</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> impl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; Map&lt;String, Object&gt; <span class="title function_">loadImplementations</span><span class="params">(Class&lt;T&gt; clazz)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        ServiceLoader&lt;T&gt; loader = ServiceLoader.load(clazz);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (T impl : loader) &#123;</span><br><span class="line">            <span class="comment">// å‡è®¾æ¥å£æœ‰ getType() æ–¹æ³•</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> getType(impl);</span><br><span class="line">            map.put(type, impl);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-æ ¸å¿ƒæ¨¡å—-POM"><a href="#3-æ ¸å¿ƒæ¨¡å—-POM" class="headerlink" title="3. æ ¸å¿ƒæ¨¡å— POM"></a>3. æ ¸å¿ƒæ¨¡å— POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag-core/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>RAG Core<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- åªæ”¾æœ€åŸºç¡€çš„ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="å®ç°æ¨¡å—è®¾è®¡"><a href="#å®ç°æ¨¡å—è®¾è®¡" class="headerlink" title="å®ç°æ¨¡å—è®¾è®¡"></a>å®ç°æ¨¡å—è®¾è®¡</h3><h4 id="1-ES-å®ç°æ¨¡å—"><a href="#1-ES-å®ç°æ¨¡å—" class="headerlink" title="1. ES å®ç°æ¨¡å—"></a>1. ES å®ç°æ¨¡å—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ElasticsearchVectorStore.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticsearchVectorStore</span> <span class="keyword">implements</span> <span class="title class_">VectorStore</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;elasticsearch&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">store</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="comment">// ES ç‰¹å®šå®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">search</span><span class="params">(String query, <span class="type">int</span> topK)</span> &#123;</span><br><span class="line">        <span class="comment">// ES ç‰¹å®šå®ç°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-SPI-é…ç½®æ–‡ä»¶"><a href="#2-SPI-é…ç½®æ–‡ä»¶" class="headerlink" title="2. SPI é…ç½®æ–‡ä»¶"></a>2. SPI é…ç½®æ–‡ä»¶</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># src/main/resources/META-INF/services/com.example.rag.api.VectorStore</span><br><span class="line">com.example.rag.store.es.ElasticsearchVectorStore</span><br></pre></td></tr></table></figure>

<h4 id="3-å®ç°æ¨¡å—-POM"><a href="#3-å®ç°æ¨¡å—-POM" class="headerlink" title="3. å®ç°æ¨¡å— POM"></a>3. å®ç°æ¨¡å— POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag-store-elasticsearch/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-store-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä¾èµ–æ ¸å¿ƒæ¨¡å— --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- ES ç‰¹å®šä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>co.elastic.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.10.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ç”¨æˆ·ä½¿ç”¨æ–¹å¼"><a href="#ç”¨æˆ·ä½¿ç”¨æ–¹å¼" class="headerlink" title="ç”¨æˆ·ä½¿ç”¨æ–¹å¼"></a>ç”¨æˆ·ä½¿ç”¨æ–¹å¼</h3><h4 id="æŒ‰éœ€å¼•å…¥"><a href="#æŒ‰éœ€å¼•å…¥" class="headerlink" title="æŒ‰éœ€å¼•å…¥"></a>æŒ‰éœ€å¼•å…¥</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç”¨æˆ·é¡¹ç›® pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ ¸å¿ƒï¼ˆå¿…éœ€ï¼‰ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- åªå¼•å…¥éœ€è¦çš„å®ç° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-store-pgvector<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-splitter-semantic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ä»£ç ä½¿ç”¨"><a href="#ä»£ç ä½¿ç”¨" class="headerlink" title="ä»£ç ä½¿ç”¨"></a>ä»£ç ä½¿ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ SPI è‡ªåŠ¨åŠ è½½</span></span><br><span class="line"><span class="type">VectorStore</span> <span class="variable">store</span> <span class="operator">=</span> SpiLoader.load(VectorStore.class, <span class="string">&quot;pgvector&quot;</span>);</span><br><span class="line"><span class="type">DocumentSplitter</span> <span class="variable">splitter</span> <span class="operator">=</span> SpiLoader.load(DocumentSplitter.class, <span class="string">&quot;semantic&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®š</span></span><br><span class="line"><span class="meta">@Value(&quot;$&#123;rag.store.type&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String storeType;</span><br><span class="line"></span><br><span class="line"><span class="type">VectorStore</span> <span class="variable">store</span> <span class="operator">=</span> SpiLoader.load(VectorStore.class, storeType);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ä¾èµ–å…³ç³»å›¾"><a href="#ä¾èµ–å…³ç³»å›¾" class="headerlink" title="ä¾èµ–å…³ç³»å›¾"></a>ä¾èµ–å…³ç³»å›¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·é¡¹ç›®</span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ rag-core (å¿…éœ€)</span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ rag-store-xxx (é€‰ä¸€ä¸ª)</span><br><span class="line">    â”‚   â””â”€â”€ rag-core</span><br><span class="line">    â”‚</span><br><span class="line">    â””â”€â”€ rag-splitter-xxx (é€‰ä¸€ä¸ª)</span><br><span class="line">        â””â”€â”€ rag-core</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>ç”¨æˆ·<strong>ä¸éœ€è¦</strong>åŒæ—¶å¼•å…¥æ‰€æœ‰å®ç°</li>
<li>è¿è¡Œæ—¶é€šè¿‡ SPI è‡ªåŠ¨å‘ç°å¼•å…¥çš„å®ç°</li>
<li>æ–°å¢å®ç°åªéœ€è¦æ·»åŠ æ–°æ¨¡å—ï¼Œä¸ä¿®æ”¹æ ¸å¿ƒä»£ç </li>
</ul>
<hr>
<h3 id="Spring-Boot-Starter-å°è£…"><a href="#Spring-Boot-Starter-å°è£…" class="headerlink" title="Spring Boot Starter å°è£…"></a>Spring Boot Starter å°è£…</h3><p>ä¸ºäº†æ›´å¥½çš„é›†æˆä½“éªŒï¼Œå¯ä»¥æä¾› Starterï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag-spring-boot-starter/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RagAutoConfiguration.java</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(RagProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RagAutoConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> VectorStore <span class="title function_">vectorStore</span><span class="params">(RagProperties props)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SpiLoader.load(VectorStore.class, props.getStore().getType());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> DocumentSplitter <span class="title function_">documentSplitter</span><span class="params">(RagProperties props)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SpiLoader.load(DocumentSplitter.class, props.getSplitter().getType());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨æˆ·é…ç½® application.yml</span></span><br><span class="line"><span class="attr">rag:</span></span><br><span class="line">  <span class="attr">store:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">pgvector</span></span><br><span class="line">  <span class="attr">splitter:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">semantic</span></span><br><span class="line">    <span class="attr">chunk-size:</span> <span class="number">500</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="æ¡†æ¶è®¾è®¡å¯¹æ¯”"><a href="#æ¡†æ¶è®¾è®¡å¯¹æ¯”" class="headerlink" title="æ¡†æ¶è®¾è®¡å¯¹æ¯”"></a>æ¡†æ¶è®¾è®¡å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>è®¾è®¡æ¨¡å¼</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>å…¸å‹æ¡†æ¶</th>
</tr>
</thead>
<tbody><tr>
<td><strong>SPI + å¤šå®ç°æ¨¡å—</strong></td>
<td>åŒä¸€æ¥å£å¤šç§å®ç°</td>
<td>JDBCã€SLF4J</td>
</tr>
<tr>
<td><strong>ç­–ç•¥æ¨¡å¼</strong></td>
<td>ç®—æ³•&#x2F;è¡Œä¸ºå¯æ›¿æ¢</td>
<td>åˆ‡ç‰‡æ–¹å¼ã€åµŒå…¥æ¨¡å‹</td>
</tr>
<tr>
<td><strong>æ¨¡æ¿æ–¹æ³•</strong></td>
<td>å›ºå®šæµç¨‹å¯æ‰©å±•æ­¥éª¤</td>
<td>Spring Template</td>
</tr>
<tr>
<td><strong>å·¥å‚æ¨¡å¼</strong></td>
<td>å¯¹è±¡åˆ›å»ºè§£è€¦</td>
<td>å„ç§ Factory</td>
</tr>
</tbody></table>
<hr>
<h3 id="æ‰©å±•æ€§è®¾è®¡è¦ç‚¹"><a href="#æ‰©å±•æ€§è®¾è®¡è¦ç‚¹" class="headerlink" title="æ‰©å±•æ€§è®¾è®¡è¦ç‚¹"></a>æ‰©å±•æ€§è®¾è®¡è¦ç‚¹</h3><ol>
<li><strong>æ¥å£éš”ç¦»</strong>ï¼šæ ¸å¿ƒæ¥å£æ”¾åœ¨ç‹¬ç«‹æ¨¡å—ï¼Œæ— ç¬¬ä¸‰æ–¹ä¾èµ–</li>
<li><strong>å¯é€‰ä¾èµ–</strong>ï¼šä½¿ç”¨ <code>&lt;optional&gt;true&lt;/optional&gt;</code> é¿å…ä¼ é€’ä¾èµ–</li>
<li><strong>é»˜è®¤å®ç°</strong>ï¼šæ ¸å¿ƒæ¨¡å—æä¾›ç®€å•é»˜è®¤å®ç°</li>
<li><strong>é…ç½®é©±åŠ¨</strong>ï¼šé€šè¿‡é…ç½®åˆ‡æ¢å®ç°ï¼Œè€Œéä»£ç ä¿®æ”¹</li>
<li><strong>ç‰ˆæœ¬å…¼å®¹</strong>ï¼šæ¥å£å˜æ›´éœ€è€ƒè™‘å‘åå…¼å®¹</li>
</ol>
<hr>
<h2 id="å®Œæ•´æ¡†æ¶ç»“æ„ï¼ˆå«åº”ç”¨å±‚ï¼‰"><a href="#å®Œæ•´æ¡†æ¶ç»“æ„ï¼ˆå«åº”ç”¨å±‚ï¼‰" class="headerlink" title="å®Œæ•´æ¡†æ¶ç»“æ„ï¼ˆå«åº”ç”¨å±‚ï¼‰"></a>å®Œæ•´æ¡†æ¶ç»“æ„ï¼ˆå«åº”ç”¨å±‚ï¼‰</h2><p>å®é™…é¡¹ç›®ä¸­ï¼Œé™¤äº†å¯æ’æ‹”çš„åº•å±‚æ¨¡å—ï¼Œè¿˜éœ€è¦<strong>åº”ç”¨å±‚</strong>æ¥ç»„åˆè¿™äº›æ¨¡å—å¹¶å¯¹å¤–æä¾›æœåŠ¡ã€‚</p>
<h3 id="å®Œæ•´æ¨¡å—ç»“æ„"><a href="#å®Œæ•´æ¨¡å—ç»“æ„" class="headerlink" title="å®Œæ•´æ¨¡å—ç»“æ„"></a>å®Œæ•´æ¨¡å—ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">rag-framework/</span><br><span class="line">â”œâ”€â”€ pom.xml                        # çˆ¶ POM</span><br><span class="line">â”‚</span><br><span class="line">â”‚  ===== æ¡†æ¶å±‚ï¼ˆå¯ç‹¬ç«‹å‘å¸ƒç»™ç¬¬ä¸‰æ–¹ä½¿ç”¨ï¼‰=====</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-core/                      # æ ¸å¿ƒæ¥å£ + SPI</span><br><span class="line">â”‚   â””â”€â”€ æ— å¤–éƒ¨ä¾èµ–ï¼Œçº¯æ¥å£å®šä¹‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-stores/                    # å‘é‡å­˜å‚¨å®ç°ï¼ˆèšåˆæ¨¡å—ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml                    # packaging=pomï¼Œèšåˆå­æ¨¡å—</span><br><span class="line">â”‚   â”œâ”€â”€ rag-store-core/            # ğŸ”‘ æŠ½è±¡å±‚ï¼šåŸºç±» + å…¬å…±å·¥å…·</span><br><span class="line">â”‚   â”œâ”€â”€ rag-store-elasticsearch/   # ç»§æ‰¿æŠ½è±¡å±‚</span><br><span class="line">â”‚   â”œâ”€â”€ rag-store-pgvector/</span><br><span class="line">â”‚   â””â”€â”€ rag-store-neo4j/</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-splitters/                 # åˆ‡ç‰‡ç­–ç•¥å®ç°ï¼ˆèšåˆæ¨¡å—ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â”œâ”€â”€ rag-splitter-core/         # ğŸ”‘ æŠ½è±¡å±‚</span><br><span class="line">â”‚   â”œâ”€â”€ rag-splitter-fixed/</span><br><span class="line">â”‚   â”œâ”€â”€ rag-splitter-sentence/</span><br><span class="line">â”‚   â””â”€â”€ rag-splitter-semantic/</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-embeddings/                # åµŒå…¥æ¨¡å‹å®ç°ï¼ˆèšåˆæ¨¡å—ï¼‰</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â”œâ”€â”€ rag-embedding-core/        # ğŸ”‘ æŠ½è±¡å±‚</span><br><span class="line">â”‚   â”œâ”€â”€ rag-embedding-openai/</span><br><span class="line">â”‚   â””â”€â”€ rag-embedding-local/</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-spring-boot-starter/       # Spring Boot è‡ªåŠ¨é…ç½®</span><br><span class="line">â”‚</span><br><span class="line">â”‚  ===== åº”ç”¨å±‚ï¼ˆç»„åˆæ¨¡å—ï¼Œå¯¹å¤–æä¾›æœåŠ¡ï¼‰=====</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag-service/                   # ä¸šåŠ¡æœåŠ¡å±‚</span><br><span class="line">â”œâ”€â”€ rag-api/                       # Controller å±‚ï¼ˆREST APIï¼‰</span><br><span class="line">â””â”€â”€ rag-server/                    # å¯åŠ¨æ¨¡å—</span><br></pre></td></tr></table></figure>

<h3 id="æŠ½è±¡å±‚è®¾è®¡ï¼ˆrag-store-coreï¼‰"><a href="#æŠ½è±¡å±‚è®¾è®¡ï¼ˆrag-store-coreï¼‰" class="headerlink" title="æŠ½è±¡å±‚è®¾è®¡ï¼ˆrag-store-coreï¼‰"></a>æŠ½è±¡å±‚è®¾è®¡ï¼ˆrag-store-coreï¼‰</h3><p>æŠ½è±¡å±‚çš„èŒè´£ï¼š</p>
<ul>
<li><strong>æŠ½è±¡åŸºç±»</strong>ï¼šå®ç°å…¬å…±é€»è¾‘ï¼Œå­ç±»åªéœ€å®ç°å·®å¼‚éƒ¨åˆ†</li>
<li><strong>å·¥å…·ç±»</strong>ï¼šè¿æ¥æ± ç®¡ç†ã€åºåˆ—åŒ–ã€é‡è¯•æœºåˆ¶ç­‰</li>
<li><strong>é…ç½®åŸºç±»</strong>ï¼šå…¬å…±é…ç½®é¡¹</li>
</ul>
<h4 id="ä¾èµ–å…³ç³»-1"><a href="#ä¾èµ–å…³ç³»-1" class="headerlink" title="ä¾èµ–å…³ç³»"></a>ä¾èµ–å…³ç³»</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rag-store-elasticsearch</span><br><span class="line">        â”‚</span><br><span class="line">        â–¼</span><br><span class="line">rag-store-core (æŠ½è±¡å±‚)</span><br><span class="line">        â”‚</span><br><span class="line">        â–¼</span><br><span class="line">   rag-core (æ¥å£)</span><br></pre></td></tr></table></figure>

<h4 id="æŠ½è±¡å±‚ä»£ç ç¤ºä¾‹"><a href="#æŠ½è±¡å±‚ä»£ç ç¤ºä¾‹" class="headerlink" title="æŠ½è±¡å±‚ä»£ç ç¤ºä¾‹"></a>æŠ½è±¡å±‚ä»£ç ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rag-store-core æ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * VectorStore æŠ½è±¡åŸºç±»</span></span><br><span class="line"><span class="comment"> * å®ç°å…¬å…±é€»è¾‘ï¼Œå­ç±»åªéœ€å…³æ³¨ç‰¹å®šæ•°æ®åº“æ“ä½œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractVectorStore</span> <span class="keyword">implements</span> <span class="title class_">VectorStore</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> VectorStoreConfig config;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">AbstractVectorStore</span><span class="params">(VectorStoreConfig config)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.config = config;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">store</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. å…¬å…±é€»è¾‘ï¼šå‚æ•°æ ¡éªŒ</span></span><br><span class="line">        validateDocuments(documents);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. å…¬å…±é€»è¾‘ï¼šæ‰¹é‡å¤„ç†</span></span><br><span class="line">        List&lt;List&lt;Document&gt;&gt; batches = partition(documents, config.getBatchSize());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (List&lt;Document&gt; batch : batches) &#123;</span><br><span class="line">            <span class="comment">// 3. è°ƒç”¨å­ç±»å®ç°çš„å…·ä½“å­˜å‚¨é€»è¾‘</span></span><br><span class="line">            doStore(batch);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">search</span><span class="params">(String query, <span class="type">int</span> topK)</span> &#123;</span><br><span class="line">        <span class="comment">// å…¬å…±é€»è¾‘ï¼šå‚æ•°æ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">if</span> (topK &lt;= <span class="number">0</span> || topK &gt; config.getMaxTopK()) &#123;</span><br><span class="line">            topK = config.getDefaultTopK();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è°ƒç”¨å­ç±»å®ç°</span></span><br><span class="line">        <span class="keyword">return</span> doSearch(query, topK);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ===== å­ç±»å¿…é¡»å®ç°çš„æŠ½è±¡æ–¹æ³• =====</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** å…·ä½“çš„å­˜å‚¨å®ç° */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doStore</span><span class="params">(List&lt;Document&gt; documents)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** å…·ä½“çš„æœç´¢å®ç° */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> List&lt;Document&gt; <span class="title function_">doSearch</span><span class="params">(String query, <span class="type">int</span> topK)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ===== å…¬å…±å·¥å…·æ–¹æ³• =====</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">validateDocuments</span><span class="params">(List&lt;Document&gt; docs)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (docs == <span class="literal">null</span> || docs.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Documents cannot be empty&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> &lt;T&gt; List&lt;List&lt;T&gt;&gt; <span class="title function_">partition</span><span class="params">(List&lt;T&gt; list, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ†æ‰¹å·¥å…·æ–¹æ³•</span></span><br><span class="line">        List&lt;List&lt;T&gt;&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i += size) &#123;</span><br><span class="line">            result.add(list.subList(i, Math.min(i + size, list.size())));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…¬å…±é…ç½®åŸºç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VectorStoreConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">defaultTopK</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxTopK</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">connectTimeout</span> <span class="operator">=</span> <span class="number">5000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">readTimeout</span> <span class="operator">=</span> <span class="number">30000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å…·ä½“å®ç°ï¼ˆç»§æ‰¿æŠ½è±¡å±‚ï¼‰"><a href="#å…·ä½“å®ç°ï¼ˆç»§æ‰¿æŠ½è±¡å±‚ï¼‰" class="headerlink" title="å…·ä½“å®ç°ï¼ˆç»§æ‰¿æŠ½è±¡å±‚ï¼‰"></a>å…·ä½“å®ç°ï¼ˆç»§æ‰¿æŠ½è±¡å±‚ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rag-store-pgvector æ¨¡å—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PgVectorStore</span> <span class="keyword">extends</span> <span class="title class_">AbstractVectorStore</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PgVectorStore</span><span class="params">(PgVectorConfig config, JdbcTemplate jdbcTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(config);  <span class="comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å™¨</span></span><br><span class="line">        <span class="built_in">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;pgvector&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doStore</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="comment">// åªéœ€å®ç° PgVector ç‰¹å®šçš„å­˜å‚¨é€»è¾‘</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;INSERT INTO documents (content, embedding) VALUES (?, ?::vector)&quot;</span>;</span><br><span class="line">        jdbcTemplate.batchUpdate(sql, documents, documents.size(), </span><br><span class="line">            (ps, doc) -&gt; &#123;</span><br><span class="line">                ps.setString(<span class="number">1</span>, doc.getContent());</span><br><span class="line">                ps.setArray(<span class="number">2</span>, toSqlArray(doc.getEmbedding()));</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> List&lt;Document&gt; <span class="title function_">doSearch</span><span class="params">(String query, <span class="type">int</span> topK)</span> &#123;</span><br><span class="line">        <span class="comment">// åªéœ€å®ç° PgVector ç‰¹å®šçš„æœç´¢é€»è¾‘</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            SELECT content, 1 - (embedding &lt;=&gt; ?::vector) as score</span></span><br><span class="line"><span class="string">            FROM documents</span></span><br><span class="line"><span class="string">            ORDER BY embedding &lt;=&gt; ?::vector</span></span><br><span class="line"><span class="string">            LIMIT ?</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.query(sql, documentRowMapper, queryVector, queryVector, topK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§æ‰¿å…¬å…±é…ç½®ï¼Œæ·»åŠ ç‰¹å®šé…ç½®</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PgVectorConfig</span> <span class="keyword">extends</span> <span class="title class_">VectorStoreConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">tableName</span> <span class="operator">=</span> <span class="string">&quot;documents&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">dimension</span> <span class="operator">=</span> <span class="number">1536</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">indexType</span> <span class="operator">=</span> <span class="string">&quot;ivfflat&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="èšåˆæ¨¡å—-POM-ç¤ºä¾‹"><a href="#èšåˆæ¨¡å—-POM-ç¤ºä¾‹" class="headerlink" title="èšåˆæ¨¡å— POM ç¤ºä¾‹"></a>èšåˆæ¨¡å— POM ç¤ºä¾‹</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag-stores/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-stores<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>RAG Vector Stores<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-store-core<span class="tag">&lt;/<span class="name">module</span>&gt;</span>        <span class="comment">&lt;!-- æŠ½è±¡å±‚ä¼˜å…ˆæ„å»º --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-store-elasticsearch<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-store-pgvector<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-store-neo4j<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag-stores/rag-store-core/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-stores<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-store-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- åªä¾èµ–æ ¸å¿ƒæ¥å£ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag-stores/rag-store-pgvector/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-stores<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-store-pgvector<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä¾èµ–æŠ½è±¡å±‚ï¼ˆä¼šä¼ é€’ rag-coreï¼‰ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-store-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- PgVector ç‰¹å®šä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.postgresql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>postgresql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.pgvector<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pgvector<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="çˆ¶-POM-èšåˆé…ç½®"><a href="#çˆ¶-POM-èšåˆé…ç½®" class="headerlink" title="çˆ¶ POM èšåˆé…ç½®"></a>çˆ¶ POM èšåˆé…ç½®</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ ¹ pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-core<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-stores<span class="tag">&lt;/<span class="name">module</span>&gt;</span>       <span class="comment">&lt;!-- èšåˆç›®å½• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-splitters<span class="tag">&lt;/<span class="name">module</span>&gt;</span>    <span class="comment">&lt;!-- èšåˆç›®å½• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-embeddings<span class="tag">&lt;/<span class="name">module</span>&gt;</span>   <span class="comment">&lt;!-- èšåˆç›®å½• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-spring-boot-starter<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-api<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag-server<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="æ¨¡å—ä¾èµ–å…¨æ™¯å›¾"><a href="#æ¨¡å—ä¾èµ–å…¨æ™¯å›¾" class="headerlink" title="æ¨¡å—ä¾èµ–å…¨æ™¯å›¾"></a>æ¨¡å—ä¾èµ–å…¨æ™¯å›¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">         â”‚         rag-server              â”‚</span><br><span class="line">         â”‚   (å¯åŠ¨ç±» + é…ç½® + æ‰“åŒ…)         â”‚</span><br><span class="line">         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                         â”‚</span><br><span class="line">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">         â–¼               â–¼               â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   rag-api    â”‚  â”‚rag-store-pg  â”‚  â”‚rag-splitter- â”‚</span><br><span class="line">â”‚ (Controller) â”‚  â”‚  (é€‰æ‹©çš„å®ç°) â”‚  â”‚  semantic    â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">         â”‚               â”‚               â”‚</span><br><span class="line">         â–¼               â–¼               â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚               â”‚</span><br><span class="line">â”‚ rag-service  â”‚        â”‚               â”‚</span><br><span class="line">â”‚  (ä¸šåŠ¡é€»è¾‘)   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">         â”‚</span><br><span class="line">         â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   rag-core   â”‚</span><br><span class="line">â”‚  (æ ¸å¿ƒæ¥å£)   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Service-å±‚è®¾è®¡ï¼ˆrag-serviceï¼‰"><a href="#Service-å±‚è®¾è®¡ï¼ˆrag-serviceï¼‰" class="headerlink" title="Service å±‚è®¾è®¡ï¼ˆrag-serviceï¼‰"></a>Service å±‚è®¾è®¡ï¼ˆrag-serviceï¼‰</h3><p>Service å±‚è´Ÿè´£<strong>ç»„åˆ</strong>åº•å±‚ç»„ä»¶ï¼Œå®ç°å…·ä½“ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h4 id="æ¨¡å—-POM"><a href="#æ¨¡å—-POM" class="headerlink" title="æ¨¡å— POM"></a>æ¨¡å— POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag-service/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä¾èµ–æ ¸å¿ƒæ¨¡å— --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- Spring ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Service-å®ç°"><a href="#Service-å®ç°" class="headerlink" title="Service å®ç°"></a>Service å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RagService.java - ç»„åˆåº•å±‚ç»„ä»¶</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RagService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VectorStore vectorStore;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DocumentSplitter splitter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EmbeddingModel embeddingModel;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€šè¿‡æ„é€ å™¨æ³¨å…¥ï¼ˆå…·ä½“å®ç°ç”± Starter è‡ªåŠ¨é…ç½®ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RagService</span><span class="params">(VectorStore vectorStore, </span></span><br><span class="line"><span class="params">                      DocumentSplitter splitter,</span></span><br><span class="line"><span class="params">                      EmbeddingModel embeddingModel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.vectorStore = vectorStore;</span><br><span class="line">        <span class="built_in">this</span>.splitter = splitter;</span><br><span class="line">        <span class="built_in">this</span>.embeddingModel = embeddingModel;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æ¡£å…¥åº“æµç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ingest</span><span class="params">(Document document)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. åˆ‡ç‰‡</span></span><br><span class="line">        List&lt;Document&gt; chunks = splitter.split(document);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. ç”Ÿæˆå‘é‡</span></span><br><span class="line">        <span class="keyword">for</span> (Document chunk : chunks) &#123;</span><br><span class="line">            <span class="type">float</span>[] embedding = embeddingModel.embed(chunk.getContent());</span><br><span class="line">            chunk.setEmbedding(embedding);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. å­˜å‚¨</span></span><br><span class="line">        vectorStore.store(chunks);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€ç´¢æµç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">retrieve</span><span class="params">(String query, <span class="type">int</span> topK)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vectorStore.search(query, topK);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * RAG å®Œæ•´æµç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">chat</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ£€ç´¢ç›¸å…³æ–‡æ¡£</span></span><br><span class="line">        List&lt;Document&gt; contexts = retrieve(question, <span class="number">5</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ„å»º Prompt</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> buildPrompt(question, contexts);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. è°ƒç”¨ LLMï¼ˆè¿™é‡Œå¯ä»¥å†æŠ½è±¡ä¸€ä¸ª LLM æ¥å£ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> llmClient.generate(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Controller-å±‚è®¾è®¡ï¼ˆrag-apiï¼‰"><a href="#Controller-å±‚è®¾è®¡ï¼ˆrag-apiï¼‰" class="headerlink" title="Controller å±‚è®¾è®¡ï¼ˆrag-apiï¼‰"></a>Controller å±‚è®¾è®¡ï¼ˆrag-apiï¼‰</h3><p>Controller å±‚è´Ÿè´£<strong>å¯¹å¤–æš´éœ² HTTP æ¥å£</strong>ã€‚</p>
<h4 id="æ¨¡å—-POM-1"><a href="#æ¨¡å—-POM-1" class="headerlink" title="æ¨¡å— POM"></a>æ¨¡å— POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag-api/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä¾èµ– service å±‚ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- Web ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Controller-å®ç°"><a href="#Controller-å®ç°" class="headerlink" title="Controller å®ç°"></a>Controller å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RagController.java</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/rag&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RagController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RagService ragService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RagController</span><span class="params">(RagService ragService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ragService = ragService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æ¡£å…¥åº“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/ingest&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">ingest</span><span class="params">(<span class="meta">@RequestBody</span> IngestRequest request)</span> &#123;</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>(request.getContent(), request.getMetadata());</span><br><span class="line">        ragService.ingest(doc);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€ç´¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/retrieve&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;DocumentVO&gt;&gt; <span class="title function_">retrieve</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam</span> String query,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(defaultValue = &quot;5&quot;)</span> <span class="type">int</span> topK)</span> &#123;</span><br><span class="line">        List&lt;Document&gt; docs = ragService.retrieve(query, topK);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(DocumentVO.from(docs));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é—®ç­”</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ChatResponse&gt; <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestBody</span> ChatRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> ragService.chat(request.getQuestion());</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="keyword">new</span> <span class="title class_">ChatResponse</span>(answer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DTO-å®šä¹‰"><a href="#DTO-å®šä¹‰" class="headerlink" title="DTO å®šä¹‰"></a>DTO å®šä¹‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚/å“åº”å¯¹è±¡æ”¾åœ¨ api æ¨¡å—</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">IngestRequest</span><span class="params">(String content, Map&lt;String, Object&gt; metadata)</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">ChatRequest</span><span class="params">(String question)</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">ChatResponse</span><span class="params">(String answer)</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="å¯åŠ¨æ¨¡å—è®¾è®¡ï¼ˆrag-serverï¼‰"><a href="#å¯åŠ¨æ¨¡å—è®¾è®¡ï¼ˆrag-serverï¼‰" class="headerlink" title="å¯åŠ¨æ¨¡å—è®¾è®¡ï¼ˆrag-serverï¼‰"></a>å¯åŠ¨æ¨¡å—è®¾è®¡ï¼ˆrag-serverï¼‰</h3><p>å¯åŠ¨æ¨¡å—è´Ÿè´£<strong>é€‰æ‹©å…·ä½“å®ç° + æ‰“åŒ…éƒ¨ç½²</strong>ã€‚</p>
<h4 id="æ¨¡å—-POM-2"><a href="#æ¨¡å—-POM-2" class="headerlink" title="æ¨¡å— POM"></a>æ¨¡å— POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag-server/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- API å±‚ï¼ˆåŒ…å« Controllerï¼‰ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- è‡ªåŠ¨é…ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- ===== é€‰æ‹©å…·ä½“å®ç° ===== --&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- å‘é‡å­˜å‚¨ï¼šé€‰æ‹© PgVector --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-store-pgvector<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- åˆ‡ç‰‡æ–¹å¼ï¼šé€‰æ‹©è¯­ä¹‰åˆ‡ç‰‡ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag-splitter-semantic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- Spring Boot --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ‰“åŒ…æˆå¯æ‰§è¡Œ JAR --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RagServerApplication.java</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RagServerApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(RagServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rag:</span></span><br><span class="line">  <span class="attr">store:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">pgvector</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:postgresql://localhost:5432/rag</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">postgres</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">secret</span></span><br><span class="line">  <span class="attr">splitter:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">semantic</span></span><br><span class="line">    <span class="attr">chunk-size:</span> <span class="number">500</span></span><br><span class="line">    <span class="attr">overlap:</span> <span class="number">50</span></span><br><span class="line">  <span class="attr">embedding:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">openai</span></span><br><span class="line">    <span class="attr">api-key:</span> <span class="string">$&#123;OPENAI_API_KEY&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="å¤šç§éƒ¨ç½²æ–¹å¼"><a href="#å¤šç§éƒ¨ç½²æ–¹å¼" class="headerlink" title="å¤šç§éƒ¨ç½²æ–¹å¼"></a>å¤šç§éƒ¨ç½²æ–¹å¼</h3><p>é€šè¿‡ä¸åŒçš„ server æ¨¡å—ï¼Œå¯ä»¥çµæ´»ç»„åˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rag-server-pg/          # PgVector + è¯­ä¹‰åˆ‡ç‰‡</span><br><span class="line">â”œâ”€â”€ pom.xml             # å¼•å…¥ pgvector + semantic</span><br><span class="line">â””â”€â”€ application.yml</span><br><span class="line"></span><br><span class="line">rag-server-es/          # ES + å›ºå®šåˆ‡ç‰‡</span><br><span class="line">â”œâ”€â”€ pom.xml             # å¼•å…¥ elasticsearch + fixed</span><br><span class="line">â””â”€â”€ application.yml</span><br><span class="line"></span><br><span class="line">rag-server-all/         # å…¨éƒ¨å®ç°ï¼ˆé€šè¿‡é…ç½®åˆ‡æ¢ï¼‰</span><br><span class="line">â”œâ”€â”€ pom.xml             # å¼•å…¥æ‰€æœ‰å®ç°</span><br><span class="line">â””â”€â”€ application.yml     # é…ç½®æŒ‡å®šä½¿ç”¨å“ªä¸ª</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="æ¨¡å—èŒè´£æ€»ç»“"><a href="#æ¨¡å—èŒè´£æ€»ç»“" class="headerlink" title="æ¨¡å—èŒè´£æ€»ç»“"></a>æ¨¡å—èŒè´£æ€»ç»“</h3><table>
<thead>
<tr>
<th>æ¨¡å—</th>
<th>èŒè´£</th>
<th>ä¾èµ–</th>
</tr>
</thead>
<tbody><tr>
<td><strong>rag-core</strong></td>
<td>æ ¸å¿ƒæ¥å£å®šä¹‰</td>
<td>æ— </td>
</tr>
<tr>
<td><strong>rag-store-xxx</strong></td>
<td>å‘é‡å­˜å‚¨å®ç°</td>
<td>core</td>
</tr>
<tr>
<td><strong>rag-splitter-xxx</strong></td>
<td>åˆ‡ç‰‡ç­–ç•¥å®ç°</td>
<td>core</td>
</tr>
<tr>
<td><strong>rag-spring-boot-starter</strong></td>
<td>è‡ªåŠ¨é…ç½®</td>
<td>core</td>
</tr>
<tr>
<td><strong>rag-service</strong></td>
<td>ä¸šåŠ¡é€»è¾‘ï¼Œç»„åˆç»„ä»¶</td>
<td>core</td>
</tr>
<tr>
<td><strong>rag-api</strong></td>
<td>REST Controller</td>
<td>service</td>
</tr>
<tr>
<td><strong>rag-server</strong></td>
<td>å¯åŠ¨æ¨¡å—ï¼Œé€‰æ‹©å®ç°</td>
<td>api + starter + å…·ä½“å®ç°</td>
</tr>
</tbody></table>
<h3 id="æ¡†æ¶ä½¿ç”¨è€…-vs-æ¡†æ¶å¼€å‘è€…"><a href="#æ¡†æ¶ä½¿ç”¨è€…-vs-æ¡†æ¶å¼€å‘è€…" class="headerlink" title="æ¡†æ¶ä½¿ç”¨è€… vs æ¡†æ¶å¼€å‘è€…"></a>æ¡†æ¶ä½¿ç”¨è€… vs æ¡†æ¶å¼€å‘è€…</h3><table>
<thead>
<tr>
<th>è§’è‰²</th>
<th>ä½¿ç”¨æ¨¡å—</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ¡†æ¶ä½¿ç”¨è€…</strong></td>
<td>core + starter + å®ç°æ¨¡å—</td>
<td>é›†æˆåˆ°è‡ªå·±é¡¹ç›®</td>
</tr>
<tr>
<td><strong>æ¡†æ¶å¼€å‘è€…</strong></td>
<td>å…¨éƒ¨æ¨¡å—</td>
<td>å¼€å‘å’Œç»´æŠ¤æ¡†æ¶</td>
</tr>
<tr>
<td><strong>ç‹¬ç«‹éƒ¨ç½²</strong></td>
<td>server</td>
<td>ç›´æ¥è¿è¡ŒæœåŠ¡</td>
</tr>
</tbody></table>
<hr>
<h2 id="ç®€åŒ–ä¸‰å±‚ç»“æ„ï¼ˆæ¨èï¼‰"><a href="#ç®€åŒ–ä¸‰å±‚ç»“æ„ï¼ˆæ¨èï¼‰" class="headerlink" title="ç®€åŒ–ä¸‰å±‚ç»“æ„ï¼ˆæ¨èï¼‰"></a>ç®€åŒ–ä¸‰å±‚ç»“æ„ï¼ˆæ¨èï¼‰</h2><p>å¯¹äºä¸­å°å‹é¡¹ç›®ï¼Œå¯ä»¥é‡‡ç”¨æ›´ç®€æ´çš„ä¸‰å±‚ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rag4j/</span><br><span class="line">â”œâ”€â”€ pom.xml                       # çˆ¶ POM</span><br><span class="line">â”œâ”€â”€ rag4j-framework/              # æ¡†æ¶å±‚ - æ ¸å¿ƒæŠ½è±¡ä¸é€šç”¨èƒ½åŠ›</span><br><span class="line">â”œâ”€â”€ rag4j-project/                # å®ç°å±‚ - å…·ä½“æŠ€æœ¯å®ç°</span><br><span class="line">â”œâ”€â”€ rag4j-app/                    # åº”ç”¨å±‚ - WebæœåŠ¡å…¥å£</span><br><span class="line">â””â”€â”€ test/                         # æµ‹è¯•æ¨¡å—</span><br></pre></td></tr></table></figure>

<h3 id="å„å±‚è¯¦ç»†ç»“æ„"><a href="#å„å±‚è¯¦ç»†ç»“æ„" class="headerlink" title="å„å±‚è¯¦ç»†ç»“æ„"></a>å„å±‚è¯¦ç»†ç»“æ„</h3><h4 id="1-æ¡†æ¶å±‚ï¼ˆrag4j-frameworkï¼‰"><a href="#1-æ¡†æ¶å±‚ï¼ˆrag4j-frameworkï¼‰" class="headerlink" title="1. æ¡†æ¶å±‚ï¼ˆrag4j-frameworkï¼‰"></a>1. æ¡†æ¶å±‚ï¼ˆrag4j-frameworkï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">rag4j-framework/</span><br><span class="line">â”œâ”€â”€ pom.xml</span><br><span class="line">â””â”€â”€ src/main/java/com/example/rag4j/framework/</span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ core/                     # æ ¸å¿ƒæ¥å£å®šä¹‰</span><br><span class="line">    â”‚   â”œâ”€â”€ VectorStore.java</span><br><span class="line">    â”‚   â”œâ”€â”€ DocumentSplitter.java</span><br><span class="line">    â”‚   â”œâ”€â”€ EmbeddingModel.java</span><br><span class="line">    â”‚   â””â”€â”€ Document.java</span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ store/                    # å‘é‡å­˜å‚¨æŠ½è±¡</span><br><span class="line">    â”‚   â”œâ”€â”€ AbstractVectorStore.java</span><br><span class="line">    â”‚   â””â”€â”€ VectorStoreConfig.java</span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ splitter/                 # åˆ‡ç‰‡å™¨æŠ½è±¡</span><br><span class="line">    â”‚   â”œâ”€â”€ AbstractSplitter.java</span><br><span class="line">    â”‚   â””â”€â”€ SplitterConfig.java</span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ embedding/                # åµŒå…¥æ¨¡å‹æŠ½è±¡</span><br><span class="line">    â”‚   â””â”€â”€ AbstractEmbeddingModel.java</span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ spi/                      # SPI åŠ è½½æœºåˆ¶</span><br><span class="line">    â”‚   â””â”€â”€ SpiLoader.java</span><br><span class="line">    â”‚</span><br><span class="line">    â””â”€â”€ util/                     # é€šç”¨å·¥å…·</span><br><span class="line">        â”œâ”€â”€ RetryUtil.java</span><br><span class="line">        â””â”€â”€ BatchUtil.java</span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹ç‚¹</strong>ï¼šçº¯æŠ½è±¡ï¼Œæ— ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆæˆ–æœ€å°ä¾èµ–ï¼‰</p>
<h4 id="2-å®ç°å±‚ï¼ˆrag4j-projectï¼‰"><a href="#2-å®ç°å±‚ï¼ˆrag4j-projectï¼‰" class="headerlink" title="2. å®ç°å±‚ï¼ˆrag4j-projectï¼‰"></a>2. å®ç°å±‚ï¼ˆrag4j-projectï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">rag4j-project/</span><br><span class="line">â”œâ”€â”€ pom.xml                       # èšåˆæ¨¡å—</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag4j-store-pgvector/         # PgVector å®ç°</span><br><span class="line">â”‚   â”œâ”€â”€ pom.xml</span><br><span class="line">â”‚   â””â”€â”€ src/.../PgVectorStore.java</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag4j-store-elasticsearch/    # ES å®ç°</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag4j-store-neo4j/            # Neo4j å®ç°</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag4j-splitter-fixed/         # å›ºå®šåˆ‡ç‰‡</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag4j-splitter-semantic/      # è¯­ä¹‰åˆ‡ç‰‡</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ rag4j-embedding-openai/       # OpenAI åµŒå…¥</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚</span><br><span class="line">â””â”€â”€ rag4j-spring-boot-starter/    # Spring Boot è‡ªåŠ¨é…ç½®</span><br><span class="line">    â””â”€â”€ ...</span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹ç‚¹</strong>ï¼šæ¯ä¸ªå®ç°ç‹¬ç«‹æ¨¡å—ï¼ŒæŒ‰éœ€å¼•å…¥</p>
<h4 id="3-åº”ç”¨å±‚ï¼ˆrag4j-appï¼‰"><a href="#3-åº”ç”¨å±‚ï¼ˆrag4j-appï¼‰" class="headerlink" title="3. åº”ç”¨å±‚ï¼ˆrag4j-appï¼‰"></a>3. åº”ç”¨å±‚ï¼ˆrag4j-appï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">rag4j-app/</span><br><span class="line">â”œâ”€â”€ pom.xml</span><br><span class="line">â””â”€â”€ src/main/</span><br><span class="line">    â”œâ”€â”€ java/com/example/rag4j/app/</span><br><span class="line">    â”‚   â”œâ”€â”€ Rag4jApplication.java     # å¯åŠ¨ç±»</span><br><span class="line">    â”‚   â”œâ”€â”€ config/                   # é…ç½®ç±»</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ Rag4jConfig.java</span><br><span class="line">    â”‚   â”œâ”€â”€ service/                  # ä¸šåŠ¡æœåŠ¡</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ RagService.java</span><br><span class="line">    â”‚   â”œâ”€â”€ controller/               # REST API</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ RagController.java</span><br><span class="line">    â”‚   â””â”€â”€ dto/                      # è¯·æ±‚/å“åº”å¯¹è±¡</span><br><span class="line">    â”‚       â”œâ”€â”€ ChatRequest.java</span><br><span class="line">    â”‚       â””â”€â”€ ChatResponse.java</span><br><span class="line">    â””â”€â”€ resources/</span><br><span class="line">        â””â”€â”€ application.yml</span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹ç‚¹</strong>ï¼šç»„åˆæ¡†æ¶å±‚å’Œå®ç°å±‚ï¼Œå¯¹å¤–æä¾›æœåŠ¡</p>
<hr>
<h3 id="ä¾èµ–å…³ç³»-2"><a href="#ä¾èµ–å…³ç³»-2" class="headerlink" title="ä¾èµ–å…³ç³»"></a>ä¾èµ–å…³ç³»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                      rag4j-app                               â”‚</span><br><span class="line">â”‚            (Controller + Service + å¯åŠ¨é…ç½®)                  â”‚</span><br><span class="line">â”‚                                                              â”‚</span><br><span class="line">â”‚   ä¾èµ–: framework + é€‰æ‹©çš„å®ç°æ¨¡å— + starter                   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                              â”‚</span><br><span class="line">          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">          â–¼                   â–¼                   â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ rag4j-store-pg  â”‚ â”‚rag4j-splitter-  â”‚ â”‚ rag4j-embedding â”‚</span><br><span class="line">â”‚                 â”‚ â”‚   semantic      â”‚ â”‚    -openai      â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">          â”‚                   â”‚                   â”‚</span><br><span class="line">          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                              â–¼</span><br><span class="line">              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">              â”‚      rag4j-framework      â”‚</span><br><span class="line">              â”‚   (æ¥å£ + æŠ½è±¡ç±» + SPI)    â”‚</span><br><span class="line">              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="POM-é…ç½®ç¤ºä¾‹"><a href="#POM-é…ç½®ç¤ºä¾‹" class="headerlink" title="POM é…ç½®ç¤ºä¾‹"></a>POM é…ç½®ç¤ºä¾‹</h3><h4 id="çˆ¶-POM"><a href="#çˆ¶-POM" class="headerlink" title="çˆ¶ POM"></a>çˆ¶ POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag4j/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag4j-framework<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag4j-project<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>rag4j-app<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>test<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å†…éƒ¨æ¨¡å—ç‰ˆæœ¬ç®¡ç† --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag4j-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- å…¶ä»–æ¨¡å—... --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="åº”ç”¨å±‚-POM"><a href="#åº”ç”¨å±‚-POM" class="headerlink" title="åº”ç”¨å±‚ POM"></a>åº”ç”¨å±‚ POM</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- rag4j-app/pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag4j-app<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ¡†æ¶å±‚ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag4j-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- é€‰æ‹©å…·ä½“å®ç° --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag4j-store-pgvector<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag4j-splitter-semantic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag4j-embedding-openai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- è‡ªåŠ¨é…ç½® --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rag4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- Spring Boot --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ä¸¤ç§ç»“æ„å¯¹æ¯”"><a href="#ä¸¤ç§ç»“æ„å¯¹æ¯”" class="headerlink" title="ä¸¤ç§ç»“æ„å¯¹æ¯”"></a>ä¸¤ç§ç»“æ„å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>å¯¹æ¯”é¡¹</th>
<th>ç»†ç²’åº¦ç»“æ„</th>
<th>ä¸‰å±‚ç®€åŒ–ç»“æ„</th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ¨¡å—æ•°é‡</strong></td>
<td>å¤šï¼ˆ10+ï¼‰</td>
<td>å°‘ï¼ˆ3-4 + å®ç°ï¼‰</td>
</tr>
<tr>
<td><strong>é€‚ç”¨è§„æ¨¡</strong></td>
<td>å¤§å‹æ¡†æ¶</td>
<td>ä¸­å°å‹é¡¹ç›®</td>
</tr>
<tr>
<td><strong>çµæ´»æ€§</strong></td>
<td>é«˜</td>
<td>é€‚ä¸­</td>
</tr>
<tr>
<td><strong>ç»´æŠ¤æˆæœ¬</strong></td>
<td>é«˜</td>
<td>ä½</td>
</tr>
<tr>
<td><strong>å­¦ä¹ æ›²çº¿</strong></td>
<td>é™¡</td>
<td>å¹³ç¼“</td>
</tr>
<tr>
<td><strong>å…¸å‹æ¡ˆä¾‹</strong></td>
<td>Spring Framework</td>
<td>ä¸šåŠ¡ç³»ç»Ÿ</td>
</tr>
</tbody></table>
<p><strong>å»ºè®®</strong>ï¼š</p>
<ul>
<li><strong>å¯¹å¤–å‘å¸ƒçš„æ¡†æ¶</strong> â†’ ç»†ç²’åº¦ç»“æ„ï¼Œæ–¹ä¾¿ç”¨æˆ·æŒ‰éœ€å¼•å…¥</li>
<li><strong>å†…éƒ¨é¡¹ç›®&#x2F;ä¸šåŠ¡ç³»ç»Ÿ</strong> â†’ ä¸‰å±‚ç®€åŒ–ç»“æ„ï¼Œå¼€å‘æ•ˆç‡é«˜</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/Flux%E6%98%AF%E7%AE%A1%E9%81%93%E4%B8%8D%E6%98%AF%E5%AE%B9%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/Flux%E6%98%AF%E7%AE%A1%E9%81%93%E4%B8%8D%E6%98%AF%E5%AE%B9%E5%99%A8/" class="post-title-link" itemprop="url">Fluxæ˜¯ç®¡é“ä¸æ˜¯å®¹å™¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Reactive-Streams/" itemprop="url" rel="index"><span itemprop="name">Reactive Streams</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Flux-æ˜¯ç®¡é“ï¼Œä¸æ˜¯å®¹å™¨"><a href="#Flux-æ˜¯ç®¡é“ï¼Œä¸æ˜¯å®¹å™¨" class="headerlink" title="Flux æ˜¯ç®¡é“ï¼Œä¸æ˜¯å®¹å™¨"></a>Flux æ˜¯ç®¡é“ï¼Œä¸æ˜¯å®¹å™¨</h1><h2 id="å¸¸è§è¯¯è§£"><a href="#å¸¸è§è¯¯è§£" class="headerlink" title="å¸¸è§è¯¯è§£"></a>å¸¸è§è¯¯è§£</h2><p>å¾ˆå¤šäººåˆå­¦ Reactor æ—¶ä¼šæœ‰è¿™æ ·çš„è¯¯è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç†è§£ï¼šFlux å°±åƒ Listï¼Œæ˜¯è£…æ•°æ®çš„å®¹å™¨</span></span><br><span class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);  <span class="comment">// 3ä¸ªå…ƒç´ ï¼Œç¡®å®šçš„</span></span><br><span class="line">Flux&lt;String&gt; flux = Flux.just(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);      <span class="comment">// ä¹Ÿæ˜¯3ä¸ªå…ƒç´ ï¼Œç¡®å®šçš„ï¼Ÿ</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§ç†è§£åœ¨ç®€å•åœºæ™¯ä¸‹æ²¡é—®é¢˜ï¼Œä½†ä¼šå¯¼è‡´æ— æ³•ç†è§£å¤æ‚åœºæ™¯ã€‚</p>
<hr>
<h2 id="æ­£ç¡®ç†è§£ï¼šFlux-æ˜¯æ•°æ®ç®¡é“"><a href="#æ­£ç¡®ç†è§£ï¼šFlux-æ˜¯æ•°æ®ç®¡é“" class="headerlink" title="æ­£ç¡®ç†è§£ï¼šFlux æ˜¯æ•°æ®ç®¡é“"></a>æ­£ç¡®ç†è§£ï¼šFlux æ˜¯æ•°æ®ç®¡é“</h2><h3 id="ç®¡é“-vs-å®¹å™¨"><a href="#ç®¡é“-vs-å®¹å™¨" class="headerlink" title="ç®¡é“ vs å®¹å™¨"></a>ç®¡é“ vs å®¹å™¨</h3><table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>å®¹å™¨ï¼ˆListï¼‰</th>
<th>ç®¡é“ï¼ˆFluxï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ•°æ®å­˜å‚¨</strong></td>
<td>æ•°æ®å­˜åœ¨å†…å­˜ä¸­</td>
<td>æ•°æ®æµç»ç®¡é“</td>
</tr>
<tr>
<td><strong>æ•°æ®æ—¶æœº</strong></td>
<td>åˆ›å»ºæ—¶å°±æœ‰</td>
<td>è®¢é˜…åæ‰å¼€å§‹æµåŠ¨</td>
</tr>
<tr>
<td><strong>æ•°æ®æ¥æº</strong></td>
<td>å·²çŸ¥ã€å›ºå®š</td>
<td>å¯ä»¥æ˜¯ä»»ä½•æºå¤´</td>
</tr>
<tr>
<td><strong>æ•°æ®æ•°é‡</strong></td>
<td>ç¡®å®šçš„</td>
<td>å¯èƒ½ä¸ç¡®å®š</td>
</tr>
<tr>
<td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td>
<td>ä¸€ç›´å­˜åœ¨</td>
<td>æµå®Œå°±ç»“æŸ</td>
</tr>
</tbody></table>
<h3 id="å½¢è±¡æ¯”å–»"><a href="#å½¢è±¡æ¯”å–»" class="headerlink" title="å½¢è±¡æ¯”å–»"></a>å½¢è±¡æ¯”å–»</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">å®¹å™¨ï¼ˆListï¼‰åƒä¸€ä¸ªæ°´æ¡¶ï¼š</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚  æ°´æ°´æ°´  â”‚  â† æ°´å·²ç»åœ¨æ¡¶é‡Œäº†</span><br><span class="line">â”‚  æ°´æ°´æ°´  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br><span class="line">ç®¡é“ï¼ˆFluxï¼‰åƒä¸€æ ¹æ°´ç®¡ï¼š</span><br><span class="line">                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">æ°´æº â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚  æ°´ç®¡   â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¶ å‡ºæ°´å£</span><br><span class="line">ï¼ˆä¸Šæ¸¸ï¼‰              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 ï¼ˆä¸‹æ¸¸ï¼‰</span><br><span class="line">                         â†‘</span><br><span class="line">                    æ°´æµç»è¿™é‡Œ</span><br><span class="line">                    ä½†ä¸å­˜å‚¨åœ¨è¿™é‡Œ</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å®é™…æ¡ˆä¾‹ï¼šè°ƒç”¨å¤§æ¨¡å‹-API"><a href="#å®é™…æ¡ˆä¾‹ï¼šè°ƒç”¨å¤§æ¨¡å‹-API" class="headerlink" title="å®é™…æ¡ˆä¾‹ï¼šè°ƒç”¨å¤§æ¨¡å‹ API"></a>å®é™…æ¡ˆä¾‹ï¼šè°ƒç”¨å¤§æ¨¡å‹ API</h2><h3 id="åœºæ™¯æè¿°"><a href="#åœºæ™¯æè¿°" class="headerlink" title="åœºæ™¯æè¿°"></a>åœºæ™¯æè¿°</h3><p>è°ƒç”¨ OpenAI&#x2F;Claude ç­‰å¤§æ¨¡å‹ APIï¼Œè¿”å›æµå¼å“åº”ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;String&gt; response = webClient.post()</span><br><span class="line">    .uri(<span class="string">&quot;https://api.openai.com/v1/chat/completions&quot;</span>)</span><br><span class="line">    .header(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Bearer &quot;</span> + apiKey)</span><br><span class="line">    .bodyValue(Map.of(</span><br><span class="line">        <span class="string">&quot;model&quot;</span>, <span class="string">&quot;gpt-4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;messages&quot;</span>, List.of(Map.of(<span class="string">&quot;role&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>, <span class="string">&quot;ä½ å¥½&quot;</span>)),</span><br><span class="line">        <span class="string">&quot;stream&quot;</span>, <span class="literal">true</span></span><br><span class="line">    ))</span><br><span class="line">    .retrieve()</span><br><span class="line">    .bodyToFlux(String.class);</span><br></pre></td></tr></table></figure>

<h3 id="é—®é¢˜ï¼šFlux-é‡Œæœ‰å¤šå°‘æ•°æ®ï¼Ÿ"><a href="#é—®é¢˜ï¼šFlux-é‡Œæœ‰å¤šå°‘æ•°æ®ï¼Ÿ" class="headerlink" title="é—®é¢˜ï¼šFlux é‡Œæœ‰å¤šå°‘æ•°æ®ï¼Ÿ"></a>é—®é¢˜ï¼šFlux é‡Œæœ‰å¤šå°‘æ•°æ®ï¼Ÿ</h3><p><strong>ç­”æ¡ˆï¼šä¸çŸ¥é“ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ï¼</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ª Flux åˆ›å»ºæ—¶ï¼Œå¤§æ¨¡å‹è¿˜æ²¡å¼€å§‹å›å¤</span></span><br><span class="line"><span class="comment">// æ•°æ®é‡å®Œå…¨å–å†³äºå¤§æ¨¡å‹è¦è¯´å¤šå°‘è¯</span></span><br><span class="line">Flux&lt;String&gt; response = callLLM(<span class="string">&quot;è¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯èƒ½è¿”å› 10 ä¸ª chunkï¼Œä¹Ÿå¯èƒ½è¿”å› 100 ä¸ª</span></span><br><span class="line"><span class="comment">// Flux ä¸å…³å¿ƒï¼Œå®ƒåªè´Ÿè´£æŠŠæ•°æ®ä»ä¸Šæ¸¸ä¼ åˆ°ä¸‹æ¸¸</span></span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®æµåŠ¨è¿‡ç¨‹"><a href="#æ•°æ®æµåŠ¨è¿‡ç¨‹" class="headerlink" title="æ•°æ®æµåŠ¨è¿‡ç¨‹"></a>æ•°æ®æµåŠ¨è¿‡ç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                        æ—¶é—´çº¿                                    â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â”‚  T0: åˆ›å»º Flux                                                  â”‚</span><br><span class="line">â”‚      Flux&lt;String&gt; flux = callLLM(prompt);                       â”‚</span><br><span class="line">â”‚      æ­¤æ—¶ï¼šç®¡é“å·²å»ºç«‹ï¼Œä½†æ²¡æœ‰æ•°æ®æµåŠ¨                              â”‚</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â”‚  T1: è®¢é˜… Flux                                                  â”‚</span><br><span class="line">â”‚      flux.subscribe(chunk -&gt; print(chunk));                     â”‚</span><br><span class="line">â”‚      æ­¤æ—¶ï¼šå‘ä¸Šæ¸¸å‘é€è¯·æ±‚ï¼Œå¼€å§‹ç­‰å¾…æ•°æ®                            â”‚</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â”‚  T2: å¤§æ¨¡å‹å¼€å§‹å›å¤                                              â”‚</span><br><span class="line">â”‚      ä¸Šæ¸¸å‘é€ onNext(&quot;ä½ &quot;)                                       â”‚</span><br><span class="line">â”‚      ä¸‹æ¸¸æ”¶åˆ° &quot;ä½ &quot;ï¼Œæ‰“å°                                         â”‚</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â”‚  T3: å¤§æ¨¡å‹ç»§ç»­å›å¤                                              â”‚</span><br><span class="line">â”‚      ä¸Šæ¸¸å‘é€ onNext(&quot;å¥½&quot;)                                       â”‚</span><br><span class="line">â”‚      ä¸‹æ¸¸æ”¶åˆ° &quot;å¥½&quot;ï¼Œæ‰“å°                                         â”‚</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â”‚  T4: å¤§æ¨¡å‹ç»§ç»­å›å¤                                              â”‚</span><br><span class="line">â”‚      ä¸Šæ¸¸å‘é€ onNext(&quot;ï¼Œæˆ‘æ˜¯AIåŠ©æ‰‹&quot;)                             â”‚</span><br><span class="line">â”‚      ä¸‹æ¸¸æ”¶åˆ°ï¼Œæ‰“å°                                              â”‚</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â”‚  T5: å¤§æ¨¡å‹å›å¤å®Œæ¯•                                              â”‚</span><br><span class="line">â”‚      ä¸Šæ¸¸å‘é€ onComplete()                                       â”‚</span><br><span class="line">â”‚      ä¸‹æ¸¸çŸ¥é“æµç»“æŸäº†                                            â”‚</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h3 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/chat&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestParam</span> String prompt)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. åˆ›å»º Fluxï¼ˆæ­¤æ—¶æ²¡æœ‰æ•°æ®ï¼‰</span></span><br><span class="line">    Flux&lt;String&gt; response = webClient.post()</span><br><span class="line">        .uri(<span class="string">&quot;/v1/chat/completions&quot;</span>)</span><br><span class="line">        .bodyValue(buildRequest(prompt))</span><br><span class="line">        .retrieve()</span><br><span class="line">        .bodyToFlux(ChatResponse.class)</span><br><span class="line">        .map(r -&gt; r.getChoices().get(<span class="number">0</span>).getDelta().getContent())</span><br><span class="line">        .filter(Objects::nonNull);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. è¿”å› Fluxï¼ˆSpring WebFlux ä¼šè‡ªåŠ¨è®¢é˜…å¹¶æµå¼è¿”å›ç»™å‰ç«¯ï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. å‰ç«¯ä¼šé€å­—æ”¶åˆ°å¤§æ¨¡å‹çš„å›å¤</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Flux-çš„æ•°æ®æ¥æº"><a href="#Flux-çš„æ•°æ®æ¥æº" class="headerlink" title="Flux çš„æ•°æ®æ¥æº"></a>Flux çš„æ•°æ®æ¥æº</h2><p>Flux çš„æ•°æ®å¯ä»¥æ¥è‡ªå„ç§æºå¤´ï¼š</p>
<h3 id="1-é™æ€æ•°æ®ï¼ˆç¡®å®šçš„ï¼‰"><a href="#1-é™æ€æ•°æ®ï¼ˆç¡®å®šçš„ï¼‰" class="headerlink" title="1. é™æ€æ•°æ®ï¼ˆç¡®å®šçš„ï¼‰"></a>1. é™æ€æ•°æ®ï¼ˆç¡®å®šçš„ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•°æ®åœ¨åˆ›å»ºæ—¶å°±ç¡®å®šäº†</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">Flux.fromIterable(list);</span><br><span class="line">Flux.fromArray(array);</span><br></pre></td></tr></table></figure>

<h3 id="2-ç”Ÿæˆè§„åˆ™ï¼ˆæŒ‰è§„åˆ™äº§ç”Ÿï¼‰"><a href="#2-ç”Ÿæˆè§„åˆ™ï¼ˆæŒ‰è§„åˆ™äº§ç”Ÿï¼‰" class="headerlink" title="2. ç”Ÿæˆè§„åˆ™ï¼ˆæŒ‰è§„åˆ™äº§ç”Ÿï¼‰"></a>2. ç”Ÿæˆè§„åˆ™ï¼ˆæŒ‰è§„åˆ™äº§ç”Ÿï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‰è§„åˆ™ç”Ÿæˆï¼Œæ•°é‡å¯èƒ½æ— é™</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>);                    <span class="comment">// 1åˆ°100</span></span><br><span class="line">Flux.interval(Duration.ofSeconds(<span class="number">1</span>));  <span class="comment">// æ¯ç§’ä¸€ä¸ªï¼Œæ— é™</span></span><br></pre></td></tr></table></figure>

<h3 id="3-å¤–éƒ¨æ•°æ®æºï¼ˆä¸ç¡®å®šçš„ï¼‰"><a href="#3-å¤–éƒ¨æ•°æ®æºï¼ˆä¸ç¡®å®šçš„ï¼‰" class="headerlink" title="3. å¤–éƒ¨æ•°æ®æºï¼ˆä¸ç¡®å®šçš„ï¼‰"></a>3. å¤–éƒ¨æ•°æ®æºï¼ˆä¸ç¡®å®šçš„ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•°æ®æ¥è‡ªå¤–éƒ¨ï¼Œæ•°é‡ä¸ç¡®å®š</span></span><br><span class="line">Flux&lt;String&gt; httpResponse = webClient.get().retrieve().bodyToFlux(String.class);</span><br><span class="line">Flux&lt;Message&gt; kafkaMessages = kafkaReceiver.receive();</span><br><span class="line">Flux&lt;String&gt; websocketMessages = session.receive().map(WebSocketMessage::getPayloadAsText);</span><br><span class="line">Flux&lt;String&gt; fileLines = Flux.using(</span><br><span class="line">    () -&gt; Files.lines(path),</span><br><span class="line">    Flux::fromStream,</span><br><span class="line">    Stream::close</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="4-æ‰‹åŠ¨æ¨é€ï¼ˆSinksï¼‰"><a href="#4-æ‰‹åŠ¨æ¨é€ï¼ˆSinksï¼‰" class="headerlink" title="4. æ‰‹åŠ¨æ¨é€ï¼ˆSinksï¼‰"></a>4. æ‰‹åŠ¨æ¨é€ï¼ˆSinksï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½ è‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™å‘é€ä»€ä¹ˆæ•°æ®</span></span><br><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯1&quot;</span>);</span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯2&quot;</span>);</span><br><span class="line">Flux&lt;String&gt; flux = sink.asFlux();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Flux-æ€ä¹ˆçŸ¥é“æ•°æ®ç»“æŸï¼Ÿ"><a href="#Flux-æ€ä¹ˆçŸ¥é“æ•°æ®ç»“æŸï¼Ÿ" class="headerlink" title="Flux æ€ä¹ˆçŸ¥é“æ•°æ®ç»“æŸï¼Ÿ"></a>Flux æ€ä¹ˆçŸ¥é“æ•°æ®ç»“æŸï¼Ÿ</h2><h3 id="ä¸‰ç§ç»ˆæ­¢ä¿¡å·"><a href="#ä¸‰ç§ç»ˆæ­¢ä¿¡å·" class="headerlink" title="ä¸‰ç§ç»ˆæ­¢ä¿¡å·"></a>ä¸‰ç§ç»ˆæ­¢ä¿¡å·</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flux.subscribe(</span><br><span class="line">    data -&gt; &#123; &#125;,           <span class="comment">// onNext: æ”¶åˆ°æ•°æ®</span></span><br><span class="line">    error -&gt; &#123; &#125;,          <span class="comment">// onError: å‘ç”Ÿé”™è¯¯ï¼Œæµç»ˆæ­¢</span></span><br><span class="line">    () -&gt; &#123; &#125;              <span class="comment">// onComplete: æ­£å¸¸å®Œæˆï¼Œæµç»ˆæ­¢</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="è°å‘é€ç»ˆæ­¢ä¿¡å·ï¼Ÿ"><a href="#è°å‘é€ç»ˆæ­¢ä¿¡å·ï¼Ÿ" class="headerlink" title="è°å‘é€ç»ˆæ­¢ä¿¡å·ï¼Ÿ"></a>è°å‘é€ç»ˆæ­¢ä¿¡å·ï¼Ÿ</h3><p><strong>ä¸Šæ¸¸ï¼ˆç”Ÿäº§è€…ï¼‰å†³å®šä½•æ—¶ç»“æŸ</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹1ï¼šé™æ€æ•°æ® - å‘å®Œå°±ç»“æŸ</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// å†…éƒ¨ï¼šonNext(1), onNext(2), onNext(3), onComplete()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹2ï¼šHTTP å“åº” - æœåŠ¡ç«¯å…³é—­è¿æ¥æ—¶ç»“æŸ</span></span><br><span class="line">webClient.get().retrieve().bodyToFlux(String.class);</span><br><span class="line"><span class="comment">// å†…éƒ¨ï¼šonNext(chunk1), onNext(chunk2), ..., onComplete()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹3ï¼šæ— é™æµ - æ°¸ä¸ç»“æŸï¼ˆé™¤éå‡ºé”™æˆ–å–æ¶ˆï¼‰</span></span><br><span class="line">Flux.interval(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line"><span class="comment">// å†…éƒ¨ï¼šonNext(0), onNext(1), onNext(2), ... (æ°¸è¿œç»§ç»­)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹4ï¼šæ‰‹åŠ¨æ§åˆ¶ - ä½ å†³å®šä½•æ—¶ç»“æŸ</span></span><br><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().unicast().onBackpressureBuffer();</span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">sink.tryEmitComplete();  <span class="comment">// ä½ å†³å®šç»“æŸ</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å¯¹æ¯”ï¼šä»€ä¹ˆæ—¶å€™ç”¨-Fluxï¼Œä»€ä¹ˆæ—¶å€™ç”¨-Sinks"><a href="#å¯¹æ¯”ï¼šä»€ä¹ˆæ—¶å€™ç”¨-Fluxï¼Œä»€ä¹ˆæ—¶å€™ç”¨-Sinks" class="headerlink" title="å¯¹æ¯”ï¼šä»€ä¹ˆæ—¶å€™ç”¨ Fluxï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Sinks"></a>å¯¹æ¯”ï¼šä»€ä¹ˆæ—¶å€™ç”¨ Fluxï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Sinks</h2><h3 id="ä½ æ˜¯æ¶ˆè´¹è€…-â†’-ç”¨-Flux"><a href="#ä½ æ˜¯æ¶ˆè´¹è€…-â†’-ç”¨-Flux" class="headerlink" title="ä½ æ˜¯æ¶ˆè´¹è€… â†’ ç”¨ Flux"></a>ä½ æ˜¯æ¶ˆè´¹è€… â†’ ç”¨ Flux</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœºæ™¯ï¼šè°ƒç”¨åˆ«äººçš„ APIï¼Œæ¥æ”¶æ•°æ®</span></span><br><span class="line">Flux&lt;String&gt; response = callExternalAPI();</span><br><span class="line">response.subscribe(data -&gt; process(data));</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœºæ™¯ï¼šä»æ•°æ®åº“æŸ¥è¯¢</span></span><br><span class="line">Flux&lt;User&gt; users = userRepository.findAll();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœºæ™¯ï¼šè¯»å–æ–‡ä»¶</span></span><br><span class="line">Flux&lt;String&gt; lines = readFileLines(path);</span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹ç‚¹</strong>ï¼šæ•°æ®ç”±åˆ«äººäº§ç”Ÿï¼Œä½ åªéœ€è¦æ¥æ”¶å’Œå¤„ç†ã€‚</p>
<h3 id="ä½ æ˜¯ç”Ÿäº§è€…-â†’-ç”¨-Sinks"><a href="#ä½ æ˜¯ç”Ÿäº§è€…-â†’-ç”¨-Sinks" class="headerlink" title="ä½ æ˜¯ç”Ÿäº§è€… â†’ ç”¨ Sinks"></a>ä½ æ˜¯ç”Ÿäº§è€… â†’ ç”¨ Sinks</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœºæ™¯ï¼šWebSocket æœåŠ¡ç«¯ï¼Œä¸»åŠ¨æ¨é€æ¶ˆæ¯</span></span><br><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æŸä¸ªäº‹ä»¶è§¦å‘æ—¶å‘é€æ•°æ®</span></span><br><span class="line"><span class="meta">@EventListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onUserLogin</span><span class="params">(UserLoginEvent event)</span> &#123;</span><br><span class="line">    sink.tryEmitNext(<span class="string">&quot;ç”¨æˆ· &quot;</span> + event.getUsername() + <span class="string">&quot; ç™»å½•äº†&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®¢æˆ·ç«¯è®¢é˜…è¿™ä¸ªæµ</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">getNotifications</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sink.asFlux();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹ç‚¹</strong>ï¼šæ•°æ®ç”±ä½ äº§ç”Ÿï¼Œä½ éœ€è¦ä¸»åŠ¨æ¨é€ã€‚</p>
<h3 id="å¯¹æ¯”è¡¨"><a href="#å¯¹æ¯”è¡¨" class="headerlink" title="å¯¹æ¯”è¡¨"></a>å¯¹æ¯”è¡¨</h3><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>è§’è‰²</th>
<th>ä½¿ç”¨</th>
<th>æ•°æ®æ¥æº</th>
</tr>
</thead>
<tbody><tr>
<td>è°ƒç”¨ HTTP API</td>
<td>æ¶ˆè´¹è€…</td>
<td>Flux</td>
<td>æœåŠ¡ç«¯è¿”å›</td>
</tr>
<tr>
<td>æŸ¥è¯¢æ•°æ®åº“</td>
<td>æ¶ˆè´¹è€…</td>
<td>Flux</td>
<td>æ•°æ®åº“è¿”å›</td>
</tr>
<tr>
<td>è¯»å–æ¶ˆæ¯é˜Ÿåˆ—</td>
<td>æ¶ˆè´¹è€…</td>
<td>Flux</td>
<td>é˜Ÿåˆ—æ¨é€</td>
</tr>
<tr>
<td>WebSocket æ¨é€</td>
<td>ç”Ÿäº§è€…</td>
<td>Sinks</td>
<td>ä½ ä¸»åŠ¨å‘é€</td>
</tr>
<tr>
<td>äº‹ä»¶å¹¿æ’­</td>
<td>ç”Ÿäº§è€…</td>
<td>Sinks</td>
<td>ä½ ä¸»åŠ¨å‘é€</td>
</tr>
<tr>
<td>å°è£…å›è°ƒ API</td>
<td>ç”Ÿäº§è€…</td>
<td>Sinks</td>
<td>å›è°ƒè§¦å‘æ—¶å‘é€</td>
</tr>
</tbody></table>
<hr>
<h2 id="æ·±å…¥ç†è§£ï¼šæ‡’åŠ è½½ä¸è®¢é˜…"><a href="#æ·±å…¥ç†è§£ï¼šæ‡’åŠ è½½ä¸è®¢é˜…" class="headerlink" title="æ·±å…¥ç†è§£ï¼šæ‡’åŠ è½½ä¸è®¢é˜…"></a>æ·±å…¥ç†è§£ï¼šæ‡’åŠ è½½ä¸è®¢é˜…</h2><h3 id="Flux-æ˜¯æ‡’åŠ è½½çš„"><a href="#Flux-æ˜¯æ‡’åŠ è½½çš„" class="headerlink" title="Flux æ˜¯æ‡’åŠ è½½çš„"></a>Flux æ˜¯æ‡’åŠ è½½çš„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™è¡Œä»£ç æ‰§è¡Œæ—¶ï¼Œå¹¶æ²¡æœ‰çœŸæ­£è°ƒç”¨ API</span></span><br><span class="line">Flux&lt;String&gt; flux = webClient.get().uri(<span class="string">&quot;/api&quot;</span>).retrieve().bodyToFlux(String.class);</span><br><span class="line">System.out.println(<span class="string">&quot;Flux åˆ›å»ºå®Œæˆ&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªæœ‰è®¢é˜…æ—¶ï¼Œæ‰çœŸæ­£å‘èµ·è¯·æ±‚</span></span><br><span class="line">flux.subscribe(data -&gt; System.out.println(<span class="string">&quot;æ”¶åˆ°: &quot;</span> + data));</span><br><span class="line">System.out.println(<span class="string">&quot;è®¢é˜…å®Œæˆ&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºé¡ºåºï¼š</span></span><br><span class="line"><span class="comment">// Flux åˆ›å»ºå®Œæˆ</span></span><br><span class="line"><span class="comment">// è®¢é˜…å®Œæˆ</span></span><br><span class="line"><span class="comment">// æ”¶åˆ°: xxxï¼ˆå¼‚æ­¥ï¼Œç¨åè¾“å‡ºï¼‰</span></span><br></pre></td></tr></table></figure>

<h3 id="æ¯æ¬¡è®¢é˜…éƒ½æ˜¯ç‹¬ç«‹çš„"><a href="#æ¯æ¬¡è®¢é˜…éƒ½æ˜¯ç‹¬ç«‹çš„" class="headerlink" title="æ¯æ¬¡è®¢é˜…éƒ½æ˜¯ç‹¬ç«‹çš„"></a>æ¯æ¬¡è®¢é˜…éƒ½æ˜¯ç‹¬ç«‹çš„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;String&gt; flux = webClient.get().uri(<span class="string">&quot;/api/random&quot;</span>).retrieve().bodyToFlux(String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ¬¡è®¢é˜… - å‘èµ·ç¬¬ä¸€æ¬¡è¯·æ±‚</span></span><br><span class="line">flux.subscribe(data -&gt; System.out.println(<span class="string">&quot;è®¢é˜…1: &quot;</span> + data));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒæ¬¡è®¢é˜… - å‘èµ·ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆç‹¬ç«‹çš„ï¼‰</span></span><br><span class="line">flux.subscribe(data -&gt; System.out.println(<span class="string">&quot;è®¢é˜…2: &quot;</span> + data));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¤æ¬¡è®¢é˜…å¯èƒ½æ”¶åˆ°ä¸åŒçš„æ•°æ®ï¼</span></span><br></pre></td></tr></table></figure>

<h3 id="å†·æµ-vs-çƒ­æµ"><a href="#å†·æµ-vs-çƒ­æµ" class="headerlink" title="å†·æµ vs çƒ­æµ"></a>å†·æµ vs çƒ­æµ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å†·æµï¼šæ¯ä¸ªè®¢é˜…è€…éƒ½ä»å¤´å¼€å§‹</span></span><br><span class="line">Flux&lt;Integer&gt; cold = Flux.range(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">cold.subscribe(i -&gt; System.out.println(<span class="string">&quot;A: &quot;</span> + i));  <span class="comment">// A: 1, 2, 3</span></span><br><span class="line">cold.subscribe(i -&gt; System.out.println(<span class="string">&quot;B: &quot;</span> + i));  <span class="comment">// B: 1, 2, 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// çƒ­æµï¼šè®¢é˜…è€…å…±äº«æ•°æ®æµ</span></span><br><span class="line">Sinks.Many&lt;Integer&gt; sink = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line">Flux&lt;Integer&gt; hot = sink.asFlux();</span><br><span class="line"></span><br><span class="line">hot.subscribe(i -&gt; System.out.println(<span class="string">&quot;A: &quot;</span> + i));</span><br><span class="line">sink.tryEmitNext(<span class="number">1</span>);  <span class="comment">// A: 1</span></span><br><span class="line">hot.subscribe(i -&gt; System.out.println(<span class="string">&quot;B: &quot;</span> + i));</span><br><span class="line">sink.tryEmitNext(<span class="number">2</span>);  <span class="comment">// A: 2, B: 2ï¼ˆB æ²¡æ”¶åˆ° 1ï¼‰</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å®æˆ˜ï¼šå¤§æ¨¡å‹æµå¼è°ƒç”¨å®Œæ•´ç¤ºä¾‹"><a href="#å®æˆ˜ï¼šå¤§æ¨¡å‹æµå¼è°ƒç”¨å®Œæ•´ç¤ºä¾‹" class="headerlink" title="å®æˆ˜ï¼šå¤§æ¨¡å‹æµå¼è°ƒç”¨å®Œæ•´ç¤ºä¾‹"></a>å®æˆ˜ï¼šå¤§æ¨¡å‹æµå¼è°ƒç”¨å®Œæ•´ç¤ºä¾‹</h2><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/chat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient webClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestParam</span> String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient.post()</span><br><span class="line">            .uri(<span class="string">&quot;https://api.openai.com/v1/chat/completions&quot;</span>)</span><br><span class="line">            .header(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Bearer &quot;</span> + apiKey)</span><br><span class="line">            .bodyValue(Map.of(</span><br><span class="line">                <span class="string">&quot;model&quot;</span>, <span class="string">&quot;gpt-4&quot;</span>,</span><br><span class="line">                <span class="string">&quot;messages&quot;</span>, List.of(Map.of(<span class="string">&quot;role&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>, prompt)),</span><br><span class="line">                <span class="string">&quot;stream&quot;</span>, <span class="literal">true</span></span><br><span class="line">            ))</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToFlux(String.class)</span><br><span class="line">            .filter(line -&gt; !line.equals(<span class="string">&quot;[DONE]&quot;</span>))</span><br><span class="line">            .map(<span class="built_in">this</span>::extractContent)</span><br><span class="line">            .filter(Objects::nonNull)</span><br><span class="line">            .doOnNext(chunk -&gt; log.debug(<span class="string">&quot;å‘é€: &#123;&#125;&quot;</span>, chunk))</span><br><span class="line">            .doOnComplete(() -&gt; log.info(<span class="string">&quot;æµå¼å“åº”å®Œæˆ&quot;</span>))</span><br><span class="line">            .doOnError(e -&gt; log.error(<span class="string">&quot;æµå¼å“åº”é”™è¯¯&quot;</span>, e));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">extractContent</span><span class="params">(String line)</span> &#123;</span><br><span class="line">        <span class="comment">// è§£æ SSE æ•°æ®ï¼Œæå–å†…å®¹</span></span><br><span class="line">        <span class="comment">// data: &#123;&quot;choices&quot;:[&#123;&quot;delta&quot;:&#123;&quot;content&quot;:&quot;ä½ å¥½&quot;&#125;&#125;]&#125;</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">JsonNode</span> <span class="variable">node</span> <span class="operator">=</span> objectMapper.readTree(line.substring(<span class="number">6</span>));</span><br><span class="line">            <span class="keyword">return</span> node.at(<span class="string">&quot;/choices/0/delta/content&quot;</span>).asText(<span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‰ç«¯æ¥æ”¶"><a href="#å‰ç«¯æ¥æ”¶" class="headerlink" title="å‰ç«¯æ¥æ”¶"></a>å‰ç«¯æ¥æ”¶</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ EventSource æ¥æ”¶ SSE</span></span><br><span class="line"><span class="keyword">const</span> eventSource = <span class="keyword">new</span> <span class="title class_">EventSource</span>(<span class="string">&#x27;/api/chat?prompt=ä½ å¥½&#x27;</span>);</span><br><span class="line"></span><br><span class="line">eventSource.<span class="property">onmessage</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// é€å­—æ˜¾ç¤º</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;response&#x27;</span>).<span class="property">textContent</span> += event.<span class="property">data</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">eventSource.<span class="property">onerror</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    eventSource.<span class="title function_">close</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…ä½¿ç”¨ fetch</span></span><br><span class="line"><span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/chat?prompt=ä½ å¥½&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> reader = response.<span class="property">body</span>.<span class="title function_">getReader</span>();</span><br><span class="line"><span class="keyword">const</span> decoder = <span class="keyword">new</span> <span class="title class_">TextDecoder</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; done, value &#125; = <span class="keyword">await</span> reader.<span class="title function_">read</span>();</span><br><span class="line">    <span class="keyword">if</span> (done) <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">const</span> chunk = decoder.<span class="title function_">decode</span>(value);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;response&#x27;</span>).<span class="property">textContent</span> += chunk;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Flux æ˜¯ç®¡é“</strong></td>
<td>æ•°æ®æµç»ç®¡é“ï¼Œä¸å­˜å‚¨åœ¨ç®¡é“ä¸­</td>
</tr>
<tr>
<td><strong>æ•°æ®ä½•æ—¶ç¡®å®š</strong></td>
<td>å–å†³äºä¸Šæ¸¸ï¼Œå¯èƒ½åˆ›å»ºæ—¶ç¡®å®šï¼Œä¹Ÿå¯èƒ½è¿è¡Œæ—¶æ‰çŸ¥é“</td>
</tr>
<tr>
<td><strong>æ•°æ®æ•°é‡</strong></td>
<td>ç”±ä¸Šæ¸¸å†³å®šï¼Œä¸‹æ¸¸ä¸éœ€è¦æå‰çŸ¥é“</td>
</tr>
<tr>
<td><strong>æµä½•æ—¶ç»“æŸ</strong></td>
<td>ä¸Šæ¸¸å‘é€ <code>onComplete()</code> æˆ– <code>onError()</code></td>
</tr>
<tr>
<td><strong>æ‡’åŠ è½½</strong></td>
<td>åˆ›å»º Flux ä¸æ‰§è¡Œï¼Œè®¢é˜…æ—¶æ‰æ‰§è¡Œ</td>
</tr>
<tr>
<td><strong>Sinks çš„ä½œç”¨</strong></td>
<td>è®©ä½ æˆä¸ºä¸Šæ¸¸ï¼Œä¸»åŠ¨æ¨é€æ•°æ®</td>
</tr>
</tbody></table>
<p><strong>æ ¸å¿ƒç†è§£</strong>ï¼š</p>
<ul>
<li>Flux ä¸æ˜¯â€è£…äº†å¤šå°‘æ•°æ®â€ï¼Œè€Œæ˜¯â€æ•°æ®ä»å“ªæ¥ã€å¾€å“ªå»â€</li>
<li>ä½ ä¸éœ€è¦çŸ¥é“ Flux é‡Œæœ‰å¤šå°‘æ•°æ®ï¼Œåªéœ€è¦å¤„ç†æµè¿‡æ¥çš„æ¯ä¸€ä¸ªæ•°æ®</li>
<li>è¿™å°±æ˜¯å“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒæ€æƒ³ï¼š<strong>å¯¹æ•°æ®æµåšå‡ºå“åº”</strong></li>
</ul>
<hr>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>Sinks è¯¦è§£</li>
<li>Project Reactor å®ç°</li>
<li>WebFlux - Reactoræ ¸å¿ƒAPI</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/ForkJoinPool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/ForkJoinPool/" class="post-title-link" itemprop="url">ForkJoinPool</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">å¹¶å‘ç¼–ç¨‹</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" itemprop="url" rel="index"><span itemprop="name">çº¿ç¨‹æ± </span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a>ForkJoinPool</h1><blockquote>
<p><strong>â„¹ï¸ ä¿¡æ¯: è¡ç”Ÿæ¥æº</strong><br>æœ¬ç¬”è®°è¡ç”Ÿè‡ª çº¿ç¨‹æ± ç±»å‹-WorkStealingPool</p>
</blockquote>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><code>ForkJoinPool</code> æ˜¯ Java 7 å¼•å…¥çš„ç‰¹æ®Šçº¿ç¨‹æ± ï¼Œä¸“ä¸º<strong>åˆ†æ²»ç®—æ³•</strong>å’Œ<strong>å¹¶è¡Œè®¡ç®—</strong>è®¾è®¡ã€‚å®ƒæ˜¯ <code>ExecutorService</code> çš„å®ç°ï¼Œä½†é‡‡ç”¨äº†å®Œå…¨ä¸åŒçš„ä»»åŠ¡è°ƒåº¦ç­–ç•¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                        ForkJoinPool                            â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  æ ¸å¿ƒæ€æƒ³: Forkï¼ˆæ‹†åˆ†ï¼‰ + Joinï¼ˆåˆå¹¶ï¼‰                          â”‚</span><br><span class="line">â”‚  è°ƒåº¦ç­–ç•¥: Work-Stealingï¼ˆå·¥ä½œçªƒå–ï¼‰                            â”‚</span><br><span class="line">â”‚  é€‚ç”¨åœºæ™¯: é€’å½’ä»»åŠ¡ã€å¹¶è¡Œè®¡ç®—ã€åˆ†æ²»ç®—æ³•                          â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h2><h3 id="Fork-ä¸-Join"><a href="#Fork-ä¸-Join" class="headerlink" title="Fork ä¸ Join"></a>Fork ä¸ Join</h3><table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>è¯´æ˜</th>
<th>æ–¹æ³•</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Fork</strong></td>
<td>å°†å¤§ä»»åŠ¡æ‹†åˆ†æˆå°ä»»åŠ¡ï¼Œå¼‚æ­¥æ‰§è¡Œ</td>
<td><code>task.fork()</code></td>
</tr>
<tr>
<td><strong>Join</strong></td>
<td>ç­‰å¾…å­ä»»åŠ¡å®Œæˆï¼Œè·å–ç»“æœ</td>
<td><code>task.join()</code></td>
</tr>
</tbody></table>
<h3 id="åˆ†æ²»æ€æƒ³å›¾è§£"><a href="#åˆ†æ²»æ€æƒ³å›¾è§£" class="headerlink" title="åˆ†æ²»æ€æƒ³å›¾è§£"></a>åˆ†æ²»æ€æƒ³å›¾è§£</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">            â”‚   å¤§ä»»åŠ¡    â”‚</span><br><span class="line">            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                   â”‚ fork</span><br><span class="line">      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">      â–¼            â–¼            â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ å­ä»»åŠ¡1 â”‚  â”‚ å­ä»»åŠ¡2 â”‚  â”‚ å­ä»»åŠ¡3 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜</span><br><span class="line">     â”‚            â”‚            â”‚</span><br><span class="line">     â–¼            â–¼            â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚ ç»“æœ1   â”‚  â”‚ ç»“æœ2   â”‚  â”‚ ç»“æœ3   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜</span><br><span class="line">     â”‚            â”‚            â”‚</span><br><span class="line">     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                  â”‚ join</span><br><span class="line">            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”</span><br><span class="line">            â”‚  åˆå¹¶ç»“æœ  â”‚</span><br><span class="line">            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å·¥ä½œçªƒå–ç®—æ³•ï¼ˆWork-Stealingï¼‰"><a href="#å·¥ä½œçªƒå–ç®—æ³•ï¼ˆWork-Stealingï¼‰" class="headerlink" title="å·¥ä½œçªƒå–ç®—æ³•ï¼ˆWork-Stealingï¼‰"></a>å·¥ä½œçªƒå–ç®—æ³•ï¼ˆWork-Stealingï¼‰</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æ¯ä¸ªå·¥ä½œçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ª<strong>åŒç«¯é˜Ÿåˆ—ï¼ˆDequeï¼‰</strong>ï¼š</p>
<ul>
<li><strong>è‡ªå·±çš„ä»»åŠ¡</strong>ï¼šä»é˜Ÿåˆ—<strong>å¤´éƒ¨</strong>å–ï¼ˆLIFOï¼‰</li>
<li><strong>çªƒå–ä»–äººä»»åŠ¡</strong>ï¼šä»é˜Ÿåˆ—<strong>å°¾éƒ¨</strong>å–ï¼ˆFIFOï¼‰</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                     ForkJoinPool                                â”‚</span><br><span class="line">â”‚                                                                 â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚</span><br><span class="line">â”‚  â”‚  Worker-1   â”‚    â”‚  Worker-2   â”‚    â”‚  Worker-3   â”‚         â”‚</span><br><span class="line">â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚</span><br><span class="line">â”‚  â”‚ å¤´ [T1]     â”‚    â”‚ å¤´ [T4]     â”‚    â”‚ å¤´ [ç©ºé—²]   â”‚         â”‚</span><br><span class="line">â”‚  â”‚    [T2]     â”‚    â”‚    [T5]     â”‚    â”‚             â”‚         â”‚</span><br><span class="line">â”‚  â”‚    [T3]     â”‚    â”‚             â”‚    â”‚             â”‚         â”‚</span><br><span class="line">â”‚  â”‚ å°¾          â”‚    â”‚ å°¾          â”‚    â”‚ å°¾    â†‘     â”‚         â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜         â”‚</span><br><span class="line">â”‚         â”‚                  â”‚                  â”‚                â”‚</span><br><span class="line">â”‚         â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚</span><br><span class="line">â”‚         â”‚                    Worker-3 ä» Worker-2 å°¾éƒ¨çªƒå– T5   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h3 id="ä¸ºä»€ä¹ˆä»å°¾éƒ¨çªƒå–ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä»å°¾éƒ¨çªƒå–ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä»å°¾éƒ¨çªƒå–ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä»å°¾éƒ¨çªƒå–ï¼Ÿ</h3><table>
<thead>
<tr>
<th>åŸå› </th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å‡å°‘ç«äº‰</strong></td>
<td>å·¥ä½œçº¿ç¨‹ä»å¤´éƒ¨å–ï¼Œçªƒå–ä»å°¾éƒ¨ï¼Œé¿å…é”äº‰ç”¨</td>
</tr>
<tr>
<td><strong>ä»»åŠ¡ç‰¹æ€§</strong></td>
<td>å°¾éƒ¨é€šå¸¸æ˜¯è¾ƒå¤§çš„ä»»åŠ¡ï¼ˆåˆš fork å‡ºæ¥çš„ï¼‰ï¼Œçªƒå–åå¯ç»§ç»­æ‹†åˆ†</td>
</tr>
<tr>
<td><strong>å±€éƒ¨æ€§</strong></td>
<td>å¤´éƒ¨ä»»åŠ¡æ˜¯æœ€è¿‘æäº¤çš„ï¼Œç¼“å­˜å‹å¥½</td>
</tr>
</tbody></table>
<hr>
<h2 id="æ ¸å¿ƒç±»ç»“æ„"><a href="#æ ¸å¿ƒç±»ç»“æ„" class="headerlink" title="æ ¸å¿ƒç±»ç»“æ„"></a>æ ¸å¿ƒç±»ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚          ForkJoinTask&lt;V&gt;              â”‚  æŠ½è±¡åŸºç±»</span><br><span class="line">â”‚  â”œâ”€â”€ fork()    å¼‚æ­¥æ‰§è¡Œ               â”‚</span><br><span class="line">â”‚  â”œâ”€â”€ join()    ç­‰å¾…ç»“æœ               â”‚</span><br><span class="line">â”‚  â””â”€â”€ invoke()  åŒæ­¥æ‰§è¡Œ               â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                â”‚</span><br><span class="line">        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">        â–¼               â–¼</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚RecursiveTask  â”‚ â”‚ RecursiveAction â”‚</span><br><span class="line">â”‚   &lt;V&gt;         â”‚ â”‚                 â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ æœ‰è¿”å›å€¼      â”‚ â”‚ æ— è¿”å›å€¼        â”‚</span><br><span class="line">â”‚ compute()â†’V   â”‚ â”‚ compute()â†’void  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h2><h3 id="1-RecursiveTaskï¼šæœ‰è¿”å›å€¼ï¼ˆæ•°ç»„æ±‚å’Œï¼‰"><a href="#1-RecursiveTaskï¼šæœ‰è¿”å›å€¼ï¼ˆæ•°ç»„æ±‚å’Œï¼‰" class="headerlink" title="1. RecursiveTaskï¼šæœ‰è¿”å›å€¼ï¼ˆæ•°ç»„æ±‚å’Œï¼‰"></a>1. RecursiveTaskï¼šæœ‰è¿”å›å€¼ï¼ˆæ•°ç»„æ±‚å’Œï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SumTask</span> <span class="keyword">extends</span> <span class="title class_">RecursiveTask</span>&lt;Long&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">THRESHOLD</span> <span class="operator">=</span> <span class="number">1000</span>;  <span class="comment">// é˜ˆå€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span>[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> start;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SumTask</span><span class="params">(<span class="type">long</span>[] array, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = array;</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Long <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> end - start;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä»»åŠ¡è¶³å¤Ÿå°ï¼Œç›´æ¥è®¡ç®—</span></span><br><span class="line">        <span class="keyword">if</span> (length &lt;= THRESHOLD) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; end; i++) &#123;</span><br><span class="line">                sum += array[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‹†åˆ†ä»»åŠ¡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> start + length / <span class="number">2</span>;</span><br><span class="line">        <span class="type">SumTask</span> <span class="variable">leftTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(array, start, mid);</span><br><span class="line">        <span class="type">SumTask</span> <span class="variable">rightTask</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(array, mid, end);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¼‚æ­¥æ‰§è¡Œå·¦åŠéƒ¨åˆ†</span></span><br><span class="line">        leftTask.fork();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åŒæ­¥æ‰§è¡Œå³åŠéƒ¨åˆ†ï¼ˆå½“å‰çº¿ç¨‹ï¼‰</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">rightResult</span> <span class="operator">=</span> rightTask.compute();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç­‰å¾…å·¦åŠéƒ¨åˆ†å®Œæˆå¹¶åˆå¹¶ç»“æœ</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">leftResult</span> <span class="operator">=</span> leftTask.join();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> leftResult + rightResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">long</span>[] array = <span class="keyword">new</span> <span class="title class_">long</span>[<span class="number">10000000</span>];</span><br><span class="line">    Arrays.fill(array, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">ForkJoinPool</span> <span class="variable">pool</span> <span class="operator">=</span> ForkJoinPool.commonPool();</span><br><span class="line">    <span class="type">SumTask</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(array, <span class="number">0</span>, array.length);</span><br><span class="line">    </span><br><span class="line">    <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> pool.invoke(task);  <span class="comment">// åŒæ­¥æ‰§è¡Œ</span></span><br><span class="line">    System.out.println(<span class="string">&quot;Sum: &quot;</span> + result);  <span class="comment">// è¾“å‡º: Sum: 10000000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-RecursiveActionï¼šæ— è¿”å›å€¼ï¼ˆå¹¶è¡Œæ’åºï¼‰"><a href="#2-RecursiveActionï¼šæ— è¿”å›å€¼ï¼ˆå¹¶è¡Œæ’åºï¼‰" class="headerlink" title="2. RecursiveActionï¼šæ— è¿”å›å€¼ï¼ˆå¹¶è¡Œæ’åºï¼‰"></a>2. RecursiveActionï¼šæ— è¿”å›å€¼ï¼ˆå¹¶è¡Œæ’åºï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelMergeSort</span> <span class="keyword">extends</span> <span class="title class_">RecursiveAction</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">THRESHOLD</span> <span class="operator">=</span> <span class="number">1024</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span>[] array;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> start;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ParallelMergeSort</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = array;</span><br><span class="line">        <span class="built_in">this</span>.start = start;</span><br><span class="line">        <span class="built_in">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (end - start &lt;= THRESHOLD) &#123;</span><br><span class="line">            <span class="comment">// å°æ•°ç»„ç›´æ¥ç”¨ Arrays.sort</span></span><br><span class="line">            Arrays.sort(array, start, end);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (start + end) / <span class="number">2</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¹¶è¡Œæ’åºä¸¤åŠ</span></span><br><span class="line">        <span class="type">ParallelMergeSort</span> <span class="variable">left</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParallelMergeSort</span>(array, start, mid);</span><br><span class="line">        <span class="type">ParallelMergeSort</span> <span class="variable">right</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParallelMergeSort</span>(array, mid, end);</span><br><span class="line">        </span><br><span class="line">        invokeAll(left, right);  <span class="comment">// å¹¶è¡Œæ‰§è¡Œä¸¤ä¸ªä»»åŠ¡</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå¹¶å·²æ’åºçš„ä¸¤åŠ</span></span><br><span class="line">        merge(array, start, mid, end);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> start, <span class="type">int</span> mid, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆå¹¶é€»è¾‘...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ForkJoinPool-åˆ›å»ºæ–¹å¼"><a href="#ForkJoinPool-åˆ›å»ºæ–¹å¼" class="headerlink" title="ForkJoinPool åˆ›å»ºæ–¹å¼"></a>ForkJoinPool åˆ›å»ºæ–¹å¼</h2><h3 id="1-å…¬å…±æ± ï¼ˆæ¨èï¼‰"><a href="#1-å…¬å…±æ± ï¼ˆæ¨èï¼‰" class="headerlink" title="1. å…¬å…±æ± ï¼ˆæ¨èï¼‰"></a>1. å…¬å…±æ± ï¼ˆæ¨èï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å…¬å…±æ± ï¼ˆJVM å…±äº«ï¼Œçº¿ç¨‹æ•° = CPUæ ¸å¿ƒæ•° - 1ï¼‰</span></span><br><span class="line"><span class="type">ForkJoinPool</span> <span class="variable">commonPool</span> <span class="operator">=</span> ForkJoinPool.commonPool();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> commonPool.invoke(task);</span><br></pre></td></tr></table></figure>

<h3 id="2-è‡ªå®šä¹‰æ± "><a href="#2-è‡ªå®šä¹‰æ± " class="headerlink" title="2. è‡ªå®šä¹‰æ± "></a>2. è‡ªå®šä¹‰æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹æ•°</span></span><br><span class="line"><span class="type">ForkJoinPool</span> <span class="variable">customPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®Œæ•´æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="type">ForkJoinPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>(</span><br><span class="line">    <span class="number">4</span>,                                    <span class="comment">// å¹¶è¡Œåº¦</span></span><br><span class="line">    ForkJoinPool.defaultForkJoinWorkerThreadFactory,  <span class="comment">// çº¿ç¨‹å·¥å‚</span></span><br><span class="line">    <span class="literal">null</span>,                                 <span class="comment">// å¼‚å¸¸å¤„ç†å™¨</span></span><br><span class="line">    <span class="literal">true</span>                                  <span class="comment">// asyncModeï¼ˆtrue=FIFOï¼Œfalse=LIFOï¼‰</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="3-é€šè¿‡-Executors-å·¥å‚"><a href="#3-é€šè¿‡-Executors-å·¥å‚" class="headerlink" title="3. é€šè¿‡ Executors å·¥å‚"></a>3. é€šè¿‡ Executors å·¥å‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 8+ WorkStealingPool åº•å±‚å°±æ˜¯ ForkJoinPool</span></span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newWorkStealingPool();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æäº¤ä»»åŠ¡çš„æ–¹å¼"><a href="#æäº¤ä»»åŠ¡çš„æ–¹å¼" class="headerlink" title="æäº¤ä»»åŠ¡çš„æ–¹å¼"></a>æäº¤ä»»åŠ¡çš„æ–¹å¼</h2><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
<th>è¿”å›å€¼</th>
</tr>
</thead>
<tbody><tr>
<td><code>invoke(task)</code></td>
<td>åŒæ­¥æ‰§è¡Œï¼Œé˜»å¡ç›´åˆ°å®Œæˆ</td>
<td>ä»»åŠ¡ç»“æœ</td>
</tr>
<tr>
<td><code>execute(task)</code></td>
<td>å¼‚æ­¥æ‰§è¡Œï¼Œä¸ç­‰å¾…ç»“æœ</td>
<td>void</td>
</tr>
<tr>
<td><code>submit(task)</code></td>
<td>å¼‚æ­¥æ‰§è¡Œï¼Œè¿”å› Future</td>
<td><code>ForkJoinTask&lt;V&gt;</code></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ForkJoinPool</span> <span class="variable">pool</span> <span class="operator">=</span> ForkJoinPool.commonPool();</span><br><span class="line"><span class="type">SumTask</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SumTask</span>(array, <span class="number">0</span>, array.length);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼1ï¼šåŒæ­¥</span></span><br><span class="line"><span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> pool.invoke(task);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2ï¼šå¼‚æ­¥æäº¤</span></span><br><span class="line">ForkJoinTask&lt;Long&gt; future = pool.submit(task);</span><br><span class="line"><span class="type">Long</span> <span class="variable">result</span> <span class="operator">=</span> future.get();  <span class="comment">// é˜»å¡ç­‰å¾…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼3ï¼šå¼‚æ­¥æ‰§è¡Œï¼ˆä¸å…³å¿ƒç»“æœï¼‰</span></span><br><span class="line">pool.execute(task);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸æ™®é€šçº¿ç¨‹æ± å¯¹æ¯”"><a href="#ä¸æ™®é€šçº¿ç¨‹æ± å¯¹æ¯”" class="headerlink" title="ä¸æ™®é€šçº¿ç¨‹æ± å¯¹æ¯”"></a>ä¸æ™®é€šçº¿ç¨‹æ± å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>ThreadPoolExecutor</th>
<th>ForkJoinPool</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ä»»åŠ¡é˜Ÿåˆ—</strong></td>
<td>å…±äº«é˜Ÿåˆ—ï¼ˆå•ä¸€ï¼‰</td>
<td>æ¯çº¿ç¨‹ç‹¬ç«‹åŒç«¯é˜Ÿåˆ—</td>
</tr>
<tr>
<td><strong>è°ƒåº¦ç­–ç•¥</strong></td>
<td>å…ˆè¿›å…ˆå‡º</td>
<td>å·¥ä½œçªƒå–</td>
</tr>
<tr>
<td><strong>é€‚ç”¨ä»»åŠ¡</strong></td>
<td>ç‹¬ç«‹ä»»åŠ¡</td>
<td>å¯æ‹†åˆ†çš„é€’å½’ä»»åŠ¡</td>
</tr>
<tr>
<td><strong>è´Ÿè½½å‡è¡¡</strong></td>
<td>ä¾èµ–é˜Ÿåˆ—è°ƒåº¦</td>
<td>å·¥ä½œçªƒå–è‡ªåŠ¨å‡è¡¡</td>
</tr>
<tr>
<td><strong>CPU åˆ©ç”¨</strong></td>
<td>å¯èƒ½æœ‰çº¿ç¨‹ç©ºé—²</td>
<td>æ›´é«˜æ•ˆï¼ˆå‡å°‘ç©ºé—²ï¼‰</td>
</tr>
<tr>
<td><strong>ä»»åŠ¡ç²’åº¦</strong></td>
<td>ä»»æ„</td>
<td>é€‚åˆå¯æ‹†åˆ†ä»»åŠ¡</td>
</tr>
</tbody></table>
<hr>
<h2 id="å®é™…åº”ç”¨åœºæ™¯"><a href="#å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="å®é™…åº”ç”¨åœºæ™¯"></a>å®é™…åº”ç”¨åœºæ™¯</h2><h3 id="1-Java-8-å¹¶è¡Œæµ"><a href="#1-Java-8-å¹¶è¡Œæµ" class="headerlink" title="1. Java 8 å¹¶è¡Œæµ"></a>1. Java 8 å¹¶è¡Œæµ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parallelStream() åº•å±‚ä½¿ç”¨ ForkJoinPool.commonPool()</span></span><br><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> numbers.parallelStream()</span><br><span class="line">                 .mapToInt(Integer::intValue)</span><br><span class="line">                 .sum();</span><br></pre></td></tr></table></figure>

<h3 id="2-CompletableFuture-é»˜è®¤æ‰§è¡Œå™¨"><a href="#2-CompletableFuture-é»˜è®¤æ‰§è¡Œå™¨" class="headerlink" title="2. CompletableFuture é»˜è®¤æ‰§è¡Œå™¨"></a>2. CompletableFuture é»˜è®¤æ‰§è¡Œå™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤ä½¿ç”¨ ForkJoinPool.commonPool()</span></span><br><span class="line">CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-å¤§æ•°æ®å¤„ç†"><a href="#3-å¤§æ•°æ®å¤„ç†" class="headerlink" title="3. å¤§æ•°æ®å¤„ç†"></a>3. å¤§æ•°æ®å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¹¶è¡Œå¤„ç†å¤§é‡æ•°æ®</span></span><br><span class="line">Arrays.parallelSort(largeArray);</span><br><span class="line">Arrays.parallelSetAll(array, i -&gt; i * <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><h3 id="1-é˜ˆå€¼è®¾ç½®"><a href="#1-é˜ˆå€¼è®¾ç½®" class="headerlink" title="1. é˜ˆå€¼è®¾ç½®"></a>1. é˜ˆå€¼è®¾ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é˜ˆå€¼å¤ªå°ï¼šæ‹†åˆ†å¼€é”€ &gt; å¹¶è¡Œæ”¶ç›Š</span></span><br><span class="line"><span class="comment">// é˜ˆå€¼å¤ªå¤§ï¼šæ— æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸</span></span><br><span class="line"><span class="comment">// ç»éªŒå€¼ï¼šæ ¹æ®ä»»åŠ¡å¤æ‚åº¦å’Œæ•°æ®é‡æµ‹è¯•ç¡®å®š</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">THRESHOLD</span> <span class="operator">=</span> <span class="number">1000</span>;  <span class="comment">// éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</span></span><br></pre></td></tr></table></figure>

<h3 id="2-é¿å…é˜»å¡æ“ä½œ"><a href="#2-é¿å…é˜»å¡æ“ä½œ" class="headerlink" title="2. é¿å…é˜»å¡æ“ä½œ"></a>2. é¿å…é˜»å¡æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ é”™è¯¯ï¼šåœ¨ ForkJoinPool ä¸­æ‰§è¡Œé˜»å¡ IO</span></span><br><span class="line"><span class="keyword">protected</span> Long <span class="title function_">compute</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ä¸è¦åœ¨è¿™é‡Œåš IO æ“ä½œï¼</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> httpClient.get(url);  <span class="comment">// é˜»å¡ï¼Œæµªè´¹çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">return</span> process(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ­£ç¡®ï¼šForkJoinPool åªç”¨äº CPU è®¡ç®—</span></span><br><span class="line"><span class="comment">// IO æ“ä½œä½¿ç”¨å…¶ä»–çº¿ç¨‹æ± </span></span><br></pre></td></tr></table></figure>

<h3 id="3-å…¬å…±æ± çš„é£é™©"><a href="#3-å…¬å…±æ± çš„é£é™©" class="headerlink" title="3. å…¬å…±æ± çš„é£é™©"></a>3. å…¬å…±æ± çš„é£é™©</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰€æœ‰å¹¶è¡Œæµå…±äº« commonPool</span></span><br><span class="line"><span class="comment">// å¦‚æœæŸä¸ªä»»åŠ¡é˜»å¡ï¼Œä¼šå½±å“å…¶ä»–ä»»åŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆï¼šä¸ºå…³é”®ä»»åŠ¡åˆ›å»ºç‹¬ç«‹çš„ ForkJoinPool</span></span><br><span class="line"><span class="type">ForkJoinPool</span> <span class="variable">customPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>(<span class="number">8</span>);</span><br><span class="line">customPool.submit(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// ç‹¬ç«‹æ‰§è¡Œï¼Œä¸å½±å“ commonPool</span></span><br><span class="line">    myParallelStream.forEach(...);</span><br><span class="line">&#125;).get();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li><strong>ä¸Šä¸€ç¯‡</strong>ï¼š03-çº¿ç¨‹æ± ç±»å‹</li>
<li><strong>çº¿ç¨‹æ± åŸç†</strong>ï¼š02-çº¿ç¨‹æ± åŸç†</li>
<li><strong>çº¿ç¨‹æ± ç®€ä»‹</strong>ï¼š01-çº¿ç¨‹æ± ç®€ä»‹</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/Java%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/Java%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">Javaå¼•ç”¨ç±»å‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">å¹¶å‘ç¼–ç¨‹</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">åŸºç¡€çŸ¥è¯†</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Java-å¼•ç”¨ç±»å‹"><a href="#Java-å¼•ç”¨ç±»å‹" class="headerlink" title="Java å¼•ç”¨ç±»å‹"></a>Java å¼•ç”¨ç±»å‹</h1><blockquote>
<p><strong>â„¹ï¸ ä¿¡æ¯: è¡ç”Ÿæ¥æº</strong><br>æœ¬ç¬”è®°è¡ç”Ÿè‡ª ThreadLocalåŸç†-å¼±å¼•ç”¨è®¾è®¡</p>
</blockquote>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Java ä» JDK 1.2 å¼€å§‹æä¾›äº†å››ç§å¼•ç”¨ç±»å‹ï¼Œç”¨äºæ›´çµæ´»åœ°æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œåƒåœ¾å›æ”¶è¡Œä¸ºã€‚</p>
<h2 id="å››ç§å¼•ç”¨ç±»å‹"><a href="#å››ç§å¼•ç”¨ç±»å‹" class="headerlink" title="å››ç§å¼•ç”¨ç±»å‹"></a>å››ç§å¼•ç”¨ç±»å‹</h2><table>
<thead>
<tr>
<th>å¼•ç”¨ç±»å‹</th>
<th>ç±»</th>
<th>GC å›æ”¶æ—¶æœº</th>
<th>æ˜¯å¦å¯è·å–å¯¹è±¡</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å¼ºå¼•ç”¨</strong></td>
<td>ç›´æ¥å¼•ç”¨</td>
<td>æ°¸ä¸å›æ”¶ï¼ˆé™¤éä¸å¯è¾¾ï¼‰</td>
<td>æ˜¯</td>
</tr>
<tr>
<td><strong>è½¯å¼•ç”¨</strong></td>
<td><code>SoftReference</code></td>
<td>å†…å­˜ä¸è¶³æ—¶å›æ”¶</td>
<td>æ˜¯ï¼ˆæœªå›æ”¶å‰ï¼‰</td>
</tr>
<tr>
<td><strong>å¼±å¼•ç”¨</strong></td>
<td><code>WeakReference</code></td>
<td>ä¸‹æ¬¡ GC æ—¶å›æ”¶</td>
<td>æ˜¯ï¼ˆæœªå›æ”¶å‰ï¼‰</td>
</tr>
<tr>
<td><strong>è™šå¼•ç”¨</strong></td>
<td><code>PhantomReference</code></td>
<td>éšæ—¶å¯èƒ½å›æ”¶</td>
<td>å¦</td>
</tr>
</tbody></table>
<p>^ref-types</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[å¼•ç”¨å¼ºåº¦] --&gt; B[å¼ºå¼•ç”¨ Strong]</span><br><span class="line">    B --&gt; C[è½¯å¼•ç”¨ Soft]</span><br><span class="line">    C --&gt; D[å¼±å¼•ç”¨ Weak]</span><br><span class="line">    D --&gt; E[è™šå¼•ç”¨ Phantom]</span><br><span class="line">    </span><br><span class="line">    style B fill:#ff6b6b</span><br><span class="line">    style C fill:#feca57</span><br><span class="line">    style D fill:#48dbfb</span><br><span class="line">    style E fill:#c8d6e5</span><br></pre></td></tr></table></figure>

<h2 id="è¯¦ç»†è¯´æ˜"><a href="#è¯¦ç»†è¯´æ˜" class="headerlink" title="è¯¦ç»†è¯´æ˜"></a>è¯¦ç»†è¯´æ˜</h2><h3 id="1-å¼ºå¼•ç”¨ï¼ˆStrong-Referenceï¼‰"><a href="#1-å¼ºå¼•ç”¨ï¼ˆStrong-Referenceï¼‰" class="headerlink" title="1. å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰"></a>1. å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</h3><p>æœ€å¸¸è§çš„å¼•ç”¨ç±»å‹ï¼Œåªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢« GC å›æ”¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();  <span class="comment">// å¼ºå¼•ç”¨</span></span><br><span class="line">obj = <span class="literal">null</span>;                 <span class="comment">// æ–­å¼€å¼•ç”¨åæ‰å¯èƒ½è¢«å›æ”¶</span></span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>é»˜è®¤çš„å¼•ç”¨ç±»å‹</li>
<li>å³ä½¿ OOM ä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨å¯¹è±¡</li>
<li>éœ€è¦æ‰‹åŠ¨ç½® null æ‰èƒ½è®© GC å›æ”¶</li>
</ul>
<h3 id="2-è½¯å¼•ç”¨ï¼ˆSoft-Referenceï¼‰"><a href="#2-è½¯å¼•ç”¨ï¼ˆSoft-Referenceï¼‰" class="headerlink" title="2. è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰"></a>2. è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</h3><p>å†…å­˜å……è¶³æ—¶ä¸ä¼šå›æ”¶ï¼Œå†…å­˜ä¸è¶³æ—¶ä¼šè¢«å›æ”¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SoftReference&lt;<span class="type">byte</span>[]&gt; softRef = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">1024</span>]);</span><br><span class="line"></span><br><span class="line"><span class="type">byte</span>[] data = softRef.get();  <span class="comment">// è·å–å¯¹è±¡ï¼Œå¯èƒ½ä¸º null</span></span><br><span class="line"><span class="keyword">if</span> (data == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// å¯¹è±¡å·²è¢«å›æ”¶ï¼Œéœ€è¦é‡æ–°åˆ›å»º</span></span><br><span class="line">    data = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç¼“å­˜</strong></td>
<td>å›¾ç‰‡ç¼“å­˜ã€ç½‘é¡µç¼“å­˜</td>
</tr>
<tr>
<td><strong>å†…å­˜æ•æ„Ÿæ•°æ®</strong></td>
<td>å¯é‡å»ºçš„å¤§å¯¹è±¡</td>
</tr>
</tbody></table>
<h3 id="3-å¼±å¼•ç”¨ï¼ˆWeak-Referenceï¼‰"><a href="#3-å¼±å¼•ç”¨ï¼ˆWeak-Referenceï¼‰" class="headerlink" title="3. å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰"></a>3. å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</h3><p>åªè¦å‘ç”Ÿ GCï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šè¢«å›æ”¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WeakReference&lt;Object&gt; weakRef = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> weakRef.get();  <span class="comment">// å¯èƒ½è¿”å› null</span></span><br><span class="line"><span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// å¯¹è±¡å·²è¢« GC å›æ”¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¼±å¼•ç”¨è§£å†³çš„é—®é¢˜</strong>ï¼š</p>
<blockquote>
<p><strong>âš ï¸ é‡è¦: æ ¸å¿ƒä»·å€¼</strong><br>å¼±å¼•ç”¨å…è®¸å¯¹è±¡åœ¨æ²¡æœ‰å…¶ä»–å¼ºå¼•ç”¨æ—¶è¢« GC å›æ”¶ï¼Œ<strong>é¿å…å†…å­˜æ³„æ¼</strong>ã€‚</p>
</blockquote>
<p>ä»¥ ThreadLocal ä¸ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocalMap.Entry çš„ key ä½¿ç”¨å¼±å¼•ç”¨</span><br><span class="line"></span><br><span class="line">åœºæ™¯ï¼šThreadLocal å˜é‡ä¸å†ä½¿ç”¨</span><br><span class="line">â”œâ”€â”€ å¦‚æœ key æ˜¯å¼ºå¼•ç”¨ â†’ ThreadLocal å¯¹è±¡æ— æ³•å›æ”¶ â†’ å†…å­˜æ³„æ¼</span><br><span class="line">â””â”€â”€ å¦‚æœ key æ˜¯å¼±å¼•ç”¨ â†’ ThreadLocal å¯¹è±¡å¯è¢« GC å›æ”¶ â†’ é¿å…æ³„æ¼</span><br></pre></td></tr></table></figure>

<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ThreadLocalMap</strong></td>
<td>Entry çš„ key ä½¿ç”¨å¼±å¼•ç”¨</td>
</tr>
<tr>
<td><strong>WeakHashMap</strong></td>
<td>key è¢«å›æ”¶åè‡ªåŠ¨ç§»é™¤ entry</td>
</tr>
<tr>
<td><strong>ç›‘å¬å™¨&#x2F;å›è°ƒ</strong></td>
<td>é¿å…å› æ³¨å†Œç›‘å¬å™¨å¯¼è‡´å¯¹è±¡æ— æ³•å›æ”¶</td>
</tr>
</tbody></table>
<h3 id="4-è™šå¼•ç”¨ï¼ˆPhantom-Referenceï¼‰"><a href="#4-è™šå¼•ç”¨ï¼ˆPhantom-Referenceï¼‰" class="headerlink" title="4. è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰"></a>4. è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</h3><p>æœ€å¼±çš„å¼•ç”¨ï¼Œæ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–å¯¹è±¡ï¼Œä¸»è¦ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«å›æ”¶çš„çŠ¶æ€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ReferenceQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>&lt;&gt;();</span><br><span class="line">PhantomReference&lt;Object&gt; phantomRef = <span class="keyword">new</span> <span class="title class_">PhantomReference</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Object</span>(), queue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get() æ°¸è¿œè¿”å› null</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> phantomRef.get();  <span class="comment">// null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡è¢«å›æ”¶åï¼Œè™šå¼•ç”¨ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—</span></span><br><span class="line">Reference&lt;?&gt; ref = queue.poll();</span><br><span class="line"><span class="keyword">if</span> (ref != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// å¯¹è±¡å·²è¢«å›æ”¶ï¼Œæ‰§è¡Œæ¸…ç†æ“ä½œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>èµ„æºæ¸…ç†</strong></td>
<td>æ›¿ä»£ finalize() è¿›è¡Œèµ„æºé‡Šæ”¾</td>
</tr>
<tr>
<td><strong>å †å¤–å†…å­˜ç®¡ç†</strong></td>
<td>DirectByteBuffer çš„ Cleaner æœºåˆ¶</td>
</tr>
<tr>
<td><strong>å¯¹è±¡å›æ”¶ç›‘æ§</strong></td>
<td>è·Ÿè¸ªå¯¹è±¡ä½•æ—¶è¢« GC å›æ”¶</td>
</tr>
</tbody></table>
<h2 id="å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰"><a href="#å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰" class="headerlink" title="å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰"></a>å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰</h2><p>è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨éƒ½å¯ä»¥å…³è”å¼•ç”¨é˜Ÿåˆ—ï¼Œå½“å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œå¼•ç”¨å¯¹è±¡ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ReferenceQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>&lt;&gt;();</span><br><span class="line">WeakReference&lt;Object&gt; weakRef = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Object</span>(), queue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// GC åæ£€æŸ¥é˜Ÿåˆ—</span></span><br><span class="line">System.gc();</span><br><span class="line">Reference&lt;?&gt; ref = queue.poll();</span><br><span class="line"><span class="keyword">if</span> (ref == weakRef) &#123;</span><br><span class="line">    <span class="comment">// å¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡å·²è¢«å›æ”¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¯¹æ¯”æ€»ç»“"><a href="#å¯¹æ¯”æ€»ç»“" class="headerlink" title="å¯¹æ¯”æ€»ç»“"></a>å¯¹æ¯”æ€»ç»“</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>å¼ºå¼•ç”¨</th>
<th>è½¯å¼•ç”¨</th>
<th>å¼±å¼•ç”¨</th>
<th>è™šå¼•ç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å›æ”¶æ—¶æœº</strong></td>
<td>ä¸å¯è¾¾æ—¶</td>
<td>å†…å­˜ä¸è¶³æ—¶</td>
<td>GC æ—¶</td>
<td>éšæ—¶</td>
</tr>
<tr>
<td><strong>get() è¿”å›</strong></td>
<td>å¯¹è±¡</td>
<td>å¯¹è±¡&#x2F;null</td>
<td>å¯¹è±¡&#x2F;null</td>
<td>null</td>
</tr>
<tr>
<td><strong>å…¸å‹ç”¨é€”</strong></td>
<td>æ™®é€šå¯¹è±¡</td>
<td>ç¼“å­˜</td>
<td>é¿å…å†…å­˜æ³„æ¼</td>
<td>å›æ”¶è·Ÿè¸ª</td>
</tr>
<tr>
<td><strong>æ˜¯å¦éœ€è¦é˜Ÿåˆ—</strong></td>
<td>-</td>
<td>å¯é€‰</td>
<td>å¯é€‰</td>
<td>å¿…é¡»</td>
</tr>
</tbody></table>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>Java&#x2F;å¹¶å‘ç¼–ç¨‹&#x2F;åŸºç¡€çŸ¥è¯†&#x2F;ThreadLocalåŸç† - è¡ç”Ÿæ¥æºï¼Œå¼±å¼•ç”¨çš„å…¸å‹åº”ç”¨</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/Project%20Reactor%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/Project%20Reactor%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">Project Reactorå®ç°</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Reactive-Streams/" itemprop="url" rel="index"><span itemprop="name">Reactive Streams</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Project-Reactor-å®ç°"><a href="#Project-Reactor-å®ç°" class="headerlink" title="Project Reactor å®ç°"></a>Project Reactor å®ç°</h1><h2 id="Project-Reactor-ç®€ä»‹"><a href="#Project-Reactor-ç®€ä»‹" class="headerlink" title="Project Reactor ç®€ä»‹"></a>Project Reactor ç®€ä»‹</h2><p>Project Reactor æ˜¯ <strong>Spring å®˜æ–¹çš„ Reactive Streams å®ç°</strong>ï¼Œæ˜¯ Spring WebFlux çš„åŸºç¡€ã€‚</p>
<h3 id="æ ¸å¿ƒç‰¹ç‚¹"><a href="#æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="æ ¸å¿ƒç‰¹ç‚¹"></a>æ ¸å¿ƒç‰¹ç‚¹</h3><ul>
<li><strong>å®Œå…¨éé˜»å¡</strong>ï¼šåŸºäº JDK 8 å‡½æ•°å¼ API</li>
<li><strong>èƒŒå‹æ”¯æŒ</strong>ï¼šå®Œæ•´å®ç° Reactive Streams è§„èŒƒ</li>
<li><strong>ä¸°å¯Œçš„æ“ä½œç¬¦</strong>ï¼šæä¾› 100+ æ“ä½œç¬¦</li>
<li><strong>ä¸ Spring æ·±åº¦é›†æˆ</strong>ï¼šWebFluxã€Spring Data R2DBC ç­‰</li>
</ul>
<h2 id="Reactor-å¯¹-Reactive-Streams-çš„å®ç°"><a href="#Reactor-å¯¹-Reactive-Streams-çš„å®ç°" class="headerlink" title="Reactor å¯¹ Reactive Streams çš„å®ç°"></a>Reactor å¯¹ Reactive Streams çš„å®ç°</h2><h3 id="Publisher-çš„å®ç°"><a href="#Publisher-çš„å®ç°" class="headerlink" title="Publisher çš„å®ç°"></a>Publisher çš„å®ç°</h3><p>Reactor æä¾›äº†ä¸¤ä¸ª Publisher å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mono - 0æˆ–1ä¸ªå…ƒç´ çš„ Publisher</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Mono</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Publisher</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Flux - 0åˆ°Nä¸ªå…ƒç´ çš„ Publisher  </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Flux</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Publisher</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸ºä»€ä¹ˆåˆ†æˆ-Mono-å’Œ-Fluxï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåˆ†æˆ-Mono-å’Œ-Fluxï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåˆ†æˆ Mono å’Œ Fluxï¼Ÿ"></a>ä¸ºä»€ä¹ˆåˆ†æˆ Mono å’Œ Fluxï¼Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯­ä¹‰æ›´æ¸…æ™°</span></span><br><span class="line">Mono&lt;User&gt; <span class="title function_">findById</span><span class="params">(Long id)</span>;      <span class="comment">// æ˜ç¡®ï¼šæœ€å¤šè¿”å›1ä¸ª</span></span><br><span class="line">Flux&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;              <span class="comment">// æ˜ç¡®ï¼šå¯èƒ½è¿”å›å¤šä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹æ¯”åŸå§‹ Publisher</span></span><br><span class="line">Publisher&lt;User&gt; <span class="title function_">findById</span><span class="params">(Long id)</span>;  <span class="comment">// ä¸æ¸…æ¥šï¼š1ä¸ªè¿˜æ˜¯å¤šä¸ªï¼Ÿ</span></span><br></pre></td></tr></table></figure>

<h3 id="Subscriber-çš„å®ç°"><a href="#Subscriber-çš„å®ç°" class="headerlink" title="Subscriber çš„å®ç°"></a>Subscriber çš„å®ç°</h3><p>Reactor æä¾›äº† <code>BaseSubscriber</code> ä½œä¸ºåŸºç¡€å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .subscribe(<span class="keyword">new</span> <span class="title class_">BaseSubscriber</span>&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnSubscribe</span><span class="params">(Subscription subscription)</span> &#123;</span><br><span class="line">            <span class="comment">// è®¢é˜…æ—¶è¯·æ±‚ç¬¬ä¸€æ‰¹æ•°æ®</span></span><br><span class="line">            request(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnNext</span><span class="params">(Integer value)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ”¶åˆ°: &quot;</span> + value);</span><br><span class="line">            <span class="comment">// æ¯æ”¶åˆ°ä¸€ä¸ªï¼Œå†è¯·æ±‚ä¸€ä¸ªï¼ˆæ§åˆ¶èƒŒå‹ï¼‰</span></span><br><span class="line">            request(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnComplete</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å®Œæˆ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnError</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;é”™è¯¯: &quot;</span> + throwable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="èƒŒå‹ç­–ç•¥å®ç°"><a href="#èƒŒå‹ç­–ç•¥å®ç°" class="headerlink" title="èƒŒå‹ç­–ç•¥å®ç°"></a>èƒŒå‹ç­–ç•¥å®ç°</h2><p>Reactor æä¾›äº†å¤šç§èƒŒå‹ç­–ç•¥ï¼š</p>
<h3 id="1-request-æ§åˆ¶ï¼ˆé»˜è®¤ï¼‰"><a href="#1-request-æ§åˆ¶ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="1. request æ§åˆ¶ï¼ˆé»˜è®¤ï¼‰"></a>1. request æ§åˆ¶ï¼ˆé»˜è®¤ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .subscribe(<span class="keyword">new</span> <span class="title class_">BaseSubscriber</span>&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnSubscribe</span><span class="params">(Subscription s)</span> &#123;</span><br><span class="line">            request(<span class="number">10</span>);  <span class="comment">// åªè¯·æ±‚10ä¸ª</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnNext</span><span class="params">(Integer value)</span> &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†å®Œä¸€ä¸ªå†è¯·æ±‚ä¸€ä¸ª</span></span><br><span class="line">            request(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-onBackpressureBuffer-ç¼“å†²"><a href="#2-onBackpressureBuffer-ç¼“å†²" class="headerlink" title="2. onBackpressureBuffer - ç¼“å†²"></a>2. onBackpressureBuffer - ç¼“å†²</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureBuffer(<span class="number">100</span>)  <span class="comment">// ç¼“å†²100ä¸ª</span></span><br><span class="line">    .subscribe(value -&gt; &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);  <span class="comment">// æ…¢æ¶ˆè´¹</span></span><br><span class="line">        System.out.println(value);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-onBackpressureDrop-ä¸¢å¼ƒ"><a href="#3-onBackpressureDrop-ä¸¢å¼ƒ" class="headerlink" title="3. onBackpressureDrop - ä¸¢å¼ƒ"></a>3. onBackpressureDrop - ä¸¢å¼ƒ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureDrop(dropped -&gt; </span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸¢å¼ƒ: &quot;</span> + dropped))</span><br><span class="line">    .subscribe(value -&gt; &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        System.out.println(value);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="4-onBackpressureLatest-åªä¿ç•™æœ€æ–°"><a href="#4-onBackpressureLatest-åªä¿ç•™æœ€æ–°" class="headerlink" title="4. onBackpressureLatest - åªä¿ç•™æœ€æ–°"></a>4. onBackpressureLatest - åªä¿ç•™æœ€æ–°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureLatest()  <span class="comment">// åªä¿ç•™æœ€æ–°çš„</span></span><br><span class="line">    .subscribe(value -&gt; &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        System.out.println(value);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="5-onBackpressureError-æŠ›å¼‚å¸¸"><a href="#5-onBackpressureError-æŠ›å¼‚å¸¸" class="headerlink" title="5. onBackpressureError - æŠ›å¼‚å¸¸"></a>5. onBackpressureError - æŠ›å¼‚å¸¸</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureError()  <span class="comment">// èƒŒå‹æ—¶æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    .subscribe(value -&gt; &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        System.out.println(value);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Subscription-çš„å®ç°"><a href="#Subscription-çš„å®ç°" class="headerlink" title="Subscription çš„å®ç°"></a>Subscription çš„å®ç°</h2><p>Reactor å†…éƒ¨ä½¿ç”¨å¤šç§ Subscription å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥çœ‹å®é™…çš„ Subscription ç±»å‹</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .subscribe(<span class="keyword">new</span> <span class="title class_">BaseSubscriber</span>&lt;Integer&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">hookOnSubscribe</span><span class="params">(Subscription subscription)</span> &#123;</span><br><span class="line">            System.out.println(subscription.getClass());</span><br><span class="line">            <span class="comment">// è¾“å‡º: reactor.core.publisher.FluxRange$RangeSubscription</span></span><br><span class="line">            request(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="å¸¸è§çš„-Subscription-å®ç°"><a href="#å¸¸è§çš„-Subscription-å®ç°" class="headerlink" title="å¸¸è§çš„ Subscription å®ç°"></a>å¸¸è§çš„ Subscription å®ç°</h3><table>
<thead>
<tr>
<th>ç±»å</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>FluxRange$RangeSubscription</code></td>
<td>range() æ“ä½œçš„è®¢é˜…</td>
</tr>
<tr>
<td><code>FluxMap$MapSubscriber</code></td>
<td>map() æ“ä½œçš„è®¢é˜…</td>
</tr>
<tr>
<td><code>FluxFilter$FilterSubscriber</code></td>
<td>filter() æ“ä½œçš„è®¢é˜…</td>
</tr>
<tr>
<td><code>MonoJust$MonoJustSubscription</code></td>
<td>Mono.just() çš„è®¢é˜…</td>
</tr>
</tbody></table>
<h2 id="Processor-çš„å®ç°ï¼ˆå·²åºŸå¼ƒï¼‰"><a href="#Processor-çš„å®ç°ï¼ˆå·²åºŸå¼ƒï¼‰" class="headerlink" title="Processor çš„å®ç°ï¼ˆå·²åºŸå¼ƒï¼‰"></a>Processor çš„å®ç°ï¼ˆå·²åºŸå¼ƒï¼‰</h2><p>Reactor 3.4 ä¹‹å‰æä¾›äº† Processor å®ç°ï¼Œç°åœ¨æ¨èä½¿ç”¨ <strong>Sinks</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ—§æ–¹å¼ï¼ˆå·²åºŸå¼ƒï¼‰</span></span><br><span class="line"><span class="comment">// DirectProcessor&lt;String&gt; processor = DirectProcessor.create();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°æ–¹å¼ï¼šä½¿ç”¨ Sinks</span></span><br><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½œä¸º Publisher</span></span><br><span class="line">Flux&lt;String&gt; flux = sink.asFlux();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€æ•°æ®</span></span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;World&quot;</span>);</span><br><span class="line">sink.tryEmitComplete();</span><br></pre></td></tr></table></figure>

<h3 id="Sinks-çš„ç±»å‹"><a href="#Sinks-çš„ç±»å‹" class="headerlink" title="Sinks çš„ç±»å‹"></a>Sinks çš„ç±»å‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•æ’­ï¼šåªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…</span></span><br><span class="line">Sinks.Many&lt;String&gt; unicast = Sinks.many().unicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šæ’­ï¼šå¤šä¸ªè®¢é˜…è€…å…±äº«</span></span><br><span class="line">Sinks.Many&lt;String&gt; multicast = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡æ”¾ï¼šæ–°è®¢é˜…è€…å¯ä»¥æ”¶åˆ°å†å²æ•°æ®</span></span><br><span class="line">Sinks.Many&lt;String&gt; replay = Sinks.many().replay().all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å•å€¼</span></span><br><span class="line">Sinks.One&lt;String&gt; one = Sinks.one();</span><br></pre></td></tr></table></figure>

<h2 id="æ“ä½œç¬¦é“¾çš„èƒŒå‹ä¼ é€’"><a href="#æ“ä½œç¬¦é“¾çš„èƒŒå‹ä¼ é€’" class="headerlink" title="æ“ä½œç¬¦é“¾çš„èƒŒå‹ä¼ é€’"></a>æ“ä½œç¬¦é“¾çš„èƒŒå‹ä¼ é€’</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)           <span class="comment">// æº Publisher</span></span><br><span class="line">    .map(i -&gt; i * <span class="number">2</span>)          <span class="comment">// ä¸­é—´æ“ä½œç¬¦</span></span><br><span class="line">    .filter(i -&gt; i % <span class="number">3</span> == <span class="number">0</span>)  <span class="comment">// ä¸­é—´æ“ä½œç¬¦</span></span><br><span class="line">    .take(<span class="number">10</span>)                 <span class="comment">// ä¸­é—´æ“ä½œç¬¦</span></span><br><span class="line">    .subscribe(System.out::println);  <span class="comment">// æœ€ç»ˆ Subscriber</span></span><br></pre></td></tr></table></figure>

<p>èƒŒå‹ä¿¡å·<strong>ä»ä¸‹æ¸¸å‘ä¸Šæ¸¸ä¼ é€’</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Subscriber.request(10)</span><br><span class="line">    â†“</span><br><span class="line">take å‘ä¸Š request(10)</span><br><span class="line">    â†“</span><br><span class="line">filter å‘ä¸Š request(10)  // å¯èƒ½è¯·æ±‚æ›´å¤šï¼Œå› ä¸ºæœ‰è¿‡æ»¤</span><br><span class="line">    â†“</span><br><span class="line">map å‘ä¸Š request(10)</span><br><span class="line">    â†“</span><br><span class="line">range å¼€å§‹ç”Ÿäº§æ•°æ®</span><br></pre></td></tr></table></figure>

<h2 id="è°ƒè¯•èƒŒå‹"><a href="#è°ƒè¯•èƒŒå‹" class="headerlink" title="è°ƒè¯•èƒŒå‹"></a>è°ƒè¯•èƒŒå‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .log()  <span class="comment">// æ‰“å°æ‰€æœ‰ä¿¡å·ï¼ŒåŒ…æ‹¬ request</span></span><br><span class="line">    .map(i -&gt; i * <span class="number">2</span>)</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INFO  - | onSubscribe([Synchronous Fuseable] FluxRange.RangeSubscription)</span><br><span class="line">INFO  - | request(unbounded)</span><br><span class="line">INFO  - | onNext(1)</span><br><span class="line">INFO  - | onNext(2)</span><br><span class="line">...</span><br><span class="line">INFO  - | onComplete()</span><br></pre></td></tr></table></figure>

<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>ä¸Šä¸€ç¯‡ï¼šReactive Streams è§„èŒƒ</li>
<li>ä¸‹ä¸€ç¯‡ï¼šæºç è§£æ</li>
<li>WebFlux - Reactoræ ¸å¿ƒAPI</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/Reactor%20API%E5%8F%82%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/Reactor%20API%E5%8F%82%E8%80%83/" class="post-title-link" itemprop="url">Reactor APIå‚è€ƒ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Reactive-Streams/" itemprop="url" rel="index"><span itemprop="name">Reactive Streams</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Reactor-API-å‚è€ƒ"><a href="#Reactor-API-å‚è€ƒ" class="headerlink" title="Reactor API å‚è€ƒ"></a>Reactor API å‚è€ƒ</h1><p>Project Reactor æä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦ï¼Œæœ¬æ–‡æŒ‰åŠŸèƒ½åˆ†ç±»æ•´ç†ã€‚</p>
<hr>
<h2 id="ä¸€ã€åˆ›å»ºæ“ä½œç¬¦"><a href="#ä¸€ã€åˆ›å»ºæ“ä½œç¬¦" class="headerlink" title="ä¸€ã€åˆ›å»ºæ“ä½œç¬¦"></a>ä¸€ã€åˆ›å»ºæ“ä½œç¬¦</h2><h3 id="Mono-åˆ›å»º"><a href="#Mono-åˆ›å»º" class="headerlink" title="Mono åˆ›å»º"></a>Mono åˆ›å»º</h3><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>Mono.just(T)</code></td>
<td>åˆ›å»ºåŒ…å«å•ä¸ªå€¼çš„ Mono</td>
<td><code>Mono.just(&quot;hello&quot;)</code></td>
</tr>
<tr>
<td><code>Mono.empty()</code></td>
<td>åˆ›å»ºç©ºçš„ Mono</td>
<td><code>Mono.empty()</code></td>
</tr>
<tr>
<td><code>Mono.error(Throwable)</code></td>
<td>åˆ›å»ºé”™è¯¯ Mono</td>
<td><code>Mono.error(new RuntimeException())</code></td>
</tr>
<tr>
<td><code>Mono.never()</code></td>
<td>æ°¸ä¸å‘å‡ºä¿¡å·çš„ Mono</td>
<td><code>Mono.never()</code></td>
</tr>
<tr>
<td><code>Mono.defer(Supplier)</code></td>
<td>å»¶è¿Ÿåˆ›å»ºï¼Œæ¯æ¬¡è®¢é˜…éƒ½æ‰§è¡Œ</td>
<td><code>Mono.defer(() -&gt; Mono.just(getValue()))</code></td>
</tr>
<tr>
<td><code>Mono.fromCallable(Callable)</code></td>
<td>ä» Callable åˆ›å»º</td>
<td><code>Mono.fromCallable(() -&gt; compute())</code></td>
</tr>
<tr>
<td><code>Mono.fromSupplier(Supplier)</code></td>
<td>ä» Supplier åˆ›å»º</td>
<td><code>Mono.fromSupplier(() -&gt; getValue())</code></td>
</tr>
<tr>
<td><code>Mono.fromFuture(CompletableFuture)</code></td>
<td>ä» Future åˆ›å»º</td>
<td><code>Mono.fromFuture(future)</code></td>
</tr>
<tr>
<td><code>Mono.fromRunnable(Runnable)</code></td>
<td>ä» Runnable åˆ›å»ºï¼ˆæ— è¿”å›å€¼ï¼‰</td>
<td><code>Mono.fromRunnable(() -&gt; doSomething())</code></td>
</tr>
<tr>
<td><code>Mono.delay(Duration)</code></td>
<td>å»¶è¿Ÿåå‘å‡º 0L</td>
<td><code>Mono.delay(Duration.ofSeconds(1))</code></td>
</tr>
<tr>
<td><code>Mono.create(Consumer&lt;MonoSink&gt;)</code></td>
<td>ç¼–ç¨‹å¼åˆ›å»º</td>
<td>è§ä¸‹æ–¹ç¤ºä¾‹</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mono.create ç¤ºä¾‹</span></span><br><span class="line">Mono.create(sink -&gt; &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> doAsyncWork();</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">        sink.success(result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        sink.error(<span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;å¤±è´¥&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Flux-åˆ›å»º"><a href="#Flux-åˆ›å»º" class="headerlink" title="Flux åˆ›å»º"></a>Flux åˆ›å»º</h3><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>Flux.just(T...)</code></td>
<td>ä»å¤šä¸ªå€¼åˆ›å»º</td>
<td><code>Flux.just(1, 2, 3)</code></td>
</tr>
<tr>
<td><code>Flux.fromIterable(Iterable)</code></td>
<td>ä»é›†åˆåˆ›å»º</td>
<td><code>Flux.fromIterable(list)</code></td>
</tr>
<tr>
<td><code>Flux.fromArray(T[])</code></td>
<td>ä»æ•°ç»„åˆ›å»º</td>
<td><code>Flux.fromArray(array)</code></td>
</tr>
<tr>
<td><code>Flux.fromStream(Stream)</code></td>
<td>ä» Stream åˆ›å»º</td>
<td><code>Flux.fromStream(stream)</code></td>
</tr>
<tr>
<td><code>Flux.range(int, int)</code></td>
<td>åˆ›å»ºæ•´æ•°åºåˆ—</td>
<td><code>Flux.range(1, 10)</code></td>
</tr>
<tr>
<td><code>Flux.interval(Duration)</code></td>
<td>å®šæ—¶å‘å‡ºé€’å¢æ•°å­—</td>
<td><code>Flux.interval(Duration.ofSeconds(1))</code></td>
</tr>
<tr>
<td><code>Flux.empty()</code></td>
<td>åˆ›å»ºç©º Flux</td>
<td><code>Flux.empty()</code></td>
</tr>
<tr>
<td><code>Flux.error(Throwable)</code></td>
<td>åˆ›å»ºé”™è¯¯ Flux</td>
<td><code>Flux.error(new Exception())</code></td>
</tr>
<tr>
<td><code>Flux.never()</code></td>
<td>æ°¸ä¸å‘å‡ºä¿¡å·</td>
<td><code>Flux.never()</code></td>
</tr>
<tr>
<td><code>Flux.defer(Supplier)</code></td>
<td>å»¶è¿Ÿåˆ›å»º</td>
<td><code>Flux.defer(() -&gt; Flux.just(getData()))</code></td>
</tr>
<tr>
<td><code>Flux.generate(Consumer)</code></td>
<td>åŒæ­¥ç”Ÿæˆï¼ˆä¸€æ¬¡ä¸€ä¸ªï¼‰</td>
<td>è§ä¸‹æ–¹ç¤ºä¾‹</td>
</tr>
<tr>
<td><code>Flux.create(Consumer)</code></td>
<td>å¼‚æ­¥ç”Ÿæˆï¼ˆå¯å¤šä¸ªï¼‰</td>
<td>è§ä¸‹æ–¹ç¤ºä¾‹</td>
</tr>
<tr>
<td><code>Flux.push(Consumer)</code></td>
<td>å•çº¿ç¨‹å¼‚æ­¥ç”Ÿæˆ</td>
<td>ç±»ä¼¼ create</td>
</tr>
<tr>
<td><code>Flux.using(Callable, Function, Consumer)</code></td>
<td>èµ„æºç®¡ç†</td>
<td>è§ä¸‹æ–¹ç¤ºä¾‹</td>
</tr>
<tr>
<td><code>Flux.concat(Publisher...)</code></td>
<td>é¡ºåºè¿æ¥å¤šä¸ªæµ</td>
<td><code>Flux.concat(flux1, flux2)</code></td>
</tr>
<tr>
<td><code>Flux.merge(Publisher...)</code></td>
<td>å¹¶è¡Œåˆå¹¶å¤šä¸ªæµ</td>
<td><code>Flux.merge(flux1, flux2)</code></td>
</tr>
<tr>
<td><code>Flux.zip(Publisher...)</code></td>
<td>ç»„åˆå¤šä¸ªæµ</td>
<td><code>Flux.zip(flux1, flux2)</code></td>
</tr>
<tr>
<td><code>Flux.combineLatest(Publisher...)</code></td>
<td>ç»„åˆæœ€æ–°å€¼</td>
<td>è§ä¸‹æ–¹ç¤ºä¾‹</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Flux.generate ç¤ºä¾‹ - åŒæ­¥ç”Ÿæˆ</span></span><br><span class="line">Flux.generate(</span><br><span class="line">    () -&gt; <span class="number">0</span>,  <span class="comment">// åˆå§‹çŠ¶æ€</span></span><br><span class="line">    (state, sink) -&gt; &#123;</span><br><span class="line">        sink.next(<span class="string">&quot;å€¼: &quot;</span> + state);</span><br><span class="line">        <span class="keyword">if</span> (state == <span class="number">10</span>) sink.complete();</span><br><span class="line">        <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Flux.create ç¤ºä¾‹ - å¼‚æ­¥ç”Ÿæˆ</span></span><br><span class="line">Flux.create(sink -&gt; &#123;</span><br><span class="line">    eventSource.onData(data -&gt; sink.next(data));</span><br><span class="line">    eventSource.onError(e -&gt; sink.error(e));</span><br><span class="line">    eventSource.onComplete(() -&gt; sink.complete());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Flux.using ç¤ºä¾‹ - èµ„æºç®¡ç†</span></span><br><span class="line">Flux.using(</span><br><span class="line">    () -&gt; <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;file.txt&quot;</span>),  <span class="comment">// åˆ›å»ºèµ„æº</span></span><br><span class="line">    inputStream -&gt; Flux.just(readData(inputStream)),  <span class="comment">// ä½¿ç”¨èµ„æº</span></span><br><span class="line">    inputStream -&gt; inputStream.close()  <span class="comment">// å…³é—­èµ„æº</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="äºŒã€è½¬æ¢æ“ä½œç¬¦"><a href="#äºŒã€è½¬æ¢æ“ä½œç¬¦" class="headerlink" title="äºŒã€è½¬æ¢æ“ä½œç¬¦"></a>äºŒã€è½¬æ¢æ“ä½œç¬¦</h2><h3 id="åŸºæœ¬è½¬æ¢"><a href="#åŸºæœ¬è½¬æ¢" class="headerlink" title="åŸºæœ¬è½¬æ¢"></a>åŸºæœ¬è½¬æ¢</h3><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>map(Function)</code></td>
<td>åŒæ­¥è½¬æ¢æ¯ä¸ªå…ƒç´ </td>
<td><code>flux.map(i -&gt; i * 2)</code></td>
</tr>
<tr>
<td><code>flatMap(Function)</code></td>
<td>å¼‚æ­¥è½¬æ¢ï¼Œç»“æœåˆå¹¶ï¼ˆæ— åºï¼‰</td>
<td><code>flux.flatMap(id -&gt; fetchUser(id))</code></td>
</tr>
<tr>
<td><code>flatMapSequential(Function)</code></td>
<td>å¼‚æ­¥è½¬æ¢ï¼Œä¿æŒé¡ºåº</td>
<td><code>flux.flatMapSequential(id -&gt; fetchUser(id))</code></td>
</tr>
<tr>
<td><code>concatMap(Function)</code></td>
<td>å¼‚æ­¥è½¬æ¢ï¼Œé¡ºåºæ‰§è¡Œ</td>
<td><code>flux.concatMap(id -&gt; fetchUser(id))</code></td>
</tr>
<tr>
<td><code>switchMap(Function)</code></td>
<td>åˆ‡æ¢åˆ°æ–°æµï¼Œå–æ¶ˆæ—§æµ</td>
<td><code>flux.switchMap(id -&gt; fetchUser(id))</code></td>
</tr>
<tr>
<td><code>cast(Class)</code></td>
<td>ç±»å‹è½¬æ¢</td>
<td><code>flux.cast(String.class)</code></td>
</tr>
<tr>
<td><code>ofType(Class)</code></td>
<td>è¿‡æ»¤å¹¶è½¬æ¢ç±»å‹</td>
<td><code>flux.ofType(String.class)</code></td>
</tr>
<tr>
<td><code>index()</code></td>
<td>æ·»åŠ ç´¢å¼•</td>
<td><code>flux.index()</code> â†’ <code>Tuple2&lt;Long, T&gt;</code></td>
</tr>
<tr>
<td><code>timestamp()</code></td>
<td>æ·»åŠ æ—¶é—´æˆ³</td>
<td><code>flux.timestamp()</code> â†’ <code>Tuple2&lt;Long, T&gt;</code></td>
</tr>
<tr>
<td><code>elapsed()</code></td>
<td>æ·»åŠ æ—¶é—´é—´éš”</td>
<td><code>flux.elapsed()</code></td>
</tr>
</tbody></table>
<h3 id="flatMap-å˜ä½“å¯¹æ¯”"><a href="#flatMap-å˜ä½“å¯¹æ¯”" class="headerlink" title="flatMap å˜ä½“å¯¹æ¯”"></a>flatMap å˜ä½“å¯¹æ¯”</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flatMap:           å¹¶è¡Œæ‰§è¡Œï¼Œç»“æœæ— åº</span><br><span class="line">flatMapSequential: å¹¶è¡Œæ‰§è¡Œï¼Œç»“æœæœ‰åº</span><br><span class="line">concatMap:         é¡ºåºæ‰§è¡Œï¼Œç»“æœæœ‰åº</span><br><span class="line">switchMap:         åˆ‡æ¢æ–°æµï¼Œå–æ¶ˆæ—§æµ</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// flatMap vs concatMap</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">    .flatMap(i -&gt; Mono.just(i).delayElement(Duration.ofMillis(<span class="number">100</span> - i * <span class="number">30</span>)))</span><br><span class="line">    .subscribe(System.out::println);  <span class="comment">// å¯èƒ½è¾“å‡º: 3, 2, 1</span></span><br><span class="line"></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">    .concatMap(i -&gt; Mono.just(i).delayElement(Duration.ofMillis(<span class="number">100</span>)))</span><br><span class="line">    .subscribe(System.out::println);  <span class="comment">// è¾“å‡º: 1, 2, 3</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸‰ã€è¿‡æ»¤æ“ä½œç¬¦"><a href="#ä¸‰ã€è¿‡æ»¤æ“ä½œç¬¦" class="headerlink" title="ä¸‰ã€è¿‡æ»¤æ“ä½œç¬¦"></a>ä¸‰ã€è¿‡æ»¤æ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>filter(Predicate)</code></td>
<td>è¿‡æ»¤å…ƒç´ </td>
<td><code>flux.filter(i -&gt; i &gt; 5)</code></td>
</tr>
<tr>
<td><code>filterWhen(Function)</code></td>
<td>å¼‚æ­¥è¿‡æ»¤</td>
<td><code>flux.filterWhen(i -&gt; checkAsync(i))</code></td>
</tr>
<tr>
<td><code>distinct()</code></td>
<td>å»é‡</td>
<td><code>flux.distinct()</code></td>
</tr>
<tr>
<td><code>distinctUntilChanged()</code></td>
<td>è¿ç»­å»é‡</td>
<td><code>flux.distinctUntilChanged()</code></td>
</tr>
<tr>
<td><code>take(long)</code></td>
<td>å–å‰ n ä¸ª</td>
<td><code>flux.take(5)</code></td>
</tr>
<tr>
<td><code>takeLast(int)</code></td>
<td>å–æœ€å n ä¸ª</td>
<td><code>flux.takeLast(3)</code></td>
</tr>
<tr>
<td><code>takeUntil(Predicate)</code></td>
<td>å–ç›´åˆ°æ¡ä»¶æ»¡è¶³</td>
<td><code>flux.takeUntil(i -&gt; i &gt; 10)</code></td>
</tr>
<tr>
<td><code>takeWhile(Predicate)</code></td>
<td>å–å½“æ¡ä»¶æ»¡è¶³æ—¶</td>
<td><code>flux.takeWhile(i -&gt; i &lt; 10)</code></td>
</tr>
<tr>
<td><code>skip(long)</code></td>
<td>è·³è¿‡å‰ n ä¸ª</td>
<td><code>flux.skip(5)</code></td>
</tr>
<tr>
<td><code>skipLast(int)</code></td>
<td>è·³è¿‡æœ€å n ä¸ª</td>
<td><code>flux.skipLast(3)</code></td>
</tr>
<tr>
<td><code>skipUntil(Predicate)</code></td>
<td>è·³è¿‡ç›´åˆ°æ¡ä»¶æ»¡è¶³</td>
<td><code>flux.skipUntil(i -&gt; i &gt; 5)</code></td>
</tr>
<tr>
<td><code>skipWhile(Predicate)</code></td>
<td>è·³è¿‡å½“æ¡ä»¶æ»¡è¶³æ—¶</td>
<td><code>flux.skipWhile(i -&gt; i &lt; 5)</code></td>
</tr>
<tr>
<td><code>first()</code></td>
<td>å–ç¬¬ä¸€ä¸ªï¼ˆå·²åºŸå¼ƒï¼‰</td>
<td>ä½¿ç”¨ <code>next()</code></td>
</tr>
<tr>
<td><code>next()</code></td>
<td>å–ç¬¬ä¸€ä¸ªï¼Œè¿”å› Mono</td>
<td><code>flux.next()</code></td>
</tr>
<tr>
<td><code>last()</code></td>
<td>å–æœ€åä¸€ä¸ª</td>
<td><code>flux.last()</code></td>
</tr>
<tr>
<td><code>last(T)</code></td>
<td>å–æœ€åä¸€ä¸ªï¼Œæœ‰é»˜è®¤å€¼</td>
<td><code>flux.last(defaultValue)</code></td>
</tr>
<tr>
<td><code>single()</code></td>
<td>æœŸæœ›åªæœ‰ä¸€ä¸ªå…ƒç´ </td>
<td><code>flux.single()</code></td>
</tr>
<tr>
<td><code>singleOrEmpty()</code></td>
<td>æœŸæœ› 0 æˆ– 1 ä¸ªå…ƒç´ </td>
<td><code>flux.singleOrEmpty()</code></td>
</tr>
<tr>
<td><code>elementAt(int)</code></td>
<td>å–æŒ‡å®šä½ç½®å…ƒç´ </td>
<td><code>flux.elementAt(5)</code></td>
</tr>
<tr>
<td><code>ignoreElements()</code></td>
<td>å¿½ç•¥æ‰€æœ‰å…ƒç´ </td>
<td><code>flux.ignoreElements()</code></td>
</tr>
</tbody></table>
<hr>
<h2 id="å››ã€ç»„åˆæ“ä½œç¬¦"><a href="#å››ã€ç»„åˆæ“ä½œç¬¦" class="headerlink" title="å››ã€ç»„åˆæ“ä½œç¬¦"></a>å››ã€ç»„åˆæ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>concat(Publisher...)</code></td>
<td>é¡ºåºè¿æ¥</td>
<td><code>Flux.concat(flux1, flux2)</code></td>
</tr>
<tr>
<td><code>concatWith(Publisher)</code></td>
<td>ä¸å¦ä¸€ä¸ªæµè¿æ¥</td>
<td><code>flux1.concatWith(flux2)</code></td>
</tr>
<tr>
<td><code>merge(Publisher...)</code></td>
<td>å¹¶è¡Œåˆå¹¶</td>
<td><code>Flux.merge(flux1, flux2)</code></td>
</tr>
<tr>
<td><code>mergeWith(Publisher)</code></td>
<td>ä¸å¦ä¸€ä¸ªæµåˆå¹¶</td>
<td><code>flux1.mergeWith(flux2)</code></td>
</tr>
<tr>
<td><code>mergeSequential(Publisher...)</code></td>
<td>å¹¶è¡Œæ‰§è¡Œï¼Œé¡ºåºè¾“å‡º</td>
<td><code>Flux.mergeSequential(flux1, flux2)</code></td>
</tr>
<tr>
<td><code>zip(Publisher...)</code></td>
<td>ä¸€å¯¹ä¸€ç»„åˆ</td>
<td><code>Flux.zip(flux1, flux2)</code></td>
</tr>
<tr>
<td><code>zipWith(Publisher)</code></td>
<td>ä¸å¦ä¸€ä¸ªæµç»„åˆ</td>
<td><code>flux1.zipWith(flux2)</code></td>
</tr>
<tr>
<td><code>zipWith(Publisher, BiFunction)</code></td>
<td>ç»„åˆå¹¶è½¬æ¢</td>
<td><code>flux1.zipWith(flux2, (a, b) -&gt; a + b)</code></td>
</tr>
<tr>
<td><code>combineLatest(Publisher...)</code></td>
<td>ç»„åˆæœ€æ–°å€¼</td>
<td><code>Flux.combineLatest(flux1, flux2, combiner)</code></td>
</tr>
<tr>
<td><code>startWith(T...)</code></td>
<td>åœ¨å¼€å¤´æ·»åŠ å…ƒç´ </td>
<td><code>flux.startWith(0)</code></td>
</tr>
<tr>
<td><code>and(Publisher)</code></td>
<td>ç­‰å¾…ä¸¤ä¸ªéƒ½å®Œæˆ</td>
<td><code>mono1.and(mono2)</code></td>
</tr>
<tr>
<td><code>when(Publisher...)</code></td>
<td>ç­‰å¾…æ‰€æœ‰å®Œæˆ</td>
<td><code>Mono.when(mono1, mono2)</code></td>
</tr>
<tr>
<td><code>then()</code></td>
<td>å¿½ç•¥å…ƒç´ ï¼Œåªå…³å¿ƒå®Œæˆ</td>
<td><code>flux.then()</code></td>
</tr>
<tr>
<td><code>thenMany(Publisher)</code></td>
<td>å®Œæˆååˆ‡æ¢åˆ°å¦ä¸€ä¸ªæµ</td>
<td><code>mono.thenMany(flux)</code></td>
</tr>
<tr>
<td><code>thenReturn(T)</code></td>
<td>å®Œæˆåè¿”å›å›ºå®šå€¼</td>
<td><code>mono.thenReturn(&quot;done&quot;)</code></td>
</tr>
</tbody></table>
<h3 id="ç»„åˆæ“ä½œç¬¦å¯¹æ¯”"><a href="#ç»„åˆæ“ä½œç¬¦å¯¹æ¯”" class="headerlink" title="ç»„åˆæ“ä½œç¬¦å¯¹æ¯”"></a>ç»„åˆæ“ä½œç¬¦å¯¹æ¯”</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">concat:  Aå®Œæˆ â†’ Bå¼€å§‹ï¼Œé¡ºåºæ‰§è¡Œ</span><br><span class="line">merge:   Aå’ŒBåŒæ—¶æ‰§è¡Œï¼Œè°å¿«è°å…ˆè¾“å‡º</span><br><span class="line">zip:     Aå’ŒBä¸€å¯¹ä¸€é…å¯¹ï¼Œ(a1,b1), (a2,b2)...</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// zip ç¤ºä¾‹</span></span><br><span class="line">Flux&lt;String&gt; names = Flux.just(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;æå››&quot;</span>);</span><br><span class="line">Flux&lt;Integer&gt; ages = Flux.just(<span class="number">25</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">Flux.zip(names, ages, (name, age) -&gt; name + <span class="string">&quot;: &quot;</span> + age)</span><br><span class="line">    .subscribe(System.out::println);</span><br><span class="line"><span class="comment">// è¾“å‡º: å¼ ä¸‰: 25, æå››: 30</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="äº”ã€é”™è¯¯å¤„ç†æ“ä½œç¬¦"><a href="#äº”ã€é”™è¯¯å¤„ç†æ“ä½œç¬¦" class="headerlink" title="äº”ã€é”™è¯¯å¤„ç†æ“ä½œç¬¦"></a>äº”ã€é”™è¯¯å¤„ç†æ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>onErrorReturn(T)</code></td>
<td>é”™è¯¯æ—¶è¿”å›é»˜è®¤å€¼</td>
<td><code>flux.onErrorReturn(defaultValue)</code></td>
</tr>
<tr>
<td><code>onErrorReturn(Predicate, T)</code></td>
<td>ç‰¹å®šé”™è¯¯è¿”å›é»˜è®¤å€¼</td>
<td><code>flux.onErrorReturn(e -&gt; e instanceof IOException, default)</code></td>
</tr>
<tr>
<td><code>onErrorResume(Function)</code></td>
<td>é”™è¯¯æ—¶åˆ‡æ¢åˆ°å¤‡ç”¨æµ</td>
<td><code>flux.onErrorResume(e -&gt; backupFlux)</code></td>
</tr>
<tr>
<td><code>onErrorMap(Function)</code></td>
<td>è½¬æ¢é”™è¯¯ç±»å‹</td>
<td><code>flux.onErrorMap(e -&gt; new CustomException(e))</code></td>
</tr>
<tr>
<td><code>onErrorContinue(BiConsumer)</code></td>
<td>é”™è¯¯æ—¶è·³è¿‡ç»§ç»­</td>
<td><code>flux.onErrorContinue((e, v) -&gt; log.error(e))</code></td>
</tr>
<tr>
<td><code>onErrorStop()</code></td>
<td>é”™è¯¯æ—¶åœæ­¢</td>
<td><code>flux.onErrorStop()</code></td>
</tr>
<tr>
<td><code>doOnError(Consumer)</code></td>
<td>é”™è¯¯æ—¶æ‰§è¡Œå‰¯ä½œç”¨</td>
<td><code>flux.doOnError(e -&gt; log.error(e))</code></td>
</tr>
<tr>
<td><code>retry()</code></td>
<td>æ— é™é‡è¯•</td>
<td><code>flux.retry()</code></td>
</tr>
<tr>
<td><code>retry(long)</code></td>
<td>é‡è¯• n æ¬¡</td>
<td><code>flux.retry(3)</code></td>
</tr>
<tr>
<td><code>retryWhen(Retry)</code></td>
<td>è‡ªå®šä¹‰é‡è¯•ç­–ç•¥</td>
<td>è§ä¸‹æ–¹ç¤ºä¾‹</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// retryWhen ç¤ºä¾‹</span></span><br><span class="line">flux.retryWhen(Retry.backoff(<span class="number">3</span>, Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .maxBackoff(Duration.ofSeconds(<span class="number">10</span>))</span><br><span class="line">    .filter(e -&gt; e <span class="keyword">instanceof</span> IOException)</span><br><span class="line">    .onRetryExhaustedThrow((spec, signal) -&gt; signal.failure())</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡æ•°é€€é¿é‡è¯•</span></span><br><span class="line">flux.retryWhen(Retry.backoff(<span class="number">5</span>, Duration.ofMillis(<span class="number">100</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›ºå®šé—´éš”é‡è¯•</span></span><br><span class="line">flux.retryWhen(Retry.fixedDelay(<span class="number">3</span>, Duration.ofSeconds(<span class="number">1</span>)));</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å…­ã€å‰¯ä½œç”¨æ“ä½œç¬¦ï¼ˆdoOn-ç³»åˆ—ï¼‰"><a href="#å…­ã€å‰¯ä½œç”¨æ“ä½œç¬¦ï¼ˆdoOn-ç³»åˆ—ï¼‰" class="headerlink" title="å…­ã€å‰¯ä½œç”¨æ“ä½œç¬¦ï¼ˆdoOn ç³»åˆ—ï¼‰"></a>å…­ã€å‰¯ä½œç”¨æ“ä½œç¬¦ï¼ˆdoOn ç³»åˆ—ï¼‰</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>è§¦å‘æ—¶æœº</th>
</tr>
</thead>
<tbody><tr>
<td><code>doOnNext(Consumer)</code></td>
<td>æ¯ä¸ªå…ƒç´ </td>
<td>onNext ä¿¡å·</td>
</tr>
<tr>
<td><code>doOnError(Consumer)</code></td>
<td>å‘ç”Ÿé”™è¯¯</td>
<td>onError ä¿¡å·</td>
</tr>
<tr>
<td><code>doOnComplete(Runnable)</code></td>
<td>å®Œæˆæ—¶</td>
<td>onComplete ä¿¡å·</td>
</tr>
<tr>
<td><code>doOnSubscribe(Consumer)</code></td>
<td>è®¢é˜…æ—¶</td>
<td>onSubscribe ä¿¡å·</td>
</tr>
<tr>
<td><code>doOnRequest(LongConsumer)</code></td>
<td>è¯·æ±‚æ•°æ®æ—¶</td>
<td>request ä¿¡å·</td>
</tr>
<tr>
<td><code>doOnCancel(Runnable)</code></td>
<td>å–æ¶ˆæ—¶</td>
<td>cancel ä¿¡å·</td>
</tr>
<tr>
<td><code>doOnTerminate(Runnable)</code></td>
<td>ç»ˆæ­¢æ—¶ï¼ˆå®Œæˆæˆ–é”™è¯¯ï¼‰</td>
<td>onComplete æˆ– onError</td>
</tr>
<tr>
<td><code>doAfterTerminate(Runnable)</code></td>
<td>ç»ˆæ­¢å</td>
<td>ç»ˆæ­¢ä¿¡å·å‘é€å</td>
</tr>
<tr>
<td><code>doOnEach(Consumer&lt;Signal&gt;)</code></td>
<td>æ¯ä¸ªä¿¡å·</td>
<td>æ‰€æœ‰ä¿¡å·</td>
</tr>
<tr>
<td><code>doFirst(Runnable)</code></td>
<td>è®¢é˜…å‰</td>
<td>è®¢é˜…é“¾å»ºç«‹å‰</td>
</tr>
<tr>
<td><code>doFinally(Consumer&lt;SignalType&gt;)</code></td>
<td>æœ€ç»ˆæ‰§è¡Œ</td>
<td>ä»»ä½•ç»ˆæ­¢æƒ…å†µ</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç›‘æ§</span></span><br><span class="line">flux</span><br><span class="line">    .doFirst(() -&gt; log.info(<span class="string">&quot;å¼€å§‹&quot;</span>))</span><br><span class="line">    .doOnSubscribe(s -&gt; log.info(<span class="string">&quot;è®¢é˜…&quot;</span>))</span><br><span class="line">    .doOnRequest(n -&gt; log.info(<span class="string">&quot;è¯·æ±‚: &quot;</span> + n))</span><br><span class="line">    .doOnNext(v -&gt; log.info(<span class="string">&quot;æ”¶åˆ°: &quot;</span> + v))</span><br><span class="line">    .doOnError(e -&gt; log.error(<span class="string">&quot;é”™è¯¯&quot;</span>, e))</span><br><span class="line">    .doOnComplete(() -&gt; log.info(<span class="string">&quot;å®Œæˆ&quot;</span>))</span><br><span class="line">    .doOnCancel(() -&gt; log.info(<span class="string">&quot;å–æ¶ˆ&quot;</span>))</span><br><span class="line">    .doOnTerminate(() -&gt; log.info(<span class="string">&quot;ç»ˆæ­¢&quot;</span>))</span><br><span class="line">    .doAfterTerminate(() -&gt; log.info(<span class="string">&quot;ç»ˆæ­¢å&quot;</span>))</span><br><span class="line">    .doFinally(type -&gt; log.info(<span class="string">&quot;æœ€ç»ˆ: &quot;</span> + type))</span><br><span class="line">    .subscribe();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸ƒã€è°ƒåº¦å™¨æ“ä½œç¬¦"><a href="#ä¸ƒã€è°ƒåº¦å™¨æ“ä½œç¬¦" class="headerlink" title="ä¸ƒã€è°ƒåº¦å™¨æ“ä½œç¬¦"></a>ä¸ƒã€è°ƒåº¦å™¨æ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>subscribeOn(Scheduler)</code></td>
<td>æŒ‡å®šè®¢é˜…çº¿ç¨‹</td>
<td><code>flux.subscribeOn(Schedulers.boundedElastic())</code></td>
</tr>
<tr>
<td><code>publishOn(Scheduler)</code></td>
<td>æŒ‡å®šå‘å¸ƒçº¿ç¨‹</td>
<td><code>flux.publishOn(Schedulers.parallel())</code></td>
</tr>
</tbody></table>
<h3 id="è°ƒåº¦å™¨ç±»å‹"><a href="#è°ƒåº¦å™¨ç±»å‹" class="headerlink" title="è°ƒåº¦å™¨ç±»å‹"></a>è°ƒåº¦å™¨ç±»å‹</h3><table>
<thead>
<tr>
<th>Scheduler</th>
<th>è¯´æ˜</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><code>Schedulers.immediate()</code></td>
<td>å½“å‰çº¿ç¨‹</td>
<td>æµ‹è¯•ã€ç®€å•åœºæ™¯</td>
</tr>
<tr>
<td><code>Schedulers.single()</code></td>
<td>å•çº¿ç¨‹</td>
<td>é¡ºåºæ‰§è¡Œ</td>
</tr>
<tr>
<td><code>Schedulers.parallel()</code></td>
<td>å¹¶è¡Œçº¿ç¨‹æ± ï¼ˆCPUæ ¸å¿ƒæ•°ï¼‰</td>
<td>CPU å¯†é›†å‹</td>
</tr>
<tr>
<td><code>Schedulers.boundedElastic()</code></td>
<td>å¼¹æ€§çº¿ç¨‹æ± ï¼ˆæœ‰ä¸Šé™ï¼‰</td>
<td>I&#x2F;O å¯†é›†å‹ã€é˜»å¡æ“ä½œ</td>
</tr>
<tr>
<td><code>Schedulers.fromExecutor(Executor)</code></td>
<td>è‡ªå®šä¹‰çº¿ç¨‹æ± </td>
<td>ç‰¹æ®Šéœ€æ±‚</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// subscribeOn vs publishOn</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">    .doOnNext(i -&gt; log.info(<span class="string">&quot;ç”Ÿæˆ: &quot;</span> + i))  <span class="comment">// boundedElastic çº¿ç¨‹</span></span><br><span class="line">    .subscribeOn(Schedulers.boundedElastic())</span><br><span class="line">    .publishOn(Schedulers.parallel())</span><br><span class="line">    .doOnNext(i -&gt; log.info(<span class="string">&quot;å¤„ç†: &quot;</span> + i))  <span class="comment">// parallel çº¿ç¨‹</span></span><br><span class="line">    .subscribe();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å…«ã€ç¼“å†²ä¸çª—å£æ“ä½œç¬¦"><a href="#å…«ã€ç¼“å†²ä¸çª—å£æ“ä½œç¬¦" class="headerlink" title="å…«ã€ç¼“å†²ä¸çª—å£æ“ä½œç¬¦"></a>å…«ã€ç¼“å†²ä¸çª—å£æ“ä½œç¬¦</h2><h3 id="ç¼“å†²ï¼ˆæ”¶é›†ä¸º-Listï¼‰"><a href="#ç¼“å†²ï¼ˆæ”¶é›†ä¸º-Listï¼‰" class="headerlink" title="ç¼“å†²ï¼ˆæ”¶é›†ä¸º Listï¼‰"></a>ç¼“å†²ï¼ˆæ”¶é›†ä¸º Listï¼‰</h3><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>buffer()</code></td>
<td>æ”¶é›†æ‰€æœ‰å…ƒç´ </td>
<td><code>flux.buffer()</code> â†’ <code>Flux&lt;List&lt;T&gt;&gt;</code></td>
</tr>
<tr>
<td><code>buffer(int)</code></td>
<td>æŒ‰æ•°é‡ç¼“å†²</td>
<td><code>flux.buffer(10)</code></td>
</tr>
<tr>
<td><code>buffer(Duration)</code></td>
<td>æŒ‰æ—¶é—´ç¼“å†²</td>
<td><code>flux.buffer(Duration.ofSeconds(1))</code></td>
</tr>
<tr>
<td><code>buffer(int, int)</code></td>
<td>æ»‘åŠ¨çª—å£ç¼“å†²</td>
<td><code>flux.buffer(3, 1)</code></td>
</tr>
<tr>
<td><code>bufferUntil(Predicate)</code></td>
<td>ç¼“å†²ç›´åˆ°æ¡ä»¶æ»¡è¶³</td>
<td><code>flux.bufferUntil(i -&gt; i % 10 == 0)</code></td>
</tr>
<tr>
<td><code>bufferWhile(Predicate)</code></td>
<td>ç¼“å†²å½“æ¡ä»¶æ»¡è¶³æ—¶</td>
<td><code>flux.bufferWhile(i -&gt; i &lt; 10)</code></td>
</tr>
<tr>
<td><code>bufferTimeout(int, Duration)</code></td>
<td>æ•°é‡æˆ–æ—¶é—´è§¦å‘</td>
<td><code>flux.bufferTimeout(100, Duration.ofSeconds(1))</code></td>
</tr>
</tbody></table>
<h3 id="çª—å£ï¼ˆæ”¶é›†ä¸º-Fluxï¼‰"><a href="#çª—å£ï¼ˆæ”¶é›†ä¸º-Fluxï¼‰" class="headerlink" title="çª—å£ï¼ˆæ”¶é›†ä¸º Fluxï¼‰"></a>çª—å£ï¼ˆæ”¶é›†ä¸º Fluxï¼‰</h3><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>window(int)</code></td>
<td>æŒ‰æ•°é‡åˆ†çª—å£</td>
<td><code>flux.window(10)</code> â†’ <code>Flux&lt;Flux&lt;T&gt;&gt;</code></td>
</tr>
<tr>
<td><code>window(Duration)</code></td>
<td>æŒ‰æ—¶é—´åˆ†çª—å£</td>
<td><code>flux.window(Duration.ofSeconds(1))</code></td>
</tr>
<tr>
<td><code>windowUntil(Predicate)</code></td>
<td>åˆ†çª—å£ç›´åˆ°æ¡ä»¶æ»¡è¶³</td>
<td><code>flux.windowUntil(i -&gt; i % 10 == 0)</code></td>
</tr>
</tbody></table>
<h3 id="åˆ†ç»„"><a href="#åˆ†ç»„" class="headerlink" title="åˆ†ç»„"></a>åˆ†ç»„</h3><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>groupBy(Function)</code></td>
<td>æŒ‰ key åˆ†ç»„</td>
<td><code>flux.groupBy(User::getType)</code></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// groupBy ç¤ºä¾‹</span></span><br><span class="line">flux.groupBy(user -&gt; user.getType())</span><br><span class="line">    .flatMap(group -&gt; group</span><br><span class="line">        .collectList()</span><br><span class="line">        .map(list -&gt; group.key() + <span class="string">&quot;: &quot;</span> + list.size())</span><br><span class="line">    )</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¹ã€èšåˆæ“ä½œç¬¦"><a href="#ä¹ã€èšåˆæ“ä½œç¬¦" class="headerlink" title="ä¹ã€èšåˆæ“ä½œç¬¦"></a>ä¹ã€èšåˆæ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>è¿”å›ç±»å‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>count()</code></td>
<td>è®¡æ•°</td>
<td><code>Mono&lt;Long&gt;</code></td>
</tr>
<tr>
<td><code>reduce(BiFunction)</code></td>
<td>å½’çº¦</td>
<td><code>Mono&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>reduce(T, BiFunction)</code></td>
<td>å¸¦åˆå§‹å€¼å½’çº¦</td>
<td><code>Mono&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>reduceWith(Supplier, BiFunction)</code></td>
<td>å»¶è¿Ÿåˆå§‹å€¼å½’çº¦</td>
<td><code>Mono&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>scan(BiFunction)</code></td>
<td>ç´¯ç§¯ï¼ˆå‘å‡ºä¸­é—´ç»“æœï¼‰</td>
<td><code>Flux&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>scan(T, BiFunction)</code></td>
<td>å¸¦åˆå§‹å€¼ç´¯ç§¯</td>
<td><code>Flux&lt;T&gt;</code></td>
</tr>
<tr>
<td><code>collect(Collector)</code></td>
<td>æ”¶é›†åˆ°é›†åˆ</td>
<td><code>Mono&lt;R&gt;</code></td>
</tr>
<tr>
<td><code>collectList()</code></td>
<td>æ”¶é›†ä¸º List</td>
<td><code>Mono&lt;List&lt;T&gt;&gt;</code></td>
</tr>
<tr>
<td><code>collectMap(Function)</code></td>
<td>æ”¶é›†ä¸º Map</td>
<td><code>Mono&lt;Map&lt;K, T&gt;&gt;</code></td>
</tr>
<tr>
<td><code>collectMap(Function, Function)</code></td>
<td>æ”¶é›†ä¸º Mapï¼ˆæŒ‡å®š valueï¼‰</td>
<td><code>Mono&lt;Map&lt;K, V&gt;&gt;</code></td>
</tr>
<tr>
<td><code>collectMultimap(Function)</code></td>
<td>æ”¶é›†ä¸º Multimap</td>
<td><code>Mono&lt;Map&lt;K, Collection&lt;T&gt;&gt;&gt;</code></td>
</tr>
<tr>
<td><code>collectSortedList()</code></td>
<td>æ”¶é›†ä¸ºæ’åº List</td>
<td><code>Mono&lt;List&lt;T&gt;&gt;</code></td>
</tr>
<tr>
<td><code>all(Predicate)</code></td>
<td>æ˜¯å¦å…¨éƒ¨æ»¡è¶³</td>
<td><code>Mono&lt;Boolean&gt;</code></td>
</tr>
<tr>
<td><code>any(Predicate)</code></td>
<td>æ˜¯å¦æœ‰æ»¡è¶³çš„</td>
<td><code>Mono&lt;Boolean&gt;</code></td>
</tr>
<tr>
<td><code>hasElements()</code></td>
<td>æ˜¯å¦æœ‰å…ƒç´ </td>
<td><code>Mono&lt;Boolean&gt;</code></td>
</tr>
<tr>
<td><code>hasElement(T)</code></td>
<td>æ˜¯å¦åŒ…å«å…ƒç´ </td>
<td><code>Mono&lt;Boolean&gt;</code></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reduce ç¤ºä¾‹</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .reduce((a, b) -&gt; a + b)</span><br><span class="line">    .subscribe(System.out::println);  <span class="comment">// 15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// scan ç¤ºä¾‹ï¼ˆå‘å‡ºä¸­é—´ç»“æœï¼‰</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .scan((a, b) -&gt; a + b)</span><br><span class="line">    .subscribe(System.out::println);  <span class="comment">// 1, 3, 6, 10, 15</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="åã€æ—¶é—´æ“ä½œç¬¦"><a href="#åã€æ—¶é—´æ“ä½œç¬¦" class="headerlink" title="åã€æ—¶é—´æ“ä½œç¬¦"></a>åã€æ—¶é—´æ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>delayElements(Duration)</code></td>
<td>å»¶è¿Ÿæ¯ä¸ªå…ƒç´ </td>
<td><code>flux.delayElements(Duration.ofMillis(100))</code></td>
</tr>
<tr>
<td><code>delaySequence(Duration)</code></td>
<td>å»¶è¿Ÿæ•´ä¸ªåºåˆ—</td>
<td><code>flux.delaySequence(Duration.ofSeconds(1))</code></td>
</tr>
<tr>
<td><code>delaySubscription(Duration)</code></td>
<td>å»¶è¿Ÿè®¢é˜…</td>
<td><code>flux.delaySubscription(Duration.ofSeconds(1))</code></td>
</tr>
<tr>
<td><code>timeout(Duration)</code></td>
<td>è¶…æ—¶</td>
<td><code>flux.timeout(Duration.ofSeconds(5))</code></td>
</tr>
<tr>
<td><code>timeout(Duration, Publisher)</code></td>
<td>è¶…æ—¶ååˆ‡æ¢</td>
<td><code>flux.timeout(Duration.ofSeconds(5), backupFlux)</code></td>
</tr>
<tr>
<td><code>sample(Duration)</code></td>
<td>é‡‡æ ·</td>
<td><code>flux.sample(Duration.ofSeconds(1))</code></td>
</tr>
<tr>
<td><code>sampleFirst(Duration)</code></td>
<td>é‡‡æ ·ç¬¬ä¸€ä¸ª</td>
<td><code>flux.sampleFirst(Duration.ofSeconds(1))</code></td>
</tr>
<tr>
<td><code>throttleFirst(Duration)</code></td>
<td>èŠ‚æµï¼ˆå–ç¬¬ä¸€ä¸ªï¼‰</td>
<td><code>flux.throttleFirst(Duration.ofSeconds(1))</code></td>
</tr>
<tr>
<td><code>throttleLast(Duration)</code></td>
<td>èŠ‚æµï¼ˆå–æœ€åä¸€ä¸ªï¼‰</td>
<td><code>flux.throttleLast(Duration.ofSeconds(1))</code></td>
</tr>
<tr>
<td><code>elapsed()</code></td>
<td>æ·»åŠ æ—¶é—´é—´éš”</td>
<td><code>flux.elapsed()</code></td>
</tr>
<tr>
<td><code>timed()</code></td>
<td>æ·»åŠ æ—¶é—´ä¿¡æ¯</td>
<td><code>flux.timed()</code></td>
</tr>
</tbody></table>
<hr>
<h2 id="åä¸€ã€èƒŒå‹æ“ä½œç¬¦"><a href="#åä¸€ã€èƒŒå‹æ“ä½œç¬¦" class="headerlink" title="åä¸€ã€èƒŒå‹æ“ä½œç¬¦"></a>åä¸€ã€èƒŒå‹æ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>onBackpressureBuffer()</code></td>
<td>æ— é™ç¼“å†²</td>
<td><code>flux.onBackpressureBuffer()</code></td>
</tr>
<tr>
<td><code>onBackpressureBuffer(int)</code></td>
<td>æœ‰é™ç¼“å†²</td>
<td><code>flux.onBackpressureBuffer(100)</code></td>
</tr>
<tr>
<td><code>onBackpressureBuffer(int, Consumer)</code></td>
<td>ç¼“å†²æ»¡æ—¶å›è°ƒ</td>
<td><code>flux.onBackpressureBuffer(100, v -&gt; log.warn(&quot;æº¢å‡º&quot;))</code></td>
</tr>
<tr>
<td><code>onBackpressureDrop()</code></td>
<td>ä¸¢å¼ƒ</td>
<td><code>flux.onBackpressureDrop()</code></td>
</tr>
<tr>
<td><code>onBackpressureDrop(Consumer)</code></td>
<td>ä¸¢å¼ƒå¹¶å›è°ƒ</td>
<td><code>flux.onBackpressureDrop(v -&gt; log.warn(&quot;ä¸¢å¼ƒ: &quot; + v))</code></td>
</tr>
<tr>
<td><code>onBackpressureLatest()</code></td>
<td>åªä¿ç•™æœ€æ–°</td>
<td><code>flux.onBackpressureLatest()</code></td>
</tr>
<tr>
<td><code>onBackpressureError()</code></td>
<td>æŠ›å‡ºå¼‚å¸¸</td>
<td><code>flux.onBackpressureError()</code></td>
</tr>
<tr>
<td><code>limitRate(int)</code></td>
<td>é™åˆ¶è¯·æ±‚é€Ÿç‡</td>
<td><code>flux.limitRate(100)</code></td>
</tr>
<tr>
<td><code>limitRequest(long)</code></td>
<td>é™åˆ¶æ€»è¯·æ±‚æ•°</td>
<td><code>flux.limitRequest(1000)</code></td>
</tr>
</tbody></table>
<hr>
<h2 id="åäºŒã€æ¡ä»¶æ“ä½œç¬¦"><a href="#åäºŒã€æ¡ä»¶æ“ä½œç¬¦" class="headerlink" title="åäºŒã€æ¡ä»¶æ“ä½œç¬¦"></a>åäºŒã€æ¡ä»¶æ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>defaultIfEmpty(T)</code></td>
<td>ç©ºæ—¶è¿”å›é»˜è®¤å€¼</td>
<td><code>flux.defaultIfEmpty(defaultValue)</code></td>
</tr>
<tr>
<td><code>switchIfEmpty(Publisher)</code></td>
<td>ç©ºæ—¶åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæµ</td>
<td><code>flux.switchIfEmpty(backupFlux)</code></td>
</tr>
<tr>
<td><code>repeatWhen(Function)</code></td>
<td>æ¡ä»¶é‡å¤</td>
<td><code>flux.repeatWhen(companion -&gt; companion.take(3))</code></td>
</tr>
<tr>
<td><code>repeat()</code></td>
<td>æ— é™é‡å¤</td>
<td><code>flux.repeat()</code></td>
</tr>
<tr>
<td><code>repeat(long)</code></td>
<td>é‡å¤ n æ¬¡</td>
<td><code>flux.repeat(3)</code></td>
</tr>
</tbody></table>
<hr>
<h2 id="åä¸‰ã€è°ƒè¯•æ“ä½œç¬¦"><a href="#åä¸‰ã€è°ƒè¯•æ“ä½œç¬¦" class="headerlink" title="åä¸‰ã€è°ƒè¯•æ“ä½œç¬¦"></a>åä¸‰ã€è°ƒè¯•æ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>log()</code></td>
<td>æ‰“å°æ‰€æœ‰ä¿¡å·</td>
<td><code>flux.log()</code></td>
</tr>
<tr>
<td><code>log(String)</code></td>
<td>å¸¦å‰ç¼€æ‰“å°</td>
<td><code>flux.log(&quot;MyFlux&quot;)</code></td>
</tr>
<tr>
<td><code>log(String, Level)</code></td>
<td>æŒ‡å®šæ—¥å¿—çº§åˆ«</td>
<td><code>flux.log(&quot;MyFlux&quot;, Level.FINE)</code></td>
</tr>
<tr>
<td><code>checkpoint()</code></td>
<td>æ·»åŠ æ£€æŸ¥ç‚¹ï¼ˆè°ƒè¯•ç”¨ï¼‰</td>
<td><code>flux.checkpoint(&quot;after filter&quot;)</code></td>
</tr>
<tr>
<td><code>checkpoint(String)</code></td>
<td>å¸¦æè¿°çš„æ£€æŸ¥ç‚¹</td>
<td><code>flux.checkpoint(&quot;å¤„ç†å&quot;)</code></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è°ƒè¯•ç¤ºä¾‹</span></span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">    .log(<span class="string">&quot;æºæ•°æ®&quot;</span>)</span><br><span class="line">    .filter(i -&gt; i &gt; <span class="number">2</span>)</span><br><span class="line">    .log(<span class="string">&quot;è¿‡æ»¤å&quot;</span>)</span><br><span class="line">    .map(i -&gt; i * <span class="number">2</span>)</span><br><span class="line">    .log(<span class="string">&quot;è½¬æ¢å&quot;</span>)</span><br><span class="line">    .subscribe();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="åå››ã€ä¸Šä¸‹æ–‡æ“ä½œç¬¦"><a href="#åå››ã€ä¸Šä¸‹æ–‡æ“ä½œç¬¦" class="headerlink" title="åå››ã€ä¸Šä¸‹æ–‡æ“ä½œç¬¦"></a>åå››ã€ä¸Šä¸‹æ–‡æ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>contextWrite(Context)</code></td>
<td>å†™å…¥ä¸Šä¸‹æ–‡</td>
<td><code>flux.contextWrite(Context.of(&quot;key&quot;, &quot;value&quot;))</code></td>
</tr>
<tr>
<td><code>contextWrite(Function)</code></td>
<td>ä¿®æ”¹ä¸Šä¸‹æ–‡</td>
<td><code>flux.contextWrite(ctx -&gt; ctx.put(&quot;key&quot;, &quot;value&quot;))</code></td>
</tr>
<tr>
<td><code>deferContextual(Function)</code></td>
<td>è¯»å–ä¸Šä¸‹æ–‡åˆ›å»ºæµ</td>
<td>è§ä¸‹æ–¹ç¤ºä¾‹</td>
</tr>
<tr>
<td><code>transformDeferredContextual(BiFunction)</code></td>
<td>è½¬æ¢æ—¶è¯»å–ä¸Šä¸‹æ–‡</td>
<td>è§ä¸‹æ–¹ç¤ºä¾‹</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Context ç¤ºä¾‹ - ä¼ é€’è¯·æ±‚ ID</span></span><br><span class="line">Mono.deferContextual(ctx -&gt; &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">requestId</span> <span class="operator">=</span> ctx.get(<span class="string">&quot;requestId&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> callService(requestId);</span><br><span class="line">&#125;)</span><br><span class="line">.contextWrite(Context.of(<span class="string">&quot;requestId&quot;</span>, UUID.randomUUID().toString()))</span><br><span class="line">.subscribe();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="åäº”ã€Mono-ç‰¹æœ‰æ“ä½œç¬¦"><a href="#åäº”ã€Mono-ç‰¹æœ‰æ“ä½œç¬¦" class="headerlink" title="åäº”ã€Mono ç‰¹æœ‰æ“ä½œç¬¦"></a>åäº”ã€Mono ç‰¹æœ‰æ“ä½œç¬¦</h2><table>
<thead>
<tr>
<th>API</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>block()</code></td>
<td>é˜»å¡è·å–ç»“æœ</td>
<td><code>mono.block()</code></td>
</tr>
<tr>
<td><code>block(Duration)</code></td>
<td>å¸¦è¶…æ—¶é˜»å¡</td>
<td><code>mono.block(Duration.ofSeconds(5))</code></td>
</tr>
<tr>
<td><code>toFuture()</code></td>
<td>è½¬ä¸º CompletableFuture</td>
<td><code>mono.toFuture()</code></td>
</tr>
<tr>
<td><code>cache()</code></td>
<td>ç¼“å­˜ç»“æœ</td>
<td><code>mono.cache()</code></td>
</tr>
<tr>
<td><code>cache(Duration)</code></td>
<td>å¸¦è¿‡æœŸæ—¶é—´ç¼“å­˜</td>
<td><code>mono.cache(Duration.ofMinutes(5))</code></td>
</tr>
<tr>
<td><code>flux()</code></td>
<td>è½¬ä¸º Flux</td>
<td><code>mono.flux()</code></td>
</tr>
<tr>
<td><code>zipWhen(Function)</code></td>
<td>ä¸ä¾èµ–ç»“æœç»„åˆ</td>
<td><code>mono.zipWhen(v -&gt; fetchRelated(v))</code></td>
</tr>
<tr>
<td><code>delayUntil(Function)</code></td>
<td>å»¶è¿Ÿç›´åˆ°å¦ä¸€ä¸ªå®Œæˆ</td>
<td><code>mono.delayUntil(v -&gt; saveAsync(v))</code></td>
</tr>
</tbody></table>
<hr>
<h2 id="åå…­ã€Sinksï¼ˆæ‰‹åŠ¨å‘é€æ•°æ®ï¼‰"><a href="#åå…­ã€Sinksï¼ˆæ‰‹åŠ¨å‘é€æ•°æ®ï¼‰" class="headerlink" title="åå…­ã€Sinksï¼ˆæ‰‹åŠ¨å‘é€æ•°æ®ï¼‰"></a>åå…­ã€Sinksï¼ˆæ‰‹åŠ¨å‘é€æ•°æ®ï¼‰</h2><h3 id="Sinks-Manyï¼ˆå¤šå€¼ï¼‰"><a href="#Sinks-Manyï¼ˆå¤šå€¼ï¼‰" class="headerlink" title="Sinks.Manyï¼ˆå¤šå€¼ï¼‰"></a>Sinks.Manyï¼ˆå¤šå€¼ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å•æ’­ - åªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…</span></span><br><span class="line">Sinks.Many&lt;String&gt; unicast = Sinks.many().unicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šæ’­ - å¤šä¸ªè®¢é˜…è€…</span></span><br><span class="line">Sinks.Many&lt;String&gt; multicast = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡æ”¾ - æ–°è®¢é˜…è€…å¯æ”¶åˆ°å†å²æ•°æ®</span></span><br><span class="line">Sinks.Many&lt;String&gt; replay = Sinks.many().replay().all();</span><br><span class="line">Sinks.Many&lt;String&gt; replayLimit = Sinks.many().replay().limit(<span class="number">10</span>);</span><br><span class="line">Sinks.Many&lt;String&gt; replayLatest = Sinks.many().replay().latest();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€æ•°æ®</span></span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;data&quot;</span>);</span><br><span class="line">sink.emitNext(<span class="string">&quot;data&quot;</span>, Sinks.EmitFailureHandler.FAIL_FAST);</span><br><span class="line">sink.tryEmitComplete();</span><br><span class="line">sink.tryEmitError(<span class="keyword">new</span> <span class="title class_">Exception</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½œä¸º Flux ä½¿ç”¨</span></span><br><span class="line">Flux&lt;String&gt; flux = sink.asFlux();</span><br></pre></td></tr></table></figure>

<h3 id="Sinks-Oneï¼ˆå•å€¼ï¼‰"><a href="#Sinks-Oneï¼ˆå•å€¼ï¼‰" class="headerlink" title="Sinks.Oneï¼ˆå•å€¼ï¼‰"></a>Sinks.Oneï¼ˆå•å€¼ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Sinks.One&lt;String&gt; one = Sinks.one();</span><br><span class="line">one.tryEmitValue(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">Mono&lt;String&gt; mono = one.asMono();</span><br></pre></td></tr></table></figure>

<h3 id="Sinks-Emptyï¼ˆæ— å€¼ï¼‰"><a href="#Sinks-Emptyï¼ˆæ— å€¼ï¼‰" class="headerlink" title="Sinks.Emptyï¼ˆæ— å€¼ï¼‰"></a>Sinks.Emptyï¼ˆæ— å€¼ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Sinks.Empty&lt;Void&gt; empty = Sinks.empty();</span><br><span class="line">empty.tryEmitEmpty();</span><br><span class="line">Mono&lt;Void&gt; mono = empty.asMono();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>Project Reactor å®ç°</li>
<li>æºç è§£æ</li>
<li>WebFlux - Reactoræ ¸å¿ƒAPI</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/Reactive%20Streams%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/Reactive%20Streams%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">Reactive Streamsè§„èŒƒ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Reactive-Streams/" itemprop="url" rel="index"><span itemprop="name">Reactive Streams</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Reactive-Streams-è§„èŒƒ"><a href="#Reactive-Streams-è§„èŒƒ" class="headerlink" title="Reactive Streams è§„èŒƒ"></a>Reactive Streams è§„èŒƒ</h1><h2 id="ä»€ä¹ˆæ˜¯-Reactive-Streams"><a href="#ä»€ä¹ˆæ˜¯-Reactive-Streams" class="headerlink" title="ä»€ä¹ˆæ˜¯ Reactive Streams"></a>ä»€ä¹ˆæ˜¯ Reactive Streams</h2><p>Reactive Streams æ˜¯ JVM ä¸Š<strong>å“åº”å¼ç¼–ç¨‹çš„æ ‡å‡†è§„èŒƒ</strong>ï¼Œå®šä¹‰äº†å¼‚æ­¥æµå¤„ç†çš„æ¥å£å’Œåè®®ã€‚</p>
<ul>
<li><strong>å‘èµ·è€…</strong>ï¼šNetflixã€Pivotalã€Lightbendã€Twitter ç­‰å…¬å¸è”åˆåˆ¶å®š</li>
<li><strong>ç›®æ ‡</strong>ï¼šè§£å†³å¼‚æ­¥æ•°æ®æµå¤„ç†ä¸­çš„èƒŒå‹é—®é¢˜</li>
<li><strong>Java 9</strong>ï¼šå·²çº³å…¥ JDKï¼Œä½äº <code>java.util.concurrent.Flow</code></li>
</ul>
<h2 id="å››ä¸ªæ ¸å¿ƒæ¥å£"><a href="#å››ä¸ªæ ¸å¿ƒæ¥å£" class="headerlink" title="å››ä¸ªæ ¸å¿ƒæ¥å£"></a>å››ä¸ªæ ¸å¿ƒæ¥å£</h2><p>Reactive Streams åªå®šä¹‰äº† 4 ä¸ªæ¥å£ï¼Œéå¸¸ç®€æ´ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. å‘å¸ƒè€… - æ•°æ®çš„ç”Ÿäº§è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Publisher</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(Subscriber&lt;? <span class="built_in">super</span> T&gt; s)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è®¢é˜…è€… - æ•°æ®çš„æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subscriber</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onSubscribe</span><span class="params">(Subscription s)</span>;  <span class="comment">// è®¢é˜…æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onNext</span><span class="params">(T t)</span>;                   <span class="comment">// æ¥æ”¶æ•°æ®</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Throwable t)</span>;          <span class="comment">// å‘ç”Ÿé”™è¯¯</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onComplete</span><span class="params">()</span>;                  <span class="comment">// æ•°æ®æµç»“æŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. è®¢é˜…å…³ç³» - è¿æ¥å‘å¸ƒè€…å’Œè®¢é˜…è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subscription</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">request</span><span class="params">(<span class="type">long</span> n)</span>;  <span class="comment">// è¯·æ±‚ n ä¸ªæ•°æ®ï¼ˆèƒŒå‹æ ¸å¿ƒï¼‰</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">()</span>;         <span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. å¤„ç†å™¨ - æ—¢æ˜¯è®¢é˜…è€…åˆæ˜¯å‘å¸ƒè€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Processor</span>&lt;T, R&gt; <span class="keyword">extends</span> <span class="title class_">Subscriber</span>&lt;T&gt;, Publisher&lt;R&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äº¤äº’æµç¨‹"><a href="#äº¤äº’æµç¨‹" class="headerlink" title="äº¤äº’æµç¨‹"></a>äº¤äº’æµç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   Publisher  â”‚                      â”‚  Subscriber  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚  1. subscribe(subscriber)           â”‚</span><br><span class="line">       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚  2. onSubscribe(subscription)       â”‚</span><br><span class="line">       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚  3. request(n) è¯·æ±‚nä¸ªæ•°æ®          â”‚</span><br><span class="line">       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚  4. onNext(data) å‘é€æ•°æ®ï¼ˆæœ€å¤šnä¸ªï¼‰â”‚</span><br><span class="line">       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="line">       â”‚         ... é‡å¤ 3-4 ...            â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚  5. onComplete() æˆ– onError()       â”‚</span><br><span class="line">       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="line">       â–¼                                     â–¼</span><br></pre></td></tr></table></figure>

<h2 id="èƒŒå‹ï¼ˆBackpressureï¼‰"><a href="#èƒŒå‹ï¼ˆBackpressureï¼‰" class="headerlink" title="èƒŒå‹ï¼ˆBackpressureï¼‰"></a>èƒŒå‹ï¼ˆBackpressureï¼‰</h2><p>èƒŒå‹æ˜¯ Reactive Streams çš„<strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼Œè§£å†³ç”Ÿäº§è€…é€Ÿåº¦å¿«äºæ¶ˆè´¹è€…çš„é—®é¢˜ã€‚</p>
<h3 id="æ²¡æœ‰èƒŒå‹çš„é—®é¢˜"><a href="#æ²¡æœ‰èƒŒå‹çš„é—®é¢˜" class="headerlink" title="æ²¡æœ‰èƒŒå‹çš„é—®é¢˜"></a>æ²¡æœ‰èƒŒå‹çš„é—®é¢˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç”Ÿäº§è€…ï¼š1000æ¡/ç§’  â”€â”€â”€â”€â”€â”€â–¶  æ¶ˆè´¹è€…ï¼š100æ¡/ç§’</span><br><span class="line">                              â†“</span><br><span class="line">                         å†…å­˜æº¢å‡ºï¼</span><br></pre></td></tr></table></figure>

<h3 id="æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ"><a href="#æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ"></a>æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆè´¹è€…æ§åˆ¶é€Ÿåº¦</span></span><br><span class="line">subscription.request(<span class="number">10</span>);  <span class="comment">// æˆ‘åªè¦10æ¡</span></span><br><span class="line"><span class="comment">// ç”Ÿäº§è€…æœ€å¤šå‘10æ¡ï¼Œç„¶åç­‰å¾…ä¸‹ä¸€æ¬¡ request</span></span><br></pre></td></tr></table></figure>

<h3 id="èƒŒå‹åè®®è§„åˆ™"><a href="#èƒŒå‹åè®®è§„åˆ™" class="headerlink" title="èƒŒå‹åè®®è§„åˆ™"></a>èƒŒå‹åè®®è§„åˆ™</h3><ol>
<li><strong>Subscriber ä¸»åŠ¨è¯·æ±‚</strong>ï¼šé€šè¿‡ <code>request(n)</code> å‘Šè¯‰ Publisher éœ€è¦å¤šå°‘æ•°æ®</li>
<li><strong>Publisher éµå®ˆçº¦å®š</strong>ï¼šæœ€å¤šå‘é€ n ä¸ªæ•°æ®ï¼Œä¸èƒ½è¶…å‘</li>
<li><strong>ç´¯ç§¯è¯·æ±‚</strong>ï¼šå¤šæ¬¡ <code>request()</code> çš„æ•°é‡ä¼šç´¯åŠ </li>
<li><strong>æ— é™è¯·æ±‚</strong>ï¼š<code>request(Long.MAX_VALUE)</code> è¡¨ç¤ºä¸é™åˆ¶</li>
</ol>
<h2 id="è§„èŒƒçš„å®ç°"><a href="#è§„èŒƒçš„å®ç°" class="headerlink" title="è§„èŒƒçš„å®ç°"></a>è§„èŒƒçš„å®ç°</h2><table>
<thead>
<tr>
<th>å®ç°</th>
<th>è¯´æ˜</th>
<th>ä½¿ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Project Reactor</strong></td>
<td>Spring é»˜è®¤å®ç°</td>
<td>Spring WebFlux</td>
</tr>
<tr>
<td><strong>RxJava</strong></td>
<td>Netflix å¼€æº</td>
<td>Androidã€é€šç”¨</td>
</tr>
<tr>
<td><strong>Akka Streams</strong></td>
<td>Lightbend å¼€æº</td>
<td>Scala ç”Ÿæ€</td>
</tr>
<tr>
<td><strong>Java 9 Flow</strong></td>
<td>JDK å†…ç½®</td>
<td>æ ‡å‡†åº“</td>
</tr>
</tbody></table>
<p>Spring ç”Ÿæ€ä½¿ç”¨çš„æ˜¯ <strong>Project Reactor</strong>ï¼Œä¸‹ä¸€ç¯‡è¯¦ç»†ä»‹ç»ã€‚</p>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>ä¸‹ä¸€ç¯‡ï¼šProject Reactor å®ç°</li>
<li>WebFlux - å“åº”å¼ç¼–ç¨‹åŸºç¡€</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/Sinks%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/Sinks%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">Sinksè¯¦è§£</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Reactive-Streams/" itemprop="url" rel="index"><span itemprop="name">Reactive Streams</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Sinks-è¯¦è§£"><a href="#Sinks-è¯¦è§£" class="headerlink" title="Sinks è¯¦è§£"></a>Sinks è¯¦è§£</h1><h2 id="ä»€ä¹ˆæ˜¯-Sinks"><a href="#ä»€ä¹ˆæ˜¯-Sinks" class="headerlink" title="ä»€ä¹ˆæ˜¯ Sinks"></a>ä»€ä¹ˆæ˜¯ Sinks</h2><p><strong>Sinks æ˜¯ Reactor æä¾›çš„â€æ‰‹åŠ¨å‘é€æ•°æ®â€çš„å·¥å…·</strong>ï¼Œè®©ä½ å¯ä»¥åœ¨ä»£ç ä¸­ä¸»åŠ¨ push æ•°æ®åˆ°å“åº”å¼æµä¸­ã€‚</p>
<h3 id="æ ¸å¿ƒé—®é¢˜ï¼šMono-Flux-çš„å±€é™"><a href="#æ ¸å¿ƒé—®é¢˜ï¼šMono-Flux-çš„å±€é™" class="headerlink" title="æ ¸å¿ƒé—®é¢˜ï¼šMono&#x2F;Flux çš„å±€é™"></a>æ ¸å¿ƒé—®é¢˜ï¼šMono&#x2F;Flux çš„å±€é™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mono/Flux é€šå¸¸æ˜¯&quot;è¢«åŠ¨&quot;çš„ - æ•°æ®åœ¨åˆ›å»ºæ—¶å°±ç¡®å®šäº†</span></span><br><span class="line">Mono.just(<span class="string">&quot;hello&quot;</span>);           <span class="comment">// æ•°æ®å·²ç¡®å®š</span></span><br><span class="line">Flux.fromIterable(list);      <span class="comment">// æ•°æ®å·²ç¡®å®š</span></span><br><span class="line">Flux.interval(Duration.ofSeconds(<span class="number">1</span>));  <span class="comment">// æ•°æ®æŒ‰è§„åˆ™ç”Ÿæˆ</span></span><br></pre></td></tr></table></figure>

<p><strong>ä½†æœ‰äº›åœºæ™¯éœ€è¦â€ä¸»åŠ¨â€å‘é€æ•°æ®</strong>ï¼š</p>
<ul>
<li>æ¥æ”¶å¤–éƒ¨äº‹ä»¶ï¼ˆWebSocketã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰</li>
<li>ç”¨æˆ·äº¤äº’è§¦å‘</li>
<li>å¼‚æ­¥å›è°ƒç»“æœ</li>
<li>å¤šä¸ªåœ°æ–¹äº§ç”Ÿæ•°æ®ï¼Œæ±‡èšåˆ°ä¸€ä¸ªæµ</li>
</ul>
<h3 id="Sinks-çš„ä½œç”¨"><a href="#Sinks-çš„ä½œç”¨" class="headerlink" title="Sinks çš„ä½œç”¨"></a>Sinks çš„ä½œç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sinks è®©ä½ å¯ä»¥&quot;ä¸»åŠ¨&quot;å‘é€æ•°æ®</span></span><br><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ä»»ä½•åœ°æ–¹ã€ä»»ä½•æ—¶å€™å‘é€æ•°æ®</span></span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯1&quot;</span>);</span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜…è€…å¯ä»¥æ”¶åˆ°è¿™äº›æ•°æ®</span></span><br><span class="line">sink.asFlux().subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Sinks-ä¸-Mono-Flux-çš„å…³ç³»"><a href="#Sinks-ä¸-Mono-Flux-çš„å…³ç³»" class="headerlink" title="Sinks ä¸ Mono&#x2F;Flux çš„å…³ç³»"></a>Sinks ä¸ Mono&#x2F;Flux çš„å…³ç³»</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                        æ•°æ®ç”Ÿäº§æ–¹å¼                          â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">â”‚   Mono/Flux (è¢«åŠ¨)              Sinks (ä¸»åŠ¨)                â”‚</span><br><span class="line">â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚</span><br><span class="line">â”‚   æ•°æ®åœ¨åˆ›å»ºæ—¶ç¡®å®š              æ•°æ®å¯ä»¥éšæ—¶å‘é€              â”‚</span><br><span class="line">â”‚   just(), fromIterable()       tryEmitNext()               â”‚</span><br><span class="line">â”‚   interval(), range()          tryEmitComplete()           â”‚</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">â”‚                    â†“ è½¬æ¢ â†“                                 â”‚</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">â”‚              sink.asFlux() â†’ Flux&lt;T&gt;                        â”‚</span><br><span class="line">â”‚              sink.asMono() â†’ Mono&lt;T&gt;                        â”‚</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">â”‚   æœ€ç»ˆéƒ½æ˜¯ Flux/Monoï¼Œè®¢é˜…è€…æ— æ„ŸçŸ¥å·®å¼‚                        â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<p>æœ¬è´¨ï¼šSinks æ˜¯ Flux&#x2F;Mono çš„æ•°æ®æºï¼Œå®ƒç”Ÿäº§æ•°æ®ï¼ŒFlux&#x2F;Mono ä¼ é€’æ•°æ®ã€‚</p>
<hr>
<h2 id="Sinks-çš„ä¸‰ç§ç±»å‹"><a href="#Sinks-çš„ä¸‰ç§ç±»å‹" class="headerlink" title="Sinks çš„ä¸‰ç§ç±»å‹"></a>Sinks çš„ä¸‰ç§ç±»å‹</h2><h3 id="1-Sinks-One-å•å€¼ï¼ˆå¯¹åº”-Monoï¼‰"><a href="#1-Sinks-One-å•å€¼ï¼ˆå¯¹åº”-Monoï¼‰" class="headerlink" title="1. Sinks.One - å•å€¼ï¼ˆå¯¹åº” Monoï¼‰"></a>1. Sinks.One - å•å€¼ï¼ˆå¯¹åº” Monoï¼‰</h3><p>åªèƒ½å‘é€ 0 æˆ– 1 ä¸ªå€¼ï¼Œç„¶åå®Œæˆã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Sinks.One&lt;String&gt; sink = Sinks.one();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€ä¸€ä¸ªå€¼</span></span><br><span class="line">sink.tryEmitValue(<span class="string">&quot;ç»“æœ&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬ä¸º Mono</span></span><br><span class="line">Mono&lt;String&gt; mono = sink.asMono();</span><br><span class="line">mono.subscribe(System.out::println);  <span class="comment">// è¾“å‡º: ç»“æœ</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åœºæ™¯ï¼šå¼‚æ­¥æ“ä½œçš„å•ä¸ªç»“æœ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹ï¼šå°è£…å¼‚æ­¥å›è°ƒ</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">fetchUserAsync</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    Sinks.One&lt;User&gt; sink = Sinks.one();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªå›è°ƒå¼çš„ API</span></span><br><span class="line">    asyncClient.getUser(id, <span class="keyword">new</span> <span class="title class_">Callback</span>&lt;User&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(User user)</span> &#123;</span><br><span class="line">            sink.tryEmitValue(user);  <span class="comment">// æˆåŠŸæ—¶å‘é€å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">            sink.tryEmitError(e);     <span class="comment">// å¤±è´¥æ—¶å‘é€é”™è¯¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> sink.asMono();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Sinks-Empty-æ— å€¼ï¼ˆå¯¹åº”-Monoï¼‰"><a href="#2-Sinks-Empty-æ— å€¼ï¼ˆå¯¹åº”-Monoï¼‰" class="headerlink" title="2. Sinks.Empty - æ— å€¼ï¼ˆå¯¹åº” Monoï¼‰"></a>2. Sinks.Empty - æ— å€¼ï¼ˆå¯¹åº” Mono<Void>ï¼‰</h3><p>åªå‘é€å®Œæˆæˆ–é”™è¯¯ä¿¡å·ï¼Œä¸å‘é€å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Sinks.Empty&lt;Void&gt; sink = Sinks.empty();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€å®Œæˆä¿¡å·</span></span><br><span class="line">sink.tryEmitEmpty();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬ä¸º Mono&lt;Void&gt;</span></span><br><span class="line">Mono&lt;Void&gt; mono = sink.asMono();</span><br><span class="line">mono.subscribe(</span><br><span class="line">    v -&gt; &#123;&#125;,</span><br><span class="line">    e -&gt; &#123;&#125;,</span><br><span class="line">    () -&gt; System.out.println(<span class="string">&quot;å®Œæˆäº†&quot;</span>)  <span class="comment">// è¾“å‡º: å®Œæˆäº†</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨åœºæ™¯ï¼šåªå…³å¿ƒæ“ä½œæ˜¯å¦å®Œæˆï¼Œä¸å…³å¿ƒè¿”å›å€¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹ï¼šç­‰å¾…åˆå§‹åŒ–å®Œæˆ</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">waitForInit</span><span class="params">()</span> &#123;</span><br><span class="line">    Sinks.Empty&lt;Void&gt; sink = Sinks.empty();</span><br><span class="line">    </span><br><span class="line">    initService.onReady(() -&gt; sink.tryEmitEmpty());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> sink.asMono();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-Sinks-Many-å¤šå€¼ï¼ˆå¯¹åº”-Fluxï¼‰"><a href="#3-Sinks-Many-å¤šå€¼ï¼ˆå¯¹åº”-Fluxï¼‰" class="headerlink" title="3. Sinks.Many - å¤šå€¼ï¼ˆå¯¹åº” Fluxï¼‰"></a>3. Sinks.Many - å¤šå€¼ï¼ˆå¯¹åº” Fluxï¼‰</h3><p>å¯ä»¥å‘é€ 0 åˆ° N ä¸ªå€¼ï¼Œè¿™æ˜¯æœ€å¸¸ç”¨çš„ç±»å‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€å¤šä¸ªå€¼</span></span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯1&quot;</span>);</span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯2&quot;</span>);</span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯3&quot;</span>);</span><br><span class="line">sink.tryEmitComplete();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬ä¸º Flux</span></span><br><span class="line">Flux&lt;String&gt; flux = sink.asFlux();</span><br><span class="line">flux.subscribe(System.out::println);</span><br><span class="line"><span class="comment">// è¾“å‡º: æ¶ˆæ¯1, æ¶ˆæ¯2, æ¶ˆæ¯3</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Sinks-Many-çš„ä¸‰ç§æ¨¡å¼"><a href="#Sinks-Many-çš„ä¸‰ç§æ¨¡å¼" class="headerlink" title="Sinks.Many çš„ä¸‰ç§æ¨¡å¼"></a>Sinks.Many çš„ä¸‰ç§æ¨¡å¼</h2><h3 id="1-Unicastï¼ˆå•æ’­ï¼‰-åªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…"><a href="#1-Unicastï¼ˆå•æ’­ï¼‰-åªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…" class="headerlink" title="1. Unicastï¼ˆå•æ’­ï¼‰- åªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…"></a>1. Unicastï¼ˆå•æ’­ï¼‰- åªèƒ½æœ‰ä¸€ä¸ªè®¢é˜…è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().unicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line">Flux&lt;String&gt; flux = sink.asFlux();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªè®¢é˜…è€… </span></span><br><span class="line">flux.subscribe(v -&gt; System.out.println(<span class="string">&quot;è®¢é˜…è€…1: &quot;</span> + v));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒä¸ªè®¢é˜…è€…  ä¼šæŠ¥é”™ï¼</span></span><br><span class="line">flux.subscribe(v -&gt; System.out.println(<span class="string">&quot;è®¢é˜…è€…2: &quot;</span> + v));</span><br><span class="line"><span class="comment">// æŠ›å‡º IllegalStateException</span></span><br></pre></td></tr></table></figure>

<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>åªå…è®¸ä¸€ä¸ªè®¢é˜…è€…</li>
<li>å†…å­˜æ•ˆç‡é«˜ï¼ˆä¸éœ€è¦ç»´æŠ¤å¤šä¸ªè®¢é˜…è€…çŠ¶æ€ï¼‰</li>
<li>é€‚åˆç‚¹å¯¹ç‚¹é€šä¿¡</li>
</ul>
<h3 id="2-Multicastï¼ˆå¤šæ’­ï¼‰-å¤šä¸ªè®¢é˜…è€…å…±äº«"><a href="#2-Multicastï¼ˆå¤šæ’­ï¼‰-å¤šä¸ªè®¢é˜…è€…å…±äº«" class="headerlink" title="2. Multicastï¼ˆå¤šæ’­ï¼‰- å¤šä¸ªè®¢é˜…è€…å…±äº«"></a>2. Multicastï¼ˆå¤šæ’­ï¼‰- å¤šä¸ªè®¢é˜…è€…å…±äº«</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line">Flux&lt;String&gt; flux = sink.asFlux();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šä¸ªè®¢é˜…è€…éƒ½å¯ä»¥æ”¶åˆ°æ•°æ® </span></span><br><span class="line">flux.subscribe(v -&gt; System.out.println(<span class="string">&quot;è®¢é˜…è€…1: &quot;</span> + v));</span><br><span class="line">flux.subscribe(v -&gt; System.out.println(<span class="string">&quot;è®¢é˜…è€…2: &quot;</span> + v));</span><br><span class="line"></span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="comment">// è¾“å‡º:</span></span><br><span class="line"><span class="comment">// è®¢é˜…è€…1: Hello</span></span><br><span class="line"><span class="comment">// è®¢é˜…è€…2: Hello</span></span><br></pre></td></tr></table></figure>

<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å…è®¸å¤šä¸ªè®¢é˜…è€…</li>
<li>çƒ­æµï¼šæ–°è®¢é˜…è€…åªèƒ½æ”¶åˆ°è®¢é˜…åçš„æ•°æ®</li>
<li>é€‚åˆå¹¿æ’­åœºæ™¯</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çƒ­æµç‰¹æ€§æ¼”ç¤º</span></span><br><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯1&quot;</span>);  <span class="comment">// æ­¤æ—¶æ²¡æœ‰è®¢é˜…è€…ï¼Œæ¶ˆæ¯ä¸¢å¤±</span></span><br><span class="line"></span><br><span class="line">Flux&lt;String&gt; flux = sink.asFlux();</span><br><span class="line">flux.subscribe(v -&gt; System.out.println(<span class="string">&quot;æ”¶åˆ°: &quot;</span> + v));</span><br><span class="line"></span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯2&quot;</span>);  <span class="comment">// è®¢é˜…è€…æ”¶åˆ°</span></span><br><span class="line"><span class="comment">// è¾“å‡º: æ”¶åˆ°: æ¶ˆæ¯2</span></span><br></pre></td></tr></table></figure>

<h3 id="3-Replayï¼ˆé‡æ”¾ï¼‰-æ–°è®¢é˜…è€…å¯æ”¶åˆ°å†å²æ•°æ®"><a href="#3-Replayï¼ˆé‡æ”¾ï¼‰-æ–°è®¢é˜…è€…å¯æ”¶åˆ°å†å²æ•°æ®" class="headerlink" title="3. Replayï¼ˆé‡æ”¾ï¼‰- æ–°è®¢é˜…è€…å¯æ”¶åˆ°å†å²æ•°æ®"></a>3. Replayï¼ˆé‡æ”¾ï¼‰- æ–°è®¢é˜…è€…å¯æ”¶åˆ°å†å²æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡æ”¾æ‰€æœ‰å†å²æ•°æ®</span></span><br><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().replay().all();</span><br><span class="line"></span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯1&quot;</span>);</span><br><span class="line">sink.tryEmitNext(<span class="string">&quot;æ¶ˆæ¯2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°è®¢é˜…è€…å¯ä»¥æ”¶åˆ°ä¹‹å‰çš„æ•°æ®ï¼</span></span><br><span class="line">sink.asFlux().subscribe(v -&gt; System.out.println(<span class="string">&quot;æ”¶åˆ°: &quot;</span> + v));</span><br><span class="line"><span class="comment">// è¾“å‡º:</span></span><br><span class="line"><span class="comment">// æ”¶åˆ°: æ¶ˆæ¯1</span></span><br><span class="line"><span class="comment">// æ”¶åˆ°: æ¶ˆæ¯2</span></span><br></pre></td></tr></table></figure>

<p>Replay çš„å˜ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡æ”¾æ‰€æœ‰</span></span><br><span class="line">Sinks.many().replay().all();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡æ”¾æœ€è¿‘ N æ¡</span></span><br><span class="line">Sinks.many().replay().limit(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªé‡æ”¾æœ€æ–°ä¸€æ¡</span></span><br><span class="line">Sinks.many().replay().latest();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡æ”¾æŒ‡å®šæ—¶é—´å†…çš„æ•°æ®</span></span><br><span class="line">Sinks.many().replay().limit(Duration.ofMinutes(<span class="number">5</span>));</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸‰ç§æ¨¡å¼å¯¹æ¯”"><a href="#ä¸‰ç§æ¨¡å¼å¯¹æ¯”" class="headerlink" title="ä¸‰ç§æ¨¡å¼å¯¹æ¯”"></a>ä¸‰ç§æ¨¡å¼å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>è®¢é˜…è€…æ•°é‡</th>
<th>å†å²æ•°æ®</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Unicast</strong></td>
<td>1ä¸ª</td>
<td>æ— </td>
<td>ç‚¹å¯¹ç‚¹ã€é˜Ÿåˆ—æ¶ˆè´¹</td>
</tr>
<tr>
<td><strong>Multicast</strong></td>
<td>å¤šä¸ª</td>
<td>æ— ï¼ˆçƒ­æµï¼‰</td>
<td>äº‹ä»¶å¹¿æ’­ã€å®æ—¶æ¨é€</td>
</tr>
<tr>
<td><strong>Replay</strong></td>
<td>å¤šä¸ª</td>
<td>æœ‰ï¼ˆå¯é…ç½®ï¼‰</td>
<td>çŠ¶æ€å…±äº«ã€ç¼“å­˜</td>
</tr>
</tbody></table>
<hr>
<h2 id="å‘é€æ•°æ®çš„æ–¹æ³•"><a href="#å‘é€æ•°æ®çš„æ–¹æ³•" class="headerlink" title="å‘é€æ•°æ®çš„æ–¹æ³•"></a>å‘é€æ•°æ®çš„æ–¹æ³•</h2><h3 id="tryEmitXxx-vs-emitXxx"><a href="#tryEmitXxx-vs-emitXxx" class="headerlink" title="tryEmitXxx vs emitXxx"></a>tryEmitXxx vs emitXxx</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼1: tryEmitXxx - è¿”å›ç»“æœï¼Œä¸æŠ›å¼‚å¸¸</span></span><br><span class="line">Sinks.<span class="type">EmitResult</span> <span class="variable">result</span> <span class="operator">=</span> sink.tryEmitNext(<span class="string">&quot;data&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (result.isFailure()) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†å¤±è´¥</span></span><br><span class="line">    System.out.println(<span class="string">&quot;å‘é€å¤±è´¥: &quot;</span> + result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹å¼2: emitXxx - å¯è‡ªå®šä¹‰å¤±è´¥å¤„ç†</span></span><br><span class="line">sink.emitNext(<span class="string">&quot;data&quot;</span>, (signalType, emitResult) -&gt; &#123;</span><br><span class="line">    <span class="comment">// è¿”å› true è¡¨ç¤ºé‡è¯•ï¼Œfalse è¡¨ç¤ºæ”¾å¼ƒ</span></span><br><span class="line">    <span class="keyword">return</span> emitResult == Sinks.EmitResult.FAIL_NON_SERIALIZED;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="EmitResult-çš„ç±»å‹"><a href="#EmitResult-çš„ç±»å‹" class="headerlink" title="EmitResult çš„ç±»å‹"></a>EmitResult çš„ç±»å‹</h3><table>
<thead>
<tr>
<th>ç»“æœ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>OK</code></td>
<td>å‘é€æˆåŠŸ</td>
</tr>
<tr>
<td><code>FAIL_TERMINATED</code></td>
<td>Sink å·²ç»ˆæ­¢</td>
</tr>
<tr>
<td><code>FAIL_OVERFLOW</code></td>
<td>èƒŒå‹æº¢å‡º</td>
</tr>
<tr>
<td><code>FAIL_CANCELLED</code></td>
<td>å·²å–æ¶ˆ</td>
</tr>
<tr>
<td><code>FAIL_NON_SERIALIZED</code></td>
<td>å¹¶å‘å†²çªï¼ˆå¤šçº¿ç¨‹åŒæ—¶å‘é€ï¼‰</td>
</tr>
<tr>
<td><code>FAIL_ZERO_SUBSCRIBER</code></td>
<td>æ²¡æœ‰è®¢é˜…è€…ï¼ˆunicastï¼‰</td>
</tr>
</tbody></table>
<h3 id="å¸¸ç”¨çš„-EmitFailureHandler"><a href="#å¸¸ç”¨çš„-EmitFailureHandler" class="headerlink" title="å¸¸ç”¨çš„ EmitFailureHandler"></a>å¸¸ç”¨çš„ EmitFailureHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿«é€Ÿå¤±è´¥ - å¤±è´¥å°±æ”¾å¼ƒ</span></span><br><span class="line">Sinks.EmitFailureHandler.FAIL_FAST</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿™ç­‰å¾…é‡è¯• - é€‚åˆå¹¶å‘åœºæ™¯</span></span><br><span class="line">Sinks.EmitFailureHandler.busyLooping(Duration.ofMillis(<span class="number">100</span>))</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å®æˆ˜ç¤ºä¾‹"><a href="#å®æˆ˜ç¤ºä¾‹" class="headerlink" title="å®æˆ˜ç¤ºä¾‹"></a>å®æˆ˜ç¤ºä¾‹</h2><h3 id="ç¤ºä¾‹1ï¼šWebSocket-æ¶ˆæ¯æ¨é€"><a href="#ç¤ºä¾‹1ï¼šWebSocket-æ¶ˆæ¯æ¨é€" class="headerlink" title="ç¤ºä¾‹1ï¼šWebSocket æ¶ˆæ¯æ¨é€"></a>ç¤ºä¾‹1ï¼šWebSocket æ¶ˆæ¯æ¨é€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”¨äºå‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å¹¿æ’­æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sinks.Many&lt;String&gt; messageSink = </span><br><span class="line">        Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æ¶ˆæ¯æµï¼Œä¾› WebSocket è®¢é˜…</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">getMessageStream</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> messageSink.asFlux();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‘é€æ¶ˆæ¯ç»™æ‰€æœ‰å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">broadcast</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        messageSink.tryEmitNext(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WebSocket é…ç½®</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> HandlerMapping <span class="title function_">webSocketMapping</span><span class="params">(WebSocketHandler handler)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleUrlHandlerMapping</span>(Map.of(</span><br><span class="line">        <span class="string">&quot;/ws&quot;</span>, session -&gt; session.send(</span><br><span class="line">            handler.getMessageStream()</span><br><span class="line">                .map(session::textMessage)</span><br><span class="line">        )</span><br><span class="line">    ), -<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¤ºä¾‹2ï¼šäº‹ä»¶æ€»çº¿"><a href="#ç¤ºä¾‹2ï¼šäº‹ä»¶æ€»çº¿" class="headerlink" title="ç¤ºä¾‹2ï¼šäº‹ä»¶æ€»çº¿"></a>ç¤ºä¾‹2ï¼šäº‹ä»¶æ€»çº¿</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventBus</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sinks.Many&lt;Event&gt; eventSink = </span><br><span class="line">        Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‘å¸ƒäº‹ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publish</span><span class="params">(Event event)</span> &#123;</span><br><span class="line">        eventSink.tryEmitNext(event);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¢é˜…ç‰¹å®šç±»å‹çš„äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Event</span>&gt; Flux&lt;T&gt; <span class="title function_">subscribe</span><span class="params">(Class&lt;T&gt; eventType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> eventSink.asFlux()</span><br><span class="line">            .filter(eventType::isInstance)</span><br><span class="line">            .cast(eventType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">eventBus.subscribe(UserCreatedEvent.class)</span><br><span class="line">    .subscribe(event -&gt; System.out.println(<span class="string">&quot;ç”¨æˆ·åˆ›å»º: &quot;</span> + event.getUserId()));</span><br><span class="line"></span><br><span class="line">eventBus.publish(<span class="keyword">new</span> <span class="title class_">UserCreatedEvent</span>(<span class="number">123L</span>));</span><br></pre></td></tr></table></figure>

<h3 id="ç¤ºä¾‹3ï¼šå¼‚æ­¥ä»»åŠ¡ç»“æœæ”¶é›†"><a href="#ç¤ºä¾‹3ï¼šå¼‚æ­¥ä»»åŠ¡ç»“æœæ”¶é›†" class="headerlink" title="ç¤ºä¾‹3ï¼šå¼‚æ­¥ä»»åŠ¡ç»“æœæ”¶é›†"></a>ç¤ºä¾‹3ï¼šå¼‚æ­¥ä»»åŠ¡ç»“æœæ”¶é›†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Flux&lt;Result&gt; <span class="title function_">executeTasksAsync</span><span class="params">(List&lt;Task&gt; tasks)</span> &#123;</span><br><span class="line">    Sinks.Many&lt;Result&gt; sink = Sinks.many().unicast().onBackpressureBuffer();</span><br><span class="line">    </span><br><span class="line">    <span class="type">AtomicInteger</span> <span class="variable">remaining</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(tasks.size());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (Task task : tasks) &#123;</span><br><span class="line">        CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> task.execute();</span><br><span class="line">            sink.tryEmitNext(result);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (remaining.decrementAndGet() == <span class="number">0</span>) &#123;</span><br><span class="line">                sink.tryEmitComplete();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> sink.asFlux();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¤ºä¾‹4ï¼šç¼“å­˜æœ€æ–°çŠ¶æ€"><a href="#ç¤ºä¾‹4ï¼šç¼“å­˜æœ€æ–°çŠ¶æ€" class="headerlink" title="ç¤ºä¾‹4ï¼šç¼“å­˜æœ€æ–°çŠ¶æ€"></a>ç¤ºä¾‹4ï¼šç¼“å­˜æœ€æ–°çŠ¶æ€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StatusCache</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ replay().latest() ç¼“å­˜æœ€æ–°çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Sinks.Many&lt;SystemStatus&gt; statusSink = </span><br><span class="line">        Sinks.many().replay().latest();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateStatus</span><span class="params">(SystemStatus status)</span> &#123;</span><br><span class="line">        statusSink.tryEmitNext(status);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–å½“å‰çŠ¶æ€ï¼ˆæ–°è®¢é˜…è€…ç«‹å³æ”¶åˆ°æœ€æ–°çŠ¶æ€ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;SystemStatus&gt; <span class="title function_">getCurrentStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> statusSink.asFlux().next();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç›‘å¬çŠ¶æ€å˜åŒ–</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;SystemStatus&gt; <span class="title function_">watchStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> statusSink.asFlux();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="Sinks-vs-æ—§ç‰ˆ-Processor"><a href="#Sinks-vs-æ—§ç‰ˆ-Processor" class="headerlink" title="Sinks vs æ—§ç‰ˆ Processor"></a>Sinks vs æ—§ç‰ˆ Processor</h2><p>Reactor 3.4 ä¹‹å‰ä½¿ç”¨ <code>Processor</code>ï¼Œç°åœ¨å·²åºŸå¼ƒï¼š</p>
<table>
<thead>
<tr>
<th>æ—§ç‰ˆ Processor</th>
<th>æ–°ç‰ˆ Sinks</th>
</tr>
</thead>
<tbody><tr>
<td><code>DirectProcessor</code></td>
<td><code>Sinks.many().multicast().directBestEffort()</code></td>
</tr>
<tr>
<td><code>UnicastProcessor</code></td>
<td><code>Sinks.many().unicast()</code></td>
</tr>
<tr>
<td><code>ReplayProcessor</code></td>
<td><code>Sinks.many().replay()</code></td>
</tr>
<tr>
<td><code>EmitterProcessor</code></td>
<td><code>Sinks.many().multicast()</code></td>
</tr>
</tbody></table>
<p>ä¸ºä»€ä¹ˆåºŸå¼ƒ Processorï¼Ÿ</p>
<ul>
<li>Processor åŒæ—¶æ˜¯ Publisher å’Œ Subscriberï¼ŒèŒè´£ä¸æ¸…</li>
<li>çº¿ç¨‹å®‰å…¨é—®é¢˜éš¾ä»¥å¤„ç†</li>
<li>Sinks æä¾›æ›´æ¸…æ™°çš„ API å’Œæ›´å¥½çš„çº¿ç¨‹å®‰å…¨ä¿è¯</li>
</ul>
<hr>
<h2 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h2><p>Sinks é»˜è®¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æœ‰æ€§èƒ½å¼€é”€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤ï¼šçº¿ç¨‹å®‰å…¨</span></span><br><span class="line">Sinks.Many&lt;String&gt; sink = Sinks.many().multicast().onBackpressureBuffer();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœç¡®å®šå•çº¿ç¨‹ä½¿ç”¨ï¼Œå¯ä»¥ç”¨ unsafe ç‰ˆæœ¬æå‡æ€§èƒ½</span></span><br><span class="line">Sinks.Many&lt;String&gt; unsafeSink = Sinks.unsafe().many().multicast().onBackpressureBuffer();</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼š<code>unsafe</code> ç‰ˆæœ¬åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šå‡ºé—®é¢˜ï¼Œåªåœ¨ç¡®å®šå•çº¿ç¨‹æ—¶ä½¿ç”¨ã€‚</p>
<hr>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Sinks æ˜¯ä»€ä¹ˆ</strong></td>
<td>æ‰‹åŠ¨å‘é€æ•°æ®åˆ°å“åº”å¼æµçš„å·¥å…·</td>
</tr>
<tr>
<td><strong>ä¸ Mono&#x2F;Flux å…³ç³»</strong></td>
<td>Sinks æ˜¯æ•°æ®æºï¼Œé€šè¿‡ <code>asFlux()</code>&#x2F;<code>asMono()</code> è½¬æ¢</td>
</tr>
<tr>
<td><strong>Sinks.One</strong></td>
<td>å‘é€ 0-1 ä¸ªå€¼ï¼Œå¯¹åº” Mono</td>
</tr>
<tr>
<td><strong>Sinks.Empty</strong></td>
<td>åªå‘é€å®Œæˆ&#x2F;é”™è¯¯ä¿¡å·ï¼Œå¯¹åº” Mono<Void></td>
</tr>
<tr>
<td><strong>Sinks.Many</strong></td>
<td>å‘é€ 0-N ä¸ªå€¼ï¼Œå¯¹åº” Flux</td>
</tr>
<tr>
<td><strong>Unicast</strong></td>
<td>å•è®¢é˜…è€…</td>
</tr>
<tr>
<td><strong>Multicast</strong></td>
<td>å¤šè®¢é˜…è€…ï¼Œçƒ­æµ</td>
</tr>
<tr>
<td><strong>Replay</strong></td>
<td>å¤šè®¢é˜…è€…ï¼Œå¯é‡æ”¾å†å²</td>
</tr>
</tbody></table>
<hr>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>Reactor API å‚è€ƒ</li>
<li>Project Reactor å®ç°</li>
<li>WebFlux æ ¸å¿ƒç»„ä»¶</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ZhiMy</span>
  </div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
