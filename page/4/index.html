<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zmmmmy.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":"auto","version":"8.27.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
<meta property="og:type" content="website">
<meta property="og:title" content="Zmmmmy&#39;s Blog">
<meta property="og:url" content="https://zmmmmy.github.io/page/4/index.html">
<meta property="og:site_name" content="Zmmmmy&#39;s Blog">
<meta property="og:description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ZhiMy">
<meta property="article:tag" content="æŠ€æœ¯åšå®¢">
<meta property="article:tag" content="ç¼–ç¨‹">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zmmmmy.github.io/page/4/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zmmmmy's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zmmmmy's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">ä»Šå¤©æƒ³å’Œ AI èŠç‚¹ä»€ä¹ˆï¼Ÿ</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ZhiMy"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">ZhiMy</p>
  <div class="site-description" itemprop="description">ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">åˆ†ç±»</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">100</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Zmmmmy" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Zmmmmy" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/Reactive%20Streams%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/Reactive%20Streams%E8%A7%84%E8%8C%83/" class="post-title-link" itemprop="url">Reactive Streamsè§„èŒƒ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Reactive-Streams/" itemprop="url" rel="index"><span itemprop="name">Reactive Streams</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Reactive-Streams-è§„èŒƒ"><a href="#Reactive-Streams-è§„èŒƒ" class="headerlink" title="Reactive Streams è§„èŒƒ"></a>Reactive Streams è§„èŒƒ</h1><h2 id="ä»€ä¹ˆæ˜¯-Reactive-Streams"><a href="#ä»€ä¹ˆæ˜¯-Reactive-Streams" class="headerlink" title="ä»€ä¹ˆæ˜¯ Reactive Streams"></a>ä»€ä¹ˆæ˜¯ Reactive Streams</h2><p>Reactive Streams æ˜¯ JVM ä¸Š<strong>å“åº”å¼ç¼–ç¨‹çš„æ ‡å‡†è§„èŒƒ</strong>ï¼Œå®šä¹‰äº†å¼‚æ­¥æµå¤„ç†çš„æ¥å£å’Œåè®®ã€‚</p>
<ul>
<li><strong>å‘èµ·è€…</strong>ï¼šNetflixã€Pivotalã€Lightbendã€Twitter ç­‰å…¬å¸è”åˆåˆ¶å®š</li>
<li><strong>ç›®æ ‡</strong>ï¼šè§£å†³å¼‚æ­¥æ•°æ®æµå¤„ç†ä¸­çš„èƒŒå‹é—®é¢˜</li>
<li><strong>Java 9</strong>ï¼šå·²çº³å…¥ JDKï¼Œä½äº <code>java.util.concurrent.Flow</code></li>
</ul>
<h2 id="å››ä¸ªæ ¸å¿ƒæ¥å£"><a href="#å››ä¸ªæ ¸å¿ƒæ¥å£" class="headerlink" title="å››ä¸ªæ ¸å¿ƒæ¥å£"></a>å››ä¸ªæ ¸å¿ƒæ¥å£</h2><p>Reactive Streams åªå®šä¹‰äº† 4 ä¸ªæ¥å£ï¼Œéå¸¸ç®€æ´ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. å‘å¸ƒè€… - æ•°æ®çš„ç”Ÿäº§è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Publisher</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(Subscriber&lt;? <span class="built_in">super</span> T&gt; s)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è®¢é˜…è€… - æ•°æ®çš„æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subscriber</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onSubscribe</span><span class="params">(Subscription s)</span>;  <span class="comment">// è®¢é˜…æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onNext</span><span class="params">(T t)</span>;                   <span class="comment">// æ¥æ”¶æ•°æ®</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Throwable t)</span>;          <span class="comment">// å‘ç”Ÿé”™è¯¯</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onComplete</span><span class="params">()</span>;                  <span class="comment">// æ•°æ®æµç»“æŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. è®¢é˜…å…³ç³» - è¿æ¥å‘å¸ƒè€…å’Œè®¢é˜…è€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subscription</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">request</span><span class="params">(<span class="type">long</span> n)</span>;  <span class="comment">// è¯·æ±‚ n ä¸ªæ•°æ®ï¼ˆèƒŒå‹æ ¸å¿ƒï¼‰</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">()</span>;         <span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. å¤„ç†å™¨ - æ—¢æ˜¯è®¢é˜…è€…åˆæ˜¯å‘å¸ƒè€…</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Processor</span>&lt;T, R&gt; <span class="keyword">extends</span> <span class="title class_">Subscriber</span>&lt;T&gt;, Publisher&lt;R&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äº¤äº’æµç¨‹"><a href="#äº¤äº’æµç¨‹" class="headerlink" title="äº¤äº’æµç¨‹"></a>äº¤äº’æµç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   Publisher  â”‚                      â”‚  Subscriber  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚  1. subscribe(subscriber)           â”‚</span><br><span class="line">       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚  2. onSubscribe(subscription)       â”‚</span><br><span class="line">       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚  3. request(n) è¯·æ±‚nä¸ªæ•°æ®          â”‚</span><br><span class="line">       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚  4. onNext(data) å‘é€æ•°æ®ï¼ˆæœ€å¤šnä¸ªï¼‰â”‚</span><br><span class="line">       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="line">       â”‚         ... é‡å¤ 3-4 ...            â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚  5. onComplete() æˆ– onError()       â”‚</span><br><span class="line">       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="line">       â–¼                                     â–¼</span><br></pre></td></tr></table></figure>

<h2 id="èƒŒå‹ï¼ˆBackpressureï¼‰"><a href="#èƒŒå‹ï¼ˆBackpressureï¼‰" class="headerlink" title="èƒŒå‹ï¼ˆBackpressureï¼‰"></a>èƒŒå‹ï¼ˆBackpressureï¼‰</h2><p>èƒŒå‹æ˜¯ Reactive Streams çš„<strong>æ ¸å¿ƒç‰¹æ€§</strong>ï¼Œè§£å†³ç”Ÿäº§è€…é€Ÿåº¦å¿«äºæ¶ˆè´¹è€…çš„é—®é¢˜ã€‚</p>
<h3 id="æ²¡æœ‰èƒŒå‹çš„é—®é¢˜"><a href="#æ²¡æœ‰èƒŒå‹çš„é—®é¢˜" class="headerlink" title="æ²¡æœ‰èƒŒå‹çš„é—®é¢˜"></a>æ²¡æœ‰èƒŒå‹çš„é—®é¢˜</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç”Ÿäº§è€…ï¼š1000æ¡/ç§’  â”€â”€â”€â”€â”€â”€â–¶  æ¶ˆè´¹è€…ï¼š100æ¡/ç§’</span><br><span class="line">                              â†“</span><br><span class="line">                         å†…å­˜æº¢å‡ºï¼</span><br></pre></td></tr></table></figure>

<h3 id="æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ"><a href="#æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ"></a>æœ‰èƒŒå‹çš„è§£å†³æ–¹æ¡ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆè´¹è€…æ§åˆ¶é€Ÿåº¦</span></span><br><span class="line">subscription.request(<span class="number">10</span>);  <span class="comment">// æˆ‘åªè¦10æ¡</span></span><br><span class="line"><span class="comment">// ç”Ÿäº§è€…æœ€å¤šå‘10æ¡ï¼Œç„¶åç­‰å¾…ä¸‹ä¸€æ¬¡ request</span></span><br></pre></td></tr></table></figure>

<h3 id="èƒŒå‹åè®®è§„åˆ™"><a href="#èƒŒå‹åè®®è§„åˆ™" class="headerlink" title="èƒŒå‹åè®®è§„åˆ™"></a>èƒŒå‹åè®®è§„åˆ™</h3><ol>
<li><strong>Subscriber ä¸»åŠ¨è¯·æ±‚</strong>ï¼šé€šè¿‡ <code>request(n)</code> å‘Šè¯‰ Publisher éœ€è¦å¤šå°‘æ•°æ®</li>
<li><strong>Publisher éµå®ˆçº¦å®š</strong>ï¼šæœ€å¤šå‘é€ n ä¸ªæ•°æ®ï¼Œä¸èƒ½è¶…å‘</li>
<li><strong>ç´¯ç§¯è¯·æ±‚</strong>ï¼šå¤šæ¬¡ <code>request()</code> çš„æ•°é‡ä¼šç´¯åŠ </li>
<li><strong>æ— é™è¯·æ±‚</strong>ï¼š<code>request(Long.MAX_VALUE)</code> è¡¨ç¤ºä¸é™åˆ¶</li>
</ol>
<h2 id="è§„èŒƒçš„å®ç°"><a href="#è§„èŒƒçš„å®ç°" class="headerlink" title="è§„èŒƒçš„å®ç°"></a>è§„èŒƒçš„å®ç°</h2><table>
<thead>
<tr>
<th>å®ç°</th>
<th>è¯´æ˜</th>
<th>ä½¿ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Project Reactor</strong></td>
<td>Spring é»˜è®¤å®ç°</td>
<td>Spring WebFlux</td>
</tr>
<tr>
<td><strong>RxJava</strong></td>
<td>Netflix å¼€æº</td>
<td>Androidã€é€šç”¨</td>
</tr>
<tr>
<td><strong>Akka Streams</strong></td>
<td>Lightbend å¼€æº</td>
<td>Scala ç”Ÿæ€</td>
</tr>
<tr>
<td><strong>Java 9 Flow</strong></td>
<td>JDK å†…ç½®</td>
<td>æ ‡å‡†åº“</td>
</tr>
</tbody></table>
<p>Spring ç”Ÿæ€ä½¿ç”¨çš„æ˜¯ <strong>Project Reactor</strong>ï¼Œä¸‹ä¸€ç¯‡è¯¦ç»†ä»‹ç»ã€‚</p>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>ä¸‹ä¸€ç¯‡ï¼šProject Reactor å®ç°</li>
<li>WebFlux - å“åº”å¼ç¼–ç¨‹åŸºç¡€</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/ThreadLocal%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/ThreadLocal%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">ThreadLocalåŸç†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">å¹¶å‘ç¼–ç¨‹</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">åŸºç¡€çŸ¥è¯†</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ThreadLocal-åŸç†"><a href="#ThreadLocal-åŸç†" class="headerlink" title="ThreadLocal åŸç†"></a>ThreadLocal åŸç†</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><code>ThreadLocal</code> æä¾›<strong>çº¿ç¨‹æœ¬åœ°å˜é‡</strong>ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œå®ç°çº¿ç¨‹é—´æ•°æ®éš”ç¦»ã€‚</p>
<h2 id="æ ¸å¿ƒæ•°æ®ç»“æ„"><a href="#æ ¸å¿ƒæ•°æ®ç»“æ„" class="headerlink" title="æ ¸å¿ƒæ•°æ®ç»“æ„"></a>æ ¸å¿ƒæ•°æ®ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread</span><br><span class="line">  â””â”€â”€ ThreadLocalMap threadLocals</span><br><span class="line">        â””â”€â”€ Entry[] table</span><br><span class="line">              â””â”€â”€ Entry(ThreadLocal&lt;?&gt; key, Object value)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>Thread.threadLocals</code></td>
<td>æ¯ä¸ªçº¿ç¨‹æŒæœ‰çš„ ThreadLocalMap å®ä¾‹</td>
</tr>
<tr>
<td><code>ThreadLocalMap</code></td>
<td>è‡ªå®šä¹‰å“ˆå¸Œè¡¨ï¼Œå­˜å‚¨çº¿ç¨‹æœ¬åœ°å˜é‡</td>
</tr>
<tr>
<td><code>Entry</code></td>
<td>ç»§æ‰¿ <code>WeakReference&lt;ThreadLocal&lt;?&gt;&gt;</code> çš„é”®å€¼å¯¹</td>
</tr>
</tbody></table>
<h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><h3 id="1-set-æ–¹æ³•"><a href="#1-set-æ–¹æ³•" class="headerlink" title="1. set() æ–¹æ³•"></a>1. set() æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);  <span class="comment">// è·å–å½“å‰çº¿ç¨‹çš„ ThreadLocalMap</span></span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);        <span class="comment">// this æ˜¯ ThreadLocal å®ä¾‹ä½œä¸º key</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        createMap(t, value);         <span class="comment">// é¦–æ¬¡ä½¿ç”¨ï¼Œåˆ›å»º map</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-get-æ–¹æ³•"><a href="#2-get-æ–¹æ³•" class="headerlink" title="2. get() æ–¹æ³•"></a>2. get() æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (T) e.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> setInitialValue();  <span class="comment">// è¿”å›åˆå§‹å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-æ•°æ®å­˜å‚¨ä½ç½®"><a href="#3-æ•°æ®å­˜å‚¨ä½ç½®" class="headerlink" title="3. æ•°æ®å­˜å‚¨ä½ç½®"></a>3. æ•°æ®å­˜å‚¨ä½ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[ThreadLocal.get/set] --&gt; B[Thread.currentThread]</span><br><span class="line">    B --&gt; C[thread.threadLocals]</span><br><span class="line">    C --&gt; D[ThreadLocalMap]</span><br><span class="line">    D --&gt; E[Entryæ•°ç»„]</span><br><span class="line">    E --&gt; F[&quot;key=ThreadLocalå®ä¾‹&lt;br/&gt;value=çº¿ç¨‹æœ¬åœ°å€¼&quot;]</span><br></pre></td></tr></table></figure>

<h2 id="å…³é”®è®¾è®¡"><a href="#å…³é”®è®¾è®¡" class="headerlink" title="å…³é”®è®¾è®¡"></a>å…³é”®è®¾è®¡</h2><h3 id="Entry-ä½¿ç”¨å¼±å¼•ç”¨"><a href="#Entry-ä½¿ç”¨å¼±å¼•ç”¨" class="headerlink" title="Entry ä½¿ç”¨å¼±å¼•ç”¨"></a>Entry ä½¿ç”¨å¼±å¼•ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">    Object value;</span><br><span class="line">    Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">        <span class="built_in">super</span>(k);  <span class="comment">// key æ˜¯å¼±å¼•ç”¨</span></span><br><span class="line">        value = v; <span class="comment">// value æ˜¯å¼ºå¼•ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆ key ç”¨å¼±å¼•ç”¨ï¼Ÿ</strong> ğŸ‘‰Javaå¼•ç”¨ç±»å‹è¯¦è§£ ^weak-ref-design</p>
<ul>
<li>å½“å¤–éƒ¨ä¸å†æŒæœ‰ ThreadLocal å¼•ç”¨æ—¶ï¼ŒGC å¯ä»¥å›æ”¶ ThreadLocal å¯¹è±¡</li>
<li>é¿å… ThreadLocal å¯¹è±¡æœ¬èº«çš„å†…å­˜æ³„æ¼</li>
</ul>
<h3 id="å“ˆå¸Œå†²çªå¤„ç†"><a href="#å“ˆå¸Œå†²çªå¤„ç†" class="headerlink" title="å“ˆå¸Œå†²çªå¤„ç†"></a>å“ˆå¸Œå†²çªå¤„ç†</h3><p>ThreadLocalMap ä½¿ç”¨<strong>çº¿æ€§æ¢æµ‹æ³•</strong>è§£å†³å“ˆå¸Œå†²çªï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(ThreadLocal&lt;?&gt; key, Object value)</span> &#123;</span><br><span class="line">    Entry[] tab = table;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> tab.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> key.threadLocalHashCode &amp; (len - <span class="number">1</span>);  <span class="comment">// è®¡ç®—ä¸‹æ ‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çº¿æ€§æ¢æµ‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> tab[i]; e != <span class="literal">null</span>; e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°ç›¸åŒ key æˆ–ç©ºæ§½ä½</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å†…å­˜æ³„æ¼é—®é¢˜"><a href="#å†…å­˜æ³„æ¼é—®é¢˜" class="headerlink" title="å†…å­˜æ³„æ¼é—®é¢˜"></a>å†…å­˜æ³„æ¼é—®é¢˜</h2><h3 id="æ³„æ¼åœºæ™¯"><a href="#æ³„æ¼åœºæ™¯" class="headerlink" title="æ³„æ¼åœºæ™¯"></a>æ³„æ¼åœºæ™¯</h3><table>
<thead>
<tr>
<th>æ¡ä»¶</th>
<th>ç»“æœ</th>
</tr>
</thead>
<tbody><tr>
<td>ThreadLocal è¢«å›æ”¶ï¼ˆå¼±å¼•ç”¨ï¼‰</td>
<td>Entry.key &#x3D; null</td>
</tr>
<tr>
<td>çº¿ç¨‹ä»å­˜æ´»ï¼ˆå¦‚çº¿ç¨‹æ± ï¼‰</td>
<td>Entry.value æ— æ³•å›æ”¶</td>
</tr>
</tbody></table>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p><strong>å§‹ç»ˆåœ¨ä½¿ç”¨åè°ƒç”¨ <code>remove()</code></strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;User&gt; userContext = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    userContext.set(currentUser);</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    userContext.remove();  <span class="comment">// å¿…é¡»æ¸…ç†ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å…¸å‹åº”ç”¨åœºæ™¯"><a href="#å…¸å‹åº”ç”¨åœºæ™¯" class="headerlink" title="å…¸å‹åº”ç”¨åœºæ™¯"></a>å…¸å‹åº”ç”¨åœºæ™¯</h2><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>ç”¨æˆ·ä¸Šä¸‹æ–‡</td>
<td>å­˜å‚¨å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</td>
</tr>
<tr>
<td>æ•°æ®åº“è¿æ¥</td>
<td>ä¿è¯åŒä¸€çº¿ç¨‹ä½¿ç”¨åŒä¸€è¿æ¥</td>
</tr>
<tr>
<td>äº‹åŠ¡ç®¡ç†</td>
<td>Spring çš„äº‹åŠ¡åŒæ­¥</td>
</tr>
<tr>
<td>æ—¥æœŸæ ¼å¼åŒ–</td>
<td>SimpleDateFormat çº¿ç¨‹å®‰å…¨ä½¿ç”¨</td>
</tr>
<tr>
<td>é“¾è·¯è¿½è¸ª</td>
<td>TraceId åœ¨çº¿ç¨‹å†…ä¼ é€’</td>
</tr>
</tbody></table>
<h2 id="ä¸åŒæ­¥æœºåˆ¶å¯¹æ¯”"><a href="#ä¸åŒæ­¥æœºåˆ¶å¯¹æ¯”" class="headerlink" title="ä¸åŒæ­¥æœºåˆ¶å¯¹æ¯”"></a>ä¸åŒæ­¥æœºåˆ¶å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>ThreadLocal</th>
<th>synchronized&#x2F;Lock</th>
</tr>
</thead>
<tbody><tr>
<td>åŸç†</td>
<td>ç©ºé—´æ¢æ—¶é—´ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸€ä»½å‰¯æœ¬</td>
<td>æ—¶é—´æ¢ç©ºé—´ï¼Œæ’é˜Ÿè®¿é—®</td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>æ— ç«äº‰ï¼Œæ€§èƒ½é«˜</td>
<td>æœ‰é”ç«äº‰å¼€é”€</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>çº¿ç¨‹ç‹¬äº«æ•°æ®</td>
<td>çº¿ç¨‹å…±äº«æ•°æ®</td>
</tr>
</tbody></table>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šæ•°æ®å­˜åœ¨æ¯ä¸ªçº¿ç¨‹çš„ <code>threadLocals</code> å­—æ®µä¸­</li>
<li><strong>æ•°æ®ç»“æ„</strong>ï¼šThreadLocalMap æ˜¯è‡ªå®šä¹‰å“ˆå¸Œè¡¨ï¼ŒEntry çš„ key æ˜¯å¼±å¼•ç”¨</li>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šç”¨ç©ºé—´æ¢æ—¶é—´ï¼Œé¿å…åŒæ­¥å¼€é”€</li>
<li><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šä½¿ç”¨åå¿…é¡»è°ƒç”¨ <code>remove()</code> é˜²æ­¢å†…å­˜æ³„æ¼</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/WebFlux%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/WebFlux%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">WebFluxæ ¸å¿ƒç»„ä»¶</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Webflux/" itemprop="url" rel="index"><span itemprop="name">Webflux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="WebFlux-æ ¸å¿ƒç»„ä»¶"><a href="#WebFlux-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="WebFlux æ ¸å¿ƒç»„ä»¶"></a>WebFlux æ ¸å¿ƒç»„ä»¶</h1><h2 id="æ³¨è§£å¼ç¼–ç¨‹æ¨¡å‹"><a href="#æ³¨è§£å¼ç¼–ç¨‹æ¨¡å‹" class="headerlink" title="æ³¨è§£å¼ç¼–ç¨‹æ¨¡å‹"></a>æ³¨è§£å¼ç¼–ç¨‹æ¨¡å‹</h2><p>WebFlux æ”¯æŒä¸ Spring MVC ç±»ä¼¼çš„æ³¨è§£å¼ç¼–ç¨‹ï¼Œä½¿ç”¨ <code>@Controller</code> å’Œ <code>@RestController</code>ã€‚</p>
<h3 id="åŸºæœ¬æ§åˆ¶å™¨"><a href="#åŸºæœ¬æ§åˆ¶å™¨" class="headerlink" title="åŸºæœ¬æ§åˆ¶å™¨"></a>åŸºæœ¬æ§åˆ¶å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserController</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.CREATED)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable</span> String id, <span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.update(id, user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.NO_CONTENT)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å“åº”å¼è¿”å›ç±»å‹"><a href="#å“åº”å¼è¿”å›ç±»å‹" class="headerlink" title="å“åº”å¼è¿”å›ç±»å‹"></a>å“åº”å¼è¿”å›ç±»å‹</h3><table>
<thead>
<tr>
<th>è¿”å›ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>Mono&lt;T&gt;</code></td>
<td>è¿”å›å•ä¸ªå¯¹è±¡</td>
</tr>
<tr>
<td><code>Flux&lt;T&gt;</code></td>
<td>è¿”å›å¤šä¸ªå¯¹è±¡ï¼ˆæµå¼ï¼‰</td>
</tr>
<tr>
<td><code>Mono&lt;Void&gt;</code></td>
<td>æ— è¿”å›å€¼</td>
</tr>
<tr>
<td><code>Mono&lt;ResponseEntity&lt;T&gt;&gt;</code></td>
<td>è‡ªå®šä¹‰å“åº”</td>
</tr>
</tbody></table>
<h2 id="WebClient-å“åº”å¼-HTTP-å®¢æˆ·ç«¯"><a href="#WebClient-å“åº”å¼-HTTP-å®¢æˆ·ç«¯" class="headerlink" title="WebClient - å“åº”å¼ HTTP å®¢æˆ·ç«¯"></a>WebClient - å“åº”å¼ HTTP å®¢æˆ·ç«¯</h2><p><code>WebClient</code> æ˜¯ WebFlux æä¾›çš„éé˜»å¡ HTTP å®¢æˆ·ç«¯ï¼Œç”¨äºæ›¿ä»£ <code>RestTemplate</code>ã€‚</p>
<h3 id="åˆ›å»º-WebClient"><a href="#åˆ›å»º-WebClient" class="headerlink" title="åˆ›å»º WebClient"></a>åˆ›å»º WebClient</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºæœ¬åˆ›å»º</span></span><br><span class="line"><span class="type">WebClient</span> <span class="variable">client</span> <span class="operator">=</span> WebClient.create();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¦åŸºç¡€ URL</span></span><br><span class="line"><span class="type">WebClient</span> <span class="variable">client</span> <span class="operator">=</span> WebClient.create(<span class="string">&quot;http://localhost:8080&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ Builder è‡ªå®šä¹‰</span></span><br><span class="line"><span class="type">WebClient</span> <span class="variable">client</span> <span class="operator">=</span> WebClient.builder()</span><br><span class="line">    .baseUrl(<span class="string">&quot;http://localhost:8080&quot;</span>)</span><br><span class="line">    .defaultHeader(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)</span><br><span class="line">    .defaultHeader(HttpHeaders.AUTHORIZATION, <span class="string">&quot;Bearer token&quot;</span>)</span><br><span class="line">    .filter(ExchangeFilterFunction.ofRequestProcessor(</span><br><span class="line">        request -&gt; &#123;</span><br><span class="line">            log.info(<span class="string">&quot;Request: &#123;&#125; &#123;&#125;&quot;</span>, request.method(), request.url());</span><br><span class="line">            <span class="keyword">return</span> Mono.just(request);</span><br><span class="line">        &#125;</span><br><span class="line">    ))</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>

<h3 id="GET-è¯·æ±‚"><a href="#GET-è¯·æ±‚" class="headerlink" title="GET è¯·æ±‚"></a>GET è¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å•ä¸ªå¯¹è±¡</span></span><br><span class="line">Mono&lt;User&gt; user = webClient.get()</span><br><span class="line">    .uri(<span class="string">&quot;/api/users/&#123;id&#125;&quot;</span>, userId)</span><br><span class="line">    .retrieve()</span><br><span class="line">    .bodyToMono(User.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–åˆ—è¡¨</span></span><br><span class="line">Flux&lt;User&gt; users = webClient.get()</span><br><span class="line">    .uri(<span class="string">&quot;/api/users&quot;</span>)</span><br><span class="line">    .retrieve()</span><br><span class="line">    .bodyToFlux(User.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¦æŸ¥è¯¢å‚æ•°</span></span><br><span class="line">Flux&lt;User&gt; users = webClient.get()</span><br><span class="line">    .uri(uriBuilder -&gt; uriBuilder</span><br><span class="line">        .path(<span class="string">&quot;/api/users&quot;</span>)</span><br><span class="line">        .queryParam(<span class="string">&quot;page&quot;</span>, <span class="number">0</span>)</span><br><span class="line">        .queryParam(<span class="string">&quot;size&quot;</span>, <span class="number">10</span>)</span><br><span class="line">        .build())</span><br><span class="line">    .retrieve()</span><br><span class="line">    .bodyToFlux(User.class);</span><br></pre></td></tr></table></figure>

<h3 id="POST-è¯·æ±‚"><a href="#POST-è¯·æ±‚" class="headerlink" title="POST è¯·æ±‚"></a>POST è¯·æ±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Mono&lt;User&gt; createdUser = webClient.post()</span><br><span class="line">    .uri(<span class="string">&quot;/api/users&quot;</span>)</span><br><span class="line">    .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">    .bodyValue(newUser)</span><br><span class="line">    .retrieve()</span><br><span class="line">    .bodyToMono(User.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ Mono ä½œä¸ºè¯·æ±‚ä½“</span></span><br><span class="line">Mono&lt;User&gt; createdUser = webClient.post()</span><br><span class="line">    .uri(<span class="string">&quot;/api/users&quot;</span>)</span><br><span class="line">    .body(userMono, User.class)</span><br><span class="line">    .retrieve()</span><br><span class="line">    .bodyToMono(User.class);</span><br></pre></td></tr></table></figure>

<h3 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Mono&lt;User&gt; user = webClient.get()</span><br><span class="line">    .uri(<span class="string">&quot;/api/users/&#123;id&#125;&quot;</span>, userId)</span><br><span class="line">    .retrieve()</span><br><span class="line">    .onStatus(HttpStatusCode::is4xxClientError, response -&gt; </span><br><span class="line">        Mono.error(<span class="keyword">new</span> <span class="title class_">NotFoundException</span>(<span class="string">&quot;User not found&quot;</span>)))</span><br><span class="line">    .onStatus(HttpStatusCode::is5xxServerError, response -&gt; </span><br><span class="line">        Mono.error(<span class="keyword">new</span> <span class="title class_">ServerException</span>(<span class="string">&quot;Server error&quot;</span>)))</span><br><span class="line">    .bodyToMono(User.class);</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨-exchange-è·å–å®Œæ•´å“åº”"><a href="#ä½¿ç”¨-exchange-è·å–å®Œæ•´å“åº”" class="headerlink" title="ä½¿ç”¨ exchange() è·å–å®Œæ•´å“åº”"></a>ä½¿ç”¨ exchange() è·å–å®Œæ•´å“åº”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Mono&lt;ResponseEntity&lt;User&gt;&gt; response = webClient.get()</span><br><span class="line">    .uri(<span class="string">&quot;/api/users/&#123;id&#125;&quot;</span>, userId)</span><br><span class="line">    .exchangeToMono(clientResponse -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (clientResponse.statusCode().is2xxSuccessful()) &#123;</span><br><span class="line">            <span class="keyword">return</span> clientResponse.toEntity(User.class);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> clientResponse.createException().flatMap(Mono::error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="ServerRequest-å’Œ-ServerResponse"><a href="#ServerRequest-å’Œ-ServerResponse" class="headerlink" title="ServerRequest å’Œ ServerResponse"></a>ServerRequest å’Œ ServerResponse</h2><p>è¿™ä¸¤ä¸ªç±»ç”¨äºå‡½æ•°å¼ç«¯ç‚¹ç¼–ç¨‹ã€‚</p>
<h3 id="ServerRequest"><a href="#ServerRequest" class="headerlink" title="ServerRequest"></a>ServerRequest</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–è·¯å¾„å˜é‡</span></span><br><span class="line"><span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> request.pathVariable(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æŸ¥è¯¢å‚æ•°</span></span><br><span class="line">Optional&lt;String&gt; name = request.queryParam(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–è¯·æ±‚å¤´</span></span><br><span class="line"><span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> request.headers().contentType()</span><br><span class="line">    .map(MediaType::toString)</span><br><span class="line">    .orElse(<span class="string">&quot;unknown&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–è¯·æ±‚ä½“</span></span><br><span class="line">Mono&lt;User&gt; user = request.bodyToMono(User.class);</span><br><span class="line">Flux&lt;User&gt; users = request.bodyToFlux(User.class);</span><br></pre></td></tr></table></figure>

<h3 id="ServerResponse"><a href="#ServerResponse" class="headerlink" title="ServerResponse"></a>ServerResponse</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆåŠŸå“åº”</span></span><br><span class="line">ServerResponse.ok()</span><br><span class="line">    .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">    .bodyValue(user);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å› Mono</span></span><br><span class="line">ServerResponse.ok().body(userMono, User.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å› Flux</span></span><br><span class="line">ServerResponse.ok().body(userFlux, User.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå“åº”</span></span><br><span class="line">ServerResponse.created(URI.create(<span class="string">&quot;/api/users/&quot;</span> + id))</span><br><span class="line">    .bodyValue(user);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— å†…å®¹å“åº”</span></span><br><span class="line">ServerResponse.noContent().build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯å“åº”</span></span><br><span class="line">ServerResponse.notFound().build();</span><br><span class="line">ServerResponse.badRequest().bodyValue(<span class="string">&quot;Invalid request&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><h3 id="ä½¿ç”¨-ExceptionHandler"><a href="#ä½¿ç”¨-ExceptionHandler" class="headerlink" title="ä½¿ç”¨ @ExceptionHandler"></a>ä½¿ç”¨ @ExceptionHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(NotFoundException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ErrorResponse&gt; <span class="title function_">handleNotFound</span><span class="params">(NotFoundException ex)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(ex.getMessage()));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ErrorResponse&gt; <span class="title function_">handleException</span><span class="params">(Exception ex)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(<span class="string">&quot;Internal server error&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨-WebExceptionHandler"><a href="#ä½¿ç”¨-WebExceptionHandler" class="headerlink" title="ä½¿ç”¨ WebExceptionHandler"></a>ä½¿ç”¨ WebExceptionHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(-2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalWebExceptionHandler</span> <span class="keyword">implements</span> <span class="title class_">WebExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(ServerWebExchange exchange, Throwable ex)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> NotFoundException) &#123;</span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_FOUND);</span><br><span class="line">            <span class="comment">// å†™å…¥å“åº”ä½“...</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Mono.error(ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è¿‡æ»¤å™¨ï¼ˆWebFilterï¼‰"><a href="#è¿‡æ»¤å™¨ï¼ˆWebFilterï¼‰" class="headerlink" title="è¿‡æ»¤å™¨ï¼ˆWebFilterï¼‰"></a>è¿‡æ»¤å™¨ï¼ˆWebFilterï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingFilter</span> <span class="keyword">implements</span> <span class="title class_">WebFilter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, WebFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange)</span><br><span class="line">            .doFinally(signalType -&gt; &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">                log.info(<span class="string">&quot;Request &#123;&#125; &#123;&#125; completed in &#123;&#125;ms&quot;</span>,</span><br><span class="line">                    exchange.getRequest().getMethod(),</span><br><span class="line">                    exchange.getRequest().getPath(),</span><br><span class="line">                    duration);</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>ä¸Šä¸€ç¯‡ï¼šReactoræ ¸å¿ƒAPI</li>
<li>ä¸‹ä¸€ç¯‡ï¼šå‡½æ•°å¼ç«¯ç‚¹</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/Webflux%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/Webflux%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">Webfluxç®€ä»‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Webflux/" itemprop="url" rel="index"><span itemprop="name">Webflux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Webflux-ç®€ä»‹"><a href="#Webflux-ç®€ä»‹" class="headerlink" title="Webflux ç®€ä»‹"></a>Webflux ç®€ä»‹</h1><h2 id="ä»€ä¹ˆæ˜¯-Spring-WebFlux"><a href="#ä»€ä¹ˆæ˜¯-Spring-WebFlux" class="headerlink" title="ä»€ä¹ˆæ˜¯ Spring WebFlux"></a>ä»€ä¹ˆæ˜¯ Spring WebFlux</h2><p>Spring WebFlux æ˜¯ Spring Framework 5.0 å¼•å…¥çš„<strong>å“åº”å¼ Web æ¡†æ¶</strong>ï¼Œå®ƒæ˜¯ Spring MVC çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä¸“ä¸ºæ„å»º<strong>éé˜»å¡ã€å¼‚æ­¥</strong>çš„ Web åº”ç”¨ç¨‹åºè€Œè®¾è®¡ã€‚</p>
<h3 id="æ ¸å¿ƒç‰¹ç‚¹"><a href="#æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="æ ¸å¿ƒç‰¹ç‚¹"></a>æ ¸å¿ƒç‰¹ç‚¹</h3><ul>
<li><strong>éé˜»å¡ I&#x2F;O</strong>ï¼šåŸºäºäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ç­‰å¾… I&#x2F;O æ“ä½œå®Œæˆ</li>
<li><strong>å“åº”å¼ç¼–ç¨‹</strong>ï¼šåŸºäº Reactive Streams è§„èŒƒï¼Œä½¿ç”¨ Project Reactor ä½œä¸ºé»˜è®¤å®ç°</li>
<li><strong>èƒŒå‹æ”¯æŒ</strong>ï¼šæ”¯æŒèƒŒå‹ï¼ˆBackpressureï¼‰æœºåˆ¶ï¼Œé˜²æ­¢ç”Ÿäº§è€…å‹å®æ¶ˆè´¹è€…</li>
<li><strong>å‡½æ•°å¼ç¼–ç¨‹</strong>ï¼šæ”¯æŒå‡½æ•°å¼ç«¯ç‚¹å®šä¹‰ï¼Œæä¾›æ›´çµæ´»çš„è·¯ç”±æ–¹å¼</li>
</ul>
<h2 id="WebFlux-vs-Spring-MVC"><a href="#WebFlux-vs-Spring-MVC" class="headerlink" title="WebFlux vs Spring MVC"></a>WebFlux vs Spring MVC</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>Spring MVC</th>
<th>Spring WebFlux</th>
</tr>
</thead>
<tbody><tr>
<td>ç¼–ç¨‹æ¨¡å‹</td>
<td>å‘½ä»¤å¼ï¼ˆImperativeï¼‰</td>
<td>å“åº”å¼ï¼ˆReactiveï¼‰</td>
</tr>
<tr>
<td>çº¿ç¨‹æ¨¡å‹</td>
<td>æ¯è¯·æ±‚ä¸€çº¿ç¨‹</td>
<td>äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰</td>
</tr>
<tr>
<td>I&#x2F;O æ¨¡å‹</td>
<td>é˜»å¡ I&#x2F;O</td>
<td>éé˜»å¡ I&#x2F;O</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>ä¼ ç»Ÿ Web åº”ç”¨</td>
<td>é«˜å¹¶å‘ã€æµå¼æ•°æ®</td>
</tr>
<tr>
<td>Servlet ä¾èµ–</td>
<td>ä¾èµ– Servlet API</td>
<td>å¯é€‰ï¼ˆæ”¯æŒ Nettyï¼‰</td>
</tr>
<tr>
<td>æ•°æ®åº“æ”¯æŒ</td>
<td>JDBCï¼ˆé˜»å¡ï¼‰</td>
<td>R2DBCï¼ˆå“åº”å¼ï¼‰</td>
</tr>
</tbody></table>
<h2 id="ä½•æ—¶ä½¿ç”¨-WebFlux"><a href="#ä½•æ—¶ä½¿ç”¨-WebFlux" class="headerlink" title="ä½•æ—¶ä½¿ç”¨ WebFlux"></a>ä½•æ—¶ä½¿ç”¨ WebFlux</h2><h3 id="é€‚åˆä½¿ç”¨çš„åœºæ™¯"><a href="#é€‚åˆä½¿ç”¨çš„åœºæ™¯" class="headerlink" title="é€‚åˆä½¿ç”¨çš„åœºæ™¯"></a>é€‚åˆä½¿ç”¨çš„åœºæ™¯</h3><ol>
<li><strong>é«˜å¹¶å‘åº”ç”¨</strong>ï¼šéœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼ˆå¦‚èŠå¤©åº”ç”¨ã€å®æ—¶æ¨é€ï¼‰</li>
<li><strong>æµå¼æ•°æ®å¤„ç†</strong>ï¼šå¤„ç†å®æ—¶æ•°æ®æµï¼ˆå¦‚è‚¡ç¥¨è¡Œæƒ…ã€IoT æ•°æ®ï¼‰</li>
<li><strong>å¾®æœåŠ¡ç½‘å…³</strong>ï¼šä½œä¸º API ç½‘å…³å¤„ç†å¤§é‡è¯·æ±‚è½¬å‘</li>
<li><strong>æœåŠ¡é—´è°ƒç”¨å¯†é›†</strong>ï¼šéœ€è¦å¤§é‡è°ƒç”¨å¤–éƒ¨æœåŠ¡çš„åº”ç”¨</li>
</ol>
<h3 id="ä¸é€‚åˆçš„åœºæ™¯"><a href="#ä¸é€‚åˆçš„åœºæ™¯" class="headerlink" title="ä¸é€‚åˆçš„åœºæ™¯"></a>ä¸é€‚åˆçš„åœºæ™¯</h3><ol>
<li><strong>CPU å¯†é›†å‹ä»»åŠ¡</strong>ï¼šå“åº”å¼ç¼–ç¨‹å¯¹ CPU å¯†é›†å‹ä»»åŠ¡æ²¡æœ‰ä¼˜åŠ¿</li>
<li><strong>é˜»å¡ä¾èµ–</strong>ï¼šå¦‚æœä¾èµ–çš„åº“æ˜¯é˜»å¡çš„ï¼ˆå¦‚ä¼ ç»Ÿ JDBCï¼‰ï¼Œåˆ™æ— æ³•å‘æŒ¥ä¼˜åŠ¿</li>
<li><strong>å›¢é˜Ÿä¸ç†Ÿæ‚‰å“åº”å¼ç¼–ç¨‹</strong>ï¼šå­¦ä¹ æ›²çº¿è¾ƒé™¡</li>
</ol>
<h2 id="æŠ€æœ¯æ ˆå¯¹æ¯”"><a href="#æŠ€æœ¯æ ˆå¯¹æ¯”" class="headerlink" title="æŠ€æœ¯æ ˆå¯¹æ¯”"></a>æŠ€æœ¯æ ˆå¯¹æ¯”</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                    Spring Boot                          â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚     Spring MVC         â”‚        Spring WebFlux          â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚     Servlet API        â”‚     Reactive Streams API       â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  Tomcat/Jetty/Undertow â”‚      Netty/Undertow/Servlet    â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><h3 id="Maven-ä¾èµ–"><a href="#Maven-ä¾èµ–" class="headerlink" title="Maven ä¾èµ–"></a>Maven ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;String&gt; <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="string">&quot;Hello, WebFlux!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/users&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">getUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>ä¸‹ä¸€ç¯‡ï¼šå“åº”å¼ç¼–ç¨‹åŸºç¡€</li>
<li>Reactoræ ¸å¿ƒAPI</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">å“åº”å¼ç¼–ç¨‹åŸºç¡€</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Webflux/" itemprop="url" rel="index"><span itemprop="name">Webflux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="å“åº”å¼ç¼–ç¨‹åŸºç¡€"><a href="#å“åº”å¼ç¼–ç¨‹åŸºç¡€" class="headerlink" title="å“åº”å¼ç¼–ç¨‹åŸºç¡€"></a>å“åº”å¼ç¼–ç¨‹åŸºç¡€</h1><h2 id="ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹"><a href="#ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹" class="headerlink" title="ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹"></a>ä»€ä¹ˆæ˜¯å“åº”å¼ç¼–ç¨‹</h2><p>å“åº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰æ˜¯ä¸€ç§<strong>é¢å‘æ•°æ®æµå’Œå˜åŒ–ä¼ æ’­</strong>çš„ç¼–ç¨‹èŒƒå¼ã€‚å®ƒå…³æ³¨çš„æ˜¯æ•°æ®æµçš„å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨ã€‚</p>
<h3 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h3><ul>
<li><strong>æ•°æ®æµï¼ˆStreamï¼‰</strong>ï¼šæ•°æ®ä»¥æµçš„å½¢å¼ä¼ é€’ï¼Œè€Œéä¸€æ¬¡æ€§è¿”å›</li>
<li><strong>å¼‚æ­¥ï¼ˆAsynchronousï¼‰</strong>ï¼šæ“ä½œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹</li>
<li><strong>éé˜»å¡ï¼ˆNon-blockingï¼‰</strong>ï¼šçº¿ç¨‹ä¸ä¼šç­‰å¾… I&#x2F;O æ“ä½œå®Œæˆ</li>
<li><strong>èƒŒå‹ï¼ˆBackpressureï¼‰</strong>ï¼šæ¶ˆè´¹è€…å¯ä»¥æ§åˆ¶ç”Ÿäº§è€…çš„æ•°æ®å‘é€é€Ÿç‡</li>
</ul>
<h2 id="Reactive-Streams-è§„èŒƒ"><a href="#Reactive-Streams-è§„èŒƒ" class="headerlink" title="Reactive Streams è§„èŒƒ"></a>Reactive Streams è§„èŒƒ</h2><p>Reactive Streams æ˜¯ JVM ä¸Šå“åº”å¼ç¼–ç¨‹çš„æ ‡å‡†è§„èŒƒï¼Œå®šä¹‰äº†å››ä¸ªæ ¸å¿ƒæ¥å£ï¼š</p>
<h3 id="1-Publisherï¼ˆå‘å¸ƒè€…ï¼‰"><a href="#1-Publisherï¼ˆå‘å¸ƒè€…ï¼‰" class="headerlink" title="1. Publisherï¼ˆå‘å¸ƒè€…ï¼‰"></a>1. Publisherï¼ˆå‘å¸ƒè€…ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Publisher</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(Subscriber&lt;? <span class="built_in">super</span> T&gt; s)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ•°æ®çš„ç”Ÿäº§è€…</li>
<li>å¯ä»¥å‘å¸ƒæ— é™æˆ–æœ‰é™æ•°é‡çš„å…ƒç´ </li>
</ul>
<h3 id="2-Subscriberï¼ˆè®¢é˜…è€…ï¼‰"><a href="#2-Subscriberï¼ˆè®¢é˜…è€…ï¼‰" class="headerlink" title="2. Subscriberï¼ˆè®¢é˜…è€…ï¼‰"></a>2. Subscriberï¼ˆè®¢é˜…è€…ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subscriber</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onSubscribe</span><span class="params">(Subscription s)</span>;  <span class="comment">// è®¢é˜…æˆåŠŸæ—¶è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onNext</span><span class="params">(T t)</span>;                   <span class="comment">// æ¥æ”¶åˆ°æ–°å…ƒç´ æ—¶è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Throwable t)</span>;          <span class="comment">// å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onComplete</span><span class="params">()</span>;                  <span class="comment">// æ•°æ®æµç»“æŸæ—¶è°ƒç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ•°æ®çš„æ¶ˆè´¹è€…</li>
<li>é€šè¿‡å›è°ƒæ–¹æ³•æ¥æ”¶æ•°æ®å’Œäº‹ä»¶</li>
</ul>
<h3 id="3-Subscriptionï¼ˆè®¢é˜…å…³ç³»ï¼‰"><a href="#3-Subscriptionï¼ˆè®¢é˜…å…³ç³»ï¼‰" class="headerlink" title="3. Subscriptionï¼ˆè®¢é˜…å…³ç³»ï¼‰"></a>3. Subscriptionï¼ˆè®¢é˜…å…³ç³»ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subscription</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">request</span><span class="params">(<span class="type">long</span> n)</span>;  <span class="comment">// è¯·æ±‚ n ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">()</span>;         <span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¡¨ç¤º Publisher å’Œ Subscriber ä¹‹é—´çš„è®¢é˜…å…³ç³»</li>
<li><strong>èƒŒå‹çš„æ ¸å¿ƒ</strong>ï¼šé€šè¿‡ <code>request(n)</code> æ§åˆ¶æ•°æ®æµé€Ÿ</li>
</ul>
<h3 id="4-Processorï¼ˆå¤„ç†å™¨ï¼‰"><a href="#4-Processorï¼ˆå¤„ç†å™¨ï¼‰" class="headerlink" title="4. Processorï¼ˆå¤„ç†å™¨ï¼‰"></a>4. Processorï¼ˆå¤„ç†å™¨ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Processor</span>&lt;T, R&gt; <span class="keyword">extends</span> <span class="title class_">Subscriber</span>&lt;T&gt;, Publisher&lt;R&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ—¢æ˜¯è®¢é˜…è€…åˆæ˜¯å‘å¸ƒè€…</li>
<li>ç”¨äºæ•°æ®è½¬æ¢å’Œå¤„ç†</li>
</ul>
<h2 id="æ•°æ®æµç”Ÿå‘½å‘¨æœŸ"><a href="#æ•°æ®æµç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ•°æ®æµç”Ÿå‘½å‘¨æœŸ"></a>æ•°æ®æµç”Ÿå‘½å‘¨æœŸ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     subscribe()      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚   Publisher  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚  Subscriber  â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚         onSubscribe(subscription)   â”‚</span><br><span class="line">       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚         request(n)                  â”‚</span><br><span class="line">       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚         onNext(data) Ã— n            â”‚</span><br><span class="line">       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="line">       â”‚                                     â”‚</span><br><span class="line">       â”‚         onComplete() / onError()    â”‚</span><br><span class="line">       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚</span><br><span class="line">       â–¼                                     â–¼</span><br></pre></td></tr></table></figure>

<h2 id="èƒŒå‹ï¼ˆBackpressureï¼‰"><a href="#èƒŒå‹ï¼ˆBackpressureï¼‰" class="headerlink" title="èƒŒå‹ï¼ˆBackpressureï¼‰"></a>èƒŒå‹ï¼ˆBackpressureï¼‰</h2><p>èƒŒå‹æ˜¯å“åº”å¼ç¼–ç¨‹ä¸­çš„é‡è¦æ¦‚å¿µï¼Œç”¨äºè§£å†³<strong>ç”Ÿäº§è€…é€Ÿåº¦å¿«äºæ¶ˆè´¹è€…</strong>çš„é—®é¢˜ã€‚</p>
<h3 id="èƒŒå‹ç­–ç•¥"><a href="#èƒŒå‹ç­–ç•¥" class="headerlink" title="èƒŒå‹ç­–ç•¥"></a>èƒŒå‹ç­–ç•¥</h3><table>
<thead>
<tr>
<th>ç­–ç•¥</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Buffer</strong></td>
<td>ç¼“å­˜æ‰€æœ‰å…ƒç´ ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º</td>
</tr>
<tr>
<td><strong>Drop</strong></td>
<td>ä¸¢å¼ƒæ— æ³•å¤„ç†çš„å…ƒç´ </td>
</tr>
<tr>
<td><strong>Latest</strong></td>
<td>åªä¿ç•™æœ€æ–°çš„å…ƒç´ </td>
</tr>
<tr>
<td><strong>Error</strong></td>
<td>æŠ›å‡ºå¼‚å¸¸</td>
</tr>
</tbody></table>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    .onBackpressureBuffer(<span class="number">100</span>)      <span class="comment">// ç¼“å­˜100ä¸ªå…ƒç´ </span></span><br><span class="line">    .onBackpressureDrop()           <span class="comment">// ä¸¢å¼ƒå¤šä½™å…ƒç´ </span></span><br><span class="line">    .onBackpressureLatest()         <span class="comment">// åªä¿ç•™æœ€æ–°</span></span><br><span class="line">    .subscribe(data -&gt; &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ•°æ®</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿"><a href="#å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿" class="headerlink" title="å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿"></a>å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿</h2><ol>
<li><strong>èµ„æºåˆ©ç”¨ç‡é«˜</strong>ï¼šå°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡è¯·æ±‚</li>
<li><strong>å“åº”æ€§å¥½</strong>ï¼šä¸ä¼šå› ä¸ºæŸä¸ªæ“ä½œé˜»å¡æ•´ä¸ªç³»ç»Ÿ</li>
<li><strong>å¼¹æ€§</strong>ï¼šæ›´å®¹æ˜“å¤„ç†é”™è¯¯å’Œæ•…éšœ</li>
<li><strong>å¯ç»„åˆæ€§</strong>ï¼šæ“ä½œç¬¦å¯ä»¥çµæ´»ç»„åˆ</li>
</ol>
<h2 id="å“åº”å¼ç¼–ç¨‹çš„æŒ‘æˆ˜"><a href="#å“åº”å¼ç¼–ç¨‹çš„æŒ‘æˆ˜" class="headerlink" title="å“åº”å¼ç¼–ç¨‹çš„æŒ‘æˆ˜"></a>å“åº”å¼ç¼–ç¨‹çš„æŒ‘æˆ˜</h2><ol>
<li><strong>è°ƒè¯•å›°éš¾</strong>ï¼šå¼‚æ­¥ä»£ç çš„å †æ ˆè·Ÿè¸ªä¸ç›´è§‚</li>
<li><strong>å­¦ä¹ æ›²çº¿</strong>ï¼šéœ€è¦è½¬å˜æ€ç»´æ–¹å¼</li>
<li><strong>ç”Ÿæ€é™åˆ¶</strong>ï¼šéœ€è¦æ•´ä¸ªè°ƒç”¨é“¾éƒ½æ˜¯å“åº”å¼çš„</li>
</ol>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>ä¸Šä¸€ç¯‡ï¼šWebfluxç®€ä»‹</li>
<li>ä¸‹ä¸€ç¯‡ï¼šReactoræ ¸å¿ƒAPI</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%AB%AF%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%AB%AF%E7%82%B9/" class="post-title-link" itemprop="url">å‡½æ•°å¼ç«¯ç‚¹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Webflux/" itemprop="url" rel="index"><span itemprop="name">Webflux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="å‡½æ•°å¼ç«¯ç‚¹"><a href="#å‡½æ•°å¼ç«¯ç‚¹" class="headerlink" title="å‡½æ•°å¼ç«¯ç‚¹"></a>å‡½æ•°å¼ç«¯ç‚¹</h1><h2 id="ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç«¯ç‚¹"><a href="#ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç«¯ç‚¹" class="headerlink" title="ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç«¯ç‚¹"></a>ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç«¯ç‚¹</h2><p>å‡½æ•°å¼ç«¯ç‚¹ï¼ˆFunctional Endpointsï¼‰æ˜¯ WebFlux æä¾›çš„å¦ä¸€ç§ç¼–ç¨‹æ¨¡å‹ï¼Œä½¿ç”¨<strong>å‡½æ•°å¼é£æ ¼</strong>å®šä¹‰è·¯ç”±å’Œå¤„ç†å™¨ï¼Œç›¸æ¯”æ³¨è§£å¼æ›´åŠ çµæ´»ã€‚</p>
<h3 id="æ ¸å¿ƒç»„ä»¶"><a href="#æ ¸å¿ƒç»„ä»¶" class="headerlink" title="æ ¸å¿ƒç»„ä»¶"></a>æ ¸å¿ƒç»„ä»¶</h3><ul>
<li><strong>HandlerFunction</strong>ï¼šå¤„ç†è¯·æ±‚çš„å‡½æ•°ï¼Œç±»ä¼¼äº <code>@RequestMapping</code> æ–¹æ³•</li>
<li><strong>RouterFunction</strong>ï¼šè·¯ç”±å‡½æ•°ï¼Œå°†è¯·æ±‚æ˜ å°„åˆ° HandlerFunction</li>
</ul>
<h2 id="HandlerFunction"><a href="#HandlerFunction" class="headerlink" title="HandlerFunction"></a>HandlerFunction</h2><p><code>HandlerFunction&lt;T extends ServerResponse&gt;</code> æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HandlerFunction</span>&lt;T <span class="keyword">extends</span> <span class="title class_">ServerResponse</span>&gt; &#123;</span><br><span class="line">    Mono&lt;T&gt; <span class="title function_">handle</span><span class="params">(ServerRequest request)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®šä¹‰-Handler"><a href="#å®šä¹‰-Handler" class="headerlink" title="å®šä¹‰ Handler"></a>å®šä¹‰ Handler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserHandler</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">getAllUsers</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok()</span><br><span class="line">            .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">            .body(userService.findAll(), User.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">getUserById</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> request.pathVariable(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> userService.findById(id)</span><br><span class="line">            .flatMap(user -&gt; ServerResponse.ok()</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .bodyValue(user))</span><br><span class="line">            .switchIfEmpty(ServerResponse.notFound().build());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">createUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request.bodyToMono(User.class)</span><br><span class="line">            .flatMap(userService::save)</span><br><span class="line">            .flatMap(user -&gt; ServerResponse</span><br><span class="line">                .created(URI.create(<span class="string">&quot;/api/users/&quot;</span> + user.getId()))</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .bodyValue(user));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">updateUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> request.pathVariable(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> request.bodyToMono(User.class)</span><br><span class="line">            .flatMap(user -&gt; userService.update(id, user))</span><br><span class="line">            .flatMap(user -&gt; ServerResponse.ok()</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .bodyValue(user))</span><br><span class="line">            .switchIfEmpty(ServerResponse.notFound().build());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">deleteUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> request.pathVariable(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> userService.deleteById(id)</span><br><span class="line">            .then(ServerResponse.noContent().build());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="RouterFunction"><a href="#RouterFunction" class="headerlink" title="RouterFunction"></a>RouterFunction</h2><p><code>RouterFunction&lt;T extends ServerResponse&gt;</code> ç”¨äºå®šä¹‰è·¯ç”±è§„åˆ™ã€‚</p>
<h3 id="åŸºæœ¬è·¯ç”±å®šä¹‰"><a href="#åŸºæœ¬è·¯ç”±å®šä¹‰" class="headerlink" title="åŸºæœ¬è·¯ç”±å®šä¹‰"></a>åŸºæœ¬è·¯ç”±å®šä¹‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RouterConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">userRoutes</span><span class="params">(UserHandler handler)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RouterFunctions.route()</span><br><span class="line">            .GET(<span class="string">&quot;/api/users&quot;</span>, handler::getAllUsers)</span><br><span class="line">            .GET(<span class="string">&quot;/api/users/&#123;id&#125;&quot;</span>, handler::getUserById)</span><br><span class="line">            .POST(<span class="string">&quot;/api/users&quot;</span>, handler::createUser)</span><br><span class="line">            .PUT(<span class="string">&quot;/api/users/&#123;id&#125;&quot;</span>, handler::updateUser)</span><br><span class="line">            .DELETE(<span class="string">&quot;/api/users/&#123;id&#125;&quot;</span>, handler::deleteUser)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨-nest-ç»„ç»‡è·¯ç”±"><a href="#ä½¿ç”¨-nest-ç»„ç»‡è·¯ç”±" class="headerlink" title="ä½¿ç”¨ nest ç»„ç»‡è·¯ç”±"></a>ä½¿ç”¨ nest ç»„ç»‡è·¯ç”±</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">routes</span><span class="params">(UserHandler userHandler, </span></span><br><span class="line"><span class="params">                                              OrderHandler orderHandler)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> RouterFunctions.route()</span><br><span class="line">        .nest(path(<span class="string">&quot;/api/users&quot;</span>), builder -&gt; builder</span><br><span class="line">            .GET(<span class="string">&quot;&quot;</span>, userHandler::getAllUsers)</span><br><span class="line">            .GET(<span class="string">&quot;/&#123;id&#125;&quot;</span>, userHandler::getUserById)</span><br><span class="line">            .POST(<span class="string">&quot;&quot;</span>, userHandler::createUser)</span><br><span class="line">            .PUT(<span class="string">&quot;/&#123;id&#125;&quot;</span>, userHandler::updateUser)</span><br><span class="line">            .DELETE(<span class="string">&quot;/&#123;id&#125;&quot;</span>, userHandler::deleteUser)</span><br><span class="line">        )</span><br><span class="line">        .nest(path(<span class="string">&quot;/api/orders&quot;</span>), builder -&gt; builder</span><br><span class="line">            .GET(<span class="string">&quot;&quot;</span>, orderHandler::getAllOrders)</span><br><span class="line">            .GET(<span class="string">&quot;/&#123;id&#125;&quot;</span>, orderHandler::getOrderById)</span><br><span class="line">            .POST(<span class="string">&quot;&quot;</span>, orderHandler::createOrder)</span><br><span class="line">        )</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ·»åŠ è¿‡æ»¤å™¨"><a href="#æ·»åŠ è¿‡æ»¤å™¨" class="headerlink" title="æ·»åŠ è¿‡æ»¤å™¨"></a>æ·»åŠ è¿‡æ»¤å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">routes</span><span class="params">(UserHandler handler)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> RouterFunctions.route()</span><br><span class="line">        .GET(<span class="string">&quot;/api/users&quot;</span>, handler::getAllUsers)</span><br><span class="line">        .GET(<span class="string">&quot;/api/users/&#123;id&#125;&quot;</span>, handler::getUserById)</span><br><span class="line">        .filter((request, next) -&gt; &#123;</span><br><span class="line">            <span class="comment">// å‰ç½®å¤„ç†</span></span><br><span class="line">            log.info(<span class="string">&quot;Request: &#123;&#125; &#123;&#125;&quot;</span>, request.method(), request.path());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> next.handle(request)</span><br><span class="line">                .doOnNext(response -&gt; &#123;</span><br><span class="line">                    <span class="comment">// åç½®å¤„ç†</span></span><br><span class="line">                    log.info(<span class="string">&quot;Response status: &#123;&#125;&quot;</span>, response.statusCode());</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ¡ä»¶è·¯ç”±"><a href="#æ¡ä»¶è·¯ç”±" class="headerlink" title="æ¡ä»¶è·¯ç”±"></a>æ¡ä»¶è·¯ç”±</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">routes</span><span class="params">(UserHandler handler)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> RouterFunctions.route()</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ RequestPredicate è¿›è¡Œæ¡ä»¶åŒ¹é…</span></span><br><span class="line">        .route(GET(<span class="string">&quot;/api/users&quot;</span>).and(accept(MediaType.APPLICATION_JSON)), </span><br><span class="line">               handler::getAllUsers)</span><br><span class="line">        .route(GET(<span class="string">&quot;/api/users&quot;</span>).and(accept(MediaType.TEXT_EVENT_STREAM)), </span><br><span class="line">               handler::streamUsers)</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="RequestPredicate"><a href="#RequestPredicate" class="headerlink" title="RequestPredicate"></a>RequestPredicate</h2><p><code>RequestPredicate</code> ç”¨äºå®šä¹‰è¯·æ±‚åŒ¹é…æ¡ä»¶ã€‚</p>
<h3 id="å¸¸ç”¨è°“è¯"><a href="#å¸¸ç”¨è°“è¯" class="headerlink" title="å¸¸ç”¨è°“è¯"></a>å¸¸ç”¨è°“è¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.springframework.web.reactive.function.server.RequestPredicates.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HTTP æ–¹æ³•</span></span><br><span class="line">GET(<span class="string">&quot;/path&quot;</span>)</span><br><span class="line">POST(<span class="string">&quot;/path&quot;</span>)</span><br><span class="line">PUT(<span class="string">&quot;/path&quot;</span>)</span><br><span class="line">DELETE(<span class="string">&quot;/path&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…å®¹ç±»å‹</span></span><br><span class="line">accept(MediaType.APPLICATION_JSON)</span><br><span class="line">contentType(MediaType.APPLICATION_JSON)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯å¾„åŒ¹é…</span></span><br><span class="line">path(<span class="string">&quot;/api/**&quot;</span>)</span><br><span class="line">pathExtension(<span class="string">&quot;json&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢å‚æ•°</span></span><br><span class="line">queryParam(<span class="string">&quot;name&quot;</span>, value -&gt; value.length() &gt; <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚å¤´</span></span><br><span class="line">headers(headers -&gt; headers.header(<span class="string">&quot;X-Custom&quot;</span>).isPresent())</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»„åˆæ¡ä»¶</span></span><br><span class="line">GET(<span class="string">&quot;/api/users&quot;</span>).and(accept(MediaType.APPLICATION_JSON))</span><br><span class="line">GET(<span class="string">&quot;/api/users&quot;</span>).or(GET(<span class="string">&quot;/users&quot;</span>))</span><br></pre></td></tr></table></figure>

<h2 id="è¯·æ±‚éªŒè¯"><a href="#è¯·æ±‚éªŒè¯" class="headerlink" title="è¯·æ±‚éªŒè¯"></a>è¯·æ±‚éªŒè¯</h2><h3 id="æ‰‹åŠ¨éªŒè¯"><a href="#æ‰‹åŠ¨éªŒè¯" class="headerlink" title="æ‰‹åŠ¨éªŒè¯"></a>æ‰‹åŠ¨éªŒè¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">createUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request.bodyToMono(User.class)</span><br><span class="line">        .flatMap(user -&gt; &#123;</span><br><span class="line">            <span class="comment">// éªŒè¯</span></span><br><span class="line">            List&lt;String&gt; errors = validate(user);</span><br><span class="line">            <span class="keyword">if</span> (!errors.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> ServerResponse.badRequest()</span><br><span class="line">                    .bodyValue(<span class="keyword">new</span> <span class="title class_">ValidationError</span>(errors));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> userService.save(user)</span><br><span class="line">                .flatMap(saved -&gt; ServerResponse.created(</span><br><span class="line">                    URI.create(<span class="string">&quot;/api/users/&quot;</span> + saved.getId()))</span><br><span class="line">                    .bodyValue(saved));</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;String&gt; <span class="title function_">validate</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    List&lt;String&gt; errors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (user.getName() == <span class="literal">null</span> || user.getName().isBlank()) &#123;</span><br><span class="line">        errors.add(<span class="string">&quot;Name is required&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (user.getEmail() == <span class="literal">null</span> || !user.getEmail().contains(<span class="string">&quot;@&quot;</span>)) &#123;</span><br><span class="line">        errors.add(<span class="string">&quot;Valid email is required&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> errors;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨-Validator"><a href="#ä½¿ç”¨-Validator" class="headerlink" title="ä½¿ç”¨ Validator"></a>ä½¿ç”¨ Validator</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Validator validator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">createUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> request.bodyToMono(User.class)</span><br><span class="line">            .flatMap(user -&gt; &#123;</span><br><span class="line">                <span class="type">Errors</span> <span class="variable">errors</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanPropertyBindingResult</span>(user, <span class="string">&quot;user&quot;</span>);</span><br><span class="line">                validator.validate(user, errors);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ServerResponse.badRequest()</span><br><span class="line">                        .bodyValue(errors.getAllErrors());</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> userService.save(user)</span><br><span class="line">                    .flatMap(saved -&gt; ServerResponse.created(</span><br><span class="line">                        URI.create(<span class="string">&quot;/api/users/&quot;</span> + saved.getId()))</span><br><span class="line">                        .bodyValue(saved));</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">routes</span><span class="params">(UserHandler handler)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> RouterFunctions.route()</span><br><span class="line">        .GET(<span class="string">&quot;/api/users/&#123;id&#125;&quot;</span>, handler::getUserById)</span><br><span class="line">        .onError(NotFoundException.class, (e, request) -&gt; </span><br><span class="line">            ServerResponse.notFound().build())</span><br><span class="line">        .onError(ValidationException.class, (e, request) -&gt; </span><br><span class="line">            ServerResponse.badRequest().bodyValue(e.getMessage()))</span><br><span class="line">        .onError(Exception.class, (e, request) -&gt; </span><br><span class="line">            ServerResponse.status(HttpStatus.INTERNAL_SERVER_ERROR)</span><br><span class="line">                .bodyValue(<span class="string">&quot;Internal server error&quot;</span>))</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‡½æ•°å¼-vs-æ³¨è§£å¼"><a href="#å‡½æ•°å¼-vs-æ³¨è§£å¼" class="headerlink" title="å‡½æ•°å¼ vs æ³¨è§£å¼"></a>å‡½æ•°å¼ vs æ³¨è§£å¼</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æ³¨è§£å¼</th>
<th>å‡½æ•°å¼</th>
</tr>
</thead>
<tbody><tr>
<td>ä»£ç é£æ ¼</td>
<td>å£°æ˜å¼</td>
<td>å‡½æ•°å¼</td>
</tr>
<tr>
<td>è·¯ç”±å®šä¹‰</td>
<td>åˆ†æ•£åœ¨å„ä¸ªæ–¹æ³•</td>
<td>é›†ä¸­åœ¨ä¸€å¤„</td>
</tr>
<tr>
<td>çµæ´»æ€§</td>
<td>è¾ƒä½</td>
<td>è¾ƒé«˜</td>
</tr>
<tr>
<td>å­¦ä¹ æ›²çº¿</td>
<td>è¾ƒä½</td>
<td>è¾ƒé«˜</td>
</tr>
<tr>
<td>æµ‹è¯•</td>
<td>éœ€è¦ Spring ä¸Šä¸‹æ–‡</td>
<td>å¯ä»¥å•å…ƒæµ‹è¯•</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>ä¼ ç»Ÿ CRUD</td>
<td>å¤æ‚è·¯ç”±é€»è¾‘</td>
</tr>
</tbody></table>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>ä¸Šä¸€ç¯‡ï¼šWebFluxæ ¸å¿ƒç»„ä»¶</li>
<li>ä¸‹ä¸€ç¯‡ï¼šå®æˆ˜æ¡ˆä¾‹</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B/" class="post-title-link" itemprop="url">å®æˆ˜æ¡ˆä¾‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Webflux/" itemprop="url" rel="index"><span itemprop="name">Webflux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="å®æˆ˜æ¡ˆä¾‹"><a href="#å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="å®æˆ˜æ¡ˆä¾‹"></a>å®æˆ˜æ¡ˆä¾‹</h1><h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">webflux-demo/</span><br><span class="line">â”œâ”€â”€ src/main/java/com/example/demo/</span><br><span class="line">â”‚   â”œâ”€â”€ DemoApplication.java</span><br><span class="line">â”‚   â”œâ”€â”€ config/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ RouterConfig.java</span><br><span class="line">â”‚   â”œâ”€â”€ controller/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ UserController.java</span><br><span class="line">â”‚   â”œâ”€â”€ handler/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ UserHandler.java</span><br><span class="line">â”‚   â”œâ”€â”€ model/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ User.java</span><br><span class="line">â”‚   â”œâ”€â”€ repository/</span><br><span class="line">â”‚   â”‚   â””â”€â”€ UserRepository.java</span><br><span class="line">â”‚   â””â”€â”€ service/</span><br><span class="line">â”‚       â””â”€â”€ UserService.java</span><br><span class="line">â”œâ”€â”€ src/main/resources/</span><br><span class="line">â”‚   â””â”€â”€ application.yml</span><br><span class="line">â””â”€â”€ pom.xml</span><br></pre></td></tr></table></figure>

<h2 id="Maven-ä¾èµ–"><a href="#Maven-ä¾èµ–" class="headerlink" title="Maven ä¾èµ–"></a>Maven ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 </span></span></span><br><span class="line"><span class="string"><span class="tag">         http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webflux-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- WebFlux --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- R2DBC (å“åº”å¼æ•°æ®åº“) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-r2dbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- H2 æ•°æ®åº“ (å¼€å‘æµ‹è¯•ç”¨) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.r2dbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>r2dbc-h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- Lombok --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- æµ‹è¯• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.projectreactor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reactor-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.relational.core.mapping.Table;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Table(&quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updatedAt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.model.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.r2dbc.repository.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.reactive.ReactiveCrudRepository;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">ReactiveCrudRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    Mono&lt;User&gt; <span class="title function_">findByEmail</span><span class="params">(String email)</span>;</span><br><span class="line">    </span><br><span class="line">    Flux&lt;User&gt; <span class="title function_">findByNameContaining</span><span class="params">(String name)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT * FROM users WHERE created_at &gt; :since&quot;)</span></span><br><span class="line">    Flux&lt;User&gt; <span class="title function_">findRecentUsers</span><span class="params">(LocalDateTime since)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.model.User;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.repository.UserRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">findById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">findByEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findByEmail(email);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">save</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        user.setCreatedAt(LocalDateTime.now());</span><br><span class="line">        user.setUpdatedAt(LocalDateTime.now());</span><br><span class="line">        <span class="keyword">return</span> userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">update</span><span class="params">(Long id, User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findById(id)</span><br><span class="line">            .flatMap(existingUser -&gt; &#123;</span><br><span class="line">                existingUser.setName(user.getName());</span><br><span class="line">                existingUser.setEmail(user.getEmail());</span><br><span class="line">                existingUser.setUpdatedAt(LocalDateTime.now());</span><br><span class="line">                <span class="keyword">return</span> userRepository.save(existingUser);</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">deleteById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Controllerï¼ˆæ³¨è§£å¼ï¼‰"><a href="#Controllerï¼ˆæ³¨è§£å¼ï¼‰" class="headerlink" title="Controllerï¼ˆæ³¨è§£å¼ï¼‰"></a>Controllerï¼ˆæ³¨è§£å¼ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.model.User;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.service.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.CREATED)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">createUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.update(id, user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.NO_CONTENT)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// SSE æµå¼å“åº”ç¤ºä¾‹</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/stream&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">streamUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findAll()</span><br><span class="line">            .delayElements(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">r2dbc:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">r2dbc:h2:mem:///testdb</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">sa</span></span><br><span class="line">    <span class="attr">password:</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">sql:</span></span><br><span class="line">    <span class="attr">init:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">always</span></span><br><span class="line">      <span class="attr">schema-locations:</span> <span class="string">classpath:schema.sql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org.springframework.r2dbc:</span> <span class="string">DEBUG</span></span><br></pre></td></tr></table></figure>

<h2 id="æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬"><a href="#æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬" class="headerlink" title="æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬"></a>æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- schema.sql</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> users (</span><br><span class="line">    id <span class="type">BIGINT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    updated_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name, email) <span class="keyword">VALUES</span> (<span class="string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="string">&#x27;zhangsan@example.com&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> users (name, email) <span class="keyword">VALUES</span> (<span class="string">&#x27;æå››&#x27;</span>, <span class="string">&#x27;lisi@example.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="WebClient-è°ƒç”¨ç¤ºä¾‹"><a href="#WebClient-è°ƒç”¨ç¤ºä¾‹" class="headerlink" title="WebClient è°ƒç”¨ç¤ºä¾‹"></a>WebClient è°ƒç”¨ç¤ºä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.model.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.reactive.function.client.WebClient;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Flux;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient webClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserClient</span><span class="params">(WebClient.Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.webClient = builder</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://localhost:8080/api&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Flux&lt;User&gt; <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient.get()</span><br><span class="line">            .uri(<span class="string">&quot;/users&quot;</span>)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToFlux(User.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient.get()</span><br><span class="line">            .uri(<span class="string">&quot;/users/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(User.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">createUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> webClient.post()</span><br><span class="line">            .uri(<span class="string">&quot;/users&quot;</span>)</span><br><span class="line">            .bodyValue(user)</span><br><span class="line">            .retrieve()</span><br><span class="line">            .bodyToMono(User.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.model.User;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.autoconfigure.web.reactive.AutoConfigureWebTestClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.web.reactive.server.WebTestClient;</span><br><span class="line"><span class="keyword">import</span> reactor.test.StepVerifier;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureWebTestClient</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserControllerTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebTestClient webTestClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getAllUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        webTestClient.get()</span><br><span class="line">            .uri(<span class="string">&quot;/api/users&quot;</span>)</span><br><span class="line">            .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBodyList(User.class)</span><br><span class="line">            .hasSize(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getUserById</span><span class="params">()</span> &#123;</span><br><span class="line">        webTestClient.get()</span><br><span class="line">            .uri(<span class="string">&quot;/api/users/1&quot;</span>)</span><br><span class="line">            .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isOk()</span><br><span class="line">            .expectBody()</span><br><span class="line">            .jsonPath(<span class="string">&quot;$.name&quot;</span>).isEqualTo(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">newUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        newUser.setName(<span class="string">&quot;ç‹äº”&quot;</span>);</span><br><span class="line">        newUser.setEmail(<span class="string">&quot;wangwu@example.com&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        webTestClient.post()</span><br><span class="line">            .uri(<span class="string">&quot;/api/users&quot;</span>)</span><br><span class="line">            .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">            .bodyValue(newUser)</span><br><span class="line">            .exchange()</span><br><span class="line">            .expectStatus().isCreated()</span><br><span class="line">            .expectBody()</span><br><span class="line">            .jsonPath(<span class="string">&quot;$.name&quot;</span>).isEqualTo(<span class="string">&quot;ç‹äº”&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testServiceWithStepVerifier</span><span class="params">()</span> &#123;</span><br><span class="line">        StepVerifier.create(userService.findAll())</span><br><span class="line">            .expectNextCount(<span class="number">2</span>)</span><br><span class="line">            .verifyComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2><ol>
<li><strong>åˆç†ä½¿ç”¨è°ƒåº¦å™¨</strong>ï¼šI&#x2F;O æ“ä½œä½¿ç”¨ <code>boundedElastic</code>ï¼ŒCPU å¯†é›†å‹ä½¿ç”¨ <code>parallel</code></li>
<li><strong>é¿å…é˜»å¡è°ƒç”¨</strong>ï¼šç¡®ä¿æ•´ä¸ªè°ƒç”¨é“¾éƒ½æ˜¯éé˜»å¡çš„</li>
<li><strong>ä½¿ç”¨è¿æ¥æ± </strong>ï¼šé…ç½®åˆé€‚çš„æ•°æ®åº“è¿æ¥æ± å¤§å°</li>
<li><strong>å¯ç”¨å‹ç¼©</strong>ï¼šå¯¹å“åº”æ•°æ®å¯ç”¨ Gzip å‹ç¼©</li>
<li><strong>ç›‘æ§æŒ‡æ ‡</strong>ï¼šé›†æˆ Micrometer ç›‘æ§å“åº”æ—¶é—´å’Œååé‡</li>
</ol>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>ä¸Šä¸€ç¯‡ï¼šå‡½æ•°å¼ç«¯ç‚¹</li>
<li>è¿”å›ï¼šWebfluxç®€ä»‹</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">æºç è§£æ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Reactive-Streams/" itemprop="url" rel="index"><span itemprop="name">Reactive Streams</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="æºç è§£æ"><a href="#æºç è§£æ" class="headerlink" title="æºç è§£æ"></a>æºç è§£æ</h1><h2 id="Mono-just-æºç åˆ†æ"><a href="#Mono-just-æºç åˆ†æ" class="headerlink" title="Mono.just() æºç åˆ†æ"></a>Mono.just() æºç åˆ†æ</h2><p>ä»æœ€ç®€å•çš„ <code>Mono.just()</code> å¼€å§‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mono.just(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<h3 id="1-åˆ›å»º-Mono"><a href="#1-åˆ›å»º-Mono" class="headerlink" title="1. åˆ›å»º Mono"></a>1. åˆ›å»º Mono</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mono.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Mono&lt;T&gt; <span class="title function_">just</span><span class="params">(T data)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> onAssembly(<span class="keyword">new</span> <span class="title class_">MonoJust</span>&lt;&gt;(data));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MonoJust.java - æŒæœ‰æ•°æ®çš„ Mono</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MonoJust</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Mono</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">final</span> T value;</span><br><span class="line">    </span><br><span class="line">    MonoJust(T value) &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = Objects.requireNonNull(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-è®¢é˜…æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ"><a href="#2-è®¢é˜…æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ" class="headerlink" title="2. è®¢é˜…æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ"></a>2. è®¢é˜…æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mono.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> T&gt; consumer)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»º LambdaMonoSubscriber åŒ…è£… consumer</span></span><br><span class="line">    subscribe(<span class="keyword">new</span> <span class="title class_">LambdaMonoSubscriber</span>&lt;&gt;(consumer, ...));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MonoJust.java</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(CoreSubscriber&lt;? <span class="built_in">super</span> T&gt; actual)</span> &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥è°ƒç”¨ onSubscribe å’Œ onNext</span></span><br><span class="line">    actual.onSubscribe(Operators.scalarSubscription(actual, value));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-æ•°æ®ä¼ é€’"><a href="#3-æ•°æ®ä¼ é€’" class="headerlink" title="3. æ•°æ®ä¼ é€’"></a>3. æ•°æ®ä¼ é€’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Operators.java - ScalarSubscription</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ScalarSubscription</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Subscription</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> CoreSubscriber&lt;? <span class="built_in">super</span> T&gt; actual;</span><br><span class="line">    <span class="keyword">final</span> T value;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> once;  <span class="comment">// ç¡®ä¿åªå‘é€ä¸€æ¬¡</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">(<span class="type">long</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &gt; <span class="number">0</span> &amp;&amp; ONCE.compareAndSet(<span class="built_in">this</span>, <span class="number">0</span>, <span class="number">1</span>)) &#123;</span><br><span class="line">            actual.onNext(value);    <span class="comment">// å‘é€æ•°æ®</span></span><br><span class="line">            actual.onComplete();      <span class="comment">// å®Œæˆ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æµç¨‹æ€»ç»“</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Mono.just(&quot;Hello&quot;)</span><br><span class="line">    â†“</span><br><span class="line">new MonoJust(&quot;Hello&quot;)</span><br><span class="line">    â†“</span><br><span class="line">subscribe(consumer)</span><br><span class="line">    â†“</span><br><span class="line">onSubscribe(ScalarSubscription)</span><br><span class="line">    â†“</span><br><span class="line">request(Long.MAX_VALUE)  // LambdaSubscriber é»˜è®¤è¯·æ±‚æ— é™</span><br><span class="line">    â†“</span><br><span class="line">onNext(&quot;Hello&quot;)</span><br><span class="line">    â†“</span><br><span class="line">onComplete()</span><br></pre></td></tr></table></figure>

<h2 id="Flux-map-æºç åˆ†æ"><a href="#Flux-map-æºç åˆ†æ" class="headerlink" title="Flux.map() æºç åˆ†æ"></a>Flux.map() æºç åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    .map(i -&gt; i * <span class="number">2</span>)</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<h3 id="1-åˆ›å»º-FluxMap"><a href="#1-åˆ›å»º-FluxMap" class="headerlink" title="1. åˆ›å»º FluxMap"></a>1. åˆ›å»º FluxMap</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Flux.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> &lt;V&gt; Flux&lt;V&gt; <span class="title function_">map</span><span class="params">(Function&lt;? <span class="built_in">super</span> T, ? extends V&gt; mapper)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> onAssembly(<span class="keyword">new</span> <span class="title class_">FluxMap</span>&lt;&gt;(<span class="built_in">this</span>, mapper));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FluxMap.java</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">FluxMap</span>&lt;T, R&gt; <span class="keyword">extends</span> <span class="title class_">FluxOperator</span>&lt;T, R&gt; &#123;</span><br><span class="line">    <span class="keyword">final</span> Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">R</span>&gt; mapper;</span><br><span class="line">    </span><br><span class="line">    FluxMap(Flux&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; source, Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">R</span>&gt; mapper) &#123;</span><br><span class="line">        <span class="built_in">super</span>(source);</span><br><span class="line">        <span class="built_in">this</span>.mapper = mapper;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-è®¢é˜…æ—¶çš„åŒ…è£…"><a href="#2-è®¢é˜…æ—¶çš„åŒ…è£…" class="headerlink" title="2. è®¢é˜…æ—¶çš„åŒ…è£…"></a>2. è®¢é˜…æ—¶çš„åŒ…è£…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FluxMap.java</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(CoreSubscriber&lt;? <span class="built_in">super</span> R&gt; actual)</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨ MapSubscriber åŒ…è£…ä¸‹æ¸¸è®¢é˜…è€…</span></span><br><span class="line">    source.subscribe(<span class="keyword">new</span> <span class="title class_">MapSubscriber</span>&lt;&gt;(actual, mapper));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-æ•°æ®è½¬æ¢"><a href="#3-æ•°æ®è½¬æ¢" class="headerlink" title="3. æ•°æ®è½¬æ¢"></a>3. æ•°æ®è½¬æ¢</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FluxMap.java - MapSubscriber</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MapSubscriber</span>&lt;T, R&gt; <span class="keyword">implements</span> <span class="title class_">Subscriber</span>&lt;T&gt;, Subscription &#123;</span><br><span class="line">    <span class="keyword">final</span> CoreSubscriber&lt;? <span class="built_in">super</span> R&gt; actual;  <span class="comment">// ä¸‹æ¸¸</span></span><br><span class="line">    <span class="keyword">final</span> Function&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> <span class="title class_">R</span>&gt; mapper;</span><br><span class="line">    Subscription s;  <span class="comment">// ä¸Šæ¸¸çš„ Subscription</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onNext</span><span class="params">(T t)</span> &#123;</span><br><span class="line">        <span class="type">R</span> <span class="variable">v</span> <span class="operator">=</span> mapper.apply(t);  <span class="comment">// è½¬æ¢æ•°æ®</span></span><br><span class="line">        actual.onNext(v);        <span class="comment">// ä¼ ç»™ä¸‹æ¸¸</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">(<span class="type">long</span> n)</span> &#123;</span><br><span class="line">        s.request(n);  <span class="comment">// èƒŒå‹ä¿¡å·å‘ä¸Šä¼ é€’</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è®¢é˜…é“¾ç»“æ„</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FluxArray [1,2,3]</span><br><span class="line">    â†“ subscribe</span><br><span class="line">MapSubscriber (mapper: i -&gt; i*2)</span><br><span class="line">    â†“ subscribe  </span><br><span class="line">LambdaSubscriber (consumer: println)</span><br></pre></td></tr></table></figure>

<p><strong>æ•°æ®æµå‘</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FluxArray.onNext(1)</span><br><span class="line">    â†“</span><br><span class="line">MapSubscriber.onNext(1) â†’ mapper.apply(1) = 2</span><br><span class="line">    â†“</span><br><span class="line">LambdaSubscriber.onNext(2) â†’ println(2)</span><br></pre></td></tr></table></figure>

<h2 id="èƒŒå‹ä¼ é€’æºç "><a href="#èƒŒå‹ä¼ é€’æºç " class="headerlink" title="èƒŒå‹ä¼ é€’æºç "></a>èƒŒå‹ä¼ é€’æºç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .filter(i -&gt; i % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">    .take(<span class="number">5</span>)</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<h3 id="request-çš„ä¼ é€’"><a href="#request-çš„ä¼ é€’" class="headerlink" title="request çš„ä¼ é€’"></a>request çš„ä¼ é€’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FluxTake.java - TakeSubscriber</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">(<span class="type">long</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// å‘ä¸Šæ¸¸è¯·æ±‚ï¼Œä½†ä¸è¶…è¿‡å‰©ä½™éœ€è¦çš„æ•°é‡</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">toRequest</span> <span class="operator">=</span> Math.min(n, remaining);</span><br><span class="line">        s.request(toRequest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FluxFilter.java - FilterSubscriber  </span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">(<span class="type">long</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// filter å¯èƒ½éœ€è¦è¯·æ±‚æ›´å¤šï¼Œå› ä¸ºæœ‰äº›ä¼šè¢«è¿‡æ»¤æ‰</span></span><br><span class="line">    s.request(n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®Œæ•´çš„èƒŒå‹æµç¨‹"><a href="#å®Œæ•´çš„èƒŒå‹æµç¨‹" class="headerlink" title="å®Œæ•´çš„èƒŒå‹æµç¨‹"></a>å®Œæ•´çš„èƒŒå‹æµç¨‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">LambdaSubscriber.request(Long.MAX_VALUE)</span><br><span class="line">    â†“</span><br><span class="line">TakeSubscriber.request(Long.MAX_VALUE) </span><br><span class="line">    â†’ å®é™…è¯·æ±‚ min(MAX_VALUE, 5) = 5</span><br><span class="line">    â†“</span><br><span class="line">FilterSubscriber.request(5)</span><br><span class="line">    â†’ ç›´æ¥ä¼ é€’ï¼ˆfilter ä¸çŸ¥é“ä¼šè¿‡æ»¤å¤šå°‘ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">RangeSubscription.request(5)</span><br><span class="line">    â†’ å¼€å§‹ç”Ÿäº§ 1,2,3,4,5</span><br></pre></td></tr></table></figure>

<h2 id="å¼‚æ­¥è¾¹ç•Œä¸è°ƒåº¦å™¨"><a href="#å¼‚æ­¥è¾¹ç•Œä¸è°ƒåº¦å™¨" class="headerlink" title="å¼‚æ­¥è¾¹ç•Œä¸è°ƒåº¦å™¨"></a>å¼‚æ­¥è¾¹ç•Œä¸è°ƒåº¦å™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line">    .publishOn(Schedulers.parallel())</span><br><span class="line">    .map(i -&gt; i * <span class="number">2</span>)</span><br><span class="line">    .subscribe(System.out::println);</span><br></pre></td></tr></table></figure>

<h3 id="publishOn-çš„å®ç°"><a href="#publishOn-çš„å®ç°" class="headerlink" title="publishOn çš„å®ç°"></a>publishOn çš„å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FluxPublishOn.java</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">FluxPublishOn</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">FluxOperator</span>&lt;T, T&gt; &#123;</span><br><span class="line">    <span class="keyword">final</span> Scheduler scheduler;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> prefetch;  <span class="comment">// é¢„å–æ•°é‡</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// PublishOnSubscriber å†…éƒ¨æœ‰é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">PublishOnSubscriber</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Subscriber</span>&lt;T&gt;, Runnable &#123;</span><br><span class="line">        <span class="keyword">final</span> Queue&lt;T&gt; queue;  <span class="comment">// ç¼“å†²é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">final</span> Worker worker;   <span class="comment">// è°ƒåº¦å™¨å·¥ä½œçº¿ç¨‹</span></span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onNext</span><span class="params">(T t)</span> &#123;</span><br><span class="line">            queue.offer(t);     <span class="comment">// æ”¾å…¥é˜Ÿåˆ—</span></span><br><span class="line">            trySchedule();      <span class="comment">// è°ƒåº¦æ‰§è¡Œ</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">trySchedule</span><span class="params">()</span> &#123;</span><br><span class="line">            worker.schedule(<span class="built_in">this</span>);  <span class="comment">// åœ¨å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ run()</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// åœ¨è°ƒåº¦å™¨çº¿ç¨‹ä¸­æ‰§è¡Œ</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">v</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">            actual.onNext(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>çº¿ç¨‹åˆ‡æ¢ç‚¹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">main çº¿ç¨‹: range â†’ publishOn çš„ queue</span><br><span class="line">    â†“ (çº¿ç¨‹åˆ‡æ¢)</span><br><span class="line">parallel çº¿ç¨‹: queue â†’ map â†’ subscribe</span><br></pre></td></tr></table></figure>

<h2 id="å…³é”®è®¾è®¡æ¨¡å¼"><a href="#å…³é”®è®¾è®¡æ¨¡å¼" class="headerlink" title="å…³é”®è®¾è®¡æ¨¡å¼"></a>å…³é”®è®¾è®¡æ¨¡å¼</h2><h3 id="1-è£…é¥°å™¨æ¨¡å¼"><a href="#1-è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="1. è£…é¥°å™¨æ¨¡å¼"></a>1. è£…é¥°å™¨æ¨¡å¼</h3><p>æ¯ä¸ªæ“ä½œç¬¦éƒ½æ˜¯å¯¹ä¸Šæ¸¸çš„è£…é¥°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flux&lt;Integer&gt; source = Flux.range(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">Flux&lt;Integer&gt; mapped = <span class="keyword">new</span> <span class="title class_">FluxMap</span>&lt;&gt;(source, i -&gt; i * <span class="number">2</span>);</span><br><span class="line">Flux&lt;Integer&gt; filtered = <span class="keyword">new</span> <span class="title class_">FluxFilter</span>&lt;&gt;(mapped, i -&gt; i &gt; <span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-è´£ä»»é“¾æ¨¡å¼"><a href="#2-è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="2. è´£ä»»é“¾æ¨¡å¼"></a>2. è´£ä»»é“¾æ¨¡å¼</h3><p>è®¢é˜…æ—¶å½¢æˆ Subscriber é“¾ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">source.subscribe(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MapSubscriber</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">FilterSubscriber</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LambdaSubscriber</span>(consumer)</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="3-è§‚å¯Ÿè€…æ¨¡å¼"><a href="#3-è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="3. è§‚å¯Ÿè€…æ¨¡å¼"></a>3. è§‚å¯Ÿè€…æ¨¡å¼</h3><p>Publisher-Subscriber æœ¬èº«å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„å˜ä½“ã€‚</p>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>ä¸Šä¸€ç¯‡ï¼šProject Reactor å®ç°</li>
<li>Reactive Streams è§„èŒƒ</li>
<li>WebFlux - çº¿ç¨‹æ¨¡å‹ä¸Netty</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%E4%B8%8ENetty/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%E4%B8%8ENetty/" class="post-title-link" itemprop="url">çº¿ç¨‹æ¨¡å‹ä¸Netty</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Spring/Webflux/" itemprop="url" rel="index"><span itemprop="name">Webflux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="çº¿ç¨‹æ¨¡å‹ä¸-Netty"><a href="#çº¿ç¨‹æ¨¡å‹ä¸-Netty" class="headerlink" title="çº¿ç¨‹æ¨¡å‹ä¸ Netty"></a>çº¿ç¨‹æ¨¡å‹ä¸ Netty</h1><h2 id="ä¼ ç»Ÿ-Servlet-çº¿ç¨‹æ¨¡å‹"><a href="#ä¼ ç»Ÿ-Servlet-çº¿ç¨‹æ¨¡å‹" class="headerlink" title="ä¼ ç»Ÿ Servlet çº¿ç¨‹æ¨¡å‹"></a>ä¼ ç»Ÿ Servlet çº¿ç¨‹æ¨¡å‹</h2><p>ä¼ ç»Ÿ Spring MVC åŸºäº Servlet å®¹å™¨ï¼Œé‡‡ç”¨<strong>æ¯è¯·æ±‚ä¸€çº¿ç¨‹</strong>æ¨¡å‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¯·æ±‚1 â”€â”€â†’ çº¿ç¨‹1 â”€â”€â†’ [æ¥æ”¶è¯·æ±‚ â†’ å¤„ç†ä¸šåŠ¡ â†’ ç­‰å¾…DB â†’ è¿”å›å“åº”] â”€â”€â†’ é‡Šæ”¾</span><br><span class="line">è¯·æ±‚2 â”€â”€â†’ çº¿ç¨‹2 â”€â”€â†’ [æ¥æ”¶è¯·æ±‚ â†’ å¤„ç†ä¸šåŠ¡ â†’ ç­‰å¾…DB â†’ è¿”å›å“åº”] â”€â”€â†’ é‡Šæ”¾</span><br><span class="line">è¯·æ±‚3 â”€â”€â†’ çº¿ç¨‹3 â”€â”€â†’ [æ¥æ”¶è¯·æ±‚ â†’ å¤„ç†ä¸šåŠ¡ â†’ ç­‰å¾…DB â†’ è¿”å›å“åº”] â”€â”€â†’ é‡Šæ”¾</span><br></pre></td></tr></table></figure>

<h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul>
<li>ä¸€ä¸ªè¯·æ±‚<strong>ç‹¬å </strong>ä¸€ä¸ªçº¿ç¨‹ï¼Œä»å¤´åˆ°å°¾</li>
<li>çº¿ç¨‹åœ¨ç­‰å¾… I&#x2F;Oï¼ˆæ•°æ®åº“ã€ç½‘ç»œè°ƒç”¨ï¼‰æ—¶<strong>é˜»å¡</strong>ï¼Œä»€ä¹ˆéƒ½ä¸åš</li>
<li>é«˜å¹¶å‘æ—¶éœ€è¦å¤§é‡çº¿ç¨‹ï¼ˆTomcat é»˜è®¤ 200 ä¸ªï¼‰</li>
<li>çº¿ç¨‹åˆ‡æ¢å¼€é”€å¤§ï¼Œå†…å­˜å ç”¨é«˜ï¼ˆæ¯çº¿ç¨‹çº¦ 1MB æ ˆç©ºé—´ï¼‰</li>
</ul>
<h2 id="WebFlux-äº‹ä»¶å¾ªç¯æ¨¡å‹"><a href="#WebFlux-äº‹ä»¶å¾ªç¯æ¨¡å‹" class="headerlink" title="WebFlux äº‹ä»¶å¾ªç¯æ¨¡å‹"></a>WebFlux äº‹ä»¶å¾ªç¯æ¨¡å‹</h2><p>WebFlux åŸºäº Nettyï¼Œé‡‡ç”¨<strong>äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰</strong> æ¨¡å‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                 â”‚         Event Loop çº¿ç¨‹æ±            â”‚</span><br><span class="line">                 â”‚     (å°‘é‡çº¿ç¨‹ï¼Œå¦‚ CPU æ ¸å¿ƒæ•°)        â”‚</span><br><span class="line">                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                                 â”‚</span><br><span class="line">     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">     â†“                           â†“                           â†“</span><br><span class="line">æ¥æ”¶è¯·æ±‚1                    æ¥æ”¶è¯·æ±‚2                    æ¥æ”¶è¯·æ±‚3</span><br><span class="line">     â”‚                           â”‚                           â”‚</span><br><span class="line">     â†“                           â†“                           â†“</span><br><span class="line">æäº¤I/Oä»»åŠ¡                 æäº¤I/Oä»»åŠ¡                 æäº¤I/Oä»»åŠ¡</span><br><span class="line">(éé˜»å¡è¿”å›)                (éé˜»å¡è¿”å›)                (éé˜»å¡è¿”å›)</span><br><span class="line">     â”‚                           â”‚                           â”‚</span><br><span class="line">     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                                 â†“</span><br><span class="line">                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                 â”‚      I/O å®Œæˆåè§¦å‘å›è°ƒ              â”‚</span><br><span class="line">                 â”‚      Event Loop ç»§ç»­å¤„ç†            â”‚</span><br><span class="line">                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h3 id="æ ¸å¿ƒæ€æƒ³"><a href="#æ ¸å¿ƒæ€æƒ³" class="headerlink" title="æ ¸å¿ƒæ€æƒ³"></a>æ ¸å¿ƒæ€æƒ³</h3><ul>
<li>çº¿ç¨‹<strong>ä¸ç­‰å¾…</strong> I&#x2F;O å®Œæˆï¼Œç«‹å³å»å¤„ç†å…¶ä»–è¯·æ±‚</li>
<li>I&#x2F;O å®Œæˆåé€šè¿‡<strong>å›è°ƒ&#x2F;äº‹ä»¶</strong>é€šçŸ¥</li>
<li>å°‘é‡çº¿ç¨‹å°±èƒ½å¤„ç†å¤§é‡å¹¶å‘è¿æ¥</li>
</ul>
<h2 id="WebFlux-ä¸­çš„çº¿ç¨‹æ± "><a href="#WebFlux-ä¸­çš„çº¿ç¨‹æ± " class="headerlink" title="WebFlux ä¸­çš„çº¿ç¨‹æ± "></a>WebFlux ä¸­çš„çº¿ç¨‹æ± </h2><p>WebFlux ä½¿ç”¨å¤šä¸ªçº¿ç¨‹æ± ï¼Œå„å¸å…¶èŒï¼š</p>
<h3 id="1-Event-Loop-çº¿ç¨‹æ± "><a href="#1-Event-Loop-çº¿ç¨‹æ± " class="headerlink" title="1. Event Loop çº¿ç¨‹æ± "></a>1. Event Loop çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Netty çš„ NioEventLoopGroup</span></span><br><span class="line"><span class="comment">// çº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•°</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å¤„ç†è¿æ¥å»ºç«‹ã€è¯»å†™äº‹ä»¶</li>
<li><strong>ç»å¯¹ä¸èƒ½é˜»å¡</strong>ï¼Œå¦åˆ™å½±å“æ‰€æœ‰è¯·æ±‚</li>
</ul>
<h3 id="2-boundedElastic-çº¿ç¨‹æ± "><a href="#2-boundedElastic-çº¿ç¨‹æ± " class="headerlink" title="2. boundedElastic çº¿ç¨‹æ± "></a>2. boundedElastic çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mono.fromCallable(() -&gt; blockingCall())</span><br><span class="line">    .subscribeOn(Schedulers.boundedElastic())</span><br></pre></td></tr></table></figure>

<ul>
<li>å¤„ç†<strong>å¿…é¡»é˜»å¡</strong>çš„æ“ä½œï¼ˆå¦‚è°ƒç”¨é˜»å¡ APIï¼‰</li>
<li>å¼¹æ€§ä¼¸ç¼©ï¼Œæœ‰ä¸Šé™ä¿æŠ¤</li>
<li>é€‚åˆ I&#x2F;O å¯†é›†å‹é˜»å¡æ“ä½œ</li>
</ul>
<h3 id="3-parallel-çº¿ç¨‹æ± "><a href="#3-parallel-çº¿ç¨‹æ± " class="headerlink" title="3. parallel çº¿ç¨‹æ± "></a>3. parallel çº¿ç¨‹æ± </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    .parallel()</span><br><span class="line">    .runOn(Schedulers.parallel())</span><br></pre></td></tr></table></figure>

<ul>
<li>çº¿ç¨‹æ•° &#x3D; CPU æ ¸å¿ƒæ•°</li>
<li>é€‚åˆ <strong>CPU å¯†é›†å‹</strong>ä»»åŠ¡</li>
</ul>
<h2 id="çº¿ç¨‹æ¨¡å‹å¯¹æ¯”"><a href="#çº¿ç¨‹æ¨¡å‹å¯¹æ¯”" class="headerlink" title="çº¿ç¨‹æ¨¡å‹å¯¹æ¯”"></a>çº¿ç¨‹æ¨¡å‹å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>æ–¹é¢</th>
<th>ä¼ ç»Ÿ MVC</th>
<th>WebFlux</th>
</tr>
</thead>
<tbody><tr>
<td>çº¿ç¨‹æ•°é‡</td>
<td>å¤§é‡ï¼ˆé»˜è®¤ 200+ï¼‰</td>
<td>å°‘é‡ï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰</td>
</tr>
<tr>
<td>ç­‰å¾… I&#x2F;O æ—¶</td>
<td>çº¿ç¨‹é˜»å¡ç­‰å¾…</td>
<td>çº¿ç¨‹å»å¤„ç†å…¶ä»–è¯·æ±‚</td>
</tr>
<tr>
<td>çº¿ç¨‹åˆ©ç”¨ç‡</td>
<td>ä½ï¼ˆå¤§é‡æ—¶é—´åœ¨ç­‰å¾…ï¼‰</td>
<td>é«˜ï¼ˆå‡ ä¹ä¸ç­‰å¾…ï¼‰</td>
</tr>
<tr>
<td>å†…å­˜å ç”¨</td>
<td>é«˜ï¼ˆæ¯çº¿ç¨‹ ~1MBï¼‰</td>
<td>ä½</td>
</tr>
<tr>
<td>ä¸Šä¸‹æ–‡åˆ‡æ¢</td>
<td>é¢‘ç¹</td>
<td>å¾ˆå°‘</td>
</tr>
<tr>
<td>ç¼–ç¨‹æ¨¡å‹</td>
<td>åŒæ­¥é˜»å¡</td>
<td>å¼‚æ­¥éé˜»å¡</td>
</tr>
</tbody></table>
<h2 id="WebFlux-ä¸-Netty-çš„å…³ç³»"><a href="#WebFlux-ä¸-Netty-çš„å…³ç³»" class="headerlink" title="WebFlux ä¸ Netty çš„å…³ç³»"></a>WebFlux ä¸ Netty çš„å…³ç³»</h2><h3 id="Netty-æ˜¯ä»€ä¹ˆ"><a href="#Netty-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Netty æ˜¯ä»€ä¹ˆ"></a>Netty æ˜¯ä»€ä¹ˆ</h3><p>Netty æ˜¯ä¸€ä¸ª<strong>é«˜æ€§èƒ½ç½‘ç»œé€šä¿¡æ¡†æ¶</strong>ï¼Œæä¾›ï¼š</p>
<ul>
<li>éé˜»å¡ I&#x2F;Oï¼ˆNIOï¼‰</li>
<li>äº‹ä»¶é©±åŠ¨æ¨¡å‹</li>
<li>é«˜æ•ˆçš„å†…å­˜ç®¡ç†</li>
<li>åè®®ç¼–è§£ç æ”¯æŒ</li>
</ul>
<h3 id="ç›´æ¥ç”¨-Netty"><a href="#ç›´æ¥ç”¨-Netty" class="headerlink" title="ç›´æ¥ç”¨ Netty"></a>ç›´æ¥ç”¨ Netty</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Netty åŸç”Ÿä»£ç  - å¤„ç†ä¸€ä¸ªç®€å•çš„ HTTP è¯·æ±‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpServerHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> HttpRequest) &#123;</span><br><span class="line">            <span class="type">HttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpRequest) msg;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨è§£æè·¯å¾„</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> request.uri();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ‰‹åŠ¨æ„å»ºå“åº”</span></span><br><span class="line">            <span class="type">FullHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultFullHttpResponse</span>(</span><br><span class="line">                HttpVersion.HTTP_1_1, </span><br><span class="line">                HttpResponseStatus.OK,</span><br><span class="line">                Unpooled.copiedBuffer(<span class="string">&quot;Hello&quot;</span>, CharsetUtil.UTF_8)</span><br><span class="line">            );</span><br><span class="line">            response.headers().set(HttpHeaderNames.CONTENT_TYPE, <span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line">            response.headers().set(HttpHeaderNames.CONTENT_LENGTH, </span><br><span class="line">                response.content().readableBytes());</span><br><span class="line">            </span><br><span class="line">            ctx.writeAndFlush(response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦è‡ªå·±å¤„ç†ï¼šè·¯ç”±ã€å‚æ•°è§£æã€JSON åºåˆ—åŒ–ã€å¼‚å¸¸å¤„ç†ã€è¿æ¥ç®¡ç†â€¦</p>
<h3 id="ç”¨-WebFlux"><a href="#ç”¨-WebFlux" class="headerlink" title="ç”¨ WebFlux"></a>ç”¨ WebFlux</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello/&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">hello</span><span class="params">(<span class="meta">@PathVariable</span> String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.findByName(name);  <span class="comment">// è‡ªåŠ¨ JSON åºåˆ—åŒ–</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WebFlux-åœ¨-Netty-ä¹‹ä¸Šæä¾›äº†ä»€ä¹ˆ"><a href="#WebFlux-åœ¨-Netty-ä¹‹ä¸Šæä¾›äº†ä»€ä¹ˆ" class="headerlink" title="WebFlux åœ¨ Netty ä¹‹ä¸Šæä¾›äº†ä»€ä¹ˆ"></a>WebFlux åœ¨ Netty ä¹‹ä¸Šæä¾›äº†ä»€ä¹ˆ</h3><table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>Netty</th>
<th>WebFlux</th>
</tr>
</thead>
<tbody><tr>
<td>è·¯ç”±</td>
<td>æ‰‹åŠ¨è§£æ URI</td>
<td><code>@GetMapping</code>ã€<code>RouterFunction</code></td>
</tr>
<tr>
<td>å‚æ•°ç»‘å®š</td>
<td>æ‰‹åŠ¨è§£æ</td>
<td><code>@PathVariable</code>ã€<code>@RequestBody</code></td>
</tr>
<tr>
<td>JSON åºåˆ—åŒ–</td>
<td>æ‰‹åŠ¨å¤„ç†</td>
<td>è‡ªåŠ¨ï¼ˆJacksonï¼‰</td>
</tr>
<tr>
<td>å¼‚å¸¸å¤„ç†</td>
<td>æ‰‹åŠ¨ try-catch</td>
<td><code>@ExceptionHandler</code></td>
</tr>
<tr>
<td>ä¾èµ–æ³¨å…¥</td>
<td>æ— </td>
<td>Spring IoC</td>
</tr>
<tr>
<td>é…ç½®ç®¡ç†</td>
<td>æ— </td>
<td><code>application.yml</code></td>
</tr>
<tr>
<td>å®‰å…¨è®¤è¯</td>
<td>æ‰‹åŠ¨å®ç°</td>
<td>Spring Security</td>
</tr>
<tr>
<td>æ•°æ®è®¿é—®</td>
<td>æ‰‹åŠ¨å®ç°</td>
<td>Spring Data R2DBC</td>
</tr>
<tr>
<td>æµ‹è¯•æ”¯æŒ</td>
<td>æ‰‹åŠ¨</td>
<td><code>WebTestClient</code></td>
</tr>
</tbody></table>
<h3 id="ç±»æ¯”ç†è§£"><a href="#ç±»æ¯”ç†è§£" class="headerlink" title="ç±»æ¯”ç†è§£"></a>ç±»æ¯”ç†è§£</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Netty      â‰ˆ  TCP/HTTP åè®®å¼•æ“ï¼ˆåº•å±‚ï¼‰</span><br><span class="line">WebFlux    â‰ˆ  Web å¼€å‘æ¡†æ¶ï¼ˆä¸Šå±‚ï¼‰</span><br><span class="line"></span><br><span class="line">å°±åƒï¼š</span><br><span class="line">JDBC       â‰ˆ  æ•°æ®åº“è¿æ¥ï¼ˆåº•å±‚ï¼‰</span><br><span class="line">MyBatis    â‰ˆ  ORM æ¡†æ¶ï¼ˆä¸Šå±‚ï¼‰</span><br></pre></td></tr></table></figure>

<p><strong>Netty æ˜¯å¼•æ“ï¼ŒWebFlux æ˜¯æ±½è½¦ã€‚</strong> ä½ å¯ä»¥ç›´æ¥ç”¨å¼•æ“ï¼Œä½†å¤§å¤šæ•°äººæ›´æ„¿æ„å¼€æ±½è½¦ã€‚</p>
<h2 id="ä»€ä¹ˆæ—¶å€™ç›´æ¥ç”¨-Netty"><a href="#ä»€ä¹ˆæ—¶å€™ç›´æ¥ç”¨-Netty" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ç›´æ¥ç”¨ Netty"></a>ä»€ä¹ˆæ—¶å€™ç›´æ¥ç”¨ Netty</h2><ul>
<li>è‡ªå®šä¹‰åè®®ï¼ˆé HTTPï¼‰</li>
<li>æè‡´æ€§èƒ½ä¼˜åŒ–</li>
<li>ä¸éœ€è¦ Spring ç”Ÿæ€</li>
<li>æ„å»ºåŸºç¡€è®¾æ–½ï¼ˆå¦‚ç½‘å…³ã€ä»£ç†æœåŠ¡å™¨ï¼‰</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆ-WebFlux-é€‚åˆé«˜å¹¶å‘"><a href="#ä¸ºä»€ä¹ˆ-WebFlux-é€‚åˆé«˜å¹¶å‘" class="headerlink" title="ä¸ºä»€ä¹ˆ WebFlux é€‚åˆé«˜å¹¶å‘"></a>ä¸ºä»€ä¹ˆ WebFlux é€‚åˆé«˜å¹¶å‘</h2><ol>
<li><strong>å°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡è¿æ¥</strong>ï¼šä¸éœ€è¦ä¸ºæ¯ä¸ªè¿æ¥åˆ†é…çº¿ç¨‹</li>
<li><strong>çº¿ç¨‹ä¸é˜»å¡</strong>ï¼šI&#x2F;O ç­‰å¾…æ—¶å»å¤„ç†å…¶ä»–è¯·æ±‚</li>
<li><strong>å†…å­˜æ•ˆç‡é«˜</strong>ï¼šçº¿ç¨‹å°‘ï¼Œå†…å­˜å ç”¨ä½</li>
<li><strong>æ— çº¿ç¨‹åˆ‡æ¢å¼€é”€</strong>ï¼šäº‹ä»¶é©±åŠ¨ï¼Œä¸éœ€è¦é¢‘ç¹åˆ‡æ¢</li>
</ol>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li>Webfluxç®€ä»‹</li>
<li>å“åº”å¼ç¼–ç¨‹åŸºç¡€</li>
<li>Reactoræ ¸å¿ƒAPI</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zmmmmy.github.io/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="ZhiMy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zmmmmy's Blog">
      <meta itemprop="description" content="ä¸€ä¸ªæ¥è‡ªäº AI+Obsidian çš„çŸ¥è¯†åº“">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Zmmmmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/10/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">çº¿ç¨‹æ± ç±»å‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2026-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2026-01-10T00:00:00+08:00">2026-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2026-01-22 15:44:14" itemprop="dateModified" datetime="2026-01-22T15:44:14+08:00">2026-01-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">å¹¶å‘ç¼–ç¨‹</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%B1%A0/" itemprop="url" rel="index"><span itemprop="name">çº¿ç¨‹æ± </span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="çº¿ç¨‹æ± ç±»å‹"><a href="#çº¿ç¨‹æ± ç±»å‹" class="headerlink" title="çº¿ç¨‹æ± ç±»å‹"></a>çº¿ç¨‹æ± ç±»å‹</h1><h2 id="Executors-å·¥å‚ç±»"><a href="#Executors-å·¥å‚ç±»" class="headerlink" title="Executors å·¥å‚ç±»"></a>Executors å·¥å‚ç±»</h2><p>Java é€šè¿‡ <code>Executors</code> å·¥å‚ç±»æä¾›äº†å‡ ç§å¸¸ç”¨çš„çº¿ç¨‹æ± å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                        Executors                                â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  newFixedThreadPool()      â†’ å›ºå®šå¤§å°çº¿ç¨‹æ±                       â”‚</span><br><span class="line">â”‚  newCachedThreadPool()     â†’ ç¼“å­˜çº¿ç¨‹æ±                           â”‚</span><br><span class="line">â”‚  newSingleThreadExecutor() â†’ å•çº¿ç¨‹æ±                             â”‚</span><br><span class="line">â”‚  newScheduledThreadPool()  â†’ å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ±                       â”‚</span><br><span class="line">â”‚  newWorkStealingPool()     â†’ å·¥ä½œçªƒå–çº¿ç¨‹æ±  (Java 8+)            â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-FixedThreadPoolï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰"><a href="#1-FixedThreadPoolï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰" class="headerlink" title="1. FixedThreadPoolï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰"></a>1. FixedThreadPoolï¼ˆå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼‰</h2><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul>
<li>æ ¸å¿ƒçº¿ç¨‹æ•° &#x3D; æœ€å¤§çº¿ç¨‹æ•° &#x3D; å›ºå®šå€¼</li>
<li>ä½¿ç”¨<strong>æ— ç•Œé˜Ÿåˆ—</strong> <code>LinkedBlockingQueue</code></li>
<li>çº¿ç¨‹ä¸ä¼šè¢«å›æ”¶</li>
</ul>
<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        nThreads,                           <span class="comment">// corePoolSize</span></span><br><span class="line">        nThreads,                           <span class="comment">// maximumPoolSizeï¼ˆç›¸åŒï¼‰</span></span><br><span class="line">        <span class="number">0L</span>, TimeUnit.MILLISECONDS,          <span class="comment">// ä¸å›æ”¶</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;() <span class="comment">// æ— ç•Œé˜Ÿåˆ—</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>CPU å¯†é›†å‹ä»»åŠ¡</strong></td>
<td>çº¿ç¨‹æ•° &#x3D; CPU æ ¸å¿ƒæ•° + 1</td>
</tr>
<tr>
<td><strong>è´Ÿè½½ç¨³å®šçš„æœåŠ¡</strong></td>
<td>å·²çŸ¥å¹¶å‘é‡ï¼Œå›ºå®šçº¿ç¨‹æ•°</td>
</tr>
</tbody></table>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå›ºå®š 4 ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </span></span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    executor.submit(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ‰§è¡Œä»»åŠ¡&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">executor.shutdown();</span><br></pre></td></tr></table></figure>

<h3 id="é£é™©æç¤º"><a href="#é£é™©æç¤º" class="headerlink" title="é£é™©æç¤º"></a>é£é™©æç¤º</h3><blockquote>
<p><strong>OOM é£é™©</strong>ï¼šä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼Œä»»åŠ¡å †ç§¯å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º</p>
</blockquote>
<hr>
<h2 id="2-CachedThreadPoolï¼ˆç¼“å­˜çº¿ç¨‹æ± ï¼‰"><a href="#2-CachedThreadPoolï¼ˆç¼“å­˜çº¿ç¨‹æ± ï¼‰" class="headerlink" title="2. CachedThreadPoolï¼ˆç¼“å­˜çº¿ç¨‹æ± ï¼‰"></a>2. CachedThreadPoolï¼ˆç¼“å­˜çº¿ç¨‹æ± ï¼‰</h2><h3 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul>
<li>æ ¸å¿ƒçº¿ç¨‹æ•° &#x3D; 0</li>
<li>æœ€å¤§çº¿ç¨‹æ•° &#x3D; <code>Integer.MAX_VALUE</code>ï¼ˆå‡ ä¹æ— é™ï¼‰</li>
<li>ä½¿ç”¨ <code>SynchronousQueue</code>ï¼ˆä¸å­˜å‚¨ä»»åŠ¡ï¼Œç›´æ¥ä¼ é€’ï¼‰</li>
<li>ç©ºé—²çº¿ç¨‹ 60 ç§’åå›æ”¶</li>
</ul>
<h3 id="æºç åˆ†æ-1"><a href="#æºç åˆ†æ-1" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newCachedThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        <span class="number">0</span>,                                  <span class="comment">// corePoolSize = 0</span></span><br><span class="line">        Integer.MAX_VALUE,                  <span class="comment">// maximumPoolSize = æ— é™</span></span><br><span class="line">        <span class="number">60L</span>, TimeUnit.SECONDS,              <span class="comment">// 60ç§’å›æ”¶</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;Runnable&gt;()    <span class="comment">// ç›´æ¥ä¼ é€’</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨åœºæ™¯-1"><a href="#ä½¿ç”¨åœºæ™¯-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>çŸ­æ—¶å¼‚æ­¥ä»»åŠ¡</strong></td>
<td>æ‰§è¡Œæ—¶é—´çŸ­ï¼Œä»»åŠ¡é‡æ³¢åŠ¨å¤§</td>
</tr>
<tr>
<td><strong>IO å¯†é›†å‹ä»»åŠ¡</strong></td>
<td>å¤§é‡ç­‰å¾…ï¼Œéœ€è¦æ›´å¤šçº¿ç¨‹</td>
</tr>
</tbody></table>
<h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿçªå‘å¤§é‡çŸ­ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    executor.submit(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">100</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">executor.shutdown();</span><br></pre></td></tr></table></figure>

<h3 id="é£é™©æç¤º-1"><a href="#é£é™©æç¤º-1" class="headerlink" title="é£é™©æç¤º"></a>é£é™©æç¤º</h3><blockquote>
<p><strong>çº¿ç¨‹çˆ†ç‚¸</strong>ï¼šä»»åŠ¡æäº¤é€Ÿåº¦ &gt; å¤„ç†é€Ÿåº¦æ—¶ï¼Œä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ</p>
</blockquote>
<hr>
<h2 id="3-SingleThreadExecutorï¼ˆå•çº¿ç¨‹æ± ï¼‰"><a href="#3-SingleThreadExecutorï¼ˆå•çº¿ç¨‹æ± ï¼‰" class="headerlink" title="3. SingleThreadExecutorï¼ˆå•çº¿ç¨‹æ± ï¼‰"></a>3. SingleThreadExecutorï¼ˆå•çº¿ç¨‹æ± ï¼‰</h2><h3 id="ç‰¹ç‚¹-2"><a href="#ç‰¹ç‚¹-2" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul>
<li>åªæœ‰ 1 ä¸ªçº¿ç¨‹</li>
<li>ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—</li>
<li>ä¿è¯ä»»åŠ¡<strong>é¡ºåºæ‰§è¡Œ</strong></li>
<li>çº¿ç¨‹å¼‚å¸¸ç»ˆæ­¢åä¼šåˆ›å»ºæ–°çº¿ç¨‹</li>
</ul>
<h3 id="æºç åˆ†æ-2"><a href="#æºç åˆ†æ-2" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newSingleThreadExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FinalizableDelegatedExecutorService</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">            <span class="number">1</span>, <span class="number">1</span>,                               <span class="comment">// åªæœ‰1ä¸ªçº¿ç¨‹</span></span><br><span class="line">            <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨åœºæ™¯-2"><a href="#ä½¿ç”¨åœºæ™¯-2" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>é¡ºåºæ‰§è¡Œä»»åŠ¡</strong></td>
<td>æ—¥å¿—å†™å…¥ã€æ¶ˆæ¯å¤„ç†</td>
</tr>
<tr>
<td><strong>å•çº¿ç¨‹å®‰å…¨</strong></td>
<td>é¿å…å¹¶å‘é—®é¢˜</td>
</tr>
</tbody></table>
<h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œ</span></span><br><span class="line">executor.submit(() -&gt; System.out.println(<span class="string">&quot;ä»»åŠ¡1&quot;</span>));</span><br><span class="line">executor.submit(() -&gt; System.out.println(<span class="string">&quot;ä»»åŠ¡2&quot;</span>));</span><br><span class="line">executor.submit(() -&gt; System.out.println(<span class="string">&quot;ä»»åŠ¡3&quot;</span>));</span><br><span class="line"><span class="comment">// è¾“å‡ºé¡ºåºä¸€å®šæ˜¯ï¼šä»»åŠ¡1 â†’ ä»»åŠ¡2 â†’ ä»»åŠ¡3</span></span><br><span class="line"></span><br><span class="line">executor.shutdown();</span><br></pre></td></tr></table></figure>

<h3 id="é£é™©æç¤º-2"><a href="#é£é™©æç¤º-2" class="headerlink" title="é£é™©æç¤º"></a>é£é™©æç¤º</h3><blockquote>
<p><strong>OOM é£é™©</strong>ï¼šåŒ FixedThreadPoolï¼Œæ— ç•Œé˜Ÿåˆ—å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡º</p>
</blockquote>
<hr>
<h2 id="4-ScheduledThreadPoolï¼ˆå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼‰"><a href="#4-ScheduledThreadPoolï¼ˆå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼‰" class="headerlink" title="4. ScheduledThreadPoolï¼ˆå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼‰"></a>4. ScheduledThreadPoolï¼ˆå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼‰</h2><h3 id="ç‰¹ç‚¹-3"><a href="#ç‰¹ç‚¹-3" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ul>
<li>æ”¯æŒ<strong>å®šæ—¶æ‰§è¡Œ</strong>å’Œ<strong>å‘¨æœŸæ‰§è¡Œ</strong></li>
<li>ä½¿ç”¨ <code>DelayedWorkQueue</code>ï¼ˆå»¶è¿Ÿé˜Ÿåˆ—ï¼‰</li>
</ul>
<h3 id="æºç åˆ†æ-3"><a href="#æºç åˆ†æ-3" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title function_">newScheduledThreadPool</span><span class="params">(<span class="type">int</span> corePoolSize)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ScheduledThreadPoolExecutor</span>(corePoolSize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ScheduledThreadPoolExecutor ç»§æ‰¿è‡ª ThreadPoolExecutor</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ScheduledThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(corePoolSize, Integer.MAX_VALUE,</span><br><span class="line">          DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS,</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">DelayedWorkQueue</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ ¸å¿ƒæ–¹æ³•"><a href="#æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•"></a>æ ¸å¿ƒæ–¹æ³•</h3><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>schedule()</code></td>
<td>å»¶è¿Ÿæ‰§è¡Œä¸€æ¬¡</td>
</tr>
<tr>
<td><code>scheduleAtFixedRate()</code></td>
<td>å›ºå®šé¢‘ç‡æ‰§è¡Œï¼ˆä¸è€ƒè™‘ä»»åŠ¡è€—æ—¶ï¼‰</td>
</tr>
<tr>
<td><code>scheduleWithFixedDelay()</code></td>
<td>å›ºå®šå»¶è¿Ÿæ‰§è¡Œï¼ˆä»»åŠ¡ç»“æŸåå»¶è¿Ÿï¼‰</td>
</tr>
</tbody></table>
<h3 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ScheduledExecutorService</span> <span class="variable">scheduler</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. å»¶è¿Ÿ 3 ç§’æ‰§è¡Œ</span></span><br><span class="line">scheduler.schedule(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;å»¶è¿Ÿ3ç§’æ‰§è¡Œ&quot;</span>);</span><br><span class="line">&#125;, <span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å›ºå®šé¢‘ç‡ï¼šæ¯ 2 ç§’æ‰§è¡Œä¸€æ¬¡ï¼ˆä»ä¸Šæ¬¡å¼€å§‹æ—¶é—´ç®—ï¼‰</span></span><br><span class="line">scheduler.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;å›ºå®šé¢‘ç‡æ‰§è¡Œ: &quot;</span> + System.currentTimeMillis());</span><br><span class="line">&#125;, <span class="number">0</span>, <span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. å›ºå®šå»¶è¿Ÿï¼šæ¯æ¬¡æ‰§è¡Œå®Œåç­‰ 2 ç§’å†æ‰§è¡Œ</span></span><br><span class="line">scheduler.scheduleWithFixedDelay(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;å›ºå®šå»¶è¿Ÿæ‰§è¡Œ&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">1000</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</span><br><span class="line">&#125;, <span class="number">0</span>, <span class="number">2</span>, TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<h3 id="scheduleAtFixedRate-vs-scheduleWithFixedDelay"><a href="#scheduleAtFixedRate-vs-scheduleWithFixedDelay" class="headerlink" title="scheduleAtFixedRate vs scheduleWithFixedDelay"></a>scheduleAtFixedRate vs scheduleWithFixedDelay</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scheduleAtFixedRate (period=2s, ä»»åŠ¡è€—æ—¶1s):</span><br><span class="line">|--ä»»åŠ¡--|     |--ä»»åŠ¡--|     |--ä»»åŠ¡--|</span><br><span class="line">0        1     2        3     4        5  (ç§’)</span><br><span class="line"></span><br><span class="line">scheduleWithFixedDelay (delay=2s, ä»»åŠ¡è€—æ—¶1s):</span><br><span class="line">|--ä»»åŠ¡--|           |--ä»»åŠ¡--|           |--ä»»åŠ¡--|</span><br><span class="line">0        1     2     3        4     5     6        7  (ç§’)</span><br><span class="line">         â””â”€â”€2så»¶è¿Ÿâ”€â”€â”˜         â””â”€â”€2så»¶è¿Ÿâ”€â”€â”˜</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-WorkStealingPoolï¼ˆå·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼‰"><a href="#5-WorkStealingPoolï¼ˆå·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼‰" class="headerlink" title="5. WorkStealingPoolï¼ˆå·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼‰"></a>5. WorkStealingPoolï¼ˆå·¥ä½œçªƒå–çº¿ç¨‹æ± ï¼‰</h2><h3 id="ç‰¹ç‚¹ï¼ˆJava-8-ï¼‰"><a href="#ç‰¹ç‚¹ï¼ˆJava-8-ï¼‰" class="headerlink" title="ç‰¹ç‚¹ï¼ˆJava 8+ï¼‰"></a>ç‰¹ç‚¹ï¼ˆJava 8+ï¼‰</h3><ul>
<li>åŸºäº ForkJoinPool å®ç° ^forkjoinpool</li>
<li>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„<strong>åŒç«¯é˜Ÿåˆ—</strong></li>
<li>ç©ºé—²çº¿ç¨‹ä¼š<strong>çªƒå–</strong>å…¶ä»–çº¿ç¨‹é˜Ÿåˆ—çš„ä»»åŠ¡</li>
<li>é»˜è®¤çº¿ç¨‹æ•° &#x3D; CPU æ ¸å¿ƒæ•°</li>
</ul>
<h3 id="æºç åˆ†æ-4"><a href="#æºç åˆ†æ-4" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newWorkStealingPool</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>(</span><br><span class="line">        Runtime.getRuntime().availableProcessors(),  <span class="comment">// CPUæ ¸å¿ƒæ•°</span></span><br><span class="line">        ForkJoinPool.defaultForkJoinWorkerThreadFactory,</span><br><span class="line">        <span class="literal">null</span>, <span class="literal">true</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å·¥ä½œçªƒå–åŸç†"><a href="#å·¥ä½œçªƒå–åŸç†" class="headerlink" title="å·¥ä½œçªƒå–åŸç†"></a>å·¥ä½œçªƒå–åŸç†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹1çš„é˜Ÿåˆ—:  [ä»»åŠ¡A] [ä»»åŠ¡B] [ä»»åŠ¡C] [ä»»åŠ¡D]</span><br><span class="line">                â†‘ ä»å¤´éƒ¨å–ä»»åŠ¡æ‰§è¡Œ</span><br><span class="line">                </span><br><span class="line">çº¿ç¨‹2çš„é˜Ÿåˆ—:  [ç©º]</span><br><span class="line">                â†‘ è‡ªå·±é˜Ÿåˆ—ç©ºäº†ï¼Œä»çº¿ç¨‹1é˜Ÿåˆ—å°¾éƒ¨çªƒå–</span><br><span class="line">                </span><br><span class="line">ç»“æœ: çº¿ç¨‹2çªƒå–ä»»åŠ¡Dæ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨åœºæ™¯-3"><a href="#ä½¿ç”¨åœºæ™¯-3" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>é€’å½’ä»»åŠ¡</strong></td>
<td>åˆ†æ²»ç®—æ³•ã€æ ‘éå†</td>
</tr>
<tr>
<td><strong>å¹¶è¡Œè®¡ç®—</strong></td>
<td>å¤§æ•°æ®å¤„ç†ã€å¹¶è¡Œæµ</td>
</tr>
</tbody></table>
<h3 id="ç¤ºä¾‹-4"><a href="#ç¤ºä¾‹-4" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newWorkStealingPool();</span><br><span class="line"></span><br><span class="line">List&lt;Callable&lt;Integer&gt;&gt; tasks = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> i;</span><br><span class="line">    tasks.add(() -&gt; &#123;</span><br><span class="line">        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">return</span> num * num;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡</span></span><br><span class="line">List&lt;Future&lt;Integer&gt;&gt; results = executor.invokeAll(tasks);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="çº¿ç¨‹æ± å¯¹æ¯”æ€»ç»“"><a href="#çº¿ç¨‹æ± å¯¹æ¯”æ€»ç»“" class="headerlink" title="çº¿ç¨‹æ± å¯¹æ¯”æ€»ç»“"></a>çº¿ç¨‹æ± å¯¹æ¯”æ€»ç»“</h2><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>æ ¸å¿ƒçº¿ç¨‹</th>
<th>æœ€å¤§çº¿ç¨‹</th>
<th>é˜Ÿåˆ—</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Fixed</strong></td>
<td>n</td>
<td>n</td>
<td>æ— ç•Œ LinkedBlockingQueue</td>
<td>CPUå¯†é›†ã€è´Ÿè½½ç¨³å®š</td>
</tr>
<tr>
<td><strong>Cached</strong></td>
<td>0</td>
<td>MAX</td>
<td>SynchronousQueue</td>
<td>çŸ­ä»»åŠ¡ã€IOå¯†é›†</td>
</tr>
<tr>
<td><strong>Single</strong></td>
<td>1</td>
<td>1</td>
<td>æ— ç•Œ LinkedBlockingQueue</td>
<td>é¡ºåºæ‰§è¡Œ</td>
</tr>
<tr>
<td><strong>Scheduled</strong></td>
<td>n</td>
<td>MAX</td>
<td>DelayedWorkQueue</td>
<td>å®šæ—¶&#x2F;å‘¨æœŸä»»åŠ¡</td>
</tr>
<tr>
<td><strong>WorkStealing</strong></td>
<td>CPUæ ¸å¿ƒæ•°</td>
<td>-</td>
<td>åŒç«¯é˜Ÿåˆ—</td>
<td>é€’å½’&#x2F;å¹¶è¡Œè®¡ç®—</td>
</tr>
</tbody></table>
<hr>
<h2 id="æœ€ä½³å®è·µï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#æœ€ä½³å®è·µï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="æœ€ä½³å®è·µï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± "></a>æœ€ä½³å®è·µï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± </h2><blockquote>
<p><strong>é˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œ</strong>ï¼šç¦æ­¢ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± ï¼Œåº”é€šè¿‡ ThreadPoolExecutor æ‰‹åŠ¨åˆ›å»º</p>
</blockquote>
<h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h3><table>
<thead>
<tr>
<th>å·¥å‚æ–¹æ³•</th>
<th>é£é™©</th>
</tr>
</thead>
<tbody><tr>
<td>FixedThreadPool</td>
<td>æ— ç•Œé˜Ÿåˆ—å¯èƒ½ OOM</td>
</tr>
<tr>
<td>SingleThreadExecutor</td>
<td>æ— ç•Œé˜Ÿåˆ—å¯èƒ½ OOM</td>
</tr>
<tr>
<td>CachedThreadPool</td>
<td>æœ€å¤§çº¿ç¨‹æ•°æ— é™ï¼Œå¯èƒ½åˆ›å»ºè¿‡å¤šçº¿ç¨‹</td>
</tr>
<tr>
<td>ScheduledThreadPool</td>
<td>æœ€å¤§çº¿ç¨‹æ•°æ— é™</td>
</tr>
</tbody></table>
<h3 id="æ¨èå†™æ³•"><a href="#æ¨èå†™æ³•" class="headerlink" title="æ¨èå†™æ³•"></a>æ¨èå†™æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ¨èï¼šæ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="number">10</span>,                                     <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="number">20</span>,                                     <span class="comment">// æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="number">60L</span>, TimeUnit.SECONDS,                  <span class="comment">// ç©ºé—²å­˜æ´»æ—¶é—´</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">100</span>),          <span class="comment">// æœ‰ç•Œé˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ThreadFactoryBuilder</span>()              <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹åï¼ˆGuavaï¼‰</span></span><br><span class="line">        .setNameFormat(<span class="string">&quot;ä¸šåŠ¡çº¿ç¨‹-%d&quot;</span>)</span><br><span class="line">        .build(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()  <span class="comment">// æ‹’ç»ç­–ç•¥</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="çº¿ç¨‹æ•°è®¾ç½®å»ºè®®"><a href="#çº¿ç¨‹æ•°è®¾ç½®å»ºè®®" class="headerlink" title="çº¿ç¨‹æ•°è®¾ç½®å»ºè®®"></a>çº¿ç¨‹æ•°è®¾ç½®å»ºè®®</h3><table>
<thead>
<tr>
<th>ä»»åŠ¡ç±»å‹</th>
<th>çº¿ç¨‹æ•°å…¬å¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>CPU å¯†é›†å‹</strong></td>
<td>N + 1</td>
<td>N &#x3D; CPU æ ¸å¿ƒæ•°</td>
</tr>
<tr>
<td><strong>IO å¯†é›†å‹</strong></td>
<td>2N æˆ– N * (1 + W&#x2F;C)</td>
<td>W&#x3D;ç­‰å¾…æ—¶é—´ï¼ŒC&#x3D;è®¡ç®—æ—¶é—´</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å– CPU æ ¸å¿ƒæ•°</span></span><br><span class="line"><span class="type">int</span> <span class="variable">cpuCores</span> <span class="operator">=</span> Runtime.getRuntime().availableProcessors();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><ul>
<li><strong>ä¸Šä¸€ç¯‡</strong>ï¼š02-çº¿ç¨‹æ± åŸç†</li>
<li><strong>ä¸‹ä¸€ç¯‡</strong>ï¼š04-ForkJoinPool</li>
<li><strong>çº¿ç¨‹æ± ç®€ä»‹</strong>ï¼š01-çº¿ç¨‹æ± ç®€ä»‹</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ZhiMy</span>
  </div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
